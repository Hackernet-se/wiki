{"config":{"lang":["sv"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Hemliga Hacker Wikin","text":"<p>H\u00e4r kommer alla hemliga hackerknep att l\u00e4ggas upp</p> <p>Har du tips, id\u00e9er eller feedback p\u00e5 det som skrivs, h\u00f6r g\u00e4rna av dig via v\u00e5r github l\u00e4nk i h\u00f6grna h\u00f6rnet.</p>"},{"location":"gamla-General_disclaimer/","title":"H\u00e4mligaHackerWikin:General disclaimer","text":"<p>Hackernet \u00e4r en \u00f6ppen samarbets encyklopedi; det vill s\u00e4ga en sammanslutning av kompisar som arbetar f\u00f6r att utveckla en gemensam resurs av kunskap f\u00f6r IT tj\u00e4nster. Strukturen i projektet kan vem som helst med en Internetanslutning l\u00e4sa. Observera att allt som finns h\u00e4r har granskats av personer med den kompetens som kr\u00e4vs f\u00f6r att ge dig fullst\u00e4ndig, korrekt eller tillf\u00f6rlitlig information. Det \u00e4r inte att s\u00e4ga att du inte kommer att hitta v\u00e4rdefull och korrekt information i Hackernet; en stor del av den tid du kommer. Men Hackernet kan inte garantera giltigheten av den information som finns h\u00e4r. Inneh\u00e5llet i en viss artikel kan nyligen har \u00e4ndrats.</p>"},{"location":"gamla-mainpage/","title":"Main Page","text":"<p>NOTOC NOCACHE</p>   H\u00e4mligaHackerWikin    H\u00e4r kommer alla h\u00e4mliga hackerknep att l\u00e4ggas upp  Har du tips, id\u00e9er eller feedback p\u00e5 det som skrivs, h\u00f6r g\u00e4rna av dig.  root\\[at\\]hackernet.se    Livsviktigt info     Vi \u00e4r **** aktiva skribenter     som tillsammans skrivit **** artiklar     och gjort **** redigeringar.    Senaste artikeln    namespace=Special:RecentChanges count=5 mode=none   Wishlist    **[Varnish](/Varnish \"wikilink\")** **[OpenCanary](/OpenCanary \"wikilink\")** **[HAProxy](/HAProxy \"wikilink\")** **[Wazuh](/Wazuh \"wikilink\")**"},{"location":"linux/","title":"Linux","text":"<p>Linux\u00a0\u00e4r ett\u00a0Unix-liknande\u00a0operativsystem\u00a0som till st\u00f6rsta delen, och i n\u00e5gra varianter helt, best\u00e5r av\u00a0fri programvara.</p>"},{"location":"linux/#tools","title":"Tools","text":"<p> category = Tools ordermethod = sortkey order = ascending </p>"},{"location":"linux/#distar","title":"Distar","text":"<p> category = Distar ordermethod = sortkey order = ascending </p>"},{"location":"linux/#tipsntrix","title":"Tips'n'trix","text":""},{"location":"linux/#skapa-ny-disk","title":"Skapa ny disk","text":"<p>Skapa en volume group av en disk.</p> <p><code>vgcreate\u00a0cs_log02_data\u00a0/dev/sdb</code></p> <p>Skapa en logical volume av volume groupen du skapa.</p> <p><code>lvcreate\u00a0-l\u00a0100%FREE\u00a0-n\u00a0logs\u00a0cs_log02_data</code> <code>mkfs.xfs\u00a0/dev/cs_log02_data/logs</code></p> <p>Skapa en folder och mounta nya disken.</p> <p><code>mkdir\u00a0-p\u00a0/data/logs</code> <code>mount\u00a0/dev/cs_log02_data/logs\u00a0/data/logs</code></p> <p>Se till att mounten \u00e4r permanenet n\u00e4r servern rebootar.</p> <p><code>echo\u00a0\"/dev/mapper/cs_log02_data-logs\u00a0/data/logs\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0xfs\u00a0\u00a0\u00a0\u00a0\u00a0defaults\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a00\u00a00\"\u00a0&gt;&gt;\u00a0/etc/fstab</code></p>"},{"location":"linux/#expandera-disk","title":"Expandera disk","text":"<p><code>Scanna\u00a0om\u00a0disken\u00a0du\u00a0vill\u00a0expandera\u00a0efter\u00a0du\u00a0ut\u00f6kat\u00a0i\u00a0exempelvis\u00a0vmware.</code> <code>echo\u00a01&gt;/sys/class/block/sdc/device/rescan</code> <code>fdisk\u00a0-l\u00a0kolla\u00a0s\u00e5\u00a0den\u00a0\u00e4r\u00a0ut\u00f6kad</code> <code>Ut\u00f6ka\u00a0PVn</code> <code>pvresize\u00a0/dev/sdc</code> <code>ut\u00f6ka\u00a0lv\u00a0lvextend\u00a0-l\u00a0+100%FREE\u00a0/dev/mapper/datavg</code> <code>expandera\u00a0volymen\u00a0med.</code> <code>xfs_growfs\u00a0/dev/mapper/datavg</code></p>"},{"location":"linux/#skapa-egna-selinux-med-grep-och-audit2allow","title":"Skapa egna selinux med grep och audit2allow.","text":"<p>Kommando</p> <p><code>cat\u00a0/var/log/audit/audit.log\u00a0|grep\u00a0postgres_expo\u00a0|grep\u00a0denied\u00a0|audit2allow</code></p> <p>Resultat som visar vad det \u00e4r du skapar en regel p\u00e5</p> <p><code>#=============\u00a0init_t\u00a0==============</code> <code>allow\u00a0init_t\u00a0postgresql_port_t:tcp_socket\u00a0name_connect;</code></p> <p>Kommando</p> <p><code>cat\u00a0/var/log/audit/audit.log\u00a0|grep\u00a0postgres_expo\u00a0|grep\u00a0denied\u00a0|audit2allow\u00a0-M\u00a0postgres</code></p> <p>Resultat som bara visar vad du skall k\u00f6ra f\u00f6r att implementera selinux regeln ovan</p> <p><code>********************\u00a0IMPORTANT\u00a0***********************</code> <code>To\u00a0make\u00a0this\u00a0policy\u00a0package\u00a0active,\u00a0execute:</code> <code>semodule\u00a0-i\u00a0postgres.pp</code></p> <p>kommando</p> <p><code>semodule\u00a0-i\u00a0postgres.pp</code></p>"},{"location":"linux/#ansluta-till-tradlost-natverk","title":"Ansluta till tr\u00e5dl\u00f6st n\u00e4tverk.","text":"<p><code>nmcli\u00a0d\u00a0wifi\u00a0connect</code><code>password</code><code>iface\u00a0wlan0</code>"},{"location":"linux/#ta-reda-pa-om-det-ar-nagot-lokalt-prestanda-eller-kapacitetsproblem-med-maskinen","title":"Ta reda p\u00e5 om det \u00e4r n\u00e5got lokalt prestanda eller kapacitetsproblem med maskinen.","text":"<p>Finns p\u00e5 Github och PyPI</p> <p><code>glances</code></p>"},{"location":"linux/#ta-reda-pa-publik-ip-du-har","title":"Ta reda p\u00e5 publik IP du har","text":"<p><code>wget</code><code>http://ipinfo.io/ip</code><code>-qO\u00a0-</code></p>"},{"location":"linux/#testa-hardvaruaccelerering","title":"Testa h\u00e5rdvaruaccelerering","text":"<p><code>openssl\u00a0speed\u00a0-evp\u00a0AES256</code></p>"},{"location":"linux/#speedtest-mot-internet-med-cli","title":"Speedtest mot internet med cli","text":"<p><code>wget\u00a0-O\u00a0speedtest-cli</code><code>https://raw.github.com/sivel/speedtest-cli/master/speedtest_cli.py</code> <code>chmod\u00a0+x\u00a0speedtest-cli</code> <code>./speedtest-cli\u00a0--simple</code></p>"},{"location":"linux/#lista-filer-efter-storlek","title":"Lista filer efter storlek","text":"<p><code>for\u00a0i\u00a0in\u00a0T\u00a0G\u00a0M\u00a0K;\u00a0do\u00a0du\u00a0-hsx\u00a0*\u00a0|\u00a0grep\u00a0\"[0-9]$i\\b\"\u00a0|\u00a0sort\u00a0-nr;\u00a0done\u00a02&gt;/dev/null</code></p>"},{"location":"linux/#summera-alla-filer-i-en-mapp-och-printa-storleken","title":"Summera alla filer i en mapp och printa storleken.","text":"<p><code>du\u00a0-hs\u00a0*</code></p>"},{"location":"linux/#restricted-shell","title":"Restricted Shell","text":"<p><code>useradd[mod]\u00a0-s\u00a0/usr/sbin/scponly\u00a0user1</code></p>"},{"location":"linux/#process-run-time","title":"Process Run Time","text":"<p><code>ps\u00a0-p\u00a0PID\u00a0-o\u00a0etime=</code></p>"},{"location":"linux/#skydda-mot-syn-flood","title":"Skydda mot SYN flood","text":"<p><code>ss\u00a0-a\u00a0|\u00a0grep\u00a0SYN-RECV\u00a0|\u00a0awk\u00a0'{print\u00a0$4}'\u00a0|\u00a0awk\u00a0-F\":\"\u00a0'{print\u00a0$1}'\u00a0|\u00a0sort\u00a0|\u00a0uniq\u00a0-c\u00a0|\u00a0sort\u00a0-n</code></p> <p><code>sudo\u00a0netstat\u00a0-antp\u00a0|\u00a0grep\u00a0SYN_RECV|awk\u00a0'{print\u00a0$4}'|sort|uniq\u00a0-c\u00a0|\u00a0sort\u00a0-n</code></p>"},{"location":"linux/#parallellpinga-ip-adresser-fran-fil","title":"Parallellpinga IP-adresser fr\u00e5n fil","text":"<p><code>echo\u00a0$(cat\u00a0iplist.txt)\u00a0|\u00a0xargs\u00a0-n\u00a01\u00a0-P0\u00a0ping\u00a0-w\u00a01\u00a0-c\u00a01</code></p>"},{"location":"linux/#kolla-vilken-tjanst-som-vanligtvis-ligger-pa-vilken-port-tex","title":"Kolla vilken tj\u00e4nst som vanligtvis ligger p\u00e5 vilken port, t.ex.","text":"<p><code>cat\u00a0/etc/services\u00a0|\u00a0grep\u00a0mysql</code></p>"},{"location":"linux/#kor-en-filesystem-check-vid-nasta-uppstart","title":"K\u00f6r en filesystem check vid n\u00e4sta uppstart","text":"<p><code>touch\u00a0/forcefsck</code></p>"},{"location":"linux/#kolla-distinfo","title":"Kolla distinfo","text":"<p><code>lsb_release\u00a0-a</code> <code>eller</code> <code>cat\u00a0/etc/*release</code></p>"},{"location":"linux/#titta-pa-senaste-uppstart-grafiskt","title":"Titta p\u00e5 senaste uppstart grafiskt","text":"<p><code>systemd-analyze\u00a0plot\u00a0&gt;\u00a0plot.svg</code></p>"},{"location":"linux/#kolla-vad-ett-kommando-kor-for-systemfragor-valdigt-anvandbart-vid-felsokning","title":"Kolla vad ett kommando k\u00f6r f\u00f6r systemfr\u00e5gor. V\u00e4ldigt anv\u00e4ndbart vid fels\u00f6kning.","text":"<p><code>strace</code>"},{"location":"linux/#kor-ett-kommando-tex-1-gang-i-sekunden-default-2-sekunder","title":"K\u00f6r ett kommando tex 1 g\u00e5ng i sekunden. (Default 2 sekunder)","text":"<p><code>watch\u00a0-n\u00a01\u00a0date</code></p>"},{"location":"linux/#kopiera-directory-struktur-utan-att-kopiera-filer","title":"Kopiera directory-struktur utan att kopiera filer","text":"<p><code>rsync\u00a0-a\u00a0-f\"+\u00a0*/\"\u00a0-f\"-\u00a0*\"\u00a0source/\u00a0destination/</code></p>"},{"location":"linux/#lista-harddiskar-partitioner-och-raid","title":"Lista h\u00e5rddiskar, partitioner och RAID.","text":"<p><code>lsblk</code></p>"},{"location":"linux/#simpelt-prestandatest-av-harddiskar","title":"Simpelt prestandatest av h\u00e5rddiskar","text":"<p><code>dd\u00a0if=/dev/zero\u00a0of=(fil\u00a0p\u00e5\u00a0disken/raiden)\u00a0bs=1G\u00a0count=1\u00a0oflag=dsync</code></p>"},{"location":"linux/#packa-upp-initrd","title":"Packa upp initrd.","text":"<p><code>gunzip\u00a0-dc\u00a0../initrd\u00a0|\u00a0cpio\u00a0-idmuv</code></p>"},{"location":"linux/#packa-ner-initrd","title":"Packa ner initrd.","text":"<p><code>find\u00a0.\u00a0-print\u00a0|cpio\u00a0-o\u00a0-H\u00a0newc\u00a0|\u00a0xz\u00a0--format=lzma\u00a0&gt;\u00a0../initrd</code></p>"},{"location":"linux/#byt-namn-pa-alla-filer-och-mappar-fran-uppercase-till-lowercase-i-en-mapp","title":"Byt namn p\u00e5 alla filer och mappar fr\u00e5n uppercase till lowercase i en mapp.","text":"<p>Upper till lower.</p> <p><code>for\u00a0i\u00a0in\u00a0*;\u00a0do\u00a0mv\u00a0\"$i\"\u00a0\"$(echo\u00a0$i|tr\u00a0A-Z\u00a0a-z)\";\u00a0done</code></p> <p>Lower till upper.</p> <p><code>for\u00a0i\u00a0in\u00a0*;\u00a0do\u00a0mv\u00a0\"$i\"\u00a0\"$(echo\u00a0$i|tr\u00a0a-z\u00a0A-Z)\";\u00a0done</code></p>"},{"location":"linux/#sok-efter-en-text-i-alla-filer-i-en-mapp","title":"S\u00f6k efter en text i alla filer i en mapp","text":"<p><code>grep\u00a0-r\u00a0\"string\"\u00a0.</code></p>"},{"location":"linux/#kollar-antal-dagar-det-ar-kvar-pa-ett-certifikat","title":"Kollar antal dagar det \u00e4r kvar p\u00e5 ett certifikat","text":"<pre><code> remote_cert_remaining_days() { cert_remaining_time=$(date -d \"$(openssl s_client -connect $1 2&gt;/dev/null &lt;/dev/null | openssl x509  -enddate -noout | cut -d'=' -f2)\" \"+%s\");  current_time=$(date \"+%s\"); echo remaining $((($cert_remaining_time - $current_time) / 60 / 60 / 24)) days; }\n</code></pre> <p><code>remote_cert_remaining_days\u00a0fqdn:443</code></p>"},{"location":"linux/#rakna-ut-option-121-for-dhcp","title":"R\u00e4kna ut option 121 f\u00f6r DHCP","text":"<p>F\u00f6r att kunna skicka ut fler routes via DHCP beh\u00f6ver man skriva p\u00e5 ett visst s\u00e4tt. F\u00f6ljande sida kan hj\u00e4lpa till med det: Route calculator</p>"},{"location":"linux/#intervjufragor","title":"Intervjufr\u00e5gor","text":"<p>Ska du p\u00e5 arbetsintervju f\u00f6r ett linuxjobb? Prepare your anus!</p> <ol> <li>Vad \u00e4r det f\u00f6r skillnad p\u00e5 en vanlig fil och ett directory?</li> <li>Vad \u00e4r en i-node?</li> <li>Vad \u00e4r det f\u00f6r skillnad p\u00e5 hard och soft links? Vad h\u00e4nder om man     tar bort k\u00e4llan f\u00f6r l\u00e4nken?</li> <li>Vad \u00e4r en process och vad best\u00e5r den logiskt av?</li> <li>Vad \u00e4r det f\u00f6r skillnad p\u00e5 mtab och fstab?</li> <li>Vad g\u00f6r rm-kommandot? (utan v\u00e4xlar)</li> <li>Vad \u00e4r det f\u00f6r skillnad p\u00e5 kill och kill -9?</li> <li>Villka process states finns det?</li> <li>Vad \u00e4r det f\u00f6r skillnad p\u00e5 process och thread?</li> <li>Vad \u00e4r en Socket?</li> <li>Vad \u00e4r Huge Pages och vad anv\u00e4nds de till?</li> <li>Hur frig\u00f6r man cacheat minne utan att reboota systemet?</li> <li>Vad \u00e4r det f\u00f6r skillnad p\u00e5 chmod och setfacl?</li> <li>Vad \u00e4r Memory Overcommit?</li> <li>Vad \u00e4r system load average som visas av uptime-kommandot?</li> <li>Vad finns det f\u00f6r f\u00f6r- och nackdelar med kernel kontra user space?</li> <li>Vad \u00e4r runlevel?</li> <li>Vad \u00e4r det f\u00f6r skillnad p\u00e5 TTY och PTS?</li> <li>Du \u00e4r fast p\u00e5 en \u00f6de \u00f6 och f\u00e5r bara anv\u00e4nda ett enda kommando,     vilket v\u00e4ljer du?</li> </ol>"},{"location":"linux/#svar","title":"Svar","text":"<p>Kommer inom sinom tid, har du svar bidra g\u00e4rna</p>"},{"location":"arista/Arista_BGP/","title":"Arista BGP","text":"<p>Se \u00e4ven Cisco BGP</p>"},{"location":"arista/Arista_BGP/#konfiguration","title":"Konfiguration","text":"<p><code>router\u00a0bgp\u00a065001</code> <code>neighbor\u00a020.20.20.20\u00a0remote-as\u00a065001</code> <code>neighbor\u00a020.20.20.20\u00a0description\u00a0vEOS20</code> <code>neighbor\u00a020.20.20.20\u00a0password\u00a07\u00a0gqWjIYItRuw=</code> <code>neighbor\u00a020.20.20.20\u00a0maximum-routes\u00a012000</code> <code>network\u00a0210.210.210.0/24</code></p> <p>ECMP</p> <p><code>router\u00a0bgp\u00a065001</code> <code>maximum-paths\u00a04\u00a0ecmp\u00a04</code></p> <p>Show</p> <p><code>show\u00a0ip\u00a0bgp\u00a0summary</code> <code>show\u00a0ip\u00a0bgp\u00a0neighbor</code></p> <p>Reset</p> <p><code>clear\u00a0ip\u00a0bgp\u00a0*</code> <code>clear\u00a0ip\u00a0bgp</code></p>   soft  ### BGP-LU  BGP kan annonsera unicast routes med en associated mpls label (RFC 3107). Det kan t.ex. anv\u00e4ndas f\u00f6r att tunnela genom andra provider backbones och p\u00e5 s\u00e5 s\u00e4tt binda ihop multipla IGP-instancer \u00f6ver stitchade LSP paths. BGP-LU advertisements p\u00e5verkar endast edge/border routers och inte P routers.  `router\u00a0bgp\u00a065001` `\u00a0neighbor\u00a02.2.2.2\u00a0remote-as\u00a065001` `\u00a0neighbor\u00a02.2.2.2\u00a0update-source\u00a0Loopback0` `\u00a0neighbor\u00a02.2.2.2\u00a0maximum-routes\u00a012000`  `\u00a0address-family\u00a0ipv4\u00a0labeled-unicast` `\u00a0\u00a0neighbor\u00a02.2.2.2\u00a0activate`  Verify  `show\u00a0ip\u00a0bgp\u00a0labeled-unicast`  [Category:Arista](/Category:Arista \"wikilink\")"},{"location":"arista/Arista_EOS/","title":"Arista EOS","text":"<p>Arista Extensible Operating System \u00e4r ett Linux-based network operating system. EOS levereras som en image som kan k\u00f6ras p\u00e5 alla plattformar, \u00e4ven som virtuel maskin. EOS \u00e4r v\u00e4ldigt Cisco IOS likt i sina kommandon.</p>"},{"location":"arista/Arista_EOS/#veos","title":"vEOS","text":"<p>vEOS fungerar p\u00e5 de flesta virtualiseringsplattformar inklusive EVE-NG, KVM, VirtualBox, ESXi och Hyper-V. vEOS-lab har en drivrutin som heter Elba, den emulerar h\u00e5rdvara. En del features saknar vEOS-lab st\u00f6d f\u00f6r, t.ex. storm-control och IPsec.</p>"},{"location":"arista/Arista_EOS/#installation","title":"Installation","text":"<p>F\u00f6r nyare vEOS (4.15) vill man ha 2GB RAM.</p> <p>ESXi</p> <p><code>https://eos.arista.com/running-veos-on-esxi-5-5/</code></p> <p>Virtualbox</p> <p><code>vboxmanage\u00a0createvm\u00a0--name\u00a0vEOS02\u00a0--ostype\u00a0Fedora_64\u00a0--register</code> <code>VBoxManage\u00a0modifyvm\u00a0vEOS02\u00a0--memory\u00a02048</code> <code>VBoxManage\u00a0modifyvm\u00a0vEOS02\u00a0--nic1\u00a0intnet</code> <code>VBoxManage\u00a0modifyvm\u00a0vEOS02\u00a0--intnet1\u00a0Mgmt1</code> <code>VBoxManage\u00a0modifyvm\u00a0vEOS02\u00a0--nicpromisc1\u00a0allow-vms</code> <code>VBoxManage\u00a0modifyvm\u00a0vEOS02\u00a0--cableconnected1\u00a0on</code> <code>VBoxManage\u00a0storagectl\u00a0vEOS02\u00a0--name\u00a0\"IDE\u00a0Controller\"\u00a0--add\u00a0ide</code> <code>VBoxManage\u00a0storageattach\u00a0vEOS02\u00a0--storagectl\u00a0\"IDE\u00a0Controller\"\u00a0--port\u00a00\u00a0--device\u00a00\u00a0--type\u00a0hdd\u00a0--medium\u00a0/path/vEOS-lab-4.15.2.1F.vmdk</code> <code>VBoxManage\u00a0storageattach\u00a0vEOS02\u00a0--storagectl\u00a0\"IDE\u00a0Controller\"\u00a0--port\u00a01\u00a0--device\u00a00\u00a0--type\u00a0dvddrive\u00a0--medium\u00a0/path/Aboot-veos-2.1.0.iso</code></p> <p>Credentials admin:"},{"location":"arista/Arista_EOS/#konfiguration","title":"Konfiguration","text":"<p>Grundkonfiguration</p> <p><code>hostname\u00a0vEOS-01</code> <code>logging\u00a0console\u00a0notifications</code> <code>logging\u00a0monitor\u00a0informational</code> <code>logging\u00a0synchronous</code> <code>logging\u00a0buffered\u00a02000</code> <code>username\u00a0wizkid\u00a0privilege\u00a015\u00a0secret</code> <p><code>show\u00a0user-account</code></p> <p>Management interface</p> <p><code>interface\u00a0Management1</code> <code>ip\u00a0address\u00a010.0.0.10/24</code> <code>no\u00a0shut</code></p> <p><code>lldp\u00a0management-address\u00a0Management1</code></p>"},{"location":"arista/Arista_EOS/#ssh","title":"SSH","text":"<p>SSH \u00e4r p\u00e5slaget default, det som beh\u00f6ver konfas \u00e4r anv\u00e4ndare och IP-adress. Ska man anv\u00e4nda EOS som scp-server m\u00e5ste det user-konto man loggar in med ha \"full access\", dvs privilege 15.</p> <p><code>management\u00a0ssh</code> <code>idle-timeout\u00a01800</code></p> <p>Autentisering med SSH-nyckel</p> <p><code>copy\u00a0scp:user@jumphost/home/user/.ssh/id_rsa.pub\u00a0flash:</code> <code>username</code><code>user</code><code>sshkey\u00a0file\u00a0flash:id_rsa.pub</code></p>"},{"location":"arista/Arista_EOS/#management-vrf","title":"Management VRF","text":"<p><code>vrf\u00a0definition\u00a0MGMT</code> <code>rd\u00a0100:100</code></p> <p>F\u00f6rsta porten \u00e4r Ma1</p> <p><code>interface\u00a0ma1</code> <code>vrf\u00a0forwarding\u00a0MGMT</code> <code>ip\u00a0address\u00a010.0.0.10\u00a0255.255.255.0</code></p>"},{"location":"arista/Arista_EOS/#eapi","title":"eAPI","text":"<p>En user beh\u00f6vs f\u00f6r att kunna anv\u00e4nda eAPI. URL till API sandbox: https://:443 <p><code>management\u00a0api\u00a0http-commands</code> <code>no\u00a0shutdown</code> <code>!</code> <code>vrf\u00a0MGMT</code> <code>no\u00a0shutdown</code></p> <p><code>show\u00a0management\u00a0api\u00a0http-commands</code></p> <p>Det finns \u00e4ven st\u00f6d f\u00f6r netconf och restconf</p> <p><code>management\u00a0api\u00a0netconf</code> <code>transport\u00a0ssh\u00a0MGMT</code> <code>!</code> <code>management\u00a0api\u00a0restconf</code> <code>transport\u00a0https\u00a0MGMT</code></p>"},{"location":"arista/Arista_EOS/#diverse","title":"Diverse","text":"<p>Show the current running-config for this sub mode</p> <p><code>show\u00a0active</code></p> <p>Show diff between running and startup</p> <p><code>show\u00a0running\u00a0diff</code></p> <p>Backa till startup-konfig</p> <p><code>configure\u00a0replace\u00a0startup-config</code></p> <p>CLI history</p> <p><code>show\u00a0history</code></p> <p>Sl\u00e5 p\u00e5 loggmeddelanden i SSH terminal.</p> <p><code>terminal\u00a0monitor</code></p> <p>Syslog</p> <p><code>logging\u00a0buffered\u00a010000\u00a0notifications</code> <code>logging\u00a0host\u00a010.0.0.12</code> <code>show\u00a0logging</code> <code>show\u00a0logg\u00a0last\u00a010\u00a0min</code></p> <p>NTP</p> <p><code>ntp\u00a0server\u00a010.0.0.12</code></p> <p>DNS</p> <p><code>ip\u00a0name-server\u00a08.8.8.8</code> <code>show\u00a0hosts</code></p> <p>SCP Server</p> <p><code>aaa\u00a0authorization\u00a0exec\u00a0default\u00a0local</code></p>"},{"location":"arista/Arista_EOS/#port-mirroring","title":"Port mirroring","text":"<p><code>monitor\u00a0session\u00a01\u00a0source\u00a0interface</code><code>[\u00a0rx\u00a0|\u00a0tx\u00a0|\u00a0both\u00a0]</code> <code>monitor\u00a0session\u00a01\u00a0destination</code> <p>Begr\u00e4nsa p\u00e5 IP vad som ska speglas.</p> <p><code>monitor\u00a0session\u00a01\u00a0ip\u00a0access-group</code>"},{"location":"arista/Arista_EOS/#iperf","title":"Iperf","text":"<p>Iperf finns inbyggt i EOS. Dock till\u00e5ts inte tcp 5001 default.</p> <p><code>bash</code> <code>sudo\u00a0iptables\u00a0-I\u00a0INPUT\u00a0-p\u00a0tcp\u00a0-m\u00a0tcp\u00a0--dport\u00a05001\u00a0-j\u00a0ACCEPT</code> <code>iperf\u00a0-s</code></p> <p>Klient</p> <p><code>iperf\u00a0-c\u00a010.0.0.10</code></p>"},{"location":"arista/Arista_EOS/#yum","title":"Yum","text":"<p>Yum finns inbyggt i EOS men det finns inga repos default.</p> <p><code>bash</code> <code>sudo\u00a0nano\u00a0/etc/yum.repos.d/fedora.repo</code> <code>[fedora]</code> <code>name=Fedora\u00a014\u00a0\u2013\u00a0i386</code> <code>failovermethod=priority</code> <code>baseurl=</code><code>http://dl.fedoraproject.org/pub/archive/fedora/linux/releases/14/Everything/i386/os/</code> <code>exclude=kernel,fedora-logos</code> <code>enabled=1</code> <code>gpgcheck=0</code></p> <p><code>sudo\u00a0yum\u00a0install\u00a0iftop</code></p>"},{"location":"arista/Arista_EOS/#maintenance-mode","title":"Maintenance Mode","text":"<p>S\u00e4tt hela switchen i maintenance mode, d\u00e5 graceful st\u00e4ngs allt utom management.</p> <p><code>maintenance</code> <code>unit\u00a0System</code> <code>quiesce</code> <code>show\u00a0maintenance</code></p> <p>Category:Arista</p>"},{"location":"arista/Arista_EVPN/","title":"Arista EVPN","text":"<p>Ethernet VPN (RFC 7432) \u00e4r en modernare variant \u00e4n VPLS f\u00f6r att tillhandah\u00e5lla Ethernet multipoint services \u00f6ver IP (VXLAN) eller MPLS (med eller utan SR). BGP EVPN \u00e4r en ny adressfamilj som anv\u00e4nds f\u00f6r att distribuera lokala MAC-adresser och MAC/IP bindings till VTEP:s. Next-hop i EVPN-uppdateringarna \u00e4r antingen egress Label Switch Router eller VXLAN Tunnel Endpoint. EVPN har bl.a. features f\u00f6r att h\u00e5lla koll p\u00e5 hostar som flyttar mellan datacenter (sekvensnummer i annonseringarna) och kan d\u00e5 konvergera snabbt. Ett EVPN-n\u00e4tverk kan g\u00f6ra b\u00e5de bridging och routing och har inbyggd support f\u00f6r multi-tenancy. Protokollet \u00e4r \u00f6ppet s\u00e5 det finns interoperability med andra network vendors, se t.ex. Cisco, Cumulus och Quagga EVPN.</p> <p>Route types # Ethernet Auto-Discovery Route</p> <ol> <li>MAC/IP Advertisement Route</li> <li>Inclusive Multicast Ethernet Tag Route</li> <li>Ethernet Segment Route</li> <li>IP Prefix Route</li> </ol>"},{"location":"arista/Arista_EVPN/#konfiguration","title":"Konfiguration","text":"<p>EVPN kan konfigureras p\u00e5 olika s\u00e4tt beroende p\u00e5 hur designen ser ut d\u00e4remot m\u00e5ste man byta BGP agent ifr\u00e5n GateD till arBGP.</p> <p><code>service\u00a0routing\u00a0protocols\u00a0model\u00a0multi-agent</code></p> <p>EOS kan \u00e4n s\u00e5l\u00e4nge inte auto-derivera RD eller RT.</p>"},{"location":"arista/Arista_EVPN/#underlay","title":"Underlay","text":"<p>Underlay routing kan g\u00f6ras med IGP, iBGP eller eBGP. Alla VTEP:s m\u00e5ste kunna n\u00e5 varandra. Simpelt exempel:</p> <p><code>ip\u00a0routing</code></p> <p><code>interface\u00a0Loopback0</code> <code>description\u00a0VTEP</code> <code>ip\u00a0address\u00a01.1.1.1/32</code></p> <p><code>router\u00a0ospf\u00a01</code> <code>redistribute\u00a0connected</code> <code>network\u00a00.0.0.0/0\u00a0area\u00a00.0.0.0</code></p>"},{"location":"arista/Arista_EVPN/#overlay","title":"Overlay","text":"<p><code>interface\u00a0Vxlan1</code> <code>vxlan\u00a0source-interface\u00a0Loopback0</code> <code>vxlan\u00a0udp-port\u00a04789</code></p> <p><code>router\u00a0bgp\u00a065000</code> <code>no\u00a0bgp\u00a0default\u00a0ipv4-unicast</code> <code>neighbor\u00a0172.16.0.2\u00a0remote-as\u00a065000</code> <code>neighbor\u00a0172.16.0.2\u00a0send-community\u00a0extended</code> <code>!</code> <code>address-family\u00a0evpn</code> <code>neighbor\u00a0172.16.0.2\u00a0activate</code></p> <p>Verify</p> <p><code>show\u00a0bgp\u00a0evpn\u00a0summary</code></p>"},{"location":"arista/Arista_EVPN/#bridging","title":"Bridging","text":"<p><code>vlan\u00a0100-101</code></p> <p><code>interface\u00a0Vxlan1</code> <code>vxlan\u00a0vlan\u00a0100\u00a0vni\u00a010100</code> <code>vxlan\u00a0vlan\u00a0101\u00a0vni\u00a010101</code></p> <p><code>router\u00a0bgp\u00a065000</code> <code>vlan\u00a0100</code> <code>rd\u00a01.1.1.1:100</code> <code>route-target\u00a0both\u00a065000:10100</code> <code>redistribute\u00a0learned</code> <code>vlan\u00a0101</code> <code>rd\u00a01.1.1.1:101</code> <code>route-target\u00a0both\u00a065000:10101</code> <code>redistribute\u00a0learned</code></p> <p>Verify</p> <p><code>show\u00a0bgp\u00a0evpn\u00a0route-type\u00a0mac-ip</code></p>"},{"location":"arista/Arista_EVPN/#l3","title":"L3","text":"<p>Arista implementerar EVPN VXLAN routing i symmetric mode. F\u00f6r att f\u00e5 fram RMAC samt ha ett interface in mot fabricen (logisk) autoskapar EOS ett SVI per VRF som har ett L3VNI knytet till sig. Det man m\u00e5ste konfa \u00e4r VRF, knyta till L3VNI och f\u00e5 in i BGP.</p> <p><code>vrf\u00a0definition\u00a0Tenant1</code></p> <p><code>ip\u00a0routing\u00a0vrf\u00a0Tenant1</code></p> <p><code>interface\u00a0Vxlan1</code> <code>vxlan\u00a0vrf\u00a0Tenant1\u00a0vni\u00a030001</code></p> <p><code>router\u00a0bgp\u00a065000</code> <code>vrf\u00a0Tenant1</code> <code>rd\u00a01.1.1.1:1009</code> <code>route-target\u00a0import\u00a065000:30001</code> <code>route-target\u00a0export\u00a065000:30001</code></p> <p>Anycast GW</p> <p><code>ip\u00a0virtual-router\u00a0mac-address\u00a00000.1111.2222</code></p> <p><code>interface\u00a0Vlan100</code> <code>vrf\u00a0forwarding\u00a0Tenant1</code> <code>ip\u00a0address\u00a0virtual\u00a010.0.0.1/24</code></p> <p>'''Skicka lokala IP prefix, route type 5</p> <p><code>router\u00a0bgp\u00a065000</code> <code>vrf\u00a0Tenant1</code> <code>redistribute\u00a0connected</code></p> <p>Verify</p> <p><code>show\u00a0bgp\u00a0evpn\u00a0route-type\u00a0ip-prefix\u00a0ipv4</code></p> <p>Category:Arista</p>"},{"location":"arista/Arista_OSPF/","title":"Arista OSPF","text":"<p>Open Shortest Path First. Se \u00e4ven Cisco OSPF</p>"},{"location":"arista/Arista_OSPF/#konfiguration","title":"Konfiguration","text":"<p><code>router\u00a0ospf\u00a0[process-id]</code></p> <p>router-id for this OSPF process (in IP address format)</p> <p><code>router-id\u00a0[OSPF\u00a0router-id]</code></p> <p><code>log-adjacency-changes</code></p> <p>Enable routing on an IP network</p> <p><code>network\u00a0[network-number]\u00a0[wildcard-mask]\u00a0area\u00a0[area-id]</code></p> <p>Suppress routing updates on an interface</p> <p><code>passive-interface\u00a0[interface]</code></p> <p><code>default-information\u00a0originate</code></p> <p><code>interface\u00a0[interface]</code> <code>ip\u00a0ospf\u00a0priority\u00a0[number]</code> <code>exit</code></p> <p>ABR Summarization</p> <p><code>router\u00a0ospf\u00a01</code> <code>area\u00a010\u00a0range\u00a010.10.0.0\u00a0255.255.252.0</code> <code>exit</code></p> <p>ASBR Summarization</p> <p><code>router\u00a0ospf\u00a01</code> <code>summary-address\u00a010.10.0.0\u00a0255.255.252.0</code> <code>exit</code></p> <p><code>router\u00a0ospf\u00a01</code> <code>auto-cost\u00a0reference-bandwidth\u00a01000</code> <code>exit</code></p>"},{"location":"arista/Arista_OSPF/#troubleshoot","title":"Troubleshoot","text":"<p><code>show\u00a0ip\u00a0ospf\u00a0neighbor</code> <code>ping\u00a0224.0.0.5</code> <code>show\u00a0ip\u00a0ospf\u00a0interface\u00a0brief</code></p> <p>Category:Arista</p>"},{"location":"arista/Arista_VXLAN/","title":"Arista VXLAN","text":"<p>Virtual Extensible LAN (VXLAN) \u00e4r en network virtualization technology. VXLAN bridging tillhandah\u00e5ller layer 2 konnektivitet f\u00f6r end systems \u00f6ver en routad infrastruktur. F\u00f6r att koppla ihop end systems i olika subn\u00e4t kr\u00e4vs antingen centralized routing eller VXLAN routing. Det senare kan g\u00f6ras b\u00e5de symmetriskt och asymmetriskt, dvs om samma VNI anv\u00e4nds i b\u00e5da trafikriktninger eller ej. Default f\u00f6r enkapsulerade paket mellan VTEP:ar anv\u00e4nds UDP port 4789. D\u00e4remot kan control plane g\u00f6ras p\u00e5 olika s\u00e4tt, se nedan. Aristas VXLAN g\u00e5r att kombinera med MLAG. Se \u00e4ven Cisco VXLAN.</p>"},{"location":"arista/Arista_VXLAN/#konfiguration","title":"Konfiguration","text":"<p>Initial setup. VTEP-IP m\u00e5ste vara n\u00e5bar fr\u00e5n alla andra VTEP:ar.</p> <p><code>interface\u00a0Loopback0</code> <code>description\u00a0VTEP</code> <code>ip\u00a0address\u00a010.0.0.10/32</code></p> <p><code>interface\u00a0Vxlan1</code> <code>vxlan\u00a0source-interface\u00a0Loopback0</code> <code>vxlan\u00a0udp-port\u00a04789</code></p> <p>Skapa vlan och mappa med VNI.</p> <p><code>vlan\u00a0100</code></p> <p><code>interface\u00a0Vxlan1</code> <code>vxlan\u00a0vlan\u00a0100\u00a0vni\u00a010100</code></p> <p>Verify</p> <p><code>show\u00a0interface\u00a0vxlan\u00a01</code> <code>show\u00a0vxlan\u00a0address-table</code></p>"},{"location":"arista/Arista_VXLAN/#flood-and-learn","title":"Flood and Learn","text":"<p>Med denna setup g\u00f6rs MAC learning med hj\u00e4lp av flooding. Multidestinationstrafik (BUM) hanteras med Head-End Replication i underlay. Man m\u00e5ste konfa IP-adresser till alla VTEP:ar p\u00e5 alla VTEP:ar. Man kan \u00e4ven ange den lokala vtep-ip:n i flood-listan, den kommer att accepteras i konfen men ignoreras i praktiken. Flood and Learn \u00e4r simpelt men inte det mest skalbara alternativet.</p> <p><code>interface\u00a0Vxlan1</code> <code>vxlan\u00a0vlan\u00a0100\u00a0flood\u00a0vtep\u00a010.0.0.11\u00a010.0.0.12</code></p> <p>Verify</p> <p><code>show\u00a0vxlan\u00a0flood\u00a0vtep</code></p>"},{"location":"arista/Arista_VXLAN/#cvx","title":"CVX","text":"<p>CloudVision eXchange (CVX) kan automatiskt synkronisera VTEP:arna och deras state samt n\u00f6dv\u00e4ndiga HER flood-lists. CVX synkroniserar alla MAC-adresser s\u00e5 fort en switch l\u00e4rt sig dem p\u00e5 n\u00e5gon lokal port, dvs leafs publicerar sin mac table till CVX. Man kan s\u00e4tta upp ett HA-kluster f\u00f6r resiliency. Det finns \u00e4ven st\u00f6d f\u00f6r third-party VTEP:s.</p> <p>Leaf</p> <p><code>interface\u00a0vxlan1</code> <code>vxlan\u00a0source-interface\u00a0Loopback0</code> <code>vxlan\u00a0udp-port\u00a04789</code> <code>vxlan\u00a0control-service</code></p> <p><code>management\u00a0cvx</code> <code>source-interface\u00a0lo0</code> <code>server\u00a0host\u00a010.0.0.100</code> <code>no\u00a0shut</code></p> <p>Standalone CVX VXLAN service on EOS</p> <p><code>interface\u00a0Loopback0</code> <code>ip\u00a0address\u00a010.0.0.100/32</code></p> <p><code>config</code> <code>cvx</code> <code>no\u00a0shutdown</code> <code>service\u00a0vxlan</code> <code>no\u00a0shutdown</code></p> <p>Verify</p> <p><code>show\u00a0cvx</code> <code>show\u00a0cvx\u00a0connections</code> <code>show\u00a0vxlan\u00a0controller\u00a0status</code> <code>show\u00a0vxlan\u00a0controller\u00a0address-table\u00a0received</code></p>"},{"location":"arista/Arista_VXLAN/#evpn","title":"EVPN","text":"<p>Se Arista EVPN.</p>"},{"location":"arista/Arista_VXLAN/#multitenancy-routing","title":"Multitenancy routing","text":"<p>Anycast gateway</p> <p><code>hardware\u00a0tcam\u00a0profile\u00a0vxlan-routing</code></p> <p><code>vrf\u00a0definition\u00a0Tenant1</code> <code>rd\u00a0100:1</code></p> <p><code>ip\u00a0routing\u00a0vrf\u00a0Tenant1</code> <code>ip\u00a0route\u00a0vrf\u00a0Tenant1\u00a00.0.0.0/0\u00a010.0.0.1</code></p> <p><code>interface\u00a0Vlan100</code> <code>vrf\u00a0forwarding\u00a0Tenant1</code> <code>ip\u00a0address\u00a0virtual\u00a010.0.0.10/24</code></p> <p><code>interface\u00a0Vlan101</code> <code>vrf\u00a0forwarding\u00a0Tenant1</code> <code>ip\u00a0address\u00a0virtual\u00a010.0.101.1/24</code></p>"},{"location":"arista/Arista_VXLAN/#nsx","title":"NSX","text":"<p>Arista-switchar kan agera VTEP:s f\u00f6r VMware NSX. Ta certet och importera i NSX Manager.</p> <p><code>show\u00a0hsc\u00a0certificate</code> <code>show\u00a0hsc\u00a0status</code></p> <p>Category:Arista</p>"},{"location":"cisco/Cisco_ACI/","title":"Cisco ACI","text":"<p>Cisco aci \u00e4r en av Ciscos senaste innovationer inom hur man bygger datacenter och \u00e4r egentligen ett orkestreringsverktyg f\u00f6r Nexus serien men inte med IOS utan APIC mjukvara i grunden p\u00e5 switcharna. Det \u00e4r ett software defined network d\u00e4r man fr\u00e5n en kontroller kan man d\u00e5 styra sitt fabric och integrera andra system med det f\u00f6r att g\u00f6ra automation mot sitt datacenter nedan \u00e4r n\u00e5gra exempel p\u00e5 hur ACI fungerar. ACI st\u00e5r f\u00f6r Application Centric Infrastructure men man \u00e4r inte tvingad att k\u00f6ra just applikationer utan det kan vara annat som exempel l2 eller l3 integrationer internt i fabricen eller g\u00f6ra integrationer externa ocks\u00e5 mot b\u00e5de n\u00e4t och applikationsresurser.</p>"},{"location":"cisco/Cisco_ACI/#datacenter-design","title":"Datacenter Design","text":"<p>Det finns garanterat annan dokumentation p\u00e5 design av hur man b\u00f6r bygga datacenter baserat p\u00e5 olika leverant\u00f6rer eller preferenser men h\u00e4r beskriver vi grundl\u00e4ggande hur designen ser ut med spine och leaf upps\u00e4ttning och vad som \u00e4r viktigt att t\u00e4nka p\u00e5 n\u00e4r man bygger och integrerar sina system. </p>"},{"location":"cisco/Cisco_ACI/#spine","title":"Spine","text":"<p>Spine kallas de Nexus switchar som sitter p\u00e5 toppen av de andra fabric switcharna f\u00f6r att t\u00e4nket man skall ha \u00e4r att alla Leaf switchar skall alltid kopplas till alla spines f\u00f6r att f\u00e5 redundans och funktion genom hela fabricen.</p>"},{"location":"cisco/Cisco_ACI/#leaf","title":"Leaf","text":"<p>Leaf \u00e4r de switcharna som kopplas in till faktiska resurser s\u00e5 som upklinks till spines och downlinks mot antingen UCS enheter \"bare metal\" servrar alternativt annan n\u00e4tverksutrustning om peering sker utanf\u00f6r ditt fabric eller om man k\u00f6r med en annan leverant\u00f6r f\u00f6r brandv\u00e4ggs leverans.</p>"},{"location":"cisco/Cisco_ACI/#apic","title":"Apic","text":""},{"location":"cisco/Cisco_ACI/#stretch-fabric","title":"Stretch Fabric","text":""},{"location":"cisco/Cisco_ACI/#multi-pod","title":"Multi-POD","text":""},{"location":"cisco/Cisco_ACI/#mjukvara","title":"Mjukvara","text":"<p>Mjukvaran i aci \u00e4r ett eget typ av operativ f\u00f6r just Apicen som har m\u00f6jlighet att styra de olika fabric enheterna.</p>"},{"location":"cisco/Cisco_ACI/#apic_1","title":"APIC","text":""},{"location":"cisco/Cisco_ACI/#nexus","title":"Nexus","text":""},{"location":"cisco/Cisco_ACI/#hardvara","title":"H\u00e5rdvara","text":"<p>H\u00e5rvaran har utvecklats med tiden f\u00f6r att ha st\u00f6d f\u00f6r tyngre och st\u00f6rre fabrics med mer resurser.</p>"},{"location":"cisco/Cisco_ACI/#generationer","title":"Generationer","text":""},{"location":"cisco/Cisco_ACI/#asic","title":"Asic","text":""},{"location":"cisco/Cisco_ACI/#begransningar","title":"Begr\u00e4nsningar","text":""},{"location":"cisco/Cisco_ACI/#integration","title":"Integration","text":""},{"location":"cisco/Cisco_ACI/#ucs","title":"UCS","text":""},{"location":"cisco/Cisco_ACI/#vmware","title":"Vmware","text":""},{"location":"cisco/Cisco_ACI/#troubleshooting","title":"Troubleshooting","text":"<p>On apic: <pre><code>#apic\nacidiag\u00a0verifyapic\ncat\u00a0/data/data_admin/sam_exported.config\ncat\u00a0/proc/net/bonding/bond0\nmoquery\u00a0-c\u00a0ipv4Addr\u00a0|\u00a0grep\u00a0100.64.0.20\n</code></pre> <pre><code>#fabric\nshow\u00a0versions\nshow\u00a0switch\nshow\u00a0endpoints\u00a0vlan\u00a0100\nshow\u00a0vpc\u00a0map\nshow\u00a0oob-mgmt\nshow\u00a0firmware\u00a0upgrade\u00a0status\nshow\u00a0stats\u00a0granularity\u00a015min\u00a0leaf\u00a0101\u00a0interface\u00a0ethernet\u00a01/5\nshow\u00a0epg\u00a0EPG1\u00a0detail\nshow\u00a0interface\u00a0bridge-domain\u00a0BD1\u00a0detail\nshow\u00a0acllog\u00a0permit\u00a0l3\u00a0flow\u00a0tenant\u00a0Tenant1\u00a0vrf\u00a0vrf1\u00a0\n</code></pre></p> <p>On leaf: <pre><code>show\u00a0vlan\u00a0extended\niping\u00a0-V\u00a0Tenant1:vrf1\u00a020.0.0.1\u00a0-S\u00a010.0.0.1\nshow\u00a0system\u00a0internal\u00a0epm\u00a0vlan\u00a0100\nshow\u00a0port-channel\u00a0extended\nshow\u00a0endpoint\u00a0vrf\u00a0Tenant1:vrf1\nshow\u00a0bgp\u00a0sessions\u00a0vrf\u00a0TEST:L3VRF\nshow\u00a0bgp\u00a0vpnv4\u00a0unicast\u00a0vrf\u00a0TEST:L3VRF\nshow\u00a0bgp\u00a0vpnv4\u00a0unicast\u00a010.0.101.1/32\u00a0vrf\u00a0TEST:L3VRF\nshow\u00a0interface\u00a0|\u00a0grep\u00a0-E\u00a0\"Ethernet1|MTU\"\nshow\u00a0isis\u00a0dteps\u00a0vrf\u00a0overlay-1\nvsh_lc\u00a0-c\u00a0\"show\u00a0system\u00a0internal\u00a0epm\u00a0endpoint\u00a0ip\u00a010.12.2.11\"\nvsh_lc\u00a0-c\u00a0\"show\u00a0system\u00a0internal\u00a0epm\u00a0endpoint\u00a0mac\u00a000:50:56:8A:20:00\"\nvsh_lc\u00a0-c\u00a0\"show\u00a0system\u00a0internal\u00a0epm\u00a0vrf\u00a0TEST:L3VRF\u00a0detail\"\n</code></pre></p> <p>DHCP Relay</p> <pre><code>show\u00a0ip\u00a0dhcp\u00a0relay\nshow\u00a0dhcp\u00a0internal\u00a0info\u00a0relay\u00a0address\u00a0interface\u00a0vlan\u00a0XX\nshow\u00a0dhcp\u00a0internal\u00a0info\u00a0relay\u00a0discover\nshow\u00a0dhcp\u00a0internal\u00a0errors\nshow\u00a0dhcp\u00a0internal\u00a0event-history\u00a0traces\n</code></pre>"},{"location":"cisco/Cisco_ACI/#apic-api","title":"APIC API","text":"<p>python</p> <pre><code>import requests\nimport os\n\nusername = os.environ.get('USERNAME')\npassword = os.environ.get('PASSWORD')\nhostname = 'apic1.hackernet.se'\n\n# Build payload with userid/password and create a session object\npayload = {\"aaaUser\": {\"attributes\": {\"name\": username, \"pwd\" : password }}}\nsession = requests.session()\n\n# Issue the login request. The cookie will be stored in session.cookies.\nlogin_url = f'https://{hostname}/api/aaaLogin.json'\nresponse = session.post(login_url, json=payload, verify=False)\n\n# Use the session object to get ACI objects\nif response.ok:\n    response = session.get(f'https://{hostname}/api/node/class/fvTenant.json', verify=False)\nelse:\n    print(f\"HTTP Error {response.status_code}:{response.reason} occurred.\")\n</code></pre> <p>curl Login and save to COOKIE <pre><code>curl\u00a0-s\u00a0-k\u00a0-d\u00a0\"`&lt;aaaUser name=admin pwd=password/&gt;`\"\u00a0-c\u00a0COOKIE\u00a0-X\u00a0POST\u00a0https://10.0.0.11/api/mo/aaaLogin.xml\n</code></pre> Get tenants xml <pre><code>curl\u00a0-s\u00a0-k\u00a0-X\u00a0GET\u00a0https://10.0.0.11/api/node/class/fvTenant.xml\u00a0-b\u00a0COOKIE\u00a0|\u00a0xmllint\u00a0--format\u00a0-\n</code></pre></p> <p>Post xml from file <pre><code>curl\u00a0-s\u00a0-k\u00a0-X\u00a0POST\u00a0-d\u00a0@xml2aci.xml\u00a0https://10.0.0.11/api/mo/uni.xml\u00a0-b\u00a0COOKIE\n</code></pre> Default Authentication Domain</p> <p>Om man har t.ex. radius eller tacacs som default authentication realm men vill \u00e4nd\u00e5 kunna logga in med lokala konton s\u00e5 m\u00e5ste man ange det mha sitt username vid login. <pre><code>API: apic\\#fallback\\\\\\\\username\nSSH: apic\\#fallback\\\\\\\\username\nGUI: apic:fallback\\\\\\\\username\n</code></pre> Collecting Metrics - Example</p> <p></p>"},{"location":"cisco/Cisco_ASA/","title":"Cisco ASA","text":"<p>Adaptive Security Appliance \u00e4r Ciscos VPN- och brandv\u00e4ggsenhet. Detta \u00e4r skrivet f\u00f6r 8.4 och senare. H\u00e5rdvara och mjukvara kompatibilitet</p>"},{"location":"cisco/Cisco_ASA/#konfiguration","title":"Konfiguration","text":"<p>Grunder</p> <p><code>conf\u00a0t</code> <code>hostname\u00a0ASA</code></p> <p>IP adress</p> <p><code>int\u00a0e0/0</code> <code>mac-address\u00a00011.2233.4455</code> <code>security-level\u00a0100</code> <code>nameif\u00a0inside</code> <code>ip\u00a0address\u00a010.0.0.1\u00a0255.255.255.0</code> <code>no\u00a0shut</code></p> <p>Default route och DNS</p> <p><code>route\u00a0outside\u00a00.0.0.0\u00a00.0.0.0\u00a0190.10.160.1\u00a01</code> <code>same-security-traffic\u00a0permit\u00a0inter-interface</code> <code>dns\u00a0domain-lookup\u00a0outside</code> <code>dns\u00a0name-server\u00a08.8.8.8</code></p>"},{"location":"cisco/Cisco_ASA/#asdm","title":"ASDM","text":"<p>ASDM \u00e4r en javamjukvara man kan anv\u00e4nda f\u00f6r GUI till ASA.</p> <p><code>asdm\u00a0image\u00a0disk0:/asdm-752.bin</code> <code>show\u00a0asdm\u00a0image</code></p> <p>Sl\u00e5 p\u00e5 det och vitlista IP/n\u00e4t som f\u00e5r ansluta.</p> <p><code>http\u00a0server\u00a0enable</code> <code>http\u00a010.0.0.0\u00a0255.255.255.0\u00a0inside</code></p> <p>Skapa anv\u00e4ndare s\u00e5 att det g\u00e5r att logga in. Peka autentisering mot lokal databas.</p> <p><code>username\u00a0admin\u00a0password\u00a0cisco\u00a0privilege\u00a015</code> <code>aaa\u00a0authentication\u00a0http\u00a0console\u00a0LOCAL</code></p>"},{"location":"cisco/Cisco_ASA/#ssh","title":"SSH","text":"<p><code>ssh\u00a010.0.0.0\u00a0255.255.255.0\u00a0inside</code> <code>ssh\u00a0timeout\u00a060</code> <code>ssh\u00a0version\u00a02</code> <code>aaa\u00a0authentication\u00a0ssh\u00a0console\u00a0LOCAL</code> <code>domain-name\u00a0inhouse.local</code> <code>crypto\u00a0key\u00a0generate\u00a0rsa\u00a0modulus\u00a02048</code></p>"},{"location":"cisco/Cisco_ASA/#mgmt-vrf","title":"Mgmt VRF","text":"<p>Man kan sedan 9.5 l\u00e4gga management-interface i en egen routingtabell.</p> <p><code>int\u00a0gi0/1</code> <code>management-only</code> <code>show\u00a0route\u00a0management-only</code> <code>show\u00a0asp\u00a0table\u00a0routing\u00a0management-only</code></p>"},{"location":"cisco/Cisco_ASA/#management-access","title":"Management access","text":"<p>Vill man managera sin brandv\u00e4gg genom en VPN-tunnel m\u00e5ste man komplettera ssh/http-kommandon med:</p> <p><code>management-access\u00a0inside</code></p>"},{"location":"cisco/Cisco_ASA/#upgrade","title":"Upgrade","text":"<p><code>copy</code><code>http://</code><code>&lt;webbserver.se&gt;/filer/asa952-smp-k8.bin\u00a0disk0:/</code> <code>boot\u00a0system\u00a0disk0:/asa952-smp-k8.bin</code> <code>show\u00a0bootvar</code> <code>wr</code> <code>reload</code></p>"},{"location":"cisco/Cisco_ASA/#reset","title":"Reset","text":"<p><code>clear\u00a0configure\u00a0all</code> <code>crypto\u00a0key\u00a0zeroize\u00a0rsa</code></p> <p>Setup basic firewall</p> <p><code>configure\u00a0factory-default</code></p>"},{"location":"cisco/Cisco_ASA/#diverse","title":"Diverse","text":"<p>ICMP-inspection Default s\u00e5 \u00e4r inte icmp-inspection p\u00e5slaget.</p> <p><code>fixup\u00a0protocol\u00a0icmp</code></p> <p>Alternativt</p> <p><code>policy-map\u00a0global_policy</code> <code>class\u00a0inspection_default</code> <code>inspect\u00a0icmp</code></p> <p>Traceroute Till\u00e5t traceroute genom en ASA</p> <p><code>access-list\u00a0ACL\u00a0extended\u00a0permit\u00a0icmp\u00a0any\u00a0any\u00a0time-exceeded</code> <code>access-list\u00a0ACL\u00a0extended\u00a0permit\u00a0icmp\u00a0any\u00a0any\u00a0unreachable</code></p> <p>Accelerated Security Path</p> <p><code>show\u00a0asp\u00a0drop</code> <code>capture\u00a0asp-drop\u00a0type\u00a0asp-drop\u00a0all</code> <code>show\u00a0capture\u00a0asp-drop</code></p> <p>ARP Inspection Static entries</p> <p><code>arp\u00a0inside\u00a0193.10.161.37\u00a00c0c.0c0c.0c03\u00a0alias</code> <code>---</code></p> <p>Botnet Filtering</p> <p><code>#k\u00f6p\u00a0licens</code> <code>#Enable\u00a0DNS\u00a0Client</code></p> <p>NTP</p> <p><code>clock\u00a0timezone\u00a0CEST\u00a01\u00a00</code> <code>clock\u00a0summer-time\u00a0CEDT\u00a0recurring\u00a0last\u00a0Sun\u00a0Mar\u00a02:00\u00a0last\u00a0Sun\u00a0Oct\u00a03:00\u00a060</code> <code>ntp\u00a0server\u00a094.199.180.200\u00a0source\u00a0outside</code> <code>show\u00a0ntp\u00a0status</code></p> <p>uRPF</p> <p><code>ip\u00a0verify\u00a0reverse-path\u00a0interface\u00a0outside</code> <code>show\u00a0run\u00a0ip\u00a0verify\u00a0reverse-path</code></p> <p>Logging</p> <p><code>logging\u00a0enable</code> <code>logging\u00a0console\u00a04</code></p> <p>Om man k\u00f6r syslog med TCP s\u00e5 slutar ASA:n att forwarda trafik om anslutning till syslog-servern tappas, \u00e4ndra detta.</p> <p><code>logging\u00a0permit-hostdown</code></p> <p>Jumbo Frames</p> <p><code>jumbo\u00a0frame-reservation</code> <code>mtu\u00a0inside\u00a09000</code> <code>mtu\u00a0outside\u00a09000</code></p> <p>Global Timeouts</p> <p><code>timeout\u00a0xlate\u00a010:00:00</code> <code>timeout\u00a0uauth\u00a010:00:00\u00a0absolute</code> <code>timeout\u00a0uauth\u00a009:00:00\u00a0inactivity</code></p> <p>Certificate Management</p> <p><code>show\u00a0crypto\u00a0ca\u00a0certificate</code> <code>(config)\u00a0crypto\u00a0ca\u00a0export</code> <code>show\u00a0crypto\u00a0key\u00a0mypubkey\u00a0rsa</code></p> <p>Permanent Self-Signed Certificate</p> <p><code>crypto\u00a0ca\u00a0trustpoint\u00a0ASDM_TrustPoint0</code> <code>id-usage\u00a0ssl-ipsec</code> <code>no\u00a0fqdn</code> <code>subject-name\u00a0CN=ASA</code> <code>enrollment\u00a0self</code> <code>crypto\u00a0ca\u00a0enroll\u00a0ASDM_TrustPoint0\u00a0noconfirm</code></p>"},{"location":"cisco/Cisco_ASA/#snmp","title":"SNMP","text":"<p><code>snmp-server\u00a0host\u00a0inside\u00a010.0.0.50\u00a0community\u00a0PUBLIC\u00a0version\u00a02c</code> <code>show\u00a0snmp-server\u00a0oidlist\u00a0\u00a0\u00a0#\"hidden\u00a0command\"</code></p> <p>Se \u00e4ven Cisco SNMP.</p>"},{"location":"cisco/Cisco_ASA/#dhcp","title":"DHCP","text":"<p>Cisco DHCP</p>"},{"location":"cisco/Cisco_ASA/#klient","title":"Klient","text":"<p><code>int\u00a0e0/0</code> <code>ip\u00a0address\u00a0dhcp\u00a0setroute</code> <code>exit</code> <code>dhcp-client\u00a0client-id\u00a0interface\u00a0outside</code></p>"},{"location":"cisco/Cisco_ASA/#server","title":"Server","text":"<p><code>dhcpd\u00a0address\u00a010.0.0.50-10.0.0.60\u00a0inside</code> <code>dhcpd\u00a0enable\u00a0inside</code> <code>dhcpd\u00a0dns\u00a08.8.8.8\u00a0interface\u00a0inside</code></p> <p>OBS ASA doesn't respond to unicast dhcp requests</p>"},{"location":"cisco/Cisco_ASA/#relay","title":"Relay","text":"<p><code>dhcprelay\u00a0server\u00a0192.168.10.11\u00a0inside</code> <code>dhcprelay\u00a0enable\u00a0DMZ</code></p> <p>Verify</p> <p><code>show\u00a0dhcpd\u00a0state</code></p>"},{"location":"cisco/Cisco_ASA/#nat","title":"NAT","text":"<p>Se \u00e4ven Cisco NAT.</p>"},{"location":"cisco/Cisco_ASA/#pat","title":"PAT","text":"<p><code>nat\u00a0(inside,outside)\u00a01\u00a0source\u00a0dynamic\u00a0any\u00a0interface</code></p>"},{"location":"cisco/Cisco_ASA/#dynamic","title":"Dynamic","text":"<p><code>object\u00a0network\u00a0outside-pool</code> <code>range\u00a0193.10.161.190\u00a0193.10.161.199</code> <code>object\u00a0network\u00a0inside_10</code> <code>subnet\u00a010.0.0.0\u00a0255.255.255.0</code> <code>nat\u00a0(inside,any)\u00a0dynamic\u00a0outside-pool</code></p>"},{"location":"cisco/Cisco_ASA/#static","title":"Static","text":"<p><code>object\u00a0network\u00a0dmz_global</code> <code>host\u00a0193.10.161.31</code> <code>object\u00a0network\u00a0dmz_server</code> <code>host\u00a0172.16.0.5</code> <code>nat\u00a0(dmz,outside)\u00a0static\u00a0dmz_global</code></p>"},{"location":"cisco/Cisco_ASA/#exempt","title":"Exempt","text":"<p><code>object\u00a0network\u00a0LAN1</code> <code>subnet\u00a01.1.1.0\u00a0255.255.255.0</code> <code>object\u00a0network\u00a0LAN2</code> <code>subnet\u00a02.2.2.0\u00a0255.255.255.0</code> <code>nat\u00a0(inside,outside)\u00a01\u00a0source\u00a0static\u00a0LAN1\u00a0LAN1\u00a0destination\u00a0static\u00a0LAN2\u00a0LAN2</code></p> <p>1an \u00e4r viktig s\u00e5 att regeln hamnar f\u00f6rst</p> <p>Verify</p> <p><code>show\u00a0run\u00a0nat</code> <code>show\u00a0nat\u00a0proxy-arp</code></p>"},{"location":"cisco/Cisco_ASA/#port-forwarding","title":"Port Forwarding","text":"<p><code>object\u00a0network\u00a0websrv</code> <code>host\u00a010.1.1.3</code> <code>nat\u00a0(inside,outside)\u00a0static\u00a0interface\u00a0service\u00a0tcp\u00a080\u00a080</code> <code>exit</code> <code>access-list\u00a0outside_access_in\u00a0permit\u00a0tcp\u00a0any\u00a0object\u00a0websrv\u00a0eq\u00a0http</code></p>"},{"location":"cisco/Cisco_ASA/#acl","title":"ACL","text":"<p><code>access-list\u00a0ACL1\u00a0permit\u00a0tcp\u00a0any\u00a0object\u00a0dmz_server\u00a0eq\u00a0http</code> <code>access-list\u00a0ACL1\u00a0line\u00a015\u00a0permit\u00a0tcp\u00a0any\u00a0object\u00a0dmz_server\u00a0eq\u00a0https</code> <code>access-group\u00a0ACL1\u00a0in\u00a0interface\u00a0outside</code> <code>show\u00a0access-list\u00a0ACL1</code></p> <p>Matcha p\u00e5 DNS-namn</p> <p><code>object\u00a0network\u00a0hackernet.se</code> <code>fqdn\u00a0v4\u00a0hackernet.se</code></p>"},{"location":"cisco/Cisco_ASA/#routing","title":"Routing","text":"<p>Se \u00e4ven Cisco Routing.</p>"},{"location":"cisco/Cisco_ASA/#static_1","title":"Static","text":"<p><code>route\u00a0inside\u00a010.0.1.0\u00a0255.255.255.0\u00a0{next\u00a0hop\u00a0address}\u00a010</code></p>"},{"location":"cisco/Cisco_ASA/#ospf","title":"OSPF","text":"<p><code>router\u00a0ospf\u00a01</code> <code>area\u00a01</code> <code>network\u00a010.0.0.0\u00a0255.255.255.0\u00a0area\u00a01</code></p>"},{"location":"cisco/Cisco_ASA/#rip","title":"RIP","text":"<p><code>router\u00a0rip</code> <code>no\u00a0auto-summary</code> <code>version\u00a02</code> <code>network\u00a010.0.0.0</code></p>"},{"location":"cisco/Cisco_ASA/#eigrp","title":"EIGRP","text":"<p><code>router\u00a0eigrp\u00a01</code> <code>network\u00a010.0.0.0\u00a0255.255.255.0</code></p>"},{"location":"cisco/Cisco_ASA/#bgp","title":"BGP","text":"<p>Ska man k\u00f6ra BGP genom en ASA m\u00e5ste man st\u00e4nga av att TCP option 19 strippas vilket det g\u00f6r default. Samt m\u00e5ste TCP sequence number randomization st\u00e4ngas av.</p> <p><code>access-list\u00a0BGP\u00a0extended\u00a0permit\u00a0tcp\u00a0any\u00a0eq\u00a0bgp\u00a0any</code> <code>access-list\u00a0BGP\u00a0extended\u00a0permit\u00a0tcp\u00a0any\u00a0any\u00a0eq\u00a0bgp</code> <code>tcp-map\u00a0BGP</code> <code>tcp-options\u00a0range\u00a019\u00a019\u00a0allow</code> <code>class-map\u00a0BGP</code> <code>match\u00a0access-list\u00a0BGP</code> <code>policy-map\u00a0global_policy</code> <code>class\u00a0BGP</code> <code>set\u00a0connection\u00a0advanced-options\u00a0BGP</code> <code>set\u00a0connection\u00a0random-sequence-number\u00a0disable</code></p>"},{"location":"cisco/Cisco_ASA/#modular-policy-framework","title":"Modular Policy Framework","text":"<p>Application Inspection</p> <p><code>access-list\u00a0dmz_ftp\u00a0permit\u00a0tcp\u00a0any\u00a0any\u00a0eq\u00a0ftp</code></p> <p>Class Map</p> <p><code>class-map\u00a0FTP-class-MAP</code> <code>match\u00a0access-list\u00a0dmz_ftp</code></p> <p>Policy Map</p> <p><code>policy-map\u00a0FTP-policy-MAP</code> <code>class\u00a0FTP-class-MAP</code> <code>inspect\u00a0ftp</code></p> <p>Service Policy</p> <p><code>service-policy\u00a0FTP-policy-MAP\u00a0interface\u00a0dmz</code></p>"},{"location":"cisco/Cisco_ASA/#qos","title":"QoS","text":"<p><code>priority-queue\u00a0inside</code></p> <p>Class Map</p> <p><code>class-map\u00a0VOIP</code> <code>match\u00a0dscp\u00a046</code></p> <p>Policy Map</p> <p><code>policy-map\u00a0inside-policy</code> <code>class\u00a0VOIP</code> <code>priority</code></p> <p>Service Policy</p> <p><code>service-policy\u00a0inside-policy\u00a0interface\u00a0inside</code></p> <p>Se \u00e4ven Cisco QoS.</p>"},{"location":"cisco/Cisco_ASA/#tweaking-connections","title":"Tweaking Connections","text":"<p><code>access-list\u00a0ACL1\u00a0permit\u00a0tcp\u00a0any\u00a0object\u00a0dmz_server\u00a0eq\u00a0http</code> <code>class-map\u00a0TCP-Sessions</code> <code>match\u00a0access-list\u00a0ACL1</code> <code>policy-map\u00a0Conn-Limits</code> <code>class\u00a0TCP-Sessions</code> <code>set\u00a0connection\u00a0conn-max\u00a0500\u00a0embryonic-conn-max\u00a050</code> <code>set\u00a0connection\u00a0timeout\u00a0embryonic\u00a00:05:00\u00a0half-closed\u00a00:10:00</code> <code>service-policy\u00a0Conn-Limits\u00a0interface\u00a0outside</code></p>"},{"location":"cisco/Cisco_ASA/#tcp-intercept","title":"TCP Intercept","text":"<p><code>access-list\u00a0ACL1\u00a0permit\u00a0tcp\u00a0any\u00a0object\u00a0dmz_server\u00a0eq\u00a0http</code> <code>class-map\u00a0no-syn-flood-class</code> <code>match\u00a0access-list\u00a0ACL1</code> <code>policy-map\u00a0NO-SYN-FLOOD</code> <code>class\u00a0no\u00a0syn-flood-class</code> <code>set\u00a0connection\u00a0embryonic-conn-max\u00a050</code> <code>service-policy\u00a0NO-SYN-FLOOD\u00a0interface\u00a0outside</code></p>"},{"location":"cisco/Cisco_ASA/#advanced-application-inspection-http","title":"Advanced Application Inspection - HTTP","text":"<p><code>policy-map\u00a0type\u00a0inspect\u00a0http\u00a0http-inspect-pmap</code> <code>parameters</code> <code>protocol-violation\u00a0action\u00a0dropconnection\u00a0log</code> <code>match\u00a0req-resp\u00a0content-type\u00a0mismatch</code> <code>drop-connection\u00a0log</code> <code>policy-map\u00a0global_policy</code> <code>class\u00a0inspection_default</code> <code>inspect\u00a0http\u00a0http-inspect-pmap</code></p>"},{"location":"cisco/Cisco_ASA/#vlan-5505","title":"VLAN - !5505","text":"<p><code>int\u00a0e0/2</code> <code>no\u00a0shut</code> <code>int\u00a0e0/2.10</code> <code>vlan\u00a010</code> <code>security-level\u00a0100</code> <code>nameif\u00a0VLAN10</code> <code>ip\u00a0add\u00a010.0.10.1\u00a0255.255.255.0</code> <code>no\u00a0shut</code> <code>exit</code></p>"},{"location":"cisco/Cisco_ASA/#etherchannel","title":"EtherChannel","text":"<p>Se \u00e4ven Cisco EtherChannel.</p> <p><code>interface\u00a0e0/2</code> <code>channel-group\u00a0mode\u00a0Active</code> <code>interface\u00a0e0/3</code> <code>channel-group\u00a0mode\u00a0Active</code> <code>interface\u00a0port-channel1</code> <code>port-channel\u00a0load-balance\u00a0src-port</code> <code>port-channel\u00a0min-bundle\u00a01</code> <code>lacp\u00a0max-bundle\u00a08</code> <code>duplex\u00a0auto</code> <code>speed\u00a0auto</code> <code>nameif\u00a0DMZ</code> <code>security-level\u00a050</code> <code>ip\u00a0add\u00a010.0.10.1\u00a0255.255.255.0</code> <code>no\u00a0shut</code></p>"},{"location":"cisco/Cisco_ASA/#redundancy","title":"Redundancy","text":"<p>Samma som etherchannel fast endast ett ben \u00e4r aktivt i taget. Anv\u00e4ndbart om asan \u00e4r kopplad till 2 switchar utan MLAG (t.ex. vPC).</p> <p><code>interface\u00a0e0/4</code> <code>no\u00a0shut</code> <code>interface\u00a0e0/5</code> <code>no\u00a0shut</code> <code>interface\u00a0redundant1</code> <code>member\u00a0interface\u00a0e0/4</code> <code>member\u00a0interface\u00a0e0/5</code> <code>nameif\u00a0outside</code> <code>security-level</code> <code>ip\u00a0address\u00a0193.10.161.31</code> <code>no\u00a0shut</code></p>"},{"location":"cisco/Cisco_ASA/#transparent-5505","title":"Transparent - 5505","text":"<p><code>firewall\u00a0transparent</code> <code>int\u00a0BVI\u00a01</code> <code>ip\u00a0add\u00a0193.10.161.38\u00a0255.255.255.0</code> <code>exit</code> <code>int\u00a0e0/0</code> <code>switchport\u00a0access\u00a0vlan\u00a01</code> <code>no\u00a0shut</code> <code>int\u00a0e0/1</code> <code>switchport\u00a0access\u00a0vlan\u00a02</code> <code>no\u00a0shut</code> <code>interface\u00a0vlan\u00a01</code> <code>security-level\u00a0100</code> <code>nameif\u00a0inside</code> <code>bridge-group\u00a01</code> <code>no\u00a0shut</code> <code>interface\u00a0vlan\u00a02</code> <code>security-level\u00a00</code> <code>nameif\u00a0outside</code> <code>bridge-group\u00a01</code> <code>no\u00a0shut</code></p>"},{"location":"cisco/Cisco_ASA/#aaa","title":"AAA","text":"<p><code>aaa-server\u00a0OUR-GROUP\u00a0protocol\u00a0radius</code> <code>aaa-server\u00a0OUR-GROUP\u00a0(inside)\u00a0host\u00a010.0.0.50</code> <code>key\u00a0********</code> <code>radius-common-pw\u00a0*********</code> <code>exit</code></p>"},{"location":"cisco/Cisco_ASA/#cut-through-user-aaa","title":"Cut-through User AAA","text":"<p><code>access-list\u00a0outside_authentication\u00a0permit\u00a0tcp\u00a0any\u00a0object\u00a0dmz-server\u00a0eq\u00a0http</code> <code>username\u00a0bob\u00a0password\u00a0cisco\u00a0priv\u00a02</code> <code>username\u00a0bob\u00a0attributes</code> <code>service-type\u00a0remote-access</code> <code>exit</code> <code>aaa\u00a0authentication\u00a0match\u00a0outside_authentication\u00a0outside\u00a0LOCAL</code></p>"},{"location":"cisco/Cisco_ASA/#failover","title":"Failover","text":"<p><code>#Criteria</code> <code>ASA1</code> <code>int\u00a0e0/0</code> <code>ip\u00a0address\u00a0193.10.161.38\u00a0255.255.254.0\u00a0standby\u00a0193.10.161.39</code> <code>int\u00a0e0/1</code> <code>ip\u00a0address\u00a010.0.0.1\u00a0255.255.255.0\u00a0standby\u00a010.0.0.2</code> <code>failover\u00a0lan\u00a0interface\u00a0Fail-1\u00a0e0/3</code> <code>failover\u00a0interface\u00a0ip\u00a0Fail-1\u00a010.1.1.1\u00a0255.255.255.252\u00a0standby\u00a010.1.1.2</code> <code>failover\u00a0key\u00a0cisco</code> <code>failover\u00a0link\u00a0Fail-2\u00a0e0/4</code> <code>failover\u00a0interface\u00a0ip\u00a0Fail-2\u00a010.2.2.1\u00a0255.255.255.252\u00a0standby\u00a010.2.2.2</code> <code>failover\u00a0replication\u00a0http</code> <code>failover\u00a0lan\u00a0unit\u00a0primary</code> <code>failover\u00a0mac\u00a0address\u00a0e0/0\u00a00000.1111.2222\u00a00000.3333.4444</code> <code>failover</code></p> <p><code>ASA2</code> <code>int\u00a0e0/3</code> <code>no\u00a0shut</code> <code>exit</code> <code>failover\u00a0lan\u00a0interface\u00a0Fail-1\u00a0e0/3</code> <code>failover\u00a0interface\u00a0ip\u00a0Fail-1\u00a010.1.1.1\u00a0255.255.255.252\u00a0standby\u00a010.1.1.2</code> <code>failover\u00a0key\u00a0cisco</code> <code>failover\u00a0lan\u00a0unit\u00a0secondary</code> <code>failover</code></p>"},{"location":"cisco/Cisco_ASA/#virtual-firewall","title":"Virtual Firewall","text":"<p><code>mode\u00a0multiple</code> <code>changeto\u00a0context\u00a0admin</code> <code>changeto\u00a0system</code> <code>mac-address\u00a0auto</code> <code>class\u00a0silver</code> <code>limit\u00a0resource\u00a0asdm\u00a03</code> <code>context\u00a0newcontext</code> <code>member\u00a0silver</code> <code>allocate-interface\u00a0e0/3</code> <code>allocate-interface\u00a0e0/4</code> <code>config-url\u00a0disk0:/newcontext.cfg</code></p> <p>Save in all contexts</p> <p><code>wr\u00a0mem\u00a0all</code></p>"},{"location":"cisco/Cisco_ASA/#activeactive-failover","title":"Active/Active Failover","text":"<p><code>changeto\u00a0system</code> <code>prompt\u00a0hostname\u00a0priority</code> <code>failover\u00a0group\u00a01</code> <code>primary</code> <code>preempt\u00a0120</code> <code>exit</code> <code>failover\u00a0group\u00a02</code> <code>secondary</code> <code>preempt\u00a0120</code> <code>exit</code> <code>context\u00a0Ctx-1</code> <code>join-failover-group\u00a01</code> <code>exit</code> <code>context\u00a0Ctx-2</code> <code>join-failover-group\u00a02</code> <code>exit</code> <code>int\u00a0e0/4</code> <code>no\u00a0shut</code> <code>int\u00a0e0/5</code> <code>no\u00a0shut</code> <code>exit</code> <code>failover\u00a0lan\u00a0unit\u00a0primary</code> <code>failover\u00a0lan\u00a0interface\u00a0Fail-1\u00a0e0/4</code> <code>failover\u00a0interface\u00a0ip\u00a0Fail-1\u00a010.1.1.1\u00a0255.255.255.252\u00a0standby\u00a010.1.1.2</code> <code>failover\u00a0link\u00a0Fail-2\u00a0e0/4</code> <code>failover\u00a0interface\u00a0ip\u00a0Fail-2\u00a010.2.2.1\u00a0255.255.255.252\u00a0standby\u00a010.2.2.2</code> <code>failover</code></p> <p><code>int\u00a0e0/3</code> <code>no\u00a0shut</code> <code>exit</code> <code>failover\u00a0lan\u00a0unit\u00a0secondary</code> <code>failover\u00a0lan\u00a0interface\u00a0Fail-1\u00a0e0/3</code> <code>failover\u00a0interface\u00a0ip\u00a0Fail-1\u00a010.1.1.1\u00a0255.255.255.252\u00a0standby\u00a010.1.1.2</code> <code>failover</code></p>"},{"location":"cisco/Cisco_ASA/#sla","title":"SLA","text":"<p><code>route\u00a0outside\u00a00.0.0.0\u00a00.0.0.0\u00a01.1.1.1\u00a01\u00a0track\u00a01</code> <code>sla\u00a0monitor\u00a010</code> <code>type\u00a0echo\u00a0protocol\u00a0ipIcmpEcho\u00a01.1.1.1\u00a0interface\u00a0outside</code> <code>num-packets\u00a03</code> <code>frequency\u00a05</code> <code>sla\u00a0monitor\u00a0schedule\u00a010\u00a0life\u00a0forever\u00a0start-time\u00a0now</code> <code>track\u00a01\u00a0rtr\u00a010\u00a0reachability</code></p>"},{"location":"cisco/Cisco_ASA/#vpn","title":"VPN","text":"<p>Se ASA VPN</p>"},{"location":"cisco/Cisco_ASA/#rest-api","title":"REST API","text":"<p>Man kan l\u00e4gga till en agent s\u00e5 att ASAn f\u00e5r ett REST API.</p> <p><code>copy</code><code>http://</code><code>/asa-restapi-122-lfbff-k8.SPA\u00a0disk0:</code> <code>rest-api\u00a0image\u00a0disk0:/asa-restapi-122-lfbff-k8.SPA</code> <code>rest-api\u00a0agent</code> <p>Sedan beh\u00f6ver webbservern konfigureras om inte det \u00e4r gjort, se ASDM</p> <p>Anv\u00e4nd en REST-klient (Firefox/Chrome)</p> <p><code>https:</code><code>/api/objects/networkobjects</code>"},{"location":"cisco/Cisco_ASA/#docs","title":"Docs","text":"<p>F\u00f6ljer med agenten</p> <p><code>https://</code><code>/doc/</code> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_ASA_VPN/","title":"Cisco ASA VPN","text":"<p>Huvudartikel: Cisco ASA. Se \u00e4ven Cisco IPsec.</p>"},{"location":"cisco/Cisco_ASA_VPN/#site-to-site","title":"Site-to-site","text":""},{"location":"cisco/Cisco_ASA_VPN/#policy-based","title":"Policy-Based","text":"<p>F\u00f6ruts\u00e4ttningar f\u00f6r att s\u00e4tta upp VPN-tunnlar \u00e4r att klocka m\u00e5ste g\u00e5 r\u00e4tt och att NAT-regler m\u00e5ste ligga i r\u00e4tt ordning.</p> <p>Kolla hur man g\u00f6r p\u00e5 aktuell version</p> <p><code>vpnsetup\u00a0site-to-site\u00a0steps</code> <code>vpnsetup\u00a0ipsec-remote-access\u00a0steps</code></p>"},{"location":"cisco/Cisco_ASA_VPN/#fas-1","title":"Fas 1","text":"<p><code>crypto\u00a0isakmp\u00a0policy\u00a010</code> <code>authentication\u00a0pre-share</code> <code>encryption\u00a0aes-256</code> <code>hash\u00a0sha</code> <code>lifetime\u00a028800</code> <code>group\u00a02</code></p> <p>PSK</p> <p><code>tunnel-group</code><code>type\u00a0ipsec-l2l</code> <code>tunnel-group</code><code>ipsec-attributes</code> <code>ikev1\u00a0pre-shared-key\u00a0*****</code> <code>crypto\u00a0map\u00a0VPNMAP\u00a010\u00a0set\u00a0peer</code> <p>Visa befintlig PSK</p> <p><code>more\u00a0system:running-config\u00a0|\u00a0i\u00a0pre-shared-key|tunnel-group</code> <code>tunnel-group\u00a01.3.3.7\u00a0type\u00a0ipsec-l2l</code> <code>tunnel-group\u00a01.3.3.7\u00a0ipsec-attributes</code> <code>ikev1\u00a0pre-shared-key\u00a0hemlignyckeln2000</code></p>"},{"location":"cisco/Cisco_ASA_VPN/#fas-2","title":"Fas 2","text":"<p><code>crypto\u00a0ipsec\u00a0ikev1\u00a0transform-set\u00a0SITE2-FAS2\u00a0esp-aes-256\u00a0esp-sha-hmac</code> <code>crypto\u00a0map\u00a0VPNMAP\u00a010\u00a0set\u00a0transform-set\u00a0SITE2-FAS2</code> <code>access-list\u00a0CRYPTO-to-SITE2\u00a0extended\u00a0permit\u00a0ip\u00a0172.16.20.0\u00a0255.255.255.0\u00a0172.16.40.0\u00a0255.255.255.0</code> <code>crypto\u00a0map\u00a0VPNMAP\u00a010\u00a0match\u00a0address\u00a0CRYPTO-to-SITE2</code> <code>crypto\u00a0map\u00a0VPNMAP\u00a010\u00a0set\u00a0security-association\u00a0lifetime\u00a0seconds\u00a03600</code> <code>crypto\u00a0map\u00a0VPNMAP\u00a010\u00a0set\u00a0pfs\u00a0group5</code></p> <p>F\u00f6ljande steg beh\u00f6ver endast g\u00f6ras vid f\u00f6rsta VPN-tunnelupps\u00e4ttningen.</p> <p><code>crypto\u00a0map\u00a0VPNMAP\u00a0interface\u00a0OUTSIDE</code> <code>crypto\u00a0ikev1\u00a0enable\u00a0OUTSIDE</code></p>"},{"location":"cisco/Cisco_ASA_VPN/#nat-exempt","title":"NAT Exempt","text":"<p><code>object\u00a0network\u00a0LAN1</code> <code>subnet\u00a0172.16.20.0\u00a0255.255.255.0</code> <code>object\u00a0network\u00a0LAN2</code> <code>subnet\u00a0172.16.40.0\u00a0255.255.255.0</code> <code>nat\u00a0(inside,outside)\u00a01\u00a0source\u00a0static\u00a0LAN1\u00a0LAN1\u00a0destination\u00a0static\u00a0LAN2\u00a0LAN2</code></p>"},{"location":"cisco/Cisco_ASA_VPN/#route-based","title":"Route-Based","text":"<p>I ASA version 9.7 inplementerades st\u00f6d f\u00f6r route-based vpn med tunnel interface. F\u00f6r IKEv2 kr\u00e4vs minst version 9.8.1!</p> <p>Tunnel interface har ingen security level.</p> <p>IKEv2 beh\u00e5ller inte riktigt nomenklaturen med faser men \u00e4nd\u00e5.</p>"},{"location":"cisco/Cisco_ASA_VPN/#fas-1_1","title":"Fas 1","text":"<p><code>crypto\u00a0ikev2\u00a0policy\u00a05</code> <code>encryption\u00a0aes-256</code> <code>integrity\u00a0sha256</code> <code>group\u00a019</code> <code>prf\u00a0sha256</code> <code>lifetime\u00a0seconds\u00a086400</code></p> <p>PSK</p> <p><code>tunnel-group\u00a01.2.3.4\u00a0type\u00a0ipsec-l2l</code> <code>tunnel-group\u00a01.2.3.4\u00a0ipsec-attributes</code> <code>ikev2\u00a0remote-authentication\u00a0pre-shared-key\u00a0hemlig123</code> <code>ikev2\u00a0local-authentication\u00a0pre-shared-key\u00a0hemlig123</code></p>"},{"location":"cisco/Cisco_ASA_VPN/#fas-2_1","title":"Fas 2","text":"<p><code>crypto\u00a0ipsec\u00a0ikev2\u00a0ipsec-proposal\u00a0IKEV2-PROPOSAL01</code> <code>protocol\u00a0esp\u00a0encryption\u00a0aes-256</code> <code>protocol\u00a0esp\u00a0integrity\u00a0sha-256</code></p> <p><code>crypto\u00a0ipsec\u00a0profile\u00a0IKEV2-PROFILE01</code> <code>set\u00a0ikev2\u00a0ipsec-proposal\u00a0IKEV2-PROPOSAL01</code> <code>set\u00a0pfs\u00a0group19</code> <code>set\u00a0security-association\u00a0lifetime\u00a0seconds\u00a03600</code></p> <p>F\u00f6ljande steg beh\u00f6ver endast g\u00f6ras vid f\u00f6rsta VPN-tunnelupps\u00e4ttningen. crypto ikev2 enable OUTSIDE</p>"},{"location":"cisco/Cisco_ASA_VPN/#tunnel-interface","title":"Tunnel interface","text":"<p><code>interface\u00a0Tunnel5</code> <code>nameif\u00a0VPN-TUNNEL5</code> <code>ip\u00a0address\u00a0169.254.2.1\u00a0255.255.255.0</code> <code>tunnel\u00a0source\u00a0interface\u00a0OUTSIDE</code> <code>tunnel\u00a0destination\u00a01.2.3.4</code> <code>tunnel\u00a0mode\u00a0ipsec\u00a0ipv4</code> <code>tunnel\u00a0protection\u00a0ipsec\u00a0profile\u00a0IKEV2-PROFILE01</code></p> <p>Routa det som finns p\u00e5 andra sidan tunneln:</p> <p><code>route\u00a0VPN-TUNNEL5\u00a010.10.10.0\u00a0255.255.255.0\u00a0169.254.253.1</code></p> <p>Next-hop kan vara vad som d\u00e5 en next-hop kr\u00e4vs (namnet p\u00e5 interface som styr).</p>"},{"location":"cisco/Cisco_ASA_VPN/#nat","title":"NAT","text":"<p>Tunnel interface ej g\u00e5r att v\u00e4lja som interface i NAT f\u00e5r man se till att inte g\u00f6ra NAT Exempt som policy-based. Detta d\u00e5 trafiken l\u00e4mnar ASAn via tunnel interface och ej utsidan tex OUTSIDE.</p>"},{"location":"cisco/Cisco_ASA_VPN/#access","title":"Access","text":"<p>Antingen kan man till\u00e5ta trafik in fr\u00e5n andra sidan genom att l\u00e5ta ASAn automatiskt l\u00e4gga till allow regler f\u00f6r allt som det byggs tunnel f\u00f6r (inklusive ssl vpn) annars kan man styra det med outside-aclen (f\u00f6r tunnel interface acl per tunnel). Kolla om autoregler \u00e4r p\u00e5slaget:</p> <p><code>show\u00a0run\u00a0all\u00a0|\u00a0i\u00a0permit-vpn</code></p> <p>Notera att autoregler \u00e4r p\u00e5slaget som standard. St\u00e4ng av autoregel f\u00f6r vpn:</p> <p><code>no\u00a0sysopt\u00a0connection\u00a0permit-vpn</code></p> <p>Till\u00e5t trafik in fr\u00e5n andra sidan med hj\u00e4lp av ACL: Policy-based</p> <p><code>access-list\u00a0OUTSIDE-IN\u00a0extended\u00a0permit\u00a0ip\u00a0object\u00a0LAN2\u00a0object\u00a0LAN1</code></p> <p>Route-based</p> <p><code>access-list\u00a0ACL-VPN-TUNNEL5\u00a0extended\u00a0permit\u00a0ip\u00a0object\u00a0LAN2\u00a0object\u00a0LAN1</code> <code>access-group\u00a0ACL-VPN-TUNNEL5\u00a0in\u00a0interface\u00a0VPN-TUNNEL5</code></p> <p>Troubleshoot</p> <p><code>show\u00a0crypto\u00a0isakmp\u00a0sa\u00a0detail</code> <code>show\u00a0crypto\u00a0ipsec\u00a0sa</code> <code>show\u00a0vpn-sessiondb\u00a0detail\u00a0l2l</code></p> <p>Reverse route Reverse route injection (RRI) till\u00e5ter att det installeras static routes f\u00f6r det som finns p\u00e5 andra sidan av tunneln i routingtabellen n\u00e4r tunneln blir aktiv. Kan t.ex. anv\u00e4ndas om man vill redistribuera VPN-routes till ett routingprotokoll.</p> <p><code>crypto\u00a0map\u00a0VPNMAP\u00a010\u00a0set\u00a0reverse-route</code></p>"},{"location":"cisco/Cisco_ASA_VPN/#remote-access","title":"Remote Access","text":""},{"location":"cisco/Cisco_ASA_VPN/#anyconnect","title":"AnyConnect","text":"<p>AnyConnect SSL split tunnel Objekt och pool</p> <p><code>ip\u00a0local\u00a0pool\u00a0AnyConnect-Pool\u00a0172.20.0.51-172.20.0.100\u00a0mask\u00a0255.255.255.0</code> <code>object\u00a0network\u00a0VPN_POOL</code> <code>subnet\u00a0172.20.0.0\u00a0255.255.255.0</code></p> <p>ACL</p> <p><code>access-list\u00a0AnyConnect-SplitTunnel\u00a0standard\u00a0permit\u00a010.0.0.0\u00a0255.255.255.0\u00a0\u00a0#\u00a0LAN</code> <code>access-list\u00a0OUTSIDE-V1\u00a0remark\u00a0-----\u00a0Allow\u00a0AnyConnect\u00a0to\u00a0LAN</code> <code>access-list\u00a0OUTSIDE-V1\u00a0extended\u00a0permit\u00a0ip\u00a0object\u00a0VPN_POOL\u00a0object\u00a0LAN</code></p> <p>Enable anyconnect</p> <p><code>webvpn</code> <code>enable\u00a0OUTSIDE</code> <code>anyconnect\u00a0image\u00a0disk0:/anyconnect-win-3.1.10010-k9.pkg\u00a01</code> <code>anyconnect\u00a0enable</code> <code>tunnel-group-list\u00a0enable</code> <code>cache</code> <code>disable</code> <code>error-recovery\u00a0disable</code></p> <p>Group policy</p> <p><code>group-policy\u00a0GroupPolicy_Hackernet\u00a0internal</code> <code>group-policy\u00a0GroupPolicy_Hackernet\u00a0attributes</code> <code>wins-server\u00a0none</code> <code>dns-server\u00a0value\u00a010.0.0.10</code> <code>vpn-tunnel-protocol\u00a0ssl-client</code> <code>split-tunnel-policy\u00a0tunnelspecified</code> <code>split-tunnel-network-list\u00a0value\u00a0AnyConnect-SplitTunnel</code> <code>default-domain\u00a0value\u00a0hackernet.se</code></p> <p>Tunnel group</p> <p><code>tunnel-group\u00a0Hackernet\u00a0type\u00a0remote-access</code> <code>tunnel-group\u00a0Hackernet\u00a0general-attributes</code> <code>address-pool\u00a0AnyConnect-Pool</code> <code>default-group-policy\u00a0GroupPolicy_Hackernet</code> <code>tunnel-group\u00a0Hackernet\u00a0webvpn-attributes</code> <code>group-alias\u00a0Hackernet\u00a0enable</code></p> <p>no nat</p> <p><code>nat\u00a0(INSIDE,OUTSIDE)\u00a05\u00a0source\u00a0static\u00a0any\u00a0any\u00a0destination\u00a0static\u00a0VPN_POOL\u00a0VPN_POOL\u00a0no-proxy-arp\u00a0route-lookup</code></p> <p>Skapa lokala users</p> <p><code>username\u00a0juan\u00a0password\u00a0cisco</code> <code>username\u00a0juan\u00a0attributes</code> <code>service-type\u00a0remote-access</code> <code>vpn-group-policy\u00a0GroupPolicy_Hackernet</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_BFD/","title":"Cisco BFD","text":"<p>Bidirectional Forwarding Detection (RFC 5880) \u00e4r ett protokoll som \u00e4r framtaget f\u00f6r att snabbt kunna uppt\u00e4cka problem med paketf\u00f6rmedling mellan tv\u00e5 grannar. Det \u00e4r fr\u00e5n b\u00f6rjan utvecklat av Cisco och Juniper. Det \u00e4r helt oberoende av vilken topologi, media eller routing-protokoll som anv\u00e4nds. Olika typer av kontrollplansprotokoll kan utnyttja BFD-protokollets feldetektering. Genom snabb feldetektering kan olika kontrollplansprotokoll agera p\u00e5 ett problem snabbare. BFD \u00e4r en viktig komponent f\u00f6r att s\u00e4nka konvergenstider (recovery) inom ett n\u00e4tverk. Det har en gemensam interface-down-event-detection-mekanism som andra protokoll kan utnyttja f\u00f6r sin feldetektering, exempel p\u00e5 detta \u00e4r routingprotokollen (\u00e4ven IS-IS som inte \u00e4r IP-baserat), PIM, HSRP och MPLS pseudowires. Samtidigt som det \u00e4r mindre CPU-kr\u00e4vande \u00e4n andra tekniker f\u00f6r feldetektering, t.ex. det traditionella att skicka och behandla Hello-paket.</p> <p>Beroende p\u00e5 IOS-version finns det st\u00f6d f\u00f6r BFD forwarding p\u00e5 point-to-point IPv4, IPv6 och GRE-tunnlar. Det \u00e4r ej supporterat p\u00e5 VTI och det b\u00f6r ej k\u00f6ras p\u00e5 virtual-template eller dialer interfaces. BFD-paket matchar ej p\u00e5 QoS-policy f\u00f6r self-generated packets. BFD \u00e4r alltid unicast och CEF \u00e4r ett krav p\u00e5 de inblandade enheterna.</p>"},{"location":"cisco/Cisco_BFD/#paket","title":"Paket","text":"<p>Control packet</p> <p></p> <p>Echo packet</p>"},{"location":"cisco/Cisco_BFD/#konfiguration","title":"Konfiguration","text":"<p>BFD finns i version 0 och 1. Den st\u00f6rsta skillnaden \u00e4r att version 1 st\u00f6djer echo mode, se nedan. Cisco IOS k\u00f6r version 1 default och kan inte konfigureras att k\u00f6ra version 0, men \u00e4r bak\u00e5tkompatibel med det ifall det kommer in v0-paket fr\u00e5n n\u00e5gon annan. BFD kan k\u00f6ras i asynchronous mode eller demand mode men IOS s\u00e4tter alltid Demand bit till 0.</p> <p>Aktivera Ange tr\u00f6skelv\u00e4rden per interface, detta m\u00e5ste g\u00f6ras innan BFD kan anv\u00e4ndas eftersom det inte finns n\u00e5gra default (OBS ip unnumbered interfaces st\u00f6ds ej). Dessa v\u00e4rden j\u00e4mf\u00f6rs med andra sidan och de beh\u00f6ver inte matcha utan de h\u00f6gsta v\u00e4rdena \u00e4r de som anv\u00e4nds. (Den f\u00f6rsta 50 \u00e4r min_tx)</p> <p><code>interface\u00a0gi2</code> <code>bfd\u00a0interval\u00a050\u00a0min_rx\u00a050\u00a0multiplier\u00a03</code></p> <p>Sedan m\u00e5ste man registrera det protokoll som ska dra nytta av BFD. Detta g\u00f6rs per protokoll, se t.ex. BFD-konfiguration f\u00f6r HSRP, OSPF och BGP. Det \u00e4r p\u00e5 s\u00e5 s\u00e4tt BFD f\u00e5r reda p\u00e5 vad andra sidan har f\u00f6r adress s\u00e5 ett grannskap \u00e4r m\u00f6jligt. Efter att detta \u00e4r gjort drar BFD ig\u00e5ng och uppr\u00e4ttar grannskap. Om andra sidan inte har slagit p\u00e5 BFD kommer varje BFD Control message besvaras med en ICMP (Type 3) Destination Unreachable och grannskapet f\u00f6rblir Down.</p> <p>Verifiera genom att kolla grannskap och vilka protokoll som utnyttjar BFD.</p> <p><code>show\u00a0bfd\u00a0neighbors</code> <code>show\u00a0bfd\u00a0neighbors\u00a0details\u00a0|\u00a0i\u00a0Registered</code> <code>show\u00a0bfd\u00a0summary\u00a0client</code></p> <p>Fels\u00f6k</p> <p><code>show\u00a0monitor\u00a0event\u00a0cef\u00a0bfd\u00a0all</code> <code>show\u00a0bfd\u00a0drops</code> <code>debug\u00a0bfd\u00a0event</code> <code>debug\u00a0bfd\u00a0packet</code></p> <p>IPv6, vissa plattformar har problem med att BFD-sessioner \u00f6ver IPv6 g\u00e5r ner med j\u00e4mna mellanrum. En workaround f\u00f6r detta \u00e4r att s\u00e4tta automatisk refresh av ND-cachen.</p> <p><code>interface\u00a0gi2</code> <code>ipv6\u00a0nd\u00a0cache\u00a0expire\u00a0120\u00a0refresh</code></p> <p>Avaktivera Man kan \u00e4ven avaktivera BFD per interface utan att ta bort konfigurationen, d\u00e5 skickas fem Control messages med code Admin Down till andra sidan.</p> <p><code>interface\u00a0gi2</code> <code>ip\u00a0ospf\u00a0bfd\u00a0disable</code></p> <p></p> <p>Admin Down</p>"},{"location":"cisco/Cisco_BFD/#echo-mode","title":"Echo mode","text":"<p>Om andra sidan \u00e4r l\u00e5ngsam p\u00e5 att svara pga \u00f6verlastad CPU s\u00e4tter BFD interfacet som down fast det inte \u00e4r det. Vill man slippa detta kan man h\u00f6ja timers men d\u00e5 f\u00f6rsvinner meningen med BFD. F\u00f6r att l\u00f6sa det kan man anv\u00e4nda Echo mode, d\u00e5 kommer inte BFD-paketen att g\u00e5 till andra sidans CPU utan v\u00e4nda direkt p\u00e5 interfacet (i ASIC:en). Detta \u00e4r default p\u00e5 Cisco-enheter. Eftersom echo-paket som inte p\u00e5verkar CPUn anv\u00e4nds f\u00f6r feldetektering beh\u00f6vs inte BFD-kontrollpaketen skickas lika ofta. Detta g\u00e5r att st\u00e4lla manuellt med slow-timers och p\u00e5verkar inte hur ofta echos skickas. BFD control packets \u00e4r UDP fr\u00e5n 49152 till 3784 som kan skickas multihop. Echo packets \u00e4r UDP till 3785 och fungerar endast single hop.</p> <p><code>bfd\u00a0slow-timers</code> <code>show\u00a0bfd\u00a0neighbors\u00a0details</code> <p>St\u00e4ng av echo mode p\u00e5 ett interface, inga BFD-echos skickas eller forwardas. ip redirects beh\u00f6vdes st\u00e4ngas av f\u00f6rr f\u00f6r echo mode men det \u00e4r inte ett krav l\u00e4ngre. Om man k\u00f6r Unicast Reverse Path Forwarding p\u00e5 ett interface m\u00e5ste man st\u00e4nga av echo mode eftersom echo packets rejectas av uRPF och grannskapet kommer att flappa kontinuerligt.</p> <p><code>no\u00a0bfd\u00a0echo</code></p> <p>BFD kan k\u00f6ras i b\u00e5de mjukvara och h\u00e5rdvara.</p> <p><code>show\u00a0bfd\u00a0neighbors\u00a0details\u00a0|\u00a0i\u00a0Session\u00a0Host</code> <code>show\u00a0bfd\u00a0neighbors\u00a0hardware</code></p>"},{"location":"cisco/Cisco_BFD/#template","title":"Template","text":"<p>Man kan skapa en template som man sedan anv\u00e4nder p\u00e5 alla interface. D\u00e5 kan man anv\u00e4nda authentication och dampening samt f\u00e5 st\u00f6d f\u00f6r microsekunder.</p> <p><code>bfd-template\u00a0single-hop\u00a0BACKBONE</code> <code>interval\u00a0microseconds\u00a0min-tx\u00a050000\u00a0min-rx\u00a050000\u00a0multiplier\u00a03</code> <code>authentication\u00a0sha-1\u00a0keychain\u00a0BFD</code> <code>dampening\u00a010\u00a01000\u00a01000\u00a010</code></p> <p><code>interface\u00a0Gi2</code> <code>bfd\u00a0template\u00a0BACKBONE</code></p> <p>Verify</p> <p><code>show\u00a0bfd\u00a0neighbors\u00a0dampening</code> <code>show\u00a0bfd\u00a0neighbors\u00a0dampened</code></p>"},{"location":"cisco/Cisco_BFD/#static-routes","title":"Static routes","text":"<p>BFD g\u00e5r faktiskt att anv\u00e4nda med static routes, man m\u00e5ste bara ber\u00e4tta vilken next-hop som ska monitoreras. I associated mode associeras den statiska routen med den statiska BFD-grannen om routens next-hop matchar den. I unassociated mode kommer alltid grannen att requesta en BFD-session om interfacet har BFD-konfiguration, detta \u00e4r anv\u00e4ndbart om det inte finns n\u00e5gon static route \u00e4n.</p> <p><code>ip\u00a0route\u00a0static\u00a0bfd\u00a0gi2\u00a01.1.1.1\u00a0[unassociate]</code> <code>ip\u00a0route\u00a010.0.0.0\u00a0255.255.255.0\u00a0gi2\u00a01.1.1.1</code></p> <p><code>show\u00a0ip\u00a0static\u00a0route</code></p>"},{"location":"cisco/Cisco_BFD/#ebgp-multihop","title":"EBGP Multihop","text":"<p><code>bfd-template\u00a0multi-hop\u00a0MH</code> <code>interval\u00a0both\u00a0250\u00a0multiplier\u00a03</code></p> <p><code>bfd\u00a0map\u00a0ipv4\u00a02.2.2.2/32\u00a01.1.1.1/32\u00a0MH</code></p> <p><code>router\u00a0bgp\u00a01</code> <code>neighbor\u00a02.2.2.2\u00a0fall-over\u00a0bfd\u00a0multi-hop</code></p> <p>strict-mode - Grannskapet g\u00e5r inte upp om inte BFD lyckas, dvs hold down neighbor session tills BFD session \u00e4r uppe.</p>"},{"location":"cisco/Cisco_BFD/#nx-os","title":"NX-OS","text":"<p>Det mesta av ovan g\u00e4ller Nexus-switchar ocks\u00e5 (med eventuell syntaxskillnad) men det finns funktioner som \u00e4r unika. BFD timers kan konfas globalt och det finns default-v\u00e4rden, 50ms x 3. P\u00e5 vissa linjekort kan man st\u00e4lla intervall ner till 15ms.</p> <p><code>feature\u00a0bfd</code></p> <p><code>bfd\u00a0interval\u00a050\u00a0min_rx\u00a050\u00a0multiplier\u00a03</code></p> <p><code>router\u00a0ospf\u00a01</code> <code>bfd</code></p> <p>ICMP/ICMPv6 redirects b\u00f6r st\u00e4ngas av p\u00e5 de interface (\u00e4ven SVI:er) d\u00e4r man k\u00f6r BFD.</p> <p><code>interface\u00a0e1/1</code> <code>no\u00a0ip\u00a0redirects</code> <code>no\u00a0ipv6\u00a0redirects</code></p> <p>Subinterface BFD uppr\u00e4ttar ju sessioner p\u00e5 alla subinterface som \u00e4r konfade med BFD men man kan optimera det. Det subinterface med l\u00e4gst vlan id blir master och kommer att anv\u00e4nda huvudinterfacets inst\u00e4llningar medans \u00f6vriga subinterface k\u00f6r med slow timers. Om master f\u00e5r BFD timeout s\u00e5 markeras alla subinterface som down av BFD. Detta funkar endast mellan Cisco NX-OS devices och konfas p\u00e5 huvudinterfacet.</p> <p><code>interface\u00a0ethernet\u00a02/1</code> <code>bfd\u00a0optimize\u00a0subinterface</code></p> <p>Port Channel Detta \u00e4r ingen Nexus-specifik feature men p\u00e5 en L3 port channel kan NX-OS l\u00e5ta BFD uppr\u00e4tta session \u00f6ver varje fysisk l\u00e4nk som ing\u00e5r i LAG:en. Klienterna f\u00e5r det aggregerade resultatet dvs s\u00e5l\u00e4nge en l\u00e4nk \u00e4r uppe s\u00e5 rapporterar BFD att l\u00e4nken \u00e4r uppe. Man m\u00e5ste sl\u00e5 p\u00e5 LACP innan man enablear BFD.</p> <p><code>interface\u00a0port-channel\u00a020</code> <code>bfd\u00a0per-link</code></p>"},{"location":"cisco/Cisco_BFD/#ios-xr","title":"IOS-XR","text":"<p>NCS5500</p> <p><code>bfd\u00a0multipath\u00a0include\u00a0location\u00a00/0/CPU0</code></p> <p>OSPF</p> <p><code>router\u00a0ospf\u00a01</code> <code>bfd\u00a0minimum-interval\u00a0100</code> <code>bfd\u00a0fast-detect</code> <code>bfd\u00a0multiplier\u00a03</code></p> <p>Verify</p> <p><code>show\u00a0bfd\u00a0session</code></p>"},{"location":"cisco/Cisco_BGP/","title":"Cisco BGP","text":"<p>Border Gateway Protocol (RFC 4271) \u00e4r ett path vector routing protokoll. Det kommunicerar p\u00e5 TCP port 179 s\u00e5 routing m\u00e5ste vara p\u00e5 plats, man kan n\u00e4stan se det som ett L4-protokoll. TCP tillhandah\u00e5ller acknowledgement, retransmission, sequencing och update fragmentation. BGP kan f\u00e5 m\u00e5nga v\u00e4gar till samma destination. B\u00e4sta v\u00e4gen v\u00e4ljs utifr\u00e5n en \u00f6k\u00e4nd algoritm. Den b\u00e4sta pathen markeras valid/best och blir en kandidat till routingtabellen. Om next hop inte \u00e4r reachable s\u00e5 blir aldrig en route best. Se \u00e4ven BGP Multicast och ExaBGP.</p> <p>Type: Path Vector</p> <p>AD: 20, 200</p> <p>Protocols: IP</p> <p>Packets: 5</p>"},{"location":"cisco/Cisco_BGP/#pakettyper","title":"Pakettyper","text":"<p>OPEN: F\u00f6rsta paketet som skickas av varje sida anv\u00e4nds f\u00f6r att uppr\u00e4tta grannskap, inneh\u00e5ller grundl\u00e4ggande parametrar och capabilities.</p>   Exempel:    [](/File:Cisco_BGP_Open.PNG \"wikilink\")   <p>UPDATE: En update inneh\u00e5ller routinginformation. Varje NLRI skickas endast en g\u00e5ng.</p>   Exempel:    [](/File:Cisco_BGP_Update.PNG \"wikilink\")   <p>NOTIFICATION: Errormeddelanden, kan skickas f\u00f6r att starta om ett grannskap. F\u00f6r alla error codes se IANAs lista</p>   Exempel:    [](/File:Cisco_BGP_Notification.PNG \"wikilink\")   <p>KEEPALIVE: Skickas regelbundet f\u00f6r att s\u00e4kerst\u00e4lla att grannen lever. Peers m\u00e5ste komma \u00f6verens om holdtime f\u00f6r keepalives, default \u00e4r holdtime 180 sek och d\u00e5 skickas keepalives var 60 sek.</p>   Exempel:    [](/File:Cisco_BGP_Keepalive.PNG \"wikilink\")   <p>ROUTE REFRESH: (RFC 2918) B\u00e5da sidor m\u00e5ste st\u00f6dja denna capability.</p>   Exempel:    [](/File:Cisco_BGP_RouteRefresh.PNG \"wikilink\")"},{"location":"cisco/Cisco_BGP/#bgp-table","title":"BGP table","text":"<p>K\u00e4llor till BGP table:</p> <ul> <li>Network command</li> <li>BGP updates</li> <li>Redistribution</li> </ul> <p>Show BGP table</p> <p><code>show\u00a0ip\u00a0bgp</code> <code>show\u00a0bgp</code><code>unicast\u00a0update-sources</code>"},{"location":"cisco/Cisco_BGP/#path-selection","title":"Path Selection","text":"<p>Till skillnad fr\u00e5n IGPer anv\u00e4nds inte enbart metric f\u00f6r att avg\u00f6ra vilken som \u00e4r b\u00e4sta routen, ist\u00e4llet anv\u00e4nds ett g\u00e4ng Path Attributes f\u00f6r att komma fram till vad som ska annonseras vidare och installeras i routingtabellen. Dock sker ingen path selection f\u00f6r ogiltiga routes utan de ignoreras direkt (no valid next-hop, not synchronized, AS-looped). Kolla inkomna PA som inte st\u00f6ds: show ip bgp path-attribute discard|unknown</p> <p>Well Known ska st\u00f6djas av alla BGP-implementationer</p> Mandatory Discretionary AS Path Local Preference Next Hop Atomic Aggregate Origin <p>Allt som \u00e4r Mandatory m\u00e5ste alltid skickas med i varje uppdatering, det \u00e4r ej ett krav f\u00f6r Discretionary.</p> <p>Optional</p> Transitive Non transitive Aggregator MED Community Originator Cluster ID <p>Transitive betyder att PA ska forwarderas till andra \u00e4ven om routern sj\u00e4lv inte har st\u00f6d f\u00f6r just det PA. Nontransitive PA ska tas bort fr\u00e5n uppdateringar som l\u00e4mnar det egna AS.</p> <p>Path Selection Summary</p> Attribute Description Preferens Weight Administrativ H\u00f6gsta LOCAL_PREF Skickas mellan peers inom AS H\u00f6gsta Self-originated Prefer paths originated locally AS_PATH Minimize AS hops Kortast ORIGIN Prefer IGP-learned routes over unknown IGP MED Used externally to enter an AS L\u00e4gsta External Prefer eBGP routes over iBGP (AD) eBGP IGP Cost Consider IGP metric to NEXT_HOP L\u00e4gsta eBGP Peering Favor more stable routes \u00c4ldsta Router ID Sista tie breaker L\u00e4gsta <p>Best path selection Det finns m\u00e5nga s\u00e4tt att \u00e4ndra BGPs beteende med avseende p\u00e5 path selection.</p> <p>St\u00e4nga av att oldest path kan ge best route. Compare router-id for identical EBGP paths</p> <p><code>bgp\u00a0bestpath\u00a0compare-routerid</code></p> <p>St\u00e4nga av att AS path length kollas. OBS detta \u00e4r ett dolt kommando.</p> <p><code>bgp\u00a0bestpath\u00a0as-path\u00a0ignore</code></p> <p>Ignore cost IGP metric in bestpath selection</p> <p><code>bgp\u00a0bestpath\u00a0igp-metric\u00a0ignore</code></p> <p>Ignore cost communities in bestpath selection</p> <p><code>bgp\u00a0bestpath\u00a0cost-community\u00a0ignore</code></p> <p>Allow comparing MED from different neighbors</p> <p><code>bgp\u00a0always-compare-med</code></p> <p>Treat missing MED as the least preferred one</p> <p><code>bgp\u00a0bestpath\u00a0med\u00a0missing-as-worst</code></p> <p>Compare MED among confederation paths</p> <p><code>bgp\u00a0bestpath\u00a0med\u00a0confed</code></p> <p>Pick the best-MED path among paths advertised from the neighboring AS</p> <p><code>bgp\u00a0deterministic-med</code></p>"},{"location":"cisco/Cisco_BGP/#multipath","title":"Multipath","text":"<p>Maximum Paths Flera paths kan hamna i routingtabellen men endast best path kan annonseras vidare (om inte add-path anv\u00e4nds). Default \u00e4r EN path till skillnad fr\u00e5n andra routingprotokoll. Default m\u00e5ste allt upp till IGP Cost vara lika f\u00f6r att maximum paths ska spela n\u00e5gon roll. Inte alla topologier st\u00f6djer multipath. bgp bestpath as-path multipath-relax anv\u00e4nds f\u00f6r att m\u00f6jligg\u00f6ra ECMP genom olika AS, detta \u00e4r ett dolt kommando.</p> <p><code>router\u00a0bgp\u00a0100</code> <code>maximum-paths\u00a04\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0#eBGP</code> <code>maximum-paths\u00a0ibgp\u00a04\u00a0\u00a0\u00a0#iBGP</code> <code>maximum-paths\u00a0eibgp\u00a04\u00a0\u00a0#MPLS</code></p> <p>Additional Paths Med iBGP kan man anv\u00e4nda add-paths. Syftet \u00e4r att tillhandah\u00e5lla en backup route f\u00f6r snabbare konvergering. Det \u00e4r en capability som skickas med i open message per adressfamilj. Add-paths l\u00e4gger p\u00e5 ett unikt Path ID p\u00e5 varje prefix f\u00f6r att det ska kunna g\u00e5 att skilja p\u00e5 dem. F\u00f6r att det ska funka m\u00e5ste next-hop p\u00e5 backup path skilja sig fr\u00e5n det p\u00e5 primary path.</p> <p>Det g\u00e5r att konfigurera per adressfamilj eller per neighbor.</p> <p><code>router\u00a0bgp\u00a0100</code> <code>bgp\u00a0additional-paths\u00a0select\u00a0all</code> <code>neighbor\u00a01.1.1.1\u00a0additional-paths\u00a0send\u00a0receive</code> <code>neighbor\u00a01.1.1.1\u00a0advertise\u00a0additional-paths\u00a0all</code></p> <p><code>show\u00a0ip\u00a0route\u00a0repair-paths</code></p> <p>Man kan v\u00e4lja additional paths och skicka vidare dem utan att installera det i RIB/FIB lokalt.</p> <p><code>bgp\u00a0additional-paths\u00a0install</code></p> <p>Diverse Path Diverse-Path s\u00e4ger \u00e5t en BGP-router att medvetet ber\u00e4kna en 2nd-best path som har en annan next hop som den f\u00f6rsta pathen. Diverse-Path var en workaround innan Add-Path var supporterat. Det g\u00f6rs endast p\u00e5 route reflector. Diverse-Path \u00e4r ej supporterat i IOS-XR.</p> <p><code>router\u00a0bgp\u00a01</code> <code>address-family\u00a0vpnv4\u00a0unicast</code> <code>maximum-paths\u00a02</code> <code>bgp\u00a0bestpath\u00a0igp-metric\u00a0ignore</code> <code>bgp\u00a0additional-paths\u00a0select\u00a0backup</code> <code>bgp\u00a0additional-paths\u00a0install</code> <code>neighbor\u00a0IBGP\u00a0advertise\u00a0diverse-path\u00a0backup</code></p>"},{"location":"cisco/Cisco_BGP/#konfiguration","title":"Konfiguration","text":"<p>F\u00f6r att byta fr\u00e5n NLRI-format till AFI-format i konfigurationen</p> <p><code>bgp\u00a0upgrade-cli</code></p> <p>Administrative Distance: eBGP, iBGP, local. Det g\u00e5r \u00e4ndra distance per granne ocks\u00e5 med distance-kommandot och en acl.</p> <p><code>distance\u00a0bgp\u00a020\u00a0200\u00a0200</code></p> <p>Synchronization is disabled by default in Cisco IOS post 12.2(8)T. Synchronization b\u00f6r vara avst\u00e4ngt annars medf\u00f6ljer vissa begr\u00e4nsningar. T.ex. m\u00e5ste routes finnas i IGP innan det kan propagera vidare med BGP och OSPF RID m\u00e5ste vara samma som BGP RID om sync \u00e4r p\u00e5.</p> <p><code>no\u00a0synchronization</code></p> <p>IPv4 aktiveras default i BGP p\u00e5 IOS men det g\u00e5r att st\u00e4nga av.</p> <p><code>no\u00a0bgp\u00a0default\u00a0ipv4-unicast</code></p>"},{"location":"cisco/Cisco_BGP/#neighbor","title":"Neighbor","text":"<p>F\u00f6r att kunna utbyta routinginformation m\u00e5ste grannskap uppr\u00e4ttas, detta g\u00f6rs med en TCP-anslutning som det skickas BGP-meddelanden \u00f6ver. eBGP har TTL satt till 1 p\u00e5 alla BGP-paket som skickas ut, detta g\u00e5r att \u00e4ndra med ebgp-multihop. iBGP har inga s\u00e5dana begr\u00e4nsningar utan skickar med TTL 255. eBGP byter \u00e4ven next-hop p\u00e5 den NLRI som kommer in, dock inte om next-hop finns i samma subn\u00e4t som en sj\u00e4lv. eBGP kan inte initiera peering med hj\u00e4lp av en default route.</p> <p>States BGP har en finite state machine vilket betyder att grannskap kan befinna sig i olika tillst\u00e5nd. TCP Idle State: ConnectRetry timer 120 sekunder Active State: BGP speaker f\u00f6rs\u00f6ker n\u00e5 peer med TCP Connect State: TCP session established BGP OpenSent State: BGP version, AS number, hold time, BGP ID. B\u00f6rja skicka keepalives OpenConfirm State: Response recieved Established State: Skicka uppdateringar. Neighbor up Om ett grannskap \u00e4r iBGP eller eBGP avg\u00f6rs med remote-as som antingen \u00e4r samma AS som en sj\u00e4lv eller ett annat. Default accepteras all NLRI fr\u00e5n eBGP-grannar, s\u00e5 fungerar ej IOS XR.</p> <p><code>router\u00a0bgp\u00a065000</code> <code>neighbor\u00a01.1.1.1\u00a0remote-as\u00a065001</code> <code>neighbor\u00a01.1.1.1\u00a0description\u00a0Other\u00a0side</code> <code>neighbor\u00a0fe80::a00:27ff:fe80:7008%GigabitEthernet1\u00a0remote-as\u00a065001</code></p> <p>When configuring iBGP always use loopbacks (advertised by your IGP) for peering.</p> <p><code>neighbor\u00a01.1.1.1\u00a0update-source\u00a0Loopback0</code></p> <p>md5 authentication g\u00f6rs med tcp option 19</p> <p><code>neighbor\u00a01.1.1.1\u00a0password\u00a0SECRET</code> <code>show\u00a0ip\u00a0bgp\u00a0neighbors\u00a01.1.1.1\u00a0|\u00a0i\u00a0state|Flags</code></p> <p>Man kan konfigurera intervallet mellan uppdateringar till grannar d\u00e4r 0 \u00e4r annonsera direkt. Default \u00e4r 0 sek f\u00f6r iBGP, 0 sek f\u00f6r eBGP i en VRF och 30 sek f\u00f6r eBGP-sessioner i default-vrfen.</p> <p><code>neighbor\u00a01.1.1.1\u00a0advertise-interval</code> <p>Verify</p> <p><code>show\u00a0ip\u00a0bgp\u00a0neighbor</code> <code>show\u00a0ip\u00a0bgp\u00a0summary</code> <code>show\u00a0tcp\u00a0brief</code></p> <p>Debug</p> <p><code>debug\u00a0ip\u00a0bgp\u00a0events</code></p>"},{"location":"cisco/Cisco_BGP/#peer-group","title":"Peer Group","text":"<p>F\u00f6r att f\u00f6renkla konfen kan man gruppera flera grannar som ska ha likadan konfiguration i s\u00e5 kallade peer groups. Det blir \u00e4ven lite effektivare processing eftersom identiska Updates skickas till alla peers i gruppen. Man kan ju ha olika out policy per grannskap och d\u00e5 funkar inte identiska Updates till alla men IOS l\u00f6ser detta automatiskt genom att skapa fler update groups dynamiskt.</p> <p><code>neighbor\u00a0GROUP01\u00a0peer-group</code> <code>neighbor\u00a0GROUP01\u00a0remote-as\u00a0100\u00a0[alternate-as\u00a050000]</code> <code>neighbor\u00a0GROUP01\u00a0update-source\u00a0Loopback0</code> <code>neighbor\u00a01.1.1.1\u00a0peer-group\u00a0GROUP01</code> <code>neighbor\u00a02.2.2.2\u00a0peer-group\u00a0GROUP01</code></p> <p>Verify</p> <p><code>show\u00a0ip\u00a0bgp\u00a0peer-group</code> <code>show\u00a0ip\u00a0bgp\u00a0update-group</code> <code>show\u00a0ip\u00a0bgp\u00a0replication</code></p> <p>Eftersom peers kan svara segt (av n\u00e5gon anledning) finns det en dynamisk funktion f\u00f6r att splita peer-grupper och l\u00e4gga dessa i slow-update groups. When \u201cpermanent\u201d is not configured, the \u201cslow peer\u201d will be moved to its regular original update group, after it becomes regular peer (converges).</p> <p><code>bgp\u00a0slow-peer\u00a0split-update-group\u00a0dynamic</code> <code>show\u00a0ip\u00a0bgp\u00a0neighbors\u00a0slow</code></p> <p>Templates Det g\u00e5r \u00e4ven att skapa policy och session templates. Detta g\u00e5r tyv\u00e4rr ej att kombinera med bgp listen range eftersom den kopplas till en peer group.</p> <p><code>template\u00a0peer-session\u00a0RR</code> <code>remote-as\u00a0101</code> <code>password\u00a0SECRET</code> <code>update-source\u00a0Loopback0</code> <code>exit-peer-session</code></p> <p><code>template\u00a0peer-policy\u00a0RR</code> <code>route-reflector-client</code> <code>send-community\u00a0both</code> <code>additional-paths\u00a0send\u00a0receive</code> <code>exit-peer-policy</code></p> <p><code>neighbor\u00a01.1.1.1\u00a0inherit\u00a0peer-session\u00a0RR</code> <code>neighbor\u00a01.1.1.2\u00a0inherit\u00a0peer-session\u00a0RR</code></p> <p><code>address-family\u00a0vpnv4</code> <code>neighbor\u00a01.1.1.1\u00a0activate</code> <code>neighbor\u00a01.1.1.1\u00a0inherit\u00a0peer-policy\u00a0RR</code></p> <p>Verify</p> <p><code>show\u00a0ip\u00a0bgp\u00a0template\u00a0peer-session</code> <code>show\u00a0ip\u00a0bgp\u00a0template\u00a0peer-policy</code></p>"},{"location":"cisco/Cisco_BGP/#dynamic-peering","title":"Dynamic Peering","text":"<p>Det f\u00e5r ej finnas n\u00e5gra statiska neighbor statements n\u00e4r man anv\u00e4nder listen range.</p> <p><code>router\u00a0bgp\u00a0100</code> <code>bgp\u00a0listen\u00a0range\u00a010.1.123.0/24\u00a0peer-group\u00a0AS_200</code> <code>bgp\u00a0listen\u00a0limit\u00a015</code> <code>neighbor\u00a0AS_200\u00a0peer-group</code> <code>neighbor\u00a0AS_200\u00a0remote-as\u00a0200</code></p> <p><code>address-family\u00a0ipv4</code> <code>neighbor\u00a0AS_200\u00a0activate</code> <code>neighbor\u00a0AS_200\u00a0send-community\u00a0both</code></p>"},{"location":"cisco/Cisco_BGP/#route-refresh-vs-soft-reconfiguration","title":"Route Refresh vs Soft Reconfiguration","text":"<p>B\u00e5de Route Refresh och Soft Reconfiguration till\u00e5ter en router att \u00e4ndra sin routing policy utan att starta om grannskapet (Hard reset). Soft reset skickar route-refresh message f\u00f6r att beg\u00e4ra att all NLRI skickas igen medans Soft Reconfiguration lagrar all NLRI som kommer in fr\u00e5n grannen i en separat tabell (adj-ribs-in) f\u00f6r att kunna k\u00f6ra om policyn lokalt n\u00e4r man clearar. Blir minne korrupt \u00f6ver tiden kan det dock st\u00e4lla till problem. Soft Reconfiguration anv\u00e4nder mer minne medans Route Refresh anv\u00e4nder lite mer bandbredd. Route Refresh \u00e4r rekommenderat nuf\u00f6rtiden tack vare att bandbredd s\u00e4llan \u00e4r ett problem samt att de flesta enheter har st\u00f6d f\u00f6r det. Vill man spara minne men \u00e4nd\u00e5 ha tillg\u00e5ng till Adj-RIB-In f\u00e5r man anv\u00e4nda BMP (se BMP-stycket).</p> <p><code>show\u00a0ip\u00a0bgp\u00a0neighbors\u00a01.1.1.1\u00a0|\u00a0s\u00a0Neighbor\u00a0capabilities</code> <code>Neighbor\u00a0capabilities:</code> <code>Route\u00a0refresh:\u00a0advertised\u00a0and\u00a0received(new)</code></p> <p>Route Refresh \u00e4r en capability som finns i olika varianter och skickas i open message. Det IOS-XE kallar \"new\" decodar wireshark som \"Cisco\". En BGP-peer kan annonsera flera varianter.</p> <p> <p>Om en router inte har st\u00f6d f\u00f6r Route Refresh f\u00e5r Soft Reconfiguration anv\u00e4ndas. D\u00e5 m\u00e5ste man sl\u00e5 p\u00e5 det p\u00e5 grannskapet.</p> <p><code>neighbor\u00a01.1.1.1\u00a0soft-reconfiguration\u00a0inbound</code> <code>show\u00a0bgp\u00a0ipv4\u00a0unicast\u00a0neighbors\u00a01.1.1.1\u00a0policy</code></p> <p>Alternativt anv\u00e4nd soft reconfiguration som fallback om andra sidan inte st\u00f6djer route refresh.</p> <p><code>bgp\u00a0soft-reconfig-backup</code></p> <p>Kolla adj-ribs-in (alla prefix raw):</p> <p><code>show\u00a0ip\u00a0bgp\u00a0neighbors\u00a01.1.1.1\u00a0received-routes</code></p> <p>Oavsett om reset eller reconfiguration anv\u00e4nds s\u00e5 k\u00f6r man clear-kommandot f\u00f6r att g\u00f6ra det.</p> <p><code>clear\u00a0ip\u00a0bgp\u00a01.1.1.1\u00a0soft\u00a0[in]</code> <code>clear\u00a0ip\u00a0bgp\u00a0*\u00a0soft</code></p> <p>eBGP Multihop Ska man uppr\u00e4tta eBGP-grannskap om neighbor-IP ej \u00e4r directly connected, t.ex. mellan loopbacks, beh\u00f6ver man \u00f6ka TTLn p\u00e5 paketen som skickas ut.</p> <p><code>neighbor\u00a01.1.1.1\u00a0ebgp-multihop\u00a03</code></p> <p>Alternativt godta TTL 1 genom att st\u00e4nga av checken som kollar om grannen sitter p\u00e5 ett directly connected network genom att kolla routingtabellen. Grannen kan dock max vara ett hop bort f\u00f6r TTL \u00e4r 1 med detta alternativ.</p> <p><code>neighbor\u00a01.1.1.1\u00a0disable-connected-check</code></p> <p>TTL Security GTSM (RFC 3682) anv\u00e4nds f\u00f6r att skydda mot spoof attacks. Med GTSM (utan angiven \"hops\") lyssnar man bara p\u00e5 TCP/BGP-paket med ett TTL-f\u00e4lt p\u00e5 minst 254, det betyder att paketet inte kan ha routats och d\u00e4rmed inte kan komma ifr\u00e5n n\u00e5gon p\u00e5 internet utan endast fr\u00e5n n\u00e4rliggande granne, dvs den man peerar med. Notera att TTL security och eBGP multihop \u00e4r mutually exclusive. Detta g\u00e4ller endast f\u00f6r eBGP peers.</p> <p><code>neighbor\u00a02.2.2.2\u00a0ttl-security\u00a0hops\u00a010</code> <code>show\u00a0ip\u00a0bgp\u00a0neighbors\u00a02.2.2.2\u00a0|\u00a0i\u00a0TTL|hop</code></p> <p>T.ex. \"hops 10\" betyder att endast BGP-paket med TTL 245 eller h\u00f6gre kan accepteras.</p> <p>PMTUD F\u00f6rr i v\u00e4rlden sattes max data segment p\u00e5 BGPs TCP-session till 536 bytes men nu finns PMTUD default.</p> <p><code>bgp\u00a0transport\u00a0path-mtu-discovery</code> <code>show\u00a0ip\u00a0bgp\u00a0neighbor\u00a0|\u00a0i\u00a0Data|MTU|transport|MSS</code></p> <p>Turn off per neighbor</p> <p><code>neighbor\u00a0$PEER\u00a0transport\u00a0path-mtu-discovery\u00a0disable</code></p> <p>Multi Session TCP Multi Session TCP Transport per AF togs fram f\u00f6r att st\u00f6dja Multi Topology Routing. Multisession capability utbyts i OPEN message och indikerar att multisession BGP st\u00f6ds.</p> <p><code>neighbor\u00a01.1.1.1\u00a0transport\u00a0multi-session</code> <code>show\u00a0tcp\u00a0brief</code></p> <p>Passive Peer Kan t.ex. beh\u00f6vas om grannskap g\u00e5r igenom en brandv\u00e4gg. Default \u00e4r s\u00e5klart active.</p> <p><code>bgp\u00a0neighbor\u00a0transport\u00a0connection-mode\u00a0active/passive</code></p> <p>GRE Det g\u00e5r \u00e4ven att uppr\u00e4tta BGP-grannskap \u00f6ver GRE-tunnlar. Det \u00e4r dock viktigt att se till att next hop blir r\u00e4tt.</p>"},{"location":"cisco/Cisco_BGP/#next-hop","title":"Next Hop","text":"<p>\u00c4ndra s\u00e5 att annonserade uppdateringar har den egna IP-adressen (peer address) ist\u00e4llet f\u00f6r det som st\u00e5r i uppdateringen fr\u00e5n den granne man har l\u00e4rt sig prefixet av.</p> <p><code>neighbor\u00a010.0.0.10\u00a0next-hop-self</code></p> <p>Alternativt</p> <p><code>neighbor\u00a010.0.0.10\u00a0route-map\u00a0OUT</code> <code>route-map\u00a0OUT\u00a0permit\u00a010</code> <code>set\u00a0ip\u00a0next-hop\u00a0self\u00a0|\u00a0peer-address</code></p> <p>Route Reflector Server \u00e4ndrar inte next-hop n\u00e4r prefix skickas vidare till RR-klienter oavsett om man har konfigurerat next-hop-self eller en route-map. S\u00e4tt next-hop-self oavsett om det \u00e4r reflected routes.</p> <p><code>neighbor\u00a010.0.0.10\u00a0next-hop-self</code><code>all</code></p> <p>Det finns situationer d\u00e5 man k\u00f6r eBGP men vill att next-hop ej ska \u00e4ndras, t.ex. vid Inter-AS MPLS Option C.</p> <p><code>neighbor\u00a010.0.0.10\u00a0next-hop-unchanged</code></p>"},{"location":"cisco/Cisco_BGP/#4-byte-asn","title":"4 byte ASN","text":"<p>Fr\u00e5n b\u00f6rjan anv\u00e4ndes 2 bytes f\u00f6r ASN vilket ger 65535 stycken men det r\u00e4cker inte. Nyare routrar skickar AS_PATH som inneh\u00e5ller 4 bytes ASN men det blir inte bak\u00e5tkompatibelt s\u00e5 d\u00e4rf\u00f6r har det i RFC 5396 skapats nya optional transitive path attributes: AS4_PATH, AS4_AGGREGATOR och extended communities som kan anv\u00e4ndas f\u00f6r att b\u00e4ra den korrekta informationen igenom gamla enheter. 4 byte ASN en capability som listas i OPEN message. Ska en ny router i ett AS h\u00f6gre \u00e4n 65535 prata med en gammal router som inte har st\u00f6d f\u00f6r 4 byte ASN kan den \u00e4nd\u00e5 ta upp grannskapet men anv\u00e4nder d\u00e5 det reserverade ASN 23456 som kallas AS_TRANS. Alla 4 byte ASN kommer att skickas som AS4_PATH medans i AS_PATH kommer de att bytas ut mot detta 23456 s\u00e5 att \u00e4nd\u00e5 path length st\u00e4mmer. Om detta kommer till en ny router vid ett senare tillf\u00e4lle kan den s\u00e4tta ihop den korrekta as-pathen.</p> <p>Man kan konfigurera hur man vill att ASN ska presenteras i outputen fr\u00e5n show-kommandon.</p> <p><code>bgp\u00a0asnotation\u00a0dot</code></p>"},{"location":"cisco/Cisco_BGP/#diverse","title":"Diverse","text":"<p>N\u00e4r BGP startar v\u00e4ntas en specificerad tidsperiod f\u00f6r att grannarna ska etablera sig sj\u00e4lva innan de f\u00f6rsta uppdateringarna skickas. N\u00e4r perioden \u00e4r slut r\u00e4knas best path f\u00f6r varje prefix och detta annonseras. Detta f\u00f6rb\u00e4ttrar konvergeringstiden eftersom om det skickades uppdateringar direkt och det strax efter kom ny information och en annan best path hade det beh\u00f6vts skickas igen. Update-delay anv\u00e4nds f\u00f6r att konfigurera just denna tidsperiod, default \u00e4r 120 sekunder.</p> <p><code>bgp\u00a0update-delay</code> <p>Update-delay kan anv\u00e4ndas i kombination med graceful restart. Detta \u00e4r en capability som f\u00f6rhandlas mellan NSF-capable och NSF-aware peers i OPEN message n\u00e4r grannskap s\u00e4tts upp. En router som \u00e4r NSF-capable kan g\u00f6ra stateful switchover. BGP graceful restart \u00e4r p\u00e5 default n\u00e4r IOS st\u00f6djer det. Defaultv\u00e4rden som anv\u00e4nds om inget annat anges \u00e4r restart-time: 120 sekunder och stalepath-time: 360 sekunder.</p> <p><code>bgp\u00a0graceful-restart</code> <code>bgp\u00a0graceful-restart\u00a0extended</code></p> <p>Backdoor Eftersom eBGP har AD 20 \u00e4r det preferred \u00f6ver IGPs. Om man k\u00f6r IGP mellan AS och vill att det i f\u00f6rsta hand ska styra trafiken kan man manipulera BGP. Det man kan g\u00f6ra \u00e4r att sj\u00e4lv annonsera ut de prefix som de andra AS har. iBGP har AD 200 och blir s\u00e5ledes inte preferred. Dock blir d\u00e5 next-hop fel och det \u00e4r d\u00e4r BGP Backdoor feature kommer in. Med backdoor annonseras inte n\u00e5gra prefix till eBGP-grannar om man sj\u00e4lv inte har det i sitt AS men AD lokalt blir fortfarande 200.</p> <p><code>network\u00a010.0.0.0\u00a0mask\u00a0255.0.0.0\u00a0backdoor</code></p> <p>G\u00e5r \u00e4ven manuellt att s\u00e4tta h\u00f6gre distance p\u00e5 prefix fr\u00e5n grannar.</p> <p>DMZ Link \u00f6ver eBGP Use DMZ Link Bandwidth as weight for BGP multipaths on single-hop EBGP peers. Bandwidth skickas med i uppdateringar som extended community och kan anv\u00e4ndas f\u00f6r lastdelning av trafiken.</p> <p><code>router\u00a0bgp\u00a0100</code> <code>maximum-path\u00a04</code> <code>bgp\u00a0dmzlink-bw</code> <code>neighbor\u00a02.2.2.2\u00a0dmzlink-bw</code></p> <p><code>show\u00a0ip\u00a0bgp</code><code>|\u00a0i\u00a0DMZ</code> <p>F\u00f6r att verifiera f\u00e5r man ocks\u00e5 kolla traffic share.</p> <p>IOS-XR neighbor 1.1.1.1</p> <p><code>dmz-link-bandwidth</code> <code>ebgp-send-extcommunity-dmz</code> <code>ebgp-recv-extcommunity-dmz</code></p> <p>F\u00f6r att k\u00f6ra multipath \u00f6ver olika AS.</p> <p><code>bgp\u00a0bestpath\u00a0as-path\u00a0multipath-relax</code> <code>bgp\u00a0bestpath\u00a0as-path\u00a0ignore</code></p> <p>Have route-map set commands take priority over BGP commands such as next-hop unchanged.</p> <p><code>bgp\u00a0route-map\u00a0priority</code></p> <p>Default annonseras routes som ej hamnar i RIB (RIB-failure) vidare till andra, \u00e4ndra detta:</p> <p><code>bgp\u00a0suppress-inactive</code> <code>show\u00a0ip\u00a0bgp\u00a0rib-failure</code></p>"},{"location":"cisco/Cisco_BGP/#path-manipulation","title":"Path Manipulation","text":"<p>Outbound from AS:</p> <ul> <li>Weight</li> <li>Local preference</li> <li>Communities (mer skalbart \u00e4n LOCAL_PREF)</li> </ul> <p>Inbound to AS:</p> <ul> <li>AS-prepend</li> <li>MED</li> </ul>"},{"location":"cisco/Cisco_BGP/#med","title":"MED","text":"<p>Multi-exit discriminator \u00e4r ett konfigurerbart v\u00e4rde som kan anv\u00e4ndas f\u00f6r att v\u00e4lja var trafik komma in till sitt AS. Eftersom det \u00e4r ett nontransitive attribute skickas det inom AS men l\u00e4mnar ej. Det j\u00e4mf\u00f6rs bara om flera olika paths kommer fr\u00e5n samma AS, detta kan \u00e4ndras med bgp always-compare-med.</p> <p><code>route-map\u00a0MED_50\u00a0permit\u00a010</code> <code>set\u00a0metric\u00a050</code> <code>neighbor\u00a01.1.1.1\u00a0route-map\u00a0MED_50\u00a0out</code></p> <p>4,294,967,295 \u00e4r max metric och r\u00e4knas som infinity.</p>"},{"location":"cisco/Cisco_BGP/#local-preference","title":"Local Preference","text":"<p>Local Preference \u00e4r ett konfigurerbart v\u00e4rde som anv\u00e4nds f\u00f6r att v\u00e4lja var trafik ska l\u00e4mna det egna AS. Det skickas med NLRI till iBGP-grannar men ej eBGP. N\u00e4r en uppdateringar kommer fr\u00e5n en eBGP-peer s\u00e4tts default preference (100) p\u00e5 prefixet innan det annonseras vidare till iBGP.</p> <p><code>bgp\u00a0default\u00a0local-preference\u00a0100</code></p> <p>Eller st\u00e4ng av det</p> <p><code>no\u00a0bgp\u00a0default\u00a0local-preference</code></p> <p>H\u00f6gst preference vinner</p> <p><code>route-map\u00a0LOCALPREF\u00a0permit\u00a010</code> <code>set\u00a0local-preference\u00a0500</code> <code>neighbor\u00a01.1.1.1\u00a0route-map\u00a0LOCALPREF\u00a0in</code></p>"},{"location":"cisco/Cisco_BGP/#as-prepend","title":"AS-prepend","text":"<p>F\u00f6r att \u00e4ndra var man vill att trafik ska komma in till det egna AS kan man manipulera AS_PATH genom att l\u00e4gga p\u00e5 sitt AS flera g\u00e5nger f\u00f6r att g\u00f6ra pathen l\u00e4ngre.</p> <p><code>route-map\u00a0PREPEND\u00a0permit\u00a010</code> <code>set\u00a0as-path\u00a0prepend\u00a0100\u00a0100\u00a0100</code> <code>neighbor\u00a01.1.1.1\u00a0route-map\u00a0PREPEND\u00a0out</code></p>"},{"location":"cisco/Cisco_BGP/#weight","title":"Weight","text":"<p>Cisco proprietary och finns endast inom routern sj\u00e4lv.</p> <p><code>route-map\u00a0WEIGHT\u00a0permit\u00a010</code> <code>match\u00a0ip\u00a0address\u00a0prefix-list\u00a0HEAVY</code> <code>set\u00a0weight\u00a02000</code> <code>neighbor\u00a01.1.1.1\u00a0route-map\u00a0WEIGHT\u00a0in</code></p> <p>Default weight per neighbor</p> <p><code>neighbor\u00a01.1.1.1\u00a0weight\u00a0&lt;0-65535&gt;</code></p>"},{"location":"cisco/Cisco_BGP/#community","title":"Community","text":"<p>Community Path Attribute \u00e4r 32-bitars nummer som anv\u00e4nds f\u00f6r att tagga prefix. D\u00e5 kan man anv\u00e4nda taggen f\u00f6r att matcha p\u00e5 och sedan manipulera path eller filtrera. Routrar kan kolla efter taggen och sedan fatta routingbeslut. Detta PA b\u00e4rs med i annonseringarna och kan d\u00e4rmed anv\u00e4ndas av enheter som befinner sig flera AS bort. Eftersom det \u00e4r ett optional transitive PA s\u00e5 beh\u00f6ver inte ens routrarna emellan f\u00f6rst\u00e5 det. Till exempel kan man konfigurera att prefix med en viss community ska f\u00e5 en viss LOCAL_PREF och man kan p\u00e5 s\u00e5 s\u00e4tt styra trafiken.</p> <p>B\u00e5de heltal och AA:NN accepteras i konfiguration och show-kommandon men outputen fr\u00e5n show route-map g\u00e5r att \u00e4ndra. Detta \u00e4r best practice.</p> <p><code>ip\u00a0bgp-community\u00a0new-format</code></p> <p>Verify</p> <p><code>show\u00a0ip\u00a0bgp\u00a0community\u00a0?</code></p> <p>S\u00e5 st\u00e5r det antingen aa:nn eller 1-4294967295 beroende p\u00e5 format</p> <p>F\u00f6r att Community ska funka m\u00e5ste det skickas i uppdateringarna, standard och extended</p> <p><code>neighbor\u00a0[ip-address]\u00a0send-community\u00a0both</code></p> <p>Skicka community</p> <p><code>route-map\u00a0SETCOMMUNITY\u00a0permit\u00a010</code> <code>match\u00a0ip\u00a0address\u00a0prefix-list\u00a0COMMUNITY</code> <code>set\u00a0community\u00a05</code></p> <p>Alternativt flera med eller utan additive beroende p\u00e5 om att l\u00e4gga till community ist\u00e4llet f\u00f6r att ers\u00e4tta \u00e4r \u00f6nskv\u00e4rt.</p> <p><code>set\u00a0community\u00a05\u00a010\u00a015</code> <code>set\u00a0community\u00a05\u00a010\u00a015\u00a0additive</code></p> <p>Man kan \u00e4ven ta bort community.</p> <p><code>set\u00a0community\u00a0none</code></p> <p>Delete anything starting with 300</p> <p><code>ip\u00a0community-list\u00a0expanded\u00a0REGEXP\u00a0permit\u00a0300:[0-9]+_</code> <code>route-map\u00a0DELETE\u00a0permit\u00a010</code> <code>set\u00a0comm-list\u00a0REGEXP\u00a0delete</code></p> <p>Ta emot community</p> <p><code>ip\u00a0community-list\u00a06\u00a0permit\u00a05</code> <code>route-map\u00a0CHANGEPREF\u00a0permit\u00a010</code> <code>match\u00a0community\u00a06</code> <code>set\u00a0local-preference\u00a0250</code></p> <p>Vill man matcha med regex m\u00e5ste man anv\u00e4nda en extended community list. Community Internet (0:0) kan anv\u00e4ndas i community lists och betyder match any.</p> <p><code>ip\u00a0community-list\u00a0101\u00a0permit</code> <p>Show</p> <p><code>show\u00a0ip\u00a0bgp\u00a0community</code></p> <p>N\u00e5gra k\u00e4nda communities, set community ?</p> <ul> <li>Internet: 0:0</li> <li>no-export: Annonsera inte utanf\u00f6r eget AS</li> <li>no-advertise: Annonsera inte till n\u00e5gon</li> <li>gshut: graceful shutdown</li> <li>local-as (NO_EXPORT_SUBCONFED): Annonsera inte utanf\u00f6r eget     confederation sub-AS</li> </ul> <p><code>show\u00a0ip\u00a0bgp\u00a0community\u00a0no-advertise\u00a0no-export\u00a0local-AS</code></p> <p>Graceful BGP session shutdown GRACEFUL_SHUTDOWN \u00e4r en well-known community som anv\u00e4nds i samband med BGP Graceful Shutdown feature. Man skickar ut communityn till de grannar som man vill ska sluta anv\u00e4nda l\u00e4nkarna till den router som man t.ex. ska ha underh\u00e5ll p\u00e5. F\u00f6r att vara compliant med denna community m\u00e5ste man ha en ingress policy som s\u00e4ger \"match community gshut -&gt; make path least prefered\". IOS XE har en inbyggd macro f\u00f6r detta community-utskick och man anger hur m\u00e5nga sekunder det tar innan man bryter grannskapet.</p> <p>Exempel:</p> <p><code>neighbor\u00a010.0.1.1\u00a0shutdown\u00a0graceful\u00a030</code></p> <p>D\u00e5 skickas det ut UPDATE + ROUTE REFRESH som har community value 0xFFFF0000. 30 sekunder senare skickas det NOTIFICATION med admin shutdown. D\u00e5 hamnar \u00e4ven \"neighbor 10.0.1.1 shutdown\" i running conf.</p> <p>Man kan \u00e4ven skicka med en egen community eller local pref (funkar s\u00e5klart inte p\u00e5 ebgp).</p> <p><code>neighbor\u00a010.0.1.1\u00a0shutdown\u00a0graceful\u00a030\u00a0community\u00a0100\u00a0local-preference\u00a0150</code></p> <p>Det g\u00e5r \u00e4ven att aktivera community-utskicket + admin shutdown f\u00f6r alla grannskap samtidigt. Oavsett om man anv\u00e4nder peer-groups eller inte s\u00e5 hamnar shutdown p\u00e5 alla enskilda neighbors. Det finns ingen macro f\u00f6r unactivate utan \"neighbor shutdown\" f\u00e5r man ta bort sj\u00e4lv efter\u00e5t.</p> <p><code>bgp\u00a0graceful-shutdown\u00a0all\u00a0neighbors\u00a0activate</code></p>"},{"location":"cisco/Cisco_BGP/#as-manipulation","title":"AS Manipulation","text":"<p>Man kan konfigurera sig sj\u00e4lv att skicka ett helt annat ASN i OPEN message \u00e4n vad man egentligen har s\u00e5 att man ser ut som ett annat AS f\u00f6r externa partar, detta g\u00f6rs med local-as. Man kan \u00e4ven v\u00e4lja om detta \"fake\" AS ska l\u00e4ggas p\u00e5 eller ej p\u00e5 det som tas emot beroende p\u00e5 hur ens AS \u00e4r uppdelat, dvs anledningen till att man ens k\u00f6r local-as. Man kan ocks\u00e5 st\u00e4lla in att det enda som andra sidan ser \u00e4r fake AS, replace-as. Under en \u00f6verg\u00e5ngsperiod kan man acceptera tv\u00e5 AS och grannen kan d\u00e5 peera med valfritt, dual-as.</p> <p><code>neighbor\u00a01.1.1.1\u00a0local-as\u00a0601\u00a0no-prepend\u00a0[replace-as]\u00a0[dual-as]</code></p> <p>Kan anv\u00e4ndas f\u00f6r att d\u00f6lja ASN, Override matching AS-number while sending update, dvs det \u00e4r en egress feature.</p> <p><code>neighbor\u00a01.1.1.1\u00a0as-override</code></p> <p>Acceptera as-path som inneh\u00e5ller det egna ASN, kan beh\u00f6vas i vissa fall d\u00e4r ens AS \u00e4r uppdelat. Default f\u00e5r ens AS f\u00f6rekomma 3 g\u00e5nger i AS_PATH.</p> <p><code>neighbor\u00a01.1.1.1\u00a0allowas-in</code></p> <p>Ta bort private AS number fr\u00e5n utg\u00e5ende uppdateringar, detta AS m\u00e5ste finnas i b\u00f6rjan av AS path f\u00f6r att detta ska funka.</p> <p><code>neighbor\u00a01.1.1.1\u00a0remove-private-as\u00a0[all]</code></p> <p>Attribute-map Attribute map kan anv\u00e4ndas f\u00f6r att manipulera AS och/eller attributes fr\u00e5n AS-sets.</p> <p><code>set\u00a0origin\u00a0egp\u00a022</code></p>"},{"location":"cisco/Cisco_BGP/#filtering","title":"Filtering","text":"<p>BGP kan filtrera AS, NLRI och PA i alla inkommande och utg\u00e5ende uppdateringar antingen per granne eller per peer group. F\u00f6r att en filter\u00e4ndring ska g\u00e5 igenom kr\u00e4vs clear-kommandot.</p> <p>Maximum prefixes</p> <p><code>neighbor\u00a01.1.1.1\u00a0maximum-prefix\u00a01000</code></p> <p>Only give warning message when limit is exceeded</p> <p><code>neighbor\u00a01.1.1.1\u00a0maximum-prefix\u00a01000\u00a0warning-only</code> <code>show\u00a0ip\u00a0bgp\u00a0neighbors\u00a01.1.1.1\u00a0|\u00a0i\u00a0Maximum|Threshold</code></p>"},{"location":"cisco/Cisco_BGP/#as","title":"AS","text":"<p>Regular Expressions</p> <ul> <li>.* = Any</li> <li>^$ = Local AS</li> <li>_200$ = Originated in AS 200</li> <li>200 = Transited AS 200</li> <li>^200_ = Learned from 200</li> <li>[0-9]+ = Any AS</li> </ul> <p>AS-path ACL</p> <p><code>ip\u00a0as-path\u00a0access-list\u00a0100\u00a0deny\u00a0_120$</code> <code>ip\u00a0as-path\u00a0access-list\u00a0100\u00a0permit\u00a0.*</code> <code>neighbor\u00a01.1.1.1\u00a0filter-list\u00a0100\u00a0in</code></p> <p>Maximum number of ASes in the AS-PATH attribute</p> <p><code>bgp\u00a0maxas-limit\u00a0&lt;1-254&gt;</code></p>"},{"location":"cisco/Cisco_BGP/#network","title":"Network","text":"<p>Distribute-list, standard ACL</p> <p><code>access-list\u00a01\u00a0permit\u00a010.10.10.0\u00a00.0.0.255</code> <code>neighbor\u00a01.1.1.1\u00a0distribute-list\u00a01\u00a0in</code></p> <p>Extended ACL tolkas av BGP som:</p> <p><code>access-list\u00a0100\u00a0permit\u00a0ip</code><code></code><code></code><code></code> <code>neighbor\u00a01.1.1.1\u00a0distribute-list\u00a0100\u00a0in</code> <p>Prefix-list, det rekommenderade s\u00e4ttet.</p> <p><code>ip\u00a0prefix-list\u00a0ACCEPT\u00a0seq\u00a010\u00a0permit\u00a010.10.10.0/24\u00a0le\u00a024</code> <code>neighbor\u00a01.1.1.1\u00a0prefix-list\u00a0ACCEPT\u00a0in</code></p> <p>Verify</p> <p><code>show\u00a0ip\u00a0bgp\u00a0prefix-list\u00a0ACCEPT</code></p> <p>ORF Outbound route filtering kan anv\u00e4ndas f\u00f6r att ber\u00e4tta f\u00f6r sina neighbors vilka prefix man till\u00e5ter in s\u00e5 de dynamiskt kan s\u00e4tta samma prefix-lista som outbound prefix filter och inte ens beh\u00f6ver skicka n\u00e5got annat. B\u00e5da sidor m\u00e5ste st\u00f6dja ORF f\u00f6r att det ska kunna anv\u00e4ndas.</p> <p><code>neighbor\u00a01.1.1.1\u00a0prefix-list\u00a0ALLOW\u00a0in</code> <code>neighbor\u00a01.1.1.1\u00a0capability\u00a0orf\u00a0prefix-list\u00a0both</code></p> <p><code>show\u00a0ip\u00a0bgp\u00a0neighbors\u00a01.1.1.1\u00a0|\u00a0s\u00a0Outbound</code> <code>show\u00a0ip\u00a0bgp\u00a0neighbors\u00a01.1.1.1\u00a0received\u00a0prefix-filter</code> <code>clear\u00a0ip\u00a0bgp\u00a01.1.1.1\u00a0soft\u00a0in\u00a0prefix-filter</code></p>"},{"location":"cisco/Cisco_BGP/#rt","title":"RT","text":"<p>Filtrera inkommande routes genom att vitlista specifikt route-target</p> <p><code>ip\u00a0extcommunity-list\u00a0standard\u00a0FILTER-AS400-VPNV4-IN\u00a0permit\u00a0rt\u00a01337:10</code> <code>route-map\u00a0FILTER-AS400-VPNV4-IN\u00a0permit\u00a010</code> <code>match\u00a0extcommunity\u00a0FILTER-AS400-VPNV4-IN</code></p> <p><code>address-family\u00a0vpnv4</code> <code>neighbor\u00a0172.16.99.2\u00a0route-map\u00a0FILTER-AS400-IN\u00a0in</code></p> <p>Verify</p> <p><code>show\u00a0ip\u00a0extcommunity-list</code> <code>show\u00a0bgp\u00a0vpnv4\u00a0unicast\u00a0all\u00a0extcommunity-list\u00a0FILTER-AS400-VPNV4-IN</code></p>"},{"location":"cisco/Cisco_BGP/#convergence","title":"Convergence","text":"<p>BGP \u00e4r inte designat f\u00f6r att vara det snabbaste protokollet, detta f\u00f6r att kunna fungera i stor skala men det finns flera tekniker f\u00f6r att s\u00e4nka konvergeringstid (recovery). \u00c4ven om routes tas bort fr\u00e5n routingtabellen snabbt s\u00e5 v\u00e4ntar BGP-processen p\u00e5 att TCP-sessionen ska timea ut eller hold-down ska g\u00e5 ut innan konvergeringsprocessen b\u00f6rjar. Hold-down timer \u00e4r default 3 minuter. Det \u00e4r ocks\u00e5 s\u00e5 att BGP inte skickar uppdateringar direkt till grannar utan det sker periodvis baserat p\u00e5 peering-typ, 0 sekunder f\u00f6r iBGP-grannar och 30 sekunder f\u00f6r eBGP. BGP verifierar next-hop reachability med hj\u00e4lp av IGP, detta g\u00f6rs var 60:e sekund. Allt detta leder till att BGP kan ta v\u00e4ldigt l\u00e5ng tid p\u00e5 sig att konvergera.</p> <p>Timers</p> <p><code>timers\u00a0bgp</code><code></code><code></code> <code>timers\u00a0bgp\u00a010\u00a030\u00a020</code> <p>I IOS-XE verkar keepalive vara verkningsl\u00f6st, det \u00e4r holdtime delat med tre som blir aktivt.</p> <p>Next Hop Tracking NHT is an on-by-default feature that notifies BGP to a change in routing for BGP prefix next-hops. This is important because previously this only happened as part of the BGP Scanner process, which runs every 60 seconds by default. The bgp nexthop trigger delay defines how long for the NHT process to delay updating BGP. This timer is here to prevent BGP from being beaten up by a flapping IGP route. At default value 5 seconds, the BGP process can't get bogged down from unnecessary updates.</p> <p><code>bgp\u00a0nexthop\u00a0trigger\u00a0enable</code> <code>bgp\u00a0nexthop\u00a0trigger\u00a0delay\u00a05</code></p> <p>Scan interval Hur ofta IGP ska scannas efter uppdateringar, default \u00e4r 60 sekunder. OBS bgp scan-time configuration less than 15 seconds can cause high cpu usage by BGP Scanner.</p> <p><code>router\u00a0bgp\u00a0100</code> <code>bgp\u00a0scan-time\u00a0&lt;5-60&gt;</code> <code>show\u00a0ip\u00a0bgp\u00a0summary\u00a0|\u00a0i\u00a0scan</code></p> <p>Kolla VRF:er om det finns nya routes att annonsera med MP-BGP.</p> <p><code>address-family\u00a0vpnv4\u00a0unicast</code> <code>bgp\u00a0scan-time\u00a0&lt;5-60&gt;</code> <code>show\u00a0bgp\u00a0vpnv4\u00a0unicast\u00a0all\u00a0summary\u00a0|\u00a0i\u00a0scan</code></p> <p>Man kan reducera konvergenstiden n\u00e4r BGP paths f\u00f6r\u00e4ndras genom att konfigurera policyn f\u00f6r vad som ska dra nytta av BGP Event-Based VPN Import feature.</p> <p><code>address-family\u00a0ipv4\u00a0vrf\u00a0Cust_A</code> <code>import\u00a0path\u00a0selection\u00a0all</code></p> <p>eBGP neighbor loss detection BGP-grannskap rivs direkt n\u00e4r l\u00e4nken mellan g\u00e5r ner vilket leder till att BGP-routsen flushas direkt och det s\u00f6kes efter alternativ. Detta \u00e4r default i IOS sedan l\u00e4nge.</p> <p><code>bgp\u00a0fast-external-fallover\u00a0\u00a0#Global</code> <code>ip\u00a0bgp\u00a0fast-external-fallover\u00a0\u00a0#Per\u00a0interface</code></p> <p>iBGP neighbor loss detection S\u00e5 fort en grannens IP-address f\u00f6rsvinner fr\u00e5n routingtabellen (p\u00e5 grund av IGP) s\u00e5 tas grannskapet ner och konvergering kan b\u00f6rja direkt. Ingen hold-down eller delay i deaktivering av BGP-session anv\u00e4nds. \u00c4r IGPn det minsta l\u00e5ngsam p\u00e5 att hitta en alternativ route till grannen s\u00e5 hinner grannskapet tas ner. Det g\u00e5r \u00e4ven att anv\u00e4nda detta f\u00f6r eBGP t.ex. om man peerar med loopbacks och det fungerar p\u00e5 samma s\u00e4tt.</p> <p><code>neighbor\u00a01.1.1.1\u00a0fall-over</code></p>"},{"location":"cisco/Cisco_BGP/#bfd","title":"BFD","text":"<p>Se \u00e4ven Cisco BFD.</p> <p><code>neighbor\u00a01.1.1.1\u00a0fall-over\u00a0bfd</code> <code>show\u00a0bfd\u00a0neighbor</code></p> <p>The C-Bit is set by the BFD process itself, and isn't something you can toggle. However, you can tell your BFD process whether to ignore the setting or not. The default is to ignore.</p> <p><code>neighbor\u00a02.2.2.2\u00a0fall-over\u00a0bfd\u00a0check-control-plane-failure</code></p>"},{"location":"cisco/Cisco_BGP/#pic","title":"PIC","text":"<p>Prefix Independent Convergence \u00e4r en CEF/FIB-feature framtagen f\u00f6r att snabba upp data-plane recovery n\u00e4r man har FIB med v\u00e4ldigt m\u00e5nga routes och next-hop blir unreachable men det finns en annan g\u00e5ngbar next-hop. Traditionellt byggdes FIB med Prefix -&gt; Interface/Next-Hop. \u00c4ndras next-hop m\u00e5ste FIB:en uppdateras f\u00f6r varenda prefix vilket kan ta l\u00e5ng tid ifall det finns m\u00e5nga. Med PIC Core l\u00e4gger man in en pointer emellan, Prefix -&gt; Pointer -&gt; Interface/Next-Hop. \u00c4ndras next-hop beh\u00f6ver endast en pointer pekas om, alla prefix kan fortfarande peka mot samma pointer. BGP FRR precomputes en n\u00e4st b\u00e4sta v\u00e4g i BGP och ger den till RIB som en backup/alternate path och CEF programmerar det i line cardsen. BGP PIC feature supporterar prefix f\u00f6r IPv4, IPv6, VPNv4 och VPNv6. K\u00f6r man BGP Multipath s\u00e5 finns support f\u00f6r PIC. Har man route reflector endast i control plane beh\u00f6ver man inte sl\u00e5 p\u00e5 PIC eftersom det handlar om data plane recovery.</p> <p>PIC Core Hierarchical FIB, local only mechanism.</p> <p><code>bgp\u00a0additional-paths\u00a0install</code></p> <p><code>cef\u00a0table\u00a0output-chain\u00a0build\u00a0favor\u00a0convergence-speed</code></p> <p>St\u00e4nga av PIC</p> <p><code>cef\u00a0table\u00a0output-chain\u00a0build\u00a0favor\u00a0memory-utilization</code></p> <p>PIC Edge Eftersom PIC Edge precomputes en alternate path f\u00f6rsvinner po\u00e4ngen med CEF recursion s\u00e5 d\u00e4rf\u00f6r kommer det att disableas f\u00f6r prefix med /32-mask eller som \u00e4r directly connected n\u00e4r man sl\u00e5r p\u00e5 BGP PIC. bgp recursion host enableas f\u00f6r VPNv4 och VPNv6 address families och disableas f\u00f6r IPv4 och IPv6 address families.</p> <p><code>bgp\u00a0additional-path\u00a0install</code> <code>bgp\u00a0recursion\u00a0host</code> <code>bgp\u00a0advertise-best-external</code></p> <p>IOS-XR route-policy PIC-EDGE</p> <p><code>set\u00a0path-selection\u00a0backup\u00a01\u00a0advertise</code> <code>end-policy</code></p> <p><code>router\u00a0bgp\u00a01</code> <code>address-family\u00a0vpnv4\u00a0unicast</code> <code>additional-paths\u00a0selection\u00a0route-policy\u00a0PIC-EDGE</code></p>"},{"location":"cisco/Cisco_BGP/#default-route","title":"Default route","text":"<p>Send default route, g\u00f6rs per adressfamilj och m\u00e5ste finnas i routingtabellen.</p> <p><code>network\u00a00.0.0.0</code></p> <p>eller anv\u00e4nd default-information originate (det kr\u00e4ver ocks\u00e5 redistribution)</p> <p>Skicka default route villkorsl\u00f6st, g\u00f6rs per neighbor. Detta g\u00e5r f\u00f6rbi output filtering och kr\u00e4ver inte gateway of last resort i RIB.</p> <p><code>neighbor\u00a01.1.1.1\u00a0default-originate</code></p>"},{"location":"cisco/Cisco_BGP/#summarization","title":"Summarization","text":"<p>Auto-Summary \u00e4r avst\u00e4ngt default och b\u00f6r vara det. Om det \u00e4r p\u00e5slaget p\u00e5verkar det network och redistribution.</p> <ul> <li>network-kommando: classful and more specific</li> <li>redistribution: only classful</li> </ul> <p>F\u00f6r att skicka summerade routes anv\u00e4nds aggregate-address och en null route installeras automatiskt. Inget annonseras om inte det inte finns n\u00e5gon component route i BGP-tabellen. Om component routes har olika AS_SEQ s\u00e5 kan inte de sl\u00e5s samman utan d\u00e5 kommer aggregeringen att skickas med AS_SEQ null. aggregate-address skickas med PA: Atomic Aggregate.</p> <p><code>aggregate-address\u00a010.0.0.0\u00a0255.0.0.0\u00a0[summary-only]\u00a0[as-set]</code></p> <p>summary-only = suppress detailed routes. AS-set inneb\u00e4r att alla ASN fr\u00e5n de mer specifika prefixen ska s\u00e4ttas ihop och inkluderas i summeringen, ett set r\u00e4knas som ett AS hopp och anv\u00e4nds f\u00f6r loop prevention. \u00d6vrig information fr\u00e5n de mer specifika prefixen sl\u00e5s ocks\u00e5 ihop och en del information d\u00e5 vara \u00f6verlappade. Man kan manipulera detta sj\u00e4lv genom att v\u00e4lja ut enskilda prefix som ska utg\u00f6ra k\u00e4llan f\u00f6r de attribut som aggregeringen ska ha. Detta g\u00f6rs med route-map som konfigureras efter as-set, advertise-map ADVERTISE_MAP.</p> <p>Alternativt</p> <p><code>ip\u00a0route\u00a010.0.0.0\u00a0255.0.0.0\u00a0null\u00a00</code> <code>router\u00a0bgp\u00a0100</code> <code>network\u00a010.0.0.0\u00a0255.0.0.0</code></p> <p>Suppress-map Med aggregate-address skickas en summary och de mer specifika prefixen. Detta g\u00e5r att styra med en suppress-map som fungerar som en svartlista.</p> <p><code>ip\u00a0prefix-list\u00a0DONT-SUPPRESS-THIS\u00a0permit\u00a010.0.2.0/24</code> <code>route-map\u00a0SUPPRESS\u00a0deny\u00a010</code> <code>match\u00a0ip\u00a0address\u00a0prefix-list\u00a0DONT-SUPPRESS-THIS</code> <code>route-map\u00a0SUPPRESS\u00a0permit\u00a020</code></p> <p><code>router\u00a0bgp\u00a0100</code> <code>aggregate-address\u00a010.0.0.0\u00a0255.255.0.0\u00a0suppress-map\u00a0SUPPRESS</code></p> <p>Unsuppress-map Anv\u00e4nds om man vill skicka mer specifika prefix till en granne trots att man anv\u00e4nder summary-only, fungerar som en vitlista.</p> <p><code>ip\u00a0prefix-list\u00a0UNSUPPRESS-THIS\u00a0permit\u00a010.0.2.0/24</code> <code>route-map\u00a0UNSUPPRESS\u00a0permit\u00a010</code> <code>match\u00a0ip\u00a0address\u00a0prefix-list\u00a0UNSUPPRESS-THIS</code></p> <p><code>router\u00a0bgp\u00a0100</code> <code>aggregate-address\u00a010.0.0.0\u00a0255.255.0.0\u00a0summary-only</code> <code>neighbor\u00a01.1.1.1\u00a0unsuppress-map\u00a0UNSUPPRESS</code></p>"},{"location":"cisco/Cisco_BGP/#multiprotocol-bgp","title":"Multiprotocol BGP","text":"<p>F\u00f6r att kunna skicka NLRI om annat \u00e4n IPv4, t.ex. VPN routes f\u00f6r olika VRF:er, beh\u00f6vs fler path attributes. MP-BGP (RFC 4760) \u00e4r ett extension till BGP som ger tv\u00e5 nya optional nontransitive attributes. Multiprotocol Reachable NLRI (MP_REACH_NLRI) annonserar MP-routes och Multiprotocol Unreachable NLRI (MP_UNREACH_NLRI) drar tillbaka MP-routes. Dessa inneh\u00e5ller AFI, Next-hop och NLRI. NLRI st\u00e5r f\u00f6r l\u00e4gga till eller ta bort routes och next-hop. MP-BGP listas som capability i Open-paketen och k\u00f6rs f\u00f6r det mesta inom samma AS. Se \u00e4ven Cisco MPLS.</p>   Exempel:    [](/File:Cisco_BGP_MP.png \"wikilink\")   <p>IPv4 unicast aktiveras s\u00e5 fort man konfigurerar MP-BGP.</p> <p><code>router\u00a0bgp\u00a0100</code> <code>no\u00a0bgp\u00a0default\u00a0ipv4-unicast</code> <code>address-family\u00a0vpnv4</code> <code>neighbor\u00a01.1.1.1\u00a0activate</code> <code>neighbor\u00a01.1.1.1\u00a0send-community\u00a0extended</code> <code>exit-address-family</code></p> <p>BGP send-community sl\u00e5s p\u00e5 automatiskt n\u00e4r man aktiverar en granne f\u00f6r det \u00e4r ett m\u00e5ste f\u00f6r att MP-BGP ska fungera.</p> <p>Se routes som skickas fr\u00e5n en VRF (adj-ribs-out)</p> <p><code>show\u00a0ip\u00a0bgp\u00a0vrf\u00a0Name\u00a0neighbors\u00a010.10.10.10\u00a0advertised-routes</code> <code>clear\u00a0ip\u00a0bgp\u00a010.10.10.10\u00a0vrf\u00a0Name</code></p>"},{"location":"cisco/Cisco_BGP/#route-reflector","title":"Route Reflector","text":"<p>Routes l\u00e4rda av iBGP skickas ej vidare till iBGP-grannar per default. En route reflector (RFC 1966) bryter denna regel s\u00e5 full mesh iBGP-grannskap beh\u00f6vs ej och iBGP blir mer skalbart. Dock skickar en RR endast vidare routes som anses \"best\" i den egna BGP-tabellen, detta h\u00e5ller nere antalet annonserade routes. Den enda g\u00e5ngen en RR inte skickar vidare NLRI n\u00e4r det ska till en icke-klient d\u00e5 NLRI \u00e4r mottagen fr\u00e5n en icke-klient, dvs vanlig iBGP. F\u00f6r att h\u00e5lla n\u00e4tverket loopfritt anv\u00e4nds Path Attribute, RR s\u00e4tter CLUSTER_LIST och det inneh\u00e5ller egna cluster-id som skickas med Updates. Inneh\u00e5ller en mottagen update det egna cluster-id s\u00e5 kommer prefixet discardas. ORIGINATOR_ID, RID p\u00e5 iBGP-routern som f\u00f6rst annonserade prefixet, skickas \u00e4ven med. Ser en router ett prefix med sitt egna RID som ORIGINATOR_ID kommer inte prefixet att annonseras vidare. F\u00f6r high availability och resiliency anv\u00e4nds f\u00f6rdelaktigt ett eller flera RR-kluster.</p> <p>Utmaningar P\u00e5 grund av att RR endast annonserar vidare en path blir det reduced path diversity och om inte klienterna f\u00e5r additional path visibility i f\u00f6rv\u00e4g kan RR introducera h\u00f6gre konvergeringstid samt att man tappar multi-pathing. Detta g\u00e5r att l\u00f6sa med Additional Paths. Eftersom RR k\u00f6r best path utifr\u00e5n sitt eget perspektiv (IGP cost) kan det \u00e4ven leda till sub-optimal routing. Om man k\u00f6r IP forwarding ist\u00e4llet f\u00f6r label forwarding kan \u00e4ven forwarding loopar skapas i vissa scenarier p\u00e5 grund av RR-placering. Som generell regel kan man s\u00e4ga att BGP-sessionerna inte ska avvika f\u00f6r mycket ifr\u00e5n forwarding topology. Detta g\u00e4ller allts\u00e5 inte n\u00e4r man anv\u00e4nder mpls vpn f\u00f6r all data plane, d\u00e5 spelar placering i princip ingen roll.</p> <p>Man m\u00e5ste ocks\u00e5 best\u00e4mma om det ska vara vanlig iBGP eller route-reflector-client till andra kluster och det beror p\u00e5 vilken redundansdesign man valt. K\u00f6r man non-client finns det vissa failure-situationer som kan leda till traffic black holes. V\u00e4ljer man client kommer man att f\u00e5 in uppdateringar med det man sj\u00e4lv annonserar ut dvs feedback loop. Detta \u00e4r inga problem med sm\u00e5 BGP-tabeller men kan st\u00e4lla till det med stora.</p> <p>RR-server</p> <p><code>router\u00a0bgp\u00a065000</code> <code>neighbor\u00a01.1.1.1\u00a0remote-as\u00a065000</code> <code>neighbor\u00a01.1.1.1\u00a0update-source\u00a0lo0</code> <code>neighbor\u00a01.1.1.1\u00a0route-reflector-client</code></p> <p>Kluster konfigureras p\u00e5 RR-server, s\u00e4tt samma cluster-id p\u00e5 de RR som ska ing\u00e5 i klustret. Man kan ha flera kluster.</p> <p><code>router\u00a0bgp\u00a065000</code> <code>bgp\u00a0cluster-id\u00a05</code></p> <p>RR-klienter k\u00e4nner inte till RR-konceptet s\u00e5 de konfigureras som vanlig iBGP.</p> <p><code>router\u00a0bgp\u00a065000</code> <code>neighbor\u00a02.2.2.2\u00a0remote-as\u00a065000</code> <code>neighbor\u00a02.2.2.2\u00a0update-source\u00a0lo0</code></p> <p>Verify</p> <p><code>show\u00a0ip\u00a0bgp\u00a0update-group</code></p> <p>Det \u00e4r inte alltid RR finns i forwarding path, d\u00e5 kan man anv\u00e4nda \"Selective RIB Download\" f\u00f6r att spara lokala resurser. All NLRI finns i BGP-tabellen som vanligt f\u00f6r best-path och annonsering men det beh\u00f6ver ju aldrig l\u00e4ggas in entries i RIB/FIB. En table-map \u00e4r en route-map f\u00f6r BGP-tabellen ist\u00e4llet f\u00f6r per grannskap.</p> <p><code>table-map\u00a0BORD\u00a0filter</code></p>"},{"location":"cisco/Cisco_BGP/#confederations","title":"Confederations","text":"<p>BGP confederations (RFC 5065) delar upp ett AS i flera sub-AS. Routrar inom samma sub-AS \u00e4r confederation iBGP-grannar medans mellan sub-AS \u00e4r confederation eBGP-grannar. iBGP fungerar precis likadant, dvs routes l\u00e4rda fr\u00e5n iBGP annonseras ej vidare till iBGP-grannar och det beh\u00f6vs s\u00e5ledes full mesh grannskap alternativt en route reflector inom varje sub-AS. F\u00f6r att undvika loopar anv\u00e4nds path attributet AS_PATH. Ist\u00e4llet f\u00f6r de vanliga AS_SEQ och AS_SET anv\u00e4nds AS_CONFED_SEQ och AS_CONFED_SET. Confed-AS r\u00e4knas som ett AS vid path selection. Finns en grannes sub-AS redan med i AS_CONFED_SEQ s\u00e5 kommer prefixet inte att annonseras till den. N\u00e4r det g\u00e4ller confederation eBGP anv\u00e4nds TTL 1 precis som med vanlig eBGP d\u00e4remot \u00e4ndras inte NEXT_HOP default mellan sub-AS. Om ett prefix ska annonseras ut fr\u00e5n en confederation tas confederation ASN bort fr\u00e5n AS_PATH s\u00e5 utsidan ser endast ett AS.</p> <p><code>router\u00a0bgp\u00a065000</code> <code>bgp\u00a0confederation\u00a0identifier\u00a0123</code></p> <p>F\u00f6r att routern ska veta att det \u00e4r ett confederation eBGP-grannskap och inte ett vanligt ange bgp confederation peers. Detta beh\u00f6vs inte p\u00e5 routrar som ej har confederation eBGP-grannskap.</p> <p><code>router\u00a0bgp\u00a065000</code> <code>bgp\u00a0confederation\u00a0peers\u00a065001</code> <code>neighbor\u00a010.0.0.20\u00a0remote-as\u00a065001</code></p>"},{"location":"cisco/Cisco_BGP/#redistribution","title":"Redistribution","text":"<p>Man m\u00e5ste vara f\u00f6rsiktig n\u00e4r man redistribuerar mellan IGP och BGP eftersom BGP klarar s\u00e5 mycket fler routes \u00e4n n\u00e5gon IGP. Default s\u00e5 redistribueras endast eBGP till andra protokoll pga att iBGP inte har n\u00e5gon egen loop prevention mekanism. Man kan \u00e4ndra detta men det b\u00f6r man inte g\u00f6ra.</p> <p><code>bgp\u00a0redistribute\u00a0internal</code></p> <p>OSPF Only internal OSPF routes will be redistributed into BGP by default.</p> <p><code>redistribute\u00a0ospf\u00a01</code> <code>redistribute\u00a0ospf\u00a01\u00a0route-map\u00a0SET-ORIGIN\u00a0\u00a0#\u00a0betyder\u00a0allt\u00a0i\u00a0rib\u00a0dvs\u00a0externals\u00a0f\u00f6ljer\u00a0med</code></p>"},{"location":"cisco/Cisco_BGP/#dampening","title":"Dampening","text":"<p>F\u00f6rutom att anv\u00e4nda route aggregation f\u00f6r att minska risken att CPU g\u00e5r i taket p\u00e5 alla enheter n\u00e4r n\u00e5got flappar kan dampening anv\u00e4ndas.</p> <p><code>route-map\u00a0DAMPENING\u00a0permit\u00a010</code> <code>set\u00a0dampening\u00a05\u00a01900\u00a02000\u00a010</code></p> <p>5=half-life, 1900=reuse-limit, 2000=suppress-limit, 10 max-suppress-limit</p> <p><code>router\u00a0bgp\u00a0100</code> <code>bgp\u00a0dampening\u00a0route-map\u00a0DAMPENING</code></p> <p>Route flap</p> <p><code>show\u00a0ip\u00a0bgp\u00a0flap-statistics</code> <code>show\u00a0ip\u00a0bgp\u00a0dampening\u00a0parameters</code></p>"},{"location":"cisco/Cisco_BGP/#conditional-route-injection","title":"Conditional Route Injection","text":"<p>The ability to insert more specific prefixes into BGP without having them in the IP routing table. Routemap which specifies prefixes to inject and routemap which specifies exist condition (Det g\u00e5r \u00e4ven k\u00f6ra med non-exist om man vill v\u00e4nda p\u00e5 det)</p> <p><code>ip\u00a0prefix-list\u00a0INJECT-THIS\u00a0permit\u00a0110.0.1.0/24</code> <code>ip\u00a0prefix-list\u00a0INJECT-THIS\u00a0permit\u00a0110.0.2.0/24</code> <code>ip\u00a0prefix-list\u00a0AGGREGATE\u00a0permit\u00a0110.0.0.0/8</code> <code>ip\u00a0prefix-list\u00a0SOURCE\u00a0permit\u00a01.1.1.1/32</code></p> <p><code>route-map\u00a0INJECT</code> <code>set\u00a0ip\u00a0address\u00a0prefix-list\u00a0INJECT-THIS</code></p> <p><code>route-map\u00a0EXIST</code> <code>match\u00a0ip\u00a0address\u00a0prefix-list\u00a0AGGREGATE</code> <code>match\u00a0ip\u00a0route-source\u00a0prefix-list\u00a0SOURCE</code></p> <p><code>router\u00a0bgp\u00a0100</code> <code>bgp\u00a0inject-map\u00a0INJECT\u00a0exist-map\u00a0EXIST</code></p> <p>The less-specific prefix MUST come from a BGP neighbor. No insertion of more-specific prefixes of a locally-originated prefix.</p> <p>Verify</p> <p><code>show\u00a0ip\u00a0bgp\u00a0injected-paths</code> <code>show\u00a0ip\u00a0bgp\u00a0neighbors\u00a01.1.1.1\u00a0|\u00a0i\u00a0status</code></p>"},{"location":"cisco/Cisco_BGP/#conditional-advertisement","title":"Conditional Advertisement","text":"<p>Conditional advertisement till\u00e5ter att man per neighbor endast annonserar utvalda prefix om vissa prefix existerar/inte existerar i den lokala BGP-tabellen, som kollas av BGP scanner/NHT.</p> <p><code>route-map\u00a0ADVERTISE_MAP\u00a0permit\u00a010</code> <code>match\u00a0as-path\u00a01</code></p> <p><code>ip\u00a0prefix-list\u00a0PREFIX\u00a0permit\u00a010.0.10.0/24</code></p> <p><code>route-map\u00a0NON_EXIST_MAP\u00a0permit\u00a010</code> <code>match\u00a0ip\u00a0address\u00a0prefix-list\u00a0PREFIX</code></p> <p><code>router\u00a0bgp\u00a0100</code> <code>neighbor\u00a01.1.1.1\u00a0advertise-map\u00a0ADVERTISE_MAP\u00a0non-exist-map\u00a0NON_EXIST_MAP</code></p>"},{"location":"cisco/Cisco_BGP/#flowspec","title":"Flowspec","text":"<p>BGP flow specification \u00e4r en feature som man kan anv\u00e4nda f\u00f6r att propagera filter- och policy-funktionalitet till sina BGP-noder. Det kan anv\u00e4ndas f\u00f6r att mitigera DDoS-attacker. Med flowspec g\u00e5r det att filtrera mycket mer granul\u00e4rt \u00e4n med Remote Trigger Blackhole (RTBH). Man har \u00e4ven fler m\u00f6jligheter f\u00f6r vad man vill g\u00f6ra med attacken, t.ex. drop eller police, next-hop eller VRF redirect, DSCP Markings. Flowspec implementeras som en adressfamilj. IOS XE har st\u00f6d f\u00f6r flowspec client function men som flowspec controller beh\u00f6vs n\u00e5got annat. Controllern som t.ex. kan lyssna p\u00e5 ett DDoS-detekteringssystem skickar ut flowspec NLRI till klienterna, detta s\u00e4ger vad som ska g\u00f6ras med vilken trafik. Ju fler och ju mer avancerade regler man skjuter ut ju mer TCAM g\u00e5r \u00e5t.</p> <p>Det finns flera mjukvaror som kan agera controller, t.ex. IOS-XR, GoBGP eller ExaBGP.</p> <p>IOS XE</p> <p><code>flowspec</code> <code>address-family\u00a0ipv4</code> <code>local-install\u00a0interface-all</code></p> <p><code>router\u00a0bgp\u00a0100</code> <code>address-family\u00a0ipv4\u00a0flowspec</code> <code>neighbor\u00a010.1.1.1\u00a0activate</code></p> <p>Verify</p> <p><code>show\u00a0flowspec\u00a0summary</code> <code>show\u00a0bgp\u00a0ipv4\u00a0flowspec</code></p>"},{"location":"cisco/Cisco_BGP/#bmp","title":"BMP","text":"<p>The BGP Monitoring Protocol (BMP) feature supports functionality to monitor Border Gateway Protocol (BGP) neighbors. Det kan t.ex. anv\u00e4ndas f\u00f6r BGP Looking glass och/eller advanced route analytics. Det kan \u00e4ven underl\u00e4tta vid route-policy troubleshooting. BMP devices (routers) skickar BMP messages till en BMP collector/daemon, t.ex. OpenBMP.</p> <p><code>router\u00a0bgp\u00a065000</code> <code>neighbor\u00a030.1.1.1\u00a0bmp-activate\u00a0server\u00a01</code> <code>bmp\u00a0server\u00a01</code> <code>address\u00a010.0.0.10\u00a0port-number\u00a08000</code> <code>activate</code></p> <p>Verify</p> <p><code>show\u00a0ip\u00a0bgp\u00a0bmp\u00a0server\u00a01</code> <code>show\u00a0ip\u00a0bgp\u00a0bmp\u00a0server\u00a0summary</code></p>"},{"location":"cisco/Cisco_BGP/#rpki","title":"RPKI","text":"<p>\"Resource Public Key Infrastructure allows IP address holders to specify which Autonomous Systems (AS\u2019s) are authorized to originate their IP address prefixes.\" RPKI \u00f6kar dock komplexitet. Konfigurera RPKI Cache-server, RPKI Prefix Validation, BGP Prefix Validation och RPKI Bestpath Computation.</p> <p>IOS</p> <p><code>router\u00a0bgp\u00a0100</code> <code>bgp\u00a0rpki\u00a0server\u00a0tcp\u00a010.0.10.10\u00a0port\u00a01333\u00a0refresh\u00a0600</code></p> <p>Sl\u00e5 av Validation of BGP Prefixes men ladda ner RPKI Information.</p> <p><code>bgp\u00a0bestpath\u00a0prefix-validate\u00a0disable</code></p> <p>Till\u00e5t Invalid Prefixes som Best Path.</p> <p><code>bgp\u00a0bestpath\u00a0prefix-validate\u00a0allow-invalid</code></p> <p>Announce RPKI information mha Extended Community</p> <p><code>neighbor\u00a01.1.1.1\u00a0announce\u00a0rpki\u00a0state</code></p> <p>Verify</p> <p><code>show\u00a0ip\u00a0bgp\u00a0rpki\u00a0servers</code> <code>show\u00a0ip\u00a0bgp\u00a0rpki\u00a0table</code> <code>clear\u00a0ip\u00a0bgp\u00a0rpki\u00a0server</code></p> <p>IOS-XR Fr.o.m. XR 6.5.1 \u00e4r origin-as validation disabled by default.</p> <p><code>router\u00a0bgp\u00a01</code> <code>rpki\u00a0server\u00a010.0.0.10</code> <code>transport\u00a0tcp\u00a0port\u00a03323</code> <code>refresh-time\u00a0600</code> <code>!</code> <code>bgp\u00a0bestpath\u00a0origin-as\u00a0use\u00a0validity</code> <code>bgp\u00a0bestpath\u00a0origin-as\u00a0allow\u00a0invalid</code> <code>address-family\u00a0ipv4\u00a0unicast</code> <code>bgp\u00a0origin-as\u00a0validation\u00a0signal\u00a0ibgp</code></p> <p>Verify</p> <p><code>show\u00a0bgp\u00a0rpki\u00a0summary</code></p>"},{"location":"cisco/Cisco_BGP/#route-server","title":"Route Server","text":"<p>BGP route server \u00e4r feature designad f\u00f6r internet exchange (IX) operators som ger ett alternativ till full eBGP mesh peering inne p\u00e5 IXP. Det tillhandah\u00e5ller route reflection med support f\u00f6r unik policy per service provider. Route server ger transparens f\u00f6r AS-path, MED och next-hop s\u00e5 SPs som peerar med varandra fortfarande kan g\u00f6ra det som directly connected men IX route server medlar denna peering. Detta \u00e4r osynligt utanf\u00f6r IX. Route server leder till mindre konfiguration samt CPU/minnesanv\u00e4ndning p\u00e5 varje border router.</p> <p><code>router\u00a0bgp\u00a01337</code> <code>neighbor\u00a010.0.0.1\u00a0remote-as\u00a0100</code> <code>neighbor\u00a010.0.0.2\u00a0remote-as\u00a0200</code></p> <p><code>address-family\u00a0ipv4\u00a0unicast</code> <code>neighbor\u00a010.0.0.1\u00a0activate</code> <code>neighbor\u00a010.0.0.1\u00a0route-server-client</code> <code>neighbor\u00a010.0.0.2\u00a0activate</code> <code>neighbor\u00a010.0.0.2\u00a0route-server-client</code></p> <p><code>show\u00a0ip\u00a0bgp\u00a0ipv4\u00a0unicast\u00a0route-server\u00a0all\u00a0summary</code></p> <p>Default s\u00e5 nekar en router uppdateringar fr\u00e5n en eBGP-peer som inte har det egna ASN i b\u00f6rjan av as-path. Detta g\u00f6r att en route servers beteende inte \u00e4r okej s\u00e5 denna check m\u00e5ste st\u00e4ngas av p\u00e5 alla border router.</p> <p><code>router\u00a0bgp\u00a0100</code> <code>no\u00a0bgp\u00a0enforce-first-as</code> <code>neighbor\u00a010.0.0.137\u00a0remote-as\u00a01337</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_BIER/","title":"Cisco BIER","text":"<p>Bit Indexed Explicit Replication (RFC 8279). En router som supporterar BIER kallas Bit-Forwarding Router (BFR).</p> <p>N\u00e5gra f\u00f6rdelar med BIER:</p> <ul> <li>No Reverse Path Forwarding (RPF) checks</li> <li>No Rendezvous Points</li> <li>No shared tree -&gt; source tree switchover</li> <li>No receiver driven tree building</li> <li>State is in the packet and not in the network.</li> </ul> <p>Se \u00e4ven Cisco Multicast.</p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_CEF/","title":"Cisco CEF","text":"<p>Cisco Express Forwarding \u00e4r switchingteknik som \u00e4r framtagen f\u00f6r att \u00f6ka prestandan p\u00e5 Ciscos routrar och L3-switchar. I tidernas begynnelse fanns endast process switching, d\u00e5 beh\u00f6vde varenda paket kollas upp i routingtabellen vart det skulle. L2-information f\u00f6r next-hop (som finns i en annan tabell) beh\u00f6vde ocks\u00e5 tas fram. Ibland kr\u00e4vs rekursiva iterationer av lookupen f\u00f6r att identifiera r\u00e4tt next-hop och egress interface. Detta kan vara v\u00e4ldigt intensivt f\u00f6r CPU s\u00e5 en variant med cachefunktion utvecklades. Med fast switching behandlas det f\u00f6rsta paket p\u00e5 samma s\u00e4tt som med process switching men resultatet av lookupen sparas i en route cache, designad f\u00f6r att vara snabb. Den inneh\u00e5ller destination IP, next-hop information och L2 information till framen som ska skickas. Route once, forward many times. Den stora nackdelen \u00e4r att om det kommer in m\u00e5nga nya paket blir det \u00e4nd\u00e5 tungt f\u00f6r CPU och entries i cachen timear ut ganska fort f\u00f6r annars skulle cachen kunna g\u00e5 full och allt skulle bli process switched igen. CEF l\u00f6ser detta genom att proaktivt l\u00e4gga entries i en cache som programmeras p\u00e5 ASIC. Routing-information fr\u00e5n Routing Information Base (RIB), Route Processor (RP) och line card (LC) databases anv\u00e4nds f\u00f6r express forwarding. CEF har \u00e4ven m\u00f6jlighet att g\u00f6ra rekursiva uppslag i RIB, dvs n\u00e4r primary path g\u00e5r ner kan next longest matching path anv\u00e4ndas, detta \u00e4r anv\u00e4ndbart om next-hop finns multipla hopp bort och det g\u00e5r att n\u00e5 via flera v\u00e4gar. I nyare IOS:er finns det inte st\u00f6d f\u00f6r unicast fast switching. When IPv6 routing is enabled, CEFv6 is automatically enabled.</p> <p><code>show\u00a0cef\u00a0state</code></p>"},{"location":"cisco/Cisco_CEF/#fib","title":"FIB","text":"<p>CEF har tv\u00e5 nyckelkomponenter, FIB och Adjacency. L2 address resolution tas direkt fr\u00e5n CEF med ip cef optimize neighbor resolution, det \u00e4r p\u00e5 default.</p> <p><code>show\u00a0ip\u00a0cef</code> <code>show\u00a0ipv6\u00a0cef</code> <code>clear\u00a0cef\u00a0table\u00a0ipv4</code></p> <p>Adjacency</p> <p><code>show\u00a0adjacency</code></p> <p>Kolla en specifik route</p> <p><code>show\u00a0ip\u00a0cef\u00a0exact-route</code><code>source</code><code></code><code>destination</code> <code>show\u00a0ip\u00a0cef\u00a0exact-route\u00a010.0.0.5\u00a0172.16.1.2</code></p> <p>Consistency</p> <p><code>test\u00a0cef\u00a0table\u00a0consistency</code> <code>show\u00a0cef\u00a0table\u00a0consistency-check</code></p>"},{"location":"cisco/Cisco_CEF/#load-sharing","title":"Load Sharing","text":"<p>Per-destination load balancing anv\u00e4nds default. Ett problem med att alla anv\u00e4nder samma metod f\u00f6r att v\u00e4lja v\u00e4g uppst\u00e5r n\u00e4r hash algoritmen p\u00e5 flera noder v\u00e4ljer en viss v\u00e4g och redundanta v\u00e4gar d\u00e4rmed inte anv\u00e4nds, detta kallas CEF polarization. F\u00f6r att undvika detta anv\u00e4nder numera CEF default en algoritm som v\u00e4ljer ett slumpat Universal ID som sedan anv\u00e4nds som seed f\u00f6r hashen.</p> <p><code>ip\u00a0cef\u00a0load-sharing\u00a0algorithm</code> <code>include-ports\u00a0\u00a0Algorithm\u00a0that\u00a0includes\u00a0layer\u00a04\u00a0ports</code> <code>original\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Original\u00a0algorithm</code> <code>tunnel\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Algorithm\u00a0for\u00a0use\u00a0in\u00a0tunnel\u00a0only\u00a0environments</code> <code>universal\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Algorithm\u00a0for\u00a0use\u00a0in\u00a0most\u00a0environments</code></p>"},{"location":"cisco/Cisco_CEF/#interface","title":"Interface","text":"<p>CEF</p> <p><code>ip\u00a0cef</code> <code>show\u00a0ip\u00a0interface\u00a0|\u00a0i\u00a0protocol|CEF</code></p> <p>Fast-switched</p> <p><code>int\u00a0gi1</code> <code>no\u00a0ip\u00a0route-cache\u00a0cef</code></p> <p>Process-switched</p> <p><code>int\u00a0gi1</code> <code>no\u00a0ip\u00a0route-cache</code></p> <p>Debug</p> <p><code>debug\u00a0ip\u00a0packet\u00a0detail</code></p> <p>F\u00f6r detta kr\u00e4vs att CEF st\u00e4ngs av, no ip route-cache</p>"},{"location":"cisco/Cisco_CEF/#dcef","title":"dCEF","text":"<p>Med Distributed CEF s\u00e5 har alla line cards egna kopior av FIB och adjacency table, p\u00e5 s\u00e5 s\u00e4tt kan de g\u00f6ra express forwarding sj\u00e4lva och beh\u00f6ver inte fr\u00e5ga main processor.</p> <p><code>show\u00a0cef\u00a0linecard</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_CSR/","title":"Cisco CSR","text":"<p>Cisco Cloud Services Router 1000V \u00e4r en mjukvarurouter. CSR har DPDK integrerat i dataplane och k\u00f6r IOS-XE, samma OS som ASR 1000. Unlicensed Cisco IOS XE 3.13S och senare har en throughput begr\u00e4nsad till 100 kbps (show platform hardware throughput level).</p>"},{"location":"cisco/Cisco_CSR/#installation","title":"Installation","text":"<p>Ladda ned mjukvaran fr\u00e5n Ciscos hemsida, download</p> <ul> <li>VMware ESXi: Deploy OVF template.</li> </ul> <ul> <li>KVM: Qemu image (.qcow2) finns att ladda ner     direkt.</li> </ul> <p>Licens Ladda ner licens fr\u00e5n cisco (http:/www.cisco.com/go/license) och l\u00e4gg in p\u00e5 bootflash p\u00e5 enheten. Det finns 60 dagars eval-licens.</p> <p><code>license\u00a0install\u00a0bootflash:lic25ax.lic</code> <code>show\u00a0license\u00a0detail</code></p>"},{"location":"cisco/Cisco_CSR/#konfiguration","title":"Konfiguration","text":"<p>H\u00e4r listas CSR-specifik info, f\u00f6r \u00f6vrig konfiguration se Cisco IOS.</p> <p>Nyare CSR har ett modernt webbgr\u00e4nssnitt som man kan anv\u00e4nda f\u00f6r att managera och monitorera enheten.</p> <p><code>ip\u00a0http\u00a0server</code> <code>http://10.0.10.1/webui/</code></p>"},{"location":"cisco/Cisco_CSR/#resurser","title":"Resurser","text":"<p>CPU Show processes inside the IOS daemon.</p> <p><code>show\u00a0processes\u00a0cpu\u00a0sorted</code></p> <p>Show processes for the underlying operating system.</p> <p><code>show\u00a0processes\u00a0cpu\u00a0platform\u00a0sorted</code></p> <p>Increase the control-plane CPU</p> <p><code>platform\u00a0resource\u00a0control-plane-heavy</code></p> <p>Memory</p> <p><code>show\u00a0memory\u00a0platform</code></p> <p>Increase the Cisco IOS XE memory</p> <p><code>platform\u00a0memory\u00a0add\u00a03286</code></p> <p>NIC</p> <p><code>show\u00a0platform\u00a0software\u00a0vnic-if\u00a0interface-mapping</code></p>"},{"location":"cisco/Cisco_CSR/#uppgradering","title":"Uppgradering","text":"<p>F\u00f6r att uppgradera en CSR laddar man ner nyare bin-fil och l\u00e4gger p\u00e5 local storage.</p> <p><code>copy</code><code>http://</code><code>fileserver</code><code>/csr1000v-universalk9.03.16.04b.S.155-3.S4b-ext.SPA.bin\u00a0bootflash:</code> <code>verify\u00a0bootflash:csr1000v-universalk9.03.16.04b.S.155-3.S4b-ext.SPA.bin</code></p> <p><code>boot\u00a0system\u00a0flash\u00a0bootflash:csr1000v-universalk9.03.16.04b.S.155-3.S4b-ext.SPA.bin</code> <code>show\u00a0bootvar</code> <code>reload</code></p>"},{"location":"cisco/Cisco_CSR/#rest-api","title":"REST API","text":"<p>Standard port for IOS XE REST API: 55443</p> <p><code>virtual-service\u00a0csr_mgmt</code> <code>ip\u00a0shared\u00a0host-interface\u00a0GigabitEthernet1</code> <code>activate</code></p> <p>Verify</p> <p><code>show\u00a0virtual-service</code> <code>show\u00a0virtual-service\u00a0detail\u00a0|\u00a0i\u00a0API</code> <code>show\u00a0remote-management\u00a0status</code></p> <p>URL-exempel {| class=\"wikitable\" ! URL || Method |- | /api/v1/global/running-config || GET |- | /api/v1/global/save-config || PUT |- | /api/v1/global/cli || PUT |- | /api/v1/vrf || GET |- | /api/v1/routing-svc/bgp/100/neighbors || GET |}</p> <p>CURL curl -X POST https://10.0.10.1:55443/api/v1/auth/token-services -H \"Accept:application/json\" -u \"cisco:cisco\" --insecure</p> <p><code>curl\u00a0-X\u00a0GET</code><code>https://10.0.10.1:55443/api/v1/interfaces</code><code>-H\u00a0\"X-auth-token:+gcg41pecdAvyeBPGmvOPN4yfLIZ55D+sdYPJKPzlT8=\"\u00a0--insecure</code></p> <p>Tokens automatically expire after 15 minutes.</p>"},{"location":"cisco/Cisco_CSR/#netconf","title":"NETCONF","text":"<p>Legacy NETCONF, port 22.</p> <p><code>netconf\u00a0ssh</code></p> <p>Enable NETCONF/YANG support, port 830.</p> <p><code>netconf-yang</code></p> <p>Discover capabilities</p> <p><code>from\u00a0ncclient\u00a0import\u00a0manager</code> <code>m\u00a0=\u00a0manager.connect(host='192.168.1.21',\u00a0port=830,\u00a0username='cisco',</code> <code>password='cisco',\u00a0device_params={'name':\u00a0'CSR'})</code> <code>print\u00a0m.server_capabilities</code></p>"},{"location":"cisco/Cisco_CSR/#hypervisor","title":"Hypervisor","text":"<p>IOS-XE har numera st\u00f6d f\u00f6r att sj\u00e4lv k\u00f6ra virtuella maskiner, dvs agera hypervisor. Om man k\u00f6r p\u00e5 en CSR gl\u00f6m ej Hardware Assisted Virtualization.</p> <p>F\u00f6rberedelser, l\u00e4gga in OVA p\u00e5 routerns lokala storage samt:</p> <p><code>virtual-service</code> <code>signing\u00a0level\u00a0unsigned</code></p> <p>Installera paket</p> <p><code>virtual-service\u00a0install\u00a0name\u00a0Fedora\u00a0package\u00a0bootflash:Fedora.ova</code> <code>show\u00a0virtual-service\u00a0list</code></p> <p>F\u00f6r att ge VM:en konnektivitet med outside world skapar man en Virtual Port Group.</p> <p><code>int\u00a0virtualportGroup\u00a01</code> <code>ip\u00a0add\u00a010.0.10.1\u00a0255.255.255.0</code></p> <p>Starta VM</p> <p><code>activate</code></p> <p>Anslut till console p\u00e5 VM</p> <p><code>virtual-service\u00a0connect\u00a0name\u00a0Fedora\u00a0console</code></p> <p>Aktivera shell</p> <p><code>guestshell\u00a0enable</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_DHCP/","title":"Cisco DHCP","text":"<p>Dynamic Host Configuration Protocol (RFC 2131) \u00e4r ett protokoll som dynamiskt distribuerar n\u00e4tverkskonfiguration.</p> <p>Bakgrund DHCP har utvecklats fr\u00e5n Bootstrap protocol (RFC 951) som i sin tur har utvecklats pga tillkortakommanden hos Reverse ARP. Alla tre protokoll bygger p\u00e5 att klienten initialt broadcastar en discovery och servern svarar med en IP-adress. RARP fungerar precis som ARP men fr\u00e5gar efter sin egen MAC-adress och har satt IP till 0.0.0.0. Servern m\u00e5ste vara f\u00f6rkonfigurerad med klientens MAC-adress och en IP-adress. Servern m\u00e5ste \u00e4ven befinna sig i samma L2-dom\u00e4n som klienten. BOOTP togs fram f\u00f6r att f\u00f6rb\u00e4ttra processen med adresstilldelning till klienter. Det anv\u00e4nder helt egna meddelanden och rullar p\u00e5 IP och UDP. Den stora f\u00f6rdelen mot RARP \u00e4r att det g\u00e5r att tilldela klienterna subn\u00e4tmask, default gateway, DNS-servrar och boot-server (h\u00f6rs p\u00e5 namnet att det funkar). BOOTP-discovery g\u00e5r \u00e4ven att forwarda till andra subn\u00e4t. Den stora nackdelen \u00e4r att det har samma administrativa b\u00f6rda som RARP, dvs alla MAC-adresser och IP-adresser m\u00e5ste f\u00f6rkonfigureras p\u00e5 servern. N\u00e4sta steg \u00e4r i utvecklingen \u00e4r DHCP.</p> <p>DHCP anv\u00e4nder samma format som BOOTP, dvs servrar lyssnar p\u00e5 UDP port 67 och klienter kommunicerar fr\u00e5n UDP port 68, men har satsat mer p\u00e5 att vara dynamisk. Det uppn\u00e5s med pooler, leasing och adress\u00e5tervinning. Det finns \u00e4ven extensions f\u00f6r att registrera klienters FQDN till DNS.</p>"},{"location":"cisco/Cisco_DHCP/#paket","title":"Paket","text":"-   Discover    [](/File:Cisco_DHCP_Discover.png \"wikilink\")     -   Offer    [](/File:Cisco_DHCP_Offer.png \"wikilink\")     -   Request    [](/File:Cisco_DHCP_Request.png \"wikilink\")     -   ACK    [](/File:Cisco_DHCP_ACK.png \"wikilink\")     -   Release    [](/File:Cisco_DHCP_Release.png \"wikilink\")"},{"location":"cisco/Cisco_DHCP/#server","title":"Server","text":"<p>Cisco IOS DHCP server Default \u00e4r DHCP-tj\u00e4nsten p\u00e5 och besvarar alla f\u00f6rfr\u00e5gningar fr\u00e5n n\u00e4t som det finns en pool f\u00f6r men det g\u00e5r att st\u00e4nga av helt.</p> <p><code>no\u00a0service\u00a0dhcp</code> <code>ip\u00a0dhcp\u00a0bootp\u00a0ignore</code></p> <p>Konfiguration Exclude IP Addresses, Create DHCP Address Pool, Specify the Network, Set DNS Server, Set the Default Gateway</p> <p><code>ip\u00a0dhcp\u00a0excluded-address\u00a0[start\u00a0ip-address]\u00a0[end\u00a0ip-address]</code> <code>ip\u00a0dhcp\u00a0pool\u00a0[poolname]</code> <code>network\u00a0[ip-address]\u00a0[subnet-mask]</code> <code>dns-server\u00a0[ip-address\u00a0of\u00a0primary\u00a0dns-server]\u00a0[ip-address\u00a0of\u00a0secondary\u00a0dns-server]</code> <code>default-router\u00a0[ip-address]</code> <code>lease\u00a01\u00a0\u00a0#days</code> <code>exit</code></p> <p>Enskild klient, man m\u00e5ste matcha p\u00e5 client id.</p> <p><code>ip\u00a0dhcp\u00a0pool\u00a0R1</code> <code>host\u00a010.0.0.11\u00a0255.255.255.0</code> <code>client-identifier\u00a00052.31</code></p> <p>Man kan l\u00e4gga databasen p\u00e5 flash.</p> <p><code>ip\u00a0dhcp\u00a0database\u00a0flash:/</code> <code>show\u00a0ip\u00a0dhcp\u00a0database</code></p> <p>Verify</p> <p><code>show\u00a0ip\u00a0dhcp\u00a0pool</code> <code>show\u00a0ip\u00a0dhcp\u00a0binding</code> <code>show\u00a0ip\u00a0dhcp\u00a0import</code></p> <p>Clear</p> <p><code>clear\u00a0ip\u00a0dhcp\u00a0binding\u00a0*</code></p> <p>L\u00e5t en IOS DHCP server acceptera requests med tomt giaddr-f\u00e4lt, t.o.m. om option 82 \u00e4r satt (se nedan).</p> <p><code>ip\u00a0dhcp\u00a0relay\u00a0information\u00a0trust-all</code></p> <p>IOS kommer att arpa/pinga en pool-adress innan den assignas till en klient. Om det inte besvaras antar DHCP-servern att adressen \u00e4r ledig och kan d\u00e4rmed dela ut den till en klient. Default \u00e4r 2 stycken pings men det g\u00e5r att st\u00e4nga av.</p> <p><code>ip\u00a0dhcp\u00a0ping\u00a0packets\u00a00</code></p> <p>IOS AutoInstall ip dhcp pool SWITCH-DEPLOY</p> <p><code>network\u00a010.0.0.0\u00a0255.255.255.0</code> <code>option\u00a0150\u00a0ip\u00a010.1.1.10</code> <code>option\u00a067\u00a0ascii\u00a0configs/base_config.txt</code></p>"},{"location":"cisco/Cisco_DHCP/#klient","title":"Klient","text":"<p>Client-Identifier \u00e4r default en kombination av hardware address, interface name och cisco. Detta id g\u00f6rs om till en HEX-str\u00e4ng som presenteras f\u00f6r servern.</p> <p><code>interface\u00a0Ethernet\u00a01</code> <code>ip\u00a0dhcp\u00a0client\u00a0client-id\u00a0ascii\u00a0R1</code> <code>ip\u00a0address\u00a0dhcp</code></p> <p>Verify</p> <p><code>show\u00a0dhcp\u00a0lease</code></p> <p>Release &amp; Renew Release-kommandot g\u00f6r att det skickas 3 stycken Release-meddelanden unicast till DHCP-servern. N\u00e4r renew-kommandot anv\u00e4nds skickar klienten en unicast DHCP Request, g\u00e4llande samma IP, till servern som d\u00e5 kan v\u00e4lja att acka det eller ej.</p> <p><code>release\u00a0dhcp\u00a0ethernet\u00a03/1</code> <code>renew\u00a0dhcp\u00a0ethernet\u00a03/1</code></p> <p>Broadcast, best\u00e4m om broadcastbiten ska vara satt till 1 eller 0, dvs att DHCP-svaren skickas tillbaka med broadcast eller unicast. Default \u00e4r detta p\u00e5slaget till skillnad fr\u00e5n m\u00e5nga andra operativsystem.</p> <p><code>ip\u00a0dhcp-client\u00a0broadcast-flag</code></p> <p>AD, konfigurera vad default routen man f\u00e5r med DHCP ska ha f\u00f6r administrative distance. Default \u00e4r 254.</p> <p><code>ip\u00a0dhcp-client\u00a0default-router\u00a0distance\u00a0&lt;1-255&gt;</code></p>"},{"location":"cisco/Cisco_DHCP/#relay","title":"Relay","text":"<p>G\u00f6r om broadcast till unicast vilket m\u00f6jligg\u00f6r att man kan ha en central DHCP-server ist\u00e4llet f\u00f6r en p\u00e5 varje n\u00e4t. Relay m\u00e5ste ha interface-konf ip dhcp relay information trusted f\u00f6r att acceptera paket med option 82 satt, av t.ex. en switch.</p> <p><code>interface\u00a0Ethernet\u00a01</code> <code>ip\u00a0helper-address\u00a010.0.0.10</code></p> <p>Allows the DHCP relay agent to switch the gateway address (giaddr field of a DHCP packet) to secondary addresses when there is no DHCPOFFER message from a DHCP server.</p> <p><code>ip\u00a0dhcp\u00a0smart-relay</code></p> <p>Verify</p> <p><code>show\u00a0ip\u00a0helper-address</code></p>"},{"location":"cisco/Cisco_DHCP/#snooping","title":"Snooping","text":"<p>DHCP snooping \u00e4r en s\u00e4kerhetsmekanism f\u00f6r att filtrera bort untrusted DHCP-paket och h\u00e5lla koll p\u00e5 klienter genom att lyssna p\u00e5 DHCP-trafik och bygga en DHCP snooping binding database. Snooping hindrar rogue DHCP servers fr\u00e5n att svara p\u00e5 requests och skyddar mot klienter som beg\u00e4r v\u00e4ldigt m\u00e5nga leases, dvs DOS-attack. Det kollar ocks\u00e5 att MAC-adressen i DHCP-paketet matchar adressen det kommer ifr\u00e5n samt kollar om release och decline kommer in p\u00e5 r\u00e4tt portar enligt binding database. Paket som inte kommer fr\u00e5n r\u00e4tt port filtreras. Vissa andra s\u00e4kerhetsmekanismer anv\u00e4nder sig av informationen i snooping binding database, se IP Source Guard och Dynamic ARP Inspection.</p> <p>Man m\u00e5ste sl\u00e5 p\u00e5 Switch DHCP snooping och sedan DHCP snooping f\u00f6r varje vlan man vill skydda.</p> <p><code>ip\u00a0dhcp\u00a0snooping</code> <code>ip\u00a0dhcp\u00a0snooping\u00a0vlan\u00a010</code></p> <p>Globala default-inst\u00e4llningar</p> <p><code>no\u00a0ip\u00a0dhcp\u00a0snooping\u00a0information\u00a0option\u00a0allow-untrusted</code> <code>ip\u00a0dhcp\u00a0snooping\u00a0information\u00a0option</code> <code>no\u00a0ip\u00a0dhcp\u00a0snooping\u00a0database</code> <code>ip\u00a0dhcp\u00a0snooping\u00a0database\u00a0write-delay\u00a0300</code> <code>ip\u00a0dhcp\u00a0snooping\u00a0database\u00a0timeout\u00a0300</code> <code>ip\u00a0dhcp\u00a0snooping\u00a0verify\u00a0mac-address</code> <code>ip\u00a0dhcp\u00a0snooping\u00a0verify\u00a0no-relay-agent-address</code></p> <p>De interface som har en legit DHCP-server m\u00e5ste trustas. Man kan \u00e4ven s\u00e4tta en rate limit p\u00e5 DHCP-paket.</p> <p><code>interface\u00a0gi1</code> <code>ip\u00a0dhcp\u00a0snooping\u00a0trust</code> <code>ip\u00a0dhcp\u00a0snooping\u00a0limit\u00a0rate\u00a010</code></p> <p>St\u00e4ng av option 82 om servern ej accepterar requests med giaddr 0.0.0.0. Om en router ser option 82 f\u00f6rv\u00e4ntar den sig non-zero giaddr.</p> <p><code>no\u00a0ip\u00a0dhcp\u00a0snooping\u00a0information\u00a0option</code></p> <p>L\u00e4gg databasen i en fil</p> <p><code>ip\u00a0dhcp\u00a0snooping\u00a0database\u00a0flash:/snooping.db</code></p> <p>Har man flera switchar i sin topologi m\u00e5ste downstream-portas trustas ocks\u00e5 (alternativt att option 82 st\u00e4ngs av).</p> <p><code>ip\u00a0dhcp\u00a0snooping\u00a0information\u00a0option\u00a0allow-untrusted</code></p> <p>Verify</p> <p><code>show\u00a0ip\u00a0dhcp\u00a0snooping</code></p> <p>Recovery</p> <p><code>errdisable\u00a0recovery\u00a0cause\u00a0dhcp-rate-limit</code></p>"},{"location":"cisco/Cisco_DHCP/#option-82","title":"Option 82","text":"<p>DHCP Relay Agent Information Option (RFC 3046) \u00e4r framtaget f\u00f6r att l\u00e5ta relay agent skicka med circuit specific information i requesten som forwardas till DHCP-servern. Det som skickas med \u00e4r exempelvis vilken ethernetport i switchen som requesten kom in p\u00e5 och mac-adress p\u00e5 relayen. Det \u00e4r p\u00e5slaget default om man k\u00f6r DHCP snooping vilket inneb\u00e4r att denna information samt giaddr 0.0.0.0 l\u00e4ggs till DHCP-paketen men det g\u00e5r att st\u00e4nga av med no ip dhcp snooping information option.</p> <p>"},{"location":"cisco/Cisco_DHCP/#dhcpv6","title":"DHCPv6","text":"<p>Med DHCPv6 anv\u00e4nds UDP port 546 f\u00f6r klienter och port 547 f\u00f6r servrar. Default gateway annonseras inte av DHCP utan det sk\u00f6ts av RA. DHCP-paketen har ocks\u00e5 uppdaterade namn:</p> <ul> <li>Solicit: Sent by a client to locate servers (FF02::1:2).</li> <li>Advertise: Sent by a server in response to a Solicit message to     indicate availability.</li> <li>Request: Sent by a client to request addresses or configuration     settings from a specific server.</li> <li>Reply: Sent by a server to a specific client in response to a     Solicit, Request, Renew, Rebind, Information-Request, Confirm,     Release, or Decline message.</li> </ul> <p>DHCPv6 rapid configuration only uses the Solicit and Reply message.</p> <p><code>ipv6\u00a0dhcp\u00a0server\u00a0DHCP_POOL\u00a0rapid-commit</code></p> <p>All_DHCP_Servers multicast group FF05::1:3.</p> <p><code>ipv6\u00a0dhcp\u00a0server\u00a0join\u00a0all-dhcp-servers</code></p>"},{"location":"cisco/Cisco_DHCP/#stateful","title":"Stateful","text":"<p>Functions exactly the same as IPv4 DHCP in which hosts receive both their IPv6 address and additional parameters from the DHCP server.</p> <p><code>ipv6\u00a0dhcp\u00a0pool\u00a0STATEFUL</code> <code>address\u00a0prefix\u00a010::/64</code> <code>dns-server\u00a02001:4860:4860::8888</code> <code>domain-name\u00a0hackernet.se</code></p> <p>Interface</p> <p><code>interface\u00a0gi2</code> <code>ipv6\u00a0address\u00a010::1/64</code> <code>ipv6\u00a0dhcp\u00a0server\u00a0STATEFUL</code> <code>ipv6\u00a0nd\u00a0managed-config-flag</code> <code>ipv6\u00a0nd\u00a0prefix\u00a010::/64\u00a014400\u00a014400\u00a0no-autoconfig</code></p> <p>managed-config-flag s\u00e4tter en flagga i RA som s\u00e4ger att hostarna kan anv\u00e4nda DHCPv6. no-autoconfig s\u00e4ger att stateless configuration inte ska anv\u00e4ndas.</p>"},{"location":"cisco/Cisco_DHCP/#stateless","title":"Stateless","text":"<p>SLAAC is used to get the IP address and DHCP is used to obtain \u201cother\u201d configuration options, usually things like DNS, NTP, etc.</p> <p><code>ipv6\u00a0dhcp\u00a0pool\u00a0STATELESS</code> <code>dns-server\u00a02001:4860:4860::8888</code> <code>domain-name\u00a0hackernet.se</code></p> <p>Interface</p> <p><code>interface\u00a0gi2</code> <code>ipv6\u00a0address\u00a010::1/64</code> <code>ipv6\u00a0dhcp\u00a0server\u00a0STATELESS</code> <code>ipv6\u00a0nd\u00a0other-config-flag</code></p> <p>Verify</p> <p><code>show\u00a0ipv6\u00a0dhcp\u00a0pool</code></p>"},{"location":"cisco/Cisco_DHCP/#client","title":"Client","text":"<p>DHCPv6 client, server, och relay-funktionalitet \u00e4r mutually exclusive p\u00e5 ett interface.</p> <p><code>interface\u00a0gi3</code> <code>ipv6\u00a0enable</code> <code>ipv6\u00a0address\u00a0dhcp</code></p> <p>Verify</p> <p><code>show\u00a0ipv6\u00a0dhcp\u00a0interface</code></p>"},{"location":"cisco/Cisco_DHCP/#prefix-delegation","title":"Prefix Delegation","text":"<p>DHCPv6 Prefix Delegation kan anv\u00e4ndas f\u00f6r att mangera adresser p\u00e5 l\u00e4nkar och subn\u00e4t och anv\u00e4nder sig av prefix delegation options i DHCP-paketen. DHCPv6 client application fr\u00e5gar efter PD, det fungerar b\u00e5de med stateful och stateless. Man har vanligtvis /56-prefix p\u00e5 servern och sedan kan klienten dela upp det och anv\u00e4nda f\u00f6r att assigna /64-n\u00e4t p\u00e5 flera av sina interface.</p> <ul> <li>IANA: Identity Association for Non Temporary address</li> <li>IAPD: Identity Association for Prefix Delegation</li> </ul> <p>Server</p> <p><code>ipv6\u00a0local\u00a0pool\u00a0PREFIX1\u00a02001:192:168::/48\u00a056</code> <code>ipv6\u00a0dhcp\u00a0pool\u00a0POOL</code> <code>prefix-delegation\u00a0pool\u00a0PREFIX1</code></p> <p><code>interface\u00a0gi2</code> <code>ipv6\u00a0dhcp\u00a0server\u00a0POOL</code></p> <p>Klient</p> <p><code>interface\u00a0gi2</code> <code>description\u00a0Uplink\u00a0to\u00a0DHCP\u00a0server</code> <code>ipv6\u00a0dhcp\u00a0client\u00a0pd\u00a0SERVER_PREFIX</code></p> <p><code>interface\u00a0gi3</code> <code>ipv6\u00a0address\u00a0SERVER_PREFIX\u00a0::1:0:0:0:101/64</code> <code>interface\u00a0gi4</code> <code>ipv6\u00a0address\u00a0SERVER_PREFIX\u00a0::2:0:0:0:101/64</code></p>"},{"location":"cisco/Cisco_DHCP/#nx-os","title":"NX-OS","text":"<p><code>feature\u00a0dhcp</code></p> <p>Relay</p> <p><code>interface\u00a0vlan\u00a015</code> <code>ip\u00a0dhcp\u00a0relay\u00a0address\u00a010.0.0.10</code></p> <p>Verify</p> <p><code>show\u00a0ip\u00a0dhcp\u00a0relay</code></p> <p>Smart relay</p> <p><code>ip\u00a0dhcp\u00a0smart-relay\u00a0global</code></p> <p>NX-OS har st\u00f6d f\u00f6r olika Option 82 suboptions n\u00e4r DHCP-paket skickas till DHCP-server.</p> <p><code>ip\u00a0dhcp\u00a0relay\u00a0information\u00a0option</code> <code>ip\u00a0dhcp\u00a0relay\u00a0sub-option\u00a0type\u00a0cisco</code> <code>ip\u00a0dhcp\u00a0relay\u00a0information\u00a0option\u00a0vpn</code></p>"},{"location":"cisco/Cisco_DHCP/#authorized-arp","title":"Authorized ARP","text":"<p>Man kan l\u00e5ta DHCP-processen populera ARP-cachen, dvs ta MAC-IP-mappningar fr\u00e5n DHCP-databasen. Med Authorized ARP st\u00e4ngs den vanliga dynamiska ARP:n av p\u00e5 interfacen.</p> <p><code>ip\u00a0dhcp\u00a0pool\u00a0NAME</code> <code>update\u00a0arp</code> <code>int\u00a0gi2</code> <code>arp\u00a0authorize</code> <code>arp\u00a0timeout</code> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_DMVPN/","title":"Cisco DMVPN","text":"<p>Dynamic Multipoint VPN \u00e4r en skalbar VPN-teknik som kan bygga tunnlar dynamiskt. M\u00e5let \u00e4r att tillhandah\u00e5lla any-to-any kommunikation utan att beh\u00f6va en manuellt konfigurerad full-mesh av point-to-point tunnels. Tekniker som anv\u00e4nds \u00e4r mGRE, NHRP och CEF som anv\u00e4nds i kombination med routingprotokoll och IPsec. Det har bl.a. st\u00f6d f\u00f6r VRF, Multicast, QoS och load balancing. Det g\u00e5r k\u00f6ra IPv6 \u00f6ver tunnlar som byggs med IPv4, dvs private address = IPv6, NBMA address = IPv4.</p>"},{"location":"cisco/Cisco_DMVPN/#topologier","title":"Topologier","text":"<p>Hub and spoke</p> <ul> <li>single hub single dmvpn</li> <li>dual hub dual dmvpn</li> <li>server load balancing</li> </ul> <p>Dynamic Mesh</p> <ul> <li>dual hub single dmvpn</li> <li>multihub single dmvpn</li> <li>hierarchical</li> </ul> <p>Varje DMVPN \u00e4r ett IP-n\u00e4t och man kan designa det p\u00e5 olika s\u00e4tt. T.ex. med dual hub single dmvpn s\u00e5 \u00e4r hub2-router hubb men konfas ocks\u00e5 som klient till hub1-router.</p>"},{"location":"cisco/Cisco_DMVPN/#nhrp","title":"NHRP","text":"<p>Next Hop Resolution Protocol (RFC 2332). NHRP-processen p\u00e5 hubben agerar server och h\u00e5ller databasen med de externa IP-adresserna som alla spokes har. Varje spoke registrerar sin IP som en klient till hubben. Beh\u00f6ver en spoke skicka paket till n\u00e5got bakom en annan spoke fr\u00e5gar den hubben om den andres externa IP-adress s\u00e5 den kan bygga en tunnel (f\u00f6rslagsvis med IPsec) direkt. F\u00f6r detta kr\u00e4vs allts\u00e5 inget routingprotokoll utan det sk\u00f6ts av NHRP. Man kan se NHRP som ARP fast det mappar IP till NBMA IP ist\u00e4llet f\u00f6r IP till MAC.</p> <p>NHRP har st\u00f6d f\u00f6r autentisering, detta konfigureras under tunnel-interfacet.</p> <p><code>ip\u00a0nhrp\u00a0authentication\u00a0NHRP_AUTH_STRING</code></p>   Registration request:    [](/File:Cisco_NHRP_Registration_Request.png \"wikilink\")     Registration reply:    [](/File:Cisco_NHRP_Registration_Reply.png \"wikilink\")     Resolution request:    [](/File:Cisco_NHRP_Resolution_Request.png \"wikilink\")"},{"location":"cisco/Cisco_DMVPN/#konfiguration","title":"Konfiguration","text":"<p>DMVPN kan fungera p\u00e5 olika s\u00e4tt och detta kallas olika faser.</p>"},{"location":"cisco/Cisco_DMVPN/#fas-1","title":"Fas 1","text":"<p>Hub and Spoke: Med Fas 1 anv\u00e4nds mGRE p\u00e5 hubb och p2p GRE p\u00e5 spokes. Inga tunnlar s\u00e4tts upp dynamiskt och all trafik g\u00e5r igenom hubben, enda f\u00f6rdelen \u00e4r n\u00e5got simplare konfiguration.</p> <p>Static mapping Hub</p> <p><code>interface\u00a0Tunnel0</code> <code>ip\u00a0nhrp\u00a0map\u00a0multicast\u00a0172.16.15.X</code> <code>ip\u00a0nhrp\u00a0map\u00a0192.168.0.X\u00a0172.16.15.X</code></p> <p>Spoke</p> <p><code>interface\u00a0Tunnel0</code> <code>ip\u00a0nhrp\u00a0map\u00a0192.168.0.X\u00a0172.16.15.2</code> <code>tunnel\u00a0destination\u00a0172.16.15.2</code></p> <p>Dynamic mapping Hub</p> <p><code>interface\u00a0Tunnel0</code> <code>ip\u00a0nhrp\u00a0map\u00a0multicast\u00a0dynamic</code></p> <p>Spoke</p> <p><code>interface\u00a0Tunnel0</code> <code>ip\u00a0nhrp\u00a0map\u00a0192.168.0.1\u00a0172.16.15.2</code> <code>ip\u00a0nhrp\u00a0nhs\u00a0192.168.0.1</code> <code>tunnel\u00a0destination\u00a0172.16.15.2</code></p> <p>Verify</p> <p><code>show\u00a0dmvpn</code></p>"},{"location":"cisco/Cisco_DMVPN/#fas-2","title":"Fas 2","text":"<p>Hub and Spoke with Spoke-to-Spoke tunnels: Routingprotokollet p\u00e5 spokes l\u00e4r sig prefix direkt av varandra p\u00e5 tunneln. Forwarding g\u00f6rs spoke-to-spoke, man anv\u00e4nder IGP ist\u00e4llet f\u00f6r NHRP. Det finns scenarion d\u00e5 CEF kan beh\u00f6vas st\u00e4ngas av p\u00e5 spokes. Med Fas 2 anv\u00e4nds mGRE. Fas 2 g\u00e5r ocks\u00e5 att k\u00f6ra som static och d\u00e5 nhrp-mappas alla grannskap manuellt.</p> <p>Hub</p> <p><code>interface\u00a0Tunnel0</code> <code>ip\u00a0address\u00a0192.168.0.1\u00a0255.255.255.0</code> <code>ip\u00a0nhrp\u00a0map\u00a0multicast\u00a0dynamic</code> <code>ip\u00a0nhrp\u00a0network-id\u00a01</code> <code>tunnel\u00a0source\u00a0172.16.15.2</code> <code>tunnel\u00a0mode\u00a0gre\u00a0multipoint</code></p> <p>Spoke</p> <p><code>interface\u00a0Tunnel0</code> <code>ip\u00a0address\u00a0192.168.0.2\u00a0255.255.255.0</code> <code>ip\u00a0nhrp\u00a0network-id\u00a01</code> <code>ip\u00a0nhrp\u00a0nhs\u00a0192.168.0.1\u00a0nbma\u00a0172.16.15.2\u00a0multicast</code> <code>tunnel\u00a0source\u00a010.10.10.10</code> <code>tunnel\u00a0mode\u00a0gre\u00a0multipoint</code></p> <p>Verify</p> <p><code>show\u00a0dmvpn</code> <code>show\u00a0ip\u00a0nhrp</code> <code>show\u00a0ip\u00a0nhrp\u00a0nhs\u00a0redundancy</code> <code>clear\u00a0ip\u00a0nhrp</code></p> <p>Kolla ip nhrp registration timeout ifall recovery tar l\u00e5ng tid efter en clear</p>"},{"location":"cisco/Cisco_DMVPN/#fas-3","title":"Fas 3","text":"<p>Scalable Infrastructure: Routingprotokoll p\u00e5 spokes pratar med hubben f\u00f6r att l\u00e4ra sig prefix samt ha som next-hop men NHRP kickar in och redirectar trafiken direkt mellan spokes. Med Fas 3 anv\u00e4nds mGRE. Det \u00e4r mest skalbart och CEF beh\u00f6ver aldrig st\u00e4ngas av tack vare NHRP Shortcut eftersom CEF entry skrivs om efter redirect message. Det \u00e4r inte ett unikt meddelande i sig utan hub skickar vidare resolution request till den spoke som \u00e4r l\u00e4mplig. Hub: ip nhrp redirect Spoke: ip nhrp shortcut</p> <p>Hub</p> <p><code>interface\u00a0Tunnel0</code> <code>ip\u00a0address\u00a0192.168.0.1\u00a0255.255.255.0</code> <code>ip\u00a0nhrp\u00a0map\u00a0multicast\u00a0dynamic</code> <code>ip\u00a0nhrp\u00a0network-id\u00a01</code> <code></code><code>ip`` ``nhrp`` ``redirect</code> <code>tunnel\u00a0source\u00a0172.16.15.2</code> <code>tunnel\u00a0mode\u00a0gre\u00a0multipoint</code></p> <p>Spoke</p> <p><code>interface\u00a0Tunnel0</code> <code>ip\u00a0address\u00a0192.168.0.2\u00a0255.255.255.0</code> <code>ip\u00a0nhrp\u00a0network-id\u00a01</code> <code>ip\u00a0nhrp\u00a0nhs\u00a0192.168.0.1\u00a0nbma\u00a0172.16.15.2\u00a0multicast</code> <code></code><code>ip`` ``nhrp`` ``shortcut</code> <code>tunnel\u00a0source\u00a010.10.10.10</code> <code>tunnel\u00a0mode\u00a0gre\u00a0multipoint</code></p> <p>Verify</p> <p><code>show\u00a0dmvpn</code> <code>show\u00a0ip\u00a0nhrp</code> <code>show\u00a0ip\u00a0nhrp\u00a0nhs\u00a0redundancy</code> <code>clear\u00a0ip\u00a0nhrp</code></p> <p>Kolla ip nhrp registration timeout ifall recovery tar l\u00e5ng tid efter en clear</p>"},{"location":"cisco/Cisco_DMVPN/#ipv6","title":"IPv6","text":"<p>B\u00e5de underlay och overlay kan k\u00f6ras med IPv6. Detta \u00e4r oberoende av fas.</p> <p>Hub</p> <p><code>interface\u00a0Tunnel0</code> <code>ipv6\u00a0address\u00a0192:168:1::1/64</code> <code>ipv6\u00a0nhrp\u00a0map\u00a0multicast\u00a0dynamic</code> <code>ipv6\u00a0nhrp\u00a0network-id\u00a01</code> <code>tunnel\u00a0source\u00a02000:192:168:1::1</code> <code>tunnel\u00a0mode\u00a0gre\u00a0multipoint</code><code>ipv6</code></p> <p>Spoke</p> <p><code>interface\u00a0Tunnel0</code> <code>ipv6\u00a0address\u00a0192:168:1::2/64</code> <code>ipv6\u00a0nhrp\u00a0network-id\u00a01</code> <code>ipv6\u00a0nhrp\u00a0nhs\u00a0192:168:1::1\u00a0nbma\u00a02000:192:168:1::1\u00a0multicast</code> <code>tunnel\u00a0source\u00a02000:10:10::10</code> <code>tunnel\u00a0mode\u00a0gre\u00a0multipoint</code><code>ipv6</code></p> <p>Verify</p> <p><code>show\u00a0dmvpn\u00a0ipv6</code> <code>show\u00a0ipv6\u00a0nhrp</code></p>"},{"location":"cisco/Cisco_DMVPN/#ipsec","title":"IPsec","text":"<p>Vill man skydda sin trafik kan man kryptera all tunneltrafik. Se \u00e4ven Cisco IPsec.</p> <p><code>crypto\u00a0isakmp\u00a0policy\u00a010</code> <code>encryption\u00a0aes\u00a0256</code> <code>authentication\u00a0pre-share</code> <code>hash\u00a0sha512</code> <code>group\u00a014</code></p> <p><code>crypto\u00a0isakmp\u00a0key\u00a0SECRET\u00a0address\u00a00.0.0.0\u00a00.0.0.0</code></p> <p><code>crypto\u00a0ipsec\u00a0transform-set\u00a0AES256_SHA512\u00a0esp-sha512-hmac\u00a0esp-aes\u00a0256</code> <code>mode\u00a0transport</code></p> <p><code>crypto\u00a0ipsec\u00a0profile\u00a0DMVPN</code> <code>set\u00a0transform-set\u00a0AES256_SHA512</code></p> <p><code>interface\u00a0Tunnel0</code> <code>tunnel\u00a0protection\u00a0ipsec\u00a0profile\u00a0DMVPN</code></p> <p>Verify</p> <p><code>show\u00a0crypto\u00a0isakmp\u00a0sa</code> <code>show\u00a0crypto\u00a0ipsec\u00a0sa</code> <code>show\u00a0crypto\u00a0socket</code> <code>show\u00a0crypto\u00a0map</code></p> <p>F\u00f6r att effektivisera krypteringen p\u00e5 en hub n\u00e4r man k\u00f6r dual dmvpn kan man anv\u00e4nda en delad socket f\u00f6r crypto-anslutningarna.</p> <p><code>tunnel\u00a0protection\u00a0ipsec\u00a0profile\u00a0DMVPN</code><code>shared</code></p>"},{"location":"cisco/Cisco_DMVPN/#gdoi-based-dmvpn","title":"GDOI-based DMVPN","text":"<p>Med vanlig DMVPN s\u00e4tts det upp en permanent IPsec-tunnel mellan hubb - spoke och dynamiska tunnlar mellan spokes. N\u00e4r en spoke-to-spoke tunnel s\u00e4tts upp blir det lite delay pga IPSec negotiation, f\u00f6r att slippa det kan man anv\u00e4nda GDOI. D\u00e5 \u00e4r hubb och spokes Group Members. Group Keys och security policies distribueras till GMs av Key Server som t.ex. kan vara en separat IOS-router bakom hubb. Se \u00e4ven GET VPN.</p> <p>Key Server</p> <p><code>crypto\u00a0key\u00a0generate\u00a0rsa\u00a0general-keys\u00a0label\u00a0GDOI\u00a0modulus\u00a02048\u00a0exportable</code></p> <p><code>crypto\u00a0isakmp\u00a0policy\u00a010</code> <code>authentication\u00a0pre-share</code></p> <p><code>crypto\u00a0isakmp\u00a0key\u00a00\u00a0SECRET\u00a0address\u00a02.2.2.2</code> <code>crypto\u00a0isakmp\u00a0key\u00a00\u00a0SECRET\u00a0address\u00a03.3.3.3</code> <code>crypto\u00a0isakmp\u00a0key\u00a00\u00a0SECRET\u00a0address</code> <p><code>crypto\u00a0ipsec\u00a0transform-set\u00a0PHASE2\u00a0esp-aes\u00a0esp-sha-hmac</code></p> <p><code>crypto\u00a0ipsec\u00a0profile\u00a0GDOI_PROFILE</code> <code>set\u00a0transform-set\u00a0PHASE2</code></p> <p><code>ip\u00a0access-list\u00a0extended\u00a0ACL_GRE</code> <code>permit\u00a0gre\u00a0any\u00a0any</code></p> <p><code>crypto\u00a0gdoi\u00a0group\u00a0GDOI_GROUP</code> <code>identity\u00a0number\u00a0123</code> <code>server\u00a0local</code> <code>rekey\u00a0transport\u00a0unicast</code> <code>rekey\u00a0authentication\u00a0mypubkey\u00a0rsa\u00a0GDOI</code> <code>rekey\u00a0retransmit\u00a060\u00a0number\u00a02</code> <code>sa\u00a0ipsec\u00a01</code> <code>profile\u00a0GDOI_PROFILE</code> <code>match\u00a0address\u00a0ipv4\u00a0ACL_GRE</code> <code>replay\u00a0time\u00a0window-size\u00a05</code> <code>address\u00a0ipv4\u00a01.1.1.1</code></p> <p>Hubb och Spoke</p> <p><code>crypto\u00a0isakmp\u00a0policy\u00a010</code> <code>authentication\u00a0pre-share</code></p> <p><code>crypto\u00a0isakmp\u00a0key\u00a00\u00a0SECRET\u00a0address\u00a01.1.1.1</code></p> <p><code>crypto\u00a0gdoi\u00a0group\u00a0GDOI</code> <code>identity\u00a0number\u00a0123</code> <code>server\u00a0address\u00a0ipv4\u00a01.1.1.1</code></p> <p><code>crypto\u00a0map\u00a0DMVPN\u00a0local-address\u00a0Loopback0</code> <code>crypto\u00a0map\u00a0DMVPN\u00a010\u00a0gdoi</code> <code>set\u00a0group\u00a0GDOI</code></p> <p><code>interface\u00a0Gi2</code> <code>description\u00a0Tunnel\u00a0Source</code> <code>crypto\u00a0map\u00a0DMVPN</code></p> <p>Verify</p> <p><code>show\u00a0crypto\u00a0gdoi</code></p>"},{"location":"cisco/Cisco_DMVPN/#routingprotokoll","title":"Routingprotokoll","text":"<p>EIGRP Med Fas 1 kan man antingen st\u00e4nga av split-horizon eller skicka en default route fr\u00e5n hub.</p> <p>Med EIGRP i Fas 2 m\u00e5ste man st\u00e4nga av split-horizon och next-hop-self p\u00e5 tunnel-interfacet f\u00f6r att uppdateringar och routing mellan spokes ska funka. Nackdelen \u00e4r att man inte kan summera routes p\u00e5 hub utan att bryta spoke-to-spoke-kommunikation utan d\u00e5 m\u00e5ste allt g\u00e5 igenom hub.</p> <p><code>interface\u00a0Tunnel0</code> <code>no\u00a0ip\u00a0next-hop-self\u00a0eigrp\u00a0100</code> <code>no\u00a0ip\u00a0split-horizon\u00a0eigrp\u00a0100</code></p> <p>Med fas 3 kommer endast det f\u00f6rsta paketet att g\u00e5 via hub tack vare nhrp redirect/shortcut och man kan skicka ut aggregerade routes p\u00e5 hub utan att p\u00e5verka spoke-to-spoke. Detta \u00e4r bra design.</p> <p>OSPF Det g\u00e5r att anv\u00e4nda point-to-multipoint p\u00e5 hubbens tunnel-interface och p2p p\u00e5 spoksen bara man ser till att timers matchar. Alternativt kan man k\u00f6ra ip ospf network non-broadcast p\u00e5 alla. Alternativt broadcast bara man ser till att hubb \u00e4r DR. Det man b\u00f6r ha i \u00e5tanke \u00e4r att beroende p\u00e5 n\u00e4tverkstyp s\u00e5 \u00e4ndras next-hop eller ej. OSPF \u00e4r inget optimalt protokoll f\u00f6r DMVPN.</p> <p>Hub</p> <p><code>interface\u00a0Tunnel0</code> <code>ip\u00a0ospf\u00a0network\u00a0broadcast</code> <code>ip\u00a0ospf\u00a0priority\u00a0255</code></p> <p>Spoke, ska inte vara med i DR-election.</p> <p><code>interface\u00a0Tunnel0</code> <code>ip\u00a0ospf\u00a0network\u00a0broadcast</code> <code>ip\u00a0ospf\u00a0prio\u00a00</code></p> <p>BGP Med Fas 1 och BGP m\u00e5ste next-hop-self anv\u00e4ndas p\u00e5 alla grannskap.</p> <p>Fas 2 och BGP-konfiguration \u00e4r som vanligt men f\u00f6r eBGP mellan spokes m\u00e5ste multihop anv\u00e4ndas.</p> <p><code>neighbor\u00a02.2.2.2\u00a0ebgp-multihop\u00a02</code></p> <p>RIP Med Fas 1 och RIP beh\u00f6ver split horizon st\u00e4ngas av p\u00e5 hubb.</p>"},{"location":"cisco/Cisco_DMVPN/#others","title":"Others","text":""},{"location":"cisco/Cisco_DMVPN/#monitoring","title":"Monitoring","text":"<p>Man kan \u00f6vervaka sitt DMVPN med hj\u00e4lp av SNMP.</p> <p><code>snmp-server\u00a0enable\u00a0traps\u00a0nhrp\u00a0nhs</code> <code>snmp-server\u00a0enable\u00a0traps\u00a0nhrp\u00a0nhc</code> <code>snmp-server\u00a0enable\u00a0traps\u00a0nhrp\u00a0nhp</code></p> <p>N\u00e4r man anv\u00e4nder if-state nhrp p\u00e5 en spoke kan den kolla om NHRP-registreringen fungerar och p\u00e5 s\u00e5 s\u00e4tt veta om interfacet ska vara up eller ej n\u00e4r man k\u00f6r fas 2 eller 3. Detta fungerar ej p\u00e5 hub interface f\u00f6r det g\u00f6r ingen registrering utan \u00e4r alltid up.</p> <p><code>interface\u00a0tun0</code> <code>if-state\u00a0nhrp</code></p> <p>P\u00e5 nyare IOS (XE 16.3) kan man \u00e4ven anv\u00e4nda BFD f\u00f6r snabbare feldetektering och NHRP kan d\u00e5 registrera sig som klient till BFD-processen.</p> <p><code>interface\u00a0Tunnel0</code> <code>bfd\u00a0interval\u00a01000\u00a0min_rx\u00a01000\u00a0multiplier\u00a05</code></p> <p><code>router\u00a0eigrp\u00a01</code> <code>bfd\u00a0interface\u00a0Tunnel0</code></p> <p><code>show\u00a0nhrp\u00a0interfaces\u00a0\u00a0\u00a0#hidden</code></p>"},{"location":"cisco/Cisco_DMVPN/#nat","title":"NAT","text":"<p>Man kan k\u00f6ra all sorts nat p\u00e5 spokes men p\u00e5 hubb fungerar endast static nat. Om en spoke befinner sig bakom dynamisk nat, dvs att dennes NBMA-adress kan \u00e4ndras s\u00e5 kan man st\u00e4nga av unique flag i NHRP-registreringen. Detta g\u00f6rs med ip nhrp registration no-unique p\u00e5 spoke vilket g\u00f6r att den registrerade NBMA-adressen f\u00e5r \u00e4ndras i efterhand vilket inte \u00e4r fallet default. Befinner sig tv\u00e5 spokes bakom PAT s\u00e5 kommer de ej att kunna uppr\u00e4tta n\u00e5gon spoke-to-spoke tunnel mellan varandra. N\u00e4r man k\u00f6r NAT med DMVPN s\u00e5 m\u00e5ste IPsec transport mode anv\u00e4ndas. Se \u00e4ven Cisco NAT.</p> <p><code>interface\u00a0tun0</code> <code>ip\u00a0nhrp\u00a0registration\u00a0no-unique</code></p>"},{"location":"cisco/Cisco_DMVPN/#vrf","title":"VRF","text":"<p>Man kan bygga det precis som man vill routingm\u00e4ssigt genom att separera underlay och overlay i olika VRF:er (detta kallas ocks\u00e5 front door VRF). Detta m\u00f6jligg\u00f6r t.ex. att ha default route \u00f6ver DMVPN utan att f\u00e5 problem med recursive routing. I \u00f6vrigt g\u00f6rs konfiguration som vanligt.</p> <p><code>vrf\u00a0definition\u00a0UNDERLAY</code> <code>address-family\u00a0ipv4</code> <code>exit</code></p> <p><code>crypto\u00a0keyring\u00a0VRF_AWARE_PSK\u00a0vrf\u00a0UNDERLAY</code> <code>pre-shared-key\u00a0address\u00a00.0.0.0\u00a00.0.0.0\u00a0key\u00a0DMVPN</code></p> <p><code>interface\u00a0Tunnel0</code> <code>tunnel\u00a0vrf\u00a0UNDERLAY</code></p> <p>Verify</p> <p><code>show\u00a0crypto\u00a0session\u00a0fvrf\u00a0UNDERLAY</code> <code>show\u00a0crypto\u00a0session\u00a0ivrf</code></p>"},{"location":"cisco/Cisco_DMVPN/#mpls","title":"MPLS","text":"<p>Man kan k\u00f6ra MPLS \u00f6ver DMVPN och d\u00e4rmed MPLS VPN, detta kallas 2547oDMVPN. Det man ska t\u00e4nka p\u00e5 \u00e4r att label switch path m\u00e5ste vara hub-to-spoke, dvs om man vill ha kommunikation mellan tv\u00e5 spokes m\u00e5ste det g\u00e5 spoke-hub-spoke. T.ex. om man k\u00f6r BGP f\u00e5r man anv\u00e4nda next-hop-self all f\u00f6r att s\u00e4kerst\u00e4lla att MPLS VPN-trafik alltid g\u00e5r igenom hub. Man f\u00f6rlorar dynamiska tunnlar men man kan ha riktig PE-funkionalitet \u00f6ver DMVPN.</p> <p><code>mpls\u00a0ip</code> <code>mpls\u00a0ldp\u00a0router-id\u00a0loopback0</code></p> <p><code>interface\u00a0tunnel0</code> <code>mpls\u00a0ip</code></p>"},{"location":"cisco/Cisco_DMVPN/#per-tunnel-qos","title":"Per-Tunnel QoS","text":"<p>Med Per-Tunnel QoS feature kan man ha en egress QoS-policy p\u00e5 hubb p\u00e5 tunnelinstansen som man kan konfigurera antingen per endpoint eller per spoke. Detta g\u00f6r att man kan shapea trafiken till enskilda spokes med en parent policy och sedan skilja p\u00e5 de individuella datafl\u00f6dena i tunneln med en child policy. Innan man konfigurerar detta m\u00e5ste man ha en fungerande DMVPN-upps\u00e4ttning.</p> <p>Class default shaper policy map f\u00e5r endast inneh\u00e5lla class class-default och shape-kommando.</p> <p><code>policy-map\u00a0Parent1</code> <code>class\u00a0class-default</code> <code>shape\u00a0average\u00a01000000</code> <code>service-policy\u00a0Child1</code></p> <p>Man kan anv\u00e4nda NHRP f\u00f6r att b\u00e4ra information om vilken spoke som ska ha vilken QoS-policy. Definiera en NHRP-grupp p\u00e5 spokes och mappa sedan den till en policy p\u00e5 hubb.</p> <p>Spoke 1</p> <p><code>interface\u00a0Tunnel0</code> <code>ip\u00a0nhrp\u00a0group\u00a0GROUP1</code></p> <p>Hub</p> <p><code>interface\u00a0Tunnel0</code> <code>ip\u00a0nhrp\u00a0map\u00a0group\u00a0GROUP1\u00a0service-policy\u00a0output\u00a0Parent1</code> <code>ip\u00a0nhrp\u00a0map\u00a0group\u00a0GROUP2\u00a0service-policy\u00a0output\u00a0Parent2</code></p> <p>Verify</p> <p><code>show\u00a0policy-map\u00a0multipoint</code> <code>show\u00a0dmvpn\u00a0detail</code> <code>show\u00a0tunnel\u00a0endpoints\u00a0|\u00a0i\u00a0Endpoint|QoS</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_EIGRP/","title":"Cisco EIGRP","text":"<p>EIGRP \u00e4r ett avancerat distance vector routingprotokoll. Det \u00e4r utvecklat av Cisco och har varit helt properit\u00e4rt men \u00e4r sedan 2013 sl\u00e4ppt, dock bara som Informational RFC. EIGRP anv\u00e4nder ett eget IP-protokoll (88) p\u00e5 lager 4, Reliable Transport Protocol. Det finns flera skillnader som g\u00f6r EIGRP avsev\u00e4rt mycket b\u00e4ttre \u00e4n legacy-protokollet IGRP. IGRP st\u00f6djer inte VLSM, discontiguous networks, manuell summering eller grannskap. Det kan uppst\u00e5 routing loopar, konvergerar l\u00e5ngsamt och retransmittar inte tappade paket. IGRP fattar inte heller 0.0.0.0/0 som en default route. F\u00f6r topologiutr\u00e4kningar anv\u00e4nds DUAL och EIGRP anv\u00e4nder b\u00e5de unicast och multicast. Kolla versioner p\u00e5 EIGRP-komponenter: show eigrp plugins</p> <p>Type: Distance Vector</p> <p>Algorithm: DUAL</p> <p>AD: 90, 170</p> <p>Protocols: IP</p> <p>Packets: 7</p>"},{"location":"cisco/Cisco_EIGRP/#packets","title":"Packets","text":"<p>EIGRP anv\u00e4nder 7 olika typer av RTP-paket f\u00f6r att kommunicera. EIGRP-paket byggs med TLV:er f\u00f6r att g\u00f6ra det flexibelt. F\u00f6rutom route entries inneh\u00e5ller de \u00e4ven f\u00e4lt f\u00f6r DUAL-processen, multicast-sekvensering och IOS-version.</p> <ul> <li>Hello: Skickas till multicast 224.0.0.10/FF02::A var 5:e sekund     f\u00f6r keepalive samt inneh\u00e5ller grundl\u00e4ggande info s\u00e5 som AS, IP-n\u00e4t,     K-v\u00e4rden, authentication f\u00f6r att grannskap ska kunna uppr\u00e4ttas.</li> </ul> <ul> <li>Acknowledgement: De flesta typer av paket \u00e4r viktiga att de     kommer fram som de ska, d\u00e4rf\u00f6r finns det en Acknowledgement-mekanism     i EIGRP. F\u00f6ljande pakettyper kommer att besvaras med en Ack: Update,     Query, Reply, SIA-query och SIA-reply. Pga detta kallas de paketen     f\u00f6r Reliable Packets. Acknowledgement skickas alltid med unicast och     om det \u00e4r ett Hello-paket s\u00e5 \u00e4r det ett tomt Hello som endast     inneh\u00e5ller sekvensnumret f\u00f6r Acken. Det g\u00e5r \u00e4ven att skicka med     sekvensnumret f\u00f6r acken med andra paket, t.ex. om en router b\u00e5de     beh\u00f6ver skicka en uppdatering och acka ett paket kan det g\u00f6ras i     samma utskick. Alla paket kan anv\u00e4ndas f\u00f6r Ack s\u00e5l\u00e4nge de \u00e4r     unicast.</li> </ul> <ul> <li>Update: Under den f\u00f6rsta fasen i ett grannskap n\u00e4r hela     databasen ska utbytas anv\u00e4nds unicast. D\u00e4refter anv\u00e4nds multicast,     f\u00f6rutom p\u00e5 point-to-point och med statiska grannar. Alla Updates     ackas.</li> </ul> <ul> <li>Query: Med Query-paket kan en router ta hj\u00e4lp av sina grannar     f\u00f6r att hitta b\u00e4sta routen till en destination. Det skickas default     ut med multicast p\u00e5 multiaccess-segment. Om en granne inte ackar     Queryn kommer Queryn att skickas till den med unicast. Det \u00e4r \u00e4ven     unicast p\u00e5 point-to-point-l\u00e4nkar eller ifall man har manuellt     konfigurerade grannar.</li> </ul> <ul> <li>Reply: Anv\u00e4nds som svar p\u00e5 Query-paket och inneh\u00e5ller info om     distance till det som har fr\u00e5gats efter.</li> </ul> <ul> <li>Stuck-in-Active Query: Om en granne tar l\u00e5ng tid p\u00e5 sig att     svara p\u00e5 en Reply kan man ta reda p\u00e5 om grannen \u00e4r d\u00f6d eller jobbar     p\u00e5 Replyen genom att skicka en SIA-Query. En SIA-Query kommer alltid     att svaras p\u00e5 omedelbart \u00e4ven om det sker routing-omr\u00e4kningar.</li> </ul> <ul> <li>Stuck-in-Active Reply: Ett svar p\u00e5 en SIA-Query kallas SIA-Reply     och f\u00e5r man tillbaka ett s\u00e5nt vet man att grannen lever och d\u00e5     resettas timern f\u00f6r computation, detta ger grannen lite mer tid. Man     kan konfigurera hur l\u00e4nge en route kan vara aktiv, default \u00e4r 3     minuter:</li> </ul> <p><code>timers\u00a0active-time</code> <code>show\u00a0eigrp\u00a0protocols\u00a0|\u00a0i\u00a0Active</code> <p>Verify</p> <p><code>show\u00a0ip\u00a0eigrp\u00a0traffic</code></p> <p>Default f\u00e5r 50% av interfacebandbredden anv\u00e4ndas f\u00f6r EIGRP-trafik.</p> <p><code>ip\u00a0bandwidth-percent\u00a0eigrp\u00a0100\u00a050</code></p>"},{"location":"cisco/Cisco_EIGRP/#path-selection","title":"Path Selection","text":"<p>Computed Distance: den totala metricen f\u00f6r att n\u00e5 destination via en s\u00e4rskild granne, dvs reported distance fr\u00e5n granne plus distance till grannen.</p> <p>Feasible Distance: en \"notering\" av den l\u00e4gsta k\u00e4nda computed distance sedan routens senaste \u00f6verg\u00e5ng fr\u00e5n Active till Passive. FD beh\u00f6ver med andra ord inte n\u00f6dv\u00e4ndigtvis vara samma som nuvarande CD. FD har routrarna koll p\u00e5 lokalt f\u00f6r att s\u00e4kerst\u00e4lla loopfria v\u00e4gar, det skickas aldrig till n\u00e5gon annan.</p> <p>Advertised/Reported Distance: hur l\u00e5ngt en granne rapporterar (metric) att det \u00e4r till en destination router, dvs grannens b\u00e4sta v\u00e4g.</p> <p>Feasibility Condition: Om FD \u00e4r satt till t.ex. 2000 s\u00e5 vet routern att n\u00e5gong\u00e5ng fanns det en g\u00e5ngbar och loopfri v\u00e4g till destination med distance s\u00e5 l\u00e5gt som 2000. Det betyder att alla grannar som tillhandah\u00f6ll denna v\u00e4g m\u00e5ste ha varit \u00e4nnu n\u00e4rmare destinationen, dvs RD m\u00e5ste ha varit l\u00e4gre \u00e4n 2000. Alla grannar som hade distance 2000 eller l\u00e4gre m\u00e5ste ha varit s\u00e4kra att anv\u00e4nda eftersom de aldrig skulle skicka tillbaka det, varken direkt eller via n\u00e5gon annan. Om RD \u00e4r mindre \u00e4n FD s\u00e5 vet man att det \u00e4r en loopfri v\u00e4g. Detta \u00e4r en requirement som m\u00e5ste uppfyllas f\u00f6r att en route ska kunna hamna i routingtabellen.</p> <p>Successor: de b\u00e4sta routesen och som hamnar i routingtabellen. Default \u00e4r detta de med l\u00e4gst metric och som uppfyller feasibility condition.</p> <p>Feasible Successor: alternativa (inte de b\u00e4sta) routes som uppfyller feasibility condition. EIGRP f\u00e5r anv\u00e4nda dessa men g\u00f6r inte det default.</p> <p>Kolla CD, FD och RD.</p> <p><code>show\u00a0ip\u00a0eigrp\u00a0topology</code></p> <p>Kolla grannar som inte uppfyller feasibility condition.</p> <p><code>show\u00a0ip\u00a0eigrp\u00a0topology\u00a0all-links</code></p>"},{"location":"cisco/Cisco_EIGRP/#dual","title":"DUAL","text":"<p>N\u00e4r EIGRP tappar en successor kollas det genast i topologitabellen efter en Feasible Successor. Finns det en blir den successor och det meddelas till \u00f6vriga grannar. Detta kallas local computation och g\u00e5r fort samt \u00e4r CPU-sn\u00e5lt. Finns det d\u00e4remot ingen skickas det ut queries till alla grannar efter alternativa v\u00e4gar. Routen blir aktiv och detta kallas diffused computation. Har grannen k\u00e4nnedom om en annan path svarar den p\u00e5 queryn men om den inte har det f\u00e5r den i sin tur fr\u00e5ga sina grannar, och s\u00e5 vidare. Om mottagande router inte har n\u00e5gra andra grannar att fr\u00e5ga svarar den direkt med metric satt till inifinty. En route \u00e4r aktiv tills alla har svarat. Det b\u00e4sta s\u00e4ttet att l\u00f6sa Stuck-in-Active problem \u00e4r en strukturerad IP-plan f\u00f6r att kunna summera manuellt s\u00e5 mycket som m\u00f6jligt. Ju mer summering ju mindre m\u00e5ste EIGRP jobba vid konvergens.</p> <p><code>show\u00a0ip\u00a0eigrp\u00a0topology\u00a0active</code></p> <p>Stuck in active?</p> <p><code>debug\u00a0eigrp\u00a0packet\u00a0terse</code></p> <p>Med named mode kan sl\u00e5 graceful restart f\u00f6r stuck-in-active neighbors.</p> <p><code>address-family\u00a0ipv4\u00a0as\u00a0100</code> <code>soft-sia</code></p>"},{"location":"cisco/Cisco_EIGRP/#metrics","title":"Metrics","text":"<p>EIGRP anv\u00e4nder flera typer av metrics, s\u00e5 kallade component metrics. De klassiska \u00e4r bandwidth, load, delay, reliability, MTU och hop count. De f\u00f6rsta fyra kan anv\u00e4ndas f\u00f6r att r\u00e4kna fram composite metric aka cost eller distance.</p> <p>Bandwidth: \u00e4r en statisk metric som s\u00e4tts per interface med bandwidth-kommandot. S\u00e4tter man ingen bandwidth manuellt s\u00e5 kollar routern p\u00e5 vad ethernet har l\u00e4nkat upp i. F\u00f6r att r\u00e4kna ut bandwidth-metricen till en destination tar man den l\u00e4gsta bandwidthen l\u00e4ngst v\u00e4gen. Man j\u00e4mf\u00f6r vad grannen har skickat f\u00f6r bandwidth med ens egen bandwidth till den grannen och anv\u00e4nder det l\u00e4gre v\u00e4rdet till DUAL samt vidareannonsering. P\u00e5 s\u00e5 s\u00e4tt k\u00e4nner man till den l\u00e4gsta bandbredden l\u00e4ngs v\u00e4gen. Det \u00e4r inte rekommenderat att p\u00e5verka path selection med hj\u00e4lp av manuell bandwidth-konfiguration i produktionsmilj\u00f6!</p> <p><code>interface\u00a0gi0/3</code> <code>bandwidth</code> <p>Load: \u00e4r ett dynamiskt v\u00e4rde som IOS s\u00e4tter p\u00e5 interface. Eftersom ingress och egress kan vara olika lastade h\u00e5lls tv\u00e5 skilda v\u00e4rden f\u00f6r detta. F\u00f6r att r\u00e4kna p\u00e5 detta till composite metric anv\u00e4nds h\u00f6gsta Txload, routern j\u00e4mf\u00f6r v\u00e4rdet den f\u00e5r in med sin Txload p\u00e5 det interfacet och v\u00e4ljer det h\u00f6gre v\u00e4rdet. Det triggas ingen uppdatering ifall load pl\u00f6tsligt skulle \u00e4ndras. Denna metric anv\u00e4nds ej default.</p> <p><code>show\u00a0interface\u00a0gi0/3\u00a0|\u00a0i\u00a0load</code></p> <p>Delay: \u00e4r en statisk metric som s\u00e4tts per interface med delay-kommandot. Detta \u00e4r inget som dynamiskt \u00e4ndras, t.ex. utifr\u00e5n paketstorlek, utan \u00e4r en uppskattning av genomsnittlig f\u00f6rdr\u00f6jning. S\u00e4tter man inte detta manuellt s\u00e5 assignar IOS ett v\u00e4rde p\u00e5 varje interface. F\u00f6r att r\u00e4kna ut totalen till en destination s\u00e5 adderar man v\u00e4rdet man f\u00e5r av sin granne med delayen p\u00e5 interfacet till grannen, dvs all delay l\u00e4ngs v\u00e4gen adderas ihop. Med klassisk metric kan detta ha 1-167772214 tiotal mikrosekunder. 167772215 \u00e4r infinite distance och med detta kan man annonsera ut unreachable network. Det \u00e4r s\u00e5 man l\u00f6ser Split Horizon with Poisoned Revered och withdrawing a route, man skickar det med delay 167772215 tiotal mikrosekunder.</p> <p><code>interface\u00a0gi0/3</code> <code>delay</code> <code>show\u00a0interface\u00a0gi0/3\u00a0|\u00a0i\u00a0DLY</code> <p>OBS Output \u00e4r i microseconds.</p> <p>Reliability: \u00e4r ett dynamiskt v\u00e4rde som IOS s\u00e4tter p\u00e5 interface. 255 \u00e4r h\u00f6gsta och betyder 100% reliability. Detta skickas med i EIGRP-paketen och det l\u00e4gsta v\u00e4rdet \u00e4r det som g\u00e4ller till composite metric, dvs man j\u00e4mf\u00f6r v\u00e4rdet man f\u00e5r in med det man sj\u00e4lv har p\u00e5 det interfacet. Dock triggas ingen uppdatering ifall reliability pl\u00f6tsligt skulle \u00e4ndras. Denna metric anv\u00e4nds ej default.</p> <p><code>show\u00a0interface\u00a0gi0/3\u00a0|\u00a0i\u00a0reliability</code></p> <p>MTU skickas med i EIGRP-paketen men anv\u00e4nds ej p\u00e5 n\u00e5got s\u00e4tt.</p> <p>Hop Count: anv\u00e4nds som en s\u00e4kerhetsmekanism. G\u00e5r hop count \u00f6ver 100 (default) s\u00e5 \u00e4r det unreachable vilket g\u00f6r att o\u00e4ndliga loopar ej uppst\u00e5r. Det anv\u00e4nds ej p\u00e5 n\u00e5got s\u00e4tt f\u00f6r path selection eller composite metric.</p> <p>Composite metric Kolla composite och alla component metrics f\u00f6r ett prefix.</p> <p><code>show\u00a0ip\u00a0eigrp\u00a0topology\u00a010.2.2.0/28\u00a0|\u00a0b\u00a0Composite</code> <code>Composite\u00a0metric\u00a0is\u00a0(130816/128256),\u00a0route\u00a0is\u00a0Internal</code> <code>Vector\u00a0metric:</code> <code>Minimum\u00a0bandwidth\u00a0is\u00a01000000\u00a0Kbit</code> <code>Total\u00a0delay\u00a0is\u00a05010\u00a0microseconds</code> <code>Reliability\u00a0is\u00a0255/255</code> <code>Load\u00a0is\u00a01/255</code> <code>Minimum\u00a0MTU\u00a0is\u00a01500</code> <code>Hop\u00a0count\u00a0is\u00a01</code></p> <p>Wide Metrics Det finns Classic metrics och Wide metrics. De gamla metricen fungerar f\u00f6r hastigheter upp till 1Gbps eftersom d\u00e5 \u00e4r bandwidth satt till h\u00f6gsta v\u00e4rdet och delay till det l\u00e4gsta. Detta leder till att classic metrics inte kan skilja p\u00e5 t.ex. 1G och 10G. Wide Metrics l\u00f6ser detta och st\u00f6ds i Named Mode och om det anv\u00e4nds \u00e4r Metric Version = 64bit samt att det finns en K6.</p> <p><code>show\u00a0ip\u00a0protocols\u00a0|\u00a0i\u00a0Metric</code></p> <p>Eftersom wide metrics kan producera metrics som \u00e4r st\u00f6rre \u00e4n 32-bitar och RIBen st\u00f6djer metrics upp till 32-bitar dividerar man det med 128 innan det hamnar i RIBen samt presenteras av IOS show-kommandon. Detta g\u00e5r att \u00e4ndra per adressfamilj.</p> <p><code>address-family\u00a0...</code> <code>metric\u00a0rib-scale\u00a0128</code></p> <p>Throughput: (bandwidth) fungerar p\u00e5 exakt samma s\u00e4tt men nu \u00e4r referensbandbredden 655.36 Tbps.</p> <p>Load: Samma som classic.</p> <p>Latency: (delay) fungerar p\u00e5 samma s\u00e4tt men nu anv\u00e4nds picosekunder ist\u00e4llet f\u00f6r mikrosekunder.</p> <p>Reliability: Samma som classic.</p> <p>MTU: Samma som classic.</p> <p>Hop Count: Samma som classic.</p> <p>Extended Metrics: reserverad f\u00f6r framtida extensions. Finns Jitter, Energy och Quiescent Energy men de anv\u00e4nds inte.</p> <p>Computation formula</p> <ul> <li>k1 = bandwidth</li> <li>k2 = load</li> <li>k3 = delay</li> <li>k4 = reliability</li> <li>k5 = MTU</li> </ul> <p>Simplified default metric, legacy = 256 * (10^7/bandwidth + delay/10) Simplified default metric, wide = 65536 * (10^7/bandwidth + delay/1000000)</p> <p><code>show\u00a0eigrp\u00a0protocols\u00a0|\u00a0i\u00a0Metric</code></p> <p>\u00c4ndra vilka metrics som ska anv\u00e4ndas f\u00f6r EIGRP-processen</p> <p><code>metric\u00a0weights\u00a00\u00a01\u00a00\u00a01\u00a00\u00a00</code></p>"},{"location":"cisco/Cisco_EIGRP/#konfiguration","title":"Konfiguration","text":"<p>\u00c4ndrar man AD kommer alla grannskap att droppas och s\u00e4ttas upp p\u00e5 nytt.</p> <p><code>router\u00a0eigrp\u00a0100</code> <code>distance\u00a0eigrp\u00a090\u00a0170</code></p> <p>Logging av neighbor changes \u00e4r p\u00e5 default</p> <p><code>show\u00a0ip\u00a0eigrp\u00a0events\u00a0type</code></p> <p>Modernare konfigurationsformat</p> <p><code>eigrp\u00a0upgrade-cli</code></p> <p>Router ID Alla EIGRP-instanser m\u00e5ste ha ett router id, dock kan flera processer ha samma 32 bitars nummer (till skillnad fr\u00e5n OSPF). Fr\u00e5n b\u00f6rjan anv\u00e4ndes RID f\u00f6r att f\u00f6rhindra routingloopar vid multipoint redistribution eftersom man skickar med sin RID med de externa routes som man annonserar in i EIGRP och p\u00e5 s\u00e5 s\u00e4tt identifierar det originating router. Har alla redistributionsroutrar samma RID blir det ingen loop eftersom om man f\u00e5r in en route med samma RID som man sj\u00e4lv har discardas den. Numera anv\u00e4nds det ocks\u00e5 f\u00f6r intern EIGRP och man kan alltid se Originating router p\u00e5 alla prefix.</p> <p>ID v\u00e4ljs enligt f\u00f6ljande ordning och interfacen beh\u00f6ver inte vara n\u00e5bara eller ha n\u00e5got med EIGRP att g\u00f6ra utan alla interface j\u00e4mf\u00f6rs.</p> <ol> <li>router-id kommandot</li> <li>H\u00f6gsta IP-adressen p\u00e5 ett no-shut loopback interface</li> <li>H\u00f6gsta IP-adressen p\u00e5 ett no-shut interface</li> </ol> <p>ID \u00e4ndras endast n\u00e4r processen startas om eller router-id-kommandot k\u00f6rs men alla grannskap resettas vid RID-byte.</p> <p><code>show\u00a0eigrp\u00a0protocols\u00a0|\u00a0i\u00a0Router-ID</code></p> <p>Kolla om routes droppas pga duplicate RID</p> <p><code>show\u00a0eigrp\u00a0address-family\u00a0ipv4\u00a0events</code></p> <p>Debug</p> <p><code>debug\u00a0eigrp\u00a0packets\u00a0hello</code> <code>debug\u00a0eigrp\u00a0fsm</code></p>"},{"location":"cisco/Cisco_EIGRP/#adjacency","title":"Adjacency","text":"<p>EIGRP uppt\u00e4cker grannar dynamiskt och AS, K-values och authentication m\u00e5ste matcha. S\u00e5 fort man sl\u00e5r p\u00e5 EIGRP p\u00e5 ett interface b\u00f6rjar det skickas Hello-paket till multicast 224.0.0.10/FF02::A var 5:e sekund. S\u00e5 fort ett Hello har tagits emot s\u00e4tts grannen i pending state f\u00f6r att man inte ska acceptera routing-uppdateringar innan man \u00e4r s\u00e4ker p\u00e5 att det finns bidirectional connectivity. Om det finns en EIGRP-router p\u00e5 andra sidan kommer den att svara med ett Hello, sedan skickas en null update som har satt initialization bit f\u00f6r att signalera att dra ig\u00e5ng initialization process. D\u00e5 kommer en null update med init bit skickas tillbaka som \u00e4ven ackar den f\u00f6rsta. N\u00e4r sedan den andra updaten har ackats g\u00e5r grannskapet till \"Up\" och databassynkroniseringen drar ig\u00e5ng. N\u00e4r den \u00e4r klar kommer endast inkrementella uppdateringar att skickas i forts\u00e4ttningen. log-neighbor-changes \u00e4r p\u00e5slaget default.</p> <p>Interface vars IP-adress tr\u00e4ffas av network-kommandot blir EIGRP-enabled.</p> <p><code>network\u00a0[ip-address]\u00a0[wildcard-mask]</code></p> <p>Designate passive interfaces. Passive interfaces stoppar grannskap och d\u00e4rmed inl\u00e4rning av routes.</p> <p><code>passive-interface\u00a0default</code> <code>no\u00a0passive-interface\u00a0gi2</code> <code>show\u00a0ip\u00a0eigrp\u00a0interfaces\u00a0detail</code></p> <p>Det g\u00e5r \u00e4ven att \u00e4ndra timers per interface. Hold time s\u00e4ger hur l\u00e4nge en router maximalt ska v\u00e4nta mellan tv\u00e5 EIGRP-paket fr\u00e5n en granne. Kommer inget paket blir grannen unreachable och DUAL informeras. Default \u00e4r denna tid tre g\u00e5nger Hello interval, dvs 15 eller 180 sekunder beroende p\u00e5 interfacetyp. Hold time \u00e4ndras dock inte automatiskt ifall man \u00e4ndrar Hello time. Notera att detta inte \u00e4r en inst\u00e4llning som anv\u00e4nds lokalt utan ett \"advertised value\", om man s\u00e4tter hold time l\u00e4gre \u00e4n hello time kommer grannar att flappa.</p> <p><code>int\u00a0gi0/0</code> <code>ip\u00a0hello-interval\u00a0eigrp\u00a0100</code><code></code> <code>ip\u00a0hold-time\u00a0eigrp\u00a0100</code> <code>show\u00a0ip\u00a0eigrp\u00a0100\u00a0interfaces\u00a0detail\u00a0|\u00a0i\u00a0time</code> <p>Vissa n\u00e4tverk st\u00f6djer inte broadcast eller multicast d\u00e5 m\u00e5ste man manuellt konfigurera grannar och unicast anv\u00e4nds. N\u00e4r man konfigurerar en granne s\u00e5 disableas multicast p\u00e5 det interfacet som anv\u00e4nds f\u00f6r unicasten. Det g\u00e5r d\u00e4rf\u00f6r inte att kombinera unicast- och multicastgrannskap p\u00e5 ett delat segment.</p> <p><code>router\u00a0eigrp\u00a010</code> <code>neighbor\u00a010.0.1.1\u00a0gi0/0</code></p> <p>Verify</p> <p><code>show\u00a0ip\u00a0eigrp\u00a0neighbor</code></p> <p>Outputen inneh\u00e5ller flera tal.</p> <ul> <li>H (Handle): lokalt l\u00f6pnummer f\u00f6r grannar.</li> <li>SRTT (Smooth Round Trip Time): tid det tar att f\u00e5 tillbaka en ACK     fr\u00e5n granne, i millisekunder.</li> <li>RTO (Retransmit Time Out): hur l\u00e4nge eigrp v\u00e4ntar p\u00e5 ack innan ett     paket i k\u00f6n skickas om, i millisekunder. Efter 16 omskickade paket     utan ack blir det RETRY LIMIT EXCEEDED.</li> <li>Q Cnt Num: paket som inte har ackats hamnar i k\u00f6n. Detta \u00e4r 0 i ett     stabilt n\u00e4tverk.</li> </ul> <p>Om en router skickar en multicast-uppdatering som inte ackas av n\u00e5gon kommer den att v\u00e4nta RTO och sedan skicka en sequence TLV som instruerar den routern att inte lyssna efter multicast-paket mer. Sedan skickar den allt med unicast till den grannen tills den har ackat ifatt och d\u00e5 skickas \u00e5terigen en sequence TLV som s\u00e4ger att den ska lyssna p\u00e5 multicast igen.</p> <p>Route hold-timer best\u00e4mmer hur l\u00e4nge NSF-routrar som k\u00f6r EIGRP ska h\u00e5lla routes f\u00f6r inaktiva grannar.</p> <p><code>timers\u00a0graceful-restart\u00a0purge-time\u00a060</code></p>"},{"location":"cisco/Cisco_EIGRP/#authentication","title":"Authentication","text":"<p>MD5 authentication m\u00e5ste matcha f\u00f6r grannskap. Med Named mode finns \u00e4ven st\u00f6d f\u00f6r SHA-256.</p> <p><code>interface\u00a0[interface]</code> <code>ip\u00a0authentication\u00a0mode\u00a0eigrp\u00a0md5</code> <code>ip\u00a0authentication\u00a0key-chain\u00a0eigrp\u00a0[ASN]\u00a0[name-of-chain]</code></p> <p>Key rotation Key chain kan inneh\u00e5lla flera nycklar men endast l\u00e4gsta aktiva nyckeln anv\u00e4nds i EIGRP Hellos, Key ID m\u00e5ste d\u00e4rmed matcha.</p> <p><code>key\u00a0chain\u00a0ROTATION</code> <code>key\u00a010</code> <code>key-string\u00a0CISCO10</code> <code>accept-lifetime\u00a000:00:00\u00a0Jan\u00a01\u00a01993\u00a000:15:00\u00a0Jan\u00a01\u00a02030</code> <code>send-lifetime\u00a000:00:00\u00a0Jan\u00a01\u00a01993\u00a000:05:00\u00a0Jan\u00a01\u00a02030</code> <code>key\u00a020</code> <code>key-string\u00a0CISCO20</code> <code>accept-lifetime\u00a000:00:00\u00a0Jan\u00a01\u00a02030\u00a0infinite</code> <code>send-lifetime\u00a000:00:00\u00a0Jan\u00a01\u00a02030\u00a0infinite</code></p> <p><code>show\u00a0key\u00a0chain</code></p>"},{"location":"cisco/Cisco_EIGRP/#troubleshoot","title":"Troubleshoot","text":"<ul> <li>Uncommon subnet: de sitter inte i samma subn\u00e4t.</li> <li>K value mismatch: m\u00e5ste vara samma p\u00e5 b\u00e5da sidor.</li> <li>AS mismatch: m\u00e5ste vara samma p\u00e5 b\u00e5da sidor.</li> <li>Layer 2 issues.</li> <li>Access-list issues.</li> <li>NBMA.</li> <li>Authentication issues.</li> <li>Secondary addresses.</li> </ul> <p><code>ping\u00a0224.0.0.10</code></p> <p>Subnet mask beh\u00f6ver inte matcha f\u00f6r att grannskap ska bildas men d\u00e4remot blir topologitabellen felaktig vilket kan st\u00e4lla till det routingm\u00e4ssigt.</p> <p>Clearing routing process. Beh\u00f6ver g\u00f6ras vid t.ex. byten av K-values.</p> <p><code>clear\u00a0ip\u00a0eigrp\u00a0neighbors</code></p>"},{"location":"cisco/Cisco_EIGRP/#unequal-cost-load-balancing","title":"Unequal-Cost Load Balancing","text":"<p>Att det \u00e4r m\u00f6jligt med unequal-cost LB i EIGRP \u00e4r pga att det finns feasible successors. De har inte b\u00e4sta v\u00e4gen till destination men de \u00e4r garanterat loopfria. Variance multiplicerat med lowest metric blir gr\u00e4nsen f\u00f6r hur d\u00e5lig metricen f\u00e5r vara f\u00f6r att pathen \u00e4nd\u00e5 ska kunna anv\u00e4ndas f\u00f6r load-sharing. Dvs variance s\u00e4ger hur m\u00e5nga g\u00e5nger s\u00e4mre en path f\u00e5r vara f\u00f6r att anv\u00e4ndas. F\u00f6r att ta reda p\u00e5 andelen trafik som g\u00e5r \u00f6ver en viss l\u00e4nk m\u00e5ste man r\u00e4kna h\u00f6gsta installerade metricen delat med metricen p\u00e5 alla paths som anv\u00e4nds f\u00f6r n\u00e4rvarande och skriva ihop dem f\u00f6r att f\u00e5 respektive andel.</p> <p><code>router\u00a0eigrp\u00a0100</code> <code>variance</code> <code>maximum-paths\u00a04\u00a0\u00a0#Max\u00a0\u00e4r\u00a032</code> <code>traffic-share\u00a0balanced</code> <p>Default \u00e4r variance 1 och det betyder equal-cost load balancing. Det g\u00e5r \u00e4ven begr\u00e4nsa antalet parallella paths som anv\u00e4nds. Anv\u00e4nd traffic-share balanced (som \u00e4r default) annars blir det equal-cost LB \u00e4nd\u00e5.</p> <p><code>show\u00a0ip\u00a0protocols\u00a0|\u00a0i\u00a0Maximum</code></p> <p>Verifiera per IP</p> <p><code>show\u00a0ip\u00a0route\u00a090.0.0.1\u00a0|\u00a0i\u00a0share</code></p>"},{"location":"cisco/Cisco_EIGRP/#summarization","title":"Summarization","text":"<p>Man kan manuellt aggregera routes var som helst eftersom EIGRP \u00e4r ett distance vector routingprotokoll (auto-summary \u00e4r avst\u00e4ngt default sedan IOS 15 och b\u00f6r aldrig anv\u00e4ndas). N\u00e4r en summary route annonseras ut m\u00e5ste den finnas i routingtabellen f\u00f6r att undvika att det forwarderas trafik f\u00f6r destinationer i summeringen som det inte finns n\u00e5gon mer specifik route f\u00f6r s\u00e5 det skapas automatiskt en null route med AD 5. Denna distance g\u00e5r att \u00e4ndra i named mode med summary-metric under topology base men s\u00e4tt ej 255 d\u00e5 kommer inget att annonseras ut om inte samma route kommer ifr\u00e5n n\u00e5gon annan k\u00e4lla. Detta g\u00e5r d\u00e4rmed att nyttja som conditional advertisment. F\u00f6r metric till summary route v\u00e4ljs den l\u00e4gsta metricen bland component routsen som ing\u00e5r i summaryn. F\u00f6rsvinner den component routen m\u00e5ste alla g\u00e5s igenom igen f\u00f6r att v\u00e4lja en ny och skicka ut, detta kan vara CPU-intensivt ifall det finns m\u00e5nga component routes. F\u00f6r att undvika detta kan man st\u00e4lla en fast metric p\u00e5 varje summary, detta g\u00f6rs under topology base med summary-metric ocks\u00e5.</p> <p>Summarization med EIGRP inneb\u00e4r en gr\u00e4ns f\u00f6r Queries eftersom en granne till en router som summerar inte k\u00e4nner till de mer specifika n\u00e4ten och n\u00e4r en router f\u00e5r in en Query f\u00f6r ett n\u00e4t som inte finns i topologitabellen s\u00e5 skickas det direkt tillbaka en Reply med unreachable. Detta g\u00f6r att en Query aldrig floodas vidare vilket leder till att load och konvergeringstid minskar. En Query modifieras inte heller n\u00e5gonstans.</p> <p>Eftersom det \u00e4r ett distance vector routingprotokoll g\u00f6rs summary per interface. Classic mode</p> <p><code>interface\u00a0gi2</code> <code>ip\u00a0summary-address\u00a0eigrp\u00a0100\u00a0192.168.0.0\u00a0255.255.0.0</code></p> <p>Leak-map</p> <p><code>access-list\u00a01\u00a0permit\u00a0192.168.2.0\u00a00.0.0.0</code> <code>route-map\u00a0LEAK\u00a0permit\u00a010</code> <code>match\u00a0ip\u00a0address\u00a01</code> <code>int\u00a0gi2</code> <code>ip\u00a0summary-address\u00a0eigrp\u00a0100\u00a0192.168.0.0\u00a0255.255.0.0\u00a0leak-map\u00a0LEAK</code></p> <p>Finns det ingen route-map \u00e4n som heter LEAK kommer endast summeringen att annonseras.</p> <p>Verify</p> <p><code>show\u00a0ip\u00a0protocols\u00a0|\u00a0s\u00a0Summ</code> <code>show\u00a0ip\u00a0route\u00a0eigrp\u00a0|\u00a0i\u00a0Null</code></p> <p>Poisoned Floating Summarization</p> <p><code>router\u00a0eigrp\u00a0100</code> <code>summary-metric\u00a010.1.0.0/23\u00a0distance\u00a0255</code></p>"},{"location":"cisco/Cisco_EIGRP/#default-route","title":"Default route","text":"<p>Annonsera en default route ut p\u00e5 ett interface, inget annat kommer att skickas p\u00e5 detta interface.</p> <p><code>interface\u00a0gi2</code> <code>ip\u00a0summary-address\u00a0eigrp\u00a0100\u00a00.0.0.0\u00a00.0.0.0</code></p> <p>Acceptera default routing information, detta \u00e4r p\u00e5 default.</p> <p><code>default-information\u00a0allowed</code></p> <p>Acceptera endast default route fr\u00e5n specifik k\u00e4lla</p> <p><code>access-list\u00a06\u00a0permit\u00a010.0.0.0</code> <code>router\u00a0eigrp\u00a0100</code> <code>default-information\u00a0in\u00a06</code></p> <p>Skicka ej default route</p> <p><code>no\u00a0default-information\u00a0allowed\u00a0out</code></p> <p>Legacy</p> <p><code>router\u00a0eigrp\u00a0100</code> <code>network\u00a010.0.0.0</code> <code>ip\u00a0default-network\u00a010.0.0.0</code></p>"},{"location":"cisco/Cisco_EIGRP/#convergence","title":"Convergence","text":"<p>Optimization &amp; Scalability. Detecting, notifying, calculating and installing new routes.</p>"},{"location":"cisco/Cisco_EIGRP/#stub-routing","title":"Stub Routing","text":"<p>Stub routing \u00e4r designat f\u00f6r att g\u00f6ra EIGRP mer skalbart och stabilt. Det anv\u00e4nds vanligtvis i hub-and-spoke topologier och konfigureras endast p\u00e5 spokes. D\u00e5 kommer spoke att l\u00e4gga till en ny TLV i Hello-paketen som s\u00e4ger stub router status. Det g\u00f6r att spoken aldrig kommer att annonsera ut n\u00e5got som den l\u00e4r sig av n\u00e5gon EIGRP-granne f\u00f6r att inte kunna riskera att bli Feasible Successor f\u00f6r n\u00e5got n\u00e4tverk. Det enda den annonserar ut \u00e4r det man specificerar. I och med att grannarna till en stub k\u00e4nner till att den \u00e4r en stub router kommer de aldrig att skicka EIGRP-Queries. Men en stub router skickar ut Queries som vanligt. Det kan dock komma in Queries \u00e4nd\u00e5, t.ex. en gammal IOS-enhet som inte k\u00e4nner till stub kommer fortfarande skicka Queries eller om alla routrar p\u00e5 ett segment \u00e4r stub kommer det att skickas Queries som om ingen var stub. N\u00e4r en Query kommer in behandlas den som vanligt om det som Queryn handlar om faller inom det som \u00e4r till\u00e5tet f\u00f6r stub routern. G\u00f6r det inte det s\u00e5 kommer det \u00e4nd\u00e5 att besvaras men med infinite metric oavsett om routern k\u00e4nner till n\u00e4tverket eller ej. Har man ett mixat segment kommer EIGRP endast att skicka Queries till icke-stubs antingen genom att unicasta till icke-stubs eller s\u00e5 kommer Conditional Receive mode anv\u00e4ndas, det beror p\u00e5 antalet icke-stubs p\u00e5 segmentet.</p> <p>F\u00f6rdelar med Stub \u00e4r att man undviker suboptimal routing i hub-and-spoke topologier, routrar med d\u00e5lig bandbredd blir aldrig transit router och antalet Queries reduceras vilket leder till snabbare konvergens och mindre SIA. Defualt f\u00f6r stub \u00e4r (CONNECTED SUMMARY ) och grannskap resettas vid omkonfiguration.</p> <p><code>router\u00a0eigrp\u00a0100</code> <code>eigrp\u00a0stub\u00a0?</code> <code>connected</code> <code>receive-only</code> <code>redistributed</code> <code>static</code> <code>summary</code></p> <p>Undantag l\u00e4ggs med en leak-map. Man f\u00e5r h\u00e5lla koll p\u00e5 route-aggregeringar n\u00e4r man k\u00f6r stub f\u00f6r de mer specifika routsen annonseras default.</p> <p><code>router\u00a0eigrp\u00a0100</code> <code>eigrp\u00a0stub\u00a0leak-map</code><code>NAME</code></p> <p>Verify</p> <p><code>show\u00a0ip\u00a0protocols\u00a0|\u00a0i\u00a0EIGRP|Stub</code> <code>show\u00a0eigrp\u00a0address-family\u00a0ipv4\u00a0100\u00a0neighbors\u00a0detail\u00a0|\u00a0i\u00a0Stub</code> <code>show\u00a0ip\u00a0eigrp\u00a0neighbors\u00a0detail</code></p>"},{"location":"cisco/Cisco_EIGRP/#fast-reroute","title":"Fast Reroute","text":"<p>EIGRP anv\u00e4nder DUAL f\u00f6r att r\u00e4kna fram successors och feasible successors d\u00e4r successor anv\u00e4nds som primary path och feasible successors som repair paths eller LFAs. EIGRP har alltid haft backup paths f\u00f6r snabb konvergens men det LFA FRR ger \u00e4r en m\u00f6jlighet att styra vilka backup paths som ska anv\u00e4ndas, detta kan g\u00f6ras per primary path per prefix. Man kan t.ex. s\u00e4tta regler f\u00f6r att inte anv\u00e4nda LFAs d\u00e4r outgoing interface, linecard eller SRLG \u00e4r samma. EIGRP anv\u00e4nder alltid prefix-based LFAs.</p> <p>Named mode only</p> <p><code>address-family\u00a0ipv4\u00a0unicast\u00a0autonomous-system\u00a0100</code> <code>topology\u00a0base</code> <code>fast-reroute\u00a0per-prefix\u00a0all</code></p> <p>ECMP anv\u00e4nder alla equal cost paths men f\u00f6r att kontrollera vilka LFAs som anv\u00e4nds kan man st\u00e4nga av load-sharing och ist\u00e4llet l\u00e5ta FRR anv\u00e4nda tie-breaking rules.</p> <p><code>fast-reroute\u00a0load-sharing\u00a0disable</code> <code>fast-reroute\u00a0tie-break\u00a0linecard-disjoint\u00a02</code></p> <p>Verify</p> <p><code>show\u00a0ip\u00a0eigrp\u00a0topology\u00a0frr</code></p>"},{"location":"cisco/Cisco_EIGRP/#bfd","title":"BFD","text":"<p>Se BFD</p> <p><code>router\u00a0eigrp\u00a0100</code> <code>bfd\u00a0interface\u00a0gi2\u00a0\u00a0\u00a0#Enable\u00a0BFD\u00a0on\u00a0specific\u00a0interface</code> <code>bfd\u00a0all-interfaces\u00a0\u00a0#Enable\u00a0BFD\u00a0on\u00a0all\u00a0interfaces</code></p>"},{"location":"cisco/Cisco_EIGRP/#filtering","title":"Filtering","text":"<p>Med EIGRP g\u00e5r det att filtrera routes p\u00e5 m\u00e5nga olika s\u00e4tt. T.ex. kan router-id anv\u00e4ndas f\u00f6r att filtrera bort routes fr\u00e5n en viss granne. N\u00e4r man applyar en distribute-list under EIGRP-processen skickas en ROUTE FILTER CHANGED och grannskapet resettas f\u00f6r att topologitabellen ska synkas om.</p>"},{"location":"cisco/Cisco_EIGRP/#prefix-lists","title":"Prefix-Lists","text":"<p><code>ip\u00a0prefix-list\u00a0FILTER\u00a0seq\u00a05\u00a0deny\u00a0172.16.10.0/24</code> <code>ip\u00a0prefix-list\u00a0FILTER\u00a0seq\u00a010\u00a0permit\u00a00.0.0.0/0\u00a0le\u00a032</code> <code>router\u00a0eigrp\u00a0100</code> <code>distribute-list\u00a0prefix\u00a0FILTER\u00a0in</code></p> <p>Det g\u00e5r \u00e4ven anv\u00e4nda prefix-listor f\u00f6r att filtrera p\u00e5 neighbor (gateway).</p>"},{"location":"cisco/Cisco_EIGRP/#acl","title":"ACL","text":"<p>Standard</p> <p><code>access-list\u00a03\u00a0deny\u00a030.0.0.0</code> <code>access-list\u00a03\u00a0permit\u00a0any</code> <code>router\u00a0eigrp\u00a0100</code> <code>distribute-list\u00a03\u00a0in\u00a0gi0/0</code></p> <p>Extended</p> <p><code>access-list\u00a0103\u00a0deny\u00a0ip\u00a0host\u00a010.0.0.10\u00a0host\u00a0172.20.1.0</code> <code>access-list\u00a0103\u00a0deny\u00a0ip\u00a0host</code><code>host</code> <code>access-list\u00a0103\u00a0permit\u00a0ip\u00a0any\u00a0any</code> <code>router\u00a0eigrp\u00a0100</code> <code>distribute-list\u00a0103\u00a0in\u00a0gi0/0</code>"},{"location":"cisco/Cisco_EIGRP/#administrative-distance","title":"Administrative Distance","text":"<p>Per prefix filtering med AD (255 = UNKNOWN)</p> <p><code>access-list\u00a07\u00a0permit\u00a020.0.0.0</code> <code>router\u00a0eigrp\u00a0100</code> <code>distance\u00a0255\u00a00.0.0.0\u00a0255.255.255.255\u00a07</code></p> <p>Tr\u00e4ffar alla grannar</p> <p>AD f\u00f6r internal routes g\u00e5r att \u00e4ndra per prefix men ej external.</p>"},{"location":"cisco/Cisco_EIGRP/#route-map","title":"Route Map","text":"<p>Med route-maps kan man matcha p\u00e5 metrics, tags och acler.</p> <p><code>route-map\u00a0RM\u00a0deny\u00a010</code> <code>match\u00a0tag\u00a04</code> <code>route-map\u00a0RM\u00a0permit\u00a020</code> <code>router\u00a0eigrp\u00a0100</code> <code>distribute-list\u00a0route-map\u00a0RM\u00a0in</code></p>"},{"location":"cisco/Cisco_EIGRP/#prefix-limit","title":"Prefix Limit","text":"<p>Per process</p> <p><code>maximum-prefix\u00a01000</code></p> <p>Max antal prefix fr\u00e5n granne.</p> <p><code>neighbor\u00a010.0.1.1\u00a0maximum-prefix\u00a0100</code></p> <p>\u00d6vrigt \u00c4ndra hop-count limit. Prefix med h\u00f6gre hop-count kommer att filtreras ut.</p> <p><code>metric\u00a0maximum-hops\u00a02</code></p> <p>Med Offset Lists kan man addera metric (Delay) n\u00e4r routes kommer in eller skickas ut. Det fungerar med EIGRP men \u00e4r inte rekommenderat pga komplexiteten hos EIGRPs metric, det finns andra enklare s\u00e4tt att manipulera routes.</p>"},{"location":"cisco/Cisco_EIGRP/#redistribution","title":"Redistribution","text":"<p>F\u00f6r redistribution m\u00e5ste man s\u00e4tta en seed metric eftersom default \u00e4r infinity. Man kan s\u00e4tta samma router-id p\u00e5 tv\u00e5 EIGRP-routrar f\u00f6r att blockera ut externa routes vid redistribution f\u00f6r att undvika loopar.</p> <p><code>router\u00a0eigrp\u00a0100</code> <code>default-metric\u00a01000000\u00a010\u00a0255\u00a01\u00a01500</code></p> <p>Static Med static och connected beh\u00f6vs ingen seed metric.</p> <p><code>redistribute\u00a0static</code></p> <p>RIP</p> <p><code>redistribute\u00a0rip\u00a0metric\u00a01500\u00a0100\u00a0255\u00a01\u00a01500</code></p> <p>OSPF</p> <p><code>redistribute\u00a0ospf\u00a01</code></p> <p>Route flapping kan uppt\u00e4ckas genom att kolla events, 500 lines h\u00e5lls i minnet.</p> <p><code>show\u00a0ip\u00a0eigrp\u00a0events</code></p> <p>Route-tag notation dotted decimal</p> <p><code>eigrp\u00a0default-route-tag\u00a0\u00a0#internal\u00a0only</code> <code>show\u00a0route-tag\u00a0list</code></p> <p>Wide metrics N\u00e4r man k\u00f6r named mode m\u00e5ste man t\u00e4nka p\u00e5 vilken metric man s\u00e4tter n\u00e4r man redistribuerar. F\u00f6ljande exempel kommer inte att fungera eftersom named mode anv\u00e4nder wide metrics och d\u00e5 kommer denna redistribution resultera i infinity metric och inget kommer att annonseras i EIGRP, utan man m\u00e5ste s\u00e4tta n\u00e5got mer realistiskt.</p> <p><code>redistribute\u00a0ospf\u00a01\u00a0metric\u00a01\u00a01\u00a01\u00a01\u00a01</code></p>"},{"location":"cisco/Cisco_EIGRP/#eigrpv6","title":"EIGRPv6","text":"<p>Det finns n\u00e5gra skillnader mot klassiska IPv4-EIGRP v\u00e4rda att notera. Man m\u00e5ste no shuta EIGRP-processen f\u00f6r att den ska starta. Default route kan endast annonseras med hj\u00e4lp summarization eller redistribution. Unequal-cost load balancing st\u00f6ds f\u00f6r n\u00e4rvarande inte med IPv6 EIGRP pga CEF-begr\u00e4nsningar. Defualt s\u00e5 s\u00e4tter routern alltid sig sj\u00e4lv som next-hop, \u00e4ven n\u00e4r routes annonseras ut p\u00e5 samma interface som de kom in p\u00e5, detta g\u00e5r att st\u00e4nga av med no ipv6 next-hop-self eigrp.</p> <p><code>ipv6\u00a0unicast-routing</code> <code>ipv6\u00a0router\u00a0eigrp\u00a01</code> <code>eigrp\u00a0router-id\u00a02.2.2.2</code> <code>maximum-paths\u00a016\u00a0\u00a0#Max\u00a0\u00e4r\u00a032</code> <code>no\u00a0shutdown</code></p> <p>Per interface</p> <p><code>interface\u00a0gi2</code> <code>no\u00a0ip\u00a0address</code> <code>ipv6\u00a0address\u00a02001::2/64</code> <code>ipv6\u00a0eigrp\u00a01</code></p> <p><code>ipv6\u00a0authentication\u00a0mode\u00a0eigrp\u00a01\u00a0md5</code> <code>ipv6\u00a0authentication\u00a0key-chain\u00a0eigrp\u00a01\u00a0EIGRPV6</code> <code>ipv6\u00a0summary-address\u00a0eigrp\u00a01\u00a02001::/64\u00a0leak-map\u00a0LEAKS</code></p> <p>leak-map f\u00f6r IPv6 summary \u00e4r en relativt ny feature</p> <p>Verify, finns b\u00e5de gammal och ny syntax f\u00f6r show-kommandona.</p> <p><code>show\u00a0ipv6\u00a0route\u00a0eigrp</code> <code>show\u00a0ipv6\u00a0eigrp\u00a0interfaces</code> <code>show\u00a0ipv6\u00a0eigrp\u00a0100\u00a0interfaces\u00a0detail\u00a0|\u00a0i\u00a0Hello|Split|Authentication</code></p> <p><code>show\u00a0eigrp\u00a0address-family\u00a0ipv6\u00a0neighbors</code> <code>show\u00a0eigrp\u00a0address-family\u00a0ipv6\u00a0topology</code></p>"},{"location":"cisco/Cisco_EIGRP/#named-mode","title":"Named mode","text":"<p>Om IOS st\u00f6djer Named Mode \u00e4r det rekommenderat att anv\u00e4nda det (IOS fr.o.m. 15.0(1)M). Detta \u00e4ndrar inte p\u00e5 n\u00e5got s\u00e4tt hur EIGRP fungerar (f\u00f6rutom wide metrics!) utan \u00e4r endast ett annat mer konsekvent s\u00e4tt att konfigurera det p\u00e5. Man kan p\u00e5 samma router ha Classic och Named EIGRP-instanser samtidigt. Alla kommandon l\u00e4ggs nu under router eigrp , \u00e4ven s\u00e5nt som f\u00f6rut l\u00e5g p\u00e5 interfacen t.ex. timers, summarization och Split Horizon. L\u00e4gger man EIGRP-konfiguration p\u00e5 interfacen kommer den att ignoreras. EIGRP anv\u00e4nder automatiskt wide metrics om andra sidan ocks\u00e5 k\u00f6r named mode. <p>Konfigurationen \u00e4r uppdelad i tre sektioner.</p> <p>Address Family section</p> <p><code>router\u00a0eigrp\u00a0HACKER</code> <code>address-family\u00a0ipv4\u00a0unicast\u00a0autonomous-system\u00a0100</code> <code>eigrp\u00a0router-id\u00a01.1.1.1</code> <code>network\u00a010.0.0.0\u00a00.0.0.255</code></p> <p><code>address-family\u00a0ipv4\u00a0unicast\u00a0vrf\u00a0EXAMPLE\u00a0autonomous-system\u00a0101</code> <code>eigrp\u00a0router-id\u00a01.1.20.1</code> <code>network\u00a010.0.20.0\u00a00.0.0.255</code></p> <p>OBS med address-family ipv6 unicast s\u00e5 enableas alla ipv6-interface f\u00f6r EIGRP automatiskt.</p> <p>Per-AF-interface section</p> <p><code>af-interface\u00a0default</code> <code>passive-interface</code> <code>bfd</code> <code>exit-af-interface</code> <code>!</code> <code>af-interface\u00a0Gi3</code> <code>no\u00a0passive-interface</code> <code>authentication\u00a0mode\u00a0hmac-sha-256\u00a0SECRET_KEY</code> <code>summary-address\u00a010.10.0.0/24</code> <code>exit-af-interface</code></p> <p>Per-AF-topology section Base \u00e4r det som finns om man inte sl\u00e5r p\u00e5 Multi Topology Routing.</p> <p><code>topology\u00a0base</code> <code>redistribute\u00a0connected</code> <code>distance\u00a0eigrp\u00a090\u00a0170</code> <code>exit-af-topology</code></p> <p>Automagically convert classic EIGRP configuration into Named EIGRP configuration.</p> <p><code>eigrp\u00a0upgrade-cli</code></p> <p>Show commands har ocks\u00e5 ny syntax</p> <p><code>show\u00a0eigrp\u00a0address-family\u00a0ipv4\u00a0?</code></p> <p>Man kan ocks\u00e5 tagga routes. F\u00f6r att \u00e4ndra format finns den globala inst\u00e4llningen: route-tag notation dotted-decimal</p> <p><code>eigrp\u00a0default-route-tag\u00a01.2.3.4</code></p>"},{"location":"cisco/Cisco_EIGRP/#add-path","title":"Add-Path","text":"<p>Fr.o.m. IOS 15.3(2)T har EIGRP st\u00f6d f\u00f6r till\u00e4gget Add-Path som l\u00e5ter en router skicka ut uppdateringar som inneh\u00e5ller flera equal-cost v\u00e4gar till samma destination. Detta \u00e4r anv\u00e4ndbart i DMVPN-setuper d\u00e4r flera branch offices \u00e4r dual homed. F\u00f6r att kunna skicka ut multipla routes m\u00e5ste de finnas i routingtabellen samt att Split Horizon \u00e4r avst\u00e4ngt p\u00e5 multipoint tunnel-interfacet mot alla spokes.</p> <p>Detta g\u00e5r bara att konfigurera i named mode och s\u00e4tts per interface.</p> <p><code>af-interface\u00a0Tunnel0</code> <code>no\u00a0split-horizon</code> <code>no\u00a0next-hop-self</code> <code>add-paths\u00a0&lt;1-4&gt;</code> <code>exit-af-interface</code></p> <p><code>topology\u00a0base</code> <code>variance\u00a01</code> <code>maximum-paths\u00a04</code> <code>exit-af-topology</code></p> <p>Maximum-paths m\u00e5ste vara satt till samma eller h\u00f6gre \u00e4n add-paths annars kommer det inte att finnas fler equal-cost routes i routingtabellen. Next-hop-self m\u00e5ste deaktiveras annars kommer alla routes som annonseras ha samma next-hop. Detta \u00e4r inte kompatibelt med Unequal Cost LB utan variance m\u00e5ste vara satt till 1. Spokes beh\u00f6ver inte konfigurera n\u00e5gonting annat \u00e4n maximum-paths.</p> <p><code>no-ecmp-mode</code></p> <p>\u00c4r rekommenderat om huben anv\u00e4nder flera tunnel-interface f\u00f6r att n\u00e5 spokes.</p>"},{"location":"cisco/Cisco_EIGRP/#ipv6-vrf-lite","title":"IPv6 VRF-Lite","text":"<p>EIGRP IPv6 VRF-Lite \u00e4r endast tillg\u00e4ngligt med Named configurations.</p> <p><code>vrf\u00a0definition\u00a0VRF1</code> <code>rd\u00a0100:1</code> <code>address-family\u00a0ipv6</code> <code>exit</code></p> <p><code>router\u00a0eigrp\u00a0MULTI</code> <code>address-family\u00a0ipv6\u00a0vrf\u00a0VRF1\u00a0autonomous-system\u00a0200</code></p>"},{"location":"cisco/Cisco_EIGRP/#over-the-top","title":"Over the ToP","text":"<p>EIGRP Over the ToP (OTP) g\u00f6r att man kan skapa multipoint overlay VPN:er \u00f6ver vanlig L3/L3 VPN. Nyckeln \u00e4r att LISP-enkapsulering (UDP port 4343) anv\u00e4nds men EIGRP anv\u00e4nds f\u00f6r control plane ist\u00e4llet f\u00f6r LISPs vanliga mapping service. Man uppn\u00e5r en del liknande funktionalitet som med DMVPN men det fungerar inte p\u00e5 samma s\u00e4tt. Om man k\u00f6r OTP \u00f6ver MPLS VPN beh\u00f6ver man inte k\u00f6ra n\u00e5gon dynamisk routing med Provider d\u00e4remot m\u00e5ste alla CE kunna n\u00e5 varandra. OTP-trafik kan krypteras med GET VPN. Eftersom grannskap m\u00e5ste konfigureras manuellt blir det omst\u00e4ndigt n\u00e4r milj\u00f6n v\u00e4xer lite. Detta har lett till att man tagit fram Route Reflector \u00e4ven f\u00f6r EIGRP, som ger samma funktionalitet som i BGP.</p> <p>Man konfigurerar ip, max-hops och lisp-id.</p> <p><code>neighbor\u00a01.1.1.1\u00a0Gi2\u00a0remote\u00a010\u00a0lisp-encap\u00a01</code></p> <p>Verify and show OTP learned routes</p> <p><code>show\u00a0interface\u00a0lisp\u00a01</code> <code>show\u00a0ip\u00a0route\u00a0eigrp\u00a0|\u00a0i\u00a0LISP</code></p> <p>Route Reflector har en listen feature (likt BGP) som kan anv\u00e4nda sig av en ACL f\u00f6r att begr\u00e4nsa vilka som f\u00e5r ansluta. P\u00e5 route reflector b\u00f6r \u00e4ven split-horizon och next-hop-self st\u00e4ngas av.</p> <p><code>remote-neighbors\u00a0source\u00a0gigabitethernet\u00a00/1\u00a0unicast-listen\u00a0lisp-encap\u00a0allow-list</code><code>ACL</code></p>"},{"location":"cisco/Cisco_EIGRP/#vrf-support","title":"VRF Support","text":"<p>Man kan \u00e4ven k\u00f6ra OTP i default vrf:en och l\u00e5ta EIGRP b\u00e4ra info om flera vrf:er. Man binder dem till ett Topology ID. Detta fungerar \u00e4ven p\u00e5 RR. Alla grannskap etableras i en enskild EIGRP-process. En process hanterar multipla, separata grannskap i olika vrf:er p\u00e5 lan-sidan samtidigt som det har grannskap p\u00e5 wan-sidan med OTP peers. Mottagande peer v\u00e4ljer routes till de olika topologierna som finns lokalt och routes f\u00f6r andra topologier droppas. LISP Id (LISP Instance ID) mappas till VRF och TID. Eftersom LISP b\u00e4r paket f\u00f6r olika vrf:er p\u00e5 olika virtuella LISP-interface m\u00e5ste LISP ID per vrf vara unikt men samma p\u00e5 alla CE devices d\u00e4r vrf:en finns.</p> <p><code>router\u00a0eigrp\u00a0AF</code> <code>address-family\u00a0ipv4\u00a0autonomous-system\u00a010</code> <code>topology\u00a0vrf\u00a0vrf1\u00a0tid\u00a010\u00a0lisp-instance-id\u00a0122</code></p> <p><code>topology\u00a0vrf\u00a0vrf2\u00a0tid\u00a011\u00a0lisp-instance-id\u00a0123</code></p>"},{"location":"cisco/Cisco_EIGRP/#nx-os","title":"NX-OS","text":"<p>H\u00e4r f\u00f6ljer Nexus-specifik syntax. N\u00e5gra grundl\u00e4ggande skillnader mot IOS \u00e4r att det saknas st\u00f6d f\u00f6r UCMP och unicast neighbors. Default v\u00e4ljer NX-OS Lo0 som Router-ID. Har man ingen manuellt satt RID och konfar Lo0 s\u00e5 kommer EIGRP direkt att byta till Lo0 och processen startas om.</p> <p><code>feature\u00a0eigrp</code></p> <p><code>router\u00a0eigrp\u00a01</code> <code>log-adjacency-changes</code> <code>autonomous-system\u00a0100</code> <code>bfd</code></p> <p><code>interface\u00a0loopback0</code> <code>ip\u00a0router\u00a0eigrp\u00a01</code></p> <p><code>interface\u00a0Ethernet1/1</code> <code>ip\u00a0router\u00a0eigrp\u00a01</code> <code>ipv6\u00a0router\u00a0eigrp\u00a01</code></p> <p>Maintenance mode</p> <p><code>router\u00a0eigrp\u00a01</code> <code>isolate</code></p> <p>Verify</p> <p><code>show\u00a0run\u00a0eigrp</code> <code>show\u00a0ip\u00a0eigrp\u00a0neighbors</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_EVPN/","title":"Cisco EVPN","text":"<p>Ethernet VPN (RFC 8365) \u00e4r en modernare variant \u00e4n VPLS f\u00f6r att tillhandah\u00e5lla Ethernet multipoint services \u00f6ver IP (VXLAN) eller MPLS (RFC 7432) utan att beh\u00f6va en central controller. EVPN \u00e4r en adressfamilj i BGP som anv\u00e4nds f\u00f6r peer discovery och f\u00f6r att distribuera lokala MAC-adresser och MAC/IP bindings till andra tunnel endpoints. Man anv\u00e4nder b\u00e5de L2 och L3 forwarding information och det fungerar ihop med externa IP-prefix. Next-hop i EVPN-uppdateringarna \u00e4r antingen egress Label Switch Router eller VXLAN Tunnel Endpoint. EVPN skalar bra och har bl.a. features f\u00f6r att h\u00e5lla koll p\u00e5 hostar som flyttar mellan datacenter (sekvensnummer-community i annonseringarna) och kan d\u00e5 konvergera snabbt. Ett EVPN-n\u00e4tverk kan g\u00f6ra b\u00e5de bridging och routing och har inbyggd support f\u00f6r multi-tenancy (VPN). DHCP Snooping supporteras inte p\u00e5 VXLAN VLAN.</p> <p>EVPN \u00e4r ett \u00f6ppet protokoll s\u00e5 det finns interoperability med andra network vendors, se t.ex. Arista, Cumulus och Quagga EVPN.</p> <p>Route types # Ethernet Auto-Discovery Route</p> <ol> <li>MAC/IP Advertisement Route</li> <li>Inclusive Multicast Ethernet Tag Route</li> <li>Ethernet Segment Route</li> <li>IP Prefix Route</li> </ol> <p>Type 5 Routes format {| class=\"wikitable\" | Encapsulation: | MPLS | VXLAN |- | RT-5 Route: | IP Prefix | IP Prefix |- | RD: | L3 RD | L3 RD |- | IP Length: | prefix length | prefix length |- | IP Address: | IP | IP |- | Label: | BGP MPLS Label | L3VNI |- | Ext Communities: | RT for IP-VRF | RT for IP-VRF, Tunnel Type VxLAN, Router MAC |- |}</p>"},{"location":"cisco/Cisco_EVPN/#underlay","title":"Underlay","text":"<p>Underlay routing kan g\u00f6ras med IGP, iBGP eller eBGP. Alla VTEP:s m\u00e5ste kunna n\u00e5 varandra med jumbo frames. Alla h\u00e5rdvaruplattformar har inte st\u00f6d f\u00f6r Head-end Replication (aka Ingress Replication) f\u00f6r att l\u00f6sa tenant BUM s\u00e5 t.ex. med Nexus 5k m\u00e5ste man \u00e4ven k\u00f6ra PIM Bidir i underlay. Notera att IGP-annonsering av NVE loopback address efter boot default kommer att suppressas under 300 sekunder f\u00f6r att overlay ska hinna konvergera. Detta g\u00e5r att st\u00e4lla in under interface nve 1.</p> <p>Simpelt NX-OS exempel</p> <p><code>feature\u00a0ospf</code></p> <p><code>interface\u00a0loopback0</code> <code>description\u00a0VTEP</code> <code>ip\u00a0address\u00a01.1.1.1/32</code> <code>ip\u00a0router\u00a0ospf\u00a01\u00a0area\u00a00</code></p> <p><code>interface\u00a0Ethernet1/1</code> <code>description\u00a0Uplink</code> <code>no\u00a0switchport</code> <code>medium\u00a0p2p</code> <code>mtu\u00a09216</code> <code>ip\u00a0address\u00a010.0.2.2/30</code> <code>no\u00a0shutdown</code> <code>ip\u00a0router\u00a0ospf\u00a01\u00a0area\u00a00</code></p> <p>Det g\u00e5r \u00e4ven k\u00f6ra uppl\u00e4nkarna IP unnumbered.</p>"},{"location":"cisco/Cisco_EVPN/#overlay","title":"Overlay","text":"<p>EVPN-peering f\u00f6r DC VXLAN-overlay kan g\u00f6ras b\u00e5de med iBGP och eBGP, det \u00e4r designen som avg\u00f6r.</p> <p>Konfig f\u00f6r leafs oavsett iBGP eller eBGP overlay.</p> <p><code>feature\u00a0bgp</code> <code>feature\u00a0vn-segment-vlan-based</code> <code>feature\u00a0nv\u00a0overlay</code> <code>nv\u00a0overlay\u00a0evpn</code></p> <p><code>interface\u00a0nve1</code> <code>no\u00a0shutdown</code> <code>host-reachability\u00a0protocol\u00a0bgp</code> <code>source-interface\u00a0loopback0</code></p>"},{"location":"cisco/Cisco_EVPN/#ibgp","title":"IBGP","text":"<p>Den simplaste EVPN fabricen \u00e4r IBGP overlay med IGP underlay.</p> <p><code>router\u00a0bgp\u00a065000</code> <code>address-family\u00a0l2vpn\u00a0evpn</code> <code>neighbor\u00a02.2.2.2</code> <code>remote-as\u00a065000</code> <code>update-source\u00a0loopback0</code> <code>address-family\u00a0l2vpn\u00a0evpn</code> <code>send-community</code> <code>send-community\u00a0extended</code></p> <p>Route Reflector Precis som med \u00f6vriga adressfamiljer kan man med hj\u00e4lp av route reflector \u00f6ka skalbarhet och f\u00f6renkla konfigurationen. Spine-switchar kan t.ex. st\u00e5 f\u00f6r denna roll i en IBGP EVPN setup.</p> <p><code>router\u00a0bgp\u00a065000</code> <code>address-family\u00a0l2vpn\u00a0evpn</code> <code>neighbor\u00a01.1.1.0/24</code> <code>remote-as\u00a065000</code> <code>update-source\u00a0loopback0</code> <code>address-family\u00a0l2vpn\u00a0evpn</code> <code>send-community\u00a0extended</code> <code>route-reflector-client</code></p>"},{"location":"cisco/Cisco_EVPN/#ebgp","title":"EBGP","text":"<p>Om man bygger sin fabric med EBGP EVPN s\u00e5 m\u00e5ste next-hop-unchanged konfas p\u00e5 spines peeringar mot leaf. Om man k\u00f6r med autoderiverade RTs m\u00e5ste man skriva om dem innan de n\u00e5r leaf samt att spine switches inte har n\u00e5gon VRF-konfig s\u00e5 man m\u00e5ste sl\u00e5 p\u00e5 retain route-target.</p> <p><code>route-map\u00a0NH-Unchanged\u00a0permit\u00a010</code> <code>set\u00a0ip\u00a0next-hop\u00a0unchanged</code></p> <p><code>router\u00a0bgp\u00a065000</code> <code>address-family\u00a0l2vpn\u00a0evpn</code> <code>retain\u00a0route-target\u00a0all</code> <code>neighbor\u00a01.1.1.0/24</code> <code>remote-as\u00a065001</code> <code>address-family\u00a0l2vpn\u00a0evpn</code> <code>route-map\u00a0NH-Unchanged\u00a0out</code> <code>rewrite-evpn-rt-asn</code></p> <p>All leaf same ASN Spine</p> <p><code>router\u00a0bgp\u00a065000</code> <code>neighbor\u00a01.1.1.1\u00a0remote-as\u00a065001</code> <code>address-family\u00a0l2vpn\u00a0evpn</code> <code>disable-peer-as-check</code></p> <p>Leaf</p> <p><code>router\u00a0bgp\u00a065001</code> <code>neighbor\u00a02.2.2.2\u00a0remote-as\u00a065000</code> <code>address-family\u00a0l2vpn\u00a0evpn</code> <code>allowas-in</code></p>"},{"location":"cisco/Cisco_EVPN/#verify-overlay","title":"Verify Overlay","text":"<p><code>show\u00a0nve\u00a0int\u00a0nve1</code> <code>show\u00a0nve\u00a0peers\u00a0detail</code> <code>show\u00a0bgp\u00a0l2vpn\u00a0evpn\u00a0summary</code> <code>show\u00a0nve\u00a0internal\u00a0platform\u00a0interface\u00a0nve\u00a01\u00a0detail</code></p>"},{"location":"cisco/Cisco_EVPN/#bridging","title":"Bridging","text":"<p>P\u00e5 varje leaf switch mappas local VLAN till ett VNI (VLAN-based mode).</p> <p><code>vlan\u00a0100</code> <code>vn-segment\u00a010100</code> <code>vlan\u00a0101</code> <code>vn-segment\u00a010101</code></p>   VLAN modes:    [](/File:Cisco-EVPN-VLAN-mode.PNG \"wikilink\")   <p>HER mha EVPN route typ 3</p> <p><code>interface\u00a0nve1</code> <code>member\u00a0vni\u00a010100</code> <code>ingress-replication\u00a0protocol\u00a0bgp</code> <code>member\u00a0vni\u00a010101</code> <code>ingress-replication\u00a0protocol\u00a0bgp</code></p> <p>RD och RT f\u00f6r bridging. RT-import/export g\u00f6rs automatiskt utifr\u00e5n ASN och VNI.</p> <p><code>evpn</code> <code>vni\u00a010100\u00a0l2</code> <code>rd\u00a0auto</code> <code>route-target\u00a0import\u00a0auto</code> <code>route-target\u00a0export\u00a0auto</code> <code>exit</code> <code>vni\u00a010101\u00a0l2</code> <code>rd\u00a0auto</code> <code>route-target\u00a0import\u00a0auto</code> <code>route-target\u00a0export\u00a0auto</code> <code>exit</code></p> <p>Verify</p> <p><code>show\u00a0nve\u00a0vni</code> <code>show\u00a0nve\u00a0peers\u00a0data-plane\u00a0detail</code> <code>show\u00a0l2route\u00a0evpn\u00a0mac-ip\u00a0all</code> <code>show\u00a0forwarding\u00a0nve\u00a0l3\u00a0peers</code> <code>show\u00a0mac\u00a0address-table</code> <code>show\u00a0system\u00a0internal\u00a0l2fwder\u00a0mac\u00a0\u00a0\u00a0\u00a0\u00a0#Nexus\u00a09000v</code></p>"},{"location":"cisco/Cisco_EVPN/#vpc","title":"vPC","text":"<p>Om man k\u00f6r vPC f\u00e5r man s\u00e4tta upp sina VTEP-interface (loopback) med dubbla IP-adresser d\u00e4r secondary IP address anv\u00e4nds f\u00f6r all VXLAN-trafik. Secondary ska vara samma p\u00e5 b\u00e5de vPC-peers och det \u00e4r s\u00e5 dom presenterar sig sj\u00e4lva som en enda VTEP till remote NVE peers. CFS dubbelkollar att man har gjort r\u00e4tt. Sista oktetten i loopbacks prim\u00e4ra IP-adress anv\u00e4nds f\u00f6r att generera RMAC n\u00e4r man k\u00f6r vPC. Varje vPC-peer har separata BGP-sessioner till spine. I \u00f6vrigt m\u00e5ste de ha identisk konfiguration n\u00e4r det g\u00e4ller VLAN, VNI och NVE (show vpc consistency-parameters vni).</p> <p><code>interface\u00a0loopback0</code> <code>ip\u00a0address\u00a0100.0.0.11/32</code> <code>ip\u00a0address\u00a0100.0.0.100/32\u00a0secondary</code></p> <p>vPC Domain best practice n\u00e4r man k\u00f6r EVPN.</p> <p><code>vpc\u00a0domain\u00a01</code> <code>peer-switch</code> <code>peer-keepalive\u00a0destination\u00a010.0.0.2\u00a0source\u00a010.0.0.1</code> <code>peer-gateway</code> <code>ipv6\u00a0nd\u00a0synchronize</code> <code>ip\u00a0arp\u00a0synchronize</code></p> <p>vPC Fabric Peering I nyare NX-OS p\u00e5 N9k beh\u00f6vs ingen fysisk peer-link l\u00e4ngre utan man kan k\u00f6ra CFSoIP \u00f6ver fabricen, detta sparar portar och kallas vPC Fabric Peering. Data plane traffic g\u00f6rs \u00f6ver en VXLAN-tunnel. Man ber\u00e4ttar f\u00f6r switchen vilka som \u00e4r fabric-l\u00e4nkar och dessa trackas d\u00e5.</p> <p><code>hardware\u00a0access-list\u00a0tcam\u00a0region\u00a0in-flow-redirect\u00a0512</code> <code>vpc\u00a0domain\u00a01</code> <code>peer-keepalive\u00a0destination\u00a010.0.0.2\u00a0source\u00a010.0.0.1</code> <code>virtual\u00a0peer-link\u00a0destination\u00a010.0.10.2\u00a0source\u00a010.0.10.1/32</code> <code>peer-switch</code> <code>peer-gateway</code> <code>ip\u00a0arp\u00a0synchronize</code> <code>ipv6\u00a0nd\u00a0synchronize</code></p> <p>Verify</p> <p><code>show\u00a0vpc</code> <code>show\u00a0vpc\u00a0fabric-ports</code> <code>show\u00a0vpc\u00a0virtual-peerlink\u00a0vlan\u00a0consistency</code></p> <p>advertise-pip Default annonseras alla Layer-3 routes med secondary IP address (VIP) p\u00e5 VTEP. Prefix routes och leaf switch generated routes synkas ej mellan vPC leaf switches. Om t.ex. vPC-switch och dennes peer har asymmetric external Layer-3 connections och vissa routes endast \u00e4r n\u00e5bara via den ena eller om man ska agera DHCP Relay \u00e5t tenants s\u00e5 kan traffic blackholing uppst\u00e5 med default beteendet. Man kan d\u00e4rf\u00f6r konfa att route type 5 routes ska annonseras med primary IP address s\u00e5 det blir next-hop f\u00f6r fabricen.</p> <p><code>router\u00a0bgp\u00a065000</code> <code>address-family\u00a0l2vpn\u00a0evpn</code> <code>advertise-pip</code></p> <p>Backup routing Om den ena vPC-peeren tappar sina uppl\u00e4nkar till spine och man inte har n\u00e5gon backup routing s\u00e5 uppst\u00e5r traffic blackholing. Detta kan man motverka genom att bygga en backup-v\u00e4g \u00f6ver peer-linken till den andra peeren.</p> <p><code>vlan\u00a099</code></p> <p><code>interface\u00a0vlan99</code> <code>ip\u00a0address\u00a010.99.99.1/30</code> <code>ip\u00a0router\u00a0ospf\u00a01\u00a0area\u00a00.0.0.0</code> <code>ip\u00a0pim\u00a0sparse-mode</code></p> <p>Nexus 5600</p> <p><code>vpc\u00a0nve\u00a0peer-link-vlan\u00a099</code></p>"},{"location":"cisco/Cisco_EVPN/#bd-oriented-mode","title":"BD-oriented mode","text":"<p>I VLAN-based mode \u00e4r VNI-to-VLAN mapping switch wide men om man l\u00e4gger in bridge domains emellan s\u00e5 kan man uppn\u00e5 att VNI-to-VLAN mapping endast \u00e4r port wide. Dvs man kan anv\u00e4nda samma 802.1Q tag p\u00e5 flera portar men de \u00e4r mappade till olika VNI:er. Konfen ser lite annorlunda ut men b\u00e5de bridging och routing funkar.</p> <p>Nexus 7k</p> <p><code>feature\u00a0vni</code> <code>feature-set\u00a0fabric</code> <code>feature\u00a0fabric\u00a0forwarding</code></p> <p><code>vni\u00a010000</code></p> <p><code>system\u00a0bridge-domain\u00a0100</code> <code>bridge-domain\u00a0100</code> <code>member\u00a0vni\u00a010000</code></p> <p><code>encapsulation\u00a0profile\u00a0vni\u00a0Tenant1-101</code> <code>dot1q\u00a0101\u00a0vni\u00a010000</code></p> <p><code>interface\u00a0e2/1</code> <code>no\u00a0switchport</code> <code>service\u00a0instance\u00a01\u00a0vni</code> <code>no\u00a0shutdown</code> <code>encapsulation\u00a0profile\u00a0Tenant1-101\u00a0default</code></p> <p><code>interface\u00a0Bdi\u00a0100</code> <code>vrf\u00a0member\u00a0Tenant1</code> <code>ip\u00a0address\u00a010.0.0.1/24</code></p>"},{"location":"cisco/Cisco_EVPN/#routing","title":"Routing","text":"<p>NX-OS g\u00f6r endast symmetric vxlan routing, dvs EVPN-routes har b\u00e5de L2VNI och L3VNI. Man anger NVE overlay VLAN:s. Dessa ska ej anv\u00e4ndas som vanliga VLAN.</p> <p><code>system\u00a0vlan\u00a0nve-overlay\u00a0id\u00a03001-3200</code></p> <p>RT-import och export g\u00f6rs automatiskt utifr\u00e5n ASN och VNI.</p> <p><code>vrf\u00a0context\u00a0Tenant1</code> <code>vni\u00a030001</code> <code>rd\u00a0auto</code> <code>address-family\u00a0ipv4\u00a0unicast</code> <code>route-target\u00a0both\u00a0auto</code> <code>route-target\u00a0both\u00a0auto\u00a0evpn</code></p> <p>Varje tenant VRF beh\u00f6ver ett VRF overlay VLAN och ett SVI f\u00f6r VXLAN routing.</p> <p><code>interface\u00a0nve1</code> <code>member\u00a0vni\u00a030001\u00a0associate-vrf</code></p> <p><code>vlan\u00a03001</code> <code>vn-segment\u00a030001</code></p> <p><code>interface\u00a0Vlan3001</code> <code>no\u00a0shutdown</code> <code>mtu\u00a09216</code> <code>vrf\u00a0member\u00a0Tenant1</code> <code>ip\u00a0forward</code> <code>ipv6\u00a0forward</code></p> <p>Verify</p> <p><code>show\u00a0nve\u00a0vrf</code> <code>show\u00a0nve\u00a0internal\u00a0bgp\u00a0rnh\u00a0database\u00a0vni\u00a030001</code></p> <p>Exempel, tenant routing table</p> <p><code>routing-context\u00a0vrf\u00a0Tenant1</code> <code>show\u00a0ip\u00a0route</code></p> <p><code>10.1.0.10/32,\u00a0ubest/mbest:\u00a01/0</code> <code>*via\u00a0100.64.0.11%default,\u00a0[200/0],\u00a000:02:44,\u00a0bgp-65000,\u00a0internal,\u00a0tag\u00a065000\u00a0(evpn)\u00a0segid:\u00a030001</code> <code>tunnelid:\u00a00xa000003\u00a0encap:\u00a0VXLAN</code></p> <p>Troubleshooting</p> <p><code>show\u00a0troubleshoot\u00a0l3\u00a0ipv4\u00a010.0.0.10\u00a0src-ip\u00a010.0.0.20\u00a0vrf\u00a0Tenant1</code></p>"},{"location":"cisco/Cisco_EVPN/#anycast-gw","title":"Anycast GW","text":"<p>Om man sl\u00e5r p\u00e5 anycast gateway feature f\u00f6r ett VNI s\u00e5 m\u00e5ste det enableas p\u00e5 alla VTEP:s d\u00e4r VNI finns.</p> <p><code>fabric\u00a0forwarding\u00a0anycast-gateway-mac\u00a00000.1111.2222</code></p> <p><code>interface\u00a0Vlan100</code> <code>vrf\u00a0member\u00a0Tenant1</code> <code>ip\u00a0address\u00a010.0.0.1/24</code> <code>fabric\u00a0forwarding\u00a0mode\u00a0anycast-gateway</code> <code>no\u00a0shut</code></p>"},{"location":"cisco/Cisco_EVPN/#arp-suppression","title":"ARP Suppression","text":"<p>Man kan l\u00e5ta en lokal ARP-proxy hantera requests f\u00f6r att suppressa ARP flooding \u00f6ver VXLAN s\u00e5 mycket som m\u00f6jligt. Notera att ARP Suppression inte jobbar med n\u00e5got IPv6-relaterat.</p> <p><code>interface\u00a0nve1</code> <code>member\u00a0vni\u00a010100</code> <code>suppress-arp</code> <code>member\u00a0vni\u00a010101</code> <code>suppress-arp</code></p> <p><code>show\u00a0ip\u00a0arp\u00a0suppression-cache\u00a0detail</code></p> <p>OBS p\u00e5 vissa plattformar m\u00e5ste man karva TCAM f\u00f6r att kunna konfigurera arp-suppression. H\u00e4r \u00e4r ett exempel f\u00f6r Nexus 9000v.</p> <p><code>show\u00a0run\u00a0all\u00a0|\u00a0inc\u00a0\"hardware\u00a0access-list\u00a0tcam\u00a0region\"</code></p> <p><code>hardware\u00a0access-list\u00a0tcam\u00a0region\u00a0span\u00a00</code> <code>hardware\u00a0access-list\u00a0tcam\u00a0region\u00a0racl\u00a0512</code> <code>copy\u00a0run\u00a0start</code> <code>reload</code></p> <p><code>hardware\u00a0access-list\u00a0tcam\u00a0region\u00a0arp-ether\u00a0256\u00a0double-wide</code> <code>copy\u00a0run\u00a0start</code> <code>reload</code></p>"},{"location":"cisco/Cisco_EVPN/#external-connectivity","title":"External Connectivity","text":"<p>Prefix-based routing (Type-5 Routes) anv\u00e4nds prim\u00e4rt f\u00f6r destinations utanf\u00f6r DC. IP-VRF till IP-VRF g\u00f6rs enligt interface-less model dvs routsen har en RMAC attached.</p> <p><code>router\u00a0bgp\u00a065000</code> <code>address-family\u00a0l2vpn\u00a0evpn</code> <code>maximum-paths\u00a0ibgp\u00a04</code></p> <p><code>vrf\u00a0Tenant1</code> <code>address-family\u00a0ipv4\u00a0unicast</code> <code>advertise\u00a0l2vpn\u00a0evpn</code> <code>redistribute\u00a0direct\u00a0route-map\u00a0ALLOW-ALL</code></p> <p>Verify</p> <p><code>show\u00a0bgp\u00a0ip\u00a0unicast\u00a0vrf\u00a0Tenant1</code></p> <p>Exempel p\u00e5 sl\u00e4ppa ut en tenant (10.0.0.0/24) ifr\u00e5n evpn-vxlan-fabricen. Vanlig OSPF pratas mellan border leaf och external device. P\u00e5 border leaf:</p> <p><code>router\u00a0ospf\u00a0100</code> <code>vrf\u00a0Tenant1</code> <code>redistribute\u00a0bgp\u00a065000\u00a0route-map\u00a0ALLOW-ANY</code></p> <p><code>router\u00a0bgp\u00a065000</code> <code>vrf\u00a0Tenant1</code> <code>address-family\u00a0ipv4\u00a0unicast</code> <code>advertise\u00a0l2vpn\u00a0evpn</code> <code>redistribute\u00a0ospf\u00a0100\u00a0route-map\u00a0ALLOW-ANY</code> <code>aggregate-address\u00a010.0.0.0/24</code></p>"},{"location":"cisco/Cisco_EVPN/#dhcp-relay","title":"DHCP Relay","text":"<p>VXLAN EVPN har st\u00f6d f\u00f6r DHCP relay-funktionalitet. I en multi-tenant-l\u00f6sning anv\u00e4nds tre suboptions av Option 82.</p> <ul> <li>Sub-option 151 - Virtual Subnet Selection</li> <li>Sub-option 11 - Server ID Override</li> <li>Sub-option 5 - Link Selection</li> </ul> <p><code>feature\u00a0dhcp</code></p> <p><code>service\u00a0dhcp</code> <code>ip\u00a0dhcp\u00a0relay</code> <code>ip\u00a0dhcp\u00a0relay\u00a0information\u00a0option</code> <code>ip\u00a0dhcp\u00a0relay\u00a0information\u00a0option\u00a0vpn</code> <code>ipv6\u00a0dhcp\u00a0relay</code></p> <p>Om DHCP-server \u00e4r n\u00e5bar i default-VRFen.</p> <p><code>interface\u00a0Vlan1001</code> <code>description\u00a0Tenant\u00a0facing\u00a0SVI</code> <code>ip\u00a0dhcp\u00a0relay\u00a0address\u00a0100.0.1.10\u00a0use-vrf\u00a0default</code></p> <p>Om DHCP-server finns i tenant-VRF m\u00e5ste man skapa ett unikt tenant-loopback per VTEP eftersom det m\u00e5ste vara en unik IP-adress som source f\u00f6r de relayade DHCP-paketen f\u00f6r att servern ska kunna svara till r\u00e4tt relay agent.</p> <p><code>interface\u00a0loopback11</code> <code>vrf\u00a0member\u00a0Tenant1</code> <code>ip\u00a0address\u00a011.11.11.11/32</code></p> <p><code>interface\u00a0Vlan1001</code> <code>description\u00a0Tenant\u00a0facing\u00a0SVI</code> <code>ip\u00a0dhcp\u00a0relay\u00a0address\u00a0100.0.1.10</code> <code>ip\u00a0dhcp\u00a0relay\u00a0source-interface\u00a0loopback11</code></p>"},{"location":"cisco/Cisco_EVPN/#multicast","title":"Multicast","text":"<p>EVPN kan l\u00f6sa IPv4 routed multicast f\u00f6r tenants (TRM). Man k\u00f6r MVPN ovanp\u00e5 vxlan-fabricen f\u00f6r att f\u00f6rhindra on\u00f6dig multicast-forwardering, samma som i MPLS-n\u00e4t fast utan PIM. Man anv\u00e4nder ngMVPN, det beh\u00f6vs ingen RP och designated router \u00e4r distribuerad (Anchor DR). Inga PIM- eller IGMP-paket skickas allts\u00e5 \u00f6ver fabricen utan BGP g\u00f6r jobbet. PIM ASM och PIM SSM funkar i overlay men inte PIM BiDir. Man har en multicastgrupp i underlay per vrf (coret m\u00e5ste vara multicast-baserat). L2 only mode finns ocks\u00e5 n\u00e4r man t.ex. inte har n\u00e5gon VRF. Med TRM s\u00e5 \u00e4r inte advertise-pip och advertise virtual-rmac supporterat.</p> <p><code>feature\u00a0ngmvpn</code> <code>ip\u00a0igmp\u00a0snooping\u00a0vxlan</code> <code>advertise\u00a0evpn\u00a0multicast</code> <code>ip\u00a0multicast\u00a0overlay-spt-only</code></p> <p>Tenant</p> <p><code>interface\u00a0loopback\u00a0300</code> <code>vrf\u00a0member\u00a0Tenant-TRM</code> <code>ip\u00a0address\u00a01.1.1.1/32</code> <code>ip\u00a0pim\u00a0sparse-mode</code></p> <p><code>vrf\u00a0context\u00a0Tenant-TRM</code> <code>vni\u00a030000</code> <code>ip\u00a0pim\u00a0rp-address\u00a01.1.1.1\u00a0group-list\u00a0224.0.0.0/4</code> <code>ip\u00a0pim\u00a0ssm\u00a0range\u00a0232.0.0.0/8</code> <code>address-family\u00a0ipv4\u00a0unicast</code> <code>route-target\u00a0both\u00a0auto</code> <code>route-target\u00a0both\u00a0auto\u00a0mvpn</code> <code>route-target\u00a0both\u00a0auto\u00a0evpn</code></p> <p>IP 1.1.1.1 ska finnas p\u00e5 alla VTEPs samt att \"ip pim sparse-mode\" ska l\u00e4ggas p\u00e5 tenants L3SVI:er.</p> <p>Verify</p> <p><code>show\u00a0fabric\u00a0multicast\u00a0vrf\u00a0all</code> <code>show\u00a0fabric\u00a0multicast\u00a0globals</code></p>"},{"location":"cisco/Cisco_EVPN/#vxlan-evpn-multi-site","title":"VXLAN EVPN Multi-Site","text":"<p>Man kan bygga en multisite l\u00f6sning genom att uppr\u00e4tta eBGP-sessioner mellan s\u00e5 kallade border gateways och l\u00e5ta dem skriva om next-hop i EVPN-uppdateringarna, dvs reoriginera EVPN-routes. VTEPs ser endast neighbors och border gateways i sin egen fabric. Alla externa routes har border gateway som next-hop och BGW g\u00f6r data plane decapsulation och re-encapsulation. Det g\u00e5r allts\u00e5 att str\u00e4cka L2 mellan siter men man f\u00e5r \u00e5tminstone protection och enforcement points i form av BGWs och storm-control. BGW-rollen g\u00e5r \u00e4ven att kombinera med vanlig VRF-Lite, t.ex. om det kommer in back-to-back VRF kopplingar f\u00f6r tenants.</p> <p>Varje sites border gateways s\u00e4tts upp som anycast (virtual IP), f\u00f6r lastdelning och redundans, och BGWs pratar VIP till VIP med varandra mellan siterna. Ut\u00f6ver VIP har varje BGW en PIP (man anv\u00e4nder primary VTEP IP), den anv\u00e4nds f\u00f6r L2 BUM. Mellan siter \u00e4r det endast ingress replication f\u00f6r BUM-transport men inom siterna kan det vara PIM ASM eller ingress replication. Det beh\u00f6ver heller inte matcha mellan siterna. BGWs blir BUM-DF per L2VNI, p\u00e5 s\u00e5 s\u00e4tt distribueras trafiken. Election process g\u00f6rs och DF synkas med hj\u00e4lp av Route Type 4 (Ethernet segment route) mellan BGWs inom siten. BGW har flera inbyggda split horizon regler f\u00f6r att kunna flooda till alla samtidigt som loopar undviks. Det finns \u00e4ven pseudo-BGW, dvs leaf utan spine. D\u00e5 har man ingen internal site vtep neighbor. Det \u00e4r t.ex. anv\u00e4ndbart vid migreringar in i en EVPN/VXLAN fabric.</p> <p><code>evpn\u00a0multisite\u00a0border-gateway</code> <p><code>interface\u00a0loopback\u00a0100</code> <code>description\u00a0Anycast\u00a0BGW\u00a0IP</code></p> <p><code>interface\u00a0nve\u00a01</code> <code>source-interface\u00a0loopback\u00a00</code> <code>host-reachability\u00a0protocol\u00a0bgp</code> <code>multisite\u00a0border-gateway\u00a0interface\u00a0loopback\u00a0100</code> <code></code> <code>member\u00a0vni\u00a0200\u00a0\u00a0\u00a0\u00a0#Every\u00a0L2VNI\u00a0that\u00a0needs\u00a0stretch</code> <code>multisite\u00a0ingress-replication</code></p> <p><code>interface\u00a0ethernet1/1</code> <code>description\u00a0DCI</code> <code>evpn\u00a0multisite\u00a0dci-tracking</code> <code></code> <code>interface\u00a0ethernet1/2</code> <code>description\u00a0Spine</code> <code>evpn\u00a0multisite\u00a0fabric-tracking</code></p> <p><code>router\u00a0bgp\u00a065000</code> <code>address-family\u00a0l2vpn\u00a0evpn</code> <code>neighbor\u00a010.0.0.2</code> <code>remote-as\u00a065001</code> <code>peer-type\u00a0fabric-external</code> <code>address-family\u00a0l2vpn\u00a0evpn</code> <code>rewrite-evpn-rt-asn</code></p> <p>Tracking \u00e4r mandatory annars reorigineras inga EVPN routes, det g\u00f6rs endast om det finns DCI/fabric links som \u00e4r uppe. Man konfar heller inte next-hop-self, detta h\u00e4nder av sig sj\u00e4lv eftersom EVPN fungerar s\u00e5 default.</p> <p><code>show\u00a0nve\u00a0multisite</code> <code>show\u00a0nve\u00a0ethernet-segment</code> <code>show\u00a0nve\u00a0multisite\u00a0dci-links</code> <code>show\u00a0nve\u00a0multisite\u00a0fabric-links</code></p> <p>F\u00f6r \"show nve ethernet-segment\" notera att L3VNI alltid st\u00e5r som aktiv p\u00e5 alla BGWs eftersom designated-forwarder election inte g\u00f6rs f\u00f6r dem.</p> <p>Storm-control</p> <p><code>evpn\u00a0storm-control\u00a0broadcast\u00a0level\u00a010</code></p>"},{"location":"cisco/Cisco_EVPN/#overlay-stitching","title":"Overlay Stitching","text":"<p>Man kan binda ihop overlays med hj\u00e4lp av EVPN, t.ex. VXLAN \\&lt;-&gt; MPLS VPN.</p> <p>IOS-XE</p> <p><code>vrf\u00a0definition\u00a0Tenant1</code> <code>rd\u00a0125:101</code> <code></code> <code>address-family\u00a0ipv4</code> <code>route-target\u00a0export\u00a065000:30001</code> <code>route-target\u00a0import\u00a065000:30001</code> <code>route-target\u00a0export\u00a065000:30001\u00a0stitching</code> <code>route-target\u00a0import\u00a065000:30001\u00a0stitching</code> <code>exit-address-family</code></p> <p><code>bridge-domain\u00a03001</code> <code>member\u00a0vni\u00a030001</code></p> <p><code>interface\u00a0BDI3001</code> <code>vrf\u00a0forwarding\u00a0Tenant1</code> <code>ip\u00a0address\u00a0169.254.0.1\u00a0255.255.255.0</code> <code>encapsulation\u00a0dot1Q\u00a03001</code> <code>no\u00a0shut</code></p> <p><code>interface\u00a0nve1</code> <code>no\u00a0ip\u00a0address</code> <code>no\u00a0shutdown</code> <code>source-interface\u00a0Loopback0</code> <code>host-reachability\u00a0protocol\u00a0bgp</code> <code>member\u00a0vni\u00a030001\u00a0vrf\u00a0Tenant1</code></p> <p><code>router\u00a0bgp\u00a065000</code> <code>bgp\u00a0log-neighbor-changes</code> <code>no\u00a0bgp\u00a0default\u00a0ipv4-unicast</code> <code>no\u00a0bgp\u00a0default\u00a0route-target\u00a0filter</code> <code>neighbor\u00a010.0.0.11\u00a0remote-as\u00a065000</code> <code>neighbor\u00a010.0.0.11\u00a0update-source\u00a0Loopback0</code> <code>neighbor\u00a010.0.0.250\u00a0remote-as\u00a065000</code> <code>neighbor\u00a010.0.0.250\u00a0update-source\u00a0Loopback0</code></p> <p><code>address-family\u00a0vpnv4</code> <code>import\u00a0l2vpn\u00a0evpn\u00a0re-originate</code> <code>neighbor\u00a010.0.0.250\u00a0activate</code> <code>neighbor\u00a010.0.0.250\u00a0send-community\u00a0extended</code> <code>exit-address-family</code></p> <p><code>address-family\u00a0l2vpn\u00a0evpn</code> <code>import\u00a0vpnv4\u00a0unicast\u00a0re-originate</code> <code>neighbor\u00a010.0.0.11\u00a0activate</code> <code>neighbor\u00a010.0.0.11\u00a0send-community\u00a0both</code> <code>exit-address-family</code></p> <p>Detta autoskapas p\u00e5 ASR.</p> <p><code>interface\u00a0Tunnel0</code> <code>ip\u00a0unnumbered\u00a0Loopback0</code> <code>no\u00a0ip\u00a0redirects</code> <code>ip\u00a0mtu\u00a09216</code> <code>tunnel\u00a0source\u00a010.0.0.25</code> <code>tunnel\u00a0mode\u00a0udp\u00a0multipoint</code> <code>tunnel\u00a0src-port\u00a04789</code></p> <p>NXOS</p> <p><code>vrf\u00a0context\u00a0Tenant1</code> <code>vni\u00a030001</code> <code>rd\u00a0auto</code> <code>address-family\u00a0ipv4\u00a0unicast</code> <code>route-target\u00a0both\u00a0auto</code> <code>route-target\u00a0both\u00a0auto\u00a0evpn</code></p> <p><code>router\u00a0bgp\u00a065000</code> <code>neighbor\u00a010.2.2.2\u00a0remote-as\u00a065000</code> <code>address-family\u00a0vpnv4\u00a0unicast</code> <code>import\u00a0l2vpn\u00a0evpn\u00a0reoriginate</code> <code>neighbor\u00a010.10.10.201\u00a0remote-as\u00a065000</code> <code>address-family\u00a0l2vpn\u00a0evpn</code> <code>import\u00a0vpn\u00a0unicast\u00a0reoriginate</code></p>"},{"location":"cisco/Cisco_EVPN/#ios-xr","title":"IOS-XR","text":"<p>MPLS Data Plane</p>"},{"location":"cisco/Cisco_EVPN/#multihoming","title":"Multihoming","text":"<p>Man har en label f\u00f6r unicast och en multicast label f\u00f6r BUM. Label allocation g\u00f6rs per BD. Det finns ocks\u00e5 en label som anv\u00e4nds f\u00f6r split-horizon. F\u00f6r unicast \u00e4r det all active men f\u00f6r BUM s\u00e5 finns det en DF. Route type 4 anv\u00e4nds f\u00f6r DF election, detta g\u00f6rs lastdelat udda/j\u00e4mna EVI-ID. B\u00e5de RD och RT autogenereras.</p> <p>Leaf</p> <p><code>interface\u00a0TenGigE0/0/0/1</code> <code>description\u00a0\"Link\u00a0to\u00a0Host\"</code> <code>bundle\u00a0id\u00a01\u00a0mode\u00a0active</code> <code>load-interval\u00a030</code> <code>!</code> <code>interface\u00a0Bundle-Ether\u00a01</code> <code>lacp\u00a0system\u00a0mac\u00a01101.1111.1111</code> <code>load-interval\u00a030</code> <code>!</code> <code>evpn</code> <code>evi\u00a0100</code> <code>advertise-mac\u00a0\u00a0\u00a0&lt;-\u00a0enable\u00a0RT\u00a02\u00a0mac-only</code> <code>!</code> <code>interface\u00a0Bundle-Ether\u00a01</code> <code>ethernet-segment</code> <code>identifier\u00a0type\u00a00\u00a011.11.11.11.11.11.11.11.11</code> <code>bgp\u00a0route-target\u00a01111.1111.1111</code> <code>!</code> <code>!</code> <code>l2vpn</code> <code>bridge\u00a0group\u00a0Cust1</code> <code>bridge-domain\u00a0100</code> <code>interface\u00a0BE1</code> <code>evi\u00a0100</code> <code>!</code> <code>!</code> <code>router\u00a0bgp\u00a01</code> <code>address-family\u00a0l2vpn\u00a0evpn</code> <code>!</code> <code>neighbor-group\u00a0RR</code> <code>address-family\u00a0l2vpn\u00a0evpn</code></p> <p>Verify</p> <p><code>show\u00a0evpn\u00a0ethernet-segment\u00a0detail</code> <code>show\u00a0evpn\u00a0evi</code> <code>show\u00a0evpn\u00a0evi\u00a0mac</code></p> <p>Bring down AC F\u00f6r att undvika traffic blackholing n\u00e4r man tappar uppl\u00e4nkar kan man ange att AC ska st\u00e4ngas n\u00e4r noden \u00e4r isolerad.</p> <p><code>evpn</code> <code>group\u00a01</code> <code>core\u00a0interface</code> <code>core\u00a0interface</code> <code>!</code> <code>core-isolation-group\u00a01</code> <p>Single-Active Multihoming</p> <p><code>evpn</code> <code>interface\u00a0Bundle-Ether\u00a01</code> <code>ethernet-segment</code> <code>load-balancing-mode\u00a0single-active</code></p>"},{"location":"cisco/Cisco_EVPN/#routing_1","title":"Routing","text":"<p><code>cef\u00a0adjacency\u00a0route\u00a0override\u00a0rib</code> <code>!</code> <code>interface\u00a0BVI100</code> <code>host-routing\u00a0\u00a0\u00a0\u00a0&lt;-\u00a0enable\u00a0RT\u00a02\u00a0mac+IP</code> <code>vrf\u00a0Cust1</code> <code>ipv4\u00a0address\u00a010.0.0.1\u00a0255.255.255.0</code> <code>mac-address\u00a00000.0000.0111</code> <code>!</code> <code>router\u00a0bgp\u00a01</code> <code>address-family\u00a0vpnv4\u00a0unicast</code> <code>!</code> <code>vrf\u00a0Cust1</code> <code>rd\u00a0auto</code> <code>address-family\u00a0ipv4\u00a0unicast</code> <code>additional-path\u00a0receive</code> <code>maximum-paths\u00a0ibgp\u00a02</code> <code>redistribute\u00a0connected</code></p> <p>VPN Stitching EVPN\\&lt;-&gt;VPNv4/6 interconnect</p> <p><code>route-policy\u00a0rt2-filter</code> <code>if\u00a0destination\u00a0in\u00a0(0.0.0.0/0\u00a0ge\u00a032)\u00a0then</code> <code>drop</code> <code>else</code> <code>pass</code> <code>endif</code> <code>end-policy</code> <code>!</code> <code>router\u00a0bgp\u00a01</code> <code>address-family\u00a0l2vpn\u00a0evpn</code> <code>import\u00a0stitching-rt\u00a0re-origiante</code> <code>advertise\u00a0vpnv4\u00a0unicast\u00a0re-originated\u00a0stitching-rt</code> <code>!</code> <code>address-family\u00a0vpnv4\u00a0unicast</code> <code>import\u00a0re-originate\u00a0stitching-rt</code> <code>route-policy\u00a0rt2-filter\u00a0out</code> <code>advertise\u00a0vpnv4\u00a0unicast\u00a0re-originated</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_EtherChannel/","title":"Cisco EtherChannel","text":"<p>EtherChannel bundlar individuella Ethernet-l\u00e4nkar till en logisk l\u00e4nk. Linkaggregering motverkar tv\u00e5 problem som medf\u00f6ljer en ensam kabel, bandbreddsbegr\u00e4nsning och brist p\u00e5 feltolerans. EtherChannel tillhandah\u00e5ller lastdelning per frame och adderar bandbredd f\u00f6r de aktiva interfacen, t.ex. med tre aktiva 100 mbps members blir interface-bandbredden 300 mbps. F\u00f6r STP \u00e4r en etherchannel en l\u00e4nk och BPDUer skickas p\u00e5 en av member ports. F\u00f6r en etherchannel m\u00e5ste alla interface ha samma speed, duplex och STP port cost. \u00c4r det en VLAN-trunk m\u00e5ste ocks\u00e5 native och allowed VLAN vara samma. F\u00f6r access port-channel m\u00e5ste access-vlan vara samma.</p> <p>Se \u00e4ven vPC</p>"},{"location":"cisco/Cisco_EtherChannel/#konfiguration","title":"Konfiguration","text":"<p>Static</p> <p><code>interface\u00a0range\u00a0gi0/1\u00a0-\u00a02</code> <code>channel-group\u00a01\u00a0mode\u00a0on</code> <code>interface\u00a0port-channel\u00a01</code> <code>switchport\u00a0mode\u00a0trunk</code></p> <p>Verify</p> <p><code>show\u00a0etherchannel\u00a0summary</code></p>"},{"location":"cisco/Cisco_EtherChannel/#l3","title":"L3","text":"<p>Det \u00e4r viktigt att man konfigurerar L3 etherchannel i r\u00e4tt ordning. N\u00e4r channel-group-kommandot exekveras tas attributen fr\u00e5n member interfacen till port-channel-interfacet. Det betyder att no switchport m\u00e5ste sl\u00e5s f\u00f6rst annars blir port-channel-interfacet en switchport och detta g\u00e5r inte \u00e4ndra i efterhand.</p> <p><code>interface\u00a0range\u00a0gi0/1\u00a0-\u00a02</code> <code></code><code>no`` ``switchport</code> <code>channel-group\u00a01\u00a0mode\u00a0[mode]</code> <code>interface\u00a0port-channel\u00a01</code> <code></code><code>no`` ``switchport</code> <code>ip\u00a0address\u00a0[ip\u00a0address]\u00a0[subnet\u00a0mask]</code></p>"},{"location":"cisco/Cisco_EtherChannel/#load-balancing","title":"Load-balancing","text":"<p>Global inst\u00e4llning. EtherChannel tillhandah\u00e5ller lastdelning per frame.</p> <p><code>port-channel\u00a0load-balance\u00a0[method]</code> <code>show\u00a0etherchannel\u00a0load-balance</code></p> <p>Kolla vilket interface en viss frame skickas p\u00e5.</p> <p><code>test\u00a0etherchannel\u00a0load-balance\u00a0interface\u00a0port-channel\u00a01\u00a0ip</code><code></code> <code>Would`` ``select`` ``Gi1/0/4`` ``of`` ``Po1</code>"},{"location":"cisco/Cisco_EtherChannel/#misconfiguration-guard","title":"Misconfiguration Guard","text":"<p>Misconfiguration guard \u00e4r en feldetekteringsmekanism som jobbar lokalt per switch. Duplex och speed m\u00e5ste \u00f6verensst\u00e4mma p\u00e5 alla portar samt att alla BPDUer som kommer in har samma source MAC-adress. Detta \u00e4r en global inst\u00e4llning som automatically error-disables alla portar som \u00e4r felkopplade.</p> <p><code>spanning-tree\u00a0etherchannel\u00a0guard\u00a0misconfig</code> <code>show\u00a0spanning-tree\u00a0summary\u00a0|\u00a0i\u00a0EtherChannel</code></p>"},{"location":"cisco/Cisco_EtherChannel/#lacp","title":"LACP","text":"<p>Link Aggregation Control Protocol (802.3ad) \u00e4r ett IEEE kontrollprotokoll f\u00f6r etherchannels. En EtherChannel bildas endast om man lyckas f\u00f6rhandla med andra sidan. F\u00f6rdeler med en mekanism som h\u00e5ller koll p\u00e5 l\u00e4nkarna \u00e4r att failover g\u00f6rs automatiskt och kabel/konfigurationsmisstag l\u00f6per mindre risk att st\u00e4lla till o\u00f6nskat beteende i n\u00e4tverket. Destination mac adress f\u00f6r LACP-frames \u00e4r 01:80:c2:00:00:02. N\u00e4r LACP ska uppt\u00e4cka andra sidan initialt skickas LACPDU varje sekund. Sedan \u00e4ndras det beroende p\u00e5 keepalive mode, slow (30 sek interval) \u00e4r default. Att \u00e4ndra g\u00f6rs per interface, lacp rate fast, men alla switchmodeller st\u00f6djer inte fast rate (1 sek interval).</p>   LACPDU    [](/File:Cisco_LACP.png \"wikilink\")"},{"location":"cisco/Cisco_EtherChannel/#konfiguration_1","title":"Konfiguration","text":"<p>F\u00f6r att initiera LACP anv\u00e4nds nyckelordet active. Det finns ocks\u00e5 passive mode = speak when spoken to.</p> <p><code>interface\u00a0range\u00a0gi0/1\u00a0-\u00a02</code> <code>channel-group\u00a01\u00a0mode\u00a0active</code></p> <p>Enable LACP auto on interface.</p> <p><code>channel-group\u00a0auto</code></p> <p>Maximalt kan 16 interface konfigureras i en EtherChannel men endast 8 kan vara aktiva samtidigt. Vilka l\u00e4nkar som ska vara aktiva best\u00e4ms av den switch med l\u00e4gst LACP ID som utg\u00f6rs av MAC-adress och prioritet. Den anv\u00e4nder de portar med l\u00e4gst prio i f\u00f6rsta hand, detta \u00e4r lokala v\u00e4rden.</p> <p><code>lacp\u00a0system-mac\u00a00011.2233.4455</code> <code>lacp\u00a0system-priority\u00a032768</code></p> <p><code>interface\u00a0gi0/2</code> <code>lacp\u00a0port-priority\u00a00</code></p> <p>Verify</p> <p><code>show\u00a0etherchannel\u00a0protocol</code> <code>show\u00a0lacp\u00a0?</code> <code>show\u00a0lacp\u00a0neighbor</code></p>"},{"location":"cisco/Cisco_EtherChannel/#pagp","title":"PAgP","text":"<p>Port Aggregation Protocol \u00e4r ett Ciscoproperit\u00e4rt protokoll f\u00f6r samma funktionalitet som LACP. Det anv\u00e4nder destination mac 01:00:0C:CC:CC:CC. Kommandot per interface \u00e4r ist\u00e4llet: channel-group 1 mode auto/desirable</p>"},{"location":"cisco/Cisco_EtherChannel/#link-state-tracking","title":"Link State Tracking","text":"<p>Man kan konfigurera portar mot servrar att disablas om uplink g\u00e5r ner. Detta \u00e4r anv\u00e4ndbart om man har multihomed servers f\u00f6r d\u00e5 m\u00e4rker de att de ska sluta anv\u00e4nda sitt prim\u00e4ra NIC.</p> <p><code>link\u00a0state\u00a0track\u00a01</code></p> <p><code>int\u00a0range\u00a0gi0/1\u00a0-\u00a02</code> <code>switchport\u00a0trunk\u00a0encapsulation\u00a0dot1q</code> <code>switchport\u00a0mode\u00a0trunk</code> <code>channel-group\u00a01\u00a0mode\u00a0active</code> <code>link\u00a0state\u00a0group\u00a01\u00a0upstream</code></p> <p><code>int\u00a0po1</code> <code>description\u00a0Uplink</code> <code>switchport\u00a0trunk\u00a0encapsulation\u00a0dot1q</code> <code>switchport\u00a0mode\u00a0trunk</code> <code>link\u00a0state\u00a0group\u00a01\u00a0upstream</code></p> <p><code>int\u00a0gi0/10</code> <code>description\u00a0Server</code> <code>switchport\u00a0mode\u00a0access</code> <code>switchport\u00a0access\u00a0vlan\u00a010</code> <code>link\u00a0state\u00a0group\u00a01\u00a0downstream</code></p> <p>Verify</p> <p><code>show\u00a0link\u00a0state\u00a0group\u00a0detail</code></p>"},{"location":"cisco/Cisco_EtherChannel/#flex-links","title":"Flex Links","text":"<p>Tekniskt sett inte etherchannel men kan anv\u00e4ndas ist\u00e4llet f\u00f6r det i vissa situationer. Det som h\u00e4nder n\u00e4r prim\u00e4ren g\u00e5r ner \u00e4r att alla dynamiska MAC entries flyttas till backupinterfacet och det hamnar i forwarding state. Inga BPDUer inblandade. B\u00f6r anv\u00e4ndas tillsammans med UDLD.</p> <p><code>interface\u00a0po2</code> <code>switchport\u00a0backup\u00a0int\u00a0gi0/5</code> <code>switchport\u00a0backup\u00a0int\u00a0gi0/5\u00a0preemption\u00a0mode\u00a0forced</code> <code>switchport\u00a0backup\u00a0int\u00a0gi0/5\u00a0preemption\u00a0delay\u00a010</code></p> <p>Verify</p> <p><code>show\u00a0interface\u00a0po2\u00a0switchport\u00a0backup</code></p> <p>Antingen st\u00e5r det Backup Standby eller Backup Up beroende p\u00e5 status p\u00e5 port-channeln.</p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_FC/","title":"Cisco FC","text":"<p>Fibre channel \u00e4r ett data transport protocol som ger in-order och lossless transfer av blockdata. FC l\u00e4mpar sig bra f\u00f6r block based storage. Se \u00e4ven Cisco FCoE.</p> <p>Termer</p> <ul> <li>pWWN/WWPN: 64-bitars portadress p\u00e5 HBA (typ MAC-adress fast finns ej     i data plane)</li> <li>nWWN/WWNN: 64-bitars HBA-adress</li> <li>sWWN: Switch WWN</li> <li>Sequence: en eller flera data frames som h\u00f6r ihop (SEQ_ID) och     skickas i en enkelriktad str\u00f6m mellan tv\u00e5 N ports</li> <li>FCID: Logisk adress</li> <li>Principal switch: har bl.a. hand om domain ID distribution och RSCN,     finns en per SAN</li> <li>FCNS: Fibre Channel Name Server (typ DNS), k\u00f6rs p\u00e5 den utvalda     Principal switch</li> <li>RSCN: Registered State Change Notification \u00e4r en tj\u00e4nst som N ports     kan subscriba p\u00e5 f\u00f6r att f\u00e5 uppdateringar om vad som h\u00e4nder i     fabricen</li> <li>FSPF: Fabric Shortest Path First \u00e4r det routingprotokoll som k\u00f6rs i     fabricen (motsvarighet till OSPF f\u00f6r IP)</li> </ul> <p>Layers * FC-0: physical layer</p> <ul> <li>FC-1: enconding and error control</li> <li>FC-2: signaling protocol med frame structure och byte sequences</li> <li>FC-3: vilka services finns i fabricen, t.ex. time distribution och     s\u00e4kerhet</li> <li>FC-4: Mappning mellan FC och det som k\u00f6rs ovanp\u00e5, t.ex. SCSI eller     IP</li> </ul> <p>Initiators och targets har Host Bus Adapters (HBA), dessa kallas Node Ports. N ports kopplas till Fabric Ports (F ports) p\u00e5 FC-switcharna. Switchportar som kopplas ihop med varandra kallas Expansion (E) Ports, det \u00e4r p\u00e5 dessa som FSPF k\u00f6rs. Default r\u00e4knas FSPF cost: 1000 delat med link speed i Gbps, t.ex. 10G = 100. FSPF har default st\u00f6d f\u00f6r ECMP. Har man t.ex. Ciscoswitchar finns det st\u00f6d f\u00f6r VSAN (motsvarigheten till VLAN + VRF) kan man trunka dem \u00f6ver dessa E ports, d\u00e5 kallas det Trunking Expansion Ports (TE Ports).</p> <p>Det f\u00f6rsta som h\u00e4nder n\u00e4r man kopplar in en server \u00e4r att den skickar en Fabric Login (FLOGI). Detta g\u00f6rs till FFFFFE (well-known fibre channel address for a fabric F_Port). Switchen tar emot detta meddelande och registrerar denna unika WWPN med FCNS. FCNS svarar tillbaka med en unik 24-bitars Fibre Channel Identifier (FC_ID eller N_Port_ID). FCID best\u00e5r av Domain ID, Area ID, Port ID och \u00e4r routbar inom FC-dom\u00e4nen. Varje switch har ett eget domain ID som m\u00e5ste vara unikt i fabricen, detta g\u00e5r att konfa manuellt och b\u00f6rjar d\u00e5 g\u00e4lla n\u00e4r man startar om processen (fcdomain restart). N\u00e4r en initiator har f\u00e5tt ett FCID s\u00e5 skickar den Port Login (PLOGI). Detta g\u00f6rs till FFFFFC (well-known fibre channel address for a directory server). D\u00e5 registreras WWPN och det assignade FCID till FCNS. FCNS svarar d\u00e5 tillbaka med FCID:n f\u00f6r de targets som initiatorn har r\u00e4tt att accessa enligt zoningpolicyn. N\u00e4r PLOGI \u00e4r klart kan initiatorn b\u00f6rja sin discovery process f\u00f6r att hitta targets och deras capabilities och operating parameters. Detta g\u00f6rs mellan upper layer protocols och kallas PRLI. Sedan kan man hitta Logical Unit Numbers (LUNs).</p> <p>FLOGI-databasen \u00e4r allts\u00e5 locally significant inom switchen. D\u00e4r finns endast WWPN och FCID:n f\u00f6r de directly connected initiators och targets. FCNS-databasen \u00e4r distribuerad \u00f6ver alla switchar i fabricen och d\u00e4r finns alla n\u00e5bara WWPN och FC_ID:n.</p> <p>Eftersom FC \u00e4r lossless data transport s\u00e5 finns det inbyggd flow control mekanismer. Detta \u00e4r credit-based vilket betyder att mottagaren alltid kontrollerar fl\u00f6dena och s\u00e4ndaren f\u00e5r endast skicka data om den vet att mottagaren har tillr\u00e4ckligt med resurser f\u00f6r att ta emot det. Man ber\u00e4ttar f\u00f6r andra sidan hur mycket buffer som finns tillg\u00e4ngligt (BB_Credit) och s\u00e4ndaren r\u00e4knar sedan hur mycket som har skickats (BB_Credit_CNT). Counten f\u00e5r ej \u00f6verstiga BB_Credit. Varje g\u00e5ng en buffer blir ledig s\u00e5 skickas ett R_RDY message \u00f6ver till s\u00e4ndaren som d\u00e5 s\u00e4nker BB_Credit_CNT. Detta g\u00f6rs hela tiden mellan alla portar i fabricen.</p> <p>Zoning En zone \u00e4r en samling N ports i fabricen som k\u00e4nner till varandra men inget utanf\u00f6r zonen, ett slags VPN. Detta anv\u00e4nds f\u00f6r att f\u00e5 storage access control. Varje medlem kan definieras av port p\u00e5 switch, WWN, FCID eller ett operator configured alias. Zoning kan g\u00f6ras p\u00e5 tv\u00e5 olika s\u00e4tt, soft och hard zoning. Soft betyder att members endast ser varandra i name server queries medans hard g\u00f6rs med \"ACL:er\" i h\u00e5rdvaran i hela fabricen. Nuf\u00f6ritden finns endast hard zoning.</p> <p>En eller flera zoner kan aktiveras som en grupp och kallas d\u00e5 zone set. En fabric kan ha flera zone sets men endast en kan vara aktiv \u00e5t g\u00e5ngen. F\u00f6r att ha hand om detta finns det en Zone Server.</p> <p>VSAN Med virtuella SAN kan man k\u00f6ra flera SAN i samma h\u00e5rdvara. VSAN \u00e4r en emulering av en FC fabric, dvs man partitionerar upp sitt SAN. Varje VSAN k\u00f6r sin egen Name Server, Zone Server, Login Server etc. VSAN Manager \u00e4r en NX-OS process som h\u00e5ller koll p\u00e5 VSAN attribut och porttillh\u00f6righet. Alla portar p\u00e5 en Cisco-switch ligger default i VSAN 1. Man kan f\u00f6rl\u00e4nga VSAN genom att trunka dem \u00f6ver E ports, som d\u00e5 kallas TE_port. Alla frames taggas d\u00e5 med en VSAN header. Det g\u00e5r \u00e4ven att aggregera l\u00e4nkar som trunkar VSAN. FSPF cost \u00e4ndras inte n\u00e4r en member i en port-channel g\u00e5r ner. Man kan l\u00e5ta PCP agera kontrollprotokoll f\u00f6r l\u00e4nkaggregeringar likt LACP f\u00f6r ethernet. Man kan modifiera MTU per VSAN, det kommer att f\u00f6rhandlas vid FLOGI.</p>"},{"location":"cisco/Cisco_FC/#konfiguration","title":"Konfiguration","text":"<p>Nexus 5000. Default pratar bara Nexus-switchar FC med Cisco FC-switchar, detta g\u00e5r att \u00e4ndra med interoperability mode.</p> <p>Prereqs</p> <p><code>feature\u00a0fcoe</code></p> <p><code>slot\u00a01</code> <code>port\u00a044-48\u00a0type\u00a0fc</code></p> <p><code>copy\u00a0run\u00a0start</code> <code>reload</code></p> <p>Verify</p> <p><code>show\u00a0int\u00a0br</code> <code>show\u00a0int\u00a0e1/44\u00a0trans</code></p> <p>VSAN och trunk</p> <p><code>feature\u00a0fport-channel-trunk</code></p> <p><code>vsan\u00a0database</code> <code>vsan\u00a0100</code> <code>vsan\u00a0100\u00a0interface\u00a0fc1/44\u00a0-\u00a048</code></p> <p><code>interface\u00a0fc1/44\u00a0-\u00a045</code> <code>channel-group\u00a010</code></p> <p><code>interface\u00a0san-port-channel\u00a010</code> <code>channel\u00a0mode\u00a0active</code> <code>switchport\u00a0trunk\u00a0mode\u00a0on</code> <code>switchport\u00a0trunk\u00a0allowed\u00a0vsan\u00a0100</code></p> <p>Noter att b\u00e5da sidor b\u00f6r konfas klart innan man g\u00f6r no shutdown p\u00e5 port-channel.</p> <p><code>show\u00a0san-port-channel\u00a0database</code></p> <p>TE port</p> <p><code>interface\u00a0fc1/1\u00a0-\u00a02</code> <code>switchport\u00a0speed\u00a08000</code> <code>switchport\u00a0mode\u00a0E</code> <code>switchport\u00a0trunk\u00a0allowed\u00a0vsan\u00a0101</code></p> <p>TE Port-channel</p> <p><code>interface\u00a0fc2/1\u00a0-\u00a02</code> <code>switchport\u00a0speed\u00a08000</code> <code>switchport\u00a0mode\u00a0E</code> <code>channel-group\u00a011\u00a0force</code> <code>no\u00a0shutdown</code></p> <p><code>interface\u00a0san-port-channel\u00a011</code> <code>channel\u00a0mode\u00a0active</code> <code>switchport\u00a0mode\u00a0E</code> <code>switchport\u00a0trunk\u00a0allowed\u00a0vsan\u00a0101</code></p> <p>Verify show flogi database</p> <p><code>show\u00a0fcns\u00a0database</code> <code>show\u00a0fcdomain\u00a0domain-list</code> <code>show\u00a0fcroute\u00a0unicast</code></p> <p>Traffic Engineering</p> <p><code>interface\u00a0fc1/24</code> <code>fspf\u00a0cost\u00a050\u00a0vsan\u00a0100</code></p> <p><code>show\u00a0fspf\u00a0vsan\u00a0100</code></p> <p>Persistent FC ID</p> <p><code>fcdomain\u00a0fcid\u00a0persistent\u00a0vsan\u00a0100</code> <code>fcdomain\u00a0fcid\u00a0database</code> <code>vsan\u00a0100\u00a0wwn\u00a011:22:11:22:33:44:33:44\u00a0fcid\u00a00x66ee00</code></p> <p><code>show\u00a0fcdomain\u00a0fcid\u00a0persistent\u00a0vsan\u00a0100</code></p>"},{"location":"cisco/Cisco_FC/#zoning","title":"Zoning","text":"<p>Zoning \u00e4r en central del i FC, det \u00e4r access control i fabricen. Ett zoneset \u00e4r en eller flera zones. Zone-rekommendation \u00e4r single target, single initiatior och att man anv\u00e4nder pwwn eller alias. Det kan vara bra att k\u00e4nna till att vissa system \u00e4r case sensitive n\u00e4r det g\u00e4ller WWN:er. Hard zoning g\u00e5r ej att st\u00e4nga av p\u00e5 Nexus.</p> <p><code>zoneset\u00a0name\u00a0PROD-A\u00a0vsan\u00a0100</code> <code>zone\u00a0name\u00a0Server1-to-SAN</code> <code>member\u00a0pwwn\u00a010:00:00:23:45:00:00:10</code> <code>member\u00a0pwwn\u00a010:00:00:23:45:00:00:20</code></p> <p><code>zoneset\u00a0activate\u00a0name\u00a0PROD-A\u00a0vsan\u00a0100</code></p> <p>Show</p> <p><code>show\u00a0zone\u00a0status\u00a0vsan\u00a0100</code> <code>show\u00a0zoneset\u00a0active</code></p> <p>Permit all</p> <p><code>zone\u00a0default-zone\u00a0permit\u00a0vsan\u00a0100</code></p> <p>Enhanced Zoning G\u00f6r att varje g\u00e5ng man konfar det s\u00e5 l\u00e5ses konfen fabric wide av CFS. Om t.ex. ett vsan isoleras p\u00e5 en l\u00e4nk kolla att zoning mode \u00f6verenst\u00e4mmer (t\u00e4nk VTP).</p> <p><code>zone\u00a0mode\u00a0enhanced\u00a0vsan\u00a0100</code> <code>zone\u00a0confirm-commit</code> <code>zoneset\u00a0overwrite-control\u00a0vsan\u00a0100</code> <code>zone\u00a0commit\u00a0vsan\u00a0100</code></p> <p>Verify</p> <p><code>show\u00a0zone\u00a0status\u00a0vsan\u00a0100</code></p> <p>Man kan \u00e4ven distribuera sitt zoneset \u00f6ver fabricen</p> <p><code>zoneset\u00a0distribute\u00a0full\u00a0vsan\u00a0100</code></p> <p>Smart Zoning F\u00f6r att f\u00f6renkla sin konfig lite kan man anv\u00e4nda taggar f\u00f6r att ange vilka pwwn som \u00e4r initiators kontra targets. Detta m\u00e5ste vara p\u00e5slaget p\u00e5 alla switchar i fabricen.</p> <p><code>zone\u00a0smart-zone\u00a0enable\u00a0vsan\u00a0100</code> <code>zone\u00a0convert\u00a0smart-zone\u00a0vsan\u00a0100</code></p> <p>ACLTCAM usage MDS</p> <p><code>show\u00a0system\u00a0internal\u00a0acl\u00a0tcam-usage</code> <code>show\u00a0system\u00a0internal\u00a0acltcam-soc\u00a0tcam-usage</code></p> <p>Alias Man b\u00f6r anv\u00e4nda alias f\u00f6r att f\u00f6renkla zonhantering och fels\u00f6kning. \u00c4ven detta kan distribueras mha CFS, det kallas d\u00e5 enhanced device aliases och valfri nod kan g\u00f6ra \u00e4ndringar som propagerar genom n\u00e4tet.</p> <p><code>device-alias\u00a0mode\u00a0enhanced</code> <code>device-alias\u00a0database</code> <code>name\u00a0Server1-HBA1\u00a0pwwn\u00a000:11:11...</code> <code>name\u00a0SAN-Array1-port1\u00a0pwwn\u00a000:22:22...</code></p> <p><code>device-alias\u00a0commit</code> <code>show\u00a0device-alias\u00a0status</code></p> <p>Zone Merge Om man ska koppla ihop tv\u00e5 SAN kan man skydda sig mot felkonfad zoning genom att st\u00e4lla merge-control till restrict. Kopplar man ihop tv\u00e5 SAN med olika zonesets blir ISL:en isolated f\u00f6r de vsan som har mismatch.</p> <p><code>zone\u00a0merge-control\u00a0restrict\u00a0vsan\u00a0100</code></p>"},{"location":"cisco/Cisco_FC/#port-security","title":"Port Security","text":"<p>FC Port Security \u00e4r ut\u00f6kad s\u00e4kerhet j\u00e4mf\u00f6rt med zoning, man l\u00e5ter inte ens obeh\u00f6riga logga in i fabricen. Login requests fr\u00e5n obeh\u00f6riga FC devices (Nx ports) och switchar (xE ports) nekas. Alla nekade inloggningsf\u00f6rs\u00f6k loggas genom system messages. Man kan anv\u00e4nda pWWN, nWWN eller sWWN f\u00f6r att vitlista vem som f\u00e5r vara med i fabricen. Konfigurationen g\u00e5r att distribuera med hj\u00e4lp av CFS, det \u00e4r dock avst\u00e4ngt default.</p> <p>Man kan \u00e4ven l\u00e5ta switcharna l\u00e4ra sig port security konfigurationen automatiskt \u00f6ver tid. Detta kan man anv\u00e4nda n\u00e4r man aktiverar port security f\u00f6rsta g\u00e5ngen eftersom det sparar arbete genom att man inte m\u00e5ste g\u00e5 igenom alla portar manuellt, detta konfas per VSAN. N\u00e4r man aktiverar port security s\u00e5 aktiveras auto-learn automatiskt.</p> <p><code>feature\u00a0fc-port-security</code> <code>fc-port-security\u00a0activate\u00a0vsan\u00a01</code></p> <p>Lock vsan for new entries</p> <p><code>no\u00a0fc-port-security\u00a0auto-learn\u00a0vsan\u00a01</code></p> <p>Diff</p> <p><code>fc-port-security\u00a0database\u00a0diff\u00a0active\u00a0vsan\u00a01</code></p> <p>Verify</p> <p><code>show\u00a0fc-port-security\u00a0status</code> <code>show\u00a0fc-port-security\u00a0database\u00a0active</code> <code>show\u00a0fc-port-security\u00a0database\u00a0config</code> <code>show\u00a0fc-port-security\u00a0violations</code></p> <p>CFS</p> <p><code>fc-port-security\u00a0distribute</code></p>"},{"location":"cisco/Cisco_FC/#npv","title":"NPV","text":"<p>N-Port Virtualisation \u00e4r en teknik f\u00f6r att \u00f6ka skalbarhet och simplicitet i FC-SAN. Man l\u00e5ter en enskild fysisk N_Port ha multipla WWPN. NPV-enheten g\u00f6r en FLOGI och sedan kan den registrera fler WWPN och d\u00e5 f\u00e5 fler N_Port_ID. En NPV-enhet har F-portar downstream och NP-port upstream. En NPV-switch kopplas till F-port i SAN. HBA:er m\u00e4rker inte av NPV.</p> <p>Det finns ingen funktionell skillnad mellan fysiska WWPN och virtuella, man anv\u00e4nder dem f\u00f6r zoning och LUN masking som vanligt. D\u00e4remot g\u00f6r man ingen zoning i NPV-enheten, den har ingen preferens i fr\u00e5gan utan slussar bara vidare inlogg till ovanliggande switch. Notera att ovanliggande switch m\u00e5ste ha NPIV enableat. Nested NPV \u00e4r inte m\u00f6jligt. Notera att \"feature npv\" kr\u00e4ver en write erase och reload.</p> <p><code>feature\u00a0fcoe-npv</code> <code>feature\u00a0npv</code></p> <p>Ovanliggande switch</p> <p><code>feature\u00a0npiv</code></p>"},{"location":"cisco/Cisco_FCoE/","title":"Cisco FCoE","text":"<p>Fibre Channel over Ethernet \u00e4r en teknik f\u00f6r att enkapsulera Fibre Channel frames \u00f6ver lossless Ethernet. FCoE fungerar som vanlig FC men FC0 och FC1 g\u00f6rs av ethernet ist\u00e4llet. Se \u00e4ven Cisco FC. Genom att konsolidera n\u00e4tverk och storage beh\u00f6vs inte lika mycket kablage i datacentret. Servrar som ska nyttja FCoE beh\u00f6ver converged network adapters dvs de har fysiska ethernet-portar men de inneh\u00e5ller funktionsm\u00e4ssigt b\u00e5de HBA och NIC. FCoE har en dedikerad Ethertype, 0x8906, och fungerar med 802.1Q taggar. Fibre Channel \u00e4r ett st\u00e4ngt point-to-point medium medans Ethernet \u00e4r \u00f6ppet multi-access medium. Trots detta kan ethernet (med hj\u00e4lp av vissa enhancements) anv\u00e4ndas f\u00f6r att b\u00e4ra FC. Fibre Channel traffic kr\u00e4ver lossless transport. FCoE har en egen EtherType (0x8906).</p> <p>Termer * End Node (E-Node): de noder som har CNA.</p> <ul> <li>FCF: Fibre Channel Forwarder \u00e4r en switch som f\u00f6rst\u00e5r b\u00e5de FC och     FCoE.</li> </ul> <p>Overview <p>Data Center Bridging Ett DCB-n\u00e4tverk tillhandah\u00e5ller I/O consolidation. Det betyder att SAN- och LAN-trafik g\u00e5r i samma n\u00e4tverk. DCB kallas \u00e4ven DCE eller CEE. Switcharna m\u00e5ste supportera CoS-based traffic differentiation. Fibre Channel \u00e4r k\u00e4nsligt f\u00f6r packet drops och \u00e4r beroende av att paketen kommer fram i samma ordning som de skickades. I ett DCB-n\u00e4tverk anv\u00e4nds virtuella l\u00e4nkar (VLs) f\u00f6r att differentiera trafik-klasser. VLs \u00e4r en extension av CoS vilket g\u00f6r att trafik i en klass inte p\u00e5verkar trafik i en annan. Det finns 8 CoS v\u00e4rden. DCBX \u00e4r p\u00e5 default p\u00e5 Nexus-switchar.</p> <p>Priority Flow Control PFC (IEEE 802.1bb) \u00e4r ett subprotokoll till DCB. Det \u00e4r en mekanism som f\u00f6rhindrar frame loss pga congestion. Det \u00e4r likt 802.3x Flow Control (pause frames) men det jobbar p\u00e5 en per CoS basis. N\u00e4r en buffer threshold \u00f6verstigs pga congestion s\u00e5 skickas en pause frame till andra sidan f\u00f6r att den ska sluta skicka frames med ett visst CoS-v\u00e4rde p\u00e5 den l\u00e4nken under en viss tid. N\u00e4r sedan trafik g\u00e5r ner under ett visst gr\u00e4nsv\u00e4rde s\u00e5 skickas en resume frame f\u00f6r att dra ig\u00e5ng datafl\u00f6det p\u00e5 l\u00e4nken igen. PFC kommunicerar genom att skicka frames till well-known multicast address 01:80:C2:00:00:01.</p> <p>Det f\u00f6rsta som h\u00e4nder n\u00e4r l\u00e4nken mellan FCoE-switch och CNA kommer upp \u00e4r att DCBX (Data Centre Bridging capabilities eXchange protocol) ber\u00e4ttar f\u00f6r CNA hur den ska vara konfad med avseende p\u00e5 PFC &amp; ETS (enhanced transmission selection). ETS jobbar med priority groups som man kan assigna bandbredd till. DCBX transporteras on the wire av LLDP. N\u00e4r DCBX \u00e4r klart kan FIP ta vid.</p> <p>FCoE Initiation Protocol FIP \u00e4r en v\u00e4sentlig del i FCoE. Det anv\u00e4nds f\u00f6r att uppt\u00e4cka och initiera FCoE-kapabla enheter som \u00e4r kopplade till ethernetn\u00e4tverket. FIP har hand om vlan och FCF discovery samt FLOGI och Fabric Discovery. Det \u00e4r FIP som s\u00e4tter upp virtuella FC-l\u00e4nkar. P\u00e5 varje FCoE Ethernet port p\u00e5 FCF skapas en virtuell FC-port (vfc). Varje virtuell FC-l\u00e4nk identifieras av FCoE VLAN ID samt MAC-adresserna i varje \u00e4nde p\u00e5 l\u00e4nken. Under FIP s\u00e5 f\u00e5r allts\u00e5 CNA reda p\u00e5 vilken mac-adress man ska prata med p\u00e5 FCF. Det betyder ocks\u00e5 att varje FC-paket m\u00e5ste vara taggat med det vlan som vsanet \u00e4r mappat med, detta vlan kan ej anv\u00e4ndas till n\u00e5got annat \u00e4n FCoE. Notera dock att FIP anv\u00e4nder native vlan f\u00f6rst men g\u00f6r en vlan discovery s\u00e5 man f\u00e5r en lista av FCoE-vlan.</p> <p>FIP bygger \u00e4ven l\u00e4nkar FCF till FCF f\u00f6r multihop FCoE samt h\u00e5ller koll p\u00e5 l\u00e4nkar mha periodiska maintenance messages. E-Nodes anv\u00e4nder olika MAC-adresser f\u00f6r FIP och FCoE. FIP sourcas med burned in address medans FCoE sourcas med den MAC-adress som fabricen tillhandah\u00e5llit, Fabric Provided MAC Address. FPMA utg\u00f6rs av FCoE MAC address prefix (24 bitar) plus FC_ID (24 bitar). F\u00f6r att rymma den maximala FC-framen \u00e4r qos class-fcoe definierad med MTU 2240 bytes. FIP har en dedikerad Ethertype (0x8914). Protokollet finns i tv\u00e5 versioner (CIN-DCBX &amp; CEE-DCBX) och Nexus har st\u00f6d f\u00f6r b\u00e5da.</p>"},{"location":"cisco/Cisco_FCoE/#konfiguration","title":"Konfiguration","text":"<p>Nedan f\u00f6ljer FCoE-specifik konfiguration, f\u00f6r \u00f6vrig konfiguration se Cisco FC. Eftersom FCoE och FIP anv\u00e4nder ett taggat FCoE-vlan s\u00e5 m\u00e5ste ethernetport p\u00e5 FCF mot servrar vara vlan-trunk.</p> <p>QoS Kontrollera att QoS \u00e4r konfat med minst en no-drop klass. Default anv\u00e4nds CoS 3 f\u00f6r FCoE.</p> <p><code>show\u00a0policy-map\u00a0system\u00a0type\u00a0network-qos</code></p> <p>VSAN Default mappas vsan till vlan med samma ID.</p> <p><code>vsan\u00a0database</code> <code>vsan\u00a0100</code></p> <p><code>vlan\u00a0100</code> <code>fcoe\u00a0vsan\u00a0100</code></p> <p>F-port</p> <p><code>interface\u00a01/15</code> <code>switchport\u00a0mode\u00a0trunk</code> <code>switchport\u00a0trunk\u00a0allowed\u00a0vlan\u00a01,100-105</code> <code>spanning-tree\u00a0port\u00a0type\u00a0edge\u00a0trunk</code></p> <p><code>interface\u00a0vfc\u00a0315</code> <code>bind\u00a0interface\u00a0e1/15</code> <code>switchport\u00a0mode\u00a0f</code></p> <p>Verify</p> <p><code>show\u00a0flogi\u00a0database</code> <code>show\u00a0fcns\u00a0database</code> <code>show\u00a0vlan\u00a0fcoe</code> <code>show\u00a0fcoe\u00a0database</code> <code>show\u00a0topology\u00a0vsan\u00a0100</code></p> <p>PFC interface ethernet 1/15</p> <p><code>priority-flow-control\u00a0mode\u00a0auto</code></p> <p><code>show\u00a0interface\u00a0priority-flow-control</code> <code>show\u00a0qos\u00a0dcbxp\u00a0interface</code></p> <p>auto betyder att no-drop CoS values ska annonseras och f\u00f6rhandlas med hj\u00e4lp av DCBXP. En successful negotiation sl\u00e5r p\u00e5 PFC p\u00e5 no-drop CoS. Medans om det t.ex. \u00e4r en mismatch i capabilities s\u00e5 kommer inte f\u00f6rhandlingen att lyckas och PFC f\u00f6rblir avst\u00e4ngt.</p> <p>FC-Map Man kan identifiera FC-fabricen mha MAC-adresser eftersom detta anv\u00e4nds till FPMA. FC-Map \u00e4r en isoleringsteknik. Frames som inte har detta prefix discardas, dvs alla switchar i fabrien m\u00e5ste ha samma FC-map. Default value \u00e4r 0E.FC.00.</p> <p><code>fcoe\u00a0fcmap\u00a00xefc10</code></p> <p>Fabric Priority Nexus 5000 annonserar sin prioritet, den anv\u00e4nds av CNA:er f\u00f6r att best\u00e4mma vilken som \u00e4r den b\u00e4sta switchen att ansluta till.</p> <p><code>fcoe\u00a0fcf-priority\u00a0128</code></p>"},{"location":"cisco/Cisco_FCoE/#multihop-fcoe","title":"Multihop FCoE","text":"<p>Precis som det finns virtuella F-portar finns det \u00e4ven virtuella E-portar.</p> <p><code>interface\u00a0vfc\u00a015</code> <code>bind\u00a0interface\u00a0ethernet\u00a01/15</code> <code>switchport\u00a0mode\u00a0e</code> <code>no\u00a0shut</code></p> <p><code>interface\u00a0ethernet\u00a01/15</code> <code>switchport\u00a0mode\u00a0trunk</code> <code>no\u00a0shut</code></p>"},{"location":"cisco/Cisco_FCoE/#enhanced-vpc","title":"Enhanced vPC","text":"<p>Man kan kombinera FCoE med Enhanced vPC men man m\u00e5ste separera A- och B-sidan. Detta kan man g\u00f6ra genom att konfa FEX:arna att pinna FCoE-trafik till endast den ena parent. F\u00f6rst bygger man vPC och sedan FCoE p\u00e5 det. FCoE-vlan f\u00e5r ej traversera vPC peer-linken men detta sk\u00f6ts default. Host facing vfc-interfaces binds till fysiska ethernetport och inte port-channel interface.</p> <p>Nexus1</p> <p><code>fex\u00a0101</code> <code>fcoe</code></p> <p><code>interface\u00a0vfc\u00a010</code> <code>bind\u00a0interface\u00a0ethernet101/1/1</code> <code>no\u00a0shutdown</code></p> <p>Nexus2</p> <p><code>fex\u00a0102</code> <code>fcoe</code></p> <p><code>interface\u00a0vfc\u00a010</code> <code>bind\u00a0interface\u00a0ethernet102/1/1</code> <code>no\u00a0shutdown</code></p> <p>Show</p> <p><code>show\u00a0fex\u00a0detail\u00a0|\u00a0i\u00a0FCoE</code> <code>show\u00a0system\u00a0internal\u00a0dcbx\u00a0info\u00a0interface\u00a0ethernet\u00a0101/1/1</code></p>"},{"location":"cisco/Cisco_FCoE/#nexus-7k","title":"Nexus 7k","text":"<p>FCoE g\u00f6rs med hj\u00e4lp av Storage VDC.</p> <p><code>license\u00a0fcoe\u00a0module\u00a02</code></p> <p><code>system\u00a0qos</code> <code>service-policy\u00a0type\u00a0network-qos\u00a0default-nq-7e-4q8q-policy</code></p> <p><code>vdc\u00a0SAN\u00a0type\u00a0storage</code> <code>allocate\u00a0interface\u00a0e2/1-8</code> <code>allocate\u00a0fcoe-vlan-range\u00a0100-101</code></p>"},{"location":"cisco/Cisco_FCoE/#iscsi","title":"iSCSI","text":"<p>iSCSI har egentligen inte mycket med switchar att g\u00f6ra men man b\u00f6r g\u00f6ra det lossless.</p> <p><code>class-map\u00a0type\u00a0qos\u00a0match-all\u00a0class-iscsi</code> <code>match\u00a0protocol\u00a0iscsi</code> <code>match\u00a0cos\u00a06</code></p> <p><code>policy-map\u00a0type\u00a0qos\u00a0qos_fcoe_and_iscsi</code> <code>class\u00a0class-iscsi</code> <code>set\u00a0qos-group\u00a02</code> <code>class\u00a0class-fcoe</code> <code>set\u00a0qos-group\u00a01</code></p> <p><code>policy-map\u00a0type\u00a0network-qos\u00a0network_fcoe_and_iscsi</code> <code>class\u00a0type\u00a0network-qos\u00a0class-iscsi</code> <code>mtu\u00a09216</code> <code>pause\u00a0no-drop</code> <code>class\u00a0type\u00a0network-qos\u00a0class-fcoe</code> <code>mtu\u00a02158</code> <code>pause\u00a0no-drop</code> <code>class\u00a0type\u00a0network-qos\u00a0class-default</code> <code>mtu\u00a09216</code></p> <p><code>system\u00a0qos</code> <code>service-policy\u00a0type\u00a0queuing\u00a0input\u00a0fcoe-default-in-policy</code> <code>service-policy\u00a0type\u00a0queuing\u00a0output\u00a0fcoe-default-out-policy</code> <code>service-policy\u00a0type\u00a0qos\u00a0input\u00a0qos_fcoe_and_iscsi</code> <code>service-policy\u00a0type\u00a0network-qos\u00a0network_fcoe_and_iscsi</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_FHRP/","title":"Cisco FHRP","text":"<p>First Hop Redundancy Protocol anv\u00e4nds f\u00f6r att skydda gateway-tillg\u00e4ngligheten genom att l\u00e5ta flera enheter agera backup f\u00f6r varandra. Se \u00e4ven Cisco HSRP.</p>"},{"location":"cisco/Cisco_FHRP/#vrrp","title":"VRRP","text":"<p>Virtual Router Redundancy Protocol (RFC 3768) \u00e4r ett \u00f6ppet FHRP. Det fungerar v\u00e4ldigt likt HSRP men med n\u00e5gra skillnader. Preemption \u00e4r p\u00e5slaget default till skillnad fr\u00e5n HSRP, b\u00e5da protokollen kan dock ha det p\u00e5 eller av. VRRP anv\u00e4nder den inbyggda trackingfunktionen i IOS. Source-IP f\u00f6r VRRP-paket \u00e4r interface IP, destination-IP \u00e4r 224.0.0.18 och protokoll \u00e4r 112. Hellos skickas default varje sekund. Man kan till skillnad fr\u00e5n HSRP ha samma virtual ip som interface ip. Konfigurerar man det \u00e4ndras VRRP-prio till 255 p\u00e5 den enheten som har samma IP som VIP. Backupenheter har 100 som default.</p> <p>MAC-adress: 00:00:5E:00:01:XX</p> <p>VRRPv3 F\u00f6r att st\u00f6dja IPv6 togs VRRPv3 (RFC 5798) fram. Det \u00e4r inkompatibelt med VRRPv2 men har st\u00f6d f\u00f6r b\u00e5de IPv4 och IPv6. Det har \u00e4ven st\u00f6d f\u00f6r mer fintrimmade timers. Dessa anges i millisekunder och default hello interval \u00e4r 1000ms. Timer learning \u00e4r ocks\u00e5 enabled default. Transport g\u00f6rs med IP protocol 112 och skickas till multicast address 224.0.0.18 och FF02:0:0:0:0:0:0:12. I v2 g\u00f6rs preemption till den med h\u00f6gst interface IP om tv\u00e5 noder har samma prio, s\u00e5 funkar inte v3 utan det \u00e4r endast h\u00f6gst prio som \u00e4ndra rollerna.</p> <p>Sl\u00e5 p\u00e5 VRRPv3 och Virtual Router Redundancy Service (VRRS) globalt. N\u00e4r man v\u00e4xlar till VRRPv3 st\u00e4ngs VRRPv2 av.</p> <p><code>fhrp\u00a0version\u00a0vrrp\u00a0v3</code></p>"},{"location":"cisco/Cisco_FHRP/#konfiguration","title":"Konfiguration","text":"<p>Konfiguration g\u00f6rs per interface. VRRP till\u00e5ter inte virtual router group 0 och har d\u00e4rmed aldrig en tom grupp.</p> <p><code>interface\u00a0gi0</code> <code>vrrp\u00a01\u00a0description\u00a0HA-gateway</code> <code>vrrp\u00a01\u00a0priority\u00a0&lt;1-254&gt;</code> <code>vrrp\u00a01\u00a0timers\u00a0advertise\u00a0[msec]\u00a0interval</code></p> <p>Timers m\u00e5ste matcha och man kan l\u00e5ta VRRP-gruppen l\u00e4ra sig advertisement interval fr\u00e5n master virtual router.</p> <p><code>vrrp\u00a01\u00a0timers\u00a0learn</code></p> <p>Preempt delay</p> <p><code>vrrp\u00a0delay\u00a0minimum\u00a030</code> <code>vrrp\u00a0delay\u00a0reload\u00a060</code></p> <p>Autentisering</p> <p><code>vrrp\u00a01\u00a0authentication\u00a0cisco</code></p> <p>Verify</p> <p><code>show\u00a0vrrp\u00a0brief</code> <code>show\u00a0vrrp\u00a0interface\u00a0gi0</code> <code>show\u00a0vrrp\u00a0all</code></p>"},{"location":"cisco/Cisco_FHRP/#glbp","title":"GLBP","text":"<p>Gateway Load Balancing Protocol \u00e4r ett Ciscoproperit\u00e4rt protokoll. Det togs fram f\u00f6r att kunna ha alla noder aktiva samtidigt. Default lastdelas det och varje AVF anv\u00e4nds i round-robin. GLBP Forwarder preemption \u00e4r p\u00e5 default med en delay p\u00e5 30 sekunder. Om en AVF blir unreachable s\u00e5 kommer AVG att redirecta trafiken genom att besvara requests f\u00f6r den gamla MAC-adressen med nya AVF:er. Source-IP f\u00f6r GLBP-paket \u00e4r interface IP, destination-IP \u00e4r 224.0.0.102 och transport \u00e4r UDP port 3222. Anv\u00e4nd GLBP load balancing method host-dependent n\u00e4r varje host alltid ska anv\u00e4nda samma router och anv\u00e4nd weighted n\u00e4r man vill ha unequal load balancing, t.ex. om routrarna har olika forwarderingskapacitet.</p> <p><code>interface\u00a0gi2</code> <code>glbp\u00a01\u00a0ip\u00a010.0.0.10</code> <code>glbp\u00a01\u00a0priority\u00a0150</code> <code>glbp\u00a01\u00a0preempt</code> <code>glbp\u00a01\u00a0weighting\u00a050</code> <code>glbp\u00a01\u00a0load-balancing\u00a0weighted</code></p> <p>Verify</p> <p><code>show\u00a0glbp\u00a0brief</code></p> <p>Authentication En router ignorerar alla GLBP-meddelanden som har fel autentisering.</p> <p>Plain-text</p> <p><code>glbp\u00a01\u00a0authentication\u00a0text\u00a0secret</code></p> <p>MD5</p> <p><code>glbp\u00a01\u00a0authentication\u00a0md5\u00a0key-string\u00a0GLBP-Key</code></p> <p>Stateful NAT Om GLBP anv\u00e4nds i kombination med SNAT m\u00e5ste load-balancing vara satt till host-dependent.</p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_FTD/","title":"Cisco FTD","text":"<p>Firepower Threat Defense (FTD) \u00e4r Ciscos Next-Generation Firewall-erbjudande. Denna serie kommer att vara i fokus fram\u00e5t och p\u00e5 sikt ers\u00e4tta ASA-brandv\u00e4ggarna. Firepower-h\u00e5rdvaran kan k\u00f6ras antingen med ren ASA-kod eller med NGFW-koden; FTD. Alla ASA-brandv\u00e4ggar ur 5500-X-serien kan reimage:as till FTD ocks\u00e5, f\u00f6rutom 5585-X.</p> <p>Till skillnad fr\u00e5n ASA \u00e4r FTD inte CLI-drivet utan manageras via antingen ett lokalt webbgr\u00e4nssnitt, FDM (2100-serien och mindre) eller Firepower Management Center (FMC), en centraliserad management-server f\u00f6r en eller flera brandv\u00e4ggar (motsvarande PAN Panorama och CheckPoint Tracker). De CLI-kommandon som finns anv\u00e4nds f\u00f6r grundl\u00e4ggande installation och debugging.</p>"},{"location":"cisco/Cisco_FTD/#grundkonfiguration-av-ftd","title":"Grundkonfiguration av FTD","text":"<p>Logga in i konsolen med admin/Admin123 och fyll i IP, hostname m.m. i setup-wizarden. F\u00f6r att sedan kunna managera enheten via FMC k\u00f6r f\u00f6ljande kommando:</p> <p><code>configure\u00a0manager\u00a0add\u00a0&lt;hostname\u00a0|\u00a0IPv4_address\u00a0|\u00a0IPv6_address\u00a0|\u00a0DONTRESOLVE&gt;\u00a0\u00a0reg_key</code> <p>Exempel</p> <p><code>configure\u00a0manager\u00a0add\u00a010.11.12.13\u00a0my_reg_key</code></p> <p><code>Hostname/IP</code> anv\u00e4nds f\u00f6r att peka ut FMC.</p> <p><code>reg_key</code> \u00e4r en str\u00e4ng som anv\u00e4nds likt en shared secret f\u00f6r att ansluta FTD och FMC (denna anges senare i FMC).</p> <p><code>nat_id</code> anv\u00e4nds bara om NAT anv\u00e4nds mellan FTD och FMC, ange d\u00e5 ett unikt ID tillsammans med <code>DONTRESOLVE</code> ist\u00e4llet f\u00f6r hostname.</p> <p>Exempel med NAT</p> <p><code>configure\u00a0manager\u00a0add\u00a0DONTRESOLVE\u00a0my_reg_key\u00a0my_nat_id</code></p>"},{"location":"cisco/Cisco_FTD/#firepower-management-center","title":"Firepower Management Center","text":"<p>FMC anv\u00e4nds f\u00f6r att centralt managera FTD-brandv\u00e4ggar, FMC finns b\u00e5de som virtuell och fysisk appliance. F\u00f6r de st\u00f6rre FTD-brandv\u00e4ggarna kr\u00e4vs FMC f\u00f6r management.</p>"},{"location":"cisco/Cisco_FTD/#licensing-evaluation-period","title":"Licensing &amp; Evaluation Period","text":"<p>FMC kan testk\u00f6ras i 90 dagar, detta aktiveras under samma meny som anv\u00e4nds f\u00f6r Smart Licenses. F\u00f6r att aktivera din Smart License eller Evaluation Period, g\u00f6r s\u00e5h\u00e4r:</p> <p><code>1.\u00a0Klicka\u00a0eller\u00a0hovra\u00a0p\u00e5\u00a0System-fliken\u00a0i\u00a0\u00f6vre\u00a0h\u00f6ger\u00a0h\u00f6rn.</code></p> <p><code>2.\u00a0Under\u00a0Licenses-fliken,\u00a0v\u00e4lj\u00a0Smart\u00a0Licenses.</code></p> <p><code>3.\u00a0Aktivera\u00a0din\u00a0Evaluation\u00a0Period\u00a0eller\u00a0registrera\u00a0dina\u00a0Smart\u00a0Licenses.</code></p>"},{"location":"cisco/Cisco_FTD/#managera-ftd","title":"Managera FTD","text":"<p>Logga in i FMC via din webbl\u00e4sare och g\u00f6r f\u00f6ljande f\u00f6r att l\u00e4gga till din FTD-enhet f\u00f6r managering:</p> <p><code>1.\u00a0Klicka\u00a0p\u00e5\u00a0Devices-fliken\u00a0l\u00e4ngst\u00a0upp\u00a0p\u00e5\u00a0sidan.</code></p> <p><code>2.\u00a0Klicka\u00a0p\u00e5\u00a0Add...-knappen\u00a0l\u00e4ngst\u00a0till\u00a0h\u00f6ger,\u00a0v\u00e4lj\u00a0Add\u00a0Device.</code></p> <p><code>3.\u00a0Fyll\u00a0i\u00a0IP/Hostname\u00a0i\u00a0Host-f\u00e4ltet.</code></p> <p><code>4.\u00a0Fyll\u00a0i\u00a0samma\u00a0registration\u00a0key\u00a0som\u00a0konfigurerats\u00a0p\u00e5\u00a0FTD-enheten.</code></p> <p><code>5.\u00a0Tilldela/skapa\u00a0en\u00a0Access\u00a0Control\u00a0Policy\u00a0till\u00a0enheten.</code></p> <p><code>6.\u00a0Bocka\u00a0f\u00f6r\u00a0\u00f6nskade\u00a0licenser\u00a0under\u00a0Smart\u00a0Licensing.</code></p> <p><code>7.\u00a0Om\u00a0nat_id\u00a0anv\u00e4nts\u00a0i\u00a0FTD,\u00a0fyll\u00a0i\u00a0detta\u00a0efter\u00a0Unique\u00a0NAT\u00a0ID\u00a0under\u00a0Advanced.</code></p> <p><code>8.\u00a0Tryck\u00a0Register.</code></p>"},{"location":"cisco/Cisco_FTD/#omstart-av-fmc","title":"Omstart av FMC","text":"<p>Under System -&gt; Configuration -&gt; Process finns m\u00f6jlighet att starta om FMC-konsolen eller FMC-servern samt st\u00e4nga av FMC-servern.</p>"},{"location":"cisco/Cisco_FTD/#packet-tracer","title":"Packet Tracer","text":"<p>Finns under Devices -&gt; Device Management, klicka sedan p\u00e5 \"verktygsikonen\" f\u00f6r att komma Health Monitor-vyn. Starta h\u00e4rifr\u00e5n Advanced Troubleshooting, s\u00e5 finner du Packet Tracer som en separat flik. Det g\u00e5r \u00e4ven att n\u00e5 Packet Tracer via System -&gt; Health -&gt; Monitor, f\u00f6r att sedan klicka sig fram till enheten.</p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_GRE/","title":"Cisco GRE","text":"<p>Generic Routing Encapsulation (RFC 2784) \u00e4r ett tunnlingsprotokoll utvecklat av Cisco, det \u00e4r IP-protokoll 47. Enkapsulering g\u00f6rs genom att s\u00e4tta p\u00e5 en 4 byte GRE-header p\u00e5 L3-paketen och sedan s\u00e4tts en ny IPv4/IPv6-header p\u00e5 det s\u00e5 att det kan routas till andra \u00e4nden av tunneln och dekapsuleras. Diverse protokoll kan tunnlas, t.ex. MPLS och IPsec. Eftersom det \u00e4r enkapsulering p\u00e5verkas MTU s\u00e5 det b\u00f6r man h\u00e5lla koll p\u00e5. D\u00e4remot om man \u00e4ndrar tunnel mode till \"IPIP\" s\u00e5 reducerar man overheaden litegrann f\u00f6r d\u00e5 l\u00e4ggs det endast p\u00e5 en header ist\u00e4llet f\u00f6r tv\u00e5. Och vill man \u00f6ka overhead kan man k\u00f6ra tunnel i tunnel, man kan enkapsulera ett paket upp till fyra g\u00e5nger. GRE kan \u00e4ven k\u00f6ras multipoint, t.ex. i DMVPN.</p>"},{"location":"cisco/Cisco_GRE/#tunnel-key","title":"Tunnel Key","text":"<p>GRE Tunnel Key feature kan anv\u00e4ndas f\u00f6r att logiskt s\u00e4rskilja mellan flera tunnlar mellan samma noder. Det g\u00f6r att encapsulation router l\u00e4gger till en 4-bytes identifier i GRE-headern (t\u00e4nk VLAN-taggning). Om mottagande router ser att det \u00e4r en mismatch i key value kommer paketet att droppas.</p> <p>Utan key, 4 bytes header.  <p>Med key, 8 bytes header."},{"location":"cisco/Cisco_GRE/#konfiguration","title":"Konfiguration","text":"<p>R1</p> <p><code>interface\u00a0Tunnel0</code> <code>ip\u00a0address\u00a010.0.0.1\u00a0255.255.255.252</code> <code>ip\u00a0mtu\u00a01400</code> <code>ip\u00a0tcp\u00a0adjust-mss\u00a01360</code> <code>tunnel\u00a0source</code> <code>tunnel\u00a0destination</code> <p>V\u00e4ljer man ett interface som source anv\u00e4nds primary IP p\u00e5 det interfacet.</p> <p>R2</p> <p><code>interface\u00a0Tunnel0</code> <code>ip\u00a0address\u00a010.0.0.2\u00a0255.255.255.252</code> <code>ip\u00a0mtu\u00a01400</code> <code>ip\u00a0tcp\u00a0adjust-mss\u00a01360</code> <code>tunnel\u00a0source</code> <code>tunnel\u00a0destination</code> <p>Verify. Utan keepalives \u00e4r ett tunnel-interface UP/UP s\u00e5l\u00e4nge det inte \u00e4r administratively shutdown.</p> <p><code>show\u00a0ip\u00a0int\u00a0br</code> <code>show\u00a0interface\u00a0|\u00a0i\u00a0Tunnel\u00a0protocol</code></p>"},{"location":"cisco/Cisco_GRE/#keepalive","title":"Keepalive","text":"<p>Eftersom en GRE-tunnel g\u00e5r \u00f6ver andra enheter och l\u00e4nkar m\u00e5ste en keepalive skickas hela v\u00e4gen mellan tunnel-interfacen f\u00f6r att routern ska kunna veta om det \u00e4r uppe. Detta \u00e4r ej p\u00e5slaget default. Standardv\u00e4rden f\u00f6r keepalive \u00e4r 10 sekunders interval med 3 retries. Detta fungerar med GRE-tunnlar men inte med mGRE eftersom det d\u00e5 inte finns n\u00e5gon enskild destination att skicka keepalives till s\u00e5 de interfacen \u00e4r alltid UP/UP.</p> <p>En keepalive \u00e4r ett tomt GRE-paket till sig sj\u00e4lv som enkapsuleras och skickas till andra sidan. N\u00e4r paketet packas upp kommer destinationsadressen att kollas upp f\u00f6r att avg\u00f6ra vart det ska skickas vilket resulterar i att det skickas tillbaka.  <p><code>interface\u00a0Tunnel0</code> <code>keepalive</code><code></code> <p>Verify</p> <p><code>show\u00a0interface\u00a0tunnel\u00a00\u00a0|\u00a0i\u00a0Keepalive</code></p>"},{"location":"cisco/Cisco_GRE/#vrf","title":"VRF","text":"<p>Man kan ha tunnel-interfacet i en VRF medans tunneln sj\u00e4lv terminerar i en annan VRF.</p> <p><code>interface\u00a0Tunnel0</code> <code>vrf\u00a0forwarding\u00a0VRF-1</code> <code>ip\u00a0address\u00a010.0.0.1\u00a0255.255.255.252</code> <code>tunnel\u00a0vrf\u00a0VRF-2</code> <code>tunnel\u00a0source</code> <code>tunnel\u00a0destination</code>"},{"location":"cisco/Cisco_GRE/#recursive-routing","title":"Recursive Routing","text":"<p>Tunnel Source och Destination b\u00f6r alltid l\u00e4ras utanf\u00f6r tunneln. Om det \u00e4r problem med Recursive Routing kan man antingen disallow tunnel source att annonseras med hj\u00e4lp av en prefix-lista eller l\u00e4gga statiska routes med l\u00e4gre AD.</p> <p><code>Tunnel0`` ``temporarily`` ``disabled`` ``due`` ``to`` ``recursive`` ``routing</code></p>"},{"location":"cisco/Cisco_GRE/#qos","title":"QoS","text":"<p>N\u00e4r paket enkapsuleras och krypteras kan inte QoS-funktioner se original-headern och klassificera det korrekt eftersom VPN och tunnel operations appliceras innan QoS policy. Med QoS pre-classify f\u00f6r VPN:er \u00e4ndrar man denna ordning och paket kan klassificeras innan de tunnlas. Man kan \u00e4ven klassa p\u00e5 annat \u00e4n IP-prec eller DSCP. Se \u00e4ven Cisco QoS.</p> <p>Enable QoS for VPNs feature:</p> <p><code>interface\u00a0Tunnel0</code> <code>qos\u00a0pre-classify</code></p>"},{"location":"cisco/Cisco_GRE/#others","title":"Others","text":"<p>Man kan koppla ihop loopback-interface med hj\u00e4lp av GRE genom att s\u00e4tta tunnelinterfacen som unnumbered.</p> <p><code>interface\u00a0Tunnel0</code> <code>ip\u00a0unnumbered\u00a0Loopback0</code></p> <p>Drop corrupted and out-of-order VPN packets</p> <p><code>tunnel\u00a0checksum</code> <code>tunnel\u00a0sequence-datagrams</code></p>"},{"location":"cisco/Cisco_GRE/#ipv6","title":"IPv6","text":"<p>IPv6 g\u00e5r att tunnla och enkapsulering av IPv6 \u00e4r IP protokoll 41. IPv6-paket g\u00e5r \u00e4ven att tunnla \u00f6ver ett IPv4-n\u00e4tverk med hj\u00e4lp av flera olika tekniker, IPv4 end-to-end reachability \u00e4r det som kr\u00e4vs.</p> <p>Protokoll 41:</p>   \u00d6ver IPv6, \"tunnel mode ipv6\"    [](/File:Cisco_GRE_IPv6.PNG \"wikilink\")     \u00d6ver IPv4, \"tunnel mode ipv6ip\"    [](/File:Cisco_GRE_IPv6IP.PNG \"wikilink\")"},{"location":"cisco/Cisco_GRE/#manual-tunnel","title":"Manual tunnel","text":"<p>IPv6-IP-tunnlar anv\u00e4nder IP-protokoll 41 och vill man filtrera det i en acl f\u00e5r man anv\u00e4nda protokollnumret. Detta har n\u00e5got l\u00e4gre overhead \u00e4n GRE.</p> <p><code>interface\u00a0Tunnel0</code> <code>ipv6\u00a0address\u00a010::1/64</code> <code>tunnel\u00a0source\u00a0loopback0</code> <code>tunnel\u00a0destination\u00a010.0.0.20</code> <code>tunnel\u00a0mode\u00a0ipv6ip</code></p>"},{"location":"cisco/Cisco_GRE/#automatic-6to4","title":"Automatic 6to4","text":"<p>Tanken med automatiska 6to4-tunnlar \u00e4r att l\u00f6sa IPv6-routing \u00f6ver ett IPv4-n\u00e4tverk baserat p\u00e5 next-hop adresser inbakade i IPv6-adressen. IPv6-prefixet 2002::/16 \u00e4r reserverat f\u00f6r detta \u00e4ndam\u00e5l och l\u00f6sningen blir point-to-multipoint natively. Destination f\u00f6r tunneln anges inte manuellt utan det f\u00e5s fram f\u00f6r varje flow som ska forwarderas genom att ta ut 32 bitar fr\u00e5n destination IPv6 address p\u00e5 de paket som kommer in och ska till en annan IPv6-site. Det betyder att alla site prefix inklusive adressen p\u00e5 tunnel-interfacet m\u00e5ste tas ut fr\u00e5n den range som \u00e4r en kombination av det reserverade IPv6-prefixet och 6to4 border routerns f\u00f6r \u00f6vriga n\u00e5bara IPv4-adress, dvs 2002:\\&lt;32-bitar ipv4&gt;::/48.</p> <p><code>interface\u00a0Loopback0</code> <code>description\u00a0Border\u00a0Router\u00a0IPv4\u00a0Address</code> <code>ip\u00a0address\u00a0192.168.0.1\u00a0255.255.255.255</code></p> <p><code>interface\u00a0Tunnel0</code> <code>tunnel\u00a0source\u00a0Loopback0</code> <code>tunnel\u00a0mode\u00a0ipv6ip\u00a06to4</code> <code>ipv6\u00a0address\u00a02002:C0A8:0001::10/64</code></p> <p><code>ipv6\u00a0route\u00a02002::/16\u00a0tunnel\u00a00</code></p>"},{"location":"cisco/Cisco_GRE/#isatap","title":"ISATAP","text":"<p>Intra-Site Automatic Tunnel Addressing Protocol (RFC 5214) \u00e4r framtaget f\u00f6r m\u00f6jligg\u00f6ra IPv6-kommunikation mellan IPv4-only hosts och IPv6-enheter. IPv4-dom\u00e4nen fungerar som ett multi-access segment f\u00f6r IPv6 d\u00e4r IPv4-adresserna \u00e4r endpointsen. Klienter som vill anv\u00e4nda ISATAP fr\u00e5gar sin DNS-server om A record f\u00f6r \"ISATAP\", som b\u00f6r peka p\u00e5 ISATAP-routern. Hosten tunnlar sedan ett router discovery packet (med hj\u00e4lp av IPv6-in-IPv4 encapsulation) och skickar det till ISATAP-routern. Routern svarar med en RA som inneh\u00e5ller prefixet som ska anv\u00e4ndas och d\u00e5 kan klienten s\u00e4tta ihop sin egna g\u00e5ngbara IPv6-adress utifr\u00e5n ISATAP identifier (0000:5efe) och sin egen IPv4-adress. Adress m\u00e5ste tas med hj\u00e4lp av EUI-64 och d\u00e5 genereras interface ID automatiskt. ISATAP \u00e4r ocks\u00e5 point-to-multipoint natively</p> <p>Man beh\u00f6ver ej ange destination address manuellt.</p> <p><code>interface\u00a0Tunnel0</code> <code>ip\u00a0address\u00a02001:0:0:500::/64\u00a0eui-64</code> <code>no\u00a0ipv6\u00a0nd\u00a0suppress-ra</code> <code>tunnel\u00a0mode\u00a0ipv6ip\u00a0isatap</code></p> <p>Ett \u00e4ldre alternativ till ISATAP \u00e4r \"IPv6 Automatic IPv4-compatible\" (tunnel mode ipv6ip automatic) men det \u00e4r inte rekommenderat att k\u00f6ra.</p>"},{"location":"cisco/Cisco_GRE/#6rd","title":"6RD","text":"<p>IPv6 Rapid Deployment (RFC 5969) \u00e4r en generalisering av automatic 6to4 tunneling mechanism. Det \u00e4r en stateless transition mechanism som k\u00f6r IPv4 protocol 41 (IPv6 in IPv4). Notera att MTU i en 6RD-dom\u00e4n m\u00e5ste vara v\u00e4lmanagerat.</p> <p>Definitioner * 6RD CE: \"Customer Edge\" router som sitter mellan IPv6-enabled LAN site och IPv4-enabled SP network. Denna router har ett 6rd tunnel interface som agerar endpoint f\u00f6r IPv6-in-IPv4 enkapsuleringen och forwarderingen.</p> <ul> <li>6RD Border Relay (BR): Border Relay router st\u00e5r hos service     provider. Den har ett IPv4-interface, ett 6rd tunnel interface f\u00f6r     multi-point tunneling och ett IPv6-interface som n\u00e5r IPv6-internet.</li> <li>6RD Delegated Prefix: Detta-IPv6 prefix best\u00e4ms av CE och anv\u00e4nds av     hostarna p\u00e5 LAN site. Det funkar motsvarande DHCPv6 PD prefix.</li> <li>6RD Prefix: Detta IPv6-prefix best\u00e4ms av SP och anv\u00e4nds av hela     6rd-dom\u00e4nen.</li> <li>BR IPv4 address: Border Relays IPv4-adress. Denna adress anv\u00e4nds av     varje CE f\u00f6r att skicka paket till BR som ska till     IPv6-destinationer utanf\u00f6r 6rd-dom\u00e4nen.</li> <li>CE IPv4 address: IPv4-adress p\u00e5 CE som anv\u00e4nds f\u00f6r IPv4     internetaccess (t.ex. DHCP-assignad), denna kan vara global eller     privat inom 6rd-dom\u00e4nen. Denna adress anv\u00e4nds f\u00f6r att skapa 6rd     delegated prefix samt skicka och ta emot IPv6-paket.</li> </ul> <p>Konfiguration Tunnel 6rd ipv4 prefix-len 0 \u00e4r default.</p> <p>BR</p> <p><code>ipv6\u00a0general-prefix\u00a0RD\u00a06rd\u00a0Tunnel0</code> <code>!</code> <code>interface\u00a0Tunnel0</code> <code>no\u00a0ip\u00a0address</code> <code>ipv6\u00a0address\u00a0RD\u00a0::/128\u00a0anycast</code> <code>tunnel\u00a0source\u00a0Loopback0</code> <code>tunnel\u00a0mode\u00a0ipv6ip\u00a06rd</code> <code>tunnel\u00a06rd\u00a0prefix\u00a02002::/32</code> <code>!</code> <code>ipv6\u00a0route\u00a02002::/32\u00a0Tunnel0</code></p> <p>CE</p> <p><code>ipv6\u00a0general-prefix\u00a0RD\u00a06rd\u00a0Tunnel0</code> <code>!</code> <code>interface\u00a0Tunnel0</code> <code>no\u00a0ip\u00a0address</code> <code>ipv6\u00a0enable</code> <code>tunnel\u00a0source\u00a0Loopback0</code> <code>tunnel\u00a0mode\u00a0ipv6ip\u00a06rd</code> <code>tunnel\u00a06rd\u00a0prefix\u00a02002::/32</code> <code>tunnel\u00a06rd\u00a0br\u00a04.4.4.4</code> <code>!</code> <code>ipv6\u00a0route\u00a02002::/32\u00a0Tunnel0</code> <code>ipv6\u00a0route\u00a0::/0\u00a0Tunnel0\u00a02002:0:404:404::</code> <code>!</code> <code>interface\u00a0GigabitEthernet1</code> <code>description\u00a0LAN</code> <code>ipv6\u00a0address\u00a0RD\u00a0::/64\u00a0eui-64</code></p> <p>Verify</p> <p><code>show\u00a0tunnel\u00a06rd</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_HSRP/","title":"Cisco HSRP","text":"<p>Hot Standby Router Protocol (RFC 2281) \u00e4r ett standardiserat men Ciscolicensierat FHRP. HSRP l\u00e5ter tv\u00e5 routrar dela p\u00e5 en virtuell IP och MAC-adress s\u00e5 att andra system kan anv\u00e4nda samma IP/MAC och skicka paket till fast adressen kan vara aktiv p\u00e5 olika enheter. Tanken \u00e4r att de inte ens m\u00e4rker n\u00e4r ena routern g\u00e5r ner. Den virtuella IPn m\u00e5ste vara i samma subn\u00e4t som interface-IPn. Endast en router \u00e4r aktiv i taget medans standby-routern lyssnar efter Hellos som default skickas var 3:e sekund fr\u00e5n den aktiva. Uteblir dessa tar standby-enheten \u00f6ver och blir aktiv. Den router med h\u00f6gst prioritet blir aktiv, 100 \u00e4r default f\u00f6r IOS, och vid lika avg\u00f6r h\u00f6gsta interface IP-adress. Preempt \u00e4r inte p\u00e5slaget default. Autentisering g\u00e5r att g\u00f6ra med clear-text eller MD5.</p> <p>HSRP g\u00e5r att anv\u00e4nda tillsammans med NAT. Se \u00e4ven FHRP.</p>"},{"location":"cisco/Cisco_HSRP/#version","title":"Version","text":"<p>HSRP finns i tv\u00e5 versioner som anv\u00e4nder olika paketformat. Version 2 anv\u00e4nder TLVer och \u00e4r inte kompatibel med version 1. I version 1 (som \u00e4r default) kan man ha standby-grupp 0-255 medans i v2 \u00e4r detta ut\u00f6kat till 0-4095. Version 2 skickar med en 6-byte identifier field som inneh\u00e5ller MAC-adressen p\u00e5 avs\u00e4ndaren s\u00e5 man vet vem som \u00e4r originator. Det skickas \u00e4ven med timer values i millisekundformat s\u00e5 andra sidan kan synka med. HSRP version 2 har st\u00f6d f\u00f6r IPv6.</p> HSRP version Protocol Group address UDP Port Virtual MAC address range 1 IPv4 224.0.0.2 (all routers) 1985 00:00:0c:07:ac:XX 2 IPv4 224.0.0.102 (HSRP) 1985 00:00:0c:9f:fX:XX IPv6 ff02::66 2029 00:05:73:a0:0X:XX"},{"location":"cisco/Cisco_HSRP/#states","title":"States","text":"<ul> <li>Initial: HSRP k\u00f6rs inte.</li> <li>Learn: Routern k\u00e4nner inte till VIP utan v\u00e4ntar p\u00e5 att den aktiva     enheten ska prata.</li> <li>Listen: Routern k\u00e4nner till VIP men \u00e4r varken active eller standby.</li> <li>Speak: Routern skickar HSRP hellos och \u00e4r med i valet f\u00f6r active.</li> <li>Standby: Routern h\u00e5ller koll p\u00e5 hellos fr\u00e5n active och \u00e4r beredd att     ta \u00f6ver.</li> <li>Active: Routern forwarderar paket som virtuell router.</li> </ul>"},{"location":"cisco/Cisco_HSRP/#packets","title":"Packets","text":"<p>Version 1</p>   -   Advertise:    [\u200e](/File:Cisco_HSRP_Advertise.png\u200e \"wikilink\")     -   Hello Speak:    [\u200e](/File:Cisco_HSRP_Speak.png\u200e \"wikilink\")     -   Hello Standby:    [\u200e](/File:Cisco_HSRP_Standby.png\u200e \"wikilink\")     -   Hello Active:    [\u200e](/File:Cisco_HSRP_Active.png\u200e \"wikilink\")   <p>Version 2</p>   -   Advertise:    [\u200e](/File:Cisco_HSRP_v2_Advertise.png\u200e \"wikilink\")     -   Hello Speak:    [\u200e](/File:Cisco_HSRP_v2_Speak.png\u200e \"wikilink\")     -   Hello Standby:    [\u200e](/File:Cisco_HSRP_v2_Standby.png\u200e \"wikilink\")     -   Hello Active:    [\u200e](/File:Cisco_HSRP_v2_Active.png\u200e \"wikilink\")     F\u00f6r att ta \u00f6ver active-rollen skickas ett Coup message, detta anv\u00e4nds vid preemption.    [\u200e](/File:Cisco_HSRP_v2_Coup.png\u200e \"wikilink\")     N\u00e4r ett interface shutas p\u00e5 active device skickas det ut ett Resign message s\u00e5 att standby kan bli active direkt.    [\u200e](/File:Cisco_HSRP_v2_Resign.png\u200e \"wikilink\")"},{"location":"cisco/Cisco_HSRP/#konfiguration","title":"Konfiguration","text":"<p><code>interface\u00a0[interface]</code> <code>standby\u00a0version\u00a02</code> <code>standby\u00a01\u00a0ip\u00a0[virtual\u00a0ip]</code> <code>standby\u00a01\u00a0priority\u00a0&lt;0-255&gt;</code> <code>standby\u00a01\u00a0preempt</code> <code>standby\u00a01\u00a0timers\u00a0[hold]\u00a0[dead]</code></p> <p>Verify</p> <p><code>show\u00a0standby\u00a0brief</code> <code>show\u00a0standby</code></p> <p>Initialisation delay. Man kan konfigurera en delay f\u00f6r n\u00e4r HSRP ska aktiveras efter omboot och interface link up.</p> <p><code>standby\u00a0delay\u00a0minimum\u00a030</code> <code>standby\u00a0delay\u00a0reload\u00a060</code></p> <p><code>show\u00a0standby\u00a0delay</code></p> <p>Anv\u00e4nd burned in MAC address</p> <p><code>standby\u00a0use-bia</code></p> <p>Configure sending of ICMP Redirect messages with an HSRP virtual IP address as the gateway IP address</p> <p><code>standby\u00a0redirects\u00a0enable</code></p> <p><code>show\u00a0standby\u00a0redirect</code></p> <p>Man kan sl\u00e5 p\u00e5 att HSRP ska skicka en gratuitous ARP fr\u00e5n aktiva grupper. Default skickas det en n\u00e4r en grupp blir aktiv, en 2 sekunder senare och sedan en ytterligare 2 sekunder senare.</p> <p><code>standby\u00a0arp\u00a0gratuitous</code></p>"},{"location":"cisco/Cisco_HSRP/#autentisering","title":"Autentisering","text":"<p>HSRP m\u00e5ste ha en authentication-str\u00e4ng som skickas i paketen och default s\u00e5 ligger \"cisco\" (standby X authentication cisco), dvs cisco i klartext anv\u00e4nds men det syns inte i konfigen.</p> <p>Plain text</p> <p><code>standby\u00a01\u00a0authentication\u00a0text\u00a0SECRET</code></p> <p>MD5</p> <p><code>standby\u00a01\u00a0authentication\u00a0md5\u00a0key-string\u00a0SECRET</code> <code>standby\u00a01\u00a0authentication\u00a0md5\u00a0key-chain\u00a0HSRP-CHAIN</code></p>"},{"location":"cisco/Cisco_HSRP/#tracking","title":"Tracking","text":"<p>HSRP kan h\u00e5lla koll p\u00e5 interface f\u00f6r att veta vilken enhet som b\u00f6r vara aktiv. Man kan automatiskt s\u00e4nka HSRP priority n\u00e4r line protocol p\u00e5 utvalt interface blir down, default decrement \u00e4r 10.</p> <p><code>standby\u00a01\u00a0track\u00a0Gi0/0\u00a030</code> <code>show\u00a0standby\u00a0|\u00a0i\u00a0Track</code></p> <p>IP SLA Allt som g\u00e5r att tracka med IP SLA kan HSRP anv\u00e4nda sig av. Man kan \u00e4ven ha flera objekt som man trackar och med decrement valus styra att flera saker m\u00e5ste vara nere f\u00f6r att aktiv enhet ska bytas.</p> <p><code>track\u00a0100\u00a0interface\u00a0gi0/1\u00a0line-protocol</code> <code>standby\u00a01\u00a0track\u00a0100\u00a0decrement\u00a030</code></p>"},{"location":"cisco/Cisco_HSRP/#secondary-vip","title":"Secondary VIP","text":"<p>Man kan ha secondary virtual IP address med HSRP. Denna VIP eller info om den skickas inte i n\u00e5got HSRP-paket, dvs det h\u00e5lls ingen egen state f\u00f6r det utan det f\u00f6ljer helt enkelt rollen som HSRP-gruppen har.</p> <p><code>interface\u00a0gi2</code> <code>standby\u00a01\u00a0ip\u00a010.0.0.1\u00a0secondary</code></p>"},{"location":"cisco/Cisco_HSRP/#bfd","title":"BFD","text":"<p>HSRP BFD</p> <p>Global</p> <p><code>standby\u00a0bfd\u00a0all-interfaces</code></p> <p>Per interface</p> <p><code>interface\u00a0gi2</code> <code>standby\u00a0bfd</code></p>"},{"location":"cisco/Cisco_HSRP/#mhsrp","title":"MHSRP","text":"<p>Multiple HSRP. Man kan ha flera HSRP-grupper p\u00e5 samma interface vilket m\u00f6jligg\u00f6r en variant av lastdelning. F\u00f6r att MHSRP ska kunna lastdela kan inte alla hostar i subn\u00e4tet ha samma default gateway utan n\u00e5gra m\u00e5ste anv\u00e4nda den ena virtuella IPn och n\u00e5gra mot en f\u00f6r en annan HSRP-grupp, dock fortfarande i samma subn\u00e4t. P\u00e5 Nexus-plattformen g\u00e5r det att l\u00f6sa s\u00e5 att alla enheter \u00e4r aktiva f\u00f6r samma VIP, se Anycast HSRP.</p>"},{"location":"cisco/Cisco_HSRP/#nx-os","title":"NX-OS","text":"<p>Switch 1</p> <p><code>feature\u00a0hsrp</code></p> <p><code>interface\u00a0e1/1</code> <code>ip\u00a010.0.0.2/24</code> <code>hsrp\u00a0bfd</code> <code>hsrp\u00a0version\u00a02</code> <code>hsrp\u00a01</code> <code>ip\u00a010.0.0.1</code> <code>follow\u00a0master1</code></p> <p>Switch 2</p> <p><code>feature\u00a0hsrp</code></p> <p><code>interface\u00a0e1/1</code> <code>ip\u00a010.0.0.3/24</code> <code>hsrp\u00a0bfd</code> <code>hsrp\u00a0version\u00a02</code> <code>hsrp\u00a01</code> <code>ip\u00a010.0.0.1</code> <code>priority\u00a0110</code> <code>name\u00a0master1</code></p> <p>Det \u00e4r rekommenderat att k\u00f6ra BFD ist\u00e4llet f\u00f6r att \u00e4ndra HSRP-timers.</p> <p>F\u00f6r att st\u00f6dja HSRP under ISSU (In-Service Software Upgrades) s\u00e5 kan man aktivera f\u00f6rl\u00e4ngda kontrollmeddelanden f\u00f6r HSRP.</p> <p><code>hsrp\u00a0timers\u00a0extended-hold</code></p> <p>Man kan l\u00e5ta HSRP l\u00e4ra sig VIP av andra HSRP-noder.</p> <p><code>interface\u00a0vlan\u00a010</code> <code>hsrp\u00a010</code> <code>ip</code></p> <p>Med IPv6 kan man auto-konfigurera VIP, d\u00e5 g\u00f6rs EUI-64 p\u00e5 HSRP-gruppens MAC-adress.</p> <p><code>interface\u00a0vlan\u00a010</code> <code>hsrp\u00a010\u00a0ipv6</code> <code>ip\u00a0autoconfig</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_IGMP/","title":"Cisco IGMP","text":"<p>Internet Group Management Protocol anv\u00e4nds mellan end systems och routrar f\u00f6r att ta reda p\u00e5 om segmentet ska ha multicast-trafik och is\u00e5fall vilken. En router h\u00e5ller inte reda p\u00e5 vilka hostar som \u00e4r med i vilka grupper utan endast om gruppen \u00e4r aktiv eller ej. Hostar anv\u00e4nder det f\u00f6r att joina och l\u00e4mna multicastgrupper. Switchar kan lyssna p\u00e5 det f\u00f6r att ta reda p\u00e5 vilka switchportar som ska ha vilken trafik. IGMP sl\u00e5s p\u00e5 n\u00e4r man konfar multicast routing och PIM p\u00e5 routrar.</p> <p>Se \u00e4ven Cisco Multicast.</p>"},{"location":"cisco/Cisco_IGMP/#versioner","title":"Versioner","text":"<p>IGMP h\u00e4rstammar fr\u00e5n Host Membership Protocol och finns i flera versioner, IGMPv1 (RFC 1112) \u00e4r dock f\u00f6rlegat men det finns bak\u00e5tkompatibilitet. N\u00e4r en IGMPv2-router f\u00e5r in en IGMPv1 Query slutar den skicka v2-queries och en Version 1 Router Present Timeout startas som resettas varje g\u00e5ng det kommer in en v1-query. Efter 400 sekunder g\u00e5r den ut och routern \u00e5terg\u00e5r till IGMPv2. Routrar avg\u00f6r om det \u00e4r en IGMPv1-Query som kommer in genom att kolla om Maximum Response Time \u00e4r satt.</p> <ul> <li>IGMPv2 (RFC 2236) \u00e4r bak\u00e5tkompatibel med IGMPv1 och \u00e4r     defaultversion p\u00e5 Cisco IOS. Version 2 har en f\u00f6rb\u00e4ttrad     Leave-mekanism och nu finns det \u00e4ven m\u00f6jlighet att fr\u00e5ga efter     specifika grupper ist\u00e4llet f\u00f6r alla.</li> </ul> <ul> <li>IGMPv3 (RFC 3376) \u00e4r en nyare revision av IGMP som har en egen     multicastadress, 224.0.0.22. Den stora nyheten \u00e4r att end systems     kan ber\u00e4tta f\u00f6r routrar vilken source de vill ha multicasttrafik     fr\u00e5n, Source-Specifik Multicast. Det \u00e4r bak\u00e5tkompatilbelt med IGMPv1     och v2.</li> </ul> <p><code>show\u00a0ip\u00a0igmp\u00a0interface</code></p>"},{"location":"cisco/Cisco_IGMP/#packets","title":"Packets","text":"<p>IGMP-paket skickas med IP och har TTL satt till 1.</p> <ul> <li>Host Membership Query: \u00e4r en generell Query som skickas default     var 60:e sekund till 224.0.0.1 p\u00e5 LAN interface f\u00f6r att kolla om     n\u00e5gon \u00e4r intresserad av multicast. Default har hostar 10 sekunder p\u00e5     sig att besvara detta.</li> </ul> <ul> <li>Host Membership Report: skickas antingen som svar p\u00e5 en Query     och inneh\u00e5ller d\u00e5 alla grupper som hosten \u00e4r med i eller n\u00e4r en host     vill joina en ny grupp.</li> </ul> <ul> <li>Leave group message: skickas till 224.0.0.2 och anv\u00e4nds av     hostar f\u00f6r att meddela routrar att de l\u00e4mnar en grupp.</li> </ul> <ul> <li>Group-Specific Query: n\u00e4r en router f\u00e5r in ett Leave message     skickar den ut en gruppspecifik Query (destinationsadress \u00e4r den     multicastgruppen) f\u00f6r att se om det fortfarande finns n\u00e5gon p\u00e5     segmentet som \u00e4r intresserad. Detta inneh\u00e5ller Last Member Query     Interval som default s\u00e4ger att members har 1 sekund p\u00e5 sig att     svara, det skickas tv\u00e5 av dessa n\u00e4r ett Leave kommer in. Om det var     den sista hosten som skickade Leave message reducerar detta tiden     det tar innan on\u00f6dig multicasttrafik slutar skickas fr\u00e5n flera     minuter till ca 3 sekunder.</li> </ul> <p>IGMP Querier Election Finns det flera multicast-routrar p\u00e5 ett segment kommer endast en vara aktiv och skicka General Queries. N\u00e4r en router f\u00e5r in en General Query j\u00e4mf\u00f6rs source-adressen mot det egna interfacets adress och den med l\u00e4gst vinner och blir vald IGMP Querier. En nonquerier \u00e4r inte aktiv sj\u00e4lv men lyssnar efter Queries och n\u00e4r det slutar komma in kan den ta \u00f6ver. Tiden det tar innan en vald Querier anses d\u00f6d \u00e4r 2 g\u00e5nger Query Interval plus en halv Query Response Interval, default \u00e4r detta 255 sekunder.</p> <p><code>show\u00a0ip\u00a0igmp\u00a0interface\u00a0|\u00a0i\u00a0querying</code></p> <p>Med IGMPv1 finns det inget inbyggt s\u00e4tt f\u00f6r hostarna att avg\u00f6ra vem som ska st\u00e5 f\u00f6r Queries. D\u00e4rf\u00f6r v\u00e4ljer routrarna en som blir DR och den kommer att skicka IGMP Queries, routern med h\u00f6gst IP vinner.</p> <p><code>show\u00a0ip\u00a0igmp\u00a0interface\u00a0|\u00a0i\u00a0DR</code></p>"},{"location":"cisco/Cisco_IGMP/#timers","title":"Timers","text":"<p>Man kan konfigurera hur ofta queries ska skickas ut. Varje membership query message inneh\u00e5ller ett timer-v\u00e4rde (8 bit field) som anger hur l\u00e5ng tid hostarna har p\u00e5 sig att besvara meddelandet, det r\u00e4cker att en host svarar p\u00e5 det s\u00e5 kommer inte multicast-str\u00f6mmen att upph\u00f6ra.</p> <p><code>interface\u00a0gi2</code> <code>ip\u00a0igmp\u00a0query-max-response-time\u00a010</code> <code>ip\u00a0igmp\u00a0query-interval\u00a060</code></p> <p>Querier</p> <p><code>ip\u00a0igmp\u00a0querier-timeout\u00a0120</code></p> <p>Verify</p> <p><code>show\u00a0ip\u00a0igmp\u00a0interface\u00a0|\u00a0i\u00a0IGMP</code></p> <p>Last Member</p> <p><code>interface\u00a0gi2</code> <code>ip\u00a0igmp\u00a0last-member-query-count\u00a02</code> <code>ip\u00a0igmp\u00a0last-member-query-interval\u00a01000</code></p> <p>Man kan \u00e4ven ange att str\u00f6mmen ska upph\u00f6ra direkt om det kommer in ett Leave group message.</p> <p><code>ip\u00a0igmp\u00a0immediate-leave\u00a0group-list\u00a0IMMEDIATE_LEAVE</code></p>"},{"location":"cisco/Cisco_IGMP/#filtering","title":"Filtering","text":"<p>IGMP filtering till\u00e5ter att man konfigurerar filter f\u00f6r IGMP-trafik p\u00e5 SVI, per-port eller per-VLAN per-port. Det \u00e4r ett komplement till IGMP Snooping, som \u00e4r ett prereq f\u00f6r filtering. Med IGMPv1-2 discardas hela paketen ifall filtret tr\u00e4ffas medans i IGMPv3 kan man filtrera och skriva om f\u00e4lt i paketen. Man kan styra minimum IGMP-version och p\u00e5 en trunk kan man filtrera per VLAN.</p> <p>ACL Group and channel access control &amp; limit (per interface)</p> <p><code>access-list\u00a012\u00a0permit\u00a0224.10.10.0\u00a00.0.0.255</code> <code>interface\u00a0Gi0/0</code> <code>ip\u00a0igmp\u00a0access-group\u00a012</code> <code>ip\u00a0igmp\u00a0limit\u00a010</code></p> <p>Profile, only allow the specific multicast range</p> <p><code>ip\u00a0igmp\u00a0profile\u00a01</code> <code>permit</code> <code>range\u00a0224.0.O.O\u00a0224.255.255.255</code> <code>int\u00a0Gi0/0</code> <code>ip\u00a0igmp\u00a0filter\u00a01</code></p> <p>IGMP minimum version (global)</p> <p><code>ip\u00a0igmp\u00a0snooping\u00a0minimum-version\u00a02</code></p> <p>Verify</p> <p><code>show\u00a0ip\u00a0igmp\u00a0snooping\u00a0filter</code> <code>show\u00a0ip\u00a0igmp\u00a0profile</code></p>"},{"location":"cisco/Cisco_IGMP/#igmp-snooping","title":"IGMP Snooping","text":"<p>Switchar kan anv\u00e4nda IGMP snooping f\u00f6r att avlyssna IGMP-meddelanden och ta reda p\u00e5 vilka switchportar som ska ha vilka mac-adresser, dvs \u00e4r med i vilken multicastgrupp. Om inte IGMP snooping \u00e4r p\u00e5 floodas multicast-frames av switchar precis som broadcast och unknown unicast eftersom en multicast-MAC-adress aldrig finns i CAM d\u00e5 de aldrig anv\u00e4nds som source utan endast destination. P\u00e5 de flesta L3-switchar \u00e4r IGMP Snooping p\u00e5slaget default. Switchar beh\u00f6ver veta om det finns flera multicast-routrar p\u00e5 segmentet och p\u00e5 vilka portar de sitter d\u00e4rf\u00f6r lyssnas det efter ett flertal paket-typer: IGMP General Query (01:00:5e:00:00:01), OSPF (01:00:5e:00:00:05/6), PIMv1 och HSRP (01:00:5e:00:00:02), PIMv2 Hellos (01:00:5e:00:00:0d) och DVMRP probes (01:00:5e:00:00:04). IGMP snooping kontrollerar endast distribution av multicast-trafik till hostar medans routrar f\u00e5r frames f\u00f6r alla grupper.</p> <p>N\u00e4r det kommer in en IGMP Report p\u00e5 en port tas Group Destination Address och l\u00e4ggs som forwarding p\u00e5 porten samt router-porten i CAM-tabellen, p\u00e5 s\u00e5 s\u00e4tt har man fungerande multicast-forwarding. Kommer det in en annan IGMP Report med samma GDA l\u00e4ggs \u00e4ven den porten med som forwarding. Kommer det ett Leave-meddelande tas porten bort fr\u00e5n forwarding och det kollas om det var den sista nonrouter-porten som var forwarding. Om det var den sista porten skickas Leave vidare till routern annars discardas det eftersom det \u00e4r ointressant att skicka vidare. Eftersom switchar interceptar IGMP Reports f\u00e5r inte hostar varandras Reports utan alla m\u00e5ste skicka det, detta p\u00e5verkar Report Suppression.</p> <p>Global</p> <p><code>ip\u00a0igmp\u00a0snooping</code> <code>no\u00a0ip\u00a0igmp\u00a0snooping\u00a0vlan\u00a010</code></p> <p>Immediately remove a VLAN from multicast forwarding when an IGMP leave is received.</p> <p><code>ip\u00a0igmp\u00a0snooping\u00a0vlan\u00a011\u00a0immediate-leave</code></p> <p>Verify</p> <p><code>show\u00a0ip\u00a0igmp\u00a0snooping</code> <code>show\u00a0ip\u00a0igmp\u00a0snooping\u00a0groups</code> <code>show\u00a0ip\u00a0igmp\u00a0snooping\u00a0mrouter</code></p> <p>L2 only environment Om en switch inte har n\u00e5gon mrouter port, t.ex. om det \u00e4r en L2 only environment, kommer inte multicast-trafik att forwarderas vilket kan leda till blackholing. En mrouter port kan vara statically assigned eller dynamically learned. N\u00e4r det finns en mrouter port kommer IGMP reports att skickas p\u00e5 den. Man kan \u00e4ven \u00e4ndra detta beteende s\u00e5 att en switch agerar proxy och sj\u00e4lv skickar ut membership queries f\u00f6r att komma runt detta problem s\u00e5 att det forwarderas multicast-trafik.</p> <p><code>ip\u00a0igmp\u00a0snooping\u00a0querier</code> <code>show\u00a0ip\u00a0igmp\u00a0snooping\u00a0mrouter</code></p>"},{"location":"cisco/Cisco_IGMP/#cgmp","title":"CGMP","text":"<p>Cisco Group Management Protocol \u00e4r ett protokoll som anv\u00e4nds av L3-enheter f\u00f6r att ber\u00e4tta f\u00f6r Cisco-switchar vilka hostar som ska ha multicast-trafik (OBS CGMP \u00e4r gammalt och har spelat ut sin roll, IGMP Snooping \u00e4r att f\u00f6redra). Routrar l\u00e4r sig vilka mac-adresser som \u00e4r med i vilka multicast-grupper genom IGMP s\u00e5 de kan skicka ut CGMP-meddelanden som switchar lyssnar p\u00e5. D\u00e5 kan de st\u00e4lla sina CAM-tabeller utifr\u00e5n den informationen och inga hostar som inte ska ha multicast-trafik f\u00e5r det. CGMP skickas till 01:00:0c:dd:dd:dd s\u00e5 alla switchar f\u00e5r meddelandena. N\u00e4r en router kopplas till en switch skickar den ett CGMP-Join med Group Destination Address satt till 0 och Unicast Source Address satt till sig sj\u00e4lv, d\u00e5 vet switchen var det finns en multicast-router. Detta skickas ut var 60:e sekund s\u00e5l\u00e4nge routern vill annars skickas ett CGMP-Leave med samma GDA och USA. Det som \u00e4r skillnad mot vanlig IGMP \u00e4r att \u00e4ven L2-informationen kollas p\u00e5 n\u00e4r en router f\u00e5r in ett IGMP Join och CGMP \u00e4r konfigurerat. Denna mac-adress och multicast-grupp kan nu annonseras ut med CGMP-Join. N\u00e4r en switch f\u00e5r in ett CGMP-Join kollar den sin CAM-tabell efter USA och kan d\u00e5 l\u00e4gga in multicast-mac-adressen (GDA) p\u00e5 samma interface, d\u00e5 blir den porten forwarding \u00e4ven f\u00f6r multicasttrafiken som den hosten har skickat IGMP Join f\u00f6r. Vill en host inte vara med i en viss grupp l\u00e4ngre skickar den IGMP Leave och routern anv\u00e4nder \u00e4ven h\u00e4r L2-informationen och det skickas ut ett CGMP Leave och switcharna kan ta bort GDA fr\u00e5n porten d\u00e4r hosten sitter. Alla enheter som ska anv\u00e4nda CGMP m\u00e5ste konfigureras f\u00f6r det, detta funkar ej om RGMP anv\u00e4nds.</p> <p>L3-enhet</p> <p><code>interface\u00a0gi2</code> <code>ip\u00a0cgmp</code></p> <p>Clear, skicka ut ett CGMP Leave med USA = 0 och GDA = 0 d\u00e5 kommer alla switchar att rensa alla CAM-entries som de satt tack vare CGMP.</p> <p><code>clear\u00a0ip\u00a0cgmp</code></p> <p>RGMP Router-Port Group Management Protocol (RFC 3488) \u00e4r ett annat Cisco-protokoll som routrar kan anv\u00e4nda f\u00f6r att kommunicera till switchar vilken multicast-trafik de vill ha. Genom att begr\u00e4nsa o\u00f6nskad multicast-trafiken som routrar f\u00e5r in minskar man overhead. Alla RGMP-paket g\u00e5r till 01-00-5e-00-00-19, 224.0.0.25. Konfigurerar man RGMP disableas CGMP och vice versa.</p> <ul> <li>Hello: skickas var 30: sekund. N\u00e4r en switch f\u00e5r in ett RGMP     Hello p\u00e5 en port slutar all multicast-forwardering p\u00e5 den porten.</li> <li>Join: f\u00f6r att en router ska f\u00e5 multicast-trafik av en switch     m\u00e5ste den skicka RGMP Join f\u00f6r de grupper den vill ha.</li> <li>Leave: n\u00e4r en router inte l\u00e4ngre vill ha trafik f\u00f6r en viss     grupp skickar den ett RGMP Leave.</li> <li>Bye: n\u00e4r man sl\u00e5r av RGMP skickas ett RGMP Bye och switchen     \u00e5terg\u00e5r till att forwardera all multicast-trafik.</li> </ul> <p><code>interface\u00a0gi2</code> <code>ip\u00a0rgmp</code></p>"},{"location":"cisco/Cisco_IGMP/#igmp-proxy","title":"IGMP Proxy","text":"<p>IGMP proxy l\u00e5ter hostar i unidirectional link routing (UDLR) milj\u00f6er som inte har n\u00e5gon direktkoppling till n\u00e5gon downstream router att joina multicast-grupper.</p> <p><code>interface\u00a0gi2</code> <code>ip\u00a0igmp\u00a0unidirectional-link</code> <code>interface\u00a0gi3</code> <code>ip\u00a0igmp\u00a0mroute-proxy\u00a0lo2</code> <code>interface\u00a0lo2</code> <code>ip\u00a0igmp\u00a0helper-address\u00a0udl\u00a0gi2</code> <code>ip\u00a0igmp\u00a0proxy-service</code></p> <p>Verify</p> <p><code>show\u00a0ip\u00a0igmp\u00a0udlr</code></p>"},{"location":"cisco/Cisco_IGMP/#mvr","title":"MVR","text":"<p>Multicast VLAN Registration finns till f\u00f6r att effektivisera trafiken p\u00e5 switchens uppl\u00e4nkar om det finns m\u00e5nga multicast-mottagare f\u00f6r samma grupper i olika VLAN. MVR anv\u00e4nder ett dedikerat VLAN genom alla switchar som anv\u00e4nds f\u00f6r att leverera multicast feeden till alla receivers. Man m\u00e5ste ange detta, dvs i vilket VLAN k\u00e4llan f\u00f6r trafiken befinner sig. MVR g\u00e5r ej att k\u00f6ra samtidigt som multicast routing \u00e4r p\u00e5slaget.</p> <p><code>no\u00a0ip\u00a0multicast-routing</code> <code>mvr</code> <code>mvr\u00a0vlan\u00a0200</code> <code>mvr\u00a0group\u00a0239.1.1.10</code> <code>mvr\u00a0mode\u00a0dynamic\u00a0\u00a0#skapa\u00a0mroute\u00a0states\u00a0dynamiskt</code></p> <p><code>interface\u00a0gi1</code> <code>description\u00a0Uplink</code> <code>mvr\u00a0type\u00a0source</code></p> <p><code>interface\u00a0gi2</code> <code>mvr\u00a0type\u00a0receiver</code></p> <p>Verify</p> <p><code>show\u00a0mvr</code> <code>show\u00a0mvr\u00a0interface</code> <code>show\u00a0mvr\u00a0members</code></p>"},{"location":"cisco/Cisco_IGMP/#mld","title":"MLD","text":"<p>Med IPv6 \u00e4r multicast en central del eftersom broadcast inte finns och nu heter det Multicast Listener Discovery ist\u00e4llet f\u00f6r IGMP. Det \u00e4r inte ett eget protokoll utan en del av ICMPv6. MLD sl\u00e5ss p\u00e5 default n\u00e4r man sl\u00e5r p\u00e5 ipv6 multicast-routing p\u00e5 en router. Alla paket anv\u00e4nder link-local adresser med TTL 1 och har Router Alert option satt. MLDv1 motsvarar IGMPv2 och MLDv2 motsvarar IGMPv3 f\u00f6r Source-Specific Multicast, RFC 4604.</p> <ul> <li>Query: samma som IGMP. 0 \u00e4r f\u00f6r generella queries annars     specifik gruppadress. Skickas till FF02::1.</li> <li>Report: samma som IGMP och inneh\u00e5ller en specifik gruppadress.</li> <li>Done: motsvarar Leave message och inneh\u00e5ller en specifik     gruppadress. Skickas till FF02::2.</li> </ul> <p>G\u00e5 med i grupp manuellt</p> <p><code>ipv6\u00a0mld\u00a0join-group\u00a0FF08::10</code></p> <p>G\u00e5 med i SSM-grupp</p> <p><code>ipv6\u00a0mld\u00a0join-group\u00a0FF36::8\u00a02001::25</code></p> <p>Verify</p> <p><code>show\u00a0ipv6\u00a0mld\u00a0interface</code> <code>show\u00a0ipv6\u00a0mld\u00a0snooping\u00a0querier</code></p> <p>Defaults per interface</p> <p><code>ipv6\u00a0mld\u00a0query-max-response-time\u00a010</code> <code>ipv6\u00a0mld\u00a0query-timeout\u00a0255</code> <code>ipv6\u00a0mld\u00a0query-interval\u00a0125</code></p> <p>Membership limit on interface</p> <p><code>ipv6\u00a0mld\u00a0limit\u00a0100</code></p>"},{"location":"cisco/Cisco_IGMP/#nx-os","title":"NX-OS","text":"<p>H\u00e4r f\u00f6ljer Nexus-specifik information. En skillnad mot IOS \u00e4r att det saknas st\u00f6d f\u00f6r IGMP version 1 och Version 3 Lite. IGMP Snooping \u00e4r p\u00e5 default och g\u00f6r IP lookups default. En annan skillnad \u00e4r att IGMP snooping querier inte konfas p\u00e5 L3 interface utan under VLAN:et. Se \u00e4ven PIM f\u00f6r NX-OS.</p> <p><code>interface\u00a0Ethernet1/1</code> <code>ip\u00a0address\u00a0192.168.10.1/24</code> <code>ip\u00a0pim\u00a0sparse-mode</code> <code>ip\u00a0igmp\u00a0version\u00a03</code></p> <p><code>vlan\u00a0configuration\u00a010</code> <code>ip\u00a0igmp\u00a0snooping\u00a0querier\u00a0192.168.1.1</code></p> <p>Verify</p> <p><code>show\u00a0ip\u00a0igmp\u00a0snooping</code> <code>show\u00a0ip\u00a0igmp\u00a0snooping\u00a0querier</code> <code>show\u00a0ip\u00a0igmp\u00a0route</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_IOS-XR/","title":"Cisco IOS-XR","text":"<p>IOS XR \u00e4r Ciscos OS framtaget f\u00f6r de st\u00f6rre enheterna (fr\u00e4mst mot service provider) tex CRS serien, 12000 serien och ASR9000 serien.</p> <p>XR bygger p\u00e5 en micro-kernel arkitektur och \u00e4r framtaget f\u00f6r att att ut\u00f6ka tillg\u00e4ngligheten p\u00e5 enheter t.ex. genom att ha redundant h\u00e5rdvara (linjekort, cpu), felhantering som t.ex. skyddat minnesutrymme och med m\u00f6jlighet att starta om specifika processer (kan ske per automatik). XR anv\u00e4nder liknande modell som tex. Cisco Nexus d\u00e4r med distribuerad modell d\u00e4r man kan aktivera de delar man \u00f6nskar tex. multicast eller MPLS.</p> <p>IOS XR \u00e4r likt Juniper's JunOS uppdelat i tv\u00e5 l\u00e4gen, admin-l\u00e4ge och \"operations\"-l\u00e4ge och XR har ett inbyggt system f\u00f6r hantera anv\u00e4ndare och grupper. \u00c4ven i XR beh\u00f6ver man anv\u00e4nda commit precis som i JunOS.</p> <p>Security IOS-XR har ICMP redirects disabled by default samt att directed-broadcast packets droppas. Cisco har mycket dokumentation kring security, Service Provider Security</p>"},{"location":"cisco/Cisco_IOS-XR/#konfigurationshantering","title":"Konfigurationshantering","text":"<p>Till skillnad fr\u00e5n IOS s\u00e5 \u00e4ndras inget innan man k\u00f6r commit. Kommandon kopplat till konfigurationshantering.</p> <p>Visa \u00e4ndringar som kommer att installeras vid commit:</p> <p><code>show\u00a0configuration</code> <code>alias\u00a0config\u00a0diff\u00a0show\u00a0commit\u00a0changes\u00a0diff</code></p> <p>Visa hur hela konfiguration kommer se ut efter commit:</p> <p><code>show\u00a0configuration\u00a0merge</code></p> <p>G\u00f6ra commit med en m\u00e4rkning av konfigurationen:</p> <p><code>commit\u00a0label\u00a0add-loopback1337</code></p> <p>Visa misslyckad commit tex. om n\u00e5got i konfiguration saknas eller \u00e4r inkompatiblet (detta meddelas vid en vanlig commit)</p> <p><code>show\u00a0configuration\u00a0failed</code></p> <p>Lista historiska f\u00f6r\u00e4ndringar:</p> <p><code>show\u00a0configuration\u00a0history</code></p> <p>Backa konfiguration till specifik konfiguration:</p> <p><code>rollback\u00a0configuration\u00a0to\u00a0add-loopback1337</code></p> <p>Backa konfiguration till senaste konfiguration:</p> <p><code>rollback\u00a0configuration\u00a0last\u00a01</code></p> <p>\u00c4r man inte helt s\u00e4ker p\u00e5 sin commit kan man k\u00f6ra commit confirmed, d\u00e5 m\u00e5ste man aktivt skriva commit confirm annars g\u00f6rs automatiskt en rollback.</p> <p><code>commit\u00a0confirmed</code> <code>commit\u00a0confirm</code></p> <p>Export configuration on commit.</p> <p><code>configuration\u00a0commit\u00a0auto-save\u00a0filename</code><code>tftp://10.0.0.11/router1</code></p> <p>Man kan anv\u00e4nda regex-baserad replace av konfiguration, t.ex. om man ska d\u00f6pa om en policy eller acl.</p> <p><code>replace\u00a0pattern\u00a0'POLICYMAP-WRONG_NAME'\u00a0with\u00a0'POLICYMAP-RIGHT_NAME'</code></p> <p>Run silently without the user being prompted for yes/no.</p> <p><code>service\u00a0cli\u00a0interactive\u00a0disable</code> <code>copy\u00a0running-config\u00a0disk0:test_config.txt</code></p> <p>Default listas interface i bokstavsordning, detta g\u00e5r att \u00e4ndra.</p> <p><code>configuration\u00a0display\u00a0interface\u00a0slot-order</code></p> <p>To prevent the re-application of the commands which are already present in the running configuration.</p> <p><code>service\u00a0cli\u00a0commit-optimized\u00a0enable</code></p> <p>Konfigurationsl\u00e5s Vid konfigurering kan konfigurationsl\u00e4get g\u00f6ras exklusivt:</p> <p><code>configure\u00a0exclusive</code></p> <p>Visa l\u00e5st konfiguration:</p> <p><code>show\u00a0configuration\u00a0lock</code></p> <p>Visa vem som l\u00e5st konfigurationen:</p> <p><code>show\u00a0configuration\u00a0sessions</code></p>"},{"location":"cisco/Cisco_IOS-XR/#admin","title":"Admin","text":"<p>G\u00e5 till admin l\u00e4ge, h\u00e4r kan man styra anv\u00e4ndares beh\u00f6righeter, \u00e4ndra config-register, installera funktioner etc. Kommandon f\u00f6r admin-l\u00e4get kan alltid k\u00f6ras genom tex \"admin show running-config\"</p> <p><code>admin</code></p> <p>Visa konfiguration (enbat f\u00f6r Admin l\u00e4ge)</p> <p><code>(admin)#show\u00a0running-config</code></p> <p>Skapa anv\u00e4ndare</p> <p><code>admin</code> <code>conf\u00a0t</code> <code>username\u00a0juan</code> <code>group\u00a0root-system</code> <code>secret\u00a0cisco</code></p>"},{"location":"cisco/Cisco_IOS-XR/#fordefinierade-grupper","title":"F\u00f6rdefinierade grupper","text":"<ul> <li>root-system: Fullst\u00e4ndig access</li> </ul> <ul> <li>netadmin: M\u00f6jligg\u00f6r konfiguration av tex OSPF eller EIGRP</li> </ul> <ul> <li>sysadmin: M\u00f6jligg\u00f6r system\u00e4ndringar tex dump av konfig eller tex.     konfiguration av NTP</li> </ul> <ul> <li>operator: Kan titta i konfigurationen men je g\u00f6ra f\u00f6r\u00e4ndringar</li> </ul> <ul> <li>cisco-support: F\u00f6r Cisco TAC support</li> </ul>"},{"location":"cisco/Cisco_IOS-XR/#egna-grupper","title":"Egna grupper","text":"<p>I XR kan man skapa egna grupper f\u00f6r specifika \u00e4ndam\u00e5l</p> <p><code>taskgroup\u00a0BGP</code> <code>task\u00a0execute\u00a0bgp</code> <code>task\u00a0read\u00a0bgp</code> <code>task\u00a0write\u00a0bgp</code></p> <p><code>taskgroup\u00a0ISIS</code> <code>task\u00a0execute\u00a0isis</code> <code>task\u00a0read\u00a0isis</code> <code>task\u00a0write\u00a0isis</code></p> <p><code>taskgroup\u00a0BGPISISTasks</code> <code>inherit\u00a0taskgroup\u00a0BGP</code> <code>inherit\u00a0taskgroup\u00a0ISIS</code></p> <p><code>usergroup\u00a0BGPISISAdmins</code> <code>taskgroup\u00a0BGPISISTasks</code></p> <p><code>username\u00a0juan_bgp</code> <code>group\u00a0BGPISISAdmins</code> <code>secret\u00a0cisco</code></p>"},{"location":"cisco/Cisco_IOS-XR/#grundkonfiguration","title":"Grundkonfiguration","text":"<p><code>hostname\u00a0XR-01</code> <code>!</code> <code>ipv4\u00a0netmask-format\u00a0bit-count</code> <code>!</code> <code>line\u00a0console</code> <code>exec-timeout\u00a030\u00a00</code> <code>!</code> <code>line\u00a0default</code> <code>exec-timeout\u00a030\u00a00</code> <code>access-class\u00a0ingress\u00a0ACL-MGMT-ACCESS</code> <code>transport\u00a0input\u00a0ssh</code></p> <p>SSH</p> <p><code>crypto\u00a0key\u00a0generate\u00a0rsa\u00a0general-keys</code> <code>How\u00a0many\u00a0bits\u00a0in\u00a0the\u00a0modulus\u00a0[1024]:</code> <code>ssh\u00a0server\u00a0v2</code> <code>ssh\u00a0server\u00a0logging</code> <code>line\u00a0default\u00a0transport\u00a0input\u00a0ssh</code> <p>SSH Package beh\u00f6vs.</p> <p><code>show\u00a0install\u00a0active\u00a0|\u00a0include\u00a0k9</code></p> <p>Logging</p> <p><code>logging\u00a0on</code> <code>logging\u00a0buffered\u00a0200000</code> <code>logging\u00a010.0.10.12</code></p> <p>Skicka godtyckligt loggmeddelande</p> <p><code>logmsg\u00a0HEJ</code></p> <p>NTP</p> <p><code>clock\u00a0timezone\u00a0CET\u00a0Europe/Stockholm</code></p> <p><code>ntp</code> <code>server\u00a079.136.86.176</code> <code>update-calendar</code></p> <p>Tidszon</p> <p><code>clock\u00a0timezone\u00a0CET\u00a01</code> <code>clock\u00a0summer-time\u00a0CEST\u00a0recurring\u00a0last\u00a0sunday\u00a0march\u00a002:00\u00a0last\u00a0sunday\u00a0october\u00a003:00</code></p> <p>SNMP F\u00f6r att spara lite CPU-cykler kan man sl\u00e5 p\u00e5 statsd caching. Detta \u00e4r generellt rekommenderat.</p> <p><code>snmp-server\u00a0ifmib\u00a0stats\u00a0cache</code></p> <p>pyIOSXR Enable XML agent</p> <p><code>xml\u00a0agent\u00a0tty\u00a0iteration\u00a0off</code></p> <p>CDP CDP \u00e4r default avst\u00e4ngt globalt och per inteface i XR. F\u00f6r att sl\u00e5 p\u00e5 CDP p\u00e5 XR m\u00e5ste det sl\u00e5s p\u00e5 globalt och per interface:</p> <p><code>cdp</code> <code>interface\u00a0GigabitEthernet0/0/0/0</code> <code>cdp</code></p> <p>MTU MTU i IOS-XR r\u00e4knas lite annorlunda kontra IOS eftersom L2 headern \u00e4r inkluderad. Default har IOS och IOS-XR dock samma MTU p\u00e5 Ethernet-interface (L3: 1500B) men ska man k\u00f6ra jumbo frames och vill matcha \u00e4r IOS-XR = IOS + 14, exempel:</p> <p>IOS</p> <p><code>mtu\u00a09216</code></p> <p>IOS-XR</p> <p><code>mtu\u00a09230</code></p>"},{"location":"cisco/Cisco_IOS-XR/#plattform","title":"Plattform","text":"<p><code>top</code> <code>show\u00a0redundancy</code> <code>show\u00a0platform</code> <code>show\u00a0install\u00a0active\u00a0summary</code> <code>show\u00a0install\u00a0committed\u00a0summary</code> <code>show\u00a0fpd\u00a0package</code></p> <p>Upgrade</p> <p><code>fpd\u00a0auto-upgrade\u00a0enable</code></p> <p><code>sysadmin-vm:0_RSP0#\u00a0show\u00a0install\u00a0health</code> <code>install\u00a0add\u00a0source\u00a0harddisk:\u00a0asr9k-mini-x64-6.5.3.iso</code></p>"},{"location":"cisco/Cisco_IOS-XR/#copp","title":"CoPP","text":"<p>Control Plane Policing (CoPP) skyddar kontrollplanet f\u00f6r att s\u00e4kerst\u00e4lla stabilitet, n\u00e5barhet och paketleverans. CoPP i IOS-XR implementeras med hj\u00e4lp av Local Packet Transport Services. LPTS \u00e4r ett koncept med reflexsiva ACL:er, punt policers och en slags intern FIB. Detta skydd \u00e4r p\u00e5 default med f\u00f6rdefinierade v\u00e4rden. Cisco rekommenderar att dessa l\u00e4mnas default initialt f\u00f6r att eventuellt modifieras vid ett senare tillf\u00e4lle utifr\u00e5n behov. IOS-XR kan \u00e4ven hantera viss trafik direkt i linjekorten f\u00f6r att avlasta CPU, t.ex. BFD, Netflow och ARP kommer LPTS instruera lokal CPU att hantera ist\u00e4llet f\u00f6r RSP CPU.</p> <p><code>show\u00a0lpts\u00a0bindings\u00a0brief</code></p> <p>MPP Management Plane Protection \u00e4r p\u00e5 default men alla TCP- och UDP-portar kan accessas ifr\u00e5n alla interface. Detta g\u00e5r att strypa ner f\u00f6r b\u00e5de inband och OoB.</p> <p><code>control-plane</code> <code>management-plane</code> <code>out-of-band</code> <code>interface\u00a0MgmtEth0/0/CPU0/0</code> <code>allow\u00a0SSH\u00a0peer</code> <code>address\u00a0ipv4\u00a010.0.0.0/24</code></p>"},{"location":"cisco/Cisco_IOS-XR/#rpl","title":"RPL","text":"<p>N\u00e4r man editerar en existerande policy och commitar kommer det automatiskt att skickas BGP REFRESH, f\u00f6rutsatt att granne har denna capability. Det g\u00f6rs ocks\u00e5 en full table refresh eftersom f\u00f6r\u00e4ndringen kanske inneb\u00e4r att prefix som inte tidigare importerades nu ska importeras. Man beh\u00f6ver allts\u00e5 inte g\u00f6ra n\u00e5gon soft reset som med IOS. Detta g\u00e5r att st\u00e4nga av.</p> <p><code>bgp\u00a0auto-policy-soft-reset\u00a0disable</code></p> <p>Troubleshooting - dry run</p> <p><code>show\u00a0bgp\u00a0route-policy</code> <p>Kolla hur l\u00e5ng tid olika route-policy entries tar f\u00f6r en viss peering</p> <p><code>debug\u00a0pcl\u00a0profile\u00a0detail</code> <code>!clear\u00a0bgp\u00a0peering</code> <code>show\u00a0pcl\u00a0protocol\u00a0bgp\u00a0speaker-0\u00a0neighbor-in-dflt</code><code>policy\u00a0profile</code>"},{"location":"cisco/Cisco_IOS-XR/#hsrp","title":"HSRP","text":"<p><code>interface\u00a0GigabitEthernet\u00a00/0/0/0</code> <code>ip\u00a0address\u00a010.32.0.3\u00a0255.255.255.0</code> <code>router\u00a0hsrp</code> <code>interface\u00a0GigabitEthernet\u00a00/0/0/0</code> <code>hsrp\u00a01\u00a0ipv4\u00a010.32.0.1</code> <code>hsrp\u00a01\u00a0priority\u00a095</code> <code>hsrp\u00a01\u00a0preempt</code> <code>hsrp\u00a01\u00a0track\u00a0GigabitEthernet\u00a00/0/0/1</code></p>"},{"location":"cisco/Cisco_IOS-XR/#vrrp","title":"VRRP","text":"<p><code>interface\u00a0GigabitEthernet\u00a00/0/0/0</code> <code>ip\u00a0address\u00a010.32.25.3\u00a0255.255.255.0</code> <code>router\u00a0vrrp</code> <code>interface\u00a0GigabitEthernet\u00a00/0/0/0</code> <code>address-family\u00a0ipv4</code> <code>vrrp\u00a01</code> <code>address\u00a010.32.25.1</code> <code>priority\u00a095</code> <code>track\u00a0interface\u00a0GigabitEthernet\u00a00/0/0/0\u00a010</code></p>"},{"location":"cisco/Cisco_IOS-XR/#vrf","title":"VRF","text":"<p>Nedan exempel anv\u00e4nds ihop med MPLS och BGP.</p> <p><code>vrf\u00a01337</code> <code>address-family\u00a0ipv4\u00a0unicast</code> <code>import\u00a0route-target</code> <code>1337:10</code> <code>export\u00a0route-target</code> <code>1337:10</code></p> <p><code>router\u00a0bgp\u00a01337</code> <code>vrf\u00a01337</code> <code>rd\u00a01337:10</code> <code>address-family\u00a0ipv4\u00a0unicast</code> <code>redistribute\u00a0static</code></p> <p>Protip: I XR n\u00e4r man k\u00f6r \"show run vrf xx\" ser man bara det som finns konfigurerat under \"vrf xx\", inte tex det som r\u00f6r vrf under bgp konfigurationen. F\u00f6r att se allt i konfugrationen som r\u00f6r en specifik vrf kan f\u00f6ljande kommando anv\u00e4ndas:</p> <p><code>show\u00a0run\u00a0formal\u00a0|\u00a0i\u00a0vrf\u00a010</code></p> <p>CEF show cef ipv6 exact-route 2001::2:2 2001::1:1 protocol icmp ingress-interface GigabitEthernet0/0/0/0.101</p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_IOS/","title":"Cisco IOS","text":"<p>IOS \u00e4r den mjukvara som anv\u00e4nds av de flesta routrar och switchar av m\u00e4rket Cisco. Se \u00e4ven NX-OS och IOS XR.</p> <p>IOS-XE IOS \u00e4r ett monolithic operativsystem som \u00e4r till \u00e5ren d\u00e4rf\u00f6r har IOS-XE utvecklats som \u00e4r betydligt modernare uppbyggt. Det k\u00f6r en linuxk\u00e4rna i botten och sedan ligger IOS som en daemon. Sedan kan ytterliggare processer k\u00f6ras f\u00f6r sig. Denna modul\u00e4ritet g\u00f6r systemet mer feltolerant, t.ex. ett fel i en process beh\u00f6ver inte p\u00e5verka k\u00e4rnan. IOS-XE har \u00e4ven APIer f\u00f6r control plane processer. Se \u00e4ven Cisco CSR.</p>"},{"location":"cisco/Cisco_IOS/#konfiguration","title":"Konfiguration","text":"<p>Grundl\u00e4ggande</p> <p><code>hostname\u00a0[hostname]</code> <code>enable\u00a0secret\u00a0[password]</code> <code>service\u00a0password-encryption</code> <code>service\u00a0nagle</code> <code>no\u00a0ip\u00a0domain\u00a0lookup</code> <code>no\u00a0ip\u00a0http\u00a0server</code></p> <p>Se \u00e4ven Cisco Logging, Services och Security.</p> <p>Sl\u00e5 p\u00e5 loggmeddelanden i SSH terminal.</p> <p><code>terminal\u00a0monitor</code></p> <p>Resurser</p> <p><code>show\u00a0platform\u00a0resources</code> <code>show\u00a0platform\u00a0hardware\u00a0fed\u00a0switch\u00a01\u00a0fwd-asic\u00a0resource\u00a0tcam\u00a0utilization</code></p> <p>Line</p> <p><code>line\u00a0con\u00a00</code> <code>logging\u00a0synchronous</code> <code>exec-timeout\u00a0[minutes]\u00a0[seconds]</code> <code>login</code> <code>line\u00a0vty\u00a00\u00a015</code> <code>logging\u00a0synchronous</code> <code>exec-timeout\u00a0[minutes]\u00a0[seconds]</code> <code>login\u00a0#local</code></p> <p><code>show\u00a0line\u00a0vty</code></p> <p>Reload</p> <p><code>reload\u00a0in\u00a03</code> <code>reload\u00a0cancel</code></p> <p>NETCONF</p> <p><code>netconf\u00a0ssh</code> <code>ssh\u00a0-s\u00a0cisco@10.0.0.10\u00a0netconf</code></p> <p>I nyare IOS-XE finns \u00e4ven restconf (XML eller JSON)</p> <p><code>restconf</code></p> <p>Users Kolla vilka som \u00e4r inloggade.</p> <p><code>show\u00a0users\u00a0\u00a0/\u00a0\u00a0who</code> <code>show\u00a0tcp\u00a0brief</code></p> <p>Auto enable</p> <p><code>line\u00a0vty\u00a00\u00a015</code> <code>privilege\u00a0level\u00a015</code></p> <p>CLI history, l\u00e4gg till all f\u00f6r att se alla kommandon dvs det som finns i crashinfo.</p> <p><code>show\u00a0history</code></p> <p>Disable Express Setup (mode button for 3 seconds)</p> <p><code>no\u00a0setup\u00a0express</code></p> <p>Conditional Debugging \u00e4r bra p\u00e5 busy routers.</p> <p><code>debug\u00a0condition\u00a0int\u00a0gi2</code> <code>debug\u00a0ip\u00a0rip</code></p> <p>COPP</p> <p><code>cpp\u00a0system-default</code> <code>show\u00a0policy-map\u00a0control-plane</code> <code>show\u00a0policy-map\u00a0system-cpp-policy</code> <code>show\u00a0platform\u00a0hardware\u00a0fed\u00a0switch\u00a01\u00a0qos\u00a0queue\u00a0stats\u00a0internal\u00a0cpu\u00a0policer</code></p>"},{"location":"cisco/Cisco_IOS/#inbyggda-funktioner","title":"Inbyggda Funktioner","text":"<p>Meny Man kan skapa menyer med menu-kommandot och sedan binda users till menyn.</p> <p><code>menu\u00a0Menu01\u00a0line-mode</code> <code>menu\u00a0Menu01\u00a0prompt\u00a0^R1#^</code> <code>menu\u00a0Menu01\u00a0single-space</code> <code>menu\u00a0Menu01\u00a0title\u00a0^Actions\u00a0for\u00a0restricted\u00a0user^</code> <code>menu\u00a0Menu01\u00a0text\u00a01\u00a0Show\u00a0routes</code> <code>menu\u00a0Menu01\u00a0command\u00a01\u00a0show\u00a0ip\u00a0route</code> <code>menu\u00a0Menu01\u00a0text\u00a02\u00a0Exit</code> <code>menu\u00a0Menu01\u00a0command\u00a02\u00a0exit</code></p> <p><code>username\u00a0User01\u00a0autocommand\u00a0menu\u00a0Menu01</code></p> <p>Macro Med macros kan konfigurera att ett kommando g\u00f6r m\u00e5nga saker.</p> <p><code>define\u00a0interface-range\u00a0SERVERPORTS\u00a0gi\u00a00/3-9</code> <code>show\u00a0parser\u00a0macro</code></p> <p>Schemal\u00e4ggning Funkar endast med exec mode kommandon</p> <p><code>kron\u00a0occurrence\u00a0OCC\u00a0in\u00a01\u00a0recurring</code> <code>policy-list\u00a0TEST</code> <code>kron\u00a0policy-list\u00a0TEST</code> <code>cli\u00a0show\u00a0vers</code></p> <p><code>show\u00a0kron\u00a0schedule</code></p> <p>Views</p> <p><code>enable\u00a0view</code> <code>parser\u00a0view\u00a0SHOWONLY</code> <code>show\u00a0parser\u00a0view</code></p> <p>Auto-install Auto-install \u00e4r en feature som kan h\u00e4mta konfiguration fr\u00e5n en filserver f\u00f6rsta g\u00e5ngen en enhet startar. Det g\u00e5r att g\u00f6ra med DHCP eller RARP, preference \u00e4r: sname, option 66, option 150, siaddr. Det f\u00f6rs\u00f6ker p\u00e5 alla tillg\u00e4ngliga interface. OBS f\u00f6r att auto-install ska triggas m\u00e5ste NVRAM vara helt tomt p\u00e5 konfigurationsfiler, erase nvram:.</p> <p><code>show\u00a0auto\u00a0install\u00a0status</code></p> <p>Linux shell Man kan g\u00f6ra IOS lite mer likt ett Linux-skal och d\u00e5 f\u00e5r man tillg\u00e5ng till n\u00e5gra basic linuxkommandon. Detta \u00e4r en IOS 15 feature.</p> <p><code>terminal\u00a0shell</code></p> <p>Eller om man alltid vill ha det p\u00e5.</p> <p><code>shell\u00a0processing\u00a0full</code></p> <p>Verify</p> <p><code>show\u00a0terminal\u00a0|\u00a0grep\u00a0Shell</code></p> <p>XMCP</p> <p><code>service-routing\u00a0xmcp\u00a0listen</code> <code>client\u00a0username\u00a0username\u00a0password\u00a0password</code> <code>domain\u00a0domain-number\u00a0{default\u00a0|\u00a0only}</code> <code>show\u00a0service-routing\u00a0xmcp\u00a0clients</code> <code>show\u00a0service-routing\u00a0xmcp\u00a0server</code></p> <p>Character Generator Protocol, port 19</p> <p><code>service\u00a0tcp-small-servers</code></p>"},{"location":"cisco/Cisco_IOS/#eem","title":"EEM","text":"<p>Cisco IOS Embedded Event Manager \u00e4r ett subsystem som m\u00f6jligg\u00f6r event detection och onboard automation. Det \u00e4r flexibelt och kan triggas vid kommando, h\u00e4ndelse eller klockslag, show event manager version.</p> <p>Exempel:</p> <p><code>event\u00a0manager\u00a0applet\u00a0CLI_logger</code> <code>event\u00a0cli\u00a0pattern\u00a0\"show.*\"\u00a0sync\u00a0no\u00a0skip\u00a0no</code> <code>action\u00a001\u00a0syslog\u00a0msg\u00a0\"$_cli_host\u00a0executed:\u00a0$_cli_msg\"</code></p> <p><code>event\u00a0manager\u00a0applet\u00a0NO_SH_RUN</code> <code>event\u00a0cli\u00a0pattern\u00a0\"show\u00a0run\"\u00a0sync\u00a0yes</code> <code>action\u00a001\u00a0puts\u00a0\"CAN\u00b4T\u00a0DO\u00a0THAT\"</code></p> <p><code>event\u00a0manager\u00a0applet\u00a0Never_Back_Down</code> <code>event\u00a0timer\u00a0watchdog\u00a0time\u00a05</code> <code>action\u00a001\u00a0cli\u00a0command\u00a0\"enable\"</code> <code>action\u00a002\u00a0cli\u00a0command\u00a0\"conf\u00a0t\"</code> <code>action\u00a003\u00a0cli\u00a0command\u00a0\"interface\u00a0gi2\"</code> <code>action\u00a004\u00a0cli\u00a0command\u00a0\"no\u00a0shut\"</code></p> <p><code>debug\u00a0event\u00a0manager\u00a0action\u00a0cli</code></p> <p>Verify</p> <p><code>show\u00a0event\u00a0manager\u00a0policy\u00a0registered</code></p> <p>Trigga manuellt</p> <p><code>event\u00a0manager\u00a0run\u00a0APPLET</code></p> <p>EEM kan anv\u00e4nda sig utav environment variable, t.ex. f\u00f6r att konfigurera en mailserver som flera applets kan dra nytta av.</p> <p><code>event\u00a0manager\u00a0environment\u00a0_mail_server\u00a0172.22.0.10</code></p> <p>Kolla alla inbyggda variabler, det finns en hel del.</p> <p><code>show\u00a0event\u00a0manager\u00a0detector\u00a0all\u00a0detailed\u00a0|\u00a0i\u00a0\\$_</code></p>"},{"location":"cisco/Cisco_IOS/#konfigurationshantering","title":"Konfigurationshantering","text":"<p>Archive and rollback</p> <p><code>archive</code> <code>path</code><code>tftp://1.2.3.4/test</code> <code>write-memory</code> <code>time-period\u00a01440</code> <code>show\u00a0archive</code></p> <p>Kolla skillnad mellan running och startup config.</p> <p><code>show\u00a0archive\u00a0config\u00a0differences</code></p> <p><code>alias\u00a0exec</code><code>diff</code><code>show\u00a0archive\u00a0config\u00a0differences</code> <code>alias\u00a0configure</code><code>diff</code><code>do\u00a0show\u00a0archive\u00a0config\u00a0differences</code></p> <p>Automatic Rollback Prereq.</p> <p><code>archive</code> <code>path\u00a0bootflash:/</code> <code>maximum\u00a01</code></p> <p>Ta en snapshot av konfigen n\u00e4r man g\u00e5r in i global configuration mode. Tappar man konnektivitet s\u00e5 rullas konfigen tillbaka efter 1 minut.</p> <p><code>configure\u00a0terminal\u00a0revert\u00a0timer\u00a0idle\u00a01</code></p> <p><code>configure\u00a0confirm</code></p> <p>Parser Parser cache \u00e4r p\u00e5slaget default f\u00f6r att g\u00f6ra konfig-hantering snabbare.</p> <p><code>parser\u00a0cache</code> <code>show\u00a0parser\u00a0statistics</code></p> <p>Man kan reducera tiden det tar f\u00f6r ett kommando att exekvera.</p> <p><code>parser\u00a0config\u00a0cache\u00a0interface</code></p> <p>Man kan begr\u00e4nsa s\u00e5 att endast en user i taget kan managera en enhet.</p> <p><code>parser\u00a0command\u00a0serializer</code></p> <p>Resilient Configuration</p> <p><code>secure\u00a0boot-image</code> <code>secure\u00a0boot-config</code> <code>show\u00a0secure\u00a0bootset</code></p> <p>Restore</p> <p><code>secure\u00a0boot-config\u00a0restore\u00a0flash:archived-config</code> <code>configure\u00a0replace\u00a0flash:archived-config</code></p>"},{"location":"cisco/Cisco_IOS/#ethernet","title":"Ethernet","text":"<p><code>show\u00a0controllers\u00a0ethernet-controller</code> <code>show\u00a0interfaces\u00a0counters\u00a0errors</code></p> <p>Default \u00e4r Ethernet autonegotiation p\u00e5slaget p\u00e5 switchportar. F\u00f6r att sl\u00e5 av det m\u00e5ste b\u00e5de speed och duplex st\u00e4llas manuellt.</p> <p><code>int\u00a0gi0/1</code> <code>speed\u00a01000</code> <code>duplex\u00a0full</code></p> <p>CDP kan uppt\u00e4cka duplex mismatch men ej fixa det. Ifall fel kabel (korsad eller rak) anv\u00e4nds finns Auto-MDIX f\u00f6r att uppt\u00e4cka detta och \u00e4ndra rx och tx p\u00e5 switchporten.</p> <p>Testa kabel, Time Domain Reflection</p> <p><code>test\u00a0cable-diagnostics\u00a0tdr\u00a0interface\u00a0gi\u00a00/1</code> <code>show\u00a0cable-diagnostics\u00a0tdr\u00a0interface\u00a0gi\u00a00/1</code></p>"},{"location":"cisco/Cisco_IOS/#cdp","title":"CDP","text":"<p>CDP \u00e4r ett l2-protokoll f\u00f6r att uppt\u00e4cka och utbyta information med directly connected Cisco-enheter, destination address \u00e4r 01:00:0c:cc:cc:cc och det skickas var 60:e sekund. CDP g\u00e5r att anv\u00e4nda f\u00f6r reliable policy routing och \u00e4r ett prereq f\u00f6r Layer 2 traceroute. Aktuell version \u00e4r CDPv2.</p> <p><code>cdp\u00a0run</code> <code>cdp\u00a0timer\u00a060</code> <code>cdp\u00a0holdtime\u00a0180</code></p> <p>Sl\u00e5 p\u00e5 per interface</p> <p><code>interface\u00a0gi2</code> <code>cdp\u00a0enable</code></p> <p>Verify</p> <p><code>show\u00a0cdp</code> <code>show\u00a0cdp\u00a0neighbor</code></p> <p>Det finns \u00e4ven st\u00f6d f\u00f6r den \u00f6ppna standarden LLDP som anv\u00e4nder 01:80:c2:00:00:0e. LLDP advertisements skickas var 30:e sekund och TTL \u00e4r 120 sekunder.</p> <p><code>lldp\u00a0run</code> <code>show\u00a0lldp</code></p> <p>CDP/LLDP kan anv\u00e4ndas f\u00f6r att s\u00e4tta interface descriptions automatiskt utifr\u00e5n neighbor hostname och port-id.</p> <p><code>event\u00a0manager\u00a0applet\u00a0AUTOMATIC-PORT-DESCRIPTION</code> <code>event\u00a0neighbor-discovery\u00a0interface\u00a0regexp\u00a0GigabitEthernet.*\u00a0cdp\u00a0add</code> <code>action\u00a010\u00a0cli\u00a0command\u00a0\"enable\"</code> <code>action\u00a011\u00a0cli\u00a0command\u00a0\"config\u00a0t\"</code> <code>action\u00a012\u00a0cli\u00a0command\u00a0\"interface\u00a0$_nd_local_intf_name\"</code> <code>action\u00a013\u00a0cli\u00a0command\u00a0\"description\u00a0$_nd_cdp_entry_name:$_nd_port_id\"</code> <code>action\u00a014\u00a0syslog\u00a0msg\u00a0\"Updated\u00a0description\u00a0$_nd_cdp_entry_name:$_nd_port_id\u00a0on\u00a0$_nd_local_intf_name\"</code></p>"},{"location":"cisco/Cisco_IOS/#dnac","title":"DNAC","text":"<p>Cisco DNA Center \u00e4r en kontroller- och analysplattform f\u00f6r Catalystn\u00e4t.</p> <p>Reset switch F\u00f6r att nollst\u00e4lla en switch som har varit managerad av DNAC m\u00e5ste man ta bort de certifikat som DNAC har installerat.</p> <p><code>conf\u00a0t</code> <code>crypto\u00a0key\u00a0zeroize</code> <code>yes</code> <code>no\u00a0crypto\u00a0pki\u00a0certificate\u00a0pool</code> <code>yes</code> <code>end</code> <code>delete\u00a0/force\u00a0vlan.dat</code> <code>delete\u00a0/force\u00a0nvram:*.cer</code> <code>delete\u00a0/force\u00a0nvram:pnp*</code> <code>delete\u00a0/force\u00a0flash:pnp*</code> <code>write\u00a0erase</code> <code>reload</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_IPsec/","title":"Cisco IPsec","text":"<p>IPsec (RFC 4301) \u00e4r en teknik f\u00f6r att skydda datakommunikation och r\u00e4knas som en secure VPN. Det finns i tunnel och transport mode beroende p\u00e5 om det ska tunnlas och krypteras eller endast krypteras. IPsec funkar med IPv4/IPv6 och kan k\u00f6ras \u00f6ver en GRE-tunnel. Virtual Tunnel Interface (VTI) \u00e4r routebara interface som anv\u00e4nds f\u00f6r att terminera IPsec-tunnlar, detta g\u00f6r IPsec flexibelt och det kan anv\u00e4ndas b\u00e5de f\u00f6r unicast och multicast.</p> <p>Se \u00e4ven Cisco Security, Cisco DMVPN och ASA VPN.</p> <p>MTU IPsec p\u00e5verkar MTU, detta b\u00f6r man ta med i ber\u00e4kningarna. Notera att packet size inte \u00e4r linj\u00e4rt i f\u00f6rh\u00e5llande till storleken p\u00e5 de enkapsulerade paketen eftersom ESP jobbar med block. Detta i kombination med att det finns v\u00e4ldigt m\u00e5nga IPsec-algoritmer g\u00f6r att det inte alltid \u00e4r solklart exakt hur det blir men det finns verktyg som hj\u00e4lper till att r\u00e4kna p\u00e5 det. Med hj\u00e4lp av detta kan man s\u00e4tta en l\u00e4mplig IP MTU p\u00e5 tunnel interface och sedan justera TCP MSS till 40 bytes l\u00e4gre \u00e4n det.</p> <p><code>https://cway.cisco.com/tools/ipsec-overhead-calc/</code></p>"},{"location":"cisco/Cisco_IPsec/#konfiguration","title":"Konfiguration","text":"<p>Dead Peer Detection (DPD) &amp; NAT Keepalives</p> <p><code>crypto\u00a0isakmp\u00a0keepalive\u00a030</code> <code>crypto\u00a0isakmp\u00a0nat\u00a0keepalive\u00a030</code></p> <p>Capabilities, Encryption Layer Interface</p> <p><code>show\u00a0crypto\u00a0eli</code></p> <p>Errors and Invalid SPI Recovery Feature</p> <p><code>crypto\u00a0isakmp\u00a0invalid-spi-recovery</code></p>"},{"location":"cisco/Cisco_IPsec/#legacy","title":"Legacy","text":"<p>IPsec VPN med crypto maps och IKEv1 \u00e4r den \u00e4ldsta och minst skalbara varianten av IPsec VPN.</p> <p><code>crypto\u00a0isakmp\u00a0policy\u00a010</code> <code>encryption\u00a0aes\u00a0256</code> <code>authentication\u00a0pre-share</code> <code>group\u00a020</code> <code>lifetime\u00a086400</code></p> <p><code>show\u00a0crypto\u00a0isakmp\u00a0policy</code></p> <p>PSK Authentication</p> <p><code>crypto\u00a0isakmp\u00a0key\u00a0S3cr3ts\u00a0address\u00a03.3.3.3</code></p> <p><code>show\u00a0crypto\u00a0isakmp\u00a0key</code></p> <p>Fas 2</p> <p><code>crypto\u00a0ipsec\u00a0transform-set\u00a0PHASE2\u00a0esp-aes\u00a0esp-sha-hmac</code> <code>mode\u00a0tunnel</code> <code>ip\u00a0access-list\u00a0extended\u00a0CRYPTO</code> <code>permit\u00a0ip\u00a0192.168.1.0\u00a00.0.0.255\u00a0192.168.2.0\u00a00.0.0.255</code></p> <p><code>crypto\u00a0map\u00a0VPNMAP\u00a010\u00a0ipsec-isakmp</code> <code>set\u00a0peer\u00a03.3.3.3</code> <code>set\u00a0transform-set\u00a0PHASE2</code> <code>match\u00a0address\u00a0CRYPTO</code></p> <p>Interfaces</p> <p><code>interface\u00a0GigabitEthernet0/1</code> <code>description\u00a0Internet</code> <code>ip\u00a0address\u00a02.2.2.2\u00a0255.255.255.0</code> <code>crypto\u00a0map\u00a0VPNMAP</code></p> <p><code>interface\u00a0GigabitEthernet0/2</code> <code>description\u00a0Inside</code> <code>ip\u00a0address\u00a0192.168.1.1\u00a0255.255.255.0</code></p> <p>Verify Fas 1 och 2. Inget f\u00f6rhandlas f\u00f6rens det skickas trafik som triggar tunneln.</p> <p><code>show\u00a0crypto\u00a0isakmp\u00a0sa</code> <code>show\u00a0crypto\u00a0ipsec\u00a0sa</code> <code>show\u00a0crypto\u00a0session</code></p> <p>Loopback</p> <p><code>crypto\u00a0map\u00a0VPNMAP\u00a0local-address\u00a0Loopback0</code></p> <p>Reverse Route Injection</p> <p><code>crypto\u00a0map\u00a0VPNMAP\u00a010\u00a0ipsec-isakmp</code> <code>set\u00a0reverse-route\u00a0distance\u00a010</code></p> <p><code>show\u00a0crypto\u00a0route</code></p>"},{"location":"cisco/Cisco_IPsec/#gre-over-ipsec-with-profile","title":"GRE over IPsec with Profile","text":"<p>En f\u00f6rdel med att tunnla trafiken med GRE \u00e4r att routingprotokoll kan anv\u00e4ndas \u00f6ver tunneln. Trafiken krypteras efter att det har enkapsulerats med GRE. Man b\u00f6r manuellt ange ip mtu p\u00e5 tunnel-interfacet f\u00f6r det tar ej h\u00e4nsyn till ESP-enkapsuleringen som l\u00e4gger till overhead.</p> <p><code>crypto\u00a0isakmp\u00a0policy\u00a010</code> <code>encryption\u00a0aes\u00a0256</code> <code>authentication\u00a0pre-share</code> <code>group\u00a020</code> <code>lifetime\u00a086400</code></p> <p><code>crypto\u00a0isakmp\u00a0key\u00a0S3cr3ts\u00a0address\u00a03.3.3.3</code></p> <p><code>crypto\u00a0ipsec\u00a0transform-set\u00a0PHASE2\u00a0esp-aes\u00a0esp-sha-hmac</code> <code>mode\u00a0transport\u00a0\u00a0#</code><code>Spara`` ``overhead`` ``genom`` ``att`` ``k\u00f6ra`` ``i`` ``transport`` ``mode</code></p> <p><code>crypto\u00a0ipsec\u00a0profile\u00a0GRE_OVER_IPSEC</code> <code>set\u00a0transform-set\u00a0PHASE2</code></p> <p><code>interface\u00a0Tunnel0</code> <code>ip\u00a0address\u00a01.1.1.1\u00a0255.255.255.0</code> <code>ip\u00a0mtu\u00a01400</code> <code>ip\u00a0tcp\u00a0adjust-mss\u00a01360</code> <code>tunnel\u00a0source\u00a0Loopback0</code> <code>tunnel\u00a0destination\u00a03.3.3.3</code> <code>tunnel\u00a0protection\u00a0ipsec\u00a0profile\u00a0GRE_OVER_IPSEC</code></p> <p>Verify</p> <p><code>show\u00a0crypto\u00a0ipsec\u00a0profile</code> <code>show\u00a0crypto\u00a0session</code></p> <p>Local och remote i IPsec SA kommer att f\u00f6rhandlas som tunnel-endpoint/32 \\&lt;-&gt; tunnel-endpoint/32 protokoll GRE vilket g\u00f6r att det aldrig beh\u00f6vs mer \u00e4n en entry per tunnel.</p>"},{"location":"cisco/Cisco_IPsec/#fvrf","title":"FVRF","text":"<p>Om interfacet som terminerar tunneln ligger i en vrf m\u00e5ste man anv\u00e4nda en keyring som man l\u00e4gger i en isakmp-profil.</p> <p><code>crypto\u00a0keyring\u00a0VPN_PEERS\u00a0vrf\u00a0Outside</code> <code>pre-shared-key\u00a0address\u00a03.3.3.3\u00a0key\u00a0SecretKey</code></p> <p><code>crypto\u00a0isakmp\u00a0profile\u00a0VPN_PROFILE</code> <code>keyring\u00a0VPN_PEERS</code> <code>match\u00a0identity\u00a0address\u00a03.3.3.3\u00a0255.255.255.255</code> <code>keepalive\u00a010\u00a0retry\u00a05</code></p>"},{"location":"cisco/Cisco_IPsec/#vti","title":"VTI","text":"<p>Med VPN som byggs med Virtual Tunnel Interface kan man b\u00e5de anv\u00e4nda dynamic routing och multicast. Det fungerar likadant som GRE \u00f6ver IPsec men annan enkapsulering anv\u00e4nds. Payloaden enkapsuleras direkt i IPsec som \u00e4r en IP-enkapsulering d\u00e4rf\u00f6r st\u00f6ds inget annat \u00e4n IP (s\u00e5 t.ex. IS-IS fungerar ej). Detta g\u00f6r att tunnel-interfacet vet sin korrekta mtu. VTI konfigureras likadant som GRE \u00f6ver IPsec med profil men med en skillnad, h\u00e4r f\u00f6ljer d\u00e4rf\u00f6r endast skillnaden samt att transform set alltid m\u00e5ste k\u00f6ras i tunnel mode.</p> <p><code>crypto\u00a0ipsec\u00a0transform-set\u00a0PHASE2\u00a0esp-aes\u00a0esp-sha-hmac</code> <code>mode\u00a0tunnel</code></p> <p><code>interface\u00a0Tunnel0</code> <code></code><code>tunnel`` ``mode`` ``ipsec`` ``ipv4</code></p> <p>Verify</p> <p><code>show\u00a0crypto\u00a0ipsec\u00a0sa</code> <code>show\u00a0crypto\u00a0route</code> <code>show\u00a0crypto\u00a0session</code></p> <p>Local och remote kommer alltid att f\u00f6rhandlas som 0.0.0.0/0 \\&lt;-&gt; 0.0.0.0/0 vilket g\u00f6r att det aldrig beh\u00f6vs mer \u00e4n en entry per tunnel.</p>"},{"location":"cisco/Cisco_IPsec/#dynamic-vti","title":"Dynamic VTI","text":"<p>Man kan \u00e4ven l\u00e5ta VTI:s skapas dynamiskt.</p> <p><code>interface\u00a0Virtual-Template1\u00a0type\u00a0tunnel</code> <code>ip\u00a0unnumbered\u00a0Loopback0</code> <code>tunnel\u00a0mode\u00a0ipsec\u00a0ipv4</code> <code>tunnel\u00a0protection\u00a0ipsec\u00a0profile\u00a0VTI_PROFILE</code></p> <p><code>crypto\u00a0isakmp\u00a0profile\u00a0VTI_ISAKMP_PROFILE</code> <code>keyring\u00a0default</code> <code>match\u00a0identity\u00a0address\u00a00.0.0.0</code> <code>virtual-template\u00a01</code></p> <p>Verify</p> <p><code>show\u00a0interfaces\u00a0virtual-template\u00a01</code> <code>...</code> <code>Tunnel\u00a0linestate\u00a0evaluation\u00a0down\u00a0-\u00a0no\u00a0IPv4\u00a0tunnel\u00a0destination\u00a0address</code> <code>Tunnel\u00a0source\u00a0UNKNOWN</code> <code>...</code></p> <p><code>show\u00a0interfaces\u00a0virtual-access\u00a01</code> <code>...</code> <code>Tunnel\u00a0vaccess,\u00a0cloned\u00a0from\u00a0Virtual-Template1</code> <code>Tunnel\u00a0linestate\u00a0evaluation\u00a0up</code> <code>Tunnel\u00a0source\u00a010.0.0.1,\u00a0destination\u00a010.0.0.2</code> <code>...</code></p> <p>Andra sidan konfigureras som en vanlig point-to-point IPsec tunnel.</p> <p><code>interface\u00a0Tunnel10</code> <code>ip\u00a0address\u00a010.0.0.2\u00a0255.255.255.0</code> <code>tunnel\u00a0source\u00a0Loopback0</code> <code>tunnel\u00a0mode\u00a0ipsec\u00a0ipv4</code> <code>tunnel\u00a0destination\u00a01.1.1.1</code> <code>tunnel\u00a0protection\u00a0ipsec\u00a0profile\u00a0IPSEC</code></p>"},{"location":"cisco/Cisco_IPsec/#nat-t","title":"NAT-T","text":"<p>IOS m\u00e4rker med hj\u00e4lp av NAT-Discovery (RFC 3947) om paketen till och fr\u00e5n remote peer natas och byter d\u00e5 till UDP 4500. Detta \u00e4r p\u00e5 default men kan st\u00e4ngas av. B\u00e5da sidor m\u00e5ste ha st\u00f6d NAT-T f\u00f6r att det ska funka.</p> <p><code>no\u00a0crypto\u00a0ipsec\u00a0nat-transparency\u00a0udp-encapsulation</code></p>"},{"location":"cisco/Cisco_IPsec/#ikev2","title":"IKEv2","text":"<p>IKEv2 har inbyggt st\u00f6d f\u00f6r NAT traversal och ID \u00e4r alltid skyddat till skillnad fr\u00e5n IKEv1 aggressive mode.</p> <p>Key ring</p> <p><code>crypto\u00a0ikev2\u00a0keyring\u00a0IKEv2_KEYRING</code> <code>peer\u00a0SITE2</code> <code>address\u00a03.3.3.3</code> <code>pre-shared-key\u00a0local\u00a0PSK01</code> <code>pre-shared-key\u00a0remote\u00a0PSK02</code></p> <p>Proposal</p> <p><code>crypto\u00a0ikev2\u00a0proposal\u00a0IKEv2_PROPOSAL</code> <code>encryption\u00a0aes-cbc-256</code> <code>integrity\u00a0sha512</code> <code>group\u00a020</code></p> <p><code>show\u00a0crypto\u00a0ikev2\u00a0proposal</code></p> <p>Anv\u00e4nds aes-gcm m\u00e5ste prf k\u00f6ras p\u00e5 b\u00e5da sidor.</p> <p>Profile</p> <p><code>crypto\u00a0ikev2\u00a0profile\u00a0IKEv2_PROFILE</code> <code>match\u00a0identity\u00a0remote\u00a0address\u00a03.3.3.3\u00a0255.255.255.255</code> <code>identity\u00a0local\u00a0address\u00a02.2.2.2</code> <code>authentication\u00a0remote\u00a0pre-share</code> <code>authentication\u00a0local\u00a0pre-share</code> <code>keyring\u00a0local\u00a0IKEv2_KEYRING</code></p> <p><code>show\u00a0crypto\u00a0ikev2\u00a0profile</code></p> <p>Policy</p> <p><code>crypto\u00a0ikev2\u00a0policy\u00a0IKEv2_POLICY</code> <code>proposal\u00a0IKEv2_PROPOSAL</code></p> <p><code>show\u00a0crypto\u00a0ikev2\u00a0policy</code></p> <p>Transform set</p> <p><code>crypto\u00a0ipsec\u00a0transform-set\u00a0SITE2\u00a0esp-aes\u00a0256\u00a0esp-sha-hmac</code> <code>mode\u00a0tunnel</code></p> <p><code>show\u00a0crypto\u00a0ipsec\u00a0transform-set</code></p> <p>Crypto map</p> <p><code>crypto\u00a0map\u00a0IKEv2_MAP\u00a01000\u00a0ipsec-isakmp</code> <code>set\u00a0peer\u00a03.3.3.3</code> <code>set\u00a0transform-set\u00a0SITE2</code> <code>match\u00a0address\u00a0CRYPTO</code> <code>interface\u00a0gi2</code> <code>crypto\u00a0map\u00a0IKEv2_MAP</code> <code>show\u00a0crypto\u00a0map</code></p> <p>Verify</p> <p><code>show\u00a0crypto\u00a0ikev2\u00a0sa</code></p>"},{"location":"cisco/Cisco_IPsec/#high-availability","title":"High Availability","text":"<p>F\u00f6r att f\u00e5 till HA kan man s\u00e4tta upp det p\u00e5 olika s\u00e4tt. Man kan t.ex. ha loopbacks som tunnel endpoints och sedan sk\u00f6ta konvergering med routingprotokoll. Man kan \u00e4ven bygga redundans genom att ha flera peer-adresser i sin crypto-map.</p> <p><code>crypto\u00a0map\u00a0VPNMAP\u00a010\u00a0ipsec-isakmp</code> <code>set\u00a0peer\u00a02.2.2.2\u00a0default</code> <code>set\u00a0peer\u00a03.3.3.3</code></p> <p>Stateless IPsec redundancy Det finns inget samspel mellan IPSec och HSRP, dvs HSRP kan inte h\u00e5lla koll p\u00e5 IPSec's SA state och IPSec vet inte n\u00e4r HSRP g\u00f6r en failover. Men det g\u00e5r att konfigurera crypto-mapen att sourcea IKE fas 1 och 2 fr\u00e5n HSRP VIP och HSRP group names b\u00f6r matcha p\u00e5 b\u00e5da enheterna. \u00c4ven om HSRP konvergerar snabbt kan det ta en stund innan IPsec-tunnlar \u00e4r uppsatta p\u00e5 nytt efter en failover pga renegotiation. D\u00e4rf\u00f6r \u00e4r denna metod inte optimal utan det man t.ex. kan g\u00f6ra ist\u00e4llet \u00e4r att ha uppe tv\u00e5 tunnlar parallellt och sedan styra routingen med IP SLA.</p> <p><code>crypto\u00a0dynamic-map\u00a0VPNMAP\u00a010</code> <code>set\u00a0transform-set\u00a0PHASE2</code> <code>match\u00a0address\u00a0ACL</code> <code>reverse-route</code></p> <p><code>crypto\u00a0map\u00a0CRYPTO\u00a010\u00a0ipsec-isakmp\u00a0dynamic\u00a0VPNMAP</code></p> <p><code>interface\u00a0GigabitEthernet0/1</code> <code>standby\u00a01\u00a0name\u00a0IPSEC</code> <code>crypto\u00a0map\u00a0CRYPTO\u00a0redundancy\u00a0IPSEC</code></p> <p>Stateful IPsec redundancy Det g\u00e5r \u00e4ven att synka SA-states mellan IOS-routrar vilket m\u00f6jligg\u00f6r snabbare \u00f6verslag. Phase1/Phase2 session states synkroniseras mellan ACTIVE och STANDBY s\u00e5 inget beh\u00f6ver f\u00f6rhandlas om vid failover. Detta sk\u00f6ts automatiskt med hj\u00e4lp av SCTP, men ingen konfiguration synkas utan det m\u00e5ste s\u00e4ttas upp symmetriskt. Ut\u00f6ver ovanst\u00e5ende HSRP/IPsec-konfiguration beh\u00f6vs synkronisering s\u00e4ttas upp.</p> <p><code>ipc\u00a0zone\u00a0default</code> <code>association\u00a01</code> <code>protocol\u00a0sctp</code> <code>local-port\u00a05000</code> <code>local-ip\u00a010.0.0.1</code> <code>remote-port\u00a05000</code> <code>remote-ip\u00a010.0.0.2</code></p> <p><code>redundancy\u00a0inter-device</code> <code>scheme\u00a0standby\u00a0IPSEC</code></p> <p>Verify</p> <p><code>show\u00a0redundancy\u00a0inter-device</code> <code>show\u00a0crypto\u00a0ha</code></p>"},{"location":"cisco/Cisco_IPsec/#qos","title":"QoS","text":"<p>Eftersom trafiken \u00e4r enkapsulerad och krypterad m\u00e5ste QoS-markeringar/beslut fattas innan, man kan anv\u00e4nda QoS pre-classify p\u00e5 crypto map. Se \u00e4ven Cisco QoS.</p> <p><code>crypto\u00a0map\u00a0VPNMAP\u00a010\u00a0ipsec-isakmp</code> <code>qos\u00a0pre-classify</code></p>"},{"location":"cisco/Cisco_IPsec/#get-vpn","title":"GET VPN","text":"<p>Group Encrypted Transport VPN \u00e4r en Cisco proprietary VPN-teknik som inte anv\u00e4nder point-to-point-tunnlar utan ist\u00e4llet tillhandah\u00e5ller any-to-any kryptering genom att alla inblandade enheter k\u00f6r med samma IPsec-nycklar. Group Domain Of Interpretation (RFC 3547) \u00e4r ett group key management protocol som anv\u00e4nds f\u00f6r att distribuera dessa nycklar till alla Group Members (IOS devices) som vill ha det. GDOI k\u00f6rs mellan GM och Key Server. KS \u00e4r en IOS-enhet som \u00e4r ansvarig f\u00f6r att skapa och h\u00e5lla koll p\u00e5 GET VPN control plane. All policy konfigureras p\u00e5 den som t.ex. krypteringsalgoritmer, timers och vilken trafik som ska krypteras. Detta laddas sedan ner av GMs under registreringen. \u00c4ven om inte all policy \u00e4r intressant f\u00f6r alla kommer det fortfarande att h\u00e4mtas fr\u00e5n KS. GET VPN har st\u00f6d f\u00f6r multipla KS f\u00f6r HA och GMs kan konfigureras att registrera med flera. Den KS med h\u00f6gst prio blir primary KS och \u00f6vriga blir secondary. Vid lika anv\u00e4nds h\u00f6gst IP som tiebreaker. Nycklarna refreshas med j\u00e4mna mellanrum (default 24h) genom en rekey-process. Detta g\u00f6rs med UDP 848 antingen med unicast eller multicast. Anv\u00e4nder man unicast kommer varje GM att skicka ACK message som svar p\u00e5 den nya nyckeln. Det \u00e4r endast primary KS som skickar rekey messages. Normalt sett f\u00e5r GMs skicka trafik utan kryptering innan man har registrerat sig med KS, detta kallas Fail-Open.</p> <p>GET VPN anv\u00e4nder Tunnel mode IPSec men ist\u00e4llet f\u00f6r att anv\u00e4nda tunnel endpoints i den nya IP-headern \u00e5teranv\u00e4nds orginal-IP. Detta g\u00f6r att GET VPN inte passar bra att k\u00f6ra \u00f6ver internet eftersom d\u00e4r kan inte privata adresser routas. D\u00e4rf\u00f6r \u00e4r GET VPN b\u00e4st l\u00e4mpat f\u00f6r privata n\u00e4t, t.ex. som g\u00f6r \u00f6ver MPLS VPN eller VPLS. Vill man d\u00e4remot k\u00f6ra det \u00f6ver internet kan man kombinera det med DMVPN.</p> <p>GDOI Payloads</p> <ul> <li>GDOI SA</li> <li>SA KEK: anv\u00e4nds f\u00f6r att s\u00e4kra GET VPN control plane</li> <li>SA TEK: anv\u00e4nds f\u00f6r att s\u00e4kra data plane</li> <li>Key Download (KD)</li> <li>Sequence Number (SEQ)</li> <li>Proof of Possession (POP)</li> </ul>"},{"location":"cisco/Cisco_IPsec/#konfiguration_1","title":"Konfiguration","text":"<p>Key Server Generera RSA-nycklar</p> <p><code>crypto\u00a0key\u00a0generate\u00a0rsa\u00a0general-keys\u00a0label\u00a0GDOI_KEYS\u00a0modulus\u00a02048\u00a0exportable</code></p> <p>KS har all IPsec-konfiguration som sedan laddas ner av gruppmedlemmarna</p> <p><code>crypto\u00a0isakmp\u00a0policy\u00a010</code> <code>authentication\u00a0pre-share</code></p> <p><code>crypto\u00a0isakmp\u00a0key\u00a00\u00a0SECRET\u00a0address\u00a02.2.2.2\u00a0\u00a0\u00a0#GM-1</code> <code>crypto\u00a0isakmp\u00a0key\u00a00\u00a0SECRET\u00a0address\u00a03.3.3.3\u00a0\u00a0\u00a0#GM-2</code> <code>crypto\u00a0isakmp\u00a0key\u00a00\u00a0SECRET\u00a0address\u00a04.4.4.4\u00a0\u00a0\u00a0#GM-3</code></p> <p><code>crypto\u00a0ipsec\u00a0transform-set\u00a0PHASE2\u00a0esp-aes\u00a0esp-sha-hmac</code></p> <p><code>crypto\u00a0ipsec\u00a0profile\u00a0GDOI_PROFILE</code> <code>set\u00a0transform-set\u00a0PHASE2</code></p> <p><code>ip\u00a0access-list\u00a0extended\u00a0SYMMETRIC_ACL</code> <code>permit\u00a0ip\u00a0172.16.0.0\u00a00.0.255.255\u00a0172.16.0.0\u00a00.0.255.255</code></p> <p><code>crypto\u00a0gdoi\u00a0group\u00a0GDOI_GROUP</code> <code>identity\u00a0number\u00a0123</code> <code>server\u00a0local</code> <code>rekey\u00a0transport\u00a0unicast</code> <code>rekey\u00a0authentication\u00a0mypubkey\u00a0rsa\u00a0GDOI_KEYS</code> <code>rekey\u00a0retransmit\u00a060\u00a0number\u00a02</code> <code>sa\u00a0ipsec\u00a01</code> <code>profile\u00a0GDOI_PROFILE</code> <code>match\u00a0address\u00a0ipv4\u00a0SYMMETRIC_ACL</code> <code>replay\u00a0time\u00a0window-size\u00a05</code> <code>address\u00a0ipv4\u00a01.1.1.1</code></p> <p>Group Member</p> <p><code>crypto\u00a0isakmp\u00a0policy\u00a010</code> <code>authentication\u00a0pre-share</code></p> <p><code>crypto\u00a0isakmp\u00a0key\u00a00\u00a0SECRET\u00a0address\u00a01.1.1.1\u00a0\u00a0\u00a0#KS</code></p> <p><code>crypto\u00a0gdoi\u00a0group\u00a0GDOI_GROUP</code> <code>identity\u00a0number\u00a0123</code> <code>server\u00a0address\u00a0ipv4\u00a01.1.1.1</code></p> <p><code>crypto\u00a0map\u00a0GETVPN\u00a0local-address\u00a0Loopback\u00a00</code> <code>crypto\u00a0map\u00a0GETVPN\u00a010\u00a0gdoi</code> <code>set\u00a0group\u00a0GDOI_GROUP</code></p> <p><code>interface\u00a0Gi2</code> <code>description\u00a0To\u00a0KS</code> <code>crypto\u00a0map\u00a0GETVPN</code></p> <p>Verify</p> <p><code>show\u00a0crypto\u00a0gdoi</code> <code>show\u00a0crypto\u00a0gdoi\u00a0ks</code> <code>show\u00a0crypto\u00a0gdoi\u00a0gm</code></p> <p>COOP KS F\u00f6r redundans och lastdelning kan man ha flera KS som d\u00e5 konfigureras likadant. Generera RSA-nycklar p\u00e5 primary KS och exportera b\u00e5de public och private till alla COOP KS. Notera att p\u00e5 vissa IOS-versioner g\u00e5r det att k\u00f6ra KS och GM p\u00e5 samma enhet men det \u00e4r inte officially supported.</p> <p><code>crypto\u00a0key\u00a0export\u00a0rsa\u00a0GDOI_KEYS\u00a0pem\u00a0terminal\u00a03des\u00a0CISCO123</code> <code>crypto\u00a0key\u00a0import\u00a0rsa\u00a0GDOI_KEYS\u00a0pem\u00a0exportable\u00a0terminal\u00a0CISCO123</code></p> <p>Suite B GET VPN har st\u00f6d f\u00f6r Suite B men m\u00e5ste s\u00e4ttas upp f\u00f6r det genom att p\u00e5 KS konfigurera de s\u00e4kra algoritmer som ska anv\u00e4ndas.</p> <p><code>show\u00a0crypto\u00a0gdoi\u00a0feature\u00a0suite-b</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_IS-IS/","title":"Cisco IS-IS","text":"<p>Intermediate System-to-Intermediate System \u00e4r ett link-state routing protokoll. Det anv\u00e4nder Network Service Access Point (NSAP) adressering f\u00f6r att identifiera routrar, area-tillh\u00f6righet och deras grannskap. IS-IS anv\u00e4nder inte n\u00e5got L3-protokoll alls utan det enkapsuleras direkt i L2 multicast frames, f\u00f6r L1 anv\u00e4nds 01:80:C2:00:00:14 och f\u00f6r L2 01:80:C2:00:00:15, detta g\u00f6r det helt L3-protokolloberonde. Grannskap och adressinformation skrivs med Type-Length-Value (TLV) records, detta g\u00f6r det v\u00e4ldigt flexibelt. T.ex. om en ny adressfamilj eller ett nytt protokoll ska l\u00e4ggas till s\u00e5 handlar det om att definiera nya TLVer som inneh\u00e5ller adress- och topologiinformation. F\u00f6r lista med TLVer som IS-IS kan anv\u00e4nda se IANAs TLV Codepoints.</p> <p>IS-IS \u00e4r ett av de tre protokollen i standarden Connectionless Network Services (CLNS), de andra tv\u00e5 \u00e4r CLNP och ES-IS. Numera anv\u00e4nds det vanligare f\u00f6r IP IGP och \u00e4r bl.a. en del i klassisk MPLS Traffic Engineering. Level 3 routing \u00e4r routing mellan dom\u00e4ner (AS) och det var t\u00e4nkt att g\u00f6ras med protokollet IDRP men numera g\u00f6rs det f\u00f6rdelaktigt med BGP, som kan b\u00e4ra NSAP-adresser.</p> <p>Type: Link State</p> <p>Algorithm: Dijkstra</p> <p>AD: 115</p> <p>Protocols: IP, CLNS</p> <p>Packets: 4</p>"},{"location":"cisco/Cisco_IS-IS/#terminologi","title":"Terminologi","text":"<ul> <li>End system: host</li> <li>Intermediate system: router</li> <li>Circuit: interface</li> <li>Domain: autonomous system</li> <li>SNPA: layer 2 address</li> </ul>"},{"location":"cisco/Cisco_IS-IS/#packets","title":"Packets","text":"<p>Hello/IIH: IS-IS Hello anv\u00e4nds f\u00f6r att uppt\u00e4cka grannar och kontrollera att de lever. De skickas default var 10:e sekund och inneh\u00e5ller en lista p\u00e5 alla grannar man har p\u00e5 segmentet om det \u00e4r ett broadcastn\u00e4verk. De anv\u00e4nds ocks\u00e5 f\u00f6r att v\u00e4lja DIS (Designated IS) d\u00e4r det beh\u00f6vs. DIS skickar Hellos mer frekvent, hello time delat p\u00e5 3 s\u00e5 var 3.33 sekund default. Hold time \u00e4r Hello-interval x Hello-multiplier. Varken Hello eller Hold beh\u00f6ver matcha f\u00f6r grannskap. P\u00e5 broadcast segment anv\u00e4nds separata Hellos f\u00f6r L1 och L2 medans p\u00e5 point-to-point interface anv\u00e4nds gemensamma L1L2 Hellos pga effektivitet. Hello padding g\u00f6rs default f\u00f6r att ta reda p\u00e5 hur stora frames som kan skickas.</p>   L1 Hello:    [](/File:Cisco_ISIS_Hello_L1.png \"wikilink\")     L1L2 Hello:    [](/File:Cisco_ISIS_Hello_L1L2.png \"wikilink\")     P2P Hello: (finns ingen prio utan ist\u00e4llet finns Local Circuit ID)    [](/File:Cisco_ISIS_Hello_P2P.png \"wikilink\")   <p>Timers st\u00e4lls per interface. Default \u00e4r 10 sekunder och multiplier \u00e4r 3 f\u00f6r hold time.</p> <p><code>isis\u00a0hello-interval\u00a010\u00a0[level]</code> <code>isis\u00a0hello-multiplier\u00a03\u00a0[level]</code></p> <p>Link state PDU: LSPs anv\u00e4nds f\u00f6r att skicka routing-information till andra IS. Det finns inte olika LSP-typer som OSPF har olika LSA-typer utan adjacencies och prefixes skickas med en LSP som inneh\u00e5ller olika TLVer. En LSPs payload kan d\u00e4rmed variera i storlek. Varje LSP inneh\u00e5ller ett LSPID som g\u00f6r det unikt. Det best\u00e5r av System ID (router that originated the LSP), Pseudonode ID (DIS) och LSP number (fragment number). F\u00f6r att skilja mellan olika versioner av samma LSP s\u00e4tts \u00e4ven ett l\u00f6pnummer. Det b\u00f6rjar p\u00e5 1 och varje g\u00e5ng en \u00e4ndring g\u00f6rs \u00f6kas det med 1.</p> <p>Om Attached Biten \u00e4r satt i LSP-headern betyder det att den kommer ifr\u00e5n en nod med ben i en annan area eller L2, det finns flera \"Attached bits\" men endast default metric anv\u00e4nds p\u00e5 Cisco IOS. F\u00f6r att en L1L2 ISIS router ska s\u00e4tta ATT-biten p\u00e5 sina LSPer m\u00e5ste den vara ansluten till tv\u00e5 olika areor. Den beh\u00f6ver inte sj\u00e4lv vara directly attached till en annan area men arean m\u00e5ste finnas kopplad till L2. Varje LSP har \u00e4ven en remaining lifetime satt, det b\u00f6rjar p\u00e5 1200 sekunder och tickar ner\u00e5t. Var 900:e sekund s\u00e5 refreshar en IS-IS router sina self-originated LSPer och skickar ut dem p\u00e5nytt. G\u00e5r remaining lifetime ner till 0 p\u00e5 en LSP tas routing informationen bort fr\u00e5n LSDB och routern kommer att flooda ut endast LSP:ns header med remaining lifetime satt till 0 f\u00f6r att signalera att man vill ha ny information och p\u00e5 s\u00e5 vis ta reda p\u00e5 om n\u00e5gon annan k\u00e4nner till mer aktuell information, detta kallas LSP Purge. LSP headern h\u00e5lls kvar i LSDB s\u00e5 l\u00e4nge som ZeroAgeLifetime \u00e4r satt till, 60 sekunder default men kan sparas 20 minuter p\u00e5 Cisco-routrar.</p> <p><code>router\u00a0isis</code> <code>max-lsp-lifetime\u00a01200</code> <code>lsp-refresh-interval\u00a0900</code></p> <p>Eftersom IS-IS paket enkapsuleras direkt i L2-frames m\u00e5ste IS-IS ha en egen fragmenteringsfunktion f\u00f6r LSPer som \u00e4r st\u00f6rre \u00e4n MTU. Beh\u00f6ver man skicka en LSP vars header + TLVer \u00e4r st\u00f6rre \u00e4n MTU s\u00e5 delar routern upp det i flera LSPer som inneh\u00e5ller n\u00e5gra TLVer var. LSPerna har samma LSPID men LSP/fragment number \u00f6kas per LSP med start fr\u00e5n 0. Fragmentering g\u00f6rs av den router som skapar LSPn, n\u00e4r den sedan har skickats ut f\u00e5r den inte modifieras eller fragmenteras om. Detta leder till att MTU p\u00e5 alla interface inom arean m\u00e5ste vara identiskt. Annars f\u00e5r man manuellt st\u00e4lla lsp-storlek p\u00e5 alla enheter s\u00e5 det inte \u00f6verstiger l\u00e4gsta MTU.</p> <p><code>lsp-mtu\u00a01400</code></p>   Exempel:    [](/File:Cisco_ISIS_LSP.png \"wikilink\")   <p>Complete Sequence Numbers PDU: CSNP anv\u00e4nds f\u00f6r att synkronisera LSDB mellan enheter (fungerar ungef\u00e4r p\u00e5 samma s\u00e4tt som DD i OSPF). CSNP inneh\u00e5ller en komplett lista med alla LSPer som routern har och mottagaren kan j\u00e4mf\u00f6ra det mot sin egen LSDB. Finns det n\u00e5gon LSP som mottagaren ej har kan den requesta den och fattas det n\u00e5gon hos avs\u00e4ndaren floodas den tillbaka. Finns det fler LSPID:n \u00e4n vad MTU klarar skickas det flera paket. Varje CSNP specificerar vilka LSPID:n den inneh\u00e5ller och det b\u00f6rjar p\u00e5 0000.0000.0000.00-00 och r\u00e4knar upp\u00e5t (stigande).</p> <p>P\u00e5 point-to-point-l\u00e4nkar utbyts CSNP vid adjacency buildup och p\u00e5 broadcast skickas det regelbundet av DIS. Eftersom ack sk\u00f6ts av PSNP p\u00e5 point-to-point-l\u00e4nkar skickas inga CSNP periodiskt, detta kan man sl\u00e5 p\u00e5 manuellt med interface-kommandot isis csnp-interval    Exempel:    [](/File:Cisco_ISIS_CSNP.png \"wikilink\")   <p>Partial Sequence Numbers PDU: PSNP skickas f\u00f6r att requesta eller acka en LSP (fungerar b\u00e5de som OSPF LSR och LSAck). En PSNP kan requesta eller acka flera LSPer. P\u00e5 broadcast anv\u00e4nds dock PSNP endast f\u00f6r Request eftersom Ack g\u00f6rs av CSNP fr\u00e5n DIS.</p>   Exempel:    [](/File:Cisco_ISIS_PSNP.png \"wikilink\")"},{"location":"cisco/Cisco_IS-IS/#levels","title":"Levels","text":"<p>En IS-IS router konfigureras med niv\u00e5 som anger systemtyp - antingen Level 1, Level 2 eller Level 1-2. Se en Level 2 router som motsvarande area 0 (backbone area) i OSPF och Level 1 som en area som \u00e4r \u201dNSSA Totally Stubby \u201d, d.v.s. det enda som injiceras i arean \u00e4r en default route samt att redistribution fr\u00e5n andra routingprotokoll \u00e4r till\u00e5tet, och en Level 1-2 som en ABR.</p> <p>IS-IS routrar p\u00e5 level 1 agerar oberoende av level 2 och vice versa. De uppr\u00e4ttar separata grannskap p\u00e5 varje level. T.ex. om det finns tv\u00e5 stycken IS-IS routrar som b\u00e5da k\u00f6r L1 och L2 s\u00e5 kommer de att ha tv\u00e5 grannskap med varandra. Det blir bara grannskap om b\u00e5da \u00e4r p\u00e5 samma level, t.ex. L2 + L1L2 = L2-grannskap. De kommer \u00e4ven h\u00e5lla separata LSDBer f\u00f6r varje level. S\u00e5 Link State PDUer som skickas g\u00f6rs det antingen p\u00e5 L1 eller L2. L1-LSPer beskriver grannskap i L1 och samma g\u00e4ller f\u00f6r L2. Det g\u00e5r n\u00e4stan likna vid separata routing-processer. Att \u00e4ndra mellan L1, L2 och L1L2 g\u00f6rs per router.</p> <p><code>router\u00a0isis\u00a01</code> <code>is-type\u00a0level-1-2\u00a0\u00a0#Default</code></p> <p>Men det g\u00e5r att \u00e4ndra per interface f\u00f6r att sluta skicka Hellos f\u00f6r en specifik level. T.ex. om man sj\u00e4lv \u00e4r L1L2 och vet man att andra sidan \u00e4r en L1 only \u00e4r det on\u00f6digt att skicka L2 Hellos.</p> <p><code>interface\u00a0gi2</code> <code>isis\u00a0circuit-type\u00a0{level-1\u00a0|\u00a0level-2\u00a0|\u00a0level-1-2}</code></p> <p>Show</p> <p><code>show\u00a0isis\u00a0protocol\u00a0|\u00a0i\u00a0IS-Type</code></p> <p>Backdoor Default anv\u00e4nder L1-routrar den n\u00e4rmaste L1L2-routern som gateway of last resort. Det \u00e4r inte alltid man vill ha det s\u00e5, d\u00e5 kan man st\u00e4nga av att L1L2-routern s\u00e4tter attached bit i sina Hellos och \u00f6vriga routrar kommer inte att installera en default route till den.</p> <p><code>is-type\u00a0level-1-2\u00a0backdoor</code></p>"},{"location":"cisco/Cisco_IS-IS/#net","title":"NET","text":"<p>Network Entity Title kallas den adress som IS-IS-processer (och d\u00e4rmed noder) anv\u00e4nder, l\u00e4ngden kan variera mellan 64 och 160 bitar men det m\u00e5ste vara j\u00e4mt antal bytes. Formatet \u00e4r AFI.DSP.SystemID.NSEL:</p> <ul> <li>AFI = 49</li> <li>DSP(Area ID) = 0001</li> <li>SystemID = R\u00e4knas fram baserat p\u00e5 Loopback adressen</li> <li>NSEL = 00</li> </ul>"},{"location":"cisco/Cisco_IS-IS/#areas","title":"Areas","text":"<p>Eftersom en nod endast har en NSAP-adress tillh\u00f6r en nod och alla dens interface samma area (det g\u00e5r att konfigurera upp till 3 NSAP-adresser men det \u00e4r endast anv\u00e4ndbart under splitting/joining/renumbering areor och det skapas bara en mergead LSDB och SystemID m\u00e5ste vara samma). Tv\u00e5 L1-noder med olika areor uppr\u00e4ttar inte grannskap medans L2 inte bryr sig om area-ID. B\u00e5de L1 och L2 annonserar sina directly connected IP networks till sina grannar. \u00c4r en nod L1L2 redistribueras alla routes fr\u00e5n L1 till L2 medans \u00e5t andra h\u00e5llet g\u00e5r endast en default route default. Detta leder till att backbone k\u00e4nner till alla routes.</p>"},{"location":"cisco/Cisco_IS-IS/#natverkstyp","title":"N\u00e4tverkstyp","text":"<p>Till skillnad fr\u00e5n OSPF finns det endast tv\u00e5 n\u00e4tverkstyper, broadcast och point-to-point. P\u00e5 broadcast-segment har man en pseudonod som alla formar grannskap med, denna kallas Designated IS och \u00e4r motsvarigheten till DR i OSPF. Man l\u00e5ter en enhet st\u00e5 f\u00f6r LSP f\u00f6r segmentet annars blir LSDB st\u00f6rre och r\u00f6rigare. Dock \u00e4r det skillnad p\u00e5 hur flooding fungerar. Alla uppdaterar alla vilket leder till att det inte beh\u00f6vs n\u00e5gon \"Backup\" DIS. DIS floodar periodvis sin databas och finns det d\u00e5 med n\u00e5gon LSP som en IS inte har f\u00e5tt m\u00e4rker den det och beg\u00e4r att f\u00e5 den av DIS. Detta leder ocks\u00e5 till att DIS kan ers\u00e4ttas preemptively vilket inte OSPF DR kan.</p> <p>Den som v\u00e4ljs till DIS \u00e4r den med h\u00f6gst prio (default 64), vid lika \u00e4r h\u00f6gsta MAC-adress tie breaker.</p> <p><code>interface\u00a0gi2</code> <code>isis\u00a0priority\u00a0100</code> <code>show\u00a0clns\u00a0interface\u00a0|\u00a0i\u00a0DR</code></p>"},{"location":"cisco/Cisco_IS-IS/#metrics","title":"Metrics","text":"<p>IS-IS anv\u00e4nder bandwidth som metric precis som OSPF. Fr\u00e5n b\u00f6rjan fanns det 4 olika metric-typer men i princip \u00e4r det endast default (bandwidth) som anv\u00e4nds idag. Default s\u00e5 f\u00e5r alla interface en cost av 10 oavsett bandbredd. Med andra ord s\u00e5 r\u00e4knar inte routern ut cost p\u00e5 en l\u00e4nk s\u00e5 som andra routing protokoll g\u00f6r utan det \u00e4r upp till administrat\u00f6ren att manuellt st\u00e4lla metric per interface om man vill. Likt OSPF \u00e4r det inte metric som i f\u00f6rsta hand j\u00e4mf\u00f6rs vid path selection utan det \u00e4r typ av route d\u00e4r L1 &gt; L2 &gt; external. Nedan visas det som kallas narrow metrics, det \u00e4r legacy och \u00e4r inte default p\u00e5 Cisco-routrar.</p> <p><code>isis\u00a0metric\u00a01-63</code></p> <p>Wide metrics togs fram f\u00f6r att man hade behov av st\u00f6rre metrics och det har 24-bitars l\u00e4ngd. Detta \u00e4r alltid rekommenderat men alla enheter inom arean m\u00e5ste st\u00f6dja det. T.ex. kr\u00e4vs det f\u00f6r MPLS traffic engineering \u00f6ver IS-IS.</p> <p><code>router\u00a0isis</code> <code>metric-style\u00a0wide</code></p> <p>Det g\u00e5r \u00e4ven att acceptera b\u00e5da typerna av metric.</p> <p><code>metric-style\u00a0transition</code></p> <p>Verify</p> <p><code>R1#\u00a0show\u00a0isis\u00a0protocol\u00a0|\u00a0i\u00a0metrics</code> <code>Generate\u00a0narrow\u00a0metrics:\u00a0none</code> <code>Accept\u00a0narrow\u00a0metrics:\u00a0\u00a0\u00a0none</code> <code>Generate\u00a0wide\u00a0metrics:\u00a0\u00a0\u00a0level-1-2</code> <code>Accept\u00a0wide\u00a0metrics:\u00a0\u00a0\u00a0\u00a0\u00a0level-1-2</code></p>"},{"location":"cisco/Cisco_IS-IS/#konfiguration","title":"Konfiguration","text":"<p>Om man ska k\u00f6ra med flera areor p\u00e5 en enhet m\u00e5ste man ange tag f\u00f6r varje IS-IS-process. Den f\u00f6rsta IS-IS instansen som konfigureras blir default L1L2 och d\u00e4refter blir instanser L1. Det finns \u00e4ven RFC f\u00f6r defaultv\u00e4rden f\u00f6r att underl\u00e4tta interoperability (RFC 8196).</p> <p><code>router\u00a0isis\u00a0[tag]</code> <code>is-type\u00a0level-1-2</code> <code>log-adjacency-changes</code> <code>net\u00a049.0001.0001.0001.0001.0001.00</code></p> <p><code>address-family\u00a0ipv4\u00a0unicast</code> <code>exit</code> <code>address-family\u00a0ipv6\u00a0unicast</code> <code>exit</code></p> <p>Passive interfaces, med passive interface default annonseras allt som \u00e4r directly connected i isis men inga grannskap byggs f\u00f6rrens man tar bort passive p\u00e5 n\u00e5got interface. Det \u00e4r \u00e4ven med passive interfaces man g\u00f6r prefix suppression.</p> <p><code>passive-interface\u00a0default</code> <code>no\u00a0passive-interface\u00a0te0/1/1</code></p> <p><code>passive-interface\u00a0lo0</code> <code>advertise\u00a0passive-only</code></p> <p>F\u00f6r att skicka en default route i level 2</p> <p><code>default-information\u00a0originate</code></p> <p>Verify</p> <p><code>show\u00a0isis</code> <code>show\u00a0isis\u00a0database</code></p> <p>Default konfiguration n\u00e4r man drar ig\u00e5ng IS-IS (kan skilja mellan IOS-versioner).</p> <p><code>router\u00a0isis</code> <code>no\u00a0protocol\u00a0shutdown</code> <code>max-area-addresses\u00a03</code> <code>no\u00a0fast-flood</code> <code>adjacency-check</code> <code>no\u00a0use\u00a0external-metrics</code> <code>metric\u00a010\u00a0level-1</code> <code>metric\u00a010\u00a0level-2</code> <code>hello\u00a0padding</code> <code>no\u00a0nsf\u00a0cisco</code> <code>no\u00a0nsf\u00a0ietf</code> <code>maximum-paths\u00a04\u00a0\u00a0#Max\u00a0\u00e4r\u00a032</code> <code>distance\u00a0115\u00a0ip</code> <code>no\u00a0bfd\u00a0all-interface</code> <code>no\u00a0bfd\u00a0check-ctrl-plane-failure</code></p> <p>V\u00e4nta med att anv\u00e4nda en granne som nyss har bootat.</p> <p><code>set-overload-bit\u00a0on-startup\u00a0180</code></p> <p>MPLS MPLS LDP kan autokonfigureras med hj\u00e4lp av IS-IS. Man kan \u00e4ven synka IS-IS mot LDP, dvs l\u00e5ta LDP bli klar innan l\u00e4nken f\u00e5r en normal (l\u00e5g) IGP-metric och d\u00e4rmed b\u00f6rjar anv\u00e4ndas.</p> <p><code>mpls\u00a0ldp\u00a0autoconfig</code> <code>mpls\u00a0ldp\u00a0sync</code></p> <p><code>show\u00a0isis\u00a0mpls\u00a0ldp</code></p> <p>IS-IS kan \u00e4ven anv\u00e4ndas f\u00f6r Segment Routing med MPLS.</p>"},{"location":"cisco/Cisco_IS-IS/#adjacency","title":"Adjacency","text":"<p>Enablea IS-IS p\u00e5 interface. Interface MTU m\u00e5ste matcha f\u00f6r grannskap. Grannar m\u00e5ste \u00e4ven vara i samma IP subnet f\u00f6r att adjacency ska g\u00e5 upp, detta beh\u00f6vdes inte f\u00f6rr men nu \u00e4r checken p\u00e5 default. G\u00e5r inte grannskap upp kan det ocks\u00e5 bero p\u00e5 duplicate system ID men det s\u00e4ger loggen tydligt.</p> <p><code>interface\u00a0te0/1/1</code> <code>ip\u00a0router\u00a0isis\u00a01</code> <code>no\u00a0isis\u00a0hello\u00a0padding</code> <code>isis\u00a0network\u00a0point-to-point\u00a0\u00a0#effektivisera\u00a0LSP-hantering</code> <code>no\u00a0shut</code></p> <p>Verify</p> <p><code>show\u00a0isis\u00a0hostname</code> <code>show\u00a0isis\u00a0neighbors/adjacency</code> <code>show\u00a0isis\u00a0topology</code> <code>show\u00a0clns\u00a0neighbor</code></p>"},{"location":"cisco/Cisco_IS-IS/#authentication","title":"Authentication","text":"<p>IS-IS authentication skiljer sig ganska mycket fr\u00e5n authentication med \u00f6vriga IGP:er. Authentication f\u00f6r Hellos g\u00f6rs frist\u00e5ende fr\u00e5n \u00f6vriga pakettyper. Authentication g\u00f6rs med en TLV och en LSP f\u00e5r ej modifieras av n\u00e5gon annan \u00e4n originator, detta medf\u00f6r att alla inom arean m\u00e5ste ha samma authentication p\u00e5 sina LSP/CSNP/PSNP men det blir inget krav p\u00e5 Hellos. S\u00e5l\u00e4nge Hello-paket autentiseras korrekt kommer grannskap att bli Up men det beh\u00f6ver inte betyda att LSP:er kan utbytas utan d\u00e5 m\u00e5ste som sagt area/domain password matcha. Authentication kan g\u00f6ras med clear text eller md5. Anv\u00e4nder man en key chain s\u00e5 skickas heller inte key id med.</p> <p>Hello-paket g\u00f6rs per interface oavsett level.</p> <p><code>interface\u00a0gi2</code> <code>isis\u00a0authentication\u00a0mode\u00a0md5</code> <code>isis\u00a0authentication\u00a0key-chain</code> <p>LSP authentication</p> <p><code>router\u00a0isis\u00a01</code> <code>authentication\u00a0mode\u00a0md5</code> <code>authentication\u00a0key-chain</code>"},{"location":"cisco/Cisco_IS-IS/#redistribution","title":"Redistribution","text":"<p>Routes som redistribueras in i IS-IS f\u00e5r default metric 0. En viktig faktor f\u00f6r route leaking i ISIS \u00e4r U/D-biten i TLV:n f\u00f6r routen. Den fyller samma funktion som Down-biten i OSPF, den anv\u00e4nds f\u00f6r att f\u00f6rhindra loopar. En L1L2-router som via L1 f\u00e5r in routes med U/D-biten satt kommer inte att skicka in den till L2.</p> <p>Redistribution into level 2. Redistribution into level 1</p> <p><code>redistribute\u00a0static\u00a0ip</code> <code>redistribute\u00a0static\u00a0ip\u00a0level-1</code></p> <p><code>show\u00a0isis\u00a0ip\u00a0rib\u00a0redistribution</code></p> <p>Man kan l\u00e4cka L2 routes till L1 med hj\u00e4lp av redistribution.</p> <p><code>redistribute\u00a0isis\u00a01\u00a0ip\u00a0level-2\u00a0into\u00a0level-1\u00a0distribute-list</code><code>ACL</code></p>"},{"location":"cisco/Cisco_IS-IS/#summary","title":"Summary","text":"<p>N\u00e4r routes g\u00e5r mellan areor eller redistribueras kan man summera (likt OSPF).</p> <p><code>summary-address\u00a010.1.0.0\u00a0255.255.0.0\u00a0[level]</code></p> <ul> <li>level-1: endast routes redistribuerade in i Level 1 summeras.</li> <li>level-1-2: routes redistribuerade in i Level 1 summeras och routes     fr\u00e5n Level 1 routing eller redistribution summeras in i Level 2     backbone.</li> <li>level-2: routes fr\u00e5n Level 1 routing eller redistribution summeras     in i Level 2 backbone.</li> </ul>"},{"location":"cisco/Cisco_IS-IS/#ipv6","title":"IPv6","text":"<p>IS-IS \u00e4r oberoende av L3-protokoll f\u00f6r grannskap och kan b\u00e4ra information om destinationer f\u00f6r olika adressfamiljer. IPv6 prefix kan skickas med samma IS-IS-process, i samma LSP:er \u00f6ver samma grannskap som IPv4 och samma L1/L2-f\u00f6rh\u00e5llanden g\u00e4ller d\u00e5 f\u00f6r IPv6. Det man d\u00e4remot b\u00f6r ha koll p\u00e5 \u00e4r om IPv4 och IPv6 ska anv\u00e4nda samma topologi eller ej, ska man k\u00f6ra single topology kr\u00e4vs en 1:1-korrelation mellan IPv4 och IPv6 interface (dvs dual stack \u00f6verallt) och d\u00e5 kommer det endast g\u00f6ras en SPF-ber\u00e4kning. Adjacency checken som \u00e4r p\u00e5 default rejectar Hellos fr\u00e5n grannar som inte k\u00f6r IPv6. Ska man k\u00f6ra multi topology beh\u00f6ver man inte ha dual stack \u00f6verallt, SPF ber\u00e4knas frist\u00e5ende per protokoll och man m\u00e5ste anv\u00e4nda wide metrics. Det konfigureras under adressfamiljen. Man kan \u00e4ven k\u00f6ra multi-topology under en transitionsperiod, d\u00e5 accepterar och genererar man b\u00e5de IS-IS IPv6 och Multi-topology IPv6 TLVs.</p> <p>Den mesta av konfigurationen g\u00f6rs under adressfamiljen, till skillnad fr\u00e5n IPv4. IS-IS kommer att skicka vidare IPv6-information men ej b\u00f6rja anv\u00e4nda det f\u00f6rens man lagt in address-family ipv6.</p> <p><code>router\u00a0isis\u00a01</code> <code>address-family\u00a0ipv6\u00a0unicast</code> <code>multi-topology\u00a0[transition]</code> <code>maximum-paths\u00a016</code> <code>exit</code></p> <p>Verify</p> <p><code>show\u00a0ipv6\u00a0route\u00a0isis</code> <code>show\u00a0isis\u00a0ipv6\u00a0topology\u00a0\u00a0#Multi\u00a0topology</code> <code>show\u00a0isis\u00a0ipv6\u00a0rib</code></p>"},{"location":"cisco/Cisco_IS-IS/#convergence","title":"Convergence","text":"<p>Timers</p> <p><code>lsp-gen-interval\u00a05\u00a050\u00a050</code> <code>prc-interval\u00a05\u00a050\u00a050</code> <code>spf-interval\u00a05\u00a050\u00a050</code></p> <p>Nonstop Forwarding N\u00e4r en router g\u00f6r en RP switchover m\u00e5ste den nya snabbt f\u00e5 all info om adjacencies och en synkad LSDB. IS-IS NSF kan m\u00f6jlig\u00f6ras p\u00e5 tv\u00e5 s\u00e4tt.</p> <ul> <li>IETF (RFC 3847): NSF-kapabla enheter skickar IS-IS NSF restart     requests till grannarna som \u00e4r NSF-aware. D\u00e5 f\u00f6rst\u00e5r de att de inte     ska starta om grannskapet utan ist\u00e4llet initiera en     LSDB-synkronisering. Grannarna m\u00e5ste ha st\u00f6d f\u00f6r NSF IETF.</li> <li>Cisco: Skickar b\u00e5de protocol adjacency och link-state information     fr\u00e5n aktiv RP till standby. Detta \u00e4r inte beroende av att grannarna     \u00e4r NSF-aware.</li> </ul> <p>BFD N\u00e4r IS-IS konfigureras med BFD blir det ett registrerat protokoll till BFD och kan dra nytta av de forwarding path detection failure messages som BFD tillhandah\u00e5ller. Det kan antingen konfigureras under adressfamiljen eller per interface.</p> <p><code>int\u00a0te0/1/1</code> <code>bfd\u00a0interval\u00a050\u00a0min_rx\u00a050\u00a0multiplier\u00a05</code> <code>isis\u00a0bfd</code></p> <p>IS-IS-klienten kan \u00e4ven utnyttja BFD C-biten f\u00f6r att veta om det \u00e4r ett \u00e4kta data plane failure eller om det \u00e4r resultatet av ett control plane failure t.ex. pga reboot, detta \u00e4r p\u00e5 default.</p> <p><code>router\u00a0isis</code> <code>bfd\u00a0check-control-plane-failure</code></p> <p>iSPF SPF-algoritmen beh\u00f6ver inte k\u00f6ras f\u00f6r alla l\u00e4nkar varje g\u00e5ng det sker en topologi-f\u00f6r\u00e4ndring. Med incremental SPF k\u00f6rs endast algoritmen f\u00f6r de delar som har p\u00e5verkats av f\u00f6r\u00e4ndringen f\u00f6r att spara CPU-cykler. Detta g\u00e5r att styra individuellt p\u00e5 enheterna med ispf-kommandot. Det kan vara sv\u00e5rt att veta exakt hur mycket skillnad detta g\u00f6r men generellt ju st\u00f6rre topologi ju st\u00f6rre skillnad. OBS iSPF \u00e4r inte l\u00e4ngre supporterat i IOS.</p> <p><code>router\u00a0isis\u00a01</code> <code>ispf\u00a0level-1-2\u00a010</code> <code>show\u00a0isis\u00a0protocol\u00a0|\u00a0i\u00a0Incremental</code></p> <p>Fast flood Man kan v\u00e4lja att LSP:er ska floodas innan SPF-ber\u00e4kningen p\u00e5b\u00f6rjas f\u00f6r att f\u00e5 snabbare konvergenstid. Detta \u00e4r ej p\u00e5slaget default.</p> <p><code>router\u00a0isis\u00a01</code> <code>fast-flood</code></p>"},{"location":"cisco/Cisco_IS-IS/#loop-free-alternate-fast-reroute","title":"Loop-Free Alternate Fast Reroute","text":"<p>Med IP LFA FRR kommer IS-IS ber\u00e4kna loop-fria next-hop routes till forwarding plane som kan anv\u00e4ndas om primary path g\u00e5r ner. Detta ber\u00e4knas per prefix. LFA \u00e4r en next-hop route som skickar paketet till destination utan att loopa tillbaka det. LFA g\u00f6r ingen signaling utan lokal router r\u00e4knar sj\u00e4lv.</p> <ul> <li>P: de noder man kan n\u00e5 utan att g\u00e5 igenom l\u00e4nken man vill skydda</li> <li>Q: de noder som kan n\u00e5 destination utan att g\u00e5 igenom l\u00e4nken man     vill skydda</li> </ul> <p>Finns det inga PQ f\u00e5r man extenda P space genom att kolla P noder utifr\u00e5n dina grannar.</p> <p>Remote LFA Med IS-IS remote LFA FRR kan man skapa backup paths som \u00e4r flera hop bort, dvs man man tunnlar det till en drop off point som sedan skickar till slutdestination. Det man g\u00f6r i praktiken \u00e4r att tunnla till n\u00e4rmasta PQ. Detta \u00e4r t.ex. anv\u00e4ndbart i ringtopologier. IS-IS st\u00f6djer detta endast n\u00e4r ocks\u00e5 targeted LDP st\u00f6ds. LFA-ber\u00e4kningar \u00e4r begr\u00e4nsade till interface/l\u00e4nkar som tillh\u00f6r samma area och level. Finns det multipla LFAs f\u00f6r en primary path s\u00e5 kommer IS-IS att anv\u00e4nda en tiebreaking rule f\u00f6r att v\u00e4lja en LFA och finns det multipla LFA paths s\u00e5 kommer prefixen att distribueras j\u00e4mt mellan dem. Eftersom IS-IS kollar p\u00e5 prefixen efter att SPF har k\u00f6rts kan best repair path h\u00e5llas efter att grannen har k\u00f6rt SPF. N\u00e4r man sl\u00e5r p\u00e5 remote LFA enableas microloop avoidance med delay 5000 ms. Alla IS-IS interface m\u00e5ste vara point-to-point.</p> <p><code>router\u00a0isis\u00a01</code> <code>fast-reroute\u00a0remote-lfa\u00a0level-2\u00a0mpls-ldp</code></p> <p><code>show\u00a0isis\u00a0fast-reroute\u00a0remote-lfa\u00a0tunnels</code></p> <p>TI-LFA Med Topology Independent LFA f\u00e5r man alltid post-konvergens routen och den \u00e4r garanterat loopfri med 100% coverage. Syftet med TI-LFA \u00e4r att garantera link protection i symmetric metric networks (t.ex. ringn\u00e4t), skydda IP och MPLS-trafik samt undvika congestion och suboptimal routing genom att undvika high metric links. TI-LFA anv\u00e4nder inte targeted LDP utan det bygger p\u00e5 Segment Routing.</p> <p><code>router\u00a0isis\u00a01</code> <code>segment-routing\u00a0mpls</code> <code>ip\u00a0route\u00a0priority\u00a0high\u00a0tag\u00a01000</code> <code>fast-reroute\u00a0per-prefix\u00a0level-2\u00a0all</code> <code>fast-reroute\u00a0ti-lfa\u00a0level-2</code></p> <p>Verify</p> <p><code>show\u00a0isis\u00a0fast-reroute\u00a0summary</code> <code>show\u00a0isis\u00a0fast-reroute\u00a0interfaces</code> <code>show\u00a0isis\u00a0fast-reroute\u00a0ti-lfa\u00a0tunnel</code> <code>show\u00a0ip\u00a0route\u00a0repair-paths</code></p>"},{"location":"cisco/Cisco_IS-IS/#nx-os","title":"NX-OS","text":"<p>Grundkonfiguration</p> <p><code>feature\u00a0isis</code></p> <p><code>router\u00a0isis\u00a0IS</code> <code>net\u00a049.0001.0001.0001.0001.0002.00</code> <code>is-type\u00a0level-1</code> <code>passive-interface\u00a0default\u00a0level-1</code> <code>log-adjacency-changes</code></p> <p><code>address-family\u00a0ipv4\u00a0unicast</code> <code>exit</code></p> <p>NX-OS, n\u00e5gra defaults</p> <p><code>router\u00a0isis\u00a0IS</code> <code>graceful-restart</code> <code>maximum-paths\u00a08</code> <code>max-lsp-lifetime\u00a01200</code> <code>lsp-mtu\u00a01492</code> <code>reference-bandwidth\u00a040\u00a0Gbps</code></p> <p>Fast convergence</p> <p><code>spf-interval\u00a0level-2\u00a05000\u00a050\u00a050</code> <code>lsp-gen-interval\u00a0level-2\u00a05000\u00a050\u00a050</code></p> <p>Authentication</p> <p><code>authentication-type\u00a0md5\u00a0level-2</code> <code>authentication\u00a0key-chain</code><code>level-2</code> <p>V\u00e4nta med att anv\u00e4nda en granne som nyss har bootat.</p> <p><code>set-overload-bit\u00a0on-startup\u00a0180</code></p> <p>Interface</p> <p><code>int\u00a0lo0</code> <code>ip\u00a0router\u00a0isis\u00a0IS</code></p> <p><code>interface\u00a0e1/1</code> <code>no\u00a0switchport</code> <code>ip\u00a0router\u00a0isis\u00a0IS</code> <code>no\u00a0isis\u00a0passive-interface\u00a0level-2</code> <code>no\u00a0isis\u00a0hello-padding</code> <code>isis\u00a0network\u00a0point-to-point</code> <code>isis\u00a0authentication-type\u00a0md5\u00a0level-2</code> <code>isis\u00a0authentication\u00a0key-chain</code><code>level-2</code> <p>Genom att anv\u00e4nda network type p2p effektiviserar man LSP-hanteringen. Det g\u00e5r \u00e4ven att anv\u00e4nda kommandot \"medium p2p\" f\u00f6r att uppn\u00e5 detta.</p> <p>BFD</p> <p><code>feature\u00a0bfd</code> <code>interface\u00a0e1/1</code> <code>bfd\u00a0interval\u00a050\u00a0min_rx\u00a050\u00a0multiplier\u00a03</code> <code>no\u00a0bfd\u00a0echo</code> <code>isis\u00a0bfd</code></p>"},{"location":"cisco/Cisco_IS-IS/#ios-xr","title":"IOS-XR","text":"<p>IOS-XR IS-IS k\u00f6r default i Multi Topology mode.</p> <p><code>router\u00a0isis\u00a01</code> <code>set-overload-bit\u00a0on-startup\u00a0180</code> <code>is-type\u00a0level-2-only</code> <code>net\u00a049.0000.0000.0011.00</code> <code>nsr</code> <code>nsf\u00a0cisco</code> <code>log\u00a0adjacency\u00a0changes</code> <code>lsp-refresh-interval\u00a065000</code> <code>max-lsp-lifetime\u00a065535</code> <code>lsp-password\u00a0keychain\u00a0ISIS-KEY</code> <code>address-family\u00a0ipv4\u00a0unicast</code> <code>metric-style\u00a0wide</code> <code>advertise\u00a0passive-only</code> <code>!</code> <code>address-family\u00a0ipv6\u00a0unicast</code> <code>metric-style\u00a0wide</code> <code>advertise\u00a0passive-only</code> <code>!</code> <code>interface\u00a0Loopback0</code> <code>passive</code> <code>address-family\u00a0ipv4\u00a0unicast</code> <code>!</code> <code>address-family\u00a0ipv6\u00a0unicast</code> <code>!</code> <code>interface\u00a0TenGigE0/0/0/10</code> <code>point-to-point</code> <code>hello-password\u00a0keychain\u00a0ISIS-KEY</code> <code>address-family\u00a0ipv4\u00a0unicast</code> <code>fast-reroute\u00a0per-prefix</code> <code>fast-reroute\u00a0per-prefix\u00a0ti-lfa</code> <code>metric\u00a0100</code></p> <p>LFA router isis 1</p> <p><code>interface\u00a0GigabitEthernet0/0/0/0</code> <code>address-family\u00a0ipv4\u00a0unicast</code> <code>fast-reroute\u00a0per-prefix</code> <code>fast-reroute\u00a0per-prefix\u00a0ti-lfa</code> <code>address-family\u00a0ipv6\u00a0unicast</code> <code>fast-reroute\u00a0per-prefix</code> <code>fast-reroute\u00a0per-prefix\u00a0ti-lfa</code></p> <p>IOS-XR har \u00e4ven per-link LFA men det finns egentligen inget use case f\u00f6r det l\u00e4ngre. Default m\u00e4rker ISIS /32-prefix som Medium priority och allt annat som Low priority.</p> <p><code>show\u00a0isis\u00a0fast-reroute\u00a0summary</code> <code>show\u00a0cef\u00a0fast-reroute</code></p> <p>Prefix Prioritization</p> <p><code>router\u00a0isis\u00a01</code> <code>address-family\u00a0ipv4\u00a0unicast</code> <code>spf\u00a0prefix-priority\u00a0level\u00a02\u00a0high\u00a0tag\u00a0100</code> <code>!</code> <code>interface\u00a0Loopback0</code> <code>address-family\u00a0ipv4\u00a0unicast</code> <code>tag\u00a0100</code></p> <p>N\u00e4r man konfigurerar n\u00e5gra prefix med high priority s\u00e5 f\u00e5r alla andra prefix (inklusive /32) low priority.</p> <p>SRLG</p> <p><code>srlg</code> <code>interface\u00a0GigabitEthernet0/0/0/1</code> <code>8\u00a0value\u00a010</code> <code>!</code> <code>interface\u00a0GigabitEthernet0/0/0/2</code> <code>8\u00a0value\u00a010</code> <code>!</code> <code>router\u00a0isis\u00a01</code> <code>address-family\u00a0ipv4\u00a0unicast</code> <code>fast-reroute\u00a0per-prefix\u00a0tiebreaker\u00a0srlg-disjoint\u00a0index\u00a040</code> <code>fast-reroute\u00a0per-prefix\u00a0tiebreaker\u00a0lowest-backup-metric\u00a0index\u00a050</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_L2VPN/","title":"Cisco L2VPN","text":"<p>Provider-provisioned Layer-2 Virtual Private Network. Att str\u00e4cka L2 \u00e4r aldrig h\u00e4ftigt men man f\u00e5r g\u00f6ra s\u00e5 gott man kan med STP alternativt ha routrar direkt p\u00e5 andra sidan. Se \u00e4ven Cisco MPLS.</p>"},{"location":"cisco/Cisco_L2VPN/#ethernet-virtual-circuit","title":"Ethernet Virtual Circuit","text":"<p>Att binda en kund eller tj\u00e4nst till en port eller VLAN var en begr\u00e4nsande faktor i access-lagret. D\u00e4rf\u00f6r togs EVC framework fram f\u00f6r att komma f\u00f6rbi det. Det \u00e4r en unified software infrastructure f\u00f6r att konfigurera Ethernet services. Tanken \u00e4r att l\u00e5ta access circuits mappas till flera olika typer av Ethernet-tj\u00e4nster s\u00e5 som L2 point-to-point local connects, L2 point-to-point xconnects, L2 multipoint-to-multipoint VPLS och andra tj\u00e4nster. Man kan genom att v\u00e4lja encapsulation \u00e4ven vlan-tagga, dubbel-tagga eller skriva om vlan-tag.</p> <p><code>interface\u00a0GigabitEthernet2</code> <code>no\u00a0ip\u00a0address</code> <code>service\u00a0instance\u00a010\u00a0ethernet</code> <code>encapsulation\u00a0default</code> <code>xconnect\u00a019.19.19.19\u00a0219\u00a0encapsulation\u00a0mpls</code></p> <p>Verification</p> <p><code>show\u00a0ethernet\u00a0service\u00a0instance\u00a0summary</code> <code>show\u00a0ethernet\u00a0service\u00a0instance\u00a0id\u00a010\u00a0interface\u00a0gig2\u00a0detail</code> <code>show\u00a0l2vpn\u00a0service\u00a0all</code></p> <p>BFD bfd-template multi-hop MH</p> <p><code>interval\u00a0min-tx\u00a0200\u00a0min-rx\u00a0200\u00a0multiplier\u00a03</code> <code>bfd\u00a0map\u00a0ipv4\u00a01.1.1.0/24\u00a01.1.1.1/32\u00a0MH</code></p> <p><code>pseudowire-class\u00a0MPLS-BFD</code> <code>encapsulation\u00a0mpls</code> <code>monitor\u00a0peer\u00a0bfd\u00a0local\u00a0interface\u00a0Loopback0</code></p>"},{"location":"cisco/Cisco_L2VPN/#vpls","title":"VPLS","text":"<p>Virtual Private LAN Service (VPLS) \u00e4r ett s\u00e4tt att tillhandah\u00e5lla Ethernet-baserad multipoint-to-multipoint-kommunikation \u00f6ver IP eller MPLS. Multipla siter kopplas ihop med hj\u00e4lp av full mesh pseudowires. VPLS anv\u00e4nder Virtual Forwarding Instance (VFI) f\u00f6r att hosta alla pseudowires f\u00f6r en tj\u00e4nst. Den vanligaste b\u00e4raren \u00e4r MPLS och f\u00f6r control plane (Auto-Discovery/Signaling) kan LDP eller BGP anv\u00e4ndas. Det finns inbyggd loop prevention i form av att frames som kommer ifr\u00e5n en VPLS aldrig f\u00e5r skickas vidare inom VPLS (split-horizon). En begr\u00e4nsande faktor f\u00f6r VPLS \u00e4r minnesm\u00e4ngden p\u00e5 Edge devices eftersom de m\u00e5ste l\u00e4ra sig kundens MAC-adresser. All MAC Learning \u00e4r data plane driven. Det fungerar som en vanlig bridge dvs det \u00e4r dynamiskt och baserat p\u00e5 source MAC. By default s\u00e5 age:ar VFI:er ut inaktiva MAC-adresser efter 5 minuter.</p> <p>Manual VPLS, legacy syntax. Bridge domain anv\u00e4nds f\u00f6r mac learning samt att binda ihop Ethernet UNI med LSP. Man kan ej blanda gammal och ny syntax pga att bridge-domain betyder olika beroende p\u00e5 config context.</p> <p><code>l2\u00a0vfi\u00a0VPLS\u00a0manual</code> <code>vpn\u00a0id\u00a0100</code> <code>bridge-domain\u00a01</code> <code>neighbor\u00a010.0.0.2\u00a0encapsulation\u00a0mpls</code> <code>neighbor\u00a010.0.0.3\u00a0encapsulation\u00a0mpls</code></p> <p><code>interface\u00a0gi2</code> <code>service\u00a0instance\u00a010\u00a0ethernet</code> <code>encapsulation\u00a0default</code> <code>bridge-domain\u00a01</code></p> <p>Bridge Domain Centric (preferred syntax). Full mesh scaling \u00e4r ett administrativt problem oavsett syntax.</p> <p><code>l2vpn\u00a0vfi\u00a0context\u00a0VPLS</code> <code>vpn\u00a0id\u00a0100</code> <code>member\u00a010.0.0.2\u00a0encapsulation\u00a0mpls</code> <code>member\u00a010.0.0.3\u00a0encapsulation\u00a0mpls</code> <code>member\u00a010.0.0.4\u00a0encapsulation\u00a0mpls</code></p> <p><code>interface\u00a0gi2</code> <code>service\u00a0instance\u00a010\u00a0ethernet</code> <code>encapsulation\u00a0default</code></p> <p><code>bridge-domain\u00a01</code> <code>mac\u00a0limit\u00a0maximum\u00a0addresses\u00a050</code> <code>member\u00a0gi2\u00a0service-instance\u00a010</code> <code>member\u00a0vfi\u00a0VPLS</code></p> <p>Verify</p> <p><code>show\u00a0l2vpn\u00a0vfi</code> <code>show\u00a0bridge-domain</code> <code>show\u00a0l2vpn\u00a0service\u00a0all</code> <code>show\u00a0mpls\u00a0l2transport\u00a0vc</code> <code>show\u00a0mpls\u00a0forwarding-table\u00a0|\u00a0i\u00a0l2ckt</code></p> <p>Man kan \u00e4ven koppla in L3-interface p\u00e5 sin bridge-domain.</p> <p><code>interface\u00a0BDI1</code> <code>ip\u00a0address\u00a0172.20.0.10\u00a0255.255.255.0</code></p>"},{"location":"cisco/Cisco_L2VPN/#bgp-autodiscovery","title":"BGP Autodiscovery","text":"<p>LDP based VPLS med BGP Autodiscovery (RFC 4762). BGP anv\u00e4nds f\u00f6r att uppt\u00e4cka VPLS-endpoints automatiskt f\u00f6r varje VPN och VC-grannar konfigureras ej maneullt. Varje VPLS f\u00e5r en egen rd och detta g\u00e5r att anv\u00e4nda i kombination med route reflector.</p> <p><code>l2vpn\u00a0vfi\u00a0context\u00a0VPLS</code> <code>vpn\u00a0id\u00a0100</code> <code>autodiscovery\u00a0bgp\u00a0signaling\u00a0ldp</code> <code>auto-route-target\u00a0\u00a0#p\u00e5\u00a0default</code></p> <p><code>router\u00a0bgp\u00a0100</code> <code>address-family\u00a0l2vpn\u00a0vpls</code> <code>neighbor\u00a01.1.1.1\u00a0activate</code> <code>neighbor\u00a01.1.1.1\u00a0send-comunity\u00a0extended</code></p> <p>Verify</p> <p><code>show\u00a0bgp\u00a0l2vpn\u00a0vpls\u00a0all\u00a0summary</code></p> <p>BGP based VPLS med BGP Autodiscovery (RFC 4761). BGP anv\u00e4nds f\u00f6r att uppt\u00e4cka VPLS-endpoints men ocks\u00e5 f\u00f6r att signalera labels. Man m\u00e5ste suppress ldp signaling f\u00f6r att sl\u00e5 p\u00e5 bgp signaling.</p> <p><code>l2vpn\u00a0vfi\u00a0context\u00a0VPLS</code> <code>vpn\u00a0id\u00a0100</code> <code>autodiscovery\u00a0bgp\u00a0signaling\u00a0bgp</code> <code>ve\u00a0id\u00a011\u00a0\u00a0#unik\u00a0per\u00a0VPLS\u00a0Edge\u00a0device</code></p> <p><code>router\u00a0bgp\u00a0100</code> <code>address-family\u00a0l2vpn\u00a0vpls</code> <code>neighbor\u00a01.1.1.1\u00a0suppress-signaling-protocol\u00a0ldp</code></p> <p>Verify</p> <p><code>show\u00a0bgp\u00a0l2vpn\u00a0vpls\u00a0all</code></p>"},{"location":"cisco/Cisco_L2VPN/#h-vpls","title":"H-VPLS","text":"<p>VPLS skalar inte superbra eftersom det kr\u00e4ver full-mesh, detta g\u00e5r att bygga ut med Hierarchical VPLS. Det man g\u00f6r d\u00e5 \u00e4r att koppla ihop flera VPLS och st\u00e4nga av split horizon vid intersektionerna. Notera att Split-Horizon endast har effekt p\u00e5 Core Facing pseudowires (mesh pseudowires) och inte Spoke pseudowires. Trafik ifr\u00e5n Spoke kan forwarderas till Core PW och vice versa. Spoke kan \u00e4ven skicka till annan spoke, dock g\u00e5r den trafiken alltid via core. Trafik tar allts\u00e5 s\u00e4llan den optimala v\u00e4gen och alla PEs m\u00e5ste l\u00e4ra sig alla MAC-adresser. F\u00f6r att f\u00e5 redundans ifr\u00e5n u-PE (spoke) till n-PE (core) kan man anv\u00e4nda Pseudowire Redundancy.</p>"},{"location":"cisco/Cisco_L2VPN/#l2-tunneling","title":"L2 Tunneling","text":"<p>F\u00f6r CDP, LACP, STP frames etc kr\u00e4vs l2 tunneling protocol. Detta finns det inte st\u00f6d f\u00f6r p\u00e5 alla plattformar, l2protocol action not supported.</p> <p><code>interface\u00a0gi2</code> <code>service\u00a0instance\u00a0100\u00a0ethernet</code> <code>l2protocol\u00a0tunnel</code></p> <p><code>show\u00a0ethernet\u00a0service\u00a0instance\u00a0detail\u00a0|\u00a0i\u00a0L2protocol</code></p>"},{"location":"cisco/Cisco_L2VPN/#eomplsatom","title":"EoMPLS/AToM","text":"<p>Ethernet-over-MPLS eller Any Transport over MPLS (RFC 4448). Requires end-to-end MPLS LSP. Notera att MTU p\u00e5 Access Circuits m\u00e5ste matcha f\u00f6r att pseudowire ska g\u00e5 upp. Det finns ingen MAC Learning med EoMPLS.</p> <p>EoMPLS features</p> <ul> <li>Ethernet Port Mode</li> <li>VLAN Mode</li> <li>Inter-AS Mode</li> <li>QinQ Mode</li> <li>QinAny Mode</li> </ul> <p>Port mode anv\u00e4nder VC type 5 (Ethernet) och VLAN mode anv\u00e4nder VC type 5 men med type 4 (Vlan) som fallback (show mpls l2transport binding).</p> <p>PW logging</p> <p><code>xconnect\u00a0logging\u00a0pseudowire\u00a0status</code></p> <p>PE1</p> <p><code>interface\u00a0gi2</code> <code>xconnect\u00a02.2.2.2\u00a0102\u00a0encapsulation\u00a0mpls</code></p> <p>PE2, VCID m\u00e5ste matcha p\u00e5 b\u00e5da sidor</p> <p><code>interface\u00a0gi2</code> <code>xconnect\u00a01.1.1.1\u00a0102\u00a0encapsulation\u00a0mpls</code></p> <p>Verify</p> <p><code>show\u00a0xconnect\u00a0all</code> <code>show\u00a0xconnect\u00a0peer\u00a02.2.2.2\u00a0vcid\u00a0102</code> <code>show\u00a0l2vpn\u00a0service\u00a0all</code> <code>show\u00a0mpls\u00a0l2transport\u00a0vc\u00a0102\u00a0detail</code> <code>ping\u00a0mpls\u00a0pseudowire\u00a010.0.0.10\u00a0102</code></p> <p>Segment 1 \u00e4r de interface som kunden sitter p\u00e5, segment 2 \u00e4r core.</p> <p>Pseudowire Redundancy Pseudowire redundancy inneb\u00e4r att man s\u00e4tter upp en backup PW.</p> <p><code>l2vpn\u00a0xconnect\u00a0context\u00a0Redundancy</code> <code>member\u00a01.1.1.1\u00a010\u00a0encapsulation\u00a0mpls\u00a0group\u00a01\u00a0priority\u00a01</code> <code>member\u00a02.2.2.2\u00a010\u00a0encapsulation\u00a0mpls\u00a0group\u00a01\u00a0priority\u00a02</code></p>"},{"location":"cisco/Cisco_L2VPN/#evpn-vpws","title":"EVPN-VPWS","text":"<p><code>l2vpn\u00a0evpn</code> <code>replication-type\u00a0ingress</code> <code>router-id\u00a0Loopback0</code> <code>mpls\u00a0label\u00a0mode\u00a0per-ce</code> <code>!</code> <code>l2vpn\u00a0evpn\u00a0instance\u00a010\u00a0vlan-based</code> <code>route-distinguisher\u00a01.1.1.1:10</code> <code>route-target\u00a0both\u00a010:10</code> <code>no\u00a0auto-route-target</code> <code>!</code> <code>member\u00a0evpn-instance\u00a010</code> <code>member\u00a0GigabitEthernet0/0/1\u00a0service-instance\u00a010</code> <code>!</code> <code>interface\u00a0GigabitEthernet0/0/1</code> <code>no\u00a0ip\u00a0address</code> <code>service\u00a0instance\u00a010\u00a0ethernet</code> <code>encapsulation\u00a0dot1q\u00a0100</code> <code>!</code> <code>router\u00a0bgp\u00a01</code> <code>address-family\u00a0l2vpn\u00a0evpn</code> <code>neighbor\u00a0IBGP\u00a0activate</code> <code>neighbor\u00a0IBGP\u00a0send-community\u00a0both</code></p> <p>Verify</p> <p><code>show\u00a0l2vpn\u00a0evpn\u00a0evi\u00a0detail</code> <code>show\u00a0l2vpn\u00a0evpn\u00a0mac</code> <code>show\u00a0l2vpn\u00a0l2route\u00a0evpn\u00a0mac</code></p>"},{"location":"cisco/Cisco_L2VPN/#l2tpv3","title":"L2TPv3","text":"<p>Layer 2 Tunneling Protocol (RFC 3931, RFC 4719) kr\u00e4ver CEF och IP-konnektivitet end-to-end. Det \u00e4r endast point-to-point. IP protocol: 115.</p> <p><code>pseudowire-class\u00a0L2TP-PWCLASS</code> <code>encapsulation\u00a0l2tpv3</code> <code>ip\u00a0local\u00a0interface\u00a0Loopback0</code></p> <p><code>interface\u00a0gi2</code> <code>xconnect\u00a02.2.2.2\u00a0102\u00a0pw-class\u00a0L2TP-PWCLASS</code></p> <p>Verify</p> <p><code>show\u00a0l2tp\u00a0session\u00a0all</code> <code>show\u00a0l2tun\u00a0tunnel\u00a0all</code></p> <p>Default kopieras inte DF bit som finns i paketen som kommer in ifr\u00e5n CE n\u00e4r L2TPv3 IP header adderas. Man kan \u00e4ndra det i pw-klassen.</p> <p><code>pseudowire-class\u00a0L2TP-PWCLASS</code> <code>ip\u00a0pmtu</code></p>"},{"location":"cisco/Cisco_L2VPN/#inter-as-option-b","title":"Inter-AS Option B","text":"<p>PE</p> <p><code>mpls\u00a0ldp\u00a0discovery\u00a0targeted-hello\u00a0accept</code></p> <p><code>l2vpn</code> <code>pseudowire\u00a0routing</code> <code>terminating-pe\u00a0tie-breaker</code></p> <p><code>l2vpn\u00a0vfi\u00a0context\u00a0vfiA</code> <code>vpn\u00a0id\u00a0111</code> <code>autodiscovery\u00a0bgp\u00a0signaling\u00a0ldp</code> <code>vpls-id\u00a0111:111</code> <code>rd\u00a0111:111</code> <code>route-target\u00a0111:111</code></p> <p>ASBR</p> <p><code>mpls\u00a0ldp\u00a0discovery\u00a0targeted-hello\u00a0accept</code></p> <p><code>l2vpn</code> <code>pseudowire\u00a0routing</code></p> <p><code>router\u00a0bgp\u00a01</code> <code>no\u00a0bgp\u00a0default\u00a0route-target\u00a0filter</code> <code>address-family\u00a0l2vpn\u00a0vpls</code> <code>neighbor</code><code>activate</code> <code>neighbor</code><code>send-community\u00a0extended</code> <code>neighbor</code><code>next-hop-self</code> <code>neighbor</code><code>activate</code> <code>neighbor</code><code>send-community\u00a0extended</code> <p><code>interface\u00a0GigabitEthernet1</code> <code>description\u00a0ASBR-to-ASBR</code> <code>mpls\u00a0ip</code> <code>mpls\u00a0ldp\u00a0discovery\u00a0transport-address\u00a0interface</code></p>"},{"location":"cisco/Cisco_L2VPN/#ios-xr","title":"IOS-XR","text":"<p>IOS-XR implementerar ett strukturerat CLI f\u00f6r EFP och EVC konfiguration.</p> <ul> <li>l2transport: identifierar subinterface, fysisk port eller bundle     som en EFP.</li> <li>encapsulation: anv\u00e4nds f\u00f6r att matcha p\u00e5 VLAN tag</li> <li>rewrite: anv\u00e4nds f\u00f6r att specificera rewrite av VLAN tag.</li> </ul> <p>Exempel:</p> <p><code>interface\u00a0Bundle-Ether1.20\u00a0l2transport</code> <code>encapsulation\u00a0dot1q\u00a020</code> <code>rewrite\u00a0ingress\u00a0tag\u00a0pop\u00a01\u00a0symmetric</code> <code>mtu\u00a09022</code></p> <p>Loggning</p> <p><code>l2vpn</code> <code>logging</code> <code>bridge-domain</code> <code>pseudowire</code> <code>vfi</code></p> <p>Static VPLS</p> <p><code>l2vpn</code> <code>bridge\u00a0group\u00a0PROD</code> <code>bridge-domain\u00a0101</code> <code>mtu\u00a09000</code> <code>interface\u00a0Bundle-Ether1.101</code> <code>!</code> <code>vfi\u00a0101</code> <code>neighbor\u00a010.0.10.15\u00a0pw-id\u00a0101</code> <code>neighbor\u00a010.0.10.16\u00a0pw-id\u00a0101</code></p> <p>Verify</p> <p><code>show\u00a0l2vpn\u00a0bridge-domain\u00a0brief</code></p> <p>Static P2P EoMPLS tillhandah\u00e5ller en tunnlingsmekanism f\u00f6r Ethernet-trafik \u00f6ver ett MPLS-enabled L3 core. Man enkapsulerar Ethernet PDUs i MPLS-paket. Notera att MTU p\u00e5 Access Circuits m\u00e5ste matcha f\u00f6r att pseudowire ska g\u00e5 upp.</p> <p>\"VC Type 5\" = Port Based</p> <p><code>interface\u00a0GigabitEthernet0/0/0/1</code> <code>l2transport</code> <code>no\u00a0cdp</code> <code>!</code> <code>l2vpn</code> <code>!</code> <code>xconnect\u00a0group\u00a0GROUP1</code> <code>p2p\u00a0TO_XR2</code> <code>interface\u00a0GigabitEthernet0/0/0/1</code> <code>neighbor\u00a0ipv4\u00a02.2.2.2\u00a0pw-id\u00a0100</code></p> <p>\"VC-Type 4\" = VLAN based pseudowire</p> <p><code>l2vpn</code> <code>pw-class\u00a0VLAN</code> <code>encapsulation\u00a0mpls</code> <code>no\u00a0transport-mode</code> <code>transport-mode\u00a0vlan</code></p> <p>Verify</p> <p><code>show\u00a0l2vpn\u00a0forwarding\u00a0neighbor\u00a02.2.2.2\u00a0pw-id\u00a0100\u00a0detail\u00a0location\u00a00/0/CPU0</code></p>"},{"location":"cisco/Cisco_L2VPN/#control-word","title":"Control Word","text":"<p>Normalt sett kollar PE i packet header f\u00f6r att avg\u00f6ra om det \u00e4r ett IPv4- eller IPv6-paket och kollar sedan source/destination tuples f\u00f6r att avg\u00f6ra eventuell load sharing. Med L2VPN s\u00e5 kommer headern att vara en Ethernet-header ist\u00e4llet f\u00f6r IP-header. Om MAC-adressen h\u00e4ndelsevis b\u00f6rjar p\u00e5 0x4 eller 0x6 s\u00e5 kommer routern tro att det \u00e4r ett IP-paket och fatta beslut p\u00e5 fel grunder. Genom att l\u00e4gga till ett kontrollord s\u00e5 kan routern titta p\u00e5 det f\u00f6r att avg\u00f6ra om det \u00e4r ett IP-paket eller ej och d\u00e4rmed finns det ingen risk att load sharing blir fel. Control-Word spelar en viktig roll f\u00f6r ECMP och det \u00e4r rekommenderat att man sl\u00e5r p\u00e5 det.</p> <p><code>l2vpn</code> <code>pw-class\u00a0CONTROL</code> <code>encapsulation\u00a0mpls</code> <code>control-word</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_L2_Security/","title":"Cisco L2 Security","text":"<p>Huvudartikel: Cisco Security.</p> <p>Se \u00e4ven Private VLANs, DHCP Snooping och Cisco L3 Security.</p>"},{"location":"cisco/Cisco_L2_Security/#frame-block","title":"Frame Block","text":"<p>\u00c4ndra beteende p\u00e5 en switch s\u00e5 att unknown unicast droppas. Fungerar som s\u00e4kerhetsmekansim om CAM g\u00e5r fullt f\u00f6r d\u00e5 floodas inte alla frames.</p> <p><code>switchport\u00a0block\u00a0unicast</code> <code>switchport\u00a0block\u00a0multicast</code></p>"},{"location":"cisco/Cisco_L2_Security/#port-security","title":"Port Security","text":"<p>N\u00e4r man sl\u00e5r p\u00e5 port-security p\u00e5 en port s\u00e5 \u00e4r default MAC learning method \"dynamic\". Det betyder att switchen s\u00e4krar MAC-adresser ingress n\u00e4r de passerar interfacet. Om en ny MAC-adress kommer in och max antal till\u00e5tna MAC-adresser inte har uppn\u00e5tts s\u00e5 kommer switchen lagra MAC-adressen i minne och till\u00e5ta trafiken. Man kan \u00e4ven k\u00f6ra n\u00e5got som kallas \"sticky method\", d\u00e5 s\u00e4krar switchen MAC-adresser p\u00e5 samma s\u00e4tt som med dynamic men de sparas i NVRAM ist\u00e4llet. Detta g\u00f6r att de finns kvar genom reboots. Notera att sticky-adresser ej syns i running config. Ut\u00f6ver detta kan man ange MAC-adresser statiskt, detta g\u00f6r man i running config under interfacet, vilket g\u00f6r att man \u00e4ven kan spara det i startup config. En till grej som port-security g\u00f6r \u00e4r att kolla att MAC-adresser som \u00e4r s\u00e4krade inte kommer in p\u00e5 n\u00e5gon annan port i VLANet \u00e4n d\u00e4r de \u00e4r s\u00e4krade (oavsett learning method). Port-security fungerar endast p\u00e5 portar som \u00e4r statiskt konfigurerade som access eller trunk. Ska port security kombineras med HSRP b\u00f6r BIA MAC anv\u00e4ndas.</p> <p><code>interface\u00a0[interface]</code> <code>switchport\u00a0mode\u00a0access</code> <code>switchport\u00a0port-security</code> <code>switchport\u00a0port-security\u00a0maximum\u00a01</code> <code>switchport\u00a0port-security\u00a0mac-address\u00a0sticky</code> <code>switchport\u00a0port-security\u00a0violation\u00a0shutdown</code></p> <p>Verify</p> <p><code>show\u00a0port-security\u00a0interface</code></p> <p><code>errdisable\u00a0recovery\u00a0cause\u00a0psecure-violation</code></p>"},{"location":"cisco/Cisco_L2_Security/#acl","title":"ACL","text":""},{"location":"cisco/Cisco_L2_Security/#pacl","title":"PACL","text":"<p>Port ACLs anv\u00e4nds ingress p\u00e5 Layer 2 interfaces p\u00e5 switchar.</p> <p><code>interface\u00a0gi0/2</code> <code>ip\u00a0access-group\u00a0PACL\u00a0in</code> <code>mac\u00a0access-group\u00a0PACL\u00a0in</code></p> <p>Verify</p> <p><code>show\u00a0mac\u00a0access-group</code></p>"},{"location":"cisco/Cisco_L2_Security/#vacl","title":"VACL","text":"<p>VLAN ACL \u00e4r ingress, kollar b\u00e5de lokal och transit-trafik och funkar \u00e4ven med non-IP traffic.</p> <p><code>access-list\u00a0100\u00a0permit\u00a0ip\u00a0any\u00a0host\u00a010.0.0.10</code></p> <p><code>vlan\u00a0access-map\u00a0BLOCK-TO-SERVER\u00a010</code> <code>match\u00a0ip\u00a0address\u00a0100</code> <code>action\u00a0drop</code> <code>vlan\u00a0access-map\u00a0BLOCK-TO-SERVER\u00a020</code> <code>action\u00a0forward</code></p> <p>Apply to vlan</p> <p><code>vlan\u00a0filter\u00a0BLOCK-TO-SERVER\u00a0vlan-list\u00a010</code></p> <p>Logging</p> <p><code>vlan\u00a0access-log\u00a0maxflow\u00a0500</code> <code>vlan\u00a0access-log\u00a0threshold\u00a00</code></p>"},{"location":"cisco/Cisco_L2_Security/#storm-control","title":"Storm Control","text":"<p>Storm control \u00e4r teknik f\u00f6r att l\u00e5ta administrat\u00f6rer d\u00e4mpa unicast-, multicast- eller broadcast-trafik p\u00e5 L2-interface. Det kan anv\u00e4ndas f\u00f6r att reducera skadan vid broadcast-stormar. Olika switchmodeller fungerar olika n\u00e4r det g\u00e4ller EtherChannels kontra fysiska interface f\u00f6r Storm control. F\u00f6r att konfigurera Storm control m\u00e5ste man ange gr\u00e4nsv\u00e4rde (rising) men falling \u00e4r optional.</p> <p><code>interface\u00a0gi0/7</code> <code>storm-control\u00a0unicast\u00a0level\u00a0bps\u00a01m\u00a0500k</code> <code>storm-control\u00a0multicast\u00a0level\u00a0pps\u00a0500</code> <code>storm-control\u00a0broadcast\u00a0level\u00a010</code></p> <p>Ange vad som ska h\u00e4nda n\u00e4r tr\u00f6skelv\u00e4rde \u00f6verskrids, t.ex. droppa frames eller skicka snmp-trap.</p> <p><code>storm-control\u00a0action\u00a0trap</code></p> <p>Verify</p> <p><code>show\u00a0storm-control</code></p>"},{"location":"cisco/Cisco_L2_Security/#8021x","title":"802.1x","text":"<p>802.1x \u00e4r ett s\u00e4kerhetsprotokoll som l\u00e5ter klienter (end devices) autentisera sig genom att prata EAP (RFC 3748) innan de f\u00e5r tillg\u00e5ng till tr\u00e5d/tr\u00e5dl\u00f6sa n\u00e4tverk. Switcharna kan prata radius med authentication server som t.ex. kan vara en Windows-server eller en Cisco ISE. Authentication port-control anv\u00e4nds f\u00f6r att st\u00e4lla en port i ett av tre operational modes: auto, force-authorized och force-unauthorized.</p> <p><code>aaa\u00a0authentication\u00a0dot1x\u00a0default\u00a0group\u00a0radius</code> <code>dot1x\u00a0system-auth-control</code></p> <p><code>interface\u00a0gi0/5</code> <code>switchport\u00a0mode\u00a0access</code> <code>dot1x\u00a0port-control\u00a0auto</code></p> <p>Har man flera hostar p\u00e5 samma port s\u00e5 kan man l\u00e5ta varje mac-adress autentisera sig.</p> <p><code>interface\u00a0gi0/5</code> <code>authentication\u00a0host-mode\u00a0multi-host</code></p> <p>Om man vill testk\u00f6ra (dry-run) sin autentiseringsl\u00f6sning kan man anv\u00e4nda \u00f6ppen auth, d\u00e5 skickas authentication data till Radius-servern men porten agerar vanlig port (allts\u00e5 till\u00e5ter trafik p\u00e5 access vlan).</p> <p><code>interface\u00a0gi0/5</code> <code>authentication\u00a0open</code></p> <p>Man kan sl\u00e5 p\u00e5 att alla andra f\u00e5r prata ut genom porten men inkommande frames accepteras endast om auth g\u00e5r igenom. Detta \u00e4r t.ex. anv\u00e4ndbart f\u00f6r PXE.</p> <p><code>interface\u00a0gi0/5</code> <code>authentication\u00a0control-direction\u00a0in</code></p> <p>Verify</p> <p><code>show\u00a0dot1x</code></p>"},{"location":"cisco/Cisco_L2_Security/#dai","title":"DAI","text":"<p>F\u00f6r att skydda sitt L2-n\u00e4tverk mot MITM-attacker som anv\u00e4nder G-ARP kan man anv\u00e4nda Dynamic ARP inspection. DAI kr\u00e4ver DHCP Snooping eftersom inkomna ARP-meddelanden valideras mot snooping-databasen. Om inte ARP:en st\u00e4mmer \u00f6verens mot det som st\u00e5r i databasen kommer frames att droppas, SW_DAI-4-DHCP_SNOOPING_DENY. Man sl\u00e5r p\u00e5 DAI per VLAN man vill skydda.</p> <p><code>ip\u00a0arp\u00a0inspection\u00a0vlan\u00a010</code> <code>show\u00a0ip\u00a0arp\u00a0inspection\u00a0vlan\u00a010</code></p> <p>Man kan \u00e4ven kontrollera IP-avs\u00e4ndare och mottagare i paketen utifr\u00e5n ARP-information. Detta kollar \u00e4ven ARP bodies efter invalid eller ov\u00e4ntade IP-adresser som 0.0.0.0, 255.255.255.255 och alla multicast-adresser.</p> <p><code>ip\u00a0arp\u00a0inspection\u00a0validate\u00a0ip</code></p> <p>Konfigurera interface som trusted f\u00f6r ARP. P\u00e5 dessa inspekteras ej ARP-meddelanden.</p> <p><code>interface\u00a0gi0/7</code> <code>ip\u00a0arp\u00a0inspection\u00a0trust</code></p> <p>Static entries beh\u00f6vs f\u00f6r hostar som inte anv\u00e4nder DHCP.</p> <p><code>arp\u00a0access-list\u00a0ARP_ACL</code> <code>permit\u00a0ip\u00a0host\u00a010.0.0.30\u00a0mac\u00a0host\u00a00011.2233.4455</code></p> <p><code>ip\u00a0arp\u00a0inspection\u00a0filter\u00a0ARP_ACL\u00a0vlan\u00a010</code></p> <p>Eftersom DAI g\u00f6r att switchen jobbar mer kan man \u00f6verlasta den genom att skicka ett stort antal ARP-meddelanden. DAI har d\u00e4rf\u00f6r default en limit p\u00e5 15 ARP-meddelanden per port per sekund.</p> <p><code>interface\u00a0gi0/7</code> <code>ip\u00a0arp\u00a0inspection\u00a0limit\u00a015</code></p> <p>Logging</p> <p><code>ip\u00a0arp\u00a0inspection\u00a0vlan\u00a010\u00a0logging\u00a0acl-match</code></p> <p><code>ip\u00a0arp\u00a0inspection\u00a0log-buffer\u00a0entries\u00a032</code> <code>ip\u00a0arp\u00a0inspection\u00a0log-buffer\u00a0logs\u00a05\u00a0interval\u00a01</code></p> <p>Verify</p> <p><code>show\u00a0ip\u00a0arp\u00a0inspection</code></p>"},{"location":"cisco/Cisco_L2_Security/#macsec","title":"MACsec","text":"<p>En del Nexus-switchar har line rate encryption capabilities. MACsec Layer 2 security krypterar paketen hop-by-hop. Detta skyddar mot wiretapping och MITM samtidigt som det g\u00f6r att man kan inspektera, monitorera, QoS-tagga och forwardera frames som vanligt fast trots att det \u00e4r krypterat on the wire. F\u00f6r att uppt\u00e4cka MACsec peers och f\u00f6rhandla nycklar mellan MACsec-deltagare anv\u00e4nds MACsec Key Agreement (MKA) protocol. Sedan anv\u00e4nds Secure Association Key (SAK) f\u00f6r att kryptera och avkryptera p\u00e5 data plane. En MACsec keychain kan ha multipla PSKs, var och en med egen key ID och valfri lifetime. En MACsec-session kan t.ex. faila pga key/key name (CKN) mismatch eller att key duration har g\u00e5tt ut. Om den failar s\u00e5 kan man ha en fallback session som tar \u00f6ver, d\u00e5 m\u00e5ste man ha en fallback key konfad. En fallback session g\u00f6r att man slipper nertid n\u00e4r primary session g\u00e5r ner och man f\u00e5r lite tid p\u00e5 sig att fixa problemet.</p> <p>Overview <p>MACsec funkar p\u00e5:</p> <ul> <li>Layer 2 switchports (access and trunk)</li> <li>Layer 3 routed interfaces (no subinterfaces)</li> <li>Layer 2 and Layer 3 port channels</li> </ul> <p>Konfiguration</p> <p><code>feature\u00a0macsec</code></p> <p><code>key-chain\u00a0macsec-psk\u00a0no-show</code></p> <p><code>key\u00a0chain\u00a0KC1\u00a0macsec</code> <code>key\u00a0100</code> <code>key-octet-string\u00a0abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789\u00a0cryptographic-algorithm\u00a0AES_256_CMAC</code> <code>send-lifetime\u00a000:00:00\u00a0Oct\u00a004\u00a02018\u00a0duration\u00a0100000</code></p> <p>Om man inte anger n\u00e5gon key lifetime s\u00e5 defaultar det till unlimited.</p> <p>Policy</p> <p><code>macsec\u00a0policy\u00a0MACsec01</code> <code>cipher-suite\u00a0GCM-AES-256</code> <code>security-policy</code><code>should-secure</code></p> <p>H\u00e4r kan man \u00e4ven v\u00e4lja \"must-secure\" = packets not carrying MACsec headers will be dropped.</p> <p>Apply</p> <p><code>interface\u00a0e1/15</code> <code>macsec\u00a0keychain\u00a0KC1\u00a0policy\u00a0MACsec01\u00a0fallback-keychain\u00a0KC-fallback</code></p> <p>Notera att man inte kan \u00e4ndra en policy utan man f\u00e5r skapa en ny och attacha p\u00e5 interfacet.</p> <p>Verify</p> <p><code>show\u00a0macsec\u00a0policy</code> <code>show\u00a0macsec\u00a0mka\u00a0session/summary</code> <code>show\u00a0interface\u00a0capabilities\u00a0|\u00a0i\u00a0\"Ethernet|MACSEC</code></p>"},{"location":"cisco/Cisco_L2_Security/#xpn","title":"XPN","text":"<p>MACsec Extended Packet Numbering (XPN). Varje MACsec frame inneh\u00e5ller ett 32-bitars packetnummer som \u00e4r unikt f\u00f6r varje given SAK. Om dessa tar slut s\u00e5 blir det SAK rekey f\u00f6r data plane keys. F\u00f6r h\u00f6gkapacitetsl\u00e4nkar s\u00e5 tar dessa slut r\u00e4tt snabbt och kontrollplan m\u00e5ste g\u00f6ra SAK rekey. Med XPN s\u00e5 anv\u00e4nds ett 64-bitars nummer ist\u00e4llet och d\u00e4rmed elimineras behovet av frekvent SAK rekey.</p> <p><code>mka\u00a0policy\u00a0MACSEC</code> <code>macsec-cipher-suite\u00a0gcm-aes-xpn-256</code> <code>!</code> <code>key\u00a0chain\u00a0MACSEC\u00a0macsec</code> <code>key\u00a01000</code> <code>cryptographic-algorithm\u00a0aes-256-cmac</code> <code>key-string\u00a07\u00a0075E701D1F58485446435A5D557B7A757962647342</code> <code>!</code> <code>interface\u00a0HundredGigE1/0/1</code> <code>macsec\u00a0network-link</code> <code>mka\u00a0policy\u00a0MACSEC</code> <code>mka\u00a0pre-shared-key\u00a0key-chain\u00a0MACSEC</code></p>"},{"location":"cisco/Cisco_L2_Security/#certificate-based-macsec","title":"Certificate Based MACsec","text":"<p>Cisco IOS-XE har st\u00f6d f\u00f6r Certificate Based MACsec med Local Authentication. D\u00e5 anv\u00e4nds EAP-TLS f\u00f6r authentication. MKA och MACsec implementeras efter lyckad authentication med certificate-based MACsec.</p> <p><code>show\u00a0mka\u00a0session\u00a0interface\u00a0g1/0/1\u00a0details</code></p>"},{"location":"cisco/Cisco_L2_Security/#ipv6","title":"IPv6","text":"<p>RA guard RA guard blockerar unwanted eller rogue router advertisement. Denna feature k\u00f6rs i ingress direction.</p> <p><code>interface\u00a0GigabitEthernet0/1</code> <code>ipv6\u00a0nd\u00a0raguard</code></p> <p>Verify</p> <p><code>show\u00a0ipv6\u00a0snooping\u00a0features</code> <code>show\u00a0ipv6\u00a0nd\u00a0raguard</code></p> <p>DHCPv6 Guard DHCPv6 Guard blockerar reply och advertisments som kommer fr\u00e5n unauthorized DHCP servers.</p> <p><code>show\u00a0ipv6\u00a0dhcp\u00a0guard</code></p> <p>Binding table</p> <p><code>show\u00a0ipv6\u00a0neighbor\u00a0binding</code></p> <p>Device tracking</p> <p><code>show\u00a0ipv6\u00a0neighbor\u00a0tracking</code></p> <p>ND inspection/snooping</p> <p><code>show\u00a0ipv6\u00a0nd\u00a0inspection</code></p> <p>SeND Secure Neighbor Discovery is a protocol that enhances NDP with three additional capabilities: Address ownership proof, Message protection, Router authorization.</p>"},{"location":"cisco/Cisco_L2_Security/#mac-access-control-list","title":"MAC access control list","text":"<p>Work in progress</p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_L3_Security/","title":"Cisco L3 Security","text":"<p>Huvudartikel: Cisco Security</p> <p>Se \u00e4ven Cisco L2 Security.</p>"},{"location":"cisco/Cisco_L3_Security/#routing","title":"Routing","text":"<p>Till\u00e5t ej IP options och source routing \u00e4r bra praktik!</p> <p><code>ip\u00a0options\u00a0drop</code> <code>no\u00a0ip\u00a0source-route</code></p> <p>Notera att \"ip options drop\" kan st\u00f6ra ut IGMP.</p>"},{"location":"cisco/Cisco_L3_Security/#acl","title":"ACL","text":"<p>Accesslistor finns i flera olika varianter f\u00f6rutom standard och extended.</p> <p>Logging Access list logging interval (milliseconds) &amp; log-update threshold (number of hits)</p> <p><code>ip\u00a0access-list\u00a0logging\u00a0interval\u00a01000</code> <code>ip\u00a0access-list\u00a0log-update\u00a0threshold\u00a010</code></p> <p>Reflexive ACL F\u00f6r att anv\u00e4nda reflexive ACL beh\u00f6vs det en ACL f\u00f6r inbound traffic, en f\u00f6r outbound och en reflexive f\u00f6r att h\u00e5lla koll p\u00e5 dynamic entries. N\u00e5gra begr\u00e4nsningar \u00e4r att trafik endast kan initieras fr\u00e5n ena sidan och det g\u00e5r inte ge olika trafikklasser olika access. Trafik initierad lokalt i routern behandlas ej heller. Det funkar inte heller med applikationer som jobbar med olika portnummer, t.ex. FTP.</p> <p><code>ip\u00a0access-list\u00a0extended\u00a0Egress</code> <code>permit\u00a0ip\u00a0any\u00a0any\u00a0reflect\u00a0Mirror</code> <code>ip\u00a0access-list\u00a0extended\u00a0Ingress</code> <code>evaluate\u00a0Mirror</code> <code>deny\u00a0ip\u00a0any\u00a0any</code></p> <p><code>interface\u00a0gi0/1</code> <code>description\u00a0Outside</code> <code>ip\u00a0access-group\u00a0out\u00a0Egress</code> <code>ip\u00a0access-group\u00a0in\u00a0Ingress</code></p> <p>Timeout</p> <p><code>ip\u00a0reflexive-list\u00a0timeout\u00a030</code></p> <p>Verify</p> <p><code>show\u00a0ip\u00a0access-lists\u00a0Mirror</code> <code>show\u00a0ip\u00a0access-lists</code></p> <p>IPv6 F\u00f6r IPv6 finns det endast extended named ACL:er. Wildcard mask anv\u00e4nds inte heller utan det \u00e4r CIDR notation som g\u00e4ller.</p> <p><code>ipv6\u00a0access-list\u00a0Deny_ABC</code> <code>deny\u00a0ipv6\u00a02001:A:B:C::/64\u00a0any</code> <code>permit\u00a0ipv6\u00a0any\u00a0any</code></p> <p><code>interface\u00a0Gi0/1</code> <code>ipv6\u00a0traffic-filter\u00a0Deny_ABC\u00a0out</code></p> <p><code>show\u00a0ipv6\u00a0access-list</code></p> <p>Lock and Key (Dynamic ACLs) Lock and key configuration starts with the application of an extended ACL to block traffic through the router. Users that want to traverse the router are blocked by the extended ACL until they Telnet to the router and are authenticated. The Telnet connection then drops and a single-entry dynamic ACL is added to the extended ACL that exists. This permits traffic for a particular time period; idle and absolute timeouts are possible.</p> <p><code>username\u00a0DYN\u00a0autocommand\u00a0access-enable\u00a0timeout\u00a05</code></p> <p><code>ip\u00a0access-list\u00a0extended\u00a0100</code> <code>permit\u00a0tcp\u00a010.0.0.0\u00a00.0.0.255\u00a0host\u00a010.0.0.1\u00a0eq\u00a0telnet</code> <code>dynamic\u00a0DYN\u00a0timeout\u00a05\u00a0permit\u00a0ip\u00a010.0.0.0\u00a00.0.0.255\u00a0any</code></p> <p>Turbo ACL The turbo ACL feature is designed in order to process ACLs more efficiently in order to improve router performance. Found only on high-end platforms.</p> <p><code>show\u00a0access-list\u00a0compiled</code></p>"},{"location":"cisco/Cisco_L3_Security/#cbac","title":"CBAC","text":"<p>Context-Based Access Control tillhandah\u00e5ller stateful packet inspection p\u00e5 IOS-enheter. Man v\u00e4ljer vilka protokoll som ska inspekteras, det finns m\u00e5nga protokoll default. Detta \u00e4r ett konfigurationsexempel f\u00f6r ett interface som endast ska sl\u00e4ppa in webbtrafik initierad fr\u00e5n insidan.</p> <p><code>ip\u00a0access-list\u00a0extended\u00a0DENY_ALL</code> <code>deny\u00a0ip\u00a0any\u00a0any</code> <code>ip\u00a0inspect\u00a0name\u00a0Web\u00a0http</code> <code>ip\u00a0inspect\u00a0name\u00a0Web\u00a0https</code></p> <p><code>interface\u00a0gi0/0</code> <code>description\u00a0Outside</code> <code>ip\u00a0access-group\u00a0DENY_ALL\u00a0in</code> <code>ip\u00a0inspect\u00a0Web\u00a0out</code></p> <p>Verify</p> <p><code>show\u00a0ip\u00a0inspect\u00a0all</code> <code>show\u00a0ip\u00a0inspect\u00a0sessions</code></p> <p>Vill man att CBAC ska inspektera protokoll som inte anv\u00e4nder standardportar kan l\u00e4gga till dessa med port-map-kommandot.</p> <p><code>ip\u00a0port-map\u00a0http\u00a0port\u00a0tcp\u00a08081</code> <code>ip\u00a0port-map\u00a0smtp\u00a0port\u00a0tcp\u00a02500</code></p> <p><code>show\u00a0ip\u00a0port-map</code></p>"},{"location":"cisco/Cisco_L3_Security/#zfw","title":"ZFW","text":"<p>Zone-based policy firewall \u00e4r stateful packet inspection som \u00e4r en vidareutveckling av CBAC. Det \u00e4r VRF-aware och man skapar zoner som man binder ett eller flera interface till. Default skapas det en \"self\"-zon som allt till och fr\u00e5n till\u00e5ts samt att trafik mellan interface i samma zon till\u00e5ts. Konfigurationssyntaxen som anv\u00e4nds kallas Cisco Policy Language. ZFW kan inte inspektera multicast eller MPLS-trafik men det g\u00e5r att att k\u00f6ra ZFW i transparent mode samt att man kan policea trafiken.</p> <p><code>zone\u00a0security\u00a0INTERNET</code> <code>zone\u00a0security\u00a0INSIDE</code> <code>interface\u00a0Gi1</code> <code>zone-member\u00a0security\u00a0INTERNET</code> <code>interface\u00a0Gi2</code> <code>zone-member\u00a0security\u00a0INSIDE</code></p> <p>Bind ihop zonerna och ange source zon.</p> <p><code>zone-pair\u00a0security\u00a0ZONE-PAIR\u00a0source\u00a0INSIDE\u00a0destination\u00a0INTERNET</code> <code>service-policy\u00a0type\u00a0inspect\u00a0INSIDE-TO-INTERNET</code></p> <p>F\u00f6r att till\u00e5ta trafik mellan zoner m\u00e5ste en policy skapas. ZFW inspect class-map kan matcha: access-groups, class-maps, group-objects och protokoll.</p> <p><code>class-map\u00a0type\u00a0inspect\u00a0match-any\u00a0ALLOW-TRAFFIC</code> <code>match\u00a0protocol\u00a0icmp</code> <code>match\u00a0protocol\u00a0dns</code> <code>match\u00a0protocol\u00a0http</code></p> <p><code>policy-map\u00a0type\u00a0inspect\u00a0INSIDE-TO-INTERNET</code> <code>class\u00a0type\u00a0inspect\u00a0ALLOW-TRAFFIC</code> <code>inspect</code> <code>class\u00a0class-default</code> <code>drop</code></p> <p>Verify</p> <p><code>show\u00a0zone-pair\u00a0security</code> <code>show\u00a0policy-map\u00a0type\u00a0inspect\u00a0zone-pair</code> <code>show\u00a0policy-firewall\u00a0config</code> <code>show\u00a0policy-firewall\u00a0session\u00a0zone-pair\u00a0ZONE-PAIR</code></p> <p>High Availability ZFW st\u00f6djer HA och session state replikeras f\u00f6r inspect actions mellan ACTIVE och STANDBY. Dock g\u00f6rs det endast f\u00f6r L4 protokoll TCP/UDP s\u00e5 ingen ICMP eller L7 inspections. Enheten med h\u00f6gst prio blir ACTIVE, vid lika avg\u00f6r h\u00f6gsta IP p\u00e5 control link.</p> <p><code>interface\u00a0GigabitEthernet0/1</code> <code>description\u00a0Control\u00a0link</code> <code>ip\u00a0address\u00a010.1.1.2\u00a0255.255.255.0</code></p> <p><code>parameter-map\u00a0type\u00a0inspect\u00a0global</code> <code>redundancy</code></p> <p><code>redundancy</code> <code>application\u00a0redundancy</code> <code>group\u00a01</code> <code>name\u00a0ZFW</code> <code>preempt</code> <code>priority\u00a0100</code> <code>control\u00a0GigabitEthernet0/1\u00a0protocol\u00a01</code> <code>data\u00a0GigabitEthernet0/1</code></p> <p>Verify</p> <p><code>show\u00a0redundancy\u00a0application\u00a0group\u00a01</code></p>"},{"location":"cisco/Cisco_L3_Security/#urpf","title":"uRPF","text":"<p>Unicast Reverse Path Forwarding \u00e4r en mekanism som f\u00f6rhindrar spoofing attacks. Source-adressen p\u00e5 paket som kommer in kollas och j\u00e4mf\u00f6rs mot den egna FIB:en f\u00f6r att s\u00e4kerst\u00e4lla att paketen kommer in p\u00e5 det interface som routern sj\u00e4lv hade anv\u00e4nt f\u00f6r att n\u00e5 den adressen. CEF \u00e4r d\u00e4rf\u00f6r ett prereq f\u00f6r uRPF. uRPF finns i tv\u00e5 modes och tar h\u00e4nsyn till equal och unequal cost load sharing. Om default-routen ocks\u00e5 ska anv\u00e4ndas vid kontrollen m\u00e5ste allow-default s\u00e4ttas efter interface-kommandot.</p> <p>Strict mode, fungerar s\u00e5klart inte med asymmetric routing.</p> <p><code>ip\u00a0verify\u00a0unicast\u00a0source\u00a0reachable-via\u00a0rx</code></p> <p>Med Loose mode r\u00e4cker det att sourcen \u00e4r reachable via n\u00e5got interface.</p> <p><code>ip\u00a0verify\u00a0unicast\u00a0source\u00a0reachable-via\u00a0any</code></p> <p>uRPF exemptions, vill man inte kontrollera all trafik kan man matcha RPF-checken mot en ACL, dvs permita det som RPF inte ska bry sig om att droppa om det inte klarar checken.</p> <p><code>ip\u00a0verify\u00a0unicast\u00a0source\u00a0reachable-via\u00a0rx</code><code></code> <p>Verify</p> <p><code>show\u00a0ip\u00a0traffic</code> <code>show\u00a0ip\u00a0verify\u00a0source</code></p> <p>Trick f\u00f6r att logga all packets med spoofed sources.</p> <p><code>access-list\u00a0100\u00a0deny\u00a0ip\u00a0any\u00a0any\u00a0log</code> <code>interface\u00a0GigabitEthernet0/1</code> <code>ip\u00a0verify\u00a0unicast\u00a0source\u00a0reachable-via\u00a0any\u00a0100</code></p>"},{"location":"cisco/Cisco_L3_Security/#ipsg","title":"IPSG","text":"<p>IP Source Guard hj\u00e4lper till att skydda mot IP spoofing. Det konfigureras p\u00e5 access-lagret och anv\u00e4nder sig av DHCP Snooping-databasen f\u00f6r att dynamiskt skapa IP/MAC ACL:er per switchport och allt som inte tr\u00e4ffar ACL:en droppas silently. Det enda som till\u00e5ts \u00e4r paket med den source som matchar den DHCP snooping binding som finns f\u00f6r porten. Man kan ocks\u00e5 s\u00e4tta upp statiska IP binding entries f\u00f6r hostar som inte anv\u00e4nder DHCP. IPSG kan kontrollera IP-adresser eller b\u00e5de IP-adresser och MAC-adresser. Det b\u00f6r konfigureras konsekvent p\u00e5 alla accessportar p\u00e5 network edge.</p> <p>Prereq, DHCP Snooping m\u00e5ste faktiskt vara p\u00e5slaget \u00e4ven om man bara anv\u00e4nder manuella bindings.</p> <p><code>ip\u00a0dhcp\u00a0snooping</code> <code>ip\u00a0dhcp\u00a0snooping\u00a0vlan\u00a010</code></p> <p>L3 check</p> <p><code>interface\u00a0gi0/7</code> <code>ip\u00a0verify\u00a0source</code></p> <p>L3+L2 check</p> <p><code>interface\u00a0gi0/7</code> <code>switchport\u00a0port-security</code> <code>ip\u00a0verify\u00a0source\u00a0port-security</code></p> <p>Static binding</p> <p><code>ip\u00a0source\u00a0binding\u00a00011.2233.4455\u00a0vlan\u00a010\u00a0172.20.0.10\u00a0int\u00a0gi0/7</code></p> <p>Verify</p> <p><code>show\u00a0ip\u00a0verify\u00a0source</code> <code>show\u00a0ip\u00a0source\u00a0binding</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_LISP/","title":"Cisco LISP","text":"<p>Locator/Identifier Separation Protocol (RFC 6830) \u00e4r en routing och adresseringsarkitektur utvecklat av Cisco men \u00e4r en \u00f6ppen standard. Vanligtvis anv\u00e4nds en IP-adress f\u00f6r att representera b\u00e5de identitet och lokation men med LISP separeras dessa som RLOC och EID (som g\u00e5r att mixa mellan IPv4 och IPv6). Att separera identitet och lokation \u00e4r m\u00f6jligt eftersom LISP tunnlar trafik med UDP, dvs det \u00e4r overlay. Med hj\u00e4lp av en registreringsprocess skapas det en mapping database p\u00e5 en ciscorouter som agerar Map Server och Map Resolver. Denna databas h\u00e5ller alla EID \\&lt;-&gt; RLOC mappings och det \u00e4r den man fr\u00e5gar f\u00f6r att f\u00e5 veta var trafiken f\u00f6r olika IP-adresser ska tunnlas. LISP control plane anv\u00e4nder udp 4342 och data plane trafik skickas till udp 4341.</p>"},{"location":"cisco/Cisco_LISP/#terminology","title":"Terminology","text":"<ul> <li>Routing Locator (RLOC)</li> <li>Endpoint ID (EID)</li> <li>Egress Tunnel Router (ETR)</li> <li>Ingress Tunnel Router (ITR)</li> <li>Egress/Ingress Tunnel Router (xTR)</li> <li>Proxy Ingress Tunnel Router (P-ITR)</li> </ul> <p>"},{"location":"cisco/Cisco_LISP/#konfiguration","title":"Konfiguration","text":"<p>Map Server/Resolver P\u00e5 MS/MR konfar man vilka sites som f\u00e5r registrera sig, med sites menas de prefix/adresser som ska LISP:as. Dvs det \u00e4r inte en vitlista p\u00e5 RLOCs som f\u00e5r registrera sig d\u00e4remot m\u00e5ste MS/MR kunna n\u00e5 alla RLOC-adresser. Det g\u00e5r att ha dessa roller p\u00e5 olika enheter men det finns ingen st\u00f6rre vinning med det eftersom MS/MR inte beh\u00f6ver finnas i data plane. F\u00f6r att g\u00f6ra MS/MR-funktionen redundant kan man bygga IP anycast.</p> <p><code>router\u00a0lisp</code> <code>ipv4\u00a0map-server</code> <code>ipv4\u00a0map-resolver</code></p> <p><code>site\u00a0SITE_A</code> <code>authentication-key\u00a0SITE_A_KEY</code> <code>eid-prefix\u00a0192.168.1.0/24</code></p> <p>alla lokala ip-adresser p\u00e5 MS/MR anv\u00e4nds default av LISP</p> <p>Branch Site MS/MR ska vara n\u00e5bar med unicast i default-vrfen. Man kan ha flera RLOCs p\u00e5 samma site f\u00f6r redundans och lastdelning, d\u00e5 ska alla konfas likadant vad g\u00e4ller RLOC-adresser. Med priority kan man styra vilken RLOC som ska anv\u00e4ndas. Har tv\u00e5 stycken samma prio kan man styra lastdelning med weight. RLOC:ar inom samma site kommer automatiskt proba varandra f\u00f6r att kolla att de lever.</p> <p><code>router\u00a0lisp</code> <code>ipv4\u00a0itr\u00a0map-resolver\u00a010.0.0.10</code> <code>ipv4\u00a0itr</code> <code>ipv4\u00a0etr\u00a0map-server\u00a010.0.0.10\u00a0key\u00a0SITE_A_KEY</code> <code>ipv4\u00a0etr</code></p> <p><code>database-mapping\u00a0192.168.1.0/24\u00a0IPv4-interface\u00a0GigabitEthernet2\u00a0priority\u00a01\u00a0weight\u00a01</code></p> <p>Verify</p> <p><code>show\u00a0lisp</code> <code>show\u00a0lisp\u00a0site</code> <code>show\u00a0ip\u00a0lisp\u00a0map-cache</code> <code>show\u00a0ip\u00a0lisp\u00a0database</code></p> <p><code>clear\u00a0ip\u00a0lisp\u00a0map-cache\u00a0*</code></p> <p>map cache default TTL: 24h</p>"},{"location":"cisco/Cisco_LISP/#data-center","title":"Data Center","text":"<p>Genom att till\u00e5ta registrering av mer specifika routes (/32-routes) kan man l\u00f6sa VM mobility mellan datacenter. IP-adressen p\u00e5 roaming device m\u00e5ste vara inom EID-prefixet. En LISP xTR konfigurerad f\u00f6r LISP VM mobility och dynamiska EIDs \u00e4r en LISP-VM router. Den avg\u00f6r dynamiskt om en VM finns i det direktanslutna subn\u00e4tet eller n\u00e5gon annanstans. LISP-VM routers \u00e4r RLOCs som anv\u00e4nds f\u00f6r enkapsulering till EID.</p> <p><code>router\u00a0lisp</code> <code>site\u00a0DATA_CENTER</code> <code>authentication-key\u00a0DC_KEY</code> <code>eid-prefix\u00a010.8.0.0/16\u00a0accept-more-specifics</code></p>"},{"location":"cisco/Cisco_LISP/#pxtr","title":"PxTR","text":"<p>Proxy xTR kan anv\u00e4ndas f\u00f6r att lisp-siter ska kunna n\u00e5 non-lisp-aware sites. D\u00e5 skickas paketen native ip ut ur n\u00e4tverket och sedan lisp-enkapsulerat p\u00e5 v\u00e4gen tillbaka till siten.</p> <p><code>router\u00a0lisp</code> <code>ipv4\u00a0proxy-etr</code> <code>ipv4\u00a0proxy-itr\u00a02.2.2.2\u00a0\u00a0#local\u00a0ip</code> <code>ipv4\u00a0itr\u00a0map-resolver\u00a08.8.8.8</code> <code>map-cache</code><code>EID-prefix</code><code>map-request</code></p> <p>MTU PMTUD \u00e4r p\u00e5 default.</p> <p><code>router\u00a0lisp</code> <code>ipv4\u00a0path-mtu-discovery\u00a0min\u00a0576\u00a0max\u00a065535</code> <code>ipv6\u00a0path-mtu-discovery\u00a0min\u00a01280\u00a0max\u00a065535</code></p>"},{"location":"cisco/Cisco_LISP/#vrf","title":"VRF","text":"<p>EIDs och RLOCs kan separeras i olika VRF:er.</p> <p><code>router\u00a0lisp</code> <code>locator-table\u00a0vrf\u00a0UNDERLAY</code></p> <p><code>eid-table\u00a0vrf\u00a0Cust_A\u00a0instance-id\u00a0101</code> <code>database-mapping\u00a0192.168.1.0/24\u00a010.0.0.10\u00a0priority\u00a01\u00a0weight\u00a01</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_Logging/","title":"Cisco Logging","text":"<p>Ciscoenheter kan logga meddelanden lokalt och/eller remote. Se \u00e4ven Cisco IOS.</p>"},{"location":"cisco/Cisco_Logging/#format","title":"Format","text":"<p>Man kan anv\u00e4nda lite olika format p\u00e5 sina loggmeddelanden, detta g\u00e5r \u00e4ven \u00e4ndra p\u00e5 debugmeddelanden. Vill man att tidsst\u00e4mplarna ska utg\u00e5 ifr\u00e5n den tidszon enheten \u00e4r konfad med kan man l\u00e4gga till localtime efter datetime-kommandona.</p> <p><code>(Utan\u00a0tidsst\u00e4mpel)</code> <code>%LINK-3-UPDOWN:\u00a0Interface\u00a0Port-channel1,\u00a0changed\u00a0state\u00a0to\u00a0up</code></p> <p><code>service`` ``timestamps`` ``log`` ``uptime</code> <code>00:00:46:\u00a0%LINK-3-UPDOWN:\u00a0Interface\u00a0Port-channel1,\u00a0changed\u00a0state\u00a0to\u00a0up</code></p> <p><code>service`` ``timestamps`` ``log`` ``datetime</code> <code>*Feb\u00a0\u00a08\u00a018:24:02:\u00a0%LINK-3-UPDOWN:\u00a0Interface\u00a0Port-channel1,\u00a0changed\u00a0state\u00a0to\u00a0up</code></p> <p><code>service`` ``timestamps`` ``log`` ``datetime`` ``msec</code> <code>*Feb\u00a0\u00a08\u00a018:24:02:355\u00a0%LINK-3-UPDOWN:\u00a0Interface\u00a0Port-channel1,\u00a0changed\u00a0state\u00a0to\u00a0up</code></p> <p>NX-OS har lite annan struktur p\u00e5 syslog</p> <p><code>2016\u00a0Feb\u00a0\u00a08\u00a018:41:55.911853\u00a0\u00a0DC01-SW02\u00a0\u00a0%BGP-3-UNEXPECT:\u00a0\u00a0the-message...</code></p>"},{"location":"cisco/Cisco_Logging/#diverse","title":"Diverse","text":"<p>Default har de flesta IOS-enheter en r\u00e4tt liten logg-buffer men det g\u00e5r att st\u00e4lla upp.</p> <p><code>logging\u00a0buffered\u00a0131072</code></p> <p>Count every log message and timestamp last occurance</p> <p><code>logging\u00a0count</code> <code>show\u00a0logging\u00a0count</code></p> <p>Persistent, no buffering</p> <p><code>logging\u00a0persistent\u00a0immediate</code></p> <p>Rate limit</p> <p><code>logging\u00a0rate-limit\u00a0console\u00a0all\u00a01</code></p> <p>Numrera loggrader, g\u00f6r det sv\u00e5rare att manipulera lagrade loggar i efterhand.</p> <p><code>service\u00a0sequence-numbers</code></p> <p>Message Discriminator Innan ett loggmeddelande levereras kan man ha det checkat mot en manuellt definierad kriterielista. P\u00e5 s\u00e5 s\u00e4tt kan man t.ex. specificera om n\u00e5gra speciella loggmeddelanden ska droppas.</p> <p><code>logging\u00a0discriminator\u00a0BLOCK\u00a0msg-body\u00a0drops\u00a0Interface\u00a0Port-channel1</code></p> <p><code>logging\u00a0monitor\u00a0discriminator\u00a0BLOCK</code> <code>logging\u00a0host\u00a01.1.1.1\u00a0discriminator\u00a0BLOCK</code></p>"},{"location":"cisco/Cisco_Logging/#local-storage","title":"Local Storage","text":"<p>Man kan lagra loggar lokalt p\u00e5 flash.</p> <p><code>mkdir\u00a0flash:/logs</code> <code>logging\u00a0persistent\u00a0url\u00a0flash:/logs</code> <code>logging\u00a0on</code></p> <p>Verify</p> <p><code>show\u00a0logging</code></p>"},{"location":"cisco/Cisco_Logging/#syslog","title":"Syslog","text":"<p>Syslog \u00e4r en standard f\u00f6r message logging, \u00e4ven om inte strukturen p\u00e5 meddelandena \u00e4r standardiserad. Syslog anv\u00e4nder default UDP port 514. Syslog-meddelanden g\u00e5r \u00e4ven att skicka med SNMP-traps, f\u00f6rst skickas det lokalt till en speciell history buffer och sedan replikerar SNMP agenten det till traps.</p> <p><code>logging\u00a0on</code></p> <p>Set syslog server logging level, 0-7.</p> <p><code>logging\u00a0trap\u00a0?</code></p> <p>Source</p> <p><code>logging\u00a0origin-id\u00a0HOSTNAME</code> <code>logging\u00a0source-interface\u00a0Loopback\u00a00</code></p> <p>Bytt protokoll och port</p> <p><code>logging\u00a0host\u00a01.1.1.1\u00a0transport\u00a0tcp\u00a0port\u00a05514</code></p>"},{"location":"cisco/Cisco_Logging/#kommandologgning","title":"Kommandologgning","text":"<p><code>archive</code> <code>log\u00a0config</code> <code>logging\u00a0enable</code> <code>notify\u00a0syslog</code> <code>hidekeys</code></p> <p>Verify</p> <p><code>show\u00a0archive\u00a0log\u00a0config\u00a0all</code></p>"},{"location":"cisco/Cisco_Logging/#acl","title":"ACL","text":"<p>F\u00f6rutom att \u00f6ka hit count generera ett loggmeddelande n\u00e4r en ACL-regel tr\u00e4ffas.</p> <p><code>ip\u00a0access-list\u00a0extended\u00a0Block_HTTP</code> <code>10\u00a0deny\u00a0tcp\u00a0any\u00a0any\u00a0eq\u00a080</code><code>log</code> <code>20\u00a0permit\u00a0ip\u00a0any\u00a0any</code></p> <p>F\u00f6r L2-info ocks\u00e5 anv\u00e4nd log-input ist\u00e4llet f\u00f6r log.</p> <p>Access list logging interval (milliseconds) &amp; log-update threshold (number of hits)</p> <p><code>ip\u00a0access-list\u00a0logging\u00a0interval\u00a01000</code> <code>ip\u00a0access-list\u00a0log-update\u00a0threshold\u00a010</code></p> <p>IOS kan generera och l\u00e4gga p\u00e5 en MD5 hash p\u00e5 varje access-list entry. Denna hash kan anv\u00e4ndas f\u00f6r att enklare s\u00f6ka och filtrera p\u00e5 loggmeddelanden utifr\u00e5n en viss regel. Hashen ligger kvar efter reboot.</p> <p><code>ip\u00a0access-list\u00a0logging\u00a0hash-generation</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_MPLS-TE/","title":"Cisco MPLS-TE","text":"<p>Det finns olika tekniker f\u00f6r att g\u00f6ra TE i ett MPLS-n\u00e4t. Det mest flexibla och skalbara \u00e4r Segment Routing, se egen artikel.</p>"},{"location":"cisco/Cisco_MPLS-TE/#rsvp","title":"RSVP","text":"<p>Resource Reservation Protocol (RFC 2205) \u00e4r ett kontrollplansprotokoll (IP protokoll #46) designat f\u00f6r att reservera resurser genom ett n\u00e4tverk. Hostar/routrar kan beg\u00e4ra att f\u00e5 vissa QoS-niv\u00e5er av n\u00e4tverket. RSVP reserverar resurser men det \u00e4r upp till varje enhet att ha en QoS-teknik f\u00f6r att leverera bandbredden. Till skillnad fr\u00e5n vanlig QoS som \u00e4r per frame/paket \u00e4r detta per fl\u00f6de, se \u00e4ven Cisco QoS.</p> <p>Resource Reservation Protocol - Traffic Engineering (RFC 3209) \u00e4r en extension till RSVP som anv\u00e4nds f\u00f6r Traffic Engineering i MPLS-n\u00e4t. Det fungerar b\u00e5de som MPLS label distribution protocol och MPLS signaling protocol. En ingress LSR kan anv\u00e4nda RSVP-TE f\u00f6r att notifiera alla LSR:er l\u00e4ngs pathen till egress att den vill s\u00e4tta upp en LSP. Bandbredd kan d\u00e5 allokeras genom hela MPLS-n\u00e4tverket. RSVP \u00e4r unidirectional och det s\u00e4tts upp en LSP per riktning. Det fungerar b\u00e5de med IPv4 och IPv6. Default kommer MPLS-TE tunnlar att f\u00f6redra TE metric value \u00f6ver IGP metric f\u00f6r deras dynamiska path selection. Dock \u00e4r TE metrics tagna ifr\u00e5n IGP metric default.</p> <p>Paket</p> <ul> <li>Path messages: anv\u00e4nds av ingress LSR f\u00f6r att beg\u00e4ra LSP setup     hop-by-hop l\u00e4ngs hela pathen.</li> <li>Resv messages: anv\u00e4nds av egress LSR f\u00f6r att svara p\u00e5 Path message     fr\u00e5n ingress.</li> </ul> <p>F\u00f6r att h\u00e5lla LSP aktuell skickas periodvis PATH refresh och RESV refresh meddelanden. Om det inte finns tillr\u00e4ckliga resurser att tillg\u00e5 n\u00e5gonstans l\u00e4ngs v\u00e4gen kommer den LSR:en att besvara ingress LSR som d\u00e5 f\u00e5r hitta en annan v\u00e4g eller misslyckas med LSP-upps\u00e4ttningen.</p>"},{"location":"cisco/Cisco_MPLS-TE/#konfiguration","title":"Konfiguration","text":"<p>RSVP konfigureras p\u00e5 alla enheter genom n\u00e4tverket och enableas p\u00e5 alla interface fl\u00f6dena ska traversera. Det beh\u00f6ver inte k\u00f6ras p\u00e5 alla enheter f\u00f6r att det ska funka men d\u00e5 kan man inte reservera bandbredd p\u00e5 dem heller.</p> <p><code>interface\u00a0Gi2</code> <code>ip\u00a0rsvp\u00a0bandwidth\u00a01000\u00a0100\u00a0\u00a0#kbps</code></p> <p>Om man inte specificerar total bandbredd och per-flow bandbredd kommer 75% av interfacets bandbredd kunna reserveras av ett enskilt fl\u00f6de.</p> <p>Verify</p> <p><code>show\u00a0ip\u00a0rsvp</code> <code>show\u00a0ip\u00a0rsvp\u00a0interface</code> <code>show\u00a0ip\u00a0rsvp\u00a0reservation</code></p> <p>Om man k\u00f6r LLQ/CBWFQ b\u00f6r man st\u00e4nga av RSVPs WFQ och klassificering.</p> <p><code>ip\u00a0rsvp\u00a0resource-provider\u00a0none</code> <code>ip\u00a0rsvp\u00a0data-packet\u00a0classification\u00a0none</code></p>"},{"location":"cisco/Cisco_MPLS-TE/#traffic-engineering","title":"Traffic Engineering","text":"<p>MPLS TE \u00e4r unidirectional tunnels fr\u00e5n source (head-end) till destination (tail-end) i form av LSP:er som anv\u00e4nds f\u00f6r att forwardera trafik. RSVP-TE Explicit Route Object (ERO) \u00e4r pathen f\u00f6r MPLS LSP som inkluderar en sekvenserad lista av LSR:er som LSP:n m\u00e5ste passera igenom mellan ingress och egress LSR. RSVP-TE anv\u00e4nder pathen som beskrivs i ERO f\u00f6r att signalera och s\u00e4tta upp LSP:n. Pathen kan vara admin specified eller automatiskt utr\u00e4knad p\u00e5 headend utifr\u00e5n en algoritm som constrained shortest path first (CSPF). Det finns strict path och loose path. Ingen LDP beh\u00f6vs.</p> <p>Traffic Parameter Attributes: TE metric, Maximum bandwidth, Maximum reservable bandwidth, Unreserved bandwidth, Administrative group.</p> <p>En sak som \u00e4r bra att k\u00e4nna till med RSVP-TE \u00e4r att om den prim\u00e4ra v\u00e4gen g\u00e5r ner (oavsett om det finns FRR eller inte) s\u00e5 kommer inte trafiken att skifta tillbaka till den ursprungliga v\u00e4gen direkt efter att felet \u00e4r \u00e5tg\u00e4rdat. Det kr\u00e4vs att head-end signalerar ber\u00f6rd LSP igen (kollar om det finns en mer optimal v\u00e4g). P\u00e5 b\u00e5de IOS och IOS XR sker detta periodiskt varje timme som standard. Det g\u00e5r \u00e4ven att signalera om en LSP manuellt. Om det finns en b\u00e4ttre v\u00e4g kommer trafiken att skiftas \u00f6ver till den med MBB (make before break).</p> <p>Konfiguration</p> <p><code>mpls\u00a0traffic-eng\u00a0tunnels</code></p> <p>Per interface, detta m\u00e5ste konfas p\u00e5 alla core-interface.</p> <p><code>interface\u00a0gi2</code> <code>mpls\u00a0traffic-eng\u00a0tunnels</code> <code>ip\u00a0rsvp\u00a0bandwidth</code></p> <p>IGP, OSPF anv\u00e4nder opaque LSA:er och IS-IS anv\u00e4nder nya TLV:er f\u00f6r att skicka TE attribut.</p> <p><code>router\u00a0ospf\u00a01</code> <code>mpls\u00a0traffic-eng\u00a0router-id\u00a0Loopback0</code> <code>mpls\u00a0traffic-eng\u00a0area\u00a00</code></p> <p><code>router\u00a0isis\u00a01</code> <code>mpls\u00a0traffic-eng\u00a0router-id\u00a0Loopback0</code> <code>mpls\u00a0traffic-eng\u00a0level-2</code></p> <p>Tunnel. F\u00f6r att tunneln ska anv\u00e4ndas m\u00e5ste man routa \u00f6ver den, detta kan t.ex. g\u00f6ras med statisk routing eller autoroute. Eftersom det inte \u00e4r en vanlig GRE-tunnel uppst\u00e5r ingen recursive routing. Record route anv\u00e4nds f\u00f6r loop detection.</p> <p><code>interface\u00a0Tunnel0</code> <code>ip\u00a0unnumbered\u00a0Loopback0</code> <code>tunnel\u00a0mode\u00a0mpls\u00a0traffic-eng</code> <code>tunnel\u00a0destination\u00a0x.x.x.x</code> <code>tunnel\u00a0mpls\u00a0traffic-eng\u00a0path-option\u00a01\u00a0dynamic</code> <code>tunnel\u00a0mpls\u00a0traffic-eng\u00a0autoroute\u00a0destination</code> <code>tunnel\u00a0mpls\u00a0traffic-eng\u00a0record-route</code></p> <p>Verify</p> <p><code>show\u00a0mpls\u00a0traffic-eng\u00a0tunnel</code> <code>show\u00a0ip\u00a0rsvp\u00a0interface</code> <code>show\u00a0ip\u00a0route</code> <code>show\u00a0ip\u00a0rsvp\u00a0reservation\u00a0detail</code></p> <p><code>traceroute\u00a0mpls\u00a0traffic-eng\u00a0tunnel\u00a00</code></p> <p>Dry run</p> <p><code>show\u00a0mpls\u00a0traffic-eng\u00a0topology\u00a0path\u00a0destination\u00a010.10.10.10\u00a0bandwidth\u00a050000</code> <code>show\u00a0mpls\u00a0traffic-eng\u00a0link-management\u00a0admission-control</code></p> <p>Logging, detta \u00e4r f\u00f6r att skicka traps.</p> <p><code>mpls\u00a0traffic-eng\u00a0logging\u00a0lsp</code> <code>mpls\u00a0traffic-eng\u00a0logging\u00a0tunnel</code></p> <p>Auto-Bandwidth Med auto-bw m\u00e4ter routern sj\u00e4lv trafikm\u00e4ngden p\u00e5 tunneln periodiskt. Sedan kan olika bw-reservationer signaleras allt eftersom utifr\u00e5n tunnels behov. Med statistics interval kan man t.ex. m\u00e4ta LSP:n i 60 sekunder och sedan fatta ett beslut. Man b\u00f6r k\u00e4nna till att auto-bw inte funkar klockrent med burstig trafik eftersom det inte alltid \u00e4r s\u00e5 snabbt i f\u00f6r\u00e4ndring. Underflow och Overflow \u00e4r tr\u00f6skelv\u00e4rden f\u00f6r event-baserad statistikinsamling. Detta \u00e4r inte heller alltid supersnabbt vid f\u00f6r\u00e4ndring. Det \u00e4r rekommenderat att k\u00f6ra: tunnel load-interval \\&lt; global sampling frequency \\&lt; tunnel adjust frequency.</p> <p><code>int\u00a0tun0</code> <code>tunnel\u00a0mpls\u00a0traffic-eng\u00a0auto-bw</code></p> <p>Notera att senaste requested/signaled bandwidth sparas i running config.</p> <p>TE - inter-area/multi-level IOS implementerar Inter-Area MPLS TE genom att definiera ett Explicit Route Object (ERO), dvs en explicit-path som inneh\u00e5ller adresser till ABR eller L1/L2-router som ett loose hop i path:en. Detta resulterar i en pseudo-dynamic path calculation d\u00e4r Head End dynamiskt kalkylerar cSPF till sin exit ABR. Den kommer sedan dynamiskt kalkylera exit path till n\u00e4sta ABR och s\u00e5 vidare tills man har n\u00e5tt tail end. Detta uppn\u00e5s genom en loose hop expanderas i den fullt definierade explicita path:en, dvs Head End och ABRs definierar de hop som finns i den egna lokala flooding domain.</p> <p><code>ip\u00a0explicit-path\u00a0name\u00a0INTER_AREA_TE\u00a0enable</code> <code>next-address\u00a0loose</code> <code>next-address\u00a0loose</code>"},{"location":"cisco/Cisco_MPLS-TE/#autotunnel-fast-reroute","title":"Autotunnel - Fast Reroute","text":"<p>RSVP-TE kan anv\u00e4nda sig av backup LSPer f\u00f6r snabbare konvergens. Med hj\u00e4lp av autotunnel backup kan dessa autoskapas efter behov och man beh\u00f6ver d\u00e4rmed inte assigna n\u00e5got till protected interfaces. Dynamiska backup NHOP/NNHOP tunnels skapas n\u00e4r en LSP requestar FRR protection, dvs tunnel signaleras n\u00e4r det finns n\u00e5got aktivt fl\u00f6de som ska skyddas och det finns alternativa v\u00e4gar. FRR f\u00f6redrar NNHOP \u00f6ver NHOP backup tunnels om b\u00e5da finns tillg\u00e4ngliga. F\u00f6r NNHOP FRR m\u00e5ste man ha record route.</p> <p>PLR</p> <p><code>mpls\u00a0traffic-eng\u00a0auto-tunnel\u00a0backup</code></p> <p>Head-end</p> <p><code>interface\u00a0Tunnel0</code> <code>tunnel\u00a0mpls\u00a0traffic-eng\u00a0fast-reroute</code></p> <p>SRLG SRLG-information distribueras med IGP och funkar endast f\u00f6r backup tunnels som \u00e4r skapade av Autotunnel backup.</p> <p><code>interface\u00a0Gi0/1</code> <code>mpls\u00a0traffic-eng\u00a0srlg\u00a01</code> <code>mpls\u00a0traffic-eng\u00a0srlg\u00a02</code> <code>!</code> <code>interface\u00a0Gi0/2</code> <code>mpls\u00a0traffic-eng\u00a0srlg\u00a02</code> <code>mpls\u00a0traffic-eng\u00a0srlg\u00a03</code> <code>!</code> <code>mpls\u00a0traffic-eng\u00a0auto-tunnel\u00a0backup</code> <code>mpls\u00a0traffic-eng\u00a0auto-tunnel\u00a0backup\u00a0srlg\u00a0exclude\u00a0force</code></p>"},{"location":"cisco/Cisco_MPLS-TE/#autotunnel-mesh","title":"Autotunnel - Mesh","text":"<p>Autoskapa tunnlar till alla PE:s som finns med i en acl.</p> <p><code>mpls\u00a0traffic-eng\u00a0auto-tunnel\u00a0mesh</code></p> <p><code>interface\u00a0Auto-Template1</code> <code>ip\u00a0unnumbered\u00a0Loopback0</code> <code>tunnel\u00a0mode\u00a0mpls\u00a0traffic-eng</code> <code>tunnel\u00a0destination\u00a0access-list\u00a01</code></p> <p><code>access-list\u00a01\u00a0permit\u00a01.1.1.1</code> <code>access-list\u00a01\u00a0permit\u00a01.1.1.2</code></p> <p>Primary, configure tunnels to directly connected neighbors.</p> <p><code>mpls\u00a0traffic-eng\u00a0auto-tunnel\u00a0primary\u00a0onehop</code></p>"},{"location":"cisco/Cisco_MPLS-TE/#inter-as-te","title":"Inter-AS TE","text":"<p>Med ASBR Forced Link Flooding kan man l\u00e5ta l\u00e4nkar som inte \u00e4r med i IGP att installeras i TE database som point-to-point. Man konfigurerar l\u00e4nken som passiv f\u00f6r MPLS TE och anger neighbor TE-ID och ip-adress.</p> <p><code>mpls\u00a0traffic-eng\u00a0passive-interface\u00a0nbr-te-id\u00a01.1.1.2\u00a0nbr-if-addr\u00a010.0.0.2\u00a0nbr-igp-id\u00a0isis\u00a049.0000.0000.0002.00</code></p>"},{"location":"cisco/Cisco_MPLS-TE/#multicast","title":"Multicast","text":"<p>Om man routar multicast i sitt core samtidigt som man k\u00f6r MPLE-TE med autoroute announce kommer RPF att titta p\u00e5 fel best path. Workaround \u00e4r att sl\u00e5 p\u00e5 att IGP h\u00e5ller tv\u00e5 set med best paths under SPF calculation, en f\u00f6r unicast (TE tunnels och physical interfaces) och en f\u00f6r multicast (endast physical interfaces).</p> <p><code>router\u00a0ospf\u00a01</code> <code>mpls\u00a0traffic-eng\u00a0multicast-intact</code></p>"},{"location":"cisco/Cisco_MPLS-TE/#ios-xr","title":"IOS-XR","text":""},{"location":"cisco/Cisco_MPLS-TE/#auto-tunnel-backup","title":"Auto-Tunnel Backup","text":"<p><code>ipv4\u00a0unnumbered\u00a0mpls\u00a0traffic-eng\u00a0lo0</code> <code>mpls\u00a0traffic-eng</code> <code>auto-tunnel\u00a0backup</code> <code>tunnel-id\u00a0min\u00a06000\u00a0max\u00a06500</code> <code>!</code> <code>interface\u00a0GigabitEthernet0/0/0/0</code> <code>auto-tunnel\u00a0backup</code></p> <p>Verify</p> <p><code>show\u00a0mpls\u00a0traffic-eng\u00a0auto-tunnel\u00a0backup\u00a0summary</code></p>"},{"location":"cisco/Cisco_MPLS-TE/#mesh","title":"Mesh","text":"<p><code>ipv4\u00a0unnumbered\u00a0mpls\u00a0traffic-eng\u00a0Loopback0</code> <code>ipv4\u00a0prefix-list\u00a0PE</code> <code>10\u00a0permit\u00a010.0.0.1/32</code> <code>20\u00a0permit\u00a010.0.0.2/32</code> <code>!</code> <code>mpls\u00a0traffic-eng</code> <code>auto-tunnel\u00a0mesh</code> <code>group\u00a01</code> <code>attribute-set\u00a0PE</code> <code>destination-list\u00a0PE</code> <code>!</code> <code>tunnel-id\u00a0min\u00a01000\u00a0max\u00a01499</code> <code>!</code> <code>attribute-set\u00a0auto-mesh\u00a0PE</code> <code>logging\u00a0events\u00a0lsp-status\u00a0state</code> <code>signalled-bandwidth\u00a0100\u00a0class-type\u00a00</code> <code>autoroute\u00a0announce</code> <code>fast-reroute</code> <code>record-route</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_MPLS/","title":"Cisco MPLS","text":"<p>Multiprotocol Label Switching (RFC 3031) \u00e4r protokoll som routrar kan anv\u00e4nda f\u00f6r att forwardera paket baserat p\u00e5 labels ist\u00e4llet f\u00f6r destination IP address. Routrarna kallas d\u00e5 LSR, Label Switch Router. Genom att separera forwarding decision fr\u00e5n destination IP address kan besluten baseras p\u00e5 andra faktorer s\u00e5som QoS eller Traffic Engineering. Det kan anv\u00e4ndas f\u00f6r vanlig unicast IP forwarding men ocks\u00e5 annat som t.ex. VPN-tj\u00e4nster. En grupp av paket som skall till ett visst destinationsn\u00e4t kommer vanligtvis att skickas samma v\u00e4g genom n\u00e4tverket. I MPLS grupperas dessa paket i klasser som kallas Forwarding Equivalence Class, FEC. Alla paket som tillh\u00f6r samma FEC skickas med samma label. En MPLS-header \u00e4r 4 bytes och inneh\u00e5ller bl.a. ett 20-bitars f\u00e4lt som \u00e4r den unika labeln. Bottom-of-stack bit, QoS marking och TTL finns ocks\u00e5 i headern. Olika protokoll kan anv\u00e4ndas f\u00f6r control plane, t.ex. LDP, MP-BGP eller Segment Routing. MPLS p\u00e5 Cisco-enheter anv\u00e4nder sig av CEF. MPLS g\u00e5r \u00e4ven att tunnla \u00f6ver IP (RFC 4023), se Cisco GRE.</p> <p>Se \u00e4ven MPLS-TE.</p>"},{"location":"cisco/Cisco_MPLS/#tables","title":"Tables","text":"<p>F\u00f6r varje VRF skapas det nya tabeller, show cef table | begin active</p> <p>RIB</p> <p><code>show\u00a0ip\u00a0route</code> <code>show\u00a0ip\u00a0route\u00a0vrf\u00a0NAME</code></p> <p>LIB, inneh\u00e5ller all labels known to LSR</p> <p><code>show\u00a0mpls\u00a0ldp\u00a0bindings</code> <code>show\u00a0mpls\u00a0ldp\u00a0binding\u00a0summary</code> <code>show\u00a0mpls\u00a0ldp\u00a0bindings\u00a0vrf\u00a0NAME</code></p> <p>FIB, anv\u00e4nds f\u00f6r paket utan label</p> <p><code>show\u00a0ip\u00a0cef</code> <code>show\u00a0ip\u00a0cef\u00a0vrf\u00a0NAME</code></p> <p>LFIB, anv\u00e4nds f\u00f6r paket med label</p> <p><code>show\u00a0mpls\u00a0forwarding-table</code> <code>show\u00a0mpls\u00a0forwarding-table\u00a0vrf\u00a0NAME</code></p>"},{"location":"cisco/Cisco_MPLS/#ldp","title":"LDP","text":"<p>F\u00f6r att veta vilka labels en LSR ska s\u00e4tta p\u00e5 paketen som ska skickas iv\u00e4g anv\u00e4nds Label Distribution Protocol (TDP \u00e4r legacy). Routrar bygger LDP-grannskap och utbyter sedan dynamiskt labels med varandra f\u00f6r att kunna bygga korrekta forwarding tables. Det fungerar ungef\u00e4r som ett routingprotokoll. F\u00f6r unicast IP routing s\u00e5 utbyts en label per prefix i routingtabellen, Cisco IOS anv\u00e4nder independent label distribution control. Dyker det upp n\u00e5got nytt i routingtabellen skapas en ny lokal label i LIB och sedan annonseras det till alla LDP-grannarna. P\u00e5 s\u00e5 s\u00e4tt kan en label-switched path (LSP) byggas. Dessa \u00e4r enkelriktade och en enskild LSR k\u00e4nner inte till hela pathen f\u00f6r det beh\u00f6vs inte. En label g\u00e5r aldrig l\u00e4ngre \u00e4n till grannen utan d\u00e4r poppas eller byts den mot n\u00e4sta routers label. MPLS l\u00e5ter routingtabellen och IGP st\u00e5 f\u00f6r path selection och d\u00e4rmed loop-prevention och convergence.</p> <p>LDP anv\u00e4nder sig utav tv\u00e5 sorts paket f\u00f6r att kommunicera. F\u00f6r neighbor discovery skickas Hello-paket till 224.0.0.2 UDP 646 var 5:e sekund. N\u00e4r grannskap \u00e4r bildat g\u00f6rs all informations\u00f6verf\u00f6ring (updates) med unicast som skickas p\u00e5 TCP 646.</p>   **LDP Hello:**    [](/File:Cisco_MPLS_LDP_Hello.PNG \"wikilink\")   <p>MPLS-n\u00e4tet m\u00e5ste anv\u00e4nda n\u00e5got routingprotokoll f\u00f6r att l\u00e4ra sig routes och dra nytta av label-annonsering, vanligtvis anv\u00e4nds ett IGP f\u00f6r detta. N\u00e4r en ny lokal label skapas, pga nyl\u00e4rd route fr\u00e5n IGP, annonseras det till alla LDP-grannarna (\u00e4ven den man fick route-uppdateringen ifr\u00e5n, frame-mode MPLS har inte h\u00f6rt talas om split horizon :). Detta h\u00e4nder f\u00f6r alla routes p\u00e5 alla LSR. Router-ID v\u00e4ljs p\u00e5 exakt samma s\u00e4tt som f\u00f6r OSPF. Om man har en LSR med LDP-grannskap till s\u00e4g 5 andra enheter s\u00e5 kommer alla grannskap g\u00e5 ner om man st\u00e4nger ett av sina 5 interface eftersom LDP skapar sitt ID utifr\u00e5n tillg\u00e4ngliga IGP interface. Det \u00e4ndras om ett interface f\u00f6rsvinner vilket det g\u00f6r om man t.ex. shutar ett av dem. Hold time ska kommas \u00f6verens om och \u00e4r default 15 sekunder (3x Hello). Om tv\u00e5 LSR inte kommer \u00f6verens om timers, label distribution method etc kan man \u00f6ka intevallet mellan f\u00f6rs\u00f6ken med mpls ldp backoff-kommandot. T.ex. fr\u00e5n 5 sekunder till att b\u00f6rja med till 120 sekunder mellan varje f\u00f6rs\u00f6k.</p> <p>Global</p> <p><code>mpls\u00a0label\u00a0protocol\u00a0ldp\u00a0\u00a0#Default</code> <code>mpls\u00a0ldp\u00a0router-id\u00a0loopback0\u00a0[force]</code> <code>show\u00a0mpls\u00a0ldp\u00a0parameters</code></p> <p>Man kan per interface sl\u00e5 p\u00e5 MPLS, h\u00f6ja MTU f\u00f6r att st\u00f6dja MPLS-headers och \u00e4ndra vilken adress som ldp ska bygga grannskap med. Om man har flera l\u00e4nkar till samma LSR och ska s\u00e4tta upp flera parallella LDP-sessioner m\u00e5ste man anv\u00e4nda samma transport address p\u00e5 alla interface. LDP RID anv\u00e4nds default som transport address.</p> <p><code>interface\u00a0gi1/1</code> <code>mpls\u00a0ip</code> <code>mpls\u00a0mtu\u00a01508</code> <code>mpls\u00a0ldp\u00a0discovery\u00a0transport-address\u00a0interface</code></p> <p>Verify</p> <p><code>show\u00a0mpls\u00a0interfaces\u00a0[vrf\u00a0NAME]</code> <code>show\u00a0mpls\u00a0ldp\u00a0neighbor</code> <code>show\u00a0mpls\u00a0ldp\u00a0discovery</code></p> <p>Graceful restart</p> <p><code>mpls\u00a0ldp\u00a0graceful-restart</code> <code>show\u00a0mpls\u00a0ldp\u00a0graceful-restart</code></p> <p>Allow MPLS forwarding for ip default route</p> <p><code>mpls\u00a0ip\u00a0default-route</code></p>"},{"location":"cisco/Cisco_MPLS/#labels","title":"Labels","text":"<p>Special-Purpose Label Values</p> <ul> <li>0 \u2013 IPv4 Explicit null \u2013 Instead of popping label at PHP, the second     last router sets top label to zero, this means EXP bits are     preserved.</li> <li>1 \u2013 Router alert \u2013 Alerts LSR that packet needs a closer look. Can\u2019t     be forwarded in hardware, software needed.</li> <li>2 \u2013 IPv6 Explicit null</li> <li>3 \u2013 Implicit null \u2013 Pop label</li> </ul> <p>Label range, default p\u00e5 IOS \u00e4r 16-1048575 (label range kan skilja beroende p\u00e5 modell). Att byta label range tar effekt n\u00e4r MPLS startas om, det g\u00f6rs snabbast med de globala kommadona no mpls ip -&gt; mpls ip.</p> <p><code>mpls\u00a0label\u00a0range\u00a0200-299</code> <code>show\u00a0mpls\u00a0label\u00a0range</code></p> <p>Advertisments Default p\u00e5 Cisco IOS allokeras och annonseras labels f\u00f6r allt, detta g\u00e5r att \u00e4ndra.</p> <p><code>no\u00a0mpls\u00a0ldp\u00a0advertise-label</code> <code>mpls\u00a0ldp\u00a0advertise-lable\u00a0for</code><code>to</code> <p>F\u00f6r att slippa h\u00e5lla koll p\u00e5 prefix-listor kan man konfigurera att det endast ska allokeras (och d\u00e4rmed annonseras) labels f\u00f6r /32-routes i RIB:en.</p> <p><code>mpls\u00a0ldp\u00a0label</code> <code>allocate\u00a0global\u00a0host-routes</code></p> <p>Label space</p> <p><code>show\u00a0mpls\u00a0ldp\u00a0discovery</code> <code>10.0.0.10:</code><code>0</code> <code>0\u00a0betyder\u00a0platform\u00a0wide\u00a0label\u00a0space</code> <code>1\u00a0betyder\u00a0interface\u00a0label\u00a0space</code></p> <p>Disable PHP</p> <p><code>mpls\u00a0ldp\u00a0explicit-null</code></p>"},{"location":"cisco/Cisco_MPLS/#ttl","title":"TTL","text":"<p>N\u00e4r en ingress E-LSR f\u00e5r in ett IP-paket s\u00e4nker den IP TTL med ett och sedan pushar den en label och kopierar TTLen till MPLS-headern. N\u00e4r sedan paketet traverserar en LSR s\u00e4nks endast MPLS-TTLen men vid egress E-LSR kopieras MPLS-TTLen till IP TTL och skickas vidare. Detta g\u00e5r att \u00e4ndra p\u00e5 s\u00e5 att IP-TTL inte kopieras utan MPLS-TTL s\u00e4tts till 255 av ingress E-LSR f\u00f6r att hela MPLS-n\u00e4tet verkligen ska vara som ett router hop. Detta beh\u00f6ver endast konfigureras p\u00e5 PE.</p> <p><code>no\u00a0mpls\u00a0ip\u00a0propagate-ttl</code></p>"},{"location":"cisco/Cisco_MPLS/#session-protection","title":"Session Protection","text":"<p>Om tv\u00e5 directly connected LDP-grannar tappar kontakten flushas alla bindings fr\u00e5n LIB. Men det beh\u00f6ver inte betyda att det inte fortfarande finns IP-reachability mellan dem en annan v\u00e4g. Session Protection \u00e4r en optimerings-feature som g\u00f6r att LIB inte flushas s\u00e5l\u00e4nge det finns en annan v\u00e4g till LDP-peer, targeted LDP s\u00e4tts d\u00e5 upp f\u00f6r att h\u00e5lla LIB synkat. Dvs om det slutar att komma in multicast hellos s\u00e5 skickas det unicast UDP-paket till grannes LDP transport address f\u00f6r att f\u00f6rhindra timeout. N\u00e4r sedan directly connected grannskapet kommer tillbaka beh\u00f6ver inte allt synkas om. Detta \u00e4r en global inst\u00e4llning och m\u00e5ste konfigureras p\u00e5 b\u00e5da sidor annars kommer inte andra sidan acceptera targeted hellos. Max hops \u00e4r 255 och f\u00f6r Hello och Hold time g\u00e4ller 10 sekunder respektive 90 sekunder default.</p> <p><code>mpls\u00a0ldp\u00a0session\u00a0protection</code> <code>mpls\u00a0ldp\u00a0discovery\u00a0targeted-hello\u00a0accept</code> <code>mpls\u00a0ldp\u00a0discovery\u00a0targeted-hello\u00a0holdtime\u00a030</code></p> <p><code>show\u00a0mpls\u00a0ldp\u00a0neighbor\u00a0detail\u00a0|\u00a0i\u00a0Targeted|Session</code></p> <p>B\u00e5de session protection och accept unicast hellos kan begr\u00e4nsas med ACL. Med show mpls ldp neighbor kommandot ser man att det finns en lista p\u00e5 Addresses bound to peer LDP Identity, det \u00e4r s\u00e5 de fattar vilka andra IP-adresser som kan anv\u00e4ndas f\u00f6r LDP-kommunikation. LDP session holdtime rekommenderas enligt f\u00f6ljande formel: Session Holdtime \\&lt;= (Hello holdtime - Hello interval) * 3</p>"},{"location":"cisco/Cisco_MPLS/#security","title":"Security","text":"<p>Med tcp-autentisering kan man s\u00e4kra LDP-kommunikationen. ACL ska tr\u00e4ffa LDP ID som andra sidan har och m\u00e5ste vara standard.</p> <p><code>ip\u00a0access-list\u00a0standard\u00a0LDP-PEERS</code> <code>permit\u00a0host\u00a010.0.0.5</code> <code>permit\u00a0host\u00a010.0.0.6</code> <code>mpls\u00a0ldp\u00a0password\u00a0required\u00a0for\u00a0LDP-PEERS</code> <code>mpls\u00a0ldp\u00a0neighbor\u00a010.0.0.5\u00a0password\u00a0SECRET</code></p> <p>Kr\u00e4v l\u00f6senord f\u00f6r alla LDP-grannskap. Om man inte har angett n\u00e5got l\u00f6senord f\u00f6r en specifik granne kommer fallback att anv\u00e4ndas om det finns konfigurerat.</p> <p><code>mpls\u00a0ldp\u00a0password\u00a0required</code> <code>mpls\u00a0ldp\u00a0password\u00a0fallback\u00a0SECRET</code></p> <p>Verify</p> <p><code>show\u00a0mpls\u00a0ldp\u00a0discovery\u00a0detail\u00a0|\u00a0i\u00a0Ethernet|Password</code></p>"},{"location":"cisco/Cisco_MPLS/#igp","title":"IGP","text":"<p>LDP g\u00e5r att autokonfa tillsammans med IS-IS och OSPF, dvs sl\u00e5 p\u00e5 LDP p\u00e5 de interface som \u00e4r aktiva i IGPn, detta kan antingen g\u00f6ras per interface eller under routingprocessen. Man kan \u00e4ven anv\u00e4nda prefix suppression s\u00e5 kommer det inte att genereras lika m\u00e5nga labels f\u00f6r ens core-n\u00e4tverk.</p> <p><code>router\u00a0ospf/isis\u00a01</code> <code>mpls\u00a0ldp\u00a0autoconfig</code></p> <p>Synchronization L\u00e4nkkostnaden f\u00f6r nyetablerade grannskap s\u00e4tts till max tills LDP \u00e4r klar med labelutbyte och ber\u00e4ttar f\u00f6r link-state IGP att det \u00e4r okej att anv\u00e4nda l\u00e4nken.</p> <p>LDP deklarerar LDP sync up s\u00e5 fort alla dessa n\u00f6dv\u00e4ndiga villkor \u00e4r uppfyllda.</p> <ul> <li>LDP session \u00e4r up</li> <li>LDP har skickat alla sina label bindings till \u00e5tminstone en peer</li> <li>LDP har tagit emot \u00e5tminstone en label binding ifr\u00e5n en peer</li> </ul> <p>Sl\u00e5 p\u00e5 det under IGP-processen.</p> <p><code>router\u00a0ospf/isis\u00a01</code> <code>mpls\u00a0ldp\u00a0sync</code></p> <p>Alternativt per interface.</p> <p><code>interface\u00a0gi2</code> <code>mpls\u00a0ldp\u00a0igp\u00a0sync</code></p> <p>P\u00e5 IOS-XE \u00e4r det rekommenderat att s\u00e4tta IGP sync holddown timer till n\u00e5got non-infinite f\u00f6r att undvika device isolation som kan uppst\u00e5 vid vissa felscenarion.</p> <p><code>mpls\u00a0ldp\u00a0igp\u00a0sync\u00a0holddown\u00a0120000</code></p> <p>Verify</p> <p><code>show\u00a0mpls\u00a0ldp\u00a0igp\u00a0sync</code> <code>show\u00a0mpls\u00a0interface\u00a0detail\u00a0|\u00a0i\u00a0Interface|IGP</code></p>"},{"location":"cisco/Cisco_MPLS/#vpn","title":"VPN","text":"<p>MPLS VPN (RFC 4364) \u00e4r en popul\u00e4r MPLS-applikation och det r\u00e4knas som trusted VPN. PHP f\u00f6r transport label anv\u00e4nds default f\u00f6r att slippa en lookup. F\u00f6r PE-PE label utbyten anv\u00e4nds MP-BGP, det kan dock g\u00e5 via route reflector precis som vanligt f\u00f6r \u00f6kad skalbarhet. F\u00f6r att VPN-trafik ska fungera m\u00e5ste PE ha en route till next-hop PE, det g\u00e5r ej med en default route. Control plane kommer att fungera men ej data plane eftersom forwardering med labels l\u00e4rda fr\u00e5n BGP endast fungerar om det finns en /32-route i RIB. F\u00f6r L2 VPN se Cisco VPLS och f\u00f6r multicast se Cisco MLDP. Det g\u00e5r \u00e4ven att integrera NAT med MPLS VPN.</p> <p><code>ip\u00a0bgp-community\u00a0new-format</code> <code>show\u00a0ip\u00a0bgp\u00a0community\u00a0?\u00a0\u00a0#</code><code>S\u00e5`` ``st\u00e5r`` ``det`` ``antingen`` ``aa:nn`` ``eller`` ``1-4294967295</code></p> <p>Route Distinguisher: \u00e4r ett 64-bitars nummer som skickas med BGP-uppdateringarna och anv\u00e4nds f\u00f6r att g\u00f6ra routes unika mellan VRFer. Det anv\u00e4nds med adressfamiljerna vpnv4 och vpnv6.</p> <p>Route Target: skickas med BGP-uppdateringarna som ett Extended Community PA. Det anv\u00e4nds f\u00f6r att best\u00e4mma vilken/vilka VRFer routsen ska in i.</p> <p>Import och export best\u00e4mmer vad som ska redistribueras mellan VRF och BGP.</p> <p>Add IBGP neighbor. Man konfar inte next-hop-self eftersom VPNv4 s\u00e4tter det default.</p> <p><code>router\u00a0bgp\u00a0100</code> <code>neighbor\u00a010.0.0.10\u00a0remote-as\u00a0100</code> <code>address-family\u00a0vpnv4\u00a0unicast</code> <code>send-community\u00a0extended</code></p> <p>Default \u00e4r att droppa VPNv4 updates f\u00f6r RTs som det inte finns n\u00e5gon lokal vrf f\u00f6r. Detta kan man \u00e4ndra p\u00e5.</p> <p><code>router\u00a0bgp\u00a0100</code> <code>no\u00a0bgp\u00a0default\u00a0route-target\u00a0filter</code></p> <p>Man kan d\u00f6lja MPLS-n\u00e4tet endast f\u00f6r VPN-kunder.</p> <p><code>no\u00a0mpls\u00a0ip\u00a0propagate-ttl\u00a0forwarded</code></p> <p>Label Mode avg\u00f6r hur det ska allokeras labels. Har man VPN-kunder med m\u00e5nga routes kan man av effektivitetssk\u00e4l byta till per-vrf mode och d\u00e5 kommer varje kund f\u00e5 en label per PE oavsett hur stor routingtabellen \u00e4r i den VRF:en och d\u00e4rmed sparas det minne. D\u00e4remot m\u00e5ste en routing lookup g\u00f6ras n\u00e4r paketet kommer fram eftersom alla paket har samma label oavsett var de ska. Det finns d\u00e4rf\u00f6r en mellanvariant som kallas per-ce d\u00e4r det allokeras en label per next-hop per vrf och man sparar minne samtidigt som man slipper routing lookup.</p> <p><code>mpls\u00a0label\u00a0mode\u00a0all-vrfs\u00a0protocol\u00a0all-afs\u00a0per-prefix\u00a0\u00a0#Default</code> <code>mpls\u00a0label\u00a0mode\u00a0all-vrfs\u00a0protocol\u00a0bgp-vpnv6\u00a0per-vrf</code> <code>mpls\u00a0label\u00a0mode\u00a0vrf\u00a0INTERNET\u00a0protocol\u00a0bgp-vpnv4\u00a0per-ce</code></p> <p>Man kan partitionera upp n\u00e4tverket genom att skapa RR-grupper som filtrerar p\u00e5 route-targets.</p> <p><code>address-family\u00a0vpnv4</code> <code>bgp\u00a0rr-group\u00a0EXTCOM-LIST</code></p>"},{"location":"cisco/Cisco_MPLS/#6vpe","title":"6VPE","text":"<p>6VPE (RFC 4659) \u00e4r en teknik f\u00f6r att k\u00f6ra IPv6 \u00f6ver IPv4 MPLS-n\u00e4t. Adressfamilj VPNv6 m\u00e5ste aktiveras p\u00e5 IPv4 iBGP-grannskapen mellan PEs/RRs. VPNv6 prefixen har en IPv4-mappad IPv6-adress som next-hop genom MPLS-n\u00e4tet och en IPv4 LSP finns mellan PEs. Next-hop-adressen m\u00e5ste finns i IPv4-routingtabellen och en LSP m\u00e5ste existera f\u00f6r destinationen.</p> <p><code>router\u00a0bgp\u00a0100</code> <code>address-family\u00a0vpnv6</code> <code>neighbor\u00a010.0.0.10\u00a0activate</code> <code>neighbor\u00a010.0.0.10\u00a0send-community\u00a0extended</code></p>"},{"location":"cisco/Cisco_MPLS/#inter-as-mpls-vpn","title":"Inter-AS MPLS VPN","text":"<p>Back to Back VRFs Option 10A PE anv\u00e4nder iBGP f\u00f6r att distribuera labeled VPN-routes inom sitt AS som vanligt. PE kommunicerar med andra sidan PE med ett sub-interface, l\u00e4nkn\u00e4t och eBGP-grannskap per VRF. Det kr\u00e4vs ingen MPLS mellan PE utan det \u00e4r unlabeled IP-adresser som annonseras. Detta \u00e4r dock inte den mest skalbara l\u00f6sningen.</p> <p>VPNv4 eBGP Option 10B PE anv\u00e4nder iBGP f\u00f6r att distribuera labeled VPN-routes inom sitt AS som vanligt. PE anv\u00e4nder sedan eBGP f\u00f6r att distribuera labeled VPN-routes till PE i ett annat AS, som i sin tur distribuerar dem till PE routrar i sitt AS. Det kan finnas flera v\u00e4gar mellan de olika AS f\u00f6r redundans och \u00f6kad kapacitet. Service Providers m\u00e5ste komma \u00f6verens om detta. Detta \u00e4r mer skalbart eftersom det r\u00e4cker med ett BGP-grannskap per koppling mellan AS. F\u00f6ljande fetmarkerade kommando sl\u00e5r p\u00e5 att /32-routes f\u00f6r eBGP-grannar autol\u00e4ggs in i RIB och d\u00e4rmed m\u00f6jligg\u00f6r label forwarding, s\u00e5 fungerar ej IOS XR utan d\u00e4r m\u00e5ste man l\u00e4gga till statiska routes manuellt.</p> <p><code>interface\u00a0GigabitEthernet1/0</code> <code>description\u00a0Connection\u00a0to\u00a0other\u00a0AS</code> <code></code><code>mpls`` ``bgp`` ``forwarding</code></p> <p><code>router\u00a0bgp\u00a0100</code> <code>no\u00a0bgp\u00a0default\u00a0route-target\u00a0filter</code> <code>neighbor\u00a02.2.2.2\u00a0remote-as\u00a0200</code> <code>neighbor\u00a010.0.0.10\u00a0description\u00a0iBGP</code> <code>address-family\u00a0vpnv4</code> <code>neighbor\u00a02.2.2.2\u00a0activate</code> <code>neighbor\u00a010.0.0.10\u00a0activate</code> <code>neighbor\u00a010.0.0.10\u00a0next-hop-self</code></p> <p><code>show\u00a0bgp\u00a0vpnv4\u00a0unicast\u00a0all\u00a0labels</code></p> <p>VPNv4 between RRs Option 10C (eller PEs using multihop eBGP)</p> <p>Ist\u00e4llet f\u00f6r att anv\u00e4nda PEs f\u00f6r att h\u00e5lla koll och distribuera VPN-routes bygger man grannskap mellan RRs i varje AS. Dock m\u00e5ste PE h\u00e5lla koll p\u00e5 labeled routes till alla andra PE/RR i sitt AS och skicka med eBGP till andra sidan AS s\u00e5 deras PE/RR hittar till PE/RR i det egna AS. D\u00e5 kan PE/RR i olika AS bygga eBGP multi-hop grannskap (det m\u00e5ste finnas LSP mellan dessa) och utbyta labeled VPN-routes. Om P routrar f\u00e5r k\u00e4nna till PE i andra AS fungerar det som vanligt med dubbla labels. Men om det d\u00e4remot inte \u00e4r uppsatt s\u00e5 m\u00e5ste det trippel labelas. En f\u00f6r kundens IP till egress PE, en satt av ASBR f\u00f6r egress PE och en f\u00f6r IGP next-hop. Anv\u00e4nder man RR \u00e4r detta ett v\u00e4ldigt skalbart alternativ.</p> <p><code>router\u00a0bgp\u00a0100</code> <code>neighbor\u00a010.0.0.10\u00a0description\u00a0eBGP</code> <code>address-family\u00a0vpnv4</code> <code>neighbor\u00a010.0.0.10\u00a0next-hop-unchanged</code></p> <p>Option AB Control plane: BGP VPNv4 Data plane: subinterfaces / back-to-back VRF Notera att option AB ej \u00e4r supporterat p\u00e5 IOS-XR.</p> <p><code>vrf\u00a0definition\u00a0VRF1</code> <code>address-family\u00a0ipv4</code> <code>inter-as-hybrid\u00a0next-hop\u00a010.0.0.2</code> <code>!</code> <code>router\u00a0bgp\u00a0100</code> <code>no\u00a0bgp\u00a0default\u00a0route-target\u00a0filter</code> <code>neighbor\u00a02.2.2.2\u00a0remote-as\u00a0200</code> <code>address-family\u00a0vpnv4</code> <code>neighbor\u00a02.2.2.2\u00a0activate</code> <code>neighbor\u00a02.2.2.2\u00a0inter-as-hybrid</code></p>"},{"location":"cisco/Cisco_MPLS/#bgp-lu","title":"BGP-LU","text":"<p>BGP Labeled Unicast (RFC 3107) tillhandah\u00e5ller MPLS-transport mellan IGP-dom\u00e4ner. Genom att annonsera loopbacks och label bindings g\u00e5r det att kommunicera med routrar \u00f6ver IGP-gr\u00e4nser. BGP-LU annonseras mellan edge routrar och transport-routrarna i mitten m\u00e4rker inget. De vanligaste use casen f\u00f6r BGP-LU \u00e4r Inter-AS MPLS VPN Option C, Seamless/Unified MPLS, CSC VPN och IGP free data center.</p> <p><code>router\u00a0bgp\u00a0100</code> <code>address-family\u00a0ipv4</code> <code>neighbor\u00a010.0.0.10\u00a0send-community\u00a0both</code> <code>neighbor\u00a010.0.0.10\u00a0next-hop-self</code> <code>neighbor\u00a010.0.0.10\u00a0send-label</code></p> <p>Show</p> <p><code>show\u00a0bgp\u00a0ipv4\u00a0unicast\u00a0labels</code></p> <p>Notera att man p\u00e5 IOS m\u00e5ste ha med set mpls-label i sina route-map entries om ska anv\u00e4nda route-maps f\u00f6r policy med BGP-LU.</p>"},{"location":"cisco/Cisco_MPLS/#icmp","title":"ICMP","text":"<p>MPLS Echo skickas unicast till LDP-grannen med L3 destination address 127.0.0.1 p\u00e5 UDP 3503.</p>   **Echo Request:**    [](/File:Cisco_MPLS_Echo_Request.png \"wikilink\")     **Echo Reply:**    [](/File:Cisco_MPLS_Echo_Reply.png \"wikilink\")   <p>Man kan med MPLS-ping testa konnektivitet till en FEC, s\u00e5 detta funkar endast ifr\u00e5n en LSR samt inga VPN-prefix fungerar heller utan endast det man l\u00e4rt sig med LDP.</p> <p><code>ping\u00a0mpls\u00a0ipv4\u00a010.1.1.1/32</code></p> <p>Med MPLS-traceroute kan man f\u00e5 ut mer information j\u00e4mf\u00f6rt med vanlig traceroute eftersom det skickas mer data i payloaden.</p> <p><code>traceroute\u00a0mpls\u00a0ipv4\u00a010.1.1.1/32</code></p>"},{"location":"cisco/Cisco_MPLS/#6pe","title":"6PE","text":"<p>IPv6 Provider Edge (RFC 4798) \u00e4r en teknik f\u00f6r att k\u00f6ra IPv6 \u00f6ver ett IPv4+MPLS-n\u00e4t. IPv6 prefix med tillh\u00f6rande label utbyts genom att skicka det med IPv4 iBGP mellan PEs (eller via route reflector). Alla IPv6-prefix finns i den globala routingtabellen till skillnad fr\u00e5n 6VPE. IPv6 prefixen har en IPv4-mappad IPv6-adress som next-hop inom MPLS-n\u00e4tet och IPv4 LSP:er anv\u00e4nds mellan 6PEs. Detta g\u00f6r att man inte beh\u00f6ver konfigurera next-hop-self. D\u00e4remot om IPv4-adressen inte finns i routingtabellen eller om det inte finns n\u00e5gon LSP kommer IPv6-prefixet att st\u00e5 som inaccessible.</p> <p><code>router\u00a0bgp\u00a0100</code> <code>address-family\u00a0ipv6</code> <code>neighbor\u00a010.0.0.10\u00a0activate</code> <code>neighbor\u00a010.0.0.10\u00a0send-label</code></p> <p><code>show\u00a0bgp\u00a0ipv6\u00a0unicast\u00a0labels</code></p>"},{"location":"cisco/Cisco_MPLS/#ios-xr","title":"IOS-XR","text":"<p><code>mpls\u00a0ldp</code> <code>log</code> <code>hello-adjacency</code> <code>neighbor</code> <code>graceful-restart</code> <code>session-protection</code> <code>!</code> <code>graceful-restart</code> <code>discovery</code> <code>targeted-hello\u00a0holdtime\u00a030</code> <code>targeted-hello\u00a0interval\u00a010</code> <code>!</code> <code>router-id\u00a010.10.0.101</code> <code>neighbor</code> <code>password\u00a0encrypted\u00a010422A2A0D33371D030A796571</code> <code>!</code> <code>session\u00a0protection</code> <code>address-family\u00a0ipv4</code> <code>discovery\u00a0targeted-hello\u00a0accept</code> <code>label</code> <code>local</code> <code>allocate\u00a0for\u00a0host-routes</code> <code>advertise</code> <code>explicit-null</code></p> <p><code>router\u00a0isis\u00a01</code> <code>address-family\u00a0ipv4\u00a0unicast</code> <code>mpls\u00a0ldp\u00a0auto-config</code></p> <p>Verify</p> <p><code>show\u00a0mpls\u00a0interfaces</code> <code>show\u00a0isis\u00a0mpls\u00a0ldp</code></p> <p>Unified MPLS ABR/RR, f\u00f6r att next-hop-self ska funka.</p> <p><code>router\u00a0bgp\u00a0100</code> <code>ibgp\u00a0policy\u00a0out\u00a0enforce-modifications</code></p> <p>RR (som m\u00e5ste finnas i data path) kan st\u00e5 f\u00f6r att stoppa in alla PE-prefix (/32) i bgp-tabellen.</p>"},{"location":"cisco/Cisco_MPLS/#nx-os","title":"NX-OS","text":"<p>F\u00f6ruts\u00e4ttningar</p> <p><code>install\u00a0feature-set\u00a0mpls</code> <code>feature-set\u00a0mpls</code> <code>feature\u00a0mpls\u00a0l3vpn</code> <code>feature\u00a0mpls\u00a0ldp</code></p> <p><code>interface\u00a0loopback\u00a01</code> <code>ip\u00a0address\u00a010.0.0.1/24</code></p> <p><code>mpls\u00a0ldp\u00a0configuration</code> <code>session\u00a0protection</code> <code>router-id\u00a0loopback\u00a01</code></p> <p>Aktivera p\u00e5 interface</p> <p><code>interface\u00a0e1/1</code> <code>mpls\u00a0ip</code></p> <p>Synk med routing protokoll</p> <p><code>router\u00a0isis\u00a0P1</code> <code>mpls\u00a0ldp\u00a0sync</code></p> <p>Authentication</p> <p><code>ip\u00a0prefix-list</code><code>permit</code><code>/32</code> <code>mpls\u00a0ldp\u00a0configuration</code> <code>password\u00a0required\u00a0for</code> <code>password\u00a0option\u00a01\u00a0for</code><code>key-chain</code> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_MST/","title":"Cisco MST","text":"<p>Multiple Spanning Tree Protocol, IEEE 802.1s, anv\u00e4nder algoritm Rapid ST och konvergerar snabbt. Man kan konfigurera s\u00e5 m\u00e5nga topologier som man vill ha. Alla VLAN som inte specificeras i n\u00e5gon instans hamnar i instans 0 som default. Pathcost method beh\u00f6ver inte konfigureras utan operational value \u00e4r alltid long till skillnad fr\u00e5n andra STP-varianter. Se Cisco STP. MST-konfiguration g\u00e5r \u00e4ven att distribuera med hj\u00e4lp av VTPv3.</p>"},{"location":"cisco/Cisco_MST/#mst-bpdu","title":"MST BPDU","text":"<p>MST anv\u00e4nder en BPDU f\u00f6r att skicka information om alla instanser.</p>   Exempel    [](/File:Cisco_MST_BPDU.png \"wikilink\")   <p>Topology change Den enda g\u00e5ng en topologi\u00e4ndring anses h\u00e4nda \u00e4r n\u00e4r en non-edge port g\u00e5r fr\u00e5n non-forwarding till forwarding. Den nya portan kan ha en b\u00e4ttre v\u00e4g f\u00f6r MAC-adresserna och CAM-tabellen m\u00e5ste uppdateras. G\u00e5r en port fr\u00e5n forwarding till non-forwarding spelar det ingen roll f\u00f6r d\u00e5 \u00e4r de MAC-adresserna unreachable, dyker de upp n\u00e5gon annanstans \u00e4r det f\u00f6r att n\u00e5gon annan port har g\u00e5tt fr\u00e5n non-forwarding till forwarding och d\u00e5 \u00e4r det en topologi\u00e4ndring iallafall. Med MST floodas BPDUer med TC-biten satt till alla non-edge designated ports och root port f\u00f6rutom porten d\u00e4r \u00e4ndringen kom in p\u00e5. \u00c4ven s\u00e5 flushas alla MAC-adresser p\u00e5 den porten. F\u00f6r att MST ska kunna tillhandah\u00e5lla snabb konvergens m\u00e5ste alla inter-switchl\u00e4nkar m\u00e5ste vara p2p och alla portar mot end systems m\u00e5ste vara edge ports annars kommer prestandan att degraderas.</p>"},{"location":"cisco/Cisco_MST/#region-interoperability","title":"Region Interoperability","text":"<p>MST instance 0 kallas Internal Spanning Tree (IST) och det \u00e4r den som anv\u00e4nds f\u00f6r att interagera med andra MST-regioner och STP-protokoll. Det g\u00f6r att MST-regionen ser ut som en enda stor switch f\u00f6r utsidan. STP-dom\u00e4ner kan kopplas ihop p\u00e5 flera st\u00e4llen vilket kan leda till loopar d\u00e4rf\u00f6r skapar MST en Common Spanning Tree (CST) som inneh\u00e5ller alla inter region links. Andra STP-protokoll vet ej att de deltar i en CST. Detta kan sedan kopplas ihop med varje IST f\u00f6r att skapa Common and Internal Spanning Tree (CIST) som omfattar hela topologin som d\u00e4rmed h\u00e5llas loopfri. Eftersom varje region har en egen rotbrygga kan det finnas flera CIST Regional Root Switches men det kan endast finnas en CIST Root. Den med b\u00e4st Bridge ID av alla switchar i alla regioner blir CIST. Alla andra regionala root v\u00e4ljs utifr\u00e5n l\u00e4gst cost till CIST och inte BID.</p> <p>650px</p>"},{"location":"cisco/Cisco_MST/#konfiguration","title":"Konfiguration","text":"<p>F\u00f6ljande element m\u00e5ste vara identiska p\u00e5 alla switchar inom samma MST region:</p> <ul> <li>region name</li> <li>revision number</li> <li>instances</li> </ul> <p><code>spanning-tree\u00a0extend\u00a0system-id</code> <code>spanning-tree\u00a0mode\u00a0mst</code> <code>spanning-tree\u00a0mst\u00a0configuration</code> <code>name\u00a0Site1</code> <code>revision\u00a01</code> <code>instance\u00a01\u00a0vlan\u00a01-2000</code> <code>instance\u00a02\u00a0vlan\u00a02001-4094</code> <code>show\u00a0current</code></p> <p>Root, priority 0 \u00e4r det absolut l\u00e4gsta medans root primary s\u00e4tter prio till 24k f\u00f6rutsatt att det ger root-rollen, detta \u00e4ndras inte dynamiskt.</p> <p><code>spanning-tree\u00a0mst\u00a01\u00a0root\u00a0primary</code> <code>spanning-tree\u00a0mst\u00a02\u00a0priority\u00a00</code> <code>spanning-tree\u00a0mst\u00a00\u00a0root\u00a0primary\u00a0diameter\u00a07\u00a0hello-time\u00a02</code></p> <p>Port Cost &amp; Priority</p> <p><code>interface\u00a0Gi0/1</code> <code>spanning-tree\u00a0mst\u00a01\u00a0cost\u00a050</code> <code>spanning-tree\u00a0mst\u00a01\u00a0port-priority\u00a0128</code></p> <p>Verify</p> <p><code>show\u00a0spanning-tree\u00a0mst</code> <code>show\u00a0spanning-tree\u00a0mst\u00a0interface</code></p> <p><code>spanning-tree\u00a0logging</code> <code>test\u00a0spanning-tree\u00a0diameter\u00a03</code> <code>test\u00a0spanning-tree\u00a0get\u00a0configuration\u00a0mst</code></p> <p>Mappa alla secondary vlan till samma MST-instans som deras primary VLAN befinner sig i, se \u00e4ven Private VLAN.</p> <p><code>spanning-tree\u00a0mst\u00a0configuration</code> <code>private-vlan\u00a0synchronize</code></p> <p>MST b\u00f6rjade implementeras av tillverkarna innan standarden var helt spikad vilket man b\u00f6r t\u00e4nka p\u00e5 om man k\u00f6r gamla enheter. Dock s\u00e4ger standarden att pre-standard MST-grannar m\u00e5ste kunna uppt\u00e4ckas automatiskt av kompabilitetssk\u00e4l. I normalfallet m\u00e4rker man ingenting men om grannen \u00e4r tyst, t.ex. en root port, kan man sl\u00e5 p\u00e5 det per interface.</p> <p><code>interface\u00a0gi0/7</code> <code>spanning-tree\u00a0mst\u00a0pre-standard</code></p> <p><code>show\u00a0spanning-tree\u00a0mst\u00a0configuration\u00a0digest</code></p>"},{"location":"cisco/Cisco_MST/#nexus","title":"Nexus","text":"<p>Grundkonf f\u00f6r NX-OS.</p> <p><code>spanning-tree\u00a0mode\u00a0mst</code> <code>spanning-tree\u00a0mst\u00a0configuration</code> <code>name\u00a0DC1</code> <code>revision\u00a01</code> <code>exit</code></p> <p><code>spanning-tree\u00a0mst\u00a00\u00a0priority\u00a032768</code> <code>spanning-tree\u00a0pathcost\u00a0method\u00a0long</code> <code>spanning-tree\u00a0port\u00a0type\u00a0edge\u00a0default</code> <code>spanning-tree\u00a0port\u00a0type\u00a0edge\u00a0bpduguard\u00a0default</code> <code>spanning-tree\u00a0port\u00a0type\u00a0edge\u00a0bpdufilter\u00a0default</code> <code>spanning-tree\u00a0loopguard\u00a0default</code></p>"},{"location":"cisco/Cisco_MST/#extensions","title":"Extensions","text":"<p>Det finns m\u00e5nga till\u00e4gg till spanning-tree som kan \u00f6ka stabilitet och s\u00e4kerhet. Dessa agerar frist\u00e5ende fr\u00e5n varandra f\u00f6rutom att de g\u00e5r att konfigurera ihop. Detta \u00e4r till\u00e4gg f\u00f6r protokoll som k\u00f6r Rapid ST.</p> <p><code>show\u00a0spanning-tree\u00a0summary</code></p>"},{"location":"cisco/Cisco_MST/#portfast","title":"PortFast","text":"<p>N\u00e4r en vanlig port aktiveras s\u00e5 initierar RSTP sin synk-process f\u00f6r snabb konvergens. Om andra sidan t.ex. \u00e4r en server s\u00e5 kommer den inte att k\u00f6ra STP och inget sync response kommer att skickas tillbaka. Detta g\u00f6r att RSTP m\u00e5ste falla tillbaka till legacy STP-regler och v\u00e4nta p\u00e5 att forward delay ska g\u00e5 ut innan l\u00e4nken blir i forwarding state. Med PortFast definierar man edge ports, dessa g\u00e5r direkt till forwarding n\u00e4r de kommer upp och inget topology change event genereras. En edge port skickar ut BDPUer men f\u00f6rv\u00e4ntar sig inga tillbaks. Om det kommer in en BPDU slutar porten vara edge port och \u00e5terg\u00e5r till normal tills interfacet g\u00e5r down/up. Anv\u00e4nds f\u00f6r anslutningar ut till servrar och andra end hosts. Ibland \u00e4r PortFast ett m\u00e5ste pga att DHCP hinner timea ut innan porten blivit forwarding.</p> <p>Globalt, aktiveras p\u00e5 alla portar i operational state: access</p> <p><code>spanning-tree\u00a0portfast\u00a0default</code></p> <p>Per interface, on/off</p> <p><code>spanning-tree\u00a0portfast</code> <code>spanning-tree\u00a0portfast\u00a0disable</code></p> <p>Verify</p> <p><code>show\u00a0spanning-tree\u00a0interface\u00a0gi0/10\u00a0portfast</code></p> <p>Vill man ha portfast p\u00e5 en trunk m\u00e5ste man st\u00e4lla det per interface</p> <p><code>spanning-tree\u00a0portfast\u00a0trunk</code></p> <p>K\u00f6r aldrig portfast mot andra switchar! MST och RSTP har tekniker f\u00f6r att vara snabba \u00e4nd\u00e5.</p>"},{"location":"cisco/Cisco_MST/#bpdu-guard","title":"BPDU Guard","text":"<p>BPDU Guard \u00e4r en s\u00e4kerhetsmekanism som s\u00e4tter interface i error disable om det kommer en BPDU. %PM-4-ERR_DISABLE: bpduguard error detected on Po2, putting Gi0/8 in err-disable state</p> <p>Globalt, skyddar alla PortFast-portar</p> <p><code>spanning-tree\u00a0bpduguard\u00a0default</code></p> <p>Per interface, on/off</p> <p><code>spanning-tree\u00a0bpduguard\u00a0enable</code> <code>spanning-tree\u00a0bpduguard\u00a0disable</code></p> <p>Auto recovery</p> <p><code>errdisable\u00a0recovery\u00a0cause\u00a0bpduguard</code></p>"},{"location":"cisco/Cisco_MST/#root-guard","title":"Root Guard","text":"<p>Skydda s\u00e5 att ingen annan \u00e4n den enhet man sj\u00e4lv har konfigurerat kan bli root genom att ignorera superior BPDUer som kommer in p\u00e5 portar med Root Guard p\u00e5slaget. Om det kommer in en superior BPDU s\u00e5 hamnar porten i root-inconsistent blocking state och frames varken forwardas eller tas emot. Porten g\u00e5r automatiskt tillbaka n\u00e4r dessa BPDUer slutar att komma in. %SPANTREE-2-ROOTGUARD_BLOCK: Root guard blocking port GigabitEthernet0/8 on VLAN0002.</p> <p>Per interface</p> <p><code>spanning-tree\u00a0guard\u00a0root</code></p>"},{"location":"cisco/Cisco_MST/#bpdu-filter","title":"BPDU Filter","text":"<p>En edge port skickar BPDUer som vanligt enligt Hello-interval men om det inte finns n\u00e5got som talar STP p\u00e5 andra sidan \u00e4r detta on\u00f6digt. Med BPDU filter p\u00e5slaget slutar switchen att skicka BPDUer efter 10 obesvarade (det skickas \u00e4ven en BDPU direkt vid link up s\u00e5 11 totalt). Porten \u00e4r dock beredd p\u00e5 att behandla BPDUer och BDPU-filter inaktiveras ifall det kommer in en BPDU vilket g\u00f6r att detta \u00e4r ett n\u00e5gorlunda mindre os\u00e4kert s\u00e4tt att terminera sin STP-dom\u00e4n p\u00e5.</p> <p>Globalt, g\u00e4ller alla PortFast-portar</p> <p><code>spanning-tree\u00a0portfast\u00a0bpdufilter\u00a0default</code></p> <p>Man kan ocks\u00e5 h\u00e5rdst\u00e4lla BPDU-filter per interface om man t.ex. ska splita ett n\u00e4tverk i olika STP-dom\u00e4ner. Inga BPDUer kommer att skickas eller behandlas.</p> <p>Per interface, hard on/off</p> <p><code>spanning-tree\u00a0bpdufilter\u00a0enable</code> <code>spanning-tree\u00a0bpdufilter\u00a0disable</code></p>"},{"location":"cisco/Cisco_MST/#loop-guard","title":"Loop Guard","text":"<p>Unidirectional links kan st\u00e4lla till det f\u00f6r en L2-dom\u00e4n. Med Loop Guard stoppar man den vanliga STP-konvergeringen f\u00f6r root och alternate portar. Eftersom det ska komma in BPDUer p\u00e5 vissa portar \u00e4r det inte normalt att det pl\u00f6tsligt inte g\u00f6r det l\u00e4ngre utan att l\u00e4nken har g\u00e5tt ner. Loop Guard f\u00f6rhindrar dessa portar fr\u00e5n att bli designated utan de hamnar ist\u00e4llet i loop-inconsistent blocking state. N\u00e4r det kommer BPDUer igen \u00e5terg\u00e5r portarna till normalt tillst\u00e5nd. Loop Guard fungerar endast p\u00e5 point-to-point l\u00e4nkar. %SPANTREE-2-LOOPGUARD_BLOCK: Loop guard blocking port GigabitEthernet0/8 on VLAN0002.</p> <p>Globalt, skyddar alla root- och alternate-portar</p> <p><code>spanning-tree\u00a0loopguard\u00a0default</code></p> <p>Per interface</p> <p><code>spanning-tree\u00a0guard\u00a0loop</code></p>"},{"location":"cisco/Cisco_MST/#bridge-assurance","title":"Bridge Assurance","text":"<p>Bridge Assurance \u00e4r en ut\u00f6kning till Loop Guard och det fungerar med RSTP och MST. Sl\u00e5r man p\u00e5 det s\u00e5 skickar b\u00e5da sidor alltid BPDUer oavsett port state och BPDUerna anv\u00e4nds som en Hello-mekanism f\u00f6r att se om grannen lever. BPDU agerar allts\u00e5 keepalive message och skickas per-vlan eller per-instans beroende p\u00e5 STP mode. Kommer det inte in n\u00e5gon BPDU hamnar porten i BA-inconsistent blocking state tills BPDU \u00e5ter mottages. B\u00e5da sidor av l\u00e4nken m\u00e5ste allts\u00e5 sl\u00e5 ig\u00e5ng Bridge Assurance. Detta skyddar mot unidirectional links eftersom de error disableas men \u00e4ven vid loopar orsakade av switchar som slutat prata STP men \u00e4nd\u00e5 forwarderar frames. BA prunear ocks\u00e5 on\u00f6diga VLAN p\u00e5 trunkl\u00e4nkar. Detta \u00e4r en Nexus-feature men finns \u00e4ven i nyare versioner av IOS.</p> <p>Global</p> <p><code>spanning-tree\u00a0bridge\u00a0assurance</code></p> <p>Per interface</p> <p><code>spanning-tree\u00a0portfast\u00a0network</code></p>"},{"location":"cisco/Cisco_MST/#pvst-simulation","title":"PVST Simulation","text":"<p>MST kan samk\u00f6ras med Rapid PVST+ utan n\u00e5gon speciell konfiguration. Detta \u00e4r en feature p\u00e5 Nexus-switchar och nyare IOS och det sl\u00e5ss p\u00e5 n\u00e4r man konfigurerar MST. Man kan st\u00e4nga av PVST simulation globalt eller per port, det som h\u00e4nder d\u00e5 \u00e4r att en port som f\u00e5r in en Rapid PVST+ BPDU hamnar i blocking state tills det slutar komma BPDUer. Rotbryggan f\u00f6r alla VLAN m\u00e5ste finnas p\u00e5 samma sida, antingen i MST eller i PVST+. Om man inte uppfyller detta kommer porten att hamna i PVST simulation-inconsistent state dvs forwarding st\u00e4ngs av.</p> <p><code>interface\u00a0Gi0/2</code> <code>spanning-tree\u00a0mst\u00a0simulate\u00a0pvst</code></p>"},{"location":"cisco/Cisco_MST/#others","title":"Others","text":"<p>Dispute mechanism inneb\u00e4r att role och state hos porten som skickar en BPDU skickas med i BPDUn s\u00e5 andra sidan vet att den inte pratat med en designated port p\u00e5 en designated port. D\u00e5 hamnar porten i discarding state. Detta \u00e4r p\u00e5slaget default och beh\u00f6ver inte konfigureras. Fungerar dock inte med de \u00e4ldsta varianterna av STP.</p> <p>UDLD Se Cisco UDLD</p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_MVPN/","title":"Cisco MVPN","text":"<p>Multicast VPN (MVPN) m\u00f6jligg\u00f6r multicast \u00f6ver L3VPN. En viktig komponent f\u00f6r MVPN \u00e4r BGP, safi MVPN kan g\u00f6ra tv\u00e5 saker: Auto-Discovery routes och C-mcast signaling. PE-CE \u00e4r alltid PIM men underlay i core kan g\u00f6ras p\u00e5 en m\u00e4ngd olika s\u00e4tt och st\u00e4m d\u00e4rf\u00f6r alltid av med Ciscos dokumentation \u00f6ver MVPN-profilerna.</p> <ul> <li>IOS: https://www.cisco.com/c/en/us/support/docs/ip/multicast/118985-configure-mcast-00.html</li> <li>IOS-XR: https://www.cisco.com/c/en/us/support/docs/ip/multicast/200512-Configure-mVPN-Profiles-within-Cisco-IOS.html</li> </ul> <p>Cisco_MVPN.PNG</p>"},{"location":"cisco/Cisco_MVPN/#mldp","title":"MLDP","text":"<p>Multicast Label Distribution Protocol (MLDP) \u00e4r en extension till LDP som anv\u00e4nds f\u00f6r att s\u00e4tta upp P2MP och MP2MP LSP:er i MPLS-n\u00e4tverk. I overlay (allt som har med vpn/vrf context att g\u00f6ra) kan man anv\u00e4nda PIM och/eller BGP f\u00f6r control plane. Det finns \u00e4ven in-band signaling med MLDP, det man g\u00f6r i praktiken \u00e4r att stitcha ihop customer pim tree med MLDP LSP:er i core. Detta \u00e4r inte superskalbart eftersom P-noder m\u00e5ste h\u00e5lla state f\u00f6r kunders multicast-tr\u00e4d. I varje MLDP-tr\u00e4d finns en root, f\u00f6r att l\u00f6sa root node redundancy kan man antingen k\u00f6ra med en phantom root (olika maskl\u00e4ngd p\u00e5 loopbacks) eller med tv\u00e5 parallella root-noder. Det senare kr\u00e4ver mer state men har snabbare konvergens eftersom all signalering redan \u00e4r gjord. Eftersom alla \u00e4r med i b\u00e5da tr\u00e4d kan man skicka multicaststr\u00f6mmar i valfritt tr\u00e4d. Med MLDP swapas label per hop men det finns ingen PHP. Det finns st\u00f6d f\u00f6r FRR.</p> <p>MLDP utbyts som en capability, alla plattformar har inte st\u00f6d f\u00f6r MLDP.</p> <p><code>show\u00a0mpls\u00a0ldp\u00a0capabilities</code> <code>show\u00a0mpls\u00a0mldp\u00a0neighbors</code></p> <p>Core tree types. Ciscos namn kontra RFC:</p> <ul> <li>Default MDT = Multi-directional inclusive PMSI</li> <li>Data MDT = Selective PMSI</li> <li>Partitioned MDT = Multi-directional selective PMSI</li> </ul> <p></p> <p></p>"},{"location":"cisco/Cisco_MVPN/#ios","title":"IOS","text":"<p>Konfiguration</p> <p><code>ip\u00a0multicast\u00a0mpls\u00a0mldp</code> <code>mpls\u00a0mldp\u00a0logging\u00a0notifications</code></p> <p>Exempel</p> <p><code>ip\u00a0multicast-routing\u00a0vrf\u00a0VPN_A\u00a0distributed</code> <code>!</code> <code>vrf\u00a0definition\u00a0VPN_A</code> <code>vpn\u00a0id\u00a0100:100</code> <code>address-family\u00a0ipv4</code> <code>mdt\u00a0default\u00a0mpls\u00a0mldp\u00a011.11.11.11</code> <code>mdt\u00a0data\u00a0mpls\u00a0mldp\u00a0110</code> <code>mdt\u00a0data\u00a0threshold\u00a030</code></p> <p>Verify</p> <p><code>show\u00a0ip\u00a0multicast\u00a0mpls\u00a0vif</code> <code>show\u00a0mpls\u00a0mldp\u00a0database\u00a0brief</code> <code>show\u00a0mpls\u00a0mldp\u00a0root</code> <code>ping\u00a0mpls\u00a0mldp\u00a0mp2mp</code><code>mdt</code><code>0</code> <p>Det finns ingen MBB by default.</p> <p><code>mpls\u00a0mldp\u00a0make-before-break\u00a0delay\u00a05000</code></p>"},{"location":"cisco/Cisco_MVPN/#ios-xr","title":"IOS-XR","text":"<p>Konfiguration</p> <p><code>multicast-routing</code> <code>address-family\u00a0ipv4</code> <code>interface\u00a0Loopback0</code> <code>enable</code> <code>!</code> <code>mpls\u00a0ldp</code> <code>mldp</code> <code>logging\u00a0notifications</code></p> <p>Verify</p> <p><code>show\u00a0mpls\u00a0forwarding\u00a0p2mp</code> <code>show\u00a0mpls\u00a0mldp\u00a0forwarding</code> <code>show\u00a0mrib\u00a0mpls\u00a0forwarding</code></p> <p>Om man k\u00f6r t.ex. Segment Routing har man inget behov av LDP, d\u00e5 kan man k\u00f6ra MLDP only.</p> <p><code>mpls\u00a0ldp</code> <code>capabilities\u00a0sac\u00a0mldp-only</code></p> <p>MoFRR MoFRR bygger tv\u00e5 tr\u00e4d, egress PE m\u00e5ste ha IGP ecmp till ingress PE.</p> <p><code>mpls\u00a0ldp</code> <code>mldp</code> <code>address-family\u00a0ipv4</code> <code>mofrr</code></p>"},{"location":"cisco/Cisco_MVPN/#unified-mpls","title":"Unified MPLS","text":"<p>MVPN \u00f6ver unified MPLS eller Inter-AS MPLS option C funkar faktiskt men det \u00e4r en v\u00e4xel man m\u00e5ste sl\u00e5 p\u00e5 i egress PE.</p> <p>IOS-XE</p> <p><code>mpls\u00a0mldp\u00a0forwarding\u00a0recursive-fec</code></p> <p>IOS-XR</p> <p><code>mpls\u00a0ldp\u00a0mldp\u00a0address-family\u00a0ipv4\u00a0recursive-fec</code></p> <p></p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_Multicast/","title":"Cisco Multicast","text":"<p>IP Multicast \u00e4r att skicka ett meddelande fr\u00e5n en source till multipla destinationer i en str\u00f6m \u00f6ver ett IP-n\u00e4t, vilket kan spara v\u00e4ldigt mycket bandbredd. En multicast-IP \u00e4r en destinationsadress och alla som ska ta del av trafiken m\u00e5ste g\u00e5 med i samma multicastgrupp, dvs lyssna p\u00e5 den IPn och meddela det till intermediate systems. End systems och routrar pratar IGMP med varandra f\u00f6r att ta reda p\u00e5 vem som \u00e4r med i vilken multicastgrupp. F\u00f6r att routrar ska kunna veta vilka n\u00e4t som har intressenter av multicaststr\u00f6mmar anv\u00e4nds n\u00e5got routing eller signaleringsprotokoll (control plane), DVMRP, MOSPF eller PIM. F\u00f6r loop prevention anv\u00e4nds RPF, inga paket forwarderas utan att klara denna check. IP Multicast fungerar f\u00f6r protokoll som \u00e4r connectionless.</p> <p>F\u00f6r konfiguration se Cisco PIM, Cisco IGMP och Cisco MLDP. \u00c4ven om framtiden kanske stavas Bit Indexed Explicit Replication.</p> <p>"},{"location":"cisco/Cisco_Multicast/#multicast-addressing","title":"Multicast Addressing","text":"<p>Multicast har egna address spaces, f\u00f6r IPv4 anv\u00e4nds 224.0.0.0/4 (class D) och f\u00f6r IPv6 FF00::/8. I dessa finns det olika ranges, GLOP (RFC 2770) inneb\u00e4r att varje 16-bitars AS har en egen unik multicast-range p\u00e5 internet, 233..0/24. Administratively scoped (RFC 2365) \u00e4r motsvarigheten till unicasts RFC 1918. <ul> <li>Local-link (TTL 1): 224.0.0.0/24</li> <li>Globally scoped: 224.0.1.0 - 238.255.255.255</li> <li>GLOP addresses: 233.0.0.0/8</li> <li>Administratively scoped: 239.0.0.0/8</li> </ul> <p>Complete IANA list: IPv4, IPv6</p> <p>Utifr\u00e5n IP-adress r\u00e4knas multicast mac-adress fram s\u00e5 att enheterna vet vad de ska skicka till och ta emot frames f\u00f6r ut\u00f6ver BIA och broadcast. En multicast-adress f\u00f6r IPv4 mappas till MAC address 01:00:5E:\\&lt;low-order 23 bits&gt; och IPv6 mappas till MAC 33:33:\\&lt;low-order 32 bits&gt;.</p>"},{"location":"cisco/Cisco_Multicast/#distribution-trees","title":"Distribution Trees","text":"<p>Multicastroutrar skapar distributions-tr\u00e4d f\u00f6r att styra vilken v\u00e4g multicasttrafiken tar genom n\u00e4tverket. Det finns tv\u00e5 typer av tr\u00e4dtopologier, source trees och shared trees. Source trees kallas ocks\u00e5 shortest-path tree och det skapas ett spanning tree fr\u00e5n root/source till alla leaves. Ett source tree best\u00e5r av source och destination och betecknas S,G, t.ex. (172.20.0.40, 225.0.10.10). Till skillnad fr\u00e5n source trees har shared trees en gemensam rot oavsett source, denna punkt kallas rendezvous point. Ett shared tree betecknas *,G vilket betyder any source. Trafik tunnlas fr\u00e5n routern n\u00e4rmast k\u00e4llan till RP f\u00f6r att sedan distribueras ut i det delade tr\u00e4det.</p>"},{"location":"cisco/Cisco_Multicast/#source-specific-multicast","title":"Source Specific Multicast","text":"<p>Med SSM kan hostarna sj\u00e4lva v\u00e4lja source f\u00f6r trafikstr\u00f6mmen ifall det finns flera. Det kan \u00e4ven skydda mot dos-attacker eftersom mottagare ber\u00e4ttar f\u00f6r n\u00e4tverket vilka k\u00e4llor de vill f\u00e5 trafik ifr\u00e5n och inte vem som helst. Det ger ocks\u00e5 f\u00f6rdelar med att \u00f6verlappande grupp-adresser kommer att fungera eftersom olika k\u00e4llor g\u00f6r str\u00f6mmarna unika. Det finns inga shared trees med SSM utan allt hanteras som source trees. SSM har 232.0.0.0/8 IANA-reserverat. Se SSM-konfiguration.</p>"},{"location":"cisco/Cisco_Multicast/#multicast-routes","title":"Multicast Routes","text":"<p>Static mroutes kan anv\u00e4ndas i situationer n\u00e4r man beh\u00f6ver konstruera multicast-str\u00f6mmar att g\u00e5 \u00f6ver en l\u00e4nk som inte k\u00f6r IGP, t.ex. tunnlar, eller fixa RPF failures som man f\u00e5r n\u00e4r multicast routing inte k\u00f6rs p\u00e5 alla l\u00e4nkar. Genom att l\u00e4gga till en static mroute s\u00e5 kommer RPF att titta p\u00e5 den i f\u00f6rsta hand eftersom den har en b\u00e4ttre administrative distance (AD = 0) \u00e4n det som finns i unicast RIB:en. Finns det flera equal cost paths till sender kommer endast interface med aktiva PIM-grannskap att anv\u00e4ndas. Och efter det kommer den med h\u00f6gst PIM neighbor IP att vinna, detta g\u00f6r att RPF \u00e4r deterministiskt. I nyare versioner av IOS anv\u00e4nds alltid longest match av RPF vilket inte var fallet f\u00f6rr.</p> <p><code>ip\u00a0mroute\u00a010.0.0.0\u00a0255.255.255.0\u00a0gi2</code> <code>ipv6\u00a0route\u00a01000::/64\u00a0gi2\u00a0multicast</code></p> <p>Verify. Notera att endast routes med next-hop \u00f6ver interface d\u00e4r det finns PIM neighbors genererar RPF entries och d\u00e4rmed syns med dessa kommandon.</p> <p><code>show\u00a0ip\u00a0rpf</code> <code>show\u00a0ipv6\u00a0rpf</code> <p>CEF S\u00e5h\u00e4r fungerar CEF default</p> <p><code>224.0.0.0/4\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0drop</code> <code>224.0.0.0/24\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0receive</code></p>"},{"location":"cisco/Cisco_Multicast/#troubleshooting","title":"Troubleshooting","text":"<p>Active IP Multicast Sources sending &gt;= 4 kbps.</p> <p><code>show\u00a0ip\u00a0mroute\u00a0active</code></p> <p>mtrace Show the multicast path from the source to the receiver. Detta \u00e4r en IGMP-baserad trace.</p> <p><code>mtrace\u00a010.0.0.10\u00a020.0.0.20\u00a0224.1.4.4</code></p> <p>mstat Show the multicast path, anv\u00e4ndbart f\u00f6r att uppt\u00e4cka congestion.</p> <p><code>mstat\u00a010.0.0.10\u00a020.0.0.20\u00a0224.1.4.4</code></p> <p>mrinfo Show multicast neighbor router information (legacy-kommando).</p> <p><code>mrinfo</code></p> <p>Packet Debugging</p> <p><code>interface\u00a0gi2</code> <code>no\u00a0ip\u00a0mfib\u00a0cef\u00a0input</code> <code>no\u00a0ip\u00a0mfib\u00a0cef\u00a0output</code></p> <p><code>debug\u00a0ip\u00a0mfib\u00a0pak\u00a0239.1.1.10</code></p>"},{"location":"cisco/Cisco_Multicast/#multicast-helper","title":"Multicast Helper","text":"<p>Syftet med denna funktion \u00e4r att till\u00e5ta broadcasts \u00f6ver ett multicast capable network. Det fungerar precis som det mer vanliga ip helper-address men d\u00e5 konverteras broadcast till unicast. IP multicast helper-map konverterar broadcast till en utvald multicast-adress. Man m\u00e5ste ha ett fungerande multicast-n\u00e4t f\u00f6r kunna nyttja detta samt en extended ACL som pekar ut vilken trafik som f\u00e5r g\u00f6ras om till multicast.</p> <p>Ingress router</p> <p><code>ip\u00a0forward-protocol\u00a0udp</code> <p><code>interface\u00a0gi2</code> <code>ip\u00a0multicast\u00a0helper-map\u00a0broadcast</code><code></code> <p>Egress router</p> <p><code>ip\u00a0forward-protocol\u00a0udp</code> <p><code>interface\u00a0gi2</code> <code>ip\u00a0multicast\u00a0helper-map</code><code></code><code></code> <p>Default s\u00e5 skickas broadcasten ut till 255.255.255.255 oavsett vad man satt directed-broadcast-IP till, vill man ha det till n\u00e5got annat m\u00e5ste man anv\u00e4nda ip broadcast-address  p\u00e5 interfacet."},{"location":"cisco/Cisco_Multicast/#igmp-static-group","title":"IGMP Static Group","text":"<p>Man kan skicka ut multicastpaket p\u00e5 ett interface \u00e4ven fast det inte finns n\u00e5gon enhet som pratar PIM eller IGMP, detta kallas Static Group. Routern som konfas med detta kommer att skicka PIM Join request upstream f\u00f6r att ta del av str\u00f6mmen och sedan forwardera ut det p\u00e5 de interface med den statiska gruppen.</p> <p><code>interface\u00a0gi2</code> <code>ip\u00a0pim\u00a0sparse-mode</code> <code>ip\u00a0igmp\u00a0static-group\u00a0232.1.1.1\u00a0source\u00a010.1.1.3</code></p>"},{"location":"cisco/Cisco_Multicast/#bgp","title":"BGP","text":"<p>Man kan skicka information om multicast-str\u00f6mmar mellan dom\u00e4ner med hj\u00e4lp av MP-BGP extensions. N\u00e4r man l\u00e4r sig ett prefix med multicast BGP s\u00e5 kommer RPF att kollas mot den IP som st\u00e5r som next-hop i uppdateringen. Dvs BGP handlar inte om hur man hittar till en destination eftersom en multicast-adress alltid kommer vara destination utan man ber\u00e4ttar vilka sources man har fr\u00e5n en viss next-hop och d\u00e5 kan man klara rpf-checken. S\u00e5 man m\u00e5ste se till att populera \u00e4ven denna BGP-tabell, det kan t.ex. g\u00f6ras med redistribution fr\u00e5n ett unicast-protokoll. Man m\u00e5ste k\u00f6ra PIM mellan dom\u00e4nerna f\u00f6r att shared och shortest-path trees ska kunna signaleras. Man m\u00e5ste \u00e4ven utbyta unicast routes f\u00f6r multicast-k\u00e4llorna f\u00f6r att alla multicast routrarna ska kunna anv\u00e4nda RPF. Se \u00e4ven Cisco MP-BGP.</p> <p><code>router\u00a0bgp\u00a0100</code> <code>address-family\u00a0ipv4\u00a0multicast</code> <code>neighbor\u00a010.0.0.20\u00a0activate</code></p> <p>Verify</p> <p><code>show\u00a0bgp\u00a0ipv4\u00a0multicast\u00a0summary</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_NAT/","title":"Cisco NAT","text":"<p>Network Address Translation anv\u00e4nds f\u00f6r att skriva om adresser i IP-paket. Det \u00e4r inte s\u00e4kert att NAT fungerar tillsammans med ACL:er som anv\u00e4nder log s\u00e5 det b\u00f6r man ha i \u00e5tanke. F\u00f6r att accelerera NAT-processen finns ip nat create flow-entries som \u00e4r p\u00e5slaget default i IOS-routrar.</p> <p>Generell metod f\u00f6r att testa om NAT fungerar.</p> <p><code>debug\u00a0ip\u00a0nat</code> <code>telnet\u00a01.1.1.1</code> <code>who</code></p>"},{"location":"cisco/Cisco_NAT/#dynamic-nat","title":"Dynamic NAT","text":""},{"location":"cisco/Cisco_NAT/#nat-overload","title":"NAT Overload","text":"<p>Alla adresser g\u00f6ms bakom en IP-adress, kallas \u00e4ven PAT.</p> <p><code>access-list\u00a010\u00a0permit\u00a0[ip-address]\u00a0[wildcard-mask]</code> <code>ip\u00a0nat\u00a0inside\u00a0source\u00a0list\u00a010\u00a0interface\u00a0[outside-interface]\u00a0overload</code></p> <p>Man kan \u00e4ven skapa en pool med endast en ip adress och k\u00f6ra overload p\u00e5 den.</p> <p>Verify</p> <p><code>show\u00a0ip\u00a0nat\u00a0translations</code> <code>show\u00a0ip\u00a0nat\u00a0statistics</code></p>"},{"location":"cisco/Cisco_NAT/#default-interface","title":"Default Interface","text":"<p>NAT Default interface inneb\u00e4r att all trafik som initieras utifr\u00e5n och natas in g\u00e5r till en och samma IP men d\u00e4remot kan trafik som initieras inifr\u00e5n hide natas till interface IP (nat overload).</p> <p><code>ip\u00a0access-list\u00a0standard\u00a0ALL</code> <code>permit\u00a0any</code> <code>ip\u00a0nat\u00a0inside\u00a0source\u00a0list\u00a0ALL\u00a0interface\u00a0Gi2\u00a0overload</code> <code>ip\u00a0nat\u00a0inside\u00a0source\u00a0static\u00a0172.16.0.20\u00a0interface\u00a0Gi2</code></p>"},{"location":"cisco/Cisco_NAT/#nat-pool","title":"NAT Pool","text":"<p><code>interface\u00a0Gi0/1</code> <code>ip\u00a0address\u00a0100.10.10.10\u00a0255.255.255.0</code> <code>ip\u00a0nat\u00a0outside</code> <code>interface\u00a0Gi0/2</code> <code>ip\u00a0address\u00a0192.168.0.1\u00a0255.255.255.0</code> <code>ip\u00a0nat\u00a0inside</code></p> <p><code>ip\u00a0access-list\u00a0standard\u00a0CLIENT-LIST</code> <code>permit\u00a0192.168.0.0\u00a00.0.0.15</code></p> <p><code>ip\u00a0nat\u00a0pool\u00a0DYNAMIC\u00a0100.10.10.17\u00a0100.10.10.19\u00a0prefix-length\u00a029</code> <code>ip\u00a0nat\u00a0inside\u00a0source\u00a0list\u00a0CLIENT-LIST\u00a0pool\u00a0DYNAMIC</code></p> <p>Interface IP ska ej ing\u00e5 i NAT-poolen d\u00e4remot b\u00f6r netmask/prefix-length inrymma alla adresser i poolen.</p> <p>Verify</p> <p><code>show\u00a0ip\u00a0nat\u00a0translations</code> <code>show\u00a0ip\u00a0nat\u00a0pool\u00a0name\u00a0DYNAMIC</code> <code>show\u00a0ip\u00a0nat\u00a0translations\u00a0filter\u00a0range\u00a0inside\u00a0global\u00a0100.10.10.17\u00a0100.10.10.19\u00a0total</code></p>"},{"location":"cisco/Cisco_NAT/#tcp-load-distribution","title":"TCP Load Distribution","text":"<p>Man kan g\u00f6mma flera servrar bakom en ip-adress f\u00f6r att tillhandah\u00e5lla lastdelning. Det g\u00f6rs med en rotary address pool samt en acl som anger den IP som man ska g\u00e5 emot fr\u00e5n outside. B\u00e5de standard och extended acl fungerar. N\u00e4r paket/sessioner p\u00e5 ett NAT outside interface tr\u00e4ffar acl:en s\u00e5 \u00f6vers\u00e4tts det till en av adresserna fr\u00e5n poolen enligt round-robin.</p> <p><code>ip\u00a0nat\u00a0pool\u00a0ROTARY\u00a0prefix-length\u00a024\u00a0type\u00a0rotary</code> <code>address\u00a010.0.0.10\u00a010.0.0.10</code> <code>address\u00a010.0.0.11\u00a010.0.0.11</code> <code>address\u00a010.0.0.12\u00a010.0.0.12</code></p> <p><code>ip\u00a0access-list\u00a0extended\u00a0DISTRIBUTE_LOAD</code> <code>permit\u00a0tcp\u00a0any\u00a0host\u00a0100.10.10.15\u00a0eq\u00a0www</code></p> <p><code>ip\u00a0nat\u00a0inside\u00a0destination\u00a0list\u00a0DISTRIBUTE_LOAD\u00a0pool\u00a0ROTARY</code></p>"},{"location":"cisco/Cisco_NAT/#static-nat","title":"Static NAT","text":"<p>1:1 NAT</p> <p><code>interface\u00a0Gi0/1</code> <code>ip\u00a0address\u00a0100.10.10.10\u00a0255.255.255.0</code> <code>ip\u00a0nat\u00a0outside</code> <code>interface\u00a0Gi0/2</code> <code>ip\u00a0address\u00a0192.168.0.1\u00a0255.255.255.0</code> <code>ip\u00a0nat\u00a0inside</code></p> <p>NAT</p> <p><code>ip\u00a0nat\u00a0inside\u00a0source\u00a0static\u00a0192.168.0.20\u00a0100.10.10.20\u00a0[no-alias]</code></p> <p>Med no-alias besvaras inte ARP-f\u00f6rfr\u00e5gningar f\u00f6r den IP-adressen p\u00e5 utsidan.</p> <p>Verify</p> <p><code>show\u00a0ip\u00a0nat\u00a0translations</code> <code>show\u00a0ip\u00a0nat\u00a0statistics</code> <code>show\u00a0ip\u00a0alias</code></p> <p>DYNAMIC \u00e4r IP-adresser som anv\u00e4nds f\u00f6r NAT.</p>"},{"location":"cisco/Cisco_NAT/#static-pat","title":"Static PAT","text":"<p><code>interface\u00a0Gi0/1</code> <code>ip\u00a0address\u00a0100.10.10.10\u00a0255.255.255.0</code> <code>ip\u00a0nat\u00a0outside</code> <code>interface\u00a0Gi0/2</code> <code>ip\u00a0address\u00a0192.168.0.1\u00a0255.255.255.0</code> <code>ip\u00a0nat\u00a0inside</code></p> <p>PAT / port forward.</p> <p><code>ip\u00a0nat\u00a0inside\u00a0source\u00a0static\u00a0tcp\u00a0192.168.0.55\u00a080\u00a0100.10.10.10\u00a080</code></p> <p>Verify</p> <p><code>show\u00a0ip\u00a0nat\u00a0translations</code> <code>show\u00a0ip\u00a0aliases</code></p>"},{"location":"cisco/Cisco_NAT/#static-extendable-nat","title":"Static Extendable NAT","text":"<p>Om man vill ha flera ip-adresser som ska natas till samma inside IP.</p> <p><code>ip\u00a0nat\u00a0inside\u00a0source\u00a0static\u00a010.1.1.1\u00a020.0.0.20\u00a0extendable</code> <code>ip\u00a0nat\u00a0inside\u00a0source\u00a0static\u00a010.1.1.1\u00a020.0.0.30\u00a0extendable</code></p>"},{"location":"cisco/Cisco_NAT/#static-policy-nat","title":"Static Policy NAT","text":"<p>Policy NAT anv\u00e4nder route-maps. Med set interface kan man best\u00e4mma vilket interface paketen ska skickas ut p\u00e5 och d\u00e4rmed natas.</p> <p><code>interface\u00a0Gi0/0</code> <code>ip\u00a0nat\u00a0outside</code></p> <p><code>ip\u00a0access-list\u00a0extended\u00a0TO_OUTSIDE</code> <code>permit\u00a0ip\u00a0192.168.0.0\u00a00.0.0.255\u00a0any</code></p> <p><code>route-map\u00a0TO_ISP1\u00a0permit\u00a010</code> <code>match\u00a0ip\u00a0address\u00a0TO_OUTSIDE</code> <code>set\u00a0interface\u00a0Gi0/0</code></p> <p><code>ip\u00a0nat\u00a0inside\u00a0source\u00a0route-map\u00a0TO_ISP1\u00a0interface\u00a0Gi0/0\u00a0overload</code></p> <p>Man kan ocks\u00e5 l\u00e5ta routingtabellen styra och sedan NATa utifr\u00e5n vilket interface som \u00e4r egress.</p> <p><code>route-map\u00a0TO_ISP1\u00a0permit\u00a010</code> <code>match\u00a0interface\u00a0Gi0/0</code></p> <p><code>route-map\u00a0TO_ISP2\u00a0permit\u00a010</code> <code>match\u00a0interface\u00a0Gi0/1</code></p> <p><code>ip\u00a0nat\u00a0inside\u00a0source\u00a0static\u00a0192.168.0.10\u00a0100.10.10.10\u00a0route-map\u00a0TO_ISP1</code> <code>ip\u00a0nat\u00a0inside\u00a0source\u00a0static\u00a0192.168.0.10\u00a0100.20.20.20\u00a0route-map\u00a0TO_ISP2</code></p>"},{"location":"cisco/Cisco_NAT/#reversible-nat","title":"Reversible NAT","text":"<p>Man kan konfigurera nat som endast funkar efter att ha blivit initierad fr\u00e5n andra h\u00e5llet.</p> <p><code>ip\u00a0nat\u00a0pool\u00a0POOL\u00a0100.10.10.15\u00a0100.10.10.19\u00a0netmask\u00a0255.255.255.0</code> <code>ip\u00a0nat\u00a0inside\u00a0source\u00a0route-map\u00a0ROUTE-MAP\u00a0pool\u00a0POOL</code><code>reversible</code><code></code></p>"},{"location":"cisco/Cisco_NAT/#dubbel-nat","title":"Dubbel-NAT","text":"<p>Har man \u00f6verlappande subn\u00e4t f\u00e5r man antingen NATa p\u00e5 b\u00e5da sidorna eller bara ena. I detta exemplet kommunicerar 172.20.0.10 (server1) mot ip 172.20.0.50 som natas till 30.0.0.5 (server2) medans server2 ser server1 fr\u00e5n 30.0.0.50.</p> <p><code>ip\u00a0nat\u00a0inside\u00a0source\u00a0static\u00a0172.20.0.10\u00a030.0.0.50</code> <code>ip\u00a0nat\u00a0outside\u00a0source\u00a0static\u00a030.0.0.5\u00a0172.20.0.50\u00a0add-route</code></p> <p>Utan add-route m\u00e5ste en statisk route anv\u00e4ndas f\u00f6r att peka 172.20.0.50 till outside interface.</p> <p><code>show\u00a0ip\u00a0nat\u00a0translations</code></p>"},{"location":"cisco/Cisco_NAT/#stateful-nat","title":"Stateful NAT","text":"<p>Stateful NAT with HSRP. During failovers, NAT translated IP addresses on devices may be different from the IP address before the failover, because no state information is exchanged between active and standby devices. HSRP Virtual IP Address (VIP) cannot be used by NAT pools.</p> <p><code>interface\u00a0gi2</code> <code>standby\u00a0100\u00a0name\u00a0SNAT</code> <code>ip\u00a0nat\u00a0stateful\u00a0id\u00a01\u00a0redundancy\u00a0SNAT\u00a0mapping-id\u00a010</code> <code>ip\u00a0nat\u00a0pool\u00a0SNATPOOL\u00a010.1.1.1\u00a010.1.1.9\u00a0prefix-length\u00a024</code> <code>ip\u00a0nat\u00a0inside\u00a0source\u00a0route-map\u00a0ROUTE-MAP\u00a0pool\u00a0SNATPOOL\u00a0mapping-id\u00a010\u00a0overload</code></p> <p>Primary</p> <p><code>ip\u00a0nat\u00a0stateful\u00a0id\u00a01\u00a0primary\u00a010.10.10.10\u00a0peer\u00a010.22.22.22\u00a0mapping-id\u00a010</code></p> <p>Backup</p> <p><code>ip\u00a0nat\u00a0stateful\u00a0id\u00a01\u00a0backup\u00a010.2.2.2\u00a0peer\u00a010.10.10.10\u00a0mapping-id\u00a010</code></p> <p>Verify</p> <p><code>show\u00a0ip\u00a0snat\u00a0distributed\u00a0verbose</code></p>"},{"location":"cisco/Cisco_NAT/#nvi","title":"NVI","text":"<p>Med Nat Virtual Interface kan man adress\u00f6vers\u00e4tta mellan VRF:er och man anv\u00e4nder inte inside och outside med denna metod. NAT Virtual Interfaces are not supported in the Cisco IOS XE software.</p> <p><code>interface\u00a0Gi0/1</code> <code>ip\u00a0nat\u00a0enable</code> <code>interface\u00a0Gi0/2</code> <code>ip\u00a0nat\u00a0enable</code></p> <p><code>ip\u00a0nat\u00a0source\u00a0static\u00a0192.168.0.1\u00a0100.10.10.10</code></p> <p>Show</p> <p><code>show\u00a0ip\u00a0nat\u00a0nvi\u00a0translations</code> <code>show\u00a0ip\u00a0nat\u00a0translations\u00a0verbose</code></p>"},{"location":"cisco/Cisco_NAT/#ipv6","title":"IPv6","text":"<p>NAT \u2013 Protocol Translation kan anv\u00e4ndas vid IPv4 till IPv6 migreringar och ger bi-directional connectivity mellan dom\u00e4nerna.</p> <p><code>interface\u00a0gi\u00a00/0</code> <code>ipv6\u00a0nat</code> <code>interface\u00a0gi\u00a00/1</code> <code>ipv6\u00a0nat</code> <code>ipv6\u00a0nat\u00a0v6v4\u00a0source\u00a03001:11:0:1::1\u00a0150.11.3.1</code> <code>ipv6\u00a0nat\u00a0v4v6\u00a0source\u00a0static\u00a0150.11.2.2\u00a02000::960b:0202</code> <code>ipv6\u00a0nat\u00a0prefix\u00a02000::/96</code></p> <p>NAT-PT kr\u00e4ver ett /96 prefix</p> <p>Verify</p> <p><code>show\u00a0ipv6\u00a0nat\u00a0translations</code></p> <p>NPTv6 IPv6-to-IPv6 Network Prefix Translation \u00e4r NAT fr\u00e5n IPv6 till IPv6. Eftersom det finns en 1:1-relation mellan inside och outside prefix beh\u00f6ver inte routern h\u00e5lla n\u00e5got state i data plane f\u00f6r NAT:en. Detta underl\u00e4ttar multihoming.</p> <p><code>nat66\u00a0prefix\u00a02002:ABC1::/64\u00a0Outside\u00a02002:ABC2::/64</code></p> <p><code>interface\u00a0GigabitEthernet0</code> <code>nat66\u00a0inside</code> <code>interface\u00a0GigabitEthernet1</code> <code>nat66\u00a0outside</code></p> <p>Verify</p> <p><code>show\u00a0nat66\u00a0prefix</code> <code>show\u00a0nat66\u00a0statistics</code></p>"},{"location":"cisco/Cisco_NAT/#cgnat","title":"CGNAT","text":"<p>Carrier-grade NAT \u00e4r large-scale NAT (LSN), det kan vara NAT44, NAT64 och/eller NAT66. Nyckeln till att kunna hantera fler NAT-sessioner \u00e4n vanligt \u00e4r att ingen information om destination lagras. CGNAT enableas globalt, dvs man kan inte k\u00f6ra annan NAT samtidigt.</p> <p><code>ip\u00a0nat\u00a0settings\u00a0mode\u00a0cgn</code></p> <p>Dynamic Port Address CGNAT</p> <p><code>ip\u00a0nat\u00a0settings\u00a0pap</code> <code>ip\u00a0nat\u00a0pool\u00a0PUBLIC-POOL\u00a01.1.1.10\u00a01.1.1.20\u00a0prefix-length\u00a024</code> <code>ip\u00a0nat\u00a0inside\u00a0source\u00a0list\u00a0NAT-ACL\u00a0pool\u00a0PUBLIC-POOL\u00a0overload</code> <code>ip\u00a0access-list\u00a0extended\u00a0NAT-ACL</code> <code>permit\u00a0ip\u00a010.0.0.0\u00a00.255.255.255\u00a0any</code></p>"},{"location":"cisco/Cisco_NAT/#mpls-vpn","title":"MPLS VPN","text":"<p>NAT-integration med MPLS VPN till\u00e5ter flera MPLS VPN att konfigureras att fungera tillsammans p\u00e5 samma enhet. NAT kan skilja p\u00e5 vilken VPN den f\u00e5r in trafik p\u00e5 \u00e4ven om alla anv\u00e4nder samma IP-adresser. Detta l\u00e5ter flera kunder anv\u00e4nda samma services men \u00e4nd\u00e5 vara skiljda logiskt. Se \u00e4ven Cisco MPLS.</p> <p><code>interface\u00a0Gi0/1</code> <code>ip\u00a0address\u00a0100.10.10.10\u00a0255.255.255.0</code> <code>ip\u00a0nat\u00a0outside</code> <code>interface\u00a0Gi0/2</code> <code>vrf\u00a0forwarding\u00a0VPN1</code> <code>ip\u00a0address\u00a0192.168.0.1\u00a0255.255.255.0</code> <code>ip\u00a0nat\u00a0inside</code> <code>interface\u00a0Gi0/3</code> <code>vrf\u00a0forwarding\u00a0VPN2</code> <code>ip\u00a0address\u00a0192.168.0.1\u00a0255.255.255.0</code> <code>ip\u00a0nat\u00a0inside</code></p> <p><code>access-list\u00a01\u00a0permit\u00a0192.168.0.0\u00a00.0.255.255</code> <code>ip\u00a0nat\u00a0pool\u00a0SHARED\u00a0100.10.10.20\u00a0100.10.10.40\u00a0netmask\u00a0255.255.255.0</code></p> <p><code>ip\u00a0nat\u00a0inside\u00a0source\u00a0list\u00a01\u00a0pool\u00a0SHARED\u00a0vrf\u00a0VPN1\u00a0overload</code> <code>ip\u00a0nat\u00a0inside\u00a0source\u00a0list\u00a01\u00a0pool\u00a0SHARED\u00a0vrf\u00a0VPN2\u00a0overload</code></p> <p><code>ip\u00a0route\u00a0vrf\u00a0VPN1\u00a00.0.0.0\u00a00.0.0.0\u00a0Gi0/1\u00a0100.10.10.1</code> <code>ip\u00a0route\u00a0vrf\u00a0VPN2\u00a00.0.0.0\u00a00.0.0.0\u00a0Gi0/1\u00a0100.10.10.1</code></p> <p>Verify</p> <p><code>show\u00a0ip\u00a0nat\u00a0translations\u00a0vrf\u00a0VPN1</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_NetFlow/","title":"Cisco NetFlow","text":"<p>Netflow \u00e4r ett Cisco-properit\u00e4rt protokoll som anv\u00e4nds f\u00f6r att kunna exportera data om vilka adresser och protokoll som anv\u00e4nds i ett n\u00e4tverk och hur mycket trafik de genererar. De vanligaste versioner som anv\u00e4nds \u00e4r 5 och 9. Den stora skillnaden \u00e4r att v5 inte har st\u00f6d f\u00f6r IPv6 eller MPLS. Samt att v5-paket har ett fixerat paketformat. Paket f\u00f6r version 9 kan se olika ut och man kan \u00e4ndra det med templates. Det finns \u00e4ven IETF-standard, IPFIX. Se \u00e4ven Cisco SPAN.</p> <p>Komponenter:</p> <ul> <li>Flow exporter, t.ex. en router</li> <li>Flow collector, t.ex. Pmacct</li> <li>Analysis application, t.ex. Ntopng,     FastNetMon</li> </ul>"},{"location":"cisco/Cisco_NetFlow/#paket","title":"Paket","text":"<p>Ett NetFlow-paket skickas med UDP och kan inneh\u00e5lla metadata om flera trafikfl\u00f6den.</p>   -   NetFlow v9:    [](/File:Cisco_Netflow_v9.png \"wikilink\")   <p>Om man anv\u00e4nder version 9 s\u00e5 skickar Cisco-enheter en NetFlow-template var 20:e paket s\u00e5 mottagare vet vilken information NetFlow-paketen inneh\u00e5ller.</p>   -   NetFlow template:    [](/File:Cisco_NetFlow_Template.png \"wikilink\")"},{"location":"cisco/Cisco_NetFlow/#konfiguration","title":"Konfiguration","text":"<p>Legacy IOS syntax</p> <p><code>int\u00a0gi0/0</code> <code>ip\u00a0flow\u00a0ingress</code> <code>ip\u00a0flow\u00a0egress</code></p> <p>Top-talkers</p> <p><code>ip\u00a0flow-top-talkers</code> <code>sort-by\u00a0bytes</code> <code>top\u00a05</code></p> <p>Show</p> <p><code>show\u00a0ip\u00a0flow\u00a0top-talkers</code> <code>show\u00a0ip\u00a0cache\u00a0flow</code></p>"},{"location":"cisco/Cisco_NetFlow/#asr","title":"ASR","text":"<p>IOS-XE anv\u00e4nder den modernare syntaxen som kallas Flexible NetFlow. Man kan \u00e4ven definiera och anv\u00e4nda egna flow records, dvs vilken information som ska exporteras. OBS en ASR 1000 kan inte anv\u00e4nda sitt management-interface som source f\u00f6r NetFlow-exporten.</p> <p><code>flow\u00a0exporter\u00a0COLLECTOR</code> <code>destination\u00a010.0.0.10</code> <code>transport\u00a0udp\u00a02055</code> <code>source\u00a0gi0/1</code> <code>export-protocol\u00a0netflow-v9</code></p> <p><code>flow\u00a0monitor\u00a0FLOW-MONITOR</code> <code>record\u00a0netflow\u00a0ipv4\u00a0original-input</code> <code>exporter\u00a0COLLECTOR</code> <code>cache\u00a0timeout\u00a0active\u00a060</code></p> <p><code>interface\u00a0gi0/3</code> <code>ip\u00a0flow\u00a0monitor\u00a0FLOW-MONITOR\u00a0input</code></p> <p>\"Random Sampled NetFlow is more statistically accurate than Sampled NetFlow.\" - Cisco</p> <p><code>sampler\u00a0SAMPLER-1</code> <code>mode\u00a0random\u00a01\u00a0out-of\u00a01000</code> <code>interface\u00a0gi0/3</code> <code>ip\u00a0flow\u00a0monitor\u00a0FLOW-MONITOR\u00a0sampler\u00a0SAMPLER-1\u00a0input</code></p> <p>Verify</p> <p><code>show\u00a0flow\u00a0exporter</code> <code>show\u00a0flow\u00a0interface</code> <code>show\u00a0flow\u00a0monitor</code> <code>show\u00a0flow\u00a0exporter\u00a0statistics</code> <code>show\u00a0flow\u00a0record</code> <code>show\u00a0sampler</code></p> <p>MPLS-aware NetFlow</p> <p><code>interface\u00a0gi2</code> <code>mpls\u00a0netflow\u00a0egress</code></p>"},{"location":"cisco/Cisco_NetFlow/#ezpm","title":"EzPM","text":"<p>Med Easy Performance Monitoring s\u00e5 autokonfas allt man beh\u00f6ver utifr\u00e5n en f\u00e4rdig profil, man kan v\u00e4lja mellan prestanda, upplevelse och statistik. Man f\u00e5r tillg\u00e5ng till alla Application, Visibility and Control (AVC) features.</p> <p><code>performance\u00a0monitor\u00a0context\u00a0EzPM\u00a0profile\u00a0application-experience</code> <code>exporter\u00a0destination\u00a010.0.0.10\u00a0source\u00a0loopback0\u00a0transport\u00a0udp\u00a0port\u00a02055\u00a0[vrf]</code> <code>traffic-monitor\u00a0all</code></p> <p><code>interface\u00a0Gi0/1</code> <code>performance\u00a0monitor\u00a0context\u00a0EzPM</code></p> <p>Verify</p> <p><code>show\u00a0performance\u00a0monitor\u00a0context\u00a0EzPM</code></p>"},{"location":"cisco/Cisco_NetFlow/#nexus","title":"Nexus","text":"<p><code>feature\u00a0netflow</code></p> <p><code>flow\u00a0exporter\u00a0COLLECTOR</code> <code>destination\u00a010.0.0.10\u00a0use-vrf\u00a0management</code> <code>version\u00a09</code> <code>transport\u00a0udp\u00a02055</code> <code>source\u00a0mgmt\u00a00</code></p> <p><code>flow\u00a0monitor\u00a0FLOW-MONITOR</code> <code>exporter\u00a0COLLECTOR</code> <code>record\u00a0netflow-original</code></p> <p>Ska man samla in netflow p\u00e5 ett interface i ett F3-kort m\u00e5ste sampler anv\u00e4ndas.</p> <p><code>sampler\u00a0SAMPLER-1</code> <code>mode\u00a01\u00a0out-of\u00a05</code></p> <p>Interface</p> <p><code>interface\u00a0Ethernet1/1</code> <code>ip\u00a0flow\u00a0monitor\u00a0FLOW-MONITOR\u00a0input\u00a0sampler\u00a0SAMPLER-1</code></p> <p>Verify</p> <p><code>show\u00a0flow\u00a0record\u00a0netflow-original</code> <code>show\u00a0flow\u00a0exporter</code> <code>show\u00a0flow\u00a0monitor</code> <code>show\u00a0flow\u00a0interface</code></p> <p>Layer 2 Man kan \u00e4ven exportera metadata f\u00f6r L2-trafik med netflow. Notera att flow monitor m\u00e5ste ha flow records f\u00f6r L2, dvs Vlan, MAC och ethertype.</p> <p><code>interface\u00a0e1/1</code> <code>switchport</code> <code>layer2-switched\u00a0flow\u00a0monitor\u00a0FLOW-MONITOR\u00a0input</code></p>"},{"location":"cisco/Cisco_NetFlow/#ip-accounting","title":"IP Accounting","text":"<p>IP Accounting \u00e4r en annan feature i IOS som ocks\u00e5 kan anv\u00e4ndas f\u00f6r att kolla trafik lokalt, dock mindre popul\u00e4r \u00e4n NetFlow.</p> <p><code>ip\u00a0accounting-threshold\u00a01200</code> <code>ip\u00a0accounting-list\u00a010.0.10.0\u00a00.0.0.255</code> <code>int\u00a0g2/0</code> <code>ip\u00a0accounting\u00a0output-packets</code></p> <p><code>show\u00a0ip\u00a0accounting</code> <code>clear\u00a0ip\u00a0accounting</code></p> <p>Stores the old accounting database into a checkpoint</p> <p><code>show\u00a0ip\u00a0accounting\u00a0checkpoint</code></p> <p>Det g\u00e5r \u00e4ven att kolla MAC-adresser.</p> <p><code>interface\u00a0gi2</code> <code>ip\u00a0accounting\u00a0mac-address\u00a0input</code> <code>show\u00a0interface\u00a0gi2\u00a0mac-accounting</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_Nexus/","title":"Cisco Nexus","text":"<p>Cisco Nexus switchar \u00e4r designade f\u00f6r datacenter. De k\u00f6r NX-OS som bygger p\u00e5 en nedbantad variant av Linux kernel. De har st\u00f6d f\u00f6r tekniker som FabricPath och vPC och g\u00e5r att konfigurera med CLI (SSH/console) eller XML baserat p\u00e5 NETCONF. F\u00f6r virtuell instans se Nexus VDC och f\u00f6r virtuell switch se Nexus 1000V och Nexus 9000v (nedan).</p>"},{"location":"cisco/Cisco_Nexus/#nexus-9000-taxonomy","title":"Nexus 9000 Taxonomy","text":"<p>790px</p>"},{"location":"cisco/Cisco_Nexus/#konfiguration","title":"Konfiguration","text":"<p><code>hostname\u00a0Nexus-01</code> <code>service\u00a0password-encryption</code> <code>no\u00a0ip\u00a0domain-lookup</code> <code>user\u00a0admin\u00a0password\u00a0bigdog\u00a0role\u00a0vdc-admin</code></p> <p>Management</p> <p><code>interface\u00a0mgmt0</code> <code>ip\u00a0address\u00a010.0.0.10/24</code></p> <p><code>vrf\u00a0context\u00a0management</code> <code>ip\u00a0route\u00a00.0.0.0/0\u00a010.0.0.1</code></p> <p>Sl\u00e5 p\u00e5 loggmeddelanden och f\u00e4rgkodning i SSH terminal.</p> <p><code>terminal\u00a0monitor</code> <code>terminal\u00a0color\u00a0persist</code></p> <p>Sl\u00e5 p\u00e5 features g\u00f6rs efter behov.</p> <p><code>feature\u00a0ssh</code> <code>feature\u00a0fex</code> <code>feature\u00a0lacp</code> <code>feature\u00a0vpc</code></p> <p>Global</p> <p><code>system\u00a0default\u00a0switchport\u00a0shutdown</code> <code>port-channel\u00a0load-balance\u00a0ethernet\u00a0source-dest-port</code> <code>clock\u00a0timezone\u00a0CET\u00a01\u00a00</code> <code>clock\u00a0summer-time\u00a0CEST\u00a05\u00a0Sunday\u00a0March\u00a002:00\u00a05\u00a0Sunday\u00a0October\u00a002:00\u00a060</code></p> <p>Show</p> <p><code>show\u00a0module</code> <code>show\u00a0system\u00a0resources</code> <code>show\u00a0cli\u00a0history\u00a0unformatted</code> <code>show\u00a0cli\u00a0history\u00a0config-mode</code></p> <p>Alias, exempel</p> <p><code>cli\u00a0alias\u00a0name\u00a0wr\u00a0copy\u00a0running-config\u00a0startup-config</code> <code>cli\u00a0alias\u00a0name\u00a0diff\u00a0show\u00a0running\u00a0diff</code> <code>cli\u00a0alias\u00a0name\u00a0changeto\u00a0switchto\u00a0vdc</code></p> <p>Jumbo frames Nexus 5K Detta g\u00e4ller f\u00f6r L2 interface. Vill man vara n\u00e5gorlunda granul\u00e4r kan man k\u00f6ra jumbo frames per vlan. Show interface visar inte r\u00e4tt eftersom Nexus 5k inte har st\u00f6d f\u00f6r per interface MTU utan man f\u00e5r anv\u00e4nda show queuing. Se \u00e4ven QoS f\u00f6r NX-OS f\u00f6r mer info.</p> <p><code>policy-map\u00a0type\u00a0network-qos\u00a0JUMBO-MTU</code> <code>class\u00a0type\u00a0network-qos\u00a0class-default</code> <code>mtu\u00a09216</code> <code>system\u00a0qos</code> <code>service-policy\u00a0type\u00a0network-qos\u00a0JUMBO-MTU</code></p> <p><code>show\u00a0queuing\u00a0interface\u00a0e1/1</code></p> <p>Nexus 7K, denna globala inst\u00e4llning s\u00e4ger vad man max f\u00e5r konfa under interfacen.</p> <p><code>system\u00a0jumbomtu\u00a09216</code></p> <p>API NX-OS har st\u00f6d f\u00f6r flera olika API:er.</p> <p><code>feature\u00a0netconf</code> <code>feature\u00a0restconf</code> <code>feature\u00a0grpc</code></p> <p>Troubleshooting NX-OS har en on-device log file med de exec level configuration commands som k\u00f6rts.</p> <p><code>show\u00a0accounting\u00a0log</code></p> <p>Visa historical event log f\u00f6r Layer 2 MAC-databasen.</p> <p><code>show\u00a0system\u00a0internal\u00a0l2fm\u00a0l2dbg\u00a0macdb\u00a0address\u00a00011.2233.4455\u00a0vlan\u00a0100</code></p> <p>Routing and forwarding show forwarding ip route  <p><code>show\u00a0forwarding\u00a0adjacency</code> <code>show\u00a0hardware\u00a0mac\u00a0address-table\u00a01</code> <p>Verify ECMP</p> <p><code>show\u00a0routing\u00a0hash</code><code></code> <p>Nexus 9K, f\u00f6r att smidigt se om t.ex. en counter r\u00e4knar upp eller ej.</p> <p><code>watch\u00a0differences\u00a0interval\u00a01\u00a0show\u00a0interface\u00a0e1/1</code> <code>watch\u00a0show\u00a0interface\u00a0counters\u00a0table</code></p> <p>Alternativt</p> <p><code>show\u00a0int\u00a0eth1/10\u00a0|\u00a0diff</code> <code>show\u00a0int\u00a0eth1/10\u00a0|\u00a0diff</code></p> <p>VLAN Man kan kolla vilka VLAN som \u00e4r reserverade och anv\u00e4nds internt.</p> <p><code>show\u00a0vlan\u00a0internal\u00a0usage</code></p> <p>S\u00e4tt switchen i maintenance mode.</p> <p><code>system\u00a0mode\u00a0maintenance\u00a0[dont-generate-profile]</code> <code>show\u00a0system\u00a0mode</code> <code>show\u00a0config-profile</code></p> <p>Software Reload Endast mjukvaran startar om. Data plane p\u00e5verkas inte men control plane \u00e4r nere n\u00e5gra minuter. OBS om detta failar av n\u00e5gon anledning s\u00e5 bootar switchen om som vanligt.</p> <p><code>soft-reload</code></p> <p>Licens</p> <p><code>license\u00a0grace-period</code></p> <p><code>show\u00a0license\u00a0brief</code> <code>show\u00a0license\u00a0usage</code> <code>show\u00a0license\u00a0host-id</code></p> <p>Shell Bash Access, h\u00e4r blir man root.</p> <p><code>feature\u00a0bash-shell</code> <code>run\u00a0bash</code></p> <p>Secure Guest Shell \u00e4r en kombination av bash och en secure Linux environment med ett modifierbart root system. Detta k\u00f6rs i en Linux Container. Man kan \u00e4ndra resurstilldelning f\u00f6r en guestshell-contatiner med guestshell resize.</p> <p><code>guestshell</code> <code>show\u00a0virtual-service\u00a0list</code></p> <p>Python</p> <p><code>switch#\u00a0python</code> <code>from\u00a0cli\u00a0import\u00a0*</code> <code>import\u00a0yaml</code> <code>cli('configure\u00a0terminal\u00a0;\u00a0interface\u00a0loopback\u00a05\u00a0;\u00a0no\u00a0shut')</code> <code>intflist\u00a0=\u00a0yaml.safe_load(clid('show\u00a0interface\u00a0brief'))</code></p> <p>Scheduler NX-OS har en inbyggd schemal\u00e4ggare som kan anv\u00e4ndas f\u00f6r att k\u00f6ra kommandon vid valda tidpunkter.</p> <p><code>feature\u00a0scheduler</code></p> <p><code>scheduler\u00a0job\u00a0name\u00a0CLEAR-STATISTICS</code> <code>clear\u00a0counters\u00a0interface\u00a0all</code> <code>exit</code></p> <p><code>scheduler\u00a0schedule\u00a0name\u00a0EVERYDAY</code> <code>job\u00a0name\u00a0CLEAR-STATISTICS</code> <code>time\u00a0daily\u00a023:30</code> <code>exit</code></p> <p><code>show\u00a0scheduler\u00a0schedule</code></p> <p>CoPP</p> <p><code>control-plane</code> <code>service-policy\u00a0input\u00a0copp-system-policy-scaled-l2</code></p> <p>FIPS</p> <p><code>fips\u00a0mode\u00a0enable</code> <code>show\u00a0fips\u00a0status</code></p> <p>Git repo backup</p> <p><code>event\u00a0manager\u00a0applet\u00a0gitpush</code> <code>event\u00a0cli\u00a0match\u00a0\"copy\u00a0running-config\u00a0startup-config\"</code> <code>action\u00a01\u00a0cli\u00a0copy\u00a0running\u00a0bootflash:running.latest</code> <code>action\u00a02\u00a0cli\u00a0run\u00a0guestshell\u00a0python\u00a0/home/admin/upload_git.py</code> <code>action\u00a03\u00a0event-default</code></p> <p>Adjacency Manager Nexus adjacency manager finns p\u00e5 den aktiva supervisorn och h\u00e5ller adjacency information f\u00f6r olika protokoll inklusive ARP, NDP och static mappings. Adjacency Manager populerar t.ex. IPv4 RIB:en med routes l\u00e4rda fr\u00e5n ARP. Dessa \u00e4r host-routes och har Administrative Distance 250, detta g\u00e5r dock att st\u00e4lla om.</p> <p><code>ip\u00a0adjacency\u00a0route\u00a0distance\u00a0250</code> <code>ipv6\u00a0adjacency\u00a0route\u00a0distance\u00a0250</code></p> <p>iCAM Nexus 9000 har st\u00f6d f\u00f6r Intelligent CAM Analytics and Machine-learning feature. Man kan se traffic analytics per feature samt TCAM resources och entries.</p> <p><code>feature\u00a0icam</code> <code>show\u00a0icam\u00a0scale</code></p> <p>CLI variables cli var name MYINF interface e1/10</p> <p><code>show\u00a0cli\u00a0variables</code> <code>tac-pac\u00a0bootflash:$(SWITCHNAME)-$(TIMESTAMP)-show-tech-all.gz</code></p>"},{"location":"cisco/Cisco_Nexus/#ptp","title":"PTP","text":"<p>PTP \u00e4r ett time synchronization protocol f\u00f6r noder i ett n\u00e4tverk. Hardware timestamps anv\u00e4nds f\u00f6r att ge b\u00e4ttre noggrannhet \u00e4n andra protokoll som t.ex. NTP. PTP \u00e4r ett distribuerat protokoll och ett PTP-system kan best\u00e5 av en kombination av PTP och icke-PTP devices. Ordinary clocks organiseras i en master-slave synchronization hierarki med en grandmaster clock p\u00e5 toppen som best\u00e4mmer referenstiden f\u00f6r hela systemet. PTP-processen best\u00e5r av tv\u00e5 faser: etablera master-slave hierarkin och synka klockorna. PTP transporteras med UDP \u00f6ver multicast. F\u00f6r att hantera sin egen interna queuing eller snarare delays in queues kan en switch agera enligt transparent clock model eller boundary clock model. PTP \u00e4r inte supporterat p\u00e5 FEX interface.</p>   Sync message:    [](/File:Cisco-PTP-Sync.PNG \"wikilink\")     Announce message:    [](/File:Cisco-PTP-Announce.PNG \"wikilink\")   <p><code>feature\u00a0ptp</code> <code>ptp\u00a0source</code> <code>ptp\u00a0domain\u00a00\u00a0\u00a0\u00a0\u00a0#Default</code> <p><code>interface\u00a0ethernet1/1</code> <code>switchport</code> <code>ptp</code></p> <p>Verify</p> <p><code>show\u00a0ptp\u00a0brief</code> <code>show\u00a0ptp\u00a0clock</code> <code>show\u00a0ptp\u00a0port\u00a0interface\u00a0ethernet\u00a01/2</code></p>"},{"location":"cisco/Cisco_Nexus/#fabric-extender","title":"Fabric Extender","text":"<p>FEXar \u00e4r remote linjekort man sprider ut i sitt DC f\u00f6r att f\u00e5 f\u00f6rdelar fr\u00e5n b\u00e5de ToR-kabeldragning och EoR-management. Man kopplar in FEXar till Nexus-switchar eller UCS FI:s och sedan str\u00f6ms\u00e4tter man dem och associering g\u00f6rs automatiskt. F\u00f6r att uppt\u00e4cka varandra anv\u00e4nder FEX och parent switch Satellite Discovery Protocol (SDP). F\u00e5r en FEX svar s\u00e5 startar den Satellite Registration Protocol (SRP). D\u00e4refter \u00e4r FEXen registrerad med parent. Med hj\u00e4lp av control VLAN 4042 och interna IP-adress 127.15.1.100 anv\u00e4nds Virtual Interface Configuration protocol f\u00f6r att konfa FEXens portar. SDP skickas periodvis och fungerar \u00e4ven som en keepalive mekanism. Om alla uppl\u00e4nkar g\u00e5r ner kommer FEXen att st\u00e4nga alla sina interface, detta g\u00f6r att dual homed servrar kan faila \u00f6ver till den andra FEXen.</p> <p>Uppl\u00e4nkar p\u00e5 FEX kallas Fabric Interface. Server facing interfaces kallas Host Interface. Varje HIF har ett Virtual Interface inuti FEXen, detta f\u00e5r sin konfig ifr\u00e5n parent switch. Varje VIF binds till ett Logical Interface i parent switch, detta har VLAN membership, ACL:er, etc. Mappningen mellan VIF och LIF g\u00f6rs med hj\u00e4lp av en speciell tag i Ethernet framesen som g\u00e5r mellan FEX och parent. Denna logiska l\u00e4nk kallas VN-Link och taggen heter VNTag. Cisco VNTag har en egen ethertype och inneh\u00e5ller bl.a. Direction bit, Pointer bit, Looped bit, Version och Source och Destination Virtual Interface. Paket som kommer in p\u00e5 ett Host Interface skickas alltid till parent \u00e4ven om t.ex. destination \u00e4r en annan port p\u00e5 samma FEX.</p> <p>FEXar har INTE st\u00f6d f\u00f6r:</p> <ul> <li>STP, (BPDUGuard enabled by default)</li> <li>VTP</li> <li>QinQ</li> <li>CDP, (Uppl\u00e4nkar undantag)</li> </ul> <p>Supported Topologies Man kan koppla in FEXar single homed eller dual homed beroende p\u00e5 om det som ska ansluta till FEXarna ska vara single eller dual homed.</p> <p>600px</p> <p>Konfiguration Notera att dual-homed FEXes m\u00e5ste ha identisk konfiguration, dvs Nexus-switcharna ska ha matchande FEX-relaterad konfig. Detta kan antingen g\u00f6ras manuellt eller med en configuration synchronization service som finns inbyggd i NX-OS. Config sync kan dock st\u00e4lla till med konstiga fel s\u00e5 f\u00f6rdelaktigt g\u00f6rs detta med n\u00e5got externt automationsverktyg. N\u00e4r man konfar en port-channel till FEXen (vilket man b\u00f6r) m\u00e5ste pinning max-links 1 vara satt samt att mode on m\u00e5ste k\u00f6ras eftersom FEX ej har st\u00f6d f\u00f6r LACP. MTU p\u00e5 FEXar styrs av network QoS policy s\u00e5 f\u00f6r att \u00e4ndra MTU p\u00e5 FEX-portar m\u00e5ste \u00e4ven MTU p\u00e5 fabric portar \u00e4ndras. Notera att FEXar kr\u00e4ver minst 1058 bytes annars misslyckas registreringen med parent switch. Man kan konfa FEX innan den \u00e4r online med hj\u00e4lp av pre-provision, se nedan. Man m\u00e5ste g\u00f6ra modelval f\u00f6r att parent ska veta hur m\u00e5nga och vilka sorts interface som finns p\u00e5 FEXen. Giltiga FEX-nummer \u00e4r 101-199.</p> <p>Do not power on the FEX until all cabling and uplink port provisioning on the uplinked Nexus has been completed.</p> <p>Single homed FEX</p> <p><code>fex\u00a0101</code> <code>pinning\u00a0max-links\u00a01</code> <code>description\u00a0\"FEX101\"</code></p> <p><code>interface\u00a0port-channel101</code> <code>description\u00a0FEX101</code> <code>switchport\u00a0mode\u00a0fex-fabric</code> <code>fex\u00a0associate\u00a0101</code></p> <p><code>interface\u00a0Ethernet1/1</code> <code>description\u00a0FEX101,\u00a0Uplink\u00a01</code> <code>switchport\u00a0mode\u00a0fex-fabric</code> <code>fex\u00a0associate\u00a0101</code> <code>channel-group\u00a0101</code> <code>no\u00a0shutdown</code></p> <p><code>interface\u00a0Ethernet1/2</code> <code>description\u00a0FEX101,\u00a0Uplink\u00a02</code> <code>switchport\u00a0mode\u00a0fex-fabric</code> <code>fex\u00a0associate\u00a0101</code> <code>channel-group\u00a0101</code> <code>no\u00a0shutdown</code></p> <p>Dual homed FEX</p> <p><code>fex\u00a0111</code> <code>pinning\u00a0max-links\u00a01</code> <code>description\u00a0\"FEX111\"</code></p> <p><code>slot\u00a0111</code> <code>provision\u00a0model\u00a0N2K-C2248TP-E-1GE</code></p> <p><code>interface\u00a0port-channel111</code> <code>description\u00a0FEX111</code> <code>switchport\u00a0mode\u00a0fex-fabric</code> <code>fex\u00a0associate\u00a0111</code> <code>vpc\u00a0111</code></p> <p><code>interface\u00a0Ethernet1/1</code> <code>description\u00a0FEX111,\u00a0Uplink\u00a01</code> <code>switchport\u00a0mode\u00a0fex-fabric</code> <code>fex\u00a0associate\u00a0111</code> <code>channel-group\u00a0111</code> <code>no\u00a0shutdown</code></p> <p><code>interface\u00a0Ethernet1/2</code> <code>description\u00a0FEX111,\u00a0Uplink\u00a03</code> <code>switchport\u00a0mode\u00a0fex-fabric</code> <code>fex\u00a0associate\u00a0111</code> <code>channel-group\u00a0111</code> <code>no\u00a0shutdown</code></p> <p>Verify</p> <p><code>show\u00a0fex\u00a0detail</code> <code>show\u00a0module\u00a0fex</code> <code>show\u00a0interface\u00a0fex-fabric</code></p> <p>Om serienummer \u00e4r satt i konfigen m\u00e5ste det st\u00e4mma annars blir det \"Identity-Mismatch\". St\u00e5r det inget i konfigen accepteras vad som blir connected.</p>"},{"location":"cisco/Cisco_Nexus/#port-profiles","title":"Port Profiles","text":"<p>En port profile anv\u00e4nds f\u00f6r att skapa en mall med f\u00f6rdefinierad konfiguration f\u00f6r portar. Ist\u00e4llet f\u00f6r att manuellt kopiera befintlig portkonfiguration till en ny port kan ist\u00e4llet profilen appliceras p\u00e5 porten f\u00f6r en f\u00e4rdig och enhetlig konfiguration.</p> <p>Skapa port-profile</p> <p><code>port-profile\u00a0ACCESS</code> <code>switchport</code> <code>switchport\u00a0mode\u00a0access</code> <code>switchport\u00a0access\u00a0vlan\u00a010</code> <code>spanning-tree\u00a0port\u00a0type\u00a0edge</code> <code>spanning-tree\u00a0bpdufilter\u00a0enable</code> <code>spanning-tree\u00a0bpduguard\u00a0enable</code> <code>no\u00a0shutdown</code> <code>state\u00a0enabled</code></p> <p>Applicera port-profile, kan t.ex. appliceras under port-channel eller ethernet-interface.</p> <p><code>interface\u00a0ethernet\u00a01/1</code> <code>inherit\u00a0port-profile\u00a0ACCESS</code></p> <p>Verifiering</p> <p><code>show\u00a0run\u00a0interface\u00a0ethernet\u00a01/1\u00a0expand-port-profile</code> <code>show\u00a0port-profile</code></p>"},{"location":"cisco/Cisco_Nexus/#checkpoint","title":"Checkpoint","text":"<p>Nexusswitchar har en inbyggd funktion f\u00f6r Configuration Roll Back. Checkpoint-featuren l\u00e5ter admins spara konfigurationssnapshots. Sedan kan man rollbacka n\u00e4r man beh\u00f6ver. Exempelvis n\u00e4r man tar bort en feature (no feature xxx) s\u00e5 skapar Feature Manager automatiskt en checkpoint.</p> <p>Skapa checkpoint</p> <p><code>checkpoint</code></p> <p>Show checkpoints</p> <p><code>show\u00a0checkpoint\u00a0summary</code></p> <p>Diff</p> <p><code>show\u00a0diff\u00a0rollback-patch\u00a0checkpoint\u00a0user-checkpoint-1\u00a0running-config</code></p> <p>Rollback</p> <p><code>rollback\u00a0running-config\u00a0checkpoint\u00a0user-checkpoint-1</code></p> <p>Delete</p> <p><code>clear\u00a0checkpoint\u00a0database</code></p>"},{"location":"cisco/Cisco_Nexus/#portmode","title":"Portmode","text":"<p>P\u00e5 vissa nexus-modeller kan man st\u00e4lla olika portmodes, t.ex. 93180LC och YC. I LC modellen s\u00e5 kan man s\u00e4tta 18x100g is\u00e4llet f\u00f6r 4x100g+28x40g, man kan ocks\u00e5 k\u00f6ra 6x100g+24x40g.</p> <p>F\u00f6r att st\u00e4lla in 18x100g</p> <p><code>hardware\u00a0profile\u00a0portmode\u00a018x100g</code></p> <p>F\u00f6r 6x100g+24x40g</p> <p><code>hardware\u00a0profile\u00a0portmode\u00a06x100g+24x40g</code></p> <p>F\u00f6r 4x100g+28x40g</p> <p><code>hardware\u00a0profile\u00a0portmode\u00a04x100g+28x40g</code></p> <p>Man m\u00e5ste sedan spara configen och starta om switchen f\u00f6r att detta skall b\u00f6rja g\u00e4lla.</p>"},{"location":"cisco/Cisco_Nexus/#nexus-9000v","title":"Nexus 9000v","text":"<p>Nexus 9000v Switch \u00e4r en virtuell maskin som man kan anv\u00e4nda f\u00f6r att testa NX-OS features. Nexus 9000v funkar t.ex. i EVE-NG. Dock funkar inte alla features, t.ex. QoS, BFD, Storm-control, FCoE och MACsec.</p> <p>Man m\u00e5ste l\u00e4gga in i startup-config vilken image switchen ska boota ifr\u00e5n. H\u00e4r f\u00f6ljer lite grundkonfig.</p> <p><code>hostname\u00a0N9K01</code> <code>boot\u00a0nxos\u00a0bootflash:/nxos.7.0.3.I7.3.bin</code> <code>feature\u00a0lldp</code> <code>terminal\u00a0width\u00a0110</code> <code>spanning-tree\u00a0mode\u00a0mst</code> <code>line\u00a0console</code> <code>exec-timeout\u00a00</code></p> <p><code>policy-map\u00a0type\u00a0control-plane\u00a0COPP</code> <code>control-plane</code> <code>service-policy\u00a0input\u00a0COPP</code></p> <p>Detta kommando anv\u00e4nds ist\u00e4llet f\u00f6r show mac address-table p\u00e5 Nexus 9000v.</p> <p><code>show\u00a0system\u00a0internal\u00a0l2fwder\u00a0mac</code></p>"},{"location":"cisco/Cisco_Nexus/#ansible","title":"Ansible","text":"<p><code>ansible-galaxy\u00a0collection\u00a0install\u00a0cisco.nxos</code></p> <p>nxos.yml</p> <p><code>---</code> <code>ansible_connection:\u00a0ansible.netcommon.httpapi</code> <code>ansible_httpapi_use_ssl:\u00a0true</code> <code>ansible_httpapi_validate_certs:\u00a0false</code> <code>ansible_network_os:\u00a0cisco.nxos.nxos</code> <code>ansible_user:\u00a0admin</code> <code>ansible_password:\u00a0password</code></p> <p>hosts.yml</p> <p><code>---</code> <code>all:</code> <code>hosts:</code> <code>switch1:</code> <code>ansible_host:\u00a010.0.0.40</code> <code>switch2:</code> <code>ansible_host:\u00a010.0.0.41</code></p> <p>ansible.cfg</p> <p><code>[defaults]</code> <code>collections_paths\u00a0\u00a0\u00a0=\u00a0./collections</code> <code>inventory\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0=\u00a0./inventory</code> <code>forks\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0=\u00a015</code> <code>stdout_callback\u00a0=\u00a0yaml</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_OSPF/","title":"Cisco OSPF","text":"<p>Open Shortest Path First (RFC 2328) \u00e4r ett link-state routingprotokoll standardiserat av Internet Engineering Task Force (IETF). Link-state inneb\u00e4r att enheterna k\u00e4nner till alla l\u00e4nkar i topologin och deras operational states och lagrar detta i en LSDB. OSPF konvergerar snabbt och har bra skalbarhet. Det kommunicerar med multicast som har ttl satt till 1 alternativt unicast p\u00e5 vissa n\u00e4tverkstyper. OSPF anv\u00e4nder IP protokoll #89. Se \u00e4ven Cisco OSPFv3 f\u00f6r IPv6-st\u00f6d.</p> <p>Type: Link State</p> <p>Algorithm: Dijkstra</p> <p>AD: 110</p> <p>Metric: Cost (Bandwidth)</p> <p>Protocols: IP</p> <p>Packets: 5</p>"},{"location":"cisco/Cisco_OSPF/#metric","title":"Metric","text":"<p>OSPF i IOS anv\u00e4nder 100MBit/s som referensbandbredd f\u00f6r att r\u00e4kna ut cost p\u00e5 varje l\u00e4nk. Man kan \u00e4ndra detta till t.ex. 100G.</p> <p><code>router\u00a0ospf\u00a01</code> <code>auto-cost\u00a0reference-bandwidth\u00a0100000\u00a0\u00a0#Mbits\u00a0per\u00a0second</code> <code>show\u00a0ip\u00a0ospf\u00a0interface\u00a0|\u00a0i\u00a0Cost</code></p> <p>Om man st\u00e4nger av auto-cost f\u00e5r alla l\u00e4nkar samma cost (10) oavsett bandbredd, s\u00e5 som IS-IS fungerar.</p> <p>Preferens Det \u00e4r viktigt att k\u00e4nna till att olika typer av routes har olika preferens och detta g\u00e5r f\u00f6re metric f\u00f6r path selection. I vissa fall g\u00e5r detta att \u00e4ndra.</p> <ol> <li>intra-area</li> <li>inter-area</li> <li>external</li> <li>nssa-external</li> </ol> <p>Routrar f\u00f6redrar default N2 routes \u00f6ver E2 routes som injicerats av typ-7 till typ-5 translator men detta g\u00e5r att \u00e4ndra.</p> <p><code>router\u00a0ospf\u00a01</code> <code>compatible\u00a0rfc1587</code></p>"},{"location":"cisco/Cisco_OSPF/#packets","title":"Packets","text":"<p>Alla paket kan vara unicast eller multicast, det avg\u00f6rs av n\u00e4tverkstyp.</p> <ul> <li>Hello: Anv\u00e4nds f\u00f6r att uppt\u00e4cka grannar. Inneh\u00e5ller mask,     timers, flaggor (capabilities), DR/BDR (om det finns) och router-ID     f\u00f6r grannar.</li> </ul>    Exempel:    [](/File:Cisco_OSPF_Hello.PNG \"wikilink\")   <ul> <li>Database Description: Inneh\u00e5ller LSA headers under den initiala     topologi-synken. Anv\u00e4nds f\u00f6rst f\u00f6r att avg\u00f6ra master/slave i     grannskapet, h\u00f6gst router-id blir master.</li> </ul>    Exempel:    [](/File:Cisco_OSPF_DD.PNG \"wikilink\")   <ul> <li>Link-State Request: Inneh\u00e5ller vilka LSA:er som avs\u00e4ndaren vill     ha alla detaljer om.</li> </ul>    Exempel:    [](/File:Cisco_OSPF_Request.PNG \"wikilink\")   <ul> <li>Link-State Update: Inneh\u00e5ller alla typer och detaljer om LSA:er     och skickas p\u00e5 f\u00f6rfr\u00e5gan eller vid topologi\u00e4ndring</li> </ul>    Exempel:    [](/File:Cisco_OSPF_Update.PNG \"wikilink\")   <ul> <li>Link-State Acknowledgment: LSU confirmation.</li> </ul>    Exempel:    [](/File:Cisco_OSPF_Ack.PNG \"wikilink\")"},{"location":"cisco/Cisco_OSPF/#grannskap","title":"Grannskap","text":"<p>OSPF-grannskap har best\u00e4mda tillst\u00e5nd och neighbors m\u00e5ste komma \u00f6verens om:</p> <ul> <li>Subn\u00e4t/Mask</li> <li>Area</li> <li>Timers</li> <li>Olika router-ID</li> <li>Flaggor: Stub, NSSA</li> <li>MTU</li> <li>Authentication type</li> <li>Kompatibla n\u00e4tverkstyper, DR-election eller ej</li> </ul> <p>Neighbor states Kronologisk ordning</p> <ul> <li>Down: Initial state. Om det inte kommer in n\u00e5gra OSPF-paket under     Dead interval blir grannen down.</li> <li>Attempt: G\u00e4ller endast NBMA och point-to-multipoint nonbroadcast.</li> <li>Init: Ett hello (utan mottagarens router-ID) har tagits emot.</li> <li>2-way: Ett hello med mottagarens router-ID har tagits emot.</li> <li>ExStart: Utbyta tomma DD f\u00f6r att best\u00e4mma master/slave.</li> <li>Exchange: Utbyta database description</li> <li>Loading: LSA:er tankas \u00f6ver</li> <li>Full: Allt klart</li> </ul>"},{"location":"cisco/Cisco_OSPF/#lsa-typer","title":"LSA-typer","text":"<p>LSUer inneh\u00e5ller link-state advertisements, dessa beskriver l\u00e4nkar och enheter i n\u00e4tverket. Det \u00e4r endast den router som en LSA h\u00e4rstammar ifr\u00e5n som f\u00e5r modifiera eller ta bort LSA:n. Andra routrar m\u00e5ste processa och skicka den omodifierad vidare inom sitt flodding scope, de f\u00e5r ej droppa den innan maximum lifetime har g\u00e5tt ut. Detta s\u00e4kerst\u00e4ller att alla routrar har identiska LSDB men det medf\u00f6r ocks\u00e5 att man blir begr\u00e4nsad i var man kan aggregera och filtrera routes. F\u00f6r att ta bort en LSA snabbt s\u00e4tts age till 3600 sekunder (maximum lifetime) och den kommer d\u00e5 att tas bort direkt. En LSA header \u00e4r vanligtvis 20 bytes.</p> <p>De vanligaste LSAerna.</p> <ul> <li>Type 1, Router:     Alla routrar skapar och floodar en LSA som representerar sig sj\u00e4lv.     Det finns information om vilka interface och grannar som finns i den     arean. Floodas endast inom origin area. ABR s\u00e4tter B-biten och ASBR     s\u00e4tter E-biten f\u00f6r att informera arean om sin roll.</li> </ul> <p><code>show\u00a0ip\u00a0ospf\u00a0database\u00a0router</code> <code>show\u00a0ip\u00a0ospf\u00a0database\u00a0router\u00a0|\u00a0i\u00a0Link</code></p> <ul> <li>Type 2, Network:     Dessa representerar transit subn\u00e4t och skapas endast om det finns en     DR p\u00e5 det subn\u00e4tet, dvs multiaccess-segment. LSID s\u00e4tts till DRs     interface IP p\u00e5 subn\u00e4tet men inneh\u00e5ller ocks\u00e5 information (RID) om     alla grannar till DR p\u00e5 det subn\u00e4tet. Floodas endast inom origin     area.</li> </ul> <p><code>show\u00a0ip\u00a0ospf\u00a0database\u00a0network</code></p> <p>Note: Typ 1 och 2 r\u00e4cker f\u00f6r att alla routrar inom arean ska kunna k\u00e4nna till topologin och k\u00f6ra SPF f\u00f6r att best\u00e4mma b\u00e4sta v\u00e4garna.</p> <ul> <li>Type 3, Net Summary:     Typ 1 och 2 g\u00e5r ej till andra areor utan ist\u00e4llet skapar ABR (router     med ben i 2 areor) typ 3 LSA:er (en ABR genererar aldrig summary LSA     om den inte har ett ben i area 0). Det som annonseras \u00e4r samma men     den enda infon som skickas med \u00e4r: subn\u00e4t, mask och costen f\u00f6r ABR     att n\u00e5 dit. Typ 3 LSA:er korsar aldrig areor, ist\u00e4llet har ABR en     intern OSPF-routingtabell som inneh\u00e5ller allt som har kommit i     backbone-arean och f\u00f6r varje intra- eller inter-area route skapas     det nya typ 3 LSAer som floodas i nonbackbone-arean. OBS ABR     accepterar endast typ 3 LSA:er fr\u00e5n backbone area, detta f\u00f6r att     f\u00f6rhindra routingloopar.</li> </ul> <p><code>show\u00a0ip\u00a0ospf\u00a0border-routers</code> <code>show\u00a0ip\u00a0ospf\u00a0database\u00a0summary</code></p> <ul> <li>Type 4, ASBR Summary:     N\u00e4r en ABR floodar vidare en typ 5 LSA in i sin area vet inte \u00f6vriga     routrar i arean hur l\u00e5ngt det \u00e4r till ASBR. D\u00e4rf\u00f6r skapar den en LSA     typ 4 som den ocks\u00e5 floodar. Den inneh\u00e5ller ASBRs RID och ABRs cost     till ASBR. Typ 4 LSA:er beh\u00f6ver inte finnas i samma area som ASBR     eftersom d\u00e4r ber\u00e4ttar ASBR om sig sj\u00e4lv med typ 1 LSA med E-biten     satt utan dessa beh\u00f6vs i \u00f6vriga areor.</li> </ul> <p><code>show\u00a0ip\u00a0ospf\u00a0database\u00a0asbr-summary</code></p> <ul> <li>Type 5, AS External:     N\u00e4r en ASBR skickar in en extern route skapar den en typ 5 LSA som     inneh\u00e5ller metric och metric type. Det som \u00e4r intressant f\u00f6r \u00f6vriga     routrar att veta \u00e4r hur l\u00e5ngt det \u00e4r till ASBR och ifall det finns     flera v\u00e4gar som \u00e4r lika anv\u00e4nds alla. Finns det flera ASBR anv\u00e4nds     den som \u00e4r n\u00e4rmast internt enligt SPF.</li> </ul> <p><code>show\u00a0ip\u00a0ospf\u00a0border-routers</code> <code>show\u00a0ip\u00a0ospf\u00a0database\u00a0external</code></p> <p>Det finns tv\u00e5 typer av externa routes, E1 (increment metric) och E2 (do not increment metric). Detta avg\u00f6rs beroende p\u00e5 vad ASBR s\u00e4tter f\u00f6r flagga p\u00e5 LSAn. Default p\u00e5 Cisco \u00e4r E2 f\u00f6r redistribution, dock \u00e4r E1 prefered \u00f6ver E2. Externa routes m\u00e5ste \u00e4ven inneh\u00e5lla en Forwarding Address. Vanligtvis s\u00e4tts 0.0.0.0, det inneb\u00e4r att det ska skickas till ASBR sj\u00e4lv. Det finns dock situationer n\u00e4r man vill ha n\u00e5got annat (nonzero) f\u00f6r att undvika suboptimal routing. Denna adress m\u00e5ste k\u00e4nnas till intra- eller interarea annars installeras inte routen i routingtabellen.</p> <ul> <li>Type 7, NSSA External:</li> </ul> <p>Floodas inom egna NSSA-arean, \u00f6vers\u00e4tts till LSA typ 5 av ABR med h\u00f6gst RID f\u00f6r att l\u00e4mna arean OM Propagate-biten \u00e4r satt till 1. Annars stannar LSA:n inom arean, detta konfigureras vid redistributionen med nyckelordet nssa-only. Om man vill att trafiken alltid ska g\u00e5 igenom translator kan man suppressa forward address, area 1 nssa translate type7 suppress-fa.</p> <p><code>show\u00a0ip\u00a0ospf\u00a0database\u00a0nssa-external</code></p> <p>Show</p> <p>Se alla LSA:er och RIB.</p> <p><code>show\u00a0ip\u00a0ospf\u00a0database</code> <code>show\u00a0ip\u00a0ospf\u00a0rib</code> <code>show\u00a0ip\u00a0ospf\u00a0topology-info</code></p> <p>Kolla vilka LSA:er en viss nod annonserar ut.</p> <p><code>show\u00a0ip\u00a0ospf\u00a0database\u00a0adv-router</code> <ul> <li>Others: Typ 6 (MOSPF) och 8 st\u00f6ds inte p\u00e5 Cisco-routrar och 9-11     \u00e4r Opaque.</li> </ul>"},{"location":"cisco/Cisco_OSPF/#area-types","title":"Area types","text":"<p>Att dela upp sitt n\u00e4tverk i OSPF-areor \u00e4r grunden f\u00f6r att g\u00f6ra OSPF mer skalbart eftersom det sparar p\u00e5 SPF-ber\u00e4kningar. Med dagens CPU:er kan dock areor bli r\u00e4tt stora innan det blir n\u00f6dv\u00e4ndigt att dela upp det. F\u00f6rutom vanliga areor finns det flera andra typer av areor.</p> <p>Stub Alla areor beh\u00f6ver inte k\u00e4nna till alla externa n\u00e4tverk. D\u00e5 kan man reducera overhead genom att ha areor d\u00e4r man endast skickar in LSA typ 3. Dvs det finns ingen ASBR och LSA typ 4 och 5 stoppas vid ABR. Skulle det komma en LSA 4/5 fr\u00e5n n\u00e5gon s\u00e5 ignoreras den. F\u00f6r att hitta ut ur arean s\u00e5 skickar ABR:er in default route med en LSA typ 3.</p> <p><code>router\u00a0ospf\u00a01</code> <code>area\u00a01\u00a0stub</code></p> <p>Stub bit is sent in hello packets</p> <p>Totally Stubby Totally stubby \u00e4r samma som stubby fast alla LSA typ 3 blockas ocks\u00e5 f\u00f6rutom default routen. Inga LSA typ 3,4,5 g\u00f6r att LSDB reduceras ytterligare. ABR</p> <p><code>area\u00a01\u00a0stub\u00a0no-summary</code></p> <p>Others</p> <p><code>area\u00a01\u00a0stub</code></p> <p>NSSA Om man vill effektivisera OSPF samtidigt som man beh\u00f6ver injicera in routes fr\u00e5n n\u00e5got annat protokoll genom n\u00e5gon router i en stubby area s\u00e5 kommer det inte att funka eftersom LSA 4/5 ignoreras. D\u00e5 kan man anv\u00e4nda en not-so-stubby area. D\u00e5 s\u00e4tter routrarna N-biten i hellos och skapar ASBR typ 7 LSA:er ist\u00e4llet. NSSA \u00e4r en kompromiss som till\u00e5ter att externa routes kan laddas upp till backbone-arean medans all information fr\u00e5n \u00f6vriga areor ej beh\u00f6ver tas in i arean. I en NSSA kommer inte default routen att annonseras default som i \u00f6vriga stubby areas.</p> <p><code>router\u00a0ospf\u00a01</code> <code>area\u00a01\u00a0nssa</code> <code>area\u00a01\u00a0nssa\u00a0default-information-originate</code></p> <p>NSSA Totally Stubby NSSA Totally Stubby \u00e4r samma som NSSA fast alla LSA typ 3 blockas ocks\u00e5 f\u00f6rutom default routen, samt att default routen injiceras default. Inga LSA typ 3,4,5. Ett ben i area 0 kr\u00e4vs f\u00f6r detta kommando.</p> <p><code>area\u00a01\u00a0nssa\u00a0no-summary</code></p> <p>Transit Non-backbone areas kan anv\u00e4ndas f\u00f6r inter-area transit om det finns en kortare v\u00e4g igenom dem. Transit \u00e4r p\u00e5 default men g\u00e5r att st\u00e4nga av.</p> <p><code>router\u00a0ospf\u00a01</code> <code>no\u00a0capability\u00a0transit</code> <code>show\u00a0ip\u00a0ospf\u00a0|\u00a0i\u00a0transit</code></p>"},{"location":"cisco/Cisco_OSPF/#natverkstyper","title":"N\u00e4tverkstyper","text":"<p>Det finns olika typer av n\u00e4tverk och pga hur OSPF fungerar m\u00e5ste man konfigurera det lite olika beroende p\u00e5 typ. T.ex. DR/BDR election h\u00e5lls endast p\u00e5 broadcast och NBMA. Om frame relay anv\u00e4nds m\u00e5ste DR och BDR ha PVC till alla andra routrar annars f\u00e5r inte alla uppdateringar. P\u00e5 multiaccess och point-to-point (ethernet) anv\u00e4nds default n\u00e4tverkstypen BROADCAST. Beroende p\u00e5 n\u00e4tverkstyp beh\u00f6vs neighbor-kommandot anv\u00e4ndas eller ej, regel \u00e4r non-broadcast needs neighbors. Point-to-multipoint interface annonseras som /32:or av effektivitetssk\u00e4l och l\u00e4mpar sig v\u00e4l om man k\u00f6r OSPF \u00f6ver Cisco_L2VPN#VPLS.</p> <p><code>show\u00a0ip\u00a0ospf\u00a0interface\u00a0|\u00a0i\u00a0protocol|Network\u00a0Type</code></p> <p>\u00c4ndra n\u00e4tverkstyp p\u00e5 ett interface. Det beh\u00f6ver tekniskt sett inte vara samma p\u00e5 b\u00e5da sidor s\u00e5l\u00e4nge det som beh\u00f6vs matchar, t.ex. timers.</p> <p><code>interface\u00a0gi0/0</code> <code>ip\u00a0ospf\u00a0network\u00a0?</code></p> <p>Loopback annonseras default som stub endpoint (/32), detta \u00e4ndras med n\u00e4tverkstyp point-to-point.</p> <p><code>interface\u00a0lo0</code> <code>ip\u00a0ospf\u00a0network\u00a0point-to-point</code></p>"},{"location":"cisco/Cisco_OSPF/#designated-router","title":"Designated Router","text":"<p>OSPF optimerar flooding-processen p\u00e5 multiaccess-l\u00e4nkar genom att anv\u00e4nda designated routers och backup designated routers. Annars hade varenda router p\u00e5 ett s\u00e5dant segment beh\u00f6vt uppr\u00e4tta fulla grannskap med alla andra. Med en DR r\u00e4cker det med att alla utbyter LSDB endast med den, detta resulterar i mindre trafik. Varje router har fullt grannskap med DR och BDR, 2-way med \u00f6vriga. DR har tv\u00e5 syften, det \u00e4r ocks\u00e5 s\u00e5 att det \u00e4r DRs som skapar typ 2 LSAn som representerar multiaccess-segmentet, annars hade det beh\u00f6vts f\u00f6r varje grannskap och det hade inte blivit n\u00e5gon vacker LSDB.</p> <p>Beh\u00f6ver en DR skicka ut en LSU g\u00f6r den det till 224.0.0.5 som alla DROther lyssnar p\u00e5. Beh\u00f6ver en DROther skicka en uppdatering g\u00f6r den det till 224.0.0.6 som DR och BDR lyssnar p\u00e5 (det \u00e4r av denna anledning det beh\u00f6vs en BDR). Alla enheter som f\u00e5r en LSU ackar den med en unicast LSAck till avs\u00e4ndaren, med undantag om LSUn kom fr\u00e5n sig sj\u00e4lv. I n\u00e4tverkssegment utan DR anv\u00e4nds 224.0.0.5 f\u00f6r allt.</p> <p>DR election g\u00f6rs mellan 2-way och ExStart i och med att Hellos inneh\u00e5ller DR/BDR om det finns. Om det kommer in en Hello med DR satt till 0.0.0.0 betyder det att det inte finns n\u00e5gon DR \u00e4n, t.ex. efter ett outage. D\u00e5 v\u00e4ntar routern en liten stund f\u00f6r att ge andra en chans att komma upp. Detta kallas OSPF wait time och \u00e4r st\u00e4llt till samma som Dead time p\u00e5 det interfacet. Under wait time lyssnar routern in RID och prioritet fr\u00e5n sina grannar. Val av DR/BDR g\u00f6rs f\u00f6rst efter wait time \u00e4r \u00f6ver. Election g\u00f6rs lokalt p\u00e5 routern utifr\u00e5n de v\u00e4rden som kommit in. Dock slutar det alltid med att alla har samma.</p> <p>Finns det en DR RID i ett Hello som kommer in s\u00e5 har n\u00e5gon annat gjort valet och man kan direkt hoppa till election, dvs skippa resten av wait time. Det som g\u00f6rs d\u00e5 \u00e4r att man fyller den roll som ej \u00e4r fylld, t.ex. BDR genom att ta den h\u00f6gsta prioriteten och h\u00f6gsta router id som man k\u00e4nner till. Detta g\u00f6r att det inte finns n\u00e5gon preemption. D\u00e4remot kan det tillf\u00e4lligt existera routrar som \u00e4r klara med election och som har kommit fram till olika slutsatser. D\u00e5 h\u00e5lls election igen och man byter DR och BDR till de med h\u00f6gst prio/id n\u00e4r man uppt\u00e4ckte krocken. Om man k\u00f6r samma prio p\u00e5 alla och st\u00f6ter p\u00e5 att det inte h\u00f6gsta RID som \u00e4r DR \u00e4r det f\u00f6r att den med l\u00e4gre RID har kommit upp f\u00f6rst. Det finns som sagt ingen preemption.</p> <p>Alla routrar med OSPF priority 1-255 \u00e4r med i election, 1 \u00e4r default och s\u00e4tter man 0 ignoreras DR/BDR election p\u00e5 den enheten som d\u00e4rmed aldrig kan bli DR. Det \u00e4r viktigt att DR kan n\u00e5 alla andra vilket inte \u00e4r fallet i en hub-and-spoke-topologi d\u00e4r en spoke \u00e4r DR, se \u00e4ven Cisco DMVPN.</p> <p><code>interface\u00a0gi0/0</code> <code>ip\u00a0ospf\u00a0priority\u00a050</code></p> <p>\u00c4ven om det inte uppt\u00e4cks n\u00e5gra grannar p\u00e5 ett interface d\u00e4r DR election vanligtvis h\u00e5lls s\u00e5 kommer OSPF \u00e4nd\u00e5 h\u00e5lla valet med sig sj\u00e4lv som vinnare, det v\u00e4ntas allts\u00e5 inte p\u00e5 grannskap f\u00f6rst. Om det d\u00e4remot endast finns en OSPF-router p\u00e5 ett segment s\u00e5 kallas detta stub network och ingen LSA typ 2 kommer att genereras f\u00f6r det \u00e4r on\u00f6digt utan d\u00e5 blir n\u00e4tverksadressen och subn\u00e4tmasken en LSA typ 1 som floodas.</p>"},{"location":"cisco/Cisco_OSPF/#konfiguration","title":"Konfiguration","text":"<p>Routrar m\u00e5ste ha ett OSPF-id f\u00f6r att kunna skicka meddelanden, p\u00e5 Ciscoenheter v\u00e4ljs ID enligt f\u00f6ljande ordning:</p> <ol> <li>router-id kommandot</li> <li>H\u00f6gsta IP-adressen p\u00e5 ett no-shut loopback interface (som ej \u00e4r     assignat n\u00e5gon annan OSPF-process)</li> <li>H\u00f6gsta IP-adressen p\u00e5 ett no-shut interface (som ej \u00e4r assignat     n\u00e5gon annan OSPF-process)</li> </ol> <p>Interfacen beh\u00f6ver inte vara n\u00e5bara eller ha n\u00e5got med OSPF att g\u00f6ra utan alla interface j\u00e4mf\u00f6rs. ID \u00e4ndras endast n\u00e4r processen startas om.</p> <p>router-id for this OSPF process (in IPv4 address format)</p> <p><code>router\u00a0ospf\u00a01</code> <code>router-id\u00a01.1.1.1</code></p> <p>Administrative Distance</p> <p><code>router\u00a0ospf\u00a01</code> <code>distance\u00a0ospf\u00a0intra-area\u00a0110\u00a0inter-area\u00a0110\u00a0external\u00a0110</code> <code>show\u00a0ip\u00a0protocols\u00a0|\u00a0i\u00a0Distance</code></p> <p>Advertise a maximum metric so that other routers do not prefer the router as an intermediate hop for 60 seconds.</p> <p><code>max-metric\u00a0router-lsa\u00a0on-startup\u00a060</code></p> <p>MTU mismatch</p> <p><code>ip\u00a0ospf\u00a0mtu-ignore</code></p> <p>Allm\u00e4nna rekommendationer</p> <ul> <li>Set your maximum LSA settings to keep from killing weak boxes     (max-lsa)</li> <li>Baseline your network so you know how many LSAs normally float     around</li> <li>Configure LSA warnings to alert of problems</li> <li>Crash each type of box on your network in a lab environment so you     know what it will do under stress.</li> </ul> <p>MPLS Om man k\u00f6r OSPF kan man autoenablea LDP p\u00e5 alla OSPF-interface. Se \u00e4ven Cisco MPLS och Segment Routing.</p> <p><code>router\u00a0ospf\u00a01</code> <code>mpls\u00a0ldp\u00a0autoconfig</code> <code>show\u00a0ip\u00a0ospf\u00a0mpls\u00a0ldp\u00a0interface</code></p> <p>IP unnumbered Man kan k\u00f6ra IP unnumbered med OSPF och det finns ett network statement som matchar IP-adressen p\u00e5 prim\u00e4r-interfacet s\u00e5 kommer b\u00e5da interfacen att anv\u00e4ndas av OSPF i den valda arean. N\u00e4r man anv\u00e4nder unnumbered kommer routern att ignorera source IP address i hello-paketen vilket annars fungerar som en check s\u00e5 att inte vilket paket som helst accepteras utan det ska komma fr\u00e5n det subn\u00e4t som det mottagande interfacet sitter i. Man kan ha loopback och fysiska interface i olika areor, dock kommer man att annonsera samma prefix i fler \u00e4n en area.</p> <p><code>interface\u00a0gi0/1</code> <code>ip\u00a0unnumbered\u00a0Loopback0</code> <code>ip\u00a0ospf\u00a0network\u00a0point-to-point</code> <code>ip\u00a0ospf\u00a01\u00a0area\u00a01</code></p>"},{"location":"cisco/Cisco_OSPF/#adjacency","title":"Adjacency","text":"<p>Logga \u00e4ndringar i neighbor state, detta \u00e4r p\u00e5 default.</p> <p><code>router\u00a0ospf\u00a01</code> <code>log-adjacency-changes</code> <code>show\u00a0ip\u00a0ospf\u00a0events</code></p> <p>Styr grannskap/uppdateringar med passive-interface</p> <p><code>passive-interface\u00a0default</code> <code>no\u00a0passive-interface\u00a0[interface]</code> <code>show\u00a0ip\u00a0ospf\u00a0interface\u00a0|\u00a0i\u00a0Ethernet|Passive</code></p> <p>Unicast Specificera granne manuellt, detta m\u00e5ste g\u00f6ras p\u00e5 NBMA och point-to-multipoint nonbroadcast. Det r\u00e4cker att g\u00f6ra detta p\u00e5 ena sidan f\u00f6r att grannskap ska bildas men best practice \u00e4r att k\u00f6ra detta p\u00e5 b\u00e5da sidor.</p> <p><code>router\u00a0ospf\u00a01</code> <code>neighbor\u00a010.0.0.2</code></p> <p>Per neighbor cost/metric</p> <p><code>neighbor\u00a010.0.0.5\u00a0cost\u00a01000</code></p> <p>Man kan s\u00e4tta prioritet p\u00e5 sina grannar om man k\u00f6r unicast. Default \u00e4r detta 0 men om man har flera neighbor statements och n\u00e5gon har icke-noll s\u00e5 kommer routern att f\u00f6rst skicka Hellos till denna. Endast n\u00e4r DR/BDR election \u00e4r klart s\u00e5 b\u00f6rjar det skickas Hellos till de \u00f6vriga grannarna. Detta \u00e4r en mekanism som \u00f6kar chansen att DR och BDR blir de routrar man vill. OBS detta har inget med vinnare av DR/BDR att g\u00f6ra.</p> <p><code>router\u00a0ospf\u00a01</code> <code>neighbor\u00a010.0.0.5\u00a0priority\u00a0&lt;0-255&gt;</code></p> <p>Verify</p> <p><code>show\u00a0ip\u00a0ospf\u00a0neighbor</code> <code>show\u00a0ip\u00a0ospf\u00a0interface\u00a0brief</code> <code>show\u00a0ip\u00a0ospf\u00a0neighbor\u00a0detail\u00a0|\u00a0i\u00a0interface</code> <code>ping\u00a0224.0.0.5</code></p> <p>Clearing routing process</p> <p><code>clear\u00a0ip\u00a0ospf\u00a0process</code> <code>debug\u00a0ip\u00a0ospf\u00a0adj</code></p> <p>GTSM TTL Security Check kan konfigureras per process eller per interface och g\u00e4ller b\u00e5de unicast och multicast. Dessa kommandon har ingen inverkan p\u00e5 virtual links eller sham links utan det g\u00f6rs med area virtual-link ttl-security och area sham-link ttl-security.</p> <p><code>router\u00a0ospf\u00a01</code> <code>ttl-security\u00a0all-interfaces</code> <code>interface\u00a0gi2</code> <code>ip\u00a0ospf\u00a0ttl-security</code></p> <p>Graceful restart En router kan starta om OSPF-grannskap och \u00e4nd\u00e5 forts\u00e4tta forwarda paket som vanligt med hj\u00e4lp av Graceful OSPF Restart (RFC 3623). Cisco har \u00e4ven en egen variant av detta som kallas NSF (Non Stop Forwarding) men IOS har st\u00f6d f\u00f6r b\u00e5da varianterna. Den som restartar skickar grace-LSA och hamnar i restart mode och directly connected grannar m\u00e5ste st\u00f6dja helper mode f\u00f6r att detta ska lira. Helpers m\u00e5ste ignorera att det uteblir Hellos under antydd period och l\u00e5tsas som att grannskapet \u00e4r uppe och DR \u00e4r densamme. \u00d6verskrids tidsgr\u00e4nsen rivs adjacency direkt. NSF-aware (helper support) finns p\u00e5 de flesta enheter och \u00e4r p\u00e5 default, nsf ietf/cisco helper medans NSF-capable finns p\u00e5 high-end plattformar. GR/NSF utnyttjar att modernare enheter sk\u00f6ter data plane och control plane i olika h\u00e5rdvara.</p> <p><code>router\u00a0ospf\u00a01</code> <code>nsf\u00a0ietf</code> <code>nsf\u00a0cisco</code></p> <p><code>show\u00a0ip\u00a0ospf\u00a0nsf</code></p> <p>NSR \u00e4r en intern mekanism som l\u00e5ter standby RP ta \u00f6ver etablerade sessioner vid en switchover.</p> <p><code>nsr</code> <code>show\u00a0ip\u00a0ospf\u00a0nsr</code></p> <p>Graceful shutdown Droppa adjacencies, flusha LSA:er och skicka ut Hello med tom neighbor list f\u00f6r att trigga att grannens adjacency g\u00e5r direkt till Init state, kanske inte s\u00e5 graceful men det heter s\u00e5 \u00e4nd\u00e5.</p> <p><code>router\u00a0ospf\u00a01</code> <code>shutdown</code></p> <p>Per interface</p> <p><code>int\u00a0gi2</code> <code>ip\u00a0ospf\u00a0shutdown</code></p>"},{"location":"cisco/Cisco_OSPF/#authentication","title":"Authentication","text":"<p>Klassisk OSPF authentication \u00e4r none/null, clear-text eller MD5. Default \u00e4r none och man sl\u00e5r p\u00e5 det per interface eller per area. Man kan ha multipla nycklar per interface, d\u00e5 skickas det multipla OSPF paket parallellt vilket g\u00f6r att grannskap ej g\u00e5r ner under key rotation. Detta p\u00e5g\u00e5r tills b\u00e5da sidor har samma nyckel som senast konfigurerad, dvs key ID m\u00e5ste matcha men det spelar ingen roll f\u00f6r vilken som \u00e4r att f\u00f6redra utan det \u00e4r youngest key. Det g\u00e5r \u00e4ven att k\u00f6ra authentication p\u00e5 virtual links, se det stycket.</p> <p>Enable clear-text authentication on area 0</p> <p><code>router\u00a0ospf\u00a01</code> <code>area\u00a00\u00a0authentication</code> <code>interface\u00a0gi0/1</code> <code>ip\u00a0ospf\u00a0authentication-key\u00a0[password]</code></p> <p>Enable MD5 authentication on area 0.</p> <p><code>router\u00a0ospf\u00a01</code> <code>area\u00a00\u00a0authentication\u00a0message-digest</code> <code>interface\u00a0gi0/1</code> <code>ip\u00a0ospf\u00a0message-digest-key\u00a010\u00a0md5\u00a0[password]</code></p> <p>Enable MD5 authentication on an interface</p> <p><code>interface\u00a0gi0/1</code> <code>ip\u00a0ospf\u00a0authentication\u00a0message-digest</code> <code>ip\u00a0ospf\u00a0message-digest-key\u00a010\u00a0md5\u00a0[password]</code></p> <p>Verify</p> <p><code>show\u00a0ip\u00a0ospf\u00a0interface\u00a0|\u00a0i\u00a0Ethernet|authentication</code></p> <p>Extended cryptographic authentication (RFC 5709) finns i modernare implementationer av OSPF och har st\u00f6d f\u00f6r key-chains och SHA-HMAC. Nyckel med h\u00f6gst id anv\u00e4nds ifall det finns flera nycklar som \u00e4r aktiva. Cryptographic algorithm + key bildar SA.</p> <p><code>key\u00a0chain\u00a0HACKER</code> <code>key\u00a01</code> <code>key-string\u00a0SECRET</code> <code>cryptographic-algorithm\u00a0hmac-sha-512</code></p> <p>Per interface, det finns inget area-kommando som sl\u00e5r p\u00e5 key-chain auth p\u00e5 alla interface som vid klassisk konfiguration.</p> <p><code>int\u00a0gi2</code> <code>ip\u00a0ospf\u00a0authentication\u00a0key-chain\u00a0HACKER</code></p>"},{"location":"cisco/Cisco_OSPF/#multiarea-adjacency","title":"Multiarea Adjacency","text":"<p>Med OSPFv2 Multiarea Adjacency kan man konfigurera en l\u00e4nk f\u00f6r optimal routing i flera areor. Varje multiarea interface annonseras som en point-to-point unnumbered link och fungerar som en logisk konstruktion \u00f6ver det prim\u00e4ra interfacet. Det uppr\u00e4ttas grannskap med multiarea interface p\u00e5 andra sidan och detta \u00e4r oberoende av neighbor state p\u00e5 det prim\u00e4ra interfacet. Alla OSPF-parametrar (t.ex. autentisering) \u00e4rvs fr\u00e5n det prim\u00e4ra. Det g\u00e5r endast att konfigurera multiarea adjacency p\u00e5 interface som har tv\u00e5 OSPF speakers, s\u00e5 p\u00e5 ethernet m\u00e5ste det konfigureras som network point-to-point.</p> <p><code>interface\u00a0gi2</code> <code>ip\u00a0address\u00a010.0.0.1\u00a0255.255.255.0</code> <code>ip\u00a0ospf\u00a01\u00a0area\u00a00</code> <code>ip\u00a0ospf\u00a0network\u00a0point-to-point</code> <code>ip\u00a0ospf\u00a0multi-area\u00a02</code></p> <p><code>show\u00a0ip\u00a0ospf\u00a02\u00a0multi-area</code></p>"},{"location":"cisco/Cisco_OSPF/#default-routing","title":"Default Routing","text":"<p>Kr\u00e4ver gateway of last resort.</p> <p><code>default-information\u00a0originate</code></p> <p>Om man inte har n\u00e5gon gateway of last resort kan man \u00e4nd\u00e5 annonsera ut en default route.</p> <p><code>default-information\u00a0originate\u00a0always</code></p> <p>NSSA En NSSA ABR genererar inte en default route by default (om den inte konfas som totally stubby) eftersom man inte vet om gateway of last resort ska vara i en annan area eller externt (type 7). En NSSA ASBR m\u00e5ste ha en default route i routingtabellen f\u00f6r att kunna skicka ut en default route. En NSSA ABR beh\u00f6ver inte det:</p> <p><code>area\u00a01\u00a0nssa\u00a0default-information-originate</code></p> <p>Conditional Med hj\u00e4lp av en route map kan man annonsera en default route n\u00e4r ett visst kriterie \u00e4r uppfyllt.</p> <p><code>default-information\u00a0originate\u00a0route-map\u00a0TRACK_PREFIX</code></p>"},{"location":"cisco/Cisco_OSPF/#summarization","title":"Summarization","text":"<p>OSPF-routrar inom samma area m\u00e5ste ha identiska LSDB efter att flooding \u00e4r f\u00e4rdigt vilket g\u00f6r att summering endast till\u00e5ts vid ABR eller ASBR. Med hj\u00e4lp av not-advertise i slutet av kommandona kan man styra om summeringen ska fungera som filtrering, d\u00e5 varken de mer specifika prefixen eller aggregeringen annonseras.</p> <p>ABR</p> <p><code>router\u00a0ospf\u00a01</code> <code>area\u00a010\u00a0range\u00a010.10.0.0\u00a0255.255.252.0</code></p> <p>Area 10 s\u00e4ger var summeringen kommer ifr\u00e5n s\u00e5 denna aggregering skickas till alla andra areor. Cost f\u00f6r summeringen tas fr\u00e5n den component route med l\u00e4gst metric om man inte anger n\u00e5got specifikt.</p> <p>ASBR</p> <p><code>router\u00a0ospf\u00a01</code> <code>summary-address\u00a010.10.0.0\u00a0255.255.252.0</code></p> <p>Konfigureras vid redistributionspunkt och summeringar \u00e4rver attribut fr\u00e5n component routes.</p> <p>Discard Default installeras det en discard route n\u00e4r man summerar f\u00f6r att f\u00f6rhindra att det forwarderas trafik som man inte har n\u00e5gon specifik route f\u00f6r.</p> <p><code>no\u00a0discard-route\u00a0external|internal</code></p>"},{"location":"cisco/Cisco_OSPF/#convergence","title":"Convergence","text":"<p>Tuning protocol parameters per interface.</p> <p><code>ip\u00a0ospf\u00a0hello-interval</code><code>seconds</code> <code>ip\u00a0ospf\u00a0dead-interval</code><code>seconds</code> <code>ip\u00a0ospf\u00a0retransmission-interval</code><code>seconds</code> <code>ip\u00a0ospf\u00a0transmit-delay</code><code>seconds</code></p> <p>Fast Hellos, dead-interval minimal = 1 sek.</p> <p><code>ip\u00a0ospf\u00a0dead-interval\u00a0minimal\u00a0hello-multiplier\u00a03</code></p> <p>Timers: LSA &amp; SPF</p> <p><code>router\u00a0ospf\u00a01</code> <code>timers\u00a0throttle\u00a0spf\u00a0100\u00a01000\u00a010000</code> <code>timers\u00a0pacing\u00a0flood\u00a050</code> <code>timers\u00a0pacing\u00a0retransmission\u00a075</code> <code>timers\u00a0throttle\u00a0lsa\u00a0all\u00a010\u00a04000\u00a06000</code> <code>timers\u00a0lsa\u00a0arrival\u00a02000</code> <code>show\u00a0ip\u00a0ospf\u00a0|\u00a0i\u00a0msec</code></p> <p>Med Group Pacing kan LSA:er \"sam\u00e5ka\" i refresh-paket.</p> <p>SPF Prefix Priority Man kan v\u00e4lja vilka prefix som SPF-algoritm ska k\u00f6ra f\u00f6rst. Man skapar en route-map som matchar p\u00e5 route-type, prefix-list eller route-tag.</p> <p><code>route-map\u00a0PREFIX-PRIORITY\u00a0permit\u00a010</code> <code>match\u00a0tag\u00a0100</code></p> <p><code>router\u00a0ospf\u00a01</code> <code>prefix-priority\u00a0high\u00a0route-map\u00a0PREFIX-PRIORITY</code></p> <p>Verify</p> <p><code>show\u00a0ip\u00a0ospf\u00a0rib\u00a0detail</code></p> <p>iSPF SPF-algoritmen beh\u00f6ver inte k\u00f6ras f\u00f6r alla l\u00e4nkar varje g\u00e5ng det sker en topologi-f\u00f6r\u00e4ndring. Med incremental SPF k\u00f6rs endast algoritmen f\u00f6r de delar som har p\u00e5verkats av f\u00f6r\u00e4ndringen f\u00f6r att spara CPU-cykler. Detta g\u00e5r att styra individuellt p\u00e5 enheterna med ispf-kommandot. Det kan vara sv\u00e5rt att veta exakt hur mycket skillnad detta g\u00f6r men generellt ju st\u00f6rre topologi ju st\u00f6rre skillnad. OBS iSPF \u00e4r inte l\u00e4ngre supporterat i IOS.</p> <p><code>router\u00a0ospf\u00a01</code> <code>ispf</code> <code>show\u00a0ip\u00a0ospf\u00a0|\u00a0i\u00a0Incremental</code></p> <p>BFD Se \u00e4ven BFD.</p> <p><code>router\u00a0ospf\u00a01</code> <code>bfd\u00a0all-interfaces</code></p> <p>Disable per interface</p> <p><code>int\u00a0gig2</code> <code>ip\u00a0ospf\u00a0bfd\u00a0disable</code></p>"},{"location":"cisco/Cisco_OSPF/#lsdb-optimization","title":"LSDB Optimization","text":"<p>Prefix Suppression F\u00f6r att f\u00e5 Loopback till Loopback-konnektivitet mellan alla routrar med minimal belastning p\u00e5 routingtabellen kan man skippa att ha med OSPF-l\u00e4nkn\u00e4ten i RIB. Alla noder b\u00f6r st\u00f6dja detta.</p> <p>Global</p> <p><code>router\u00a0ospf\u00a01</code> <code>prefix-suppression</code></p> <p>Per interface</p> <p><code>interface\u00a0gi2</code> <code>ip\u00a0ospf\u00a0prefix-suppression</code></p> <p>Verify</p> <p><code>show\u00a0ip\u00a0ospf\u00a0interface\u00a0|\u00a0i\u00a0Ethernet|Prefix-suppression</code></p> <p>Flooding Reduction OSPF flood reduction stoppar det normala floodandet av LSAer genom att s\u00e4tta DoNotAge (DNA) biten vilket g\u00f6r att de inte beh\u00f6ver refreshas med j\u00e4mna mellanrum.</p> <p><code>interface\u00a0Gi2</code> <code>ip\u00a0ospf\u00a0flood-reduction</code></p>"},{"location":"cisco/Cisco_OSPF/#lfa","title":"LFA","text":"<p>Eftersom OSPF-databasen \u00e4r identisk p\u00e5 alla routrar i samma area har man modifierat SPF s\u00e5 att man lokalt kan k\u00f6ra SPF-algoritmen men med en granne som rot. Detta g\u00f6r att man kan hitta alternativa loopfria v\u00e4gar \u00e4ven i komplexa topologier. Man kan specificera flera kriterier f\u00f6r vilka alternate path som ska v\u00e4ljas, t.ex. anv\u00e4nd ej de som anv\u00e4nder samma interface, next-hop eller SRLG. Man m\u00e5ste anv\u00e4nda MPLS f\u00f6r att kunna dra nytta av Loop-Free Alternate Fast Reroute och IOS supporterar endast per-link LFA. The high priority enables FRR for /32 prefixes only, the low priority enables FRR for all prefixes. The fast-reroute keep-all-paths option keeps all information in the table, including paths that were not chosen. When an area is specified, external routes are not a candidate for FRR. This is because they do not belong to an area.</p> <p>Single Hop LFA / IP FRR.</p> <p><code>router\u00a0ospf\u00a01</code> <code>fast-reroute\u00a0per-prefix\u00a0enable\u00a0prefix-priority\u00a0low</code> <code>fast-reroute\u00a0per-prefix\u00a0enable\u00a0area\u00a00\u00a0prefix-priority\u00a0high</code> <code>fast-reroute\u00a0keep-all-paths</code></p> <p><code>show\u00a0ip\u00a0ospf\u00a0fast-reroute</code> <code>show\u00a0ip\u00a0ospf\u00a0fast-reroute\u00a0prefix-summary</code> <code>show\u00a0ip\u00a0route\u00a0repair-paths</code></p> <p>Med hj\u00e4lp av Remote LFA Tunnel kan man tunnla trafik loopfritt (i n\u00e4stan alla topologier) till routrar flera hop bort utifr\u00e5n lokala ber\u00e4kningar. Detta st\u00f6ds endast i default VRF:en och kr\u00e4ver MPLS.</p> <p><code>mpls\u00a0ldp\u00a0explicit-null</code> <code>mpls\u00a0ldp\u00a0discovery\u00a0targeted-hello\u00a0accept</code> <code>router\u00a0ospf\u00a01</code> <code>fast-reroute\u00a0per-prefix\u00a0remote-lfa\u00a0tunnel\u00a0mpls-ldp</code></p> <p><code>show\u00a0ip\u00a0ospf\u00a0fast-reroute\u00a0remote-lfa\u00a0tunnels</code></p> <p>Interface options: Om ett interface inte ska kunna anv\u00e4ndas f\u00f6r backup paths.</p> <p><code>ip\u00a0ospf\u00a0fast-reroute\u00a0per-prefix\u00a0candidate\u00a0disable</code></p> <p>Primary routes som pekar p\u00e5 detta interface kommer inte att bli skyddade.</p> <p><code>ip\u00a0ospf\u00a0fast-reroute\u00a0per-prefix\u00a0protection\u00a0disable</code></p>"},{"location":"cisco/Cisco_OSPF/#filtering","title":"Filtering","text":"<p>Non-local filtering f\u00f6r OSPF kan endast g\u00f6ras p\u00e5 ABR och ASBR.</p> <p>Intra-area Filtering p\u00e5verkar inte LSDB eller flooding utan endast det som hamnar i RIB. Det g\u00e5r att g\u00f6ra med en distribute-list dock b\u00f6r alla routrar vara konfade likadant annars kan det bli blackholing.</p> <p><code>access-list\u00a01\u00a0deny\u00a0172.16.3.1</code> <code>access-list\u00a01\u00a0permit\u00a0any</code> <code>router\u00a0ospf\u00a01</code> <code>distribute-list\u00a01\u00a0in</code></p> <p>Alternativt</p> <p><code>summary-address\u00a010.0.0.0\u00a0255.255.255.0\u00a0not-advertise</code></p> <p>Administrative Distance, filtrering kan g\u00f6ras p\u00e5 Advertising Router.</p> <p><code>access-list\u00a010\u00a0permit\u00a010.0.0.0\u00a00.0.0.255</code> <code>router\u00a0ospf\u00a01</code> <code>distance\u00a0255</code><code>0.0.0.0\u00a010</code> <p>LSA Type-3 Filtering</p> <p><code>area\u00a01\u00a0range\u00a010.0.0.0\u00a0255.255.255.0\u00a0not-advertise</code></p> <p>Inter-area</p> <p><code>ip\u00a0prefix-list\u00a0PFXLIST\u00a0seq\u00a05\u00a0deny\u00a010.10.0.0/24</code> <code>ip\u00a0prefix-list\u00a0PFXLIST\u00a0seq\u00a010\u00a0permit\u00a00.0.0.0/0\u00a0le\u00a032</code></p> <p><code>router\u00a0ospf\u00a01</code> <code>area\u00a01\u00a0filter-list\u00a0prefix\u00a0PFXLIST\u00a0out|in</code></p> <p>out betyder att det som l\u00e4mnar area 1 filtreras, in betyder filtrering av det som skickas in i area 1.</p> <p>Database Filtering Man kan stoppa OSPF-processen fr\u00e5n att skicka LSA:er. Detta fungerar p\u00e5 network type point-to-multipoint och g\u00f6rs per interface alternativt neighbor. Det b\u00f6r endast anv\u00e4ndas d\u00e4r all flooding \u00e4r unnecessary, t.ex. NBMA subnets d\u00e4r det finns m\u00e5nga routrar.</p> <p><code>interface\u00a0gi2</code> <code>ip\u00a0ospf\u00a0database-filter\u00a0all\u00a0out</code></p> <p>Route-Map Med en route-map kan man matcha p\u00e5 interface, ip-adress, ip next-hop, ip route-source, metric, tagging och route-type. Eftersom det \u00e4r en distribute-list p\u00e5verkar detta endast lokala routingtabellen.</p> <p><code>access-list\u00a01\u00a0permit</code> <code>access-list\u00a02\u00a0permit</code> <p><code>route-map\u00a0DENY_R2\u00a0deny\u00a010</code> <code>match\u00a0ip\u00a0address\u00a01</code> <code>match\u00a0ip\u00a0next-hop\u00a02</code></p> <p><code>route-map\u00a0DENY_R2\u00a0permit\u00a020</code></p> <p><code>router\u00a0ospf\u00a01</code> <code>distribute-list\u00a0route-map\u00a0DENY_R2\u00a0in</code></p>"},{"location":"cisco/Cisco_OSPF/#virtual-link","title":"Virtual Link","text":"<p>OSPF kr\u00e4ver att alla areor \u00e4r anslutna till area 0. I vissa scenarior kan det vara sv\u00e5rl\u00f6st och d\u00e5 kan man anv\u00e4nda sig av virtual links f\u00f6r att tunnla OSPF-paket \u00f6ver en annan nonbackbone-area. ABR:n som ej har en direktanslutning till area 0 kan p\u00e5 s\u00e5 s\u00e4tt f\u00e5 en full kopia av LSDB:n i area 0. Det har inget med data plane att g\u00f6ra utan endast OSPF control plane. En virtual link syns i LSDB som en unnumbered point-to-point l\u00e4nk och LSU:er som skickas har DoNotAge-biten satt. Arean som tunneln g\u00e5r \u00f6ver blir en transit area och den m\u00e5ste vara en vanlig area, dvs ingen stub eller nssa. Detta pga av att data plane g\u00e5r d\u00e4rigenom som vanlig routad trafik s\u00e5 den arean m\u00e5ste k\u00e4nna till allt, intra-, inter- och external routes. VL fungerar som en demand circuit d\u00e4rf\u00f6r b\u00f6r man ta ner och upp interfacet vid konfigurations\u00e4ndringar. Interface MTU skickas ej med i DBD-paket \u00f6ver en VL. Virtual link \u00e4r rekommenderat som backup- eller tempor\u00e4r anslutning. Man kan \u00e4ven anv\u00e4nda VL f\u00f6r att koppla ihop area 0 om den finns p\u00e5 flera st\u00e4llen.</p> <p>R1 ABR mellan area 0 och 1</p> <p><code>router\u00a0ospf\u00a01</code> <code>network\u00a010.0.1.0\u00a00.0.0.255\u00a0area\u00a01</code> <code>network\u00a01.1.1.0\u00a00.0.0.255\u00a0area\u00a00</code> <code>area\u00a01\u00a0virtual-link\u00a03.3.3.3\u00a0\u00a0#Router-ID</code></p> <p>R3 ABR mellan area 1 och 2</p> <p><code>router\u00a0ospf\u00a01</code> <code>network\u00a010.0.1.0\u00a00.0.0.255\u00a0area\u00a01</code> <code>network\u00a010.0.2.0\u00a00.0.0.255\u00a0area\u00a02</code> <code>network\u00a03.3.3.0\u00a00.0.0.255\u00a0area\u00a02</code> <code>area\u00a01\u00a0virtual-link\u00a01.1.1.1\u00a0\u00a0#Router-ID</code></p> <p>Verify</p> <p><code>show\u00a0ip\u00a0ospf\u00a0virtual-links</code> <code>show\u00a0ip\u00a0ospf\u00a0border-routers</code></p> <p>Authentication</p> <p><code>area\u00a02\u00a0virtual-link\u00a02.2.2.2\u00a0authentication\u00a0message-digest\u00a0message-digest-key\u00a010\u00a0md5\u00a0CISCO</code></p>"},{"location":"cisco/Cisco_OSPF/#redistribution","title":"Redistribution","text":"<p>Default seed metric: 1 f\u00f6r BGP, 20 f\u00f6r \u00f6vrigt.</p> <p><code>default-metric\u00a020</code></p> <p>Med OSPF beh\u00f6vs ordet subnets annars redistribueras endast classful networks. I nyare IOSer kan \"subnets\" auto-konfas i vissa l\u00e4gen, man f\u00e5r kolla konfigurationen.</p> <p><code>redistribute\u00a0maximum-prefix\u00a0100</code></p> <p>NSSA En NSSA-redistribution kan man styra om den ska n\u00e5 endast NSSA-arean eller f\u00e5r g\u00f6ras om och skickas vidare till andra areor. Routrar som \u00e4r med i flera areor g\u00f6r detta automatiskt.</p> <p><code>redistribute\u00a0isis\u00a0nssa-only</code></p> <p>Static</p> <p><code>redistribute\u00a0static</code></p> <p>Notera att default route inte kan redistribueras med redistribute static, inte ens om en route-map anv\u00e4nds utan default-information originate b\u00f6r anv\u00e4ndas.</p> <p>RIP</p> <p><code>router\u00a0ospf\u00a01</code> <code>redistribute\u00a0rip\u00a0subnets</code></p> <p>EIGRP</p> <p><code>router\u00a0ospf\u00a01</code> <code>redistribute\u00a0eigrp\u00a01\u00a0subnets\u00a0tag\u00a090</code></p> <p>BGP, seed metric f\u00f6r bgp \u00e4r 1. N\u00e4r man redistribuerar prefix fr\u00e5n BGP s\u00e5 s\u00e4tts senaste AS i pathen som route tag i LSA:n.</p> <p><code>router\u00a0ospf\u00a01</code> <code>redistribute\u00a0bgp\u00a0100\u00a0subnets</code></p>"},{"location":"cisco/Cisco_OSPF/#nx-os","title":"NX-OS","text":"<p>H\u00e4r f\u00f6ljer Nexus-specifik syntax. N\u00e5gra grundl\u00e4ggande skillnader mot IOS \u00e4r att referensbandbredden f\u00f6r cost default \u00e4r 40Gbps, Loopback0 v\u00e4ljs som Router-ID oavsett IP, det finns inget network-kommando, loopbacks \u00e4r passive default och man kan konfa flera VRF:er under samma OSPF-process.</p> <p><code>feature\u00a0ospf</code></p> <p><code>router\u00a0ospf\u00a01</code> <code>log-adjacency-changes</code> <code>bfd</code></p> <p><code>interface\u00a0loopback0</code> <code>ip\u00a0router\u00a0ospf\u00a01</code></p> <p><code>interface\u00a0Ethernet1/1</code> <code>ip\u00a0router\u00a0ospf\u00a01</code></p> <p>Maintenance mode</p> <p><code>router\u00a0ospf\u00a01</code> <code>isolate</code></p> <p>Verify and troubleshoot</p> <p><code>show\u00a0run\u00a0ospf</code> <code>show\u00a0ip\u00a0ospf\u00a0neighbors</code> <code>show\u00a0ip\u00a0ospf\u00a01\u00a0event-history\u00a0rib</code> <code>show\u00a0ip\u00a0ospf\u00a01\u00a0event-history\u00a0redistribution</code></p>"},{"location":"cisco/Cisco_OSPF/#ios-xr","title":"IOS-XR","text":"<p>En skillnad emot IOS \u00e4r att External LSA:er installeras i RIB \u00e4ven fast forwarding address inte \u00e4r l\u00e4rd av ospf.</p> <p>H\u00e4r f\u00f6ljer IOS-XR-specifik syntax.</p> <p><code>router\u00a0ospf\u00a01</code> <code>log\u00a0adjacency\u00a0changes\u00a0detail</code> <code>router-id\u00a0100.0.0.10</code> <code>bfd\u00a0minimum-interval\u00a0100</code> <code>bfd\u00a0fast-detect</code> <code>bfd\u00a0multiplier\u00a03</code> <code>mpls\u00a0ldp\u00a0sync</code> <code>mpls\u00a0ldp\u00a0auto-config</code> <code>max-lsa\u00a012000</code> <code>security\u00a0ttl</code> <code>auto-cost\u00a0reference-bandwidth\u00a01000000</code> <code>max-metric\u00a0router-lsa\u00a0on-startup\u00a030</code> <code>max-metric\u00a0router-lsa\u00a0on-proc-restart\u00a010</code> <code>area\u00a00</code> <code>authentication\u00a0message-digest</code> <code>message-digest-key\u00a01\u00a0md5\u00a0encrypted\u00a012411A1A0D13271D030A791111</code> <code>fast-reroute\u00a0per-prefix\u00a0remote-lfa\u00a0tunnel\u00a0mpls-ldp</code> <code>!</code> <code>interface\u00a0Loopback0</code> <code>passive\u00a0enable</code> <code>!</code> <code>interface\u00a0HundredGigE0/0/0/0</code> <code>network\u00a0point-to-point</code> <code>flood-reduction\u00a0enable</code></p> <p>Verify</p> <p><code>show\u00a0run\u00a0router\u00a0ospf</code> <code>show\u00a0ospf</code> <code>show\u00a0ospf\u00a0neighbor</code> <code>show\u00a0ospf\u00a0interface\u00a0brief</code> <code>show\u00a0ospf\u00a0database</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_OSPFv3/","title":"Cisco OSPFv3","text":"<p>F\u00f6r huvudartikel, se Cisco OSPF. OSPF Version 3 (RFC 5340) togs fram f\u00f6r att st\u00f6dja IPv6. Man anv\u00e4nder termen link ist\u00e4llet f\u00f6r network. De flesta features som finns i v2 finns i v3 och fungerar i princip likadant men kan konfigureras lite annorlunda. F\u00f6r OSPF-kommunikation anv\u00e4nds alltid link-local adresser (med undantag virtual links). St\u00f6rsta anledningen till skillnaderna mellan OSPFv2 och v3 \u00e4r pga att IPv4 och IPv6 fungerar p\u00e5 lite olika s\u00e4tt. Fr\u00e5n och med IOS 15.1(3)S och 15.2(1)T har OSPFv3 st\u00f6d f\u00f6r adressfamiljer och man kan anv\u00e4nda det b\u00e5de f\u00f6r IPv4 och IPv6, dock \u00e4r control plane alltid IPv6 med v3. IOS-XR har inte st\u00f6d f\u00f6r OSPFv3 IPv4.</p>"},{"location":"cisco/Cisco_OSPFv3/#lsa-types","title":"LSA types","text":"<p>Det finns en ny typ av LSA, Link LSA som g\u00e4ller f\u00f6r link-local scope.</p>"},{"location":"cisco/Cisco_OSPFv3/#network-types","title":"Network Types","text":"<p>NBMA</p>"},{"location":"cisco/Cisco_OSPFv3/#konfiguration","title":"Konfiguration","text":"<p>Prereq</p> <p><code>ipv6\u00a0unicast-routing</code></p> <p>Process, det m\u00e5ste finnas en RID som \u00e4r 32-bitar och skrivs som en IPv4-adress. Den v\u00e4ljs p\u00e5 samma s\u00e4tt som i OSPFv2. Finns det ingen IPv4-adress konfigurerad s\u00e5 m\u00e5ste man konfigurera detta manuellt innan processen kan starta.</p> <p><code>ipv6\u00a0router\u00a0ospf\u00a01</code> <code>router-id\u00a01.1.1.1</code></p> <p>Interface, det finns inget network-kommando utan man sl\u00e5r p\u00e5 det per interface. Finns det flera adresser p\u00e5 ett interface kommer alla att annonseras av OSPFv3. IPv6-granne konfigureras under interface och inte processen.</p> <p><code>interface\u00a0gi2</code> <code>ipv6\u00a0ospf\u00a01\u00a0area\u00a00</code> <code>ipv6\u00a0ospf\u00a0neighbor\u00a02000:1::2</code> <code>ipv6\u00a0ospf\u00a0priority\u00a01</code> <code>ipv6\u00a0ospf\u00a0hello-interval\u00a010</code> <code>ipv6\u00a0ospf\u00a0dead-interval\u00a040</code></p> <p>Verify</p> <p><code>show\u00a0ipv6\u00a0ospf\u00a0neighbor</code> <code>show\u00a0ipv6\u00a0ospf\u00a0database</code></p> <p>Instance, OSPFv3 har st\u00f6d f\u00f6r multipla instanser per l\u00e4nk. Endast routrar med samma instance-nummer bildar grannskap.</p> <p><code>interface\u00a0gi2</code> <code>ipv6\u00a0ospf\u00a01\u00a0area\u00a02\u00a0instance\u00a03</code></p>"},{"location":"cisco/Cisco_OSPFv3/#authentication","title":"Authentication","text":"<p>Den f\u00f6rsta varianten av OSPFv3 (IPv6 only) anv\u00e4nder IPv6\u2019s inbyggda IPsec-autentisering s\u00e5 det finns ingen egen. Eftersom OSPFv3 inte anv\u00e4nder ISAKMP f\u00f6r nyckelutbyte i fas 1 m\u00e5ste fas 2 autentisering och kryptering konfigureras manuellt.</p> <p><code>interface\u00a0gi2</code> <code>ipv6\u00a0ospf\u00a0encryption\u00a0ipsec\u00a0spi\u00a02001\u00a0esp\u00a0aes-cbc\u00a0256\u00a04F814B37EA44ED42549955036FC0A68830A45FAC16424B093511EB4ACF20962D\u00a0sha1\u00a08A4481AF1A1444A92BB405F3A7FA392DF7222E5F</code></p> <p><code>ipv6\u00a0ospf\u00a0authentication\u00a0?</code> <code>ipsec</code> <code>null</code></p>"},{"location":"cisco/Cisco_OSPFv3/#prefix-suppression","title":"Prefix Suppression","text":"<p>Fungerar som med OSPFv2.</p> <p><code>interface\u00a0gi2</code> <code>ipv6\u00a0ospf\u00a0prefix-suppression</code></p>"},{"location":"cisco/Cisco_OSPFv3/#summarization","title":"Summarization","text":"<p>Fungerar som med OSPFv2.</p> <p><code>ipv6\u00a0router\u00a0ospf\u00a01</code> <code>area\u00a00\u00a0range\u00a02000:1::/60</code></p>"},{"location":"cisco/Cisco_OSPFv3/#redistribution","title":"Redistribution","text":"<p>Default metric: 1 f\u00f6r BGP, 20 f\u00f6r \u00f6vrigt</p> <p><code>ipv6\u00a0router\u00a0ospf\u00a01</code> <code>redistribute\u00a0connected\u00a0metric\u00a010</code> <code>redistribute\u00a0rip\u00a0RIPNG\u00a0tag\u00a0123</code> <code>redistribute\u00a0eigrp\u00a0100\u00a0route-map\u00a0FILTER</code></p>"},{"location":"cisco/Cisco_OSPFv3/#virtual-links","title":"Virtual Links","text":"<p>Virtual link kan byggas \u00f6ver IPv4 precis som med OSPFv2.</p> <p><code>ipv6\u00a0router\u00a0ospf\u00a01</code> <code>area\u00a01\u00a0virtual-link\u00a010.0.0.20</code></p> <p>Verify</p> <p><code>show\u00a0ipv6\u00a0ospf\u00a0virtual-links</code></p>"},{"location":"cisco/Cisco_OSPFv3/#multi-af-mode","title":"Multi AF Mode","text":"<p>Denna konfigurationen \u00e4r mer homogen med BGP AFI-format och EIGRP Named mode.</p> <p><code>router\u00a0ospfv3\u00a01</code> <code>router-id\u00a01.1.1.1</code></p> <p><code>address-family\u00a0ipv4\u00a0unicast</code> <code>maximum-paths\u00a04</code> <code>redistribute\u00a0connected</code> <code>exit-address-family</code></p> <p><code>address-family\u00a0ipv6\u00a0unicast</code> <code>maximum-paths\u00a016</code> <code>area\u00a00\u00a0range\u00a02001:100:1::/48</code> <code>exit-address-family</code></p> <p><code>interface\u00a0gi2</code> <code>ospfv3\u00a01\u00a0ipv4\u00a0area\u00a00</code> <code>ospfv3\u00a01\u00a0ipv6\u00a0area\u00a00</code></p> <p>Verify</p> <p><code>show\u00a0ospfv3</code> <code>show\u00a0ospfv3\u00a0neighbor</code> <code>show\u00a0ospfv3\u00a0interface\u00a0brief</code></p> <p>Man m\u00e5ste k\u00f6ra IPv6 ocks\u00e5 eftersom det anv\u00e4nds f\u00f6r control plane.</p> <p><code>ospfv3\u00a01\u00a0ipv4\u00a0area\u00a00</code> <code>%\u00a0OSPFv3:\u00a0IPV6\u00a0is\u00a0not\u00a0enabled\u00a0on\u00a0this\u00a0interface</code></p>"},{"location":"cisco/Cisco_OSPFv3/#authentication_1","title":"Authentication","text":"<p>Med OSPFv3 kan man anv\u00e4nda ESP header eller Authentication Header och det konfigureras antingen per-link eller globalt under arean.</p> <p><code>router\u00a0ospfv3\u00a01</code> <code>area\u00a010\u00a0authentication\u00a0ipsec\u00a0spi\u00a0500\u00a0sha1\u00a08a4481af1a1444a92bb405f3a7fa392df7222e5f</code></p> <p><code>interface\u00a0gi2</code> <code>ospfv3\u00a0encryption\u00a0ipsec\u00a0spi\u00a0700\u00a0esp\u00a0aes-cbc\u00a0256\u00a04F814B37EA44ED42549955036FC0A68830A45FAC16424B093511EB4ACF20962D\u00a0sha1\u00a08A4481AF1A1444A92BB405F3A7FA392DF7222E5F</code></p> <p>Innan OSPFv3 Authentication Trailer var IPsec det enda s\u00e4ttet att autentisera OSPF-paketen.</p> <p><code>key\u00a0chain\u00a0OSPFv3</code> <code>key\u00a01</code> <code>key-string\u00a0SECRET</code> <code>cryptographic-algorithm\u00a0hmac-sha-512</code></p> <p><code>interface\u00a0gi2</code> <code>ospfv3\u00a0authentication\u00a0?</code> <code>ipsec</code> <code></code><code>key-chain</code> <code>null</code></p> <p>Verify</p> <p><code>show\u00a0ospfv3\u00a0interface\u00a0|\u00a0i\u00a0Ethernet|authentication|encryption</code> <code>show\u00a0crypto\u00a0ipsec\u00a0policy</code></p>"},{"location":"cisco/Cisco_OSPFv3/#ttl-security","title":"TTL Security","text":"<p>OSPFv3 TTL security kan endast konfigureras f\u00f6r virtual links och sham links i Multi AF Mode. TTL Security g\u00f6r ingen nytta i \u00f6vrigt eftersom OSPFv3 control plane g\u00f6rs med link-local-adresser.</p>"},{"location":"cisco/Cisco_OSPFv3/#bfd","title":"BFD","text":"<p>BFD-support f\u00f6r OSPFv3 kan konfigureras p\u00e5 tv\u00e5 s\u00e4tt, under processen eller interface. Se \u00e4ven Cisco BFD.</p> <p><code>address-family\u00a0ipv4\u00a0unicast</code> <code>bfd\u00a0all-interfaces</code></p> <p><code>interface\u00a0gi2</code> <code>ospfv3\u00a0bfd</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_OTV/","title":"Cisco OTV","text":"<p>Overlay Transport Virtualization \u00e4r en tunnlingsteknik f\u00f6r att str\u00e4cka L2-dom\u00e4ner \u00f6ver ett L3-n\u00e4t med hj\u00e4lp av enkapsulering. Det \u00e4r routing baserat p\u00e5 mac-adress och f\u00f6r control plane anv\u00e4nds IP-enkapsulerad IS-IS. OTV l\u00e4r sig MAC-IP par genom MAC address learning p\u00e5 internal interface, IGMP snooping och OTV control plane (IS-IS) updates. Alla MAC-adresser sparas i OTV Routing Information Base (ORIB) med VLAN ID och associerad remote IP.</p> <p>Det finns inbyggd felisolering tack vare att broadcast och unknown unicast droppas vid edge ist\u00e4llet f\u00f6r att floodas \u00f6ver tunneln. ARP optimeras ocks\u00e5 genom att Edge Devices kan svara p\u00e5 ARP-fr\u00e5gor f\u00f6r enheter som finns p\u00e5 andra sidan, detta genom att lyssna p\u00e5 ARP-trafik p\u00e5 den lokala siten och cachea den. OTV g\u00e5r \u00e4ven att kombinera med en krypterad transport, t.ex. GET VPN. IPsec kan d\u00e5 terminera i samma box som OTV och det funkar b\u00e5de ihop med OTV unicast och multicast mode.</p>"},{"location":"cisco/Cisco_OTV/#termer","title":"Termer","text":"<p>Edge Device: Gr\u00e4nsenhet mellan lanet och utsidan, d\u00e4r OTV-enkapsulering g\u00f6rs.</p> <p>Authoritative Edge Device: Enhet som \u00e4r aktiv p\u00e5 siten. Endast en i taget, vlan lastdelas.</p> <p>Join Interface: L3-interface som ska kunna n\u00e5 andra OTV-siters join interface.</p> <p>Internal Interface: L2-interface som n\u00e5r de VLAN som ska str\u00e4ckas.</p> <p>Overlay Network: Det logiska n\u00e4tverk d\u00e4r L2-trafiken g\u00e5r \u00f6ver Transport Network. Inga BPDUer g\u00e5r \u00f6ver detta n\u00e4t.</p> <p>Transport Network: Det n\u00e4tverk som kopplar ihop de olika siterna, kan vara WAN/internet eller en blandning. Ska finnas rum f\u00f6r 42 extra bytes MTU.</p>"},{"location":"cisco/Cisco_OTV/#neighbors","title":"Neighbors","text":"<p>Innan trafik kan forwarderas m\u00e5ste det uppr\u00e4ttas grannskap. F\u00f6r detta kr\u00e4vs Source Specific multicast-st\u00f6d av n\u00e4tverket emellan (om transportn\u00e4tverket inte st\u00f6djer multicast s\u00e5 kan en unicast-funktion i OTV som heter Adjacency Server anv\u00e4ndas). Edge devices skickar IGMP membership report och sedan OTV-enkapsulerade hello packets. Alla edge devices ska bilda adjacency. Neighbors delar MAC-adress reachability med varandra genom att skicka uppdateringar med multicast.</p>"},{"location":"cisco/Cisco_OTV/#fast-convergence","title":"Fast Convergence","text":"<ul> <li>VLAN AED synchronization</li> <li>Site ID and proactive advertisments</li> <li>Prepopulation</li> <li>BFD and route tracking</li> <li>Graceful insertion</li> <li>Graceful shutdown</li> <li>Prioritized processing of LSPs</li> </ul> <p>Om man anv\u00e4nder multihoming, dvs flera edge devices per site \u00e4r det starkt rekommenderat att sl\u00e5 p\u00e5 spanning-tree p\u00e5 OTV-routrarna. Genom att g\u00f6ra det kan de skicka ut topology change notification (TCN) n\u00e4r de m\u00e4rker att AED failar och rollen ska flyttas. Detta f\u00e5r switcharna att reducera sin aging timer till 15 sekunder vilket skyndar p\u00e5 konvergensen.</p> <p>OTV-noder sparar remote unicast MAC addresses i sin ORIB \u00e4ven f\u00f6r non-AED vlan, detta f\u00f6r att snabba upp konvergens vid AED failover.</p>"},{"location":"cisco/Cisco_OTV/#konfiguration","title":"Konfiguration","text":"<p>Notera att \"OTV cannot be configured when MPLS features are enabled on the router\".</p> <p>site bridge-domain \u00e4r samma sak som site-vlan.</p> <p><code>otv\u00a0site\u00a0bridge-domain\u00a0100</code> <code>otv\u00a0site-identifier\u00a00000.0000.0101</code></p> <p><code>otv\u00a0isis\u00a0Overlay1</code> <code>log-adjacency-changes</code></p> <p>Overlay-interface</p> <p><code>interface\u00a0Overlay1</code> <code>no\u00a0ip\u00a0address</code> <code>otv\u00a0join-interface\u00a0GigabitEthernet3</code> <code>otv\u00a0use-adjacency-server\u00a010.0.0.10\u00a0unicast-only</code></p> <p><code>service\u00a0instance\u00a0200\u00a0ethernet</code> <code>description\u00a0Test-vlan</code> <code>encapsulation\u00a0dot1q\u00a0200</code> <code>bridge-domain\u00a0200</code></p> <p>Verify</p> <p><code>show\u00a0otv\u00a0site</code> <code>show\u00a0otv\u00a0adjacency</code> <code>show\u00a0otv\u00a0overlay\u00a01</code></p> <p>Internal interface</p> <p><code>interface\u00a0GigabitEthernet4</code> <code>description\u00a0Internal-interface</code> <code>no\u00a0ip\u00a0address</code> <code>negotiation\u00a0auto</code> <code>service\u00a0instance\u00a0100\u00a0ethernet</code> <code>encapsulation\u00a0dot1q\u00a0100</code> <code>bridge-domain\u00a0100</code></p> <p><code>service\u00a0instance\u00a0200\u00a0ethernet</code> <code>description\u00a0Test-vlan</code> <code>encapsulation\u00a0dot1q\u00a02</code> <code>rewrite\u00a0ingress\u00a0tag\u00a0translate\u00a01-to-1\u00a0dot1q\u00a0200\u00a0symmetric\u00a0\u00a0#VLAN\u00a0translation\u00a02\u00a0&lt;-&gt;\u00a0200</code> <code>bridge-domain\u00a0200</code></p> <p>Det g\u00e5r \u00e4ven att ta in det otaggat.</p> <p><code>interface\u00a0GigabitEthernet2</code> <code>service\u00a0instance\u00a0201\u00a0ethernet</code> <code>encapsulation\u00a0untagged</code> <code>bridge-domain\u00a0201</code></p> <p>Verify</p> <p><code>show\u00a0otv\u00a0route</code> <code>show\u00a0otv\u00a0vlan</code> <code>show\u00a0otv\u00a0arp-nd-cache</code></p> <p>AED h\u00e5ller \u00e4ven koll p\u00e5 multicast senders p\u00e5 den lokala siten. Show OTV multicast routing table for overlays.</p> <p><code>show\u00a0otv\u00a0mroute</code></p> <p>Default skickas alla paketen \u00f6ver overlay med DF-biten satt. F\u00f6r att till\u00e5ta fragmentation of IP packets \u00f6ver overlays m\u00e5ste man sl\u00e5 p\u00e5 det. OBS alla edge devices i overlayen b\u00f6r supportera reassembly in hardware.</p> <p><code>otv\u00a0fragmentation\u00a0join-interface\u00a0port-channel\u00a01</code></p>"},{"location":"cisco/Cisco_OTV/#enkapsulering","title":"Enkapsulering","text":"<p>I nya versioner av h\u00e5rdvara/mjukvara kan man v\u00e4lja vilken enkapsulering man ska anv\u00e4nda, default anv\u00e4nds GRE/MPLS men nu kan man \u00e4ven anv\u00e4nda UDP/VXLAN. V\u00e4ljer man den VXLAN blir det overhead 50 Bytes per paket.</p> <p><code>otv\u00a0encapsulation-format\u00a0ip\u00a0gre\u00a0|\u00a0udp</code></p>"},{"location":"cisco/Cisco_OTV/#fhrp","title":"FHRP","text":"<p>Om man har en design d\u00e4r b\u00e5da sidor har FHRP active router m\u00e5ste FHRP-paket filtreras s\u00e5 de ej korsar OTVn.</p> <p><code>interface\u00a0Overlay1</code> <code>otv\u00a0filter-fhrp</code></p> <p>Native-st\u00f6d \u00e4ven f\u00f6r NX-OS \u00e4r planerat, l\u00f6sning s\u00e5l\u00e4nge \u00e4r att man anv\u00e4nder VLAN-ACL i kombination med OTV MAC route filter och arp-inspection filter (feature dhcp).</p>"},{"location":"cisco/Cisco_OTV/#nexus","title":"Nexus","text":"<p>OTV \u00e4r kompatibelt med ett IPv4 transport network.</p> <p><code>feature\u00a0otv</code></p> <p>VLAN</p> <p><code>vlan\u00a01000</code> <code>name\u00a0OTV-SITE-VLAN</code> <code>vlan\u00a02000</code> <code>name\u00a0OTV-TEST1</code> <code>vlan\u00a02001</code> <code>name\u00a0OTV-TEST2</code> <code>exit</code></p> <p><code>no\u00a0ip\u00a0dhcp\u00a0relay</code> <code>no\u00a0ipv6\u00a0dhcp\u00a0relay</code></p> <p>Join interface Alla core och core facing L3 interface ska ha st\u00f6d f\u00f6r jumbo frames eftersom OTV s\u00e4tter DF-biten i IP-headern p\u00e5 alla control och data plane packets. Vill man ha b\u00e4ttre load-balancing i sitt core (depolarization) kan man konfa flera IP-adresser (secondary) p\u00e5 sina join-interface, d\u00e5 kommer OTV att hasha och kunna anv\u00e4nda alla IP-adresser som source p\u00e5 OTV-enkapsulerade paket. Transportn\u00e4tverket m\u00e5ste supportera ASM eller PIM-Bidir men sl\u00e5 ej p\u00e5 PIM p\u00e5 join interfacet. Exempel, f\u00f6r SSM.</p> <p><code>interface\u00a0po1</code> <code>no\u00a0ip\u00a0redirects</code> <code>ip\u00a0igmp\u00a0version\u00a03</code> <code>no\u00a0shut</code></p> <p>Site VLAN</p> <p><code>otv\u00a0site-vlan\u00a01000</code> <code>otv\u00a0site-identifier\u00a00x2</code></p> <p><code>otv-isis\u00a0default</code> <code>vpn\u00a0Overlay1</code></p> <p><code>interface\u00a0vlan1000</code> <code>no\u00a0ip\u00a0redi</code> <code>no\u00a0ipv6\u00a0redi</code> <code>ip\u00a0add\u00a010.1.1.1/30</code> <code>no\u00a0shut</code></p> <p>Overlay The site VLAN must not be extended into the OTV.</p> <p><code>int\u00a0Overlay1</code> <code>otv\u00a0join-interface\u00a0po1</code> <code>otv\u00a0control-group\u00a0239.4.4.1</code> <code>otv\u00a0data-group\u00a0232.8.8.0/26</code> <code>otv\u00a0extended-vlan\u00a02000</code> <code>otv\u00a0extended-vlan\u00a0add\u00a02001</code> <code>no\u00a0shut</code></p> <p>BFD Man kan k\u00f6ra BFD \u00f6ver site-vlan:et f\u00f6r att snabbt uppt\u00e4cka forwarderingsproblem inom siten.</p> <p><code>interface\u00a0vlan1000</code> <code>no\u00a0ip\u00a0redirects</code> <code>ip\u00a0address\u00a010.1.1.1/30</code></p> <p><code>otv\u00a0site-vlan\u00a01000</code> <code>otv\u00a0isis\u00a0bfd</code></p> <p><code>otv-isis\u00a0default</code> <code>track-adjacency-nexthop</code></p> <p>Verify</p> <p><code>show\u00a0otv\u00a0isis\u00a0track-adjacency-nexthop</code> <code>show\u00a0bfd\u00a0neighbors</code></p> <p>Static flood Undantag f\u00f6r unknown unicast (t.ex. silent hosts). Broadcast g\u00e5r ej.</p> <p><code>otv\u00a0flood\u00a0mac\u00a00011.2233.4455\u00a0vlan\u00a0160</code></p> <p><code>otv\u00a0flood\u00a0mac\u00a0FF:FF:FF:FF:FF:FF\u00a0vlan\u00a0160</code> <code>The`` ``flood`` ``mac`` ``can`` ``not`` ``be`` ``a`` ``broadcast`` ``mac.</code></p> <p>VLAN Mapping Man kan skriva om VLAN ID:n p\u00e5 frames som g\u00f6r \u00f6ver tunneln. Detta \u00e4r inte supporterat p\u00e5 Cisco M3- och F3-moduler men man kan d\u00e5 anv\u00e4nda per-port vlan-\u00f6vers\u00e4ttning (switchport vlan mapping).</p> <p><code>interface\u00a0overlay\u00a05</code> <code>otv\u00a0vlan\u00a0mapping\u00a010,14-16\u00a0to\u00a020-21,25,28</code> <code>otv\u00a0extended-vlan\u00a010,14-16</code></p> <p>Show</p> <p><code>show\u00a0otv\u00a0vlan-mapping</code></p>"},{"location":"cisco/Cisco_OTV/#loopback-join-interface","title":"Loopback Join Interface","text":"<p>Med NX-OS 8 kan man anv\u00e4nda ett loopback som join interface, detta g\u00f6r att man kan ha multipla routade uppl\u00e4nkar till sitt multicast core. Uppl\u00e4nkar och loopback ska k\u00f6ra PIM f\u00f6r att detta ska funka. Unicast (Adjacency Server) st\u00f6ds inte med denna typ av join interface.</p> <p><code>feature\u00a0pim</code></p> <p><code>interface\u00a0loopback1</code> <code>ip\u00a0address\u00a010.10.10.2/32</code> <code>ip\u00a0router\u00a0ospf\u00a0100\u00a0area\u00a00.0.0.0</code> <code>ip\u00a0pim\u00a0sparse-mode</code></p> <p><code>interface\u00a0Overlay1</code> <code>otv\u00a0join-interface\u00a0loopback1</code></p>"},{"location":"cisco/Cisco_OTV/#pvlan","title":"PVLAN","text":"<p>I nyare releaser av NX-OS kan man str\u00e4cka Private VLAN \u00f6ver OTV och d\u00e4rmed beh\u00e5lla segmenteringen.</p> <p><code>feature\u00a0pvlan</code></p> <p><code>vlan\u00a0100</code> <code>private-vlan\u00a0primary</code> <code>private-vlan\u00a0association\u00a0101-103</code> <code>vlan\u00a0101</code> <code>private-vlan\u00a0community</code> <code>vlan\u00a0102</code> <code>private-vlan\u00a0community</code> <code>vlan\u00a0103</code> <code>private-vlan\u00a0isolated</code></p> <p><code>interface\u00a0overlay\u00a01</code> <code>otv\u00a0extend-vlan\u00a0100</code></p> <p>Show</p> <p><code>show\u00a0otv\u00a0vlan\u00a0private-vlan</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_PCE/","title":"Cisco PCE","text":"<p>Tanken med Path Computation Element \u00e4r att en enskild entitet har visibilitet \u00f6ver och h\u00e5ller koll p\u00e5 LSPer i en hel dom\u00e4n oavsett antal areor och IGPer. Detta g\u00f6r att man kan f\u00e5 fungerande TE b\u00e5de inter-area och inter-AS. PCE best\u00e5r av Traffic Engineering Database (TED) och Path Computation Client (PCC).</p> <p>SR-PCE \u00e4r en IOS-XR multi-domain stateful SR Path Computation Element (PCE) som kan k\u00f6ras b\u00e5de virtuellt och fysiskt (kallas d\u00e5 XR Transport Controller). XTC kan prata ISIS, OSPF och BGP-LS f\u00f6r att f\u00e5 topologi-information ifr\u00e5n flera dom\u00e4ner. SR-PCE \u00e4r SR-optimerat och kan updatera SRTE-policys allt eftersom. Man deployar det likt RR. Se \u00e4ven Segment Routing.</p>"},{"location":"cisco/Cisco_PCE/#konfiguration","title":"Konfiguration","text":"<p>BGP-LS p\u00e5 P/PE</p> <p><code>router\u00a0isis\u00a01</code> <code>distribute\u00a0link-state</code> <code>address-family\u00a0ipv4\u00a0unicast</code></p> <p><code>router\u00a0bgp\u00a0100</code> <code>neighbor\u00a011.11.11.11</code> <code>remote-as\u00a0100</code> <code>update-source\u00a0Loopback0</code> <code>address-family\u00a0link-state\u00a0link-state</code></p> <p><code>show\u00a0bgp\u00a0link-state\u00a0link-state\u00a0summary</code></p> <p>XTC</p> <p><code>pce</code> <code>address\u00a0ipv4\u00a011.11.11.11\u00a0\u00a0\u00a0#own\u00a0loopback</code></p> <p><code>show\u00a0pce\u00a0ipv4\u00a0peer</code></p> <p>PCC p\u00e5 P/PE</p> <p><code>segment-routing</code> <code>traffic-eng</code> <code>maximum-sid-depth\u00a05</code> <code>pcc</code> <code>source-address\u00a0ipv4\u00a01.1.1.1\u00a0\u00a0\u00a0#own\u00a0loopback</code> <code>pce\u00a0address\u00a0ipv4\u00a011.11.11.11\u00a0\u00a0#XTC</code> <code>!</code> <code>report-all</code></p> <p><code>show\u00a0segment-routing\u00a0traffic-eng\u00a0pcc\u00a0ipv4\u00a0peer\u00a0brief</code></p> <p>F\u00f6rutom vanlig IGP link metric information kan PCE \u00e4ven l\u00e4ra sig prefix SID och adjacency SID f\u00f6r alla l\u00e4nkar. Detta g\u00f6r att PCE kan g\u00f6ra path computation baserat p\u00e5 IOS-XR's CSPF-algoritmer.</p> <p><code>show\u00a0pce\u00a0ipv4\u00a0topology\u00a0summary</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_PE-CE/","title":"Cisco PE-CE","text":"<p>PE routers redistribuerar routes till BGP och konverterar dem till VPNv4 NLRI. Denna NLRI annonseras till andra PE med hj\u00e4lp av MP-BGP. Dessa PE konverterar tillbaka VPNv4 routes och skickar det vidare till CE. Se \u00e4ven Cisco BGP, Cisco Routing och Cisco MPLS.</p>"},{"location":"cisco/Cisco_PE-CE/#rip","title":"RIP","text":"<p>RIP \u00e4r det simplaste protokollet och om man anv\u00e4nder transparent s\u00e5 kommer RIPs metric att tas ifr\u00e5n BGP MED attribute som \u00e4r en kopia av RIP metricen fr\u00e5n andra sidan. Detta g\u00f6r att man kan f\u00e5 till bra path selection \u00e4ven om det finns backdoor links. RIPv1 st\u00f6ds inte. Se \u00e4ven Cisco RIP.</p> <p><code>router\u00a0rip</code> <code>version\u00a02</code> <code>address-family\u00a0ipv4\u00a0vrf\u00a0Cust_A</code> <code>redistribute\u00a0bgp\u00a0100\u00a0metric\u00a0transparent</code> <code>network\u00a0192.168.1.0</code></p> <p><code>router\u00a0bgp\u00a0100</code> <code>address-family\u00a0ipv4\u00a0vrf\u00a0Cust_A</code> <code>redistribute\u00a0rip</code> <code>exit-address-family</code></p>"},{"location":"cisco/Cisco_PE-CE/#ospf","title":"OSPF","text":"<p>OSPF f\u00f6r PE-CE (RFC 4577), se \u00e4ven Cisco OSPF. MPLS-n\u00e4tet skickar OSPF VRF routing information i MP-BGP-uppdateringar och det kommer att agera som en OSPF super-backbone vilket g\u00f6r att man faktiskt inte beh\u00f6ver k\u00f6ra med area 0 n\u00e5gonstans men man kan s\u00e5klart g\u00f6ra det. Man kan t.o.m. ha area 0 p\u00e5 flera siter. N\u00e4r routes g\u00e5r fr\u00e5n MP-BGP till OSPF ska down biten s\u00e4ttas, detta f\u00f6r att f\u00f6rhindra loopar. N\u00e4r routes redistribueras fr\u00e5n OSPF till MP-BGP ska domain-id vara konfat. Om OSPF domain-id \u00e4r samma p\u00e5 b\u00e5da sidor kommer routes att exporteras som type-3 inter-area LSA och om de inte \u00e4r samma kommer routes att exporteras som type-5 external LSA. Om man inte specifikt anger n\u00e5got Domain ID p\u00e5 IOS s\u00e5 kommer process ID att anv\u00e4ndas. P\u00e5 IOS-XR s\u00e4tts NULL ifall man inte har konfigurerat n\u00e5got.</p> <p><code>interface\u00a0gi0/0</code> <code>description\u00a0Link\u00a0to\u00a0CE</code> <code>vrf\u00a0forwarding\u00a0Cust_A</code> <code>ip\u00a0ospf\u00a02\u00a0area\u00a00</code></p> <p><code>router\u00a0ospf\u00a02\u00a0vrf\u00a0Cust_A</code> <code>router-id\u00a010.0.0.10</code> <code></code><code>domain-id`` ``1.1.1.1</code> <code>redistribute\u00a0bgp\u00a0100\u00a0subnets</code></p> <p><code>router\u00a0bgp\u00a0100</code> <code>address-family\u00a0ipv4\u00a0vrf\u00a0Cust_A</code> <code>redistribute\u00a0ospf\u00a02\u00a0vrf\u00a0Cust_A</code> <code>exit-address-family</code></p> <p>OSPF har inbyggd loop prevention genom att tagga alla routes som har redistribuerats fr\u00e5n MPLS-n\u00e4tet till OSPF med en down bit i LSA:n. Om detta kommer till en VRF-aware OSPF-process (t.ex. p\u00e5 en annan PE) kommer det att droppas. S\u00e5 detta beh\u00f6vs p\u00e5 en CE som k\u00f6r VRF Lite annars kommer LSA:er som kommer ifr\u00e5n MPLS Superbackbone att ignoreras. I nyare IOS s\u00e4tts down bit p\u00e5 b\u00e5de typ 3 och typ 5 LSA, f\u00f6rr var det endast typ 3. Det finns \u00e4ven en domain tag som skickas med prefixen, default \u00e4r det 208.0.0.0 + ASN fast i decimal format. Syftet med domain tag \u00e4r loop prevention, det \u00e4r fallback f\u00f6r DN bit som man kan beh\u00f6va att kringg\u00e5 om man k\u00f6r vrf-lite.</p> <p><code>router\u00a0ospf\u00a01\u00a0vrf\u00a0Cust_A</code> <code>capability\u00a0vrf-lite</code></p>"},{"location":"cisco/Cisco_PE-CE/#sham-link","title":"Sham-Link","text":"<p>Om kund har en bakv\u00e4g mellan sina siter av t.ex. redundanssk\u00e4l kommer OSPF att f\u00f6redra den framf\u00f6r MPLS-n\u00e4tet eftersom routes som g\u00e5tt \u00f6ver L3-VPN:n skickas med BGP och d\u00e5 blir inter-area eller externa f\u00f6r OSPF. Intra-area routes \u00e4r preferred \u00f6ver inter-area och external routes oavsett metric. OSPF sham link tillhandah\u00e5ller en logisk l\u00e4nk mellan tv\u00e5 VRFer p\u00e5 PE. Det \u00e4r en tunnel som ser ut som en point-to-point l\u00e4nk f\u00f6r OSPF. Med hj\u00e4lp av detta kan man lura OSPF att tro att den b\u00e4sta v\u00e4gen \u00e4r \u00f6ver MPLS-n\u00e4tet. Detta \u00e4r endast control plane dvs f\u00f6r SPF calculations och best-path selection medans forwarding g\u00f6rs som vanligt med information fr\u00e5n MP-BGP. Sham-links har source p\u00e5 interface som finns i kundens VRF, t.ex. Loopbacks uppsatta f\u00f6r detta \u00e4ndam\u00e5l. Deras IP-adresser b\u00f6r annonseras p\u00e5 n\u00e5got annat s\u00e4tt \u00e4n OSPF (typ BGP).</p> <p>PE1</p> <p><code>interface\u00a0Loopback\u00a020</code> <code>ip\u00a0vrf\u00a0forwarding\u00a0Cust_A</code> <code>ip\u00a0address\u00a03.3.3.3\u00a0255.255.255.255</code></p> <p><code>router\u00a0ospf\u00a02\u00a0vrf\u00a0Cust_A</code> <code>area\u00a00\u00a0sham-link\u00a03.3.3.3\u00a01.1.1.1\u00a0cost\u00a010</code></p> <p>PE2</p> <p><code>interface\u00a0Loopback\u00a020</code> <code>ip\u00a0vrf\u00a0forwarding\u00a0Cust_A</code> <code>ip\u00a0address\u00a01.1.1.1\u00a0255.255.255.255</code></p> <p><code>router\u00a0ospf\u00a02\u00a0vrf\u00a0Cust_A</code> <code>area\u00a00\u00a0sham-link\u00a01.1.1.1\u00a03.3.3.3\u00a0cost\u00a010</code></p> <p>Verify</p> <p><code>show\u00a0ip\u00a0ospf\u00a0sham-links</code></p>"},{"location":"cisco/Cisco_PE-CE/#eigrp","title":"EIGRP","text":"<p>N\u00e4r man anv\u00e4nder EIGRP som PE-CE skickas metric values, route type, source AS#, remote Router ID med i BGP-uppdateringarna som extended communities. Detta g\u00f6r att n\u00e4r man k\u00f6r EIGRP \\&lt;-&gt; BGP (VPN) \\&lt;-&gt; EIGRP blir routsen internal, d\u00e4remot om routsen har kommit fr\u00e5n n\u00e5got annat \u00e4n EIGRP, dvs saknar dessa communities, blir de external ur EIGRPs perspektiv. EIGRP-prefix som redistribueras in i BGP kommer ocks\u00e5 att ha ett Cost value som anv\u00e4nds f\u00f6r path selection. Se \u00e4ven Cisco EIGRP.</p> <p><code>router\u00a0eigrp\u00a0100</code> <code>address-family\u00a0ipv4\u00a0vrf\u00a0Cust_A\u00a0autonomous-system\u00a0200</code> <code>redistribute\u00a0bgp\u00a0100\u00a0metric\u00a010000000\u00a00\u00a0255\u00a01\u00a01500</code> <code>no\u00a0auto-summary</code> <code>exit-address-family</code></p> <p><code>router\u00a0bgp\u00a0100</code> <code>address-family\u00a0ipv4\u00a0vrf\u00a0Cust_A</code> <code>redistribute\u00a0eigrp\u00a0200</code> <code>exit-address-family</code></p>"},{"location":"cisco/Cisco_PE-CE/#site-of-origin","title":"Site-of-Origin","text":"<p>SoO skickas som extended community (b\u00e5de i BGP och EIGRP) och anv\u00e4nds f\u00f6r loop prevention f\u00f6r VPN-kunder som \u00e4r multi-homed. Kommer det in routes med SoO satt till det man sj\u00e4lv har discardas dem. Samma resultat g\u00e5r ocks\u00e5 att uppn\u00e5 med route tagging men \u00e4r lite mer omst\u00e4ndigt att konfigurera. Beroende p\u00e5 designval s\u00e5 s\u00e4tter man samma SoO-v\u00e4rde p\u00e5 b\u00e5da PE downlinks.</p> <p><code>route-map\u00a0SoO\u00a0permit\u00a010</code> <code>set\u00a0extcommunity\u00a0soo\u00a0100:2</code></p> <p><code>interface\u00a0Gi2</code> <code>description\u00a0Link\u00a0to\u00a0CE</code> <code>vrf\u00a0forwarding\u00a0Cust_A</code> <code>ip\u00a0vrf\u00a0sitemap\u00a0SoO</code></p>"},{"location":"cisco/Cisco_PE-CE/#bgp","title":"BGP","text":"<p>Om man anv\u00e4nder BGP f\u00f6r PE-CE beh\u00f6vs ingen redistribution eftersom det \u00e4r samma routing-protokoll som MPLS-n\u00e4tet anv\u00e4nder samt att skalbarhet och kontroll (policy) \u00e4r bra. Det g\u00e5r \u00e4ven att k\u00f6ra iBGP som PE-CE, se RFC 6368.</p> <p>Cost Community Syftet med Cost Communities \u00e4r att f\u00f6rhindra suboptimal routing och routing loops. Det g\u00e5r att st\u00e4nga av.</p> <p><code>router\u00a0bgp\u00a0100</code> <code>bgp\u00a0bestpath\u00a0cost-community\u00a0ignore</code></p> <p>SoO Attribute Site-of-Origin anv\u00e4nds f\u00f6r loop prevention och konfigureras p\u00e5 PEs grannskap till CE. Uppdateringar med det konfigurerade SoO-v\u00e4rdet kommer varken skickas eller accepteras, dvs det \u00e4r filtrering b\u00e5de ingress och egress.</p> <p><code>router\u00a0bgp\u00a0100</code> <code>address-family\u00a0ipv4\u00a0vrf\u00a0Cust_A</code> <code>neighbor\u00a01.1.1.1\u00a0soo\u00a010:12</code></p> <p>Samma resultat g\u00e5r att uppn\u00e5 med en route-map som s\u00e4tter denna community men det kan bli omst\u00e4ndigt att konfigurera.</p>"},{"location":"cisco/Cisco_PE-CE/#is-is","title":"IS-IS","text":"<p>IS-IS \u00e4r inget vanligt PE-CE protokoll men det g\u00e5r at k\u00f6ra p\u00e5 IOS. ISIS har ingen loop prevention s\u00e5 man m\u00e5ste filtrera om man ska k\u00f6ra dual homed/redundant kopplat till mpls-n\u00e4tet.</p> <p><code>router\u00a0isis\u00a010</code> <code>vrf\u00a0CustA</code> <code>net\u00a049.0000.0000.0010.00</code> <code>redistribute\u00a0bgp\u00a0100\u00a0level-1-2</code></p>"},{"location":"cisco/Cisco_PE-CE/#route-leaking","title":"Route Leaking","text":"<p>Med hj\u00e4lp av route targets kan man bygga vilken logisk topologi man vill f\u00f6r sina L3 VPN:er.</p> <p><code>vrf\u00a0definition\u00a0Cust_A</code> <code>rd\u00a065000:1</code> <code>address-family\u00a0ipv4</code> <code>route-target\u00a0both\u00a065000:1</code> <code>route-target\u00a0import\u00a065000:999</code></p> <p><code>vrf\u00a0definition\u00a0Cust_B</code> <code>rd\u00a065000:2</code> <code>address-family\u00a0ipv4</code> <code>route-target\u00a0both\u00a065000:2</code> <code>route-target\u00a0import\u00a065000:999</code></p> <p><code>vrf\u00a0definition\u00a0Shared</code> <code>rd\u00a065000:999</code> <code>address-family\u00a0ipv4</code> <code>route-target\u00a0export\u00a065000:999</code> <code>route-target\u00a0import\u00a065000:1</code> <code>route-target\u00a0import\u00a065000:2</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_PIM/","title":"Cisco PIM","text":"<p>F\u00f6r att routrar ska kunna veta vilka andra routrar som har multicast-k\u00e4llor och mottagare anv\u00e4nds n\u00e5got protokoll (control plane), DVMRP, MOSPF eller PIM. De ber\u00e4ttar vilka n\u00e4t som \u00e4r med i olika multicastgrupper. F\u00f6r loop prevention anv\u00e4nds RPF och inga paket forwarderas utan att klara denna check. Det som skiljer Protocol Independent Multicast fr\u00e5n DVMRP och MOSPF \u00e4r att det inte \u00e4r n\u00e5got routingprotokoll utan ett signaleringsprotokoll, dvs det distribuerar ingen routinginformation. PIM anv\u00e4nder unicast RIB:en f\u00f6r RPF-checken medans de andra protokollen bygger sina egna tabeller och k\u00f6r RPF mot. Med IPv6 k\u00f6rs PIM default p\u00e5 alla interface n\u00e4r man sl\u00e5r ig\u00e5ng ipv6 multicast-routing.</p> <p>Se \u00e4ven Cisco Multicast. Man kan \u00e4ven anv\u00e4nda PIM \u00f6ver GRE-tunnlar.</p>"},{"location":"cisco/Cisco_PIM/#neighbor","title":"Neighbor","text":"<p>PIMv2 formar adjacencies och anv\u00e4nder 224.0.0.13 neighbor discovery (Hellos) och updates. PIMv2 Hellos skickas default var 30:e sekund p\u00e5 interface konfigurerade f\u00f6r PIM. Hello inneh\u00e5ller holdtime som brukar vara 3 ggr Hello time. Det \u00e4ldre PIMv1 anv\u00e4nde inte Hellos utan skickade Queries till 224.0.0.2.</p> <p>Paket</p> <ul> <li>PIM Hello</li> <li>PIM Join</li> <li>PIM Prune</li> <li>PIM Assert</li> <li>PIM Graft</li> <li>PIM Register</li> </ul>"},{"location":"cisco/Cisco_PIM/#konfiguration","title":"Konfiguration","text":"<p>Global enable. P\u00e5 vissa enheter \u00e4r kommandot ip multicast-routing distributed</p> <p><code>ip\u00a0multicast-routing</code> <code>show\u00a0ip\u00a0multicast</code></p> <p>Default konfiguration (detta kan skilja mellan IOS-version)</p> <p>Globalt</p> <p><code>ip\u00a0pim\u00a0dm-fallback</code> <code>ip\u00a0pim\u00a0autorp</code> <code>ip\u00a0pim\u00a0bidir-offer-interval\u00a0100\u00a0msec</code> <code>ip\u00a0pim\u00a0bidir-offer-limit\u00a03</code> <code>ip\u00a0pim\u00a0v1-rp-reachability</code> <code>ip\u00a0pim\u00a0log-neighbor-changes</code></p> <p>Per interface</p> <p><code>ip\u00a0pim\u00a0join-prune-interval\u00a060</code> <code>ip\u00a0pim\u00a0dr-priority\u00a01</code> <code>ip\u00a0pim\u00a0query-interval\u00a030</code></p> <p>G\u00e5 med i grupp manuellt</p> <p><code>ip\u00a0igmp\u00a0join-group\u00a0224.10.0.10</code></p> <p>Verify</p> <p><code>show\u00a0ip\u00a0mroute</code> <code>show\u00a0ip\u00a0mroute\u00a0active</code> <code>show\u00a0ip\u00a0mroute\u00a0count</code> <code>show\u00a0ip\u00a0pim\u00a0interface</code> <code>show\u00a0ip\u00a0pim\u00a0neighbor</code> <code>show\u00a0ip\u00a0rpf\u00a0x.x.x.x</code></p> <p>Limiting Global multicast mroute limit</p> <p><code>ip\u00a0multicast\u00a0limit\u00a0cost</code><code></code> <p>Maximum number of multicast routes, default \u00e4r 2147483647.</p> <p><code>ip\u00a0multicast\u00a0route-limit\u00a0100</code></p> <p>Multicast boundary feature till\u00e5ter att man begr\u00e4nsar multicast b\u00e5de control plane och data plane per interface. Med standard acl filtreras grupp och med extended b\u00e5de grupp och k\u00e4lla. Detta filtrerar ocks\u00e5 Auto-RP announcements. Att begr\u00e4nsa multicast kan \u00e4ven g\u00f6ras med TTL scoping.</p> <p><code>ip\u00a0multicast\u00a0boundary\u00a0[ACL]</code></p> <p>NBMA Det finns inbyggd loop prevention f\u00f6r multicast i form av split horizon. I vissa topologier (t.ex. DMVPN) m\u00e5ste multicast-paket skickas ut p\u00e5 samma interface som det kom in p\u00e5 f\u00f6r att det ska fungera och det g\u00e5r att konfigurera per interface. PIM NBMA mode g\u00f6r att PIM h\u00e5ller reda p\u00e5 OIL som interface + NBMA-adress, ist\u00e4llet f\u00f6r bara interface. Detta \u00e4r inte kompatibelt med PIM-DM.</p> <p><code>ip\u00a0pim\u00a0nbma-mode</code></p> <p>Multipath Att sl\u00e5 p\u00e5 ECMP Multicast Load Splitting g\u00f6r att Joins till RP kommer att skickas p\u00e5 fler \u00e4n ett interface och man m\u00e5ste anv\u00e4nda en hash annars kommer RPF-check att faila.</p> <p><code>ip\u00a0multicast\u00a0multipath</code> <code>ip\u00a0multicast\u00a0multipath\u00a0s-g-hash</code></p>"},{"location":"cisco/Cisco_PIM/#dense-mode","title":"Dense Mode","text":"<p>Dense mode utg\u00e5r ifr\u00e5n att alla subn\u00e4t har n\u00e5gon som vill ta emot multicast-trafik d\u00e4rf\u00f6r kommer paketen att forwarderas ut p\u00e5 alla interface som \u00e4r konfigurerade f\u00f6r multicast utom det som det kom in p\u00e5. Alla routrar g\u00f6r samma sak och alla subn\u00e4t f\u00e5r str\u00f6mmen, detta tr\u00e4d kallas source-based distribution tree eller shortest-path tree. Det finns dock m\u00f6jlighet f\u00f6r routrar att beg\u00e4ra att inte f\u00e5 paket f\u00f6r vissa multicast-grupper om man inte har n\u00e5gon router downstream som \u00e4r aktiv i gruppen samt ej heller n\u00e5gon enhet p\u00e5 ett directly connected interface som \u00e4r med i gruppen. D\u00e5 skickas ett Prune message upstream f\u00f6r att ber\u00e4tta detta. Prune har timeout 3 minuter, sedan \u00e5terg\u00e5r interfacet till forwarding. F\u00f6r att f\u00f6rhindra pendlandet mellan Pruned och Forwarding kom PIMv2 med en feature som kallas State refresh. Om downstream fortfarande inte vill vara med i multicaststr\u00f6mmen kan den skicka ett State refresh upstream f\u00f6r att nollst\u00e4lla Prune timer, detta skickas var 60:e sekund. Beh\u00f6ver en router pl\u00f6tsligt lyssna p\u00e5 en multicastgrupp (f\u00f6r att den f\u00e5tt in IGMP Join) kan den \"unprune\" genom att skicka ett Graft message upstream som g\u00e4ller s\u00e5 fort det kommer fram vilket s\u00e4nker konvergeringstiden. Det ackas med Graft Ack. F\u00f6r Dense mode kan olika multicast-routingprotokoll anv\u00e4ndas. PIM Dense mode skalar inte superbra pga excessive flooding.</p> <p><code>interface\u00a0gi2</code> <code>ip\u00a0pim\u00a0dense-mode</code></p> <p>Verify</p> <p><code>show\u00a0ip\u00a0pim\u00a0interface</code> <code>show\u00a0ip\u00a0mroute</code></p>"},{"location":"cisco/Cisco_PIM/#sparse-mode","title":"Sparse Mode","text":"<p>Det \u00e4r inte s\u00e4kert att alla n\u00e4t har n\u00e5gon mottagare av multicast, d\u00e4rf\u00f6r finns Sparse mode (RFC 4601) som inte anv\u00e4nder lika mycket n\u00e4tverksresurser som Dense mode. Den stora skillnaden \u00e4r deras default-beteende. Med IPv6 finns endast Sparse mode. Default \u00e4r att inte skicka vidare paket downstream om man inte f\u00e5tt ett Join meddelande som beg\u00e4r paket f\u00f6r en viss multicast-grupp. Detta h\u00e4nder n\u00e4r det har kommit in ett IGMP Join message p\u00e5 ett directly connected interface eller en annan router downstream har beg\u00e4rt trafik f\u00f6r gruppen. Multicast forwardas s\u00e5l\u00e4nge det kommer Join-meddelanden. Vem som ska ha vad h\u00e5lls koll p\u00e5 av en Rendezvous Point som alla m\u00e5ste k\u00e4nna till. I sm\u00e5 n\u00e4t g\u00f6rs detta manuellt och i st\u00f6rre n\u00e4t kan detta g\u00f6ras automatiskt.</p> <p>N\u00e4r en Source host skickar multicast-trafik f\u00f6rsta g\u00e5ngen kommer routern som tar emot det att enkapsulera paketet i ett PIM Register och skicka det med unicast till RP. K\u00e4nner inte RP till n\u00e5gon downstream som beg\u00e4rt denna str\u00f6m kommer den att svara med ett Register-Stop meddelande och den f\u00f6rsta routern ska inte forwarda denna multicast-str\u00f6m. Register-Suppression timer startar d\u00e5 och router v\u00e4ntar 1 minut minus 5 sekunder sedan fr\u00e5gar den RP igen men denna g\u00e5ng utan det enkapsulerade mc-paketet utan Null-Register biten \u00e4r satt ist\u00e4llet. D\u00e4remot om RP k\u00e4nner till n\u00e5gon som vill ha multicast-str\u00f6mmen kommer den att dekapsulera paketet och forwarda det. P\u00e5 s\u00e5 s\u00e4tt fungerar multicast tills registration process \u00e4r klar. N\u00e4r en PIM-SM router l\u00e4ngs v\u00e4gen f\u00e5r in ett PIM Join s\u00e4tts interfacet i forwarding f\u00f6r den multicastgruppen. F\u00f6r att multicast ska forts\u00e4tta forwardas m\u00e5ste routrar fors\u00e4tta skicka PIM Joins annars blir gruppen pruned. En router forts\u00e4tter med detta om den sj\u00e4lv f\u00e5r in Joins eller n\u00e5gon host p\u00e5 ett directly connected interface svarar p\u00e5 IGMP Queries. Prune timer \u00e4r default 3 minuter.</p> <p>Med sparse mode anv\u00e4nds shared trees som betecknas (*,G). RP kommer att g\u00e5 med b\u00e5de i (*,G) men ocks\u00e5 (S,G) d\u00e4r S \u00e4r source f\u00f6r str\u00f6mmen. Finns det flera k\u00e4llor till str\u00f6mmen kommer det f\u00f6rst att g\u00e5 till RP f\u00f6r att sedan forwardas ut shared distribution tree / root-path tree. Det finns \u00e4ven m\u00f6jlighet f\u00f6r en PIM-SM router att bygga SPT direkt med k\u00e4llan. Ifall man har n\u00e4rmre till k\u00e4llan \u00e4r det on\u00f6digt att all trafik ska g\u00e5 igenom RP f\u00f6rst. D\u00e5 kan routern faktiskt meddela RP med ett Prune message att multicast-str\u00f6mmen inte beh\u00f6ver skickas till den l\u00e4ngre. Ciscoroutrar g\u00f6r detta byte direkt efter f\u00f6rsta paketet, detta g\u00e5r att \u00e4ndra med ip pim spt-threshold infinity.</p> <p>P\u00e5 alla enheter (static RP):</p> <p><code>ip\u00a0multicast-routing</code> <code>ip\u00a0pim\u00a0rp-address\u00a010.0.0.10\u00a0[override]</code></p> <p><code>interface\u00a0gi2</code> <code>ip\u00a0pim\u00a0sparse-mode</code> <code>interface\u00a0gi3</code> <code>ip\u00a0pim\u00a0sparse-mode</code></p> <p>P\u00e5 Rendezvous Point ut\u00f6ver det ovan. En router vet om att den \u00e4r RP om den har ett interface med den konfigurerade rp-adressen. Man m\u00e5ste k\u00f6r PIM p\u00e5 det interface man annonserar som RP.</p> <p><code>interface\u00a0lo0</code> <code>ip\u00a0address\u00a010.0.0.10\u00a0255.255.255.0</code> <code>ip\u00a0pim\u00a0sparse-mode</code></p> <p>F\u00f6r att f\u00f6rhindra att o\u00f6nskade RPs och grupper blir aktiva i ens n\u00e4t kan man skydda sig med filter. Man skriver standard-acler som listar de grupper som \u00e4r till\u00e5tna, till exempel till\u00e5t endast join och prune messages fr\u00e5n RP 10.0.0.10 som har med grupp 224.4.4.4 att g\u00f6ra. Det r\u00e4cker att konfigurera detta p\u00e5 RP men det b\u00f6r g\u00f6ras \u00f6verallt.</p> <p><code>ip\u00a0access-list\u00a0standard\u00a0ALLOWED_GROUPS</code> <code>permit\u00a0224.4.4.4</code></p> <p><code>ip\u00a0pim\u00a0accept-rp\u00a010.0.0.10\u00a0ALLOWED_GROUPS</code></p> <p>Verify</p> <p><code>show\u00a0ip\u00a0mroute</code> <code>show\u00a0ip\u00a0pim\u00a0rp\u00a0mapping</code> <code>show\u00a0derived-config\u00a0interface\u00a0tunnel0</code></p> <p>P\u00e5 RP skapas tv\u00e5 stycken tunnel interface, ett f\u00f6r att enkapsulera PIM Register messages och ett f\u00f6r att dekapsulera.</p> <p><code>show\u00a0ip\u00a0pim\u00a0tunnel</code></p>"},{"location":"cisco/Cisco_PIM/#sparse-dense-mode","title":"Sparse Dense Mode","text":"<p>PIM Sparse-Dense mode \u00e4r en hybrid av Sparse och Dense mode operations. En \u201csparse\u201d multicast-grupp \u00e4r en som har RP definierat. N\u00e4r man k\u00f6r ip pim sparse-dense-mode p\u00e5 ett interface s\u00e5 kommer det att forwardera trafik b\u00e5de f\u00f6r sparse och dense multicast groups ut p\u00e5 det interfacet.</p> <p><code>interface\u00a0gi2</code> <code>ip\u00a0pim\u00a0sparse-dense-mode</code></p> <p>St\u00e4nga av dense mode fallback.</p> <p><code>no\u00a0ip\u00a0pim\u00a0dm-fallback</code></p>"},{"location":"cisco/Cisco_PIM/#auto-rp","title":"Auto-RP","text":"<p>I Sparse mode m\u00e5ste alla multicast-routrar k\u00e4nna till RP, i st\u00f6rre n\u00e4t blir detta m\u00f6dosamt att konfigurera. Det finns tv\u00e5 mekanismer f\u00f6r att uppt\u00e4cka RP automatiskt, Auto-RP och BSR (se n\u00e4sta stycke). Auto-RP \u00e4r ett Ciscoproperit\u00e4rt protokoll som anv\u00e4nder 224.0.1.39 och 224.0.1.40 f\u00f6r kommunikation, dvs multicast som routas. Enheter som k\u00f6r Auto-RP och vill vara RP (candidates) skickar f\u00f6rst ut RP-Announce till 224.0.1.39 med sig sj\u00e4lv satt som RP. Det skickas ut var 60:e sekund och det inneh\u00e5ller vilka multicast-grupper man \u00e4r RP f\u00f6r. Detta leder till att olika routrar kan vara RP f\u00f6r olika grupper vilket ger lastdelning. Sedan m\u00e5ste n\u00e5gon vara mapping agent (vanligtvis samma enhet) som l\u00e4r sig alla RPs och vilka grupper de \u00e4r med i f\u00f6r att kunna sprida informationen. Genom att g\u00e5 med i 224.0.1.39 f\u00e5r man all info fr\u00e5n RPs. Alla Cisco-enheter som \u00e4r konfigurerade f\u00f6r Auto-RP och Sparse mode g\u00e5r med i 224.0.1.40. Mapping agent skickar sedan ut RP-Discovery inneh\u00e5llandes RP-mappningar till 224.0.1.40 port 496 och alla kan l\u00e4ra sig var RP finns. Finns det flera cRPs f\u00f6r samma grupp v\u00e4ljs den som annonserar longest match annars blir det den med h\u00f6gst RP-IP. Finns det flera mapping agents s\u00e5 kommer de att h\u00f6ra varandra och de som inte har h\u00f6gst IP slutar d\u00e5 skicka discoveries. Anledningen till att man beh\u00f6ver mapping agents \u00f6verhuvudtaget \u00e4r f\u00f6r att annars skulle det kunna uppst\u00e5 situationer d\u00e4r olika routrar har valt olika RPs f\u00f6r samma grupp.</p> <p>Eftersom Auto-RP kommunicerar med multicast och sparse mode inte forwardar multicast utan RP s\u00e5 f\u00e5r man antingen k\u00f6ra sparse-dense-mode alternativt k\u00f6ra en inbyggd IOS feature som g\u00f6r undantag f\u00f6r 224.0.1.39 och 224.0.1.40, detta kallas Auto-RP Listener och konfigureras globalt.</p> <p><code>ip\u00a0pim\u00a0autorp\u00a0listener</code></p> <p>Candidate RP</p> <p><code>ip\u00a0access-list\u00a0standard\u00a0GROUPS</code> <code>permit\u00a0224.0.0.0\u00a07.255.255.255</code></p> <p><code>ip\u00a0pim\u00a0send-rp-announce\u00a0Loopback0\u00a0scope\u00a010\u00a0group-list\u00a0GROUPS</code></p> <p>Multicast mapping agent</p> <p><code>ip\u00a0pim\u00a0send-rp-discovery\u00a0Loopback0\u00a0scope\u00a010</code></p> <p>Filtrera announcements fr\u00e5n RPs, g\u00f6rs p\u00e5 MA med standard-acler.</p> <p><code>ip\u00a0pim\u00a0rp-announce-filter\u00a0rp-list</code><code>group-list</code> <p>Verify</p> <p><code>show\u00a0ip\u00a0pim\u00a0autorp</code> <code>show\u00a0ip\u00a0pim\u00a0rp\u00a0mapping</code></p> <p><code>clear\u00a0ip\u00a0pim\u00a0rp-mapping</code></p> <p>Auto-RP Cache Filtering Accept only (*, G) join messages destined for the specified Auto-RP cached address. Accept join and prune messages only for RPs in Auto-RP cache.</p> <p><code>ip\u00a0pim\u00a0accept-rp\u00a0auto-rp</code></p>"},{"location":"cisco/Cisco_PIM/#bsr","title":"BSR","text":"<p>En annan metod f\u00f6r att automatiskt hitta RP \u00e4r PIM Bootstrap Router och fungerar p\u00e5 liknande s\u00e4tt som Auto-RP. BSR fungerar som mapping agent i Auto-RP, de f\u00e5r in information fr\u00e5n RPs som de sedan distribuerar vidare. Dock v\u00e4ljer inte BSR n\u00e5gon b\u00e4sta RP utan information om alla skickas ut och \u00f6vriga f\u00e5r v\u00e4lja sj\u00e4lv vilken som \u00e4r b\u00e4st. BSR floodar detta till all-PIMv2-routers (224.0.0.13). PIM-SM routrar floodar bootstrap messages p\u00e5 alla non-RPF interfaces vilket leder till att alla multicast-routrar f\u00e5r informationen. Kommer det in bootstrap message p\u00e5 non-RPF interface discardas det vilket f\u00f6rhindrar loopar. Alla c-RP kan ber\u00e4tta f\u00f6r BSR att de \u00e4r RP och vilka grupper den \u00e4r med i tack vare att alla vet unicast-adressen till BSR eftersom den har floodats till alla. RPs skickar c-RP Advertisments till BSR. Man kan ha redundanta RPs och redundanta BSRs. Har man flera RPs f\u00f6r samma grupp har BSR en pseudo-random funktion f\u00f6r att f\u00f6rdela lasten mellan dem. Dock kan endast en vara preferred BSR och skicka bootstrap messages, de \u00f6vriga lyssnar och tar \u00f6ver n\u00e4r preferred BSR tystnar. Den som blir preferred avg\u00f6rs av h\u00f6gst prio och sedan h\u00f6gst IP. BSR-meddelanden sj\u00e4lva RPF-checkas.</p> <p>BSR (default prio \u00e4r 0)</p> <p><code>interface\u00a0lo0</code> <code>ip\u00a0pim\u00a0sparse-mode</code> <code>ip\u00a0pim\u00a0bsr-candidate\u00a0Loopback0</code> <p>RP</p> <p><code>interface\u00a0lo0</code> <code>ip\u00a0pim\u00a0sparse-mode</code> <code>ip\u00a0pim\u00a0rp-candidate\u00a0Loopback0</code></p> <p>Border</p> <p><code>interface\u00a0gi3</code> <code>ip\u00a0pim\u00a0bsr-border</code></p> <p>Verify</p> <p><code>show\u00a0ip\u00a0pim\u00a0bsr-router</code> <code>show\u00a0ip\u00a0pim\u00a0rp\u00a0mapping</code></p>"},{"location":"cisco/Cisco_PIM/#anycast-rp","title":"Anycast RP","text":"<p>Beh\u00f6ver man b\u00e5de redundans och lastdelning kan man s\u00e4tta upp flera RPs med samma IP-adress och p\u00e5 s\u00e5 s\u00e4tt f\u00e5 Anycast RP. Det \u00e4r inget eget protokoll i sig utan en implementation feature och man kan anv\u00e4nda b\u00e5de static RP, Auto-RP och BSR. Varje RP m\u00e5ste annonsera samma /32-prefix till IGP som d\u00e5 st\u00e5r f\u00f6r att dirigera trafiken (PIM Joins) till n\u00e4rmaste RP. RP-konfiguration g\u00f6rs som vanligt med n\u00e5gon av ovan n\u00e4mnda metoder. Om en RP d\u00f6r \u00e4r konvergeringstiden den tid det tar f\u00f6r IGP att hitta en annan v\u00e4g till samma destination. Varje RP bygger sina egna tr\u00e4d oberoende av eventuella \u00f6vriga RPs f\u00f6r samma grupper men f\u00f6r att h\u00e5lla allas information konsekvent b\u00f6r man (med IOS) anv\u00e4nda MSDP mellan RPs, se nedan.</p>"},{"location":"cisco/Cisco_PIM/#bidirectional-pim","title":"Bidirectional PIM","text":"<p>PIM-SM fungerar bra med relativt f\u00e5 multicast senders men n\u00e4r antalet \u00f6kar blir det mindre effektivt. Bidirectional PIM kan hj\u00e4lpa mot detta genom att \u00e4ndra reglerna litegrann. Det \u00e4r ett till\u00e4gg till Sparse mode konceptet som endast anv\u00e4nder shared trees, dvs det finns inga source-based trees. Det \u00e4r mest effektivt n\u00e4r de flesta receivers samtidigt ocks\u00e5 \u00e4r senders. F\u00f6r att kunna bygga bi-directional trees utan att introducera loopar v\u00e4ljs designated forwarders (DFs) p\u00e5 varje l\u00e4nk. Det \u00e4r endast dem som f\u00e5r skicka n\u00e5got upstream i tr\u00e4det. F\u00f6r downstream h\u00e5lls (*,G) state f\u00f6r varje BiDir-grupp med OIL byggd utifr\u00e5n mottagna PIM Join messages som vanligt. Ist\u00e4llet f\u00f6r att den f\u00f6rsta router som tar emot multicast enkapsulerar paketet och skickar det som PIM Register till RP kommer den att skicka upp det l\u00e4ngs det delade tr\u00e4det mot RP och g\u00f6r s\u00e5 med alla multicastpaket som kommer in. RP kommer ocks\u00e5 att forwarda i det delade tr\u00e4det och RP eller routern n\u00e4rmast k\u00e4llan g\u00e5r inte med i n\u00e5got SPT. Detta g\u00f6r det viktigt var man placerar RP. Eftersom det inte finns n\u00e5gon source registration process kommer inga tunnlar att skapas.</p> <p>Bidirectional PIM m\u00e5ste konfigureras p\u00e5 alla PIM-enheter.</p> <p><code>ip\u00a0pim\u00a0bidir-enable</code> <code>ip\u00a0pim\u00a0rp-candidate\u00a0Loopback0\u00a0group-list\u00a010</code><code>bidir</code></p> <p>Show designated forwarders</p> <p><code>show\u00a0ip\u00a0pim\u00a0interface\u00a0df</code></p> <p>Phantom RP F\u00f6r redundans kan man anv\u00e4nda en RP-IP som faktiskt inte finns konfad p\u00e5 n\u00e5gon enhet. Eftersom inga paket har destination RP-IP utan endast ska skickas upp mot RP beh\u00f6ver det inte vara en interface-adress. Det r\u00e4cker med en route i routingtabellen. Man kan t.ex. konfa prefix som inneh\u00e5ller RP-IP:n men har olika maskl\u00e4ngd p\u00e5 olika enheter, p\u00e5 s\u00e5 s\u00e4tt kan andra noder ta \u00f6ver RP (tack vare IGP-konvergens) n\u00e4r prim\u00e4ren g\u00e5r ner.</p> <p><code>interface\u00a0Loopback1</code> <code>description\u00a0Primary\u00a0RP</code> <code>ip\u00a0address\u00a010.10.11.1\u00a0255.255.255.252\u00a0\u00a0\u00a0\u00a0\u00a0&lt;-\u00a0/30</code> <code>ip\u00a0pim\u00a0sparse-mode</code> <code>ip\u00a0ospf\u00a0network\u00a0point-to-point</code> <code>ip\u00a0router\u00a0ospf\u00a01\u00a0area\u00a00.0.0.0</code></p> <p><code>ip\u00a0pim\u00a0rp-address</code><code>10.10.11.2</code><code>group-list\u00a0225.0.0.0/24\u00a0bidir</code></p>"},{"location":"cisco/Cisco_PIM/#source-specific-multicast","title":"Source Specific Multicast","text":"<p>Med SSM kan hostarna sj\u00e4lva v\u00e4lja source f\u00f6r trafikstr\u00f6mmen ifall det finns flera. Det kan \u00e4ven skydda mot dos-attacker eftersom mottagare ber\u00e4ttar f\u00f6r n\u00e4tverket vilka k\u00e4llor de vill f\u00e5 trafik ifr\u00e5n. Det ger ocks\u00e5 f\u00f6rdelar med att \u00f6verlappande grupp-adresser kommer att fungera eftersom olika k\u00e4llor g\u00f6r det unikt. Det finns inga shared trees med SSM utan allt hanteras som source trees. Det beh\u00f6vs heller inga RPs eftersom k\u00e4llan \u00e4r k\u00e4nd.</p> <p>Source Specific Multicast kr\u00e4ver IGMPv3 samt n\u00e5gon variant av sparse mode.</p> <p><code>interface\u00a0gi2</code> <code>ip\u00a0igmp\u00a0version\u00a03</code> <code>ip\u00a0pim\u00a0sparse-mode</code></p> <p>Sedan v\u00e4ljer man range som enheterna ska behandla som SSM, dvs droppa eventuella (*,G). Default inneb\u00e4r 232.0.0.0-232.255.255.255 som \u00e4r IANA assigned SSM range.</p> <p><code>ip\u00a0pim\u00a0ssm\u00a0default</code></p> <p>Verify</p> <p><code>show\u00a0ip\u00a0mroute</code></p>"},{"location":"cisco/Cisco_PIM/#msdp","title":"MSDP","text":"<p>Multicast Source Discovery Protocol (RFC 3618) anv\u00e4nds f\u00f6r inter-domain IPv4 multicasting och f\u00f6r att l\u00e5ta RPs i ett enskilt AS dela information om de k\u00f6r Anycast RP. MSDP kan anv\u00e4ndas mellan RPs f\u00f6r att ber\u00e4tta vilka k\u00e4llor de k\u00e4nner till. N\u00e4r en PIM router registrerar en multicastk\u00e4lla till sin RP kommer den att anv\u00e4nda MSDP f\u00f6r att skicka denna info till sina peer RPs. Source Active meddelanden inneh\u00e5ller IP-adress f\u00f6r varje k\u00e4lla f\u00f6r varje grupp, enheter p\u00e5 andra sidan kan d\u00e5 bygga SPT f\u00f6r respektive sender. Meddelandena skickas var 60:e sekund med TCP \u00f6ver unicast mellan peers och blir besvarade med SA response paket. Detta grannskap m\u00e5ste konfigureras och unicast route till andra sidan m\u00e5ste finnas. BGP eller Multicast BGP kan anv\u00e4ndas f\u00f6r detta.</p> <p><code>ip\u00a0msdp\u00a0peer\u00a0[peer_unique_address]\u00a0connect-source\u00a0loopback0\u00a0remote-as\u00a0100</code> <code>ip\u00a0msdp\u00a0originator-id\u00a0[unique_address_interface]</code></p> <p>RPF checken kr\u00e4ver full routing information fr\u00e5n andra dom\u00e4ner f\u00f6r att multicast ska fungera. Om man t.ex. har en stub multicast domain och inte f\u00e5r in all information kan man konfigurera upstream RP som default-peer f\u00f6r RPF checkar anv\u00e4nds inte p\u00e5 default peers utan alla SA messages accepteras.</p> <p><code>ip\u00a0msdp\u00a0default-peer</code></p> <p>Verify</p> <p><code>show\u00a0ip\u00a0msdp\u00a0summary</code> <code>show\u00a0ip\u00a0msdp\u00a0peer</code> <code>show\u00a0ip\u00a0msdp\u00a0sa-cache</code></p>"},{"location":"cisco/Cisco_PIM/#mesh-group","title":"Mesh Group","text":"<p>MSDP mesh group \u00e4r en optimerings-feature som reducerar m\u00e4ngden SA-trafik n\u00e4r man har fler \u00e4n tv\u00e5 MSDP peers i samma dom\u00e4n. Alla MSDP speakers har fully meshed MSDP-konnektivitet mellan varandra, dvs alla har peering med samtliga routrar i gruppen. Detta g\u00f6r att SA flooding kan optimeras genom att SA messages inte beh\u00f6ver floodas till andra mesh group peers. V\u00e4rt att notera \u00e4r ocks\u00e5 att det inte g\u00f6rs n\u00e5gon RPF check p\u00e5 inkomna SA messages fr\u00e5n mesh group peers utan de accepteras alltid n\u00e4r MSDP mesh group \u00e4r konfigurerat.</p> <p><code>ip\u00a0msdp\u00a0peer\u00a010.1.1.1</code> <code>ip\u00a0msdp\u00a0peer\u00a010.2.2.2</code> <code>ip\u00a0msdp\u00a0mesh-group\u00a0mesh-group1\u00a010.1.1.1</code> <code>ip\u00a0msdp\u00a0mesh-group\u00a0mesh-group1\u00a010.2.2.2</code></p>"},{"location":"cisco/Cisco_PIM/#convergence","title":"Convergence","text":"<p>Multicast Subsecond Convergence \u00e4r m\u00f6jligt genom att anv\u00e4nda flera olika tekniker.</p> <p><code>ip\u00a0multicast\u00a0rpf\u00a0interval\u00a010</code> <code>ip\u00a0pim\u00a0register-rate-limit\u00a0rate\u00a010</code> <code>ip\u00a0pim\u00a0spt-threshold\u00a00</code></p> <p><code>interface\u00a0gi2</code> <code>ip\u00a0pim\u00a0query-interval\u00a030</code></p> <p>BFD Konvergenstider g\u00e5r ocks\u00e5 att trimma med hj\u00e4lp av BFD.</p> <p><code>ip\u00a0pim\u00a0bfd</code></p>"},{"location":"cisco/Cisco_PIM/#lan","title":"LAN","text":"<p>Detta g\u00e4ller b\u00e5de PIM-DM och PIM-SM.</p>"},{"location":"cisco/Cisco_PIM/#prune-override","title":"Prune Override","text":"<p>Om det finns flera routrar i samma L2-segment som vill ha multicast kommer det att sluta funka n\u00e4r en av dem ber upstream router att pruna en multicastgrupp. D\u00e4rf\u00f6r kommer den som p\u00e5 multiaccess-segment tar emot Prune att v\u00e4nta 3 sekunder innan den slutar forwarda multicaststr\u00f6mmen p\u00e5 sitt interfacet. Eftersom Prune g\u00e5r till 224.0.0.13 s\u00e5 f\u00e5r alla PIM-routrar det och de som vill forts\u00e4tta f\u00e5 str\u00f6mmen kan skicka ett vanligt Join-meddelande igen d\u00e5 kommer inte upstream sluta forwarda, detta kallas Prune Override. Detta \u00e4r inget som konfigureras utan det \u00e4r en funktion som \u00e4r p\u00e5 default.</p>"},{"location":"cisco/Cisco_PIM/#assert-message","title":"Assert Message","text":"<p>Om det finns flera routrar p\u00e5 ett LAN-segment som \u00e4r aktiva f\u00f6r en multicastgrupp kommer det att skickas in dubbel trafikstr\u00f6m till hostarna, detta \u00e4r on\u00f6digt. N\u00e4r en router f\u00e5r in ett multicast-paket som den sj\u00e4lv forwarderar in p\u00e5 n\u00e4tet kommer den att skicka ett PIM Assert Message. Med hj\u00e4lp av det kan routrarna j\u00e4mf\u00f6ra path cost till k\u00e4llan f\u00f6r SPT d\u00e4r endast vinnaren kommer att forwarda multicaststr\u00f6mmen in p\u00e5 LANet. Path cost best\u00e5r av kombinationen (AD, Metric) och f\u00f6rst j\u00e4mf\u00f6rs AD p\u00e5 routingprotokollet som har l\u00e4rt v\u00e4gen till k\u00e4llan sedan kollas p\u00e5 IGP-metricen f\u00f6r att skilja. \u00c4r detta ocks\u00e5 lika g\u00e5r man p\u00e5 h\u00f6gst IP-adress p\u00e5 interface. Den som f\u00f6rlorar slutar att flooda multicasten. I hub-and-spoke topologier b\u00f6r alltid hub vinna f\u00f6rutsatt att man inte k\u00f6ra PIM i NBMA mode.</p>   Assert message:    [](/File:Cisco_PIM_Assert.PNG \"wikilink\")"},{"location":"cisco/Cisco_PIM/#designated-router","title":"Designated Router","text":"<p>PIM Designated Router (DR) v\u00e4ljs p\u00e5 varje segment d\u00e4r det finns multipla multicast-routrar. Syftet med DR \u00e4r att ha en nod som signalerar aktiva k\u00e4llor till RP. Valet baseras p\u00e5 h\u00f6gsta prioritet och vid lika h\u00f6gsta IP-adress. Processen \u00e4r preemptive s\u00e5 det \u00e4r alltid den med b\u00e4st prio som \u00e4r DR. Detta \u00e4r en sparse-mode feature.</p> <p><code>interface\u00a0gi2</code> <code>ip\u00a0pim\u00a0sparse-mode</code> <code>ip\u00a0pim\u00a0dr-priority\u00a0100</code></p> <p><code>show\u00a0ip\u00a0pim\u00a0neighbor</code></p> <p>P\u00e5 RP kan begr\u00e4nsa vem som f\u00e5r skicka PIM Register fr\u00e5n olika segment med hj\u00e4lp av en extended acl, dvs man kan vitlista vem som \u00e4r en giltig DR.</p> <p><code>ip\u00a0access-list\u00a0extended\u00a0VLAN100</code> <code>permit\u00a0ip\u00a0host\u00a0100.0.100.10\u00a0any</code> <code>deny\u00a0\u00a0\u00a0ip\u00a0100.0.100.0\u00a00.0.0.255\u00a0any</code> <code>permit\u00a0ip\u00a0any\u00a0any</code></p> <p><code>ip\u00a0pim\u00a0accept-register\u00a0list\u00a0VLAN100</code></p>"},{"location":"cisco/Cisco_PIM/#pim-snooping","title":"PIM Snooping","text":"<p>Man kan begr\u00e4nsa multicastpaket f\u00f6r varje grupp s\u00e5 att endast multicast router ports som har n\u00e5gon downstream receiver med i gruppen f\u00e5r trafiken. N\u00e4r man sl\u00e5r p\u00e5 PIM snooping s\u00e5 kommer switchen att l\u00e4ra sig vilka mrouter-portar som ska ha vilka multicast-str\u00f6mmar i varje vlan genom att lyssna p\u00e5 PIM hello messages, PIM join/prune messages och bidirectional PIM designated forwarder-election messages. Join och prune kommer inte att floodas p\u00e5 alla mrouter-portar utan skickas till den port med upstream router som finns i payloaden p\u00e5 join/prune messages. All information om mroutes och routrar kommer att timeas ut baserat p\u00e5 den information som st\u00e5r i hellos, joins och prunes. Dense mode trafik ses som unknown och kommer att droppas men Auto-RP-paket kommer alltid att floodas.</p> <p>F\u00f6r att anv\u00e4nda PIM snooping m\u00e5ste IGMP snooping vara p\u00e5.</p> <p><code>ip\u00a0igmp\u00a0snooping</code> <code>ip\u00a0pim\u00a0snooping</code></p> <p>Verify</p> <p><code>show\u00a0ip\u00a0pim\u00a0snooping</code></p>"},{"location":"cisco/Cisco_PIM/#ipv6","title":"IPv6","text":"<p>Multicast routing \u00e4r inte p\u00e5 default f\u00f6r IPv6 men n\u00e4r man sl\u00e5r p\u00e5 det s\u00e5 enableas PIM p\u00e5 alla IPv6-interface. IPv6 PIM k\u00f6r alltid sparse mode. Reverse-path anv\u00e4nder routingtabellen vilket g\u00f6r det protokoll-oberoende precis som f\u00f6r IPv4. PIM-grannskap byggs med hj\u00e4lp av link-local adresser och det finns tre pakettyper: Query, Report och Done. DR v\u00e4ljs som vanligt och Hellos skickas var 30:e sekund. Multicast address range: FF00::/8.</p> <p><code>ipv6\u00a0multicast-routing</code></p> <p><code>interface\u00a0gi2</code> <code>ipv6\u00a0mld\u00a0access-group\u00a0MLD_FILTER</code> <code>ipv6\u00a0mld\u00a0query-max-response-time\u00a010</code> <code>ipv6\u00a0mld\u00a0query-timeout\u00a0255</code> <code>ipv6\u00a0mld\u00a0query-interval\u00a0125</code> <code>ipv6\u00a0mld\u00a0join-group\u00a0ff08::10</code></p> <p>St\u00e4nga av PIM</p> <p><code>interface\u00a0gi3</code> <code>no\u00a0ipv6\u00a0pim</code></p> <p>Static routes, dessa anv\u00e4nds endast av multicast.</p> <p><code>ipv6\u00a0route\u00a02000::/64\u00a0tun0</code><code>multicast</code></p> <p>Verify</p> <p><code>show\u00a0ipv6\u00a0pim\u00a0neighbors</code> <code>show\u00a0ipv6\u00a0pim\u00a0interface</code> <code>show\u00a0ipv6\u00a0pim\u00a0tunnel</code> <code>show\u00a0ipv6\u00a0mld\u00a0groups</code></p>"},{"location":"cisco/Cisco_PIM/#rp","title":"RP","text":"<p>Med IPv6 kan RP l\u00f6sas p\u00e5 tre olika s\u00e4tt. Det finns ingen Auto-RP eller MSDP f\u00f6r IPv6.</p> <p>Static</p> <p><code>ipv6\u00a0pim\u00a0rp-address\u00a02001:20::20</code></p> <p><code>show\u00a0ipv6\u00a0pim\u00a0range-list</code></p> <p>BSR BSR fungerar p\u00e5 samma s\u00e4tt f\u00f6r IPv4 men nu konfigureras det med en adress ist\u00e4llet f\u00f6r interface samt att source registration process skiljer litegrann. S\u00e5 fort en multicast-router l\u00e4r sig RP-adressen skapar den en tunnel dit som k\u00f6r multicast s\u00e5 n\u00e4r det kommer inte en mc-str\u00f6m s\u00e5 skickas den genom tunneln till RP. Tunneln anv\u00e4nds endast under registration process, sedan sl\u00e5r sista-hop-routern \u00f6ver till SPT. Man kan ocks\u00e5 konfigurera BSR med en lista p\u00e5 RP-kandidater genom att anv\u00e4nda ipv6 pim bsr announced rp  och d\u00e4rmed beh\u00f6ver inte RPs annonsera sig sj\u00e4lva som candidates. <p><code>ipv6\u00a0pim\u00a0bsr\u00a0candidate\u00a0bsr\u00a02001:20::20</code></p> <p>RP</p> <p><code>ipv6\u00a0pim\u00a0bsr\u00a0candidate\u00a0rp\u00a02001:20::20</code></p> <p>Verify</p> <p><code>show\u00a0ipv6\u00a0pim\u00a0bsr\u00a0election</code></p> <p>Embedded RP Med IPv6 kan ocks\u00e5 \u00f6vriga routrar ta reda p\u00e5 vem som \u00e4r RP utifr\u00e5n en adress som kan bakas in i grupp-adressen (RFC 3956). Ser en router denna adress kan de r\u00e4kna ut vad RP har f\u00f6r adress (RP Calculator) och direkt b\u00f6rja forwarda i det delade tr\u00e4det. Endast RP beh\u00f6ver konfigureras och \u00f6vriga kan l\u00e4ra sig det dynamiskt. Fungerar endast med grupper i Embedded RP address range: FF70::/12.</p> <p>P\u00e5 default:</p> <p><code>ipv6\u00a0pim\u00a0rp\u00a0embedded</code></p> <p><code>interface\u00a0Tunnel0</code> <code>description\u00a0Pim\u00a0Register\u00a0Tunnel\u00a0(Encap)\u00a0for\u00a0Embedded\u00a0RP</code> <code>no\u00a0ip\u00a0address</code> <code>ipv6\u00a0unnumbered\u00a0Loopback0</code> <code>ipv6\u00a0enable</code> <code>tunnel\u00a0source\u00a0Loopback0</code> <code>tunnel\u00a0destination\u00a0::</code> <code>tunnel\u00a0ttl\u00a065</code></p> <p>RP (loopback-adressen m\u00e5ste annonseras i IGP s\u00e5 alla kan hitta dit)</p> <p><code>interface\u00a0Loopback1</code> <code>ipv6\u00a0address\u00a02006:6666::5/128</code></p> <p><code>ipv6\u00a0pim\u00a0rp-address\u00a02006:6666::5</code></p> <p>Receivers</p> <p><code>ipv6\u00a0mld\u00a0join-group\u00a0FF7E:540:2006:6666::1</code></p> <p>Verify</p> <p><code>show\u00a0ipv6\u00a0mroute</code> <code>show\u00a0ipv6\u00a0pim\u00a0group-map</code></p> <p>Anycast RP Man kan anv\u00e4nda anycast f\u00f6r att \u00f6ka tillg\u00e4ngligheten p\u00e5 RP. Att distribuera RP-infon g\u00f6rs med n\u00e5gon ovan n\u00e4mnd metod, detta \u00e4r endast f\u00f6r att h\u00e5lla mroute-tabellerna synkade mellan alla RPs. Loopback-adressen m\u00e5ste annonseras i IGP s\u00e5 alla kan hitta dit.</p> <p>RP1</p> <p><code>ipv6\u00a0pim\u00a0anycast-rp\u00a02001:20::20\u00a010::2</code> <code>interface\u00a0Loopback1</code> <code>ipv6\u00a0add\u00a010::1/128</code> <code>ipv6\u00a0add\u00a02001:20::20/128</code></p> <p>RP2</p> <p><code>ipv6\u00a0pim\u00a0anycast-rp\u00a02001:20::20\u00a010::1</code> <code>interface\u00a0Loopback1</code> <code>ipv6\u00a0add\u00a010::2/128</code> <code>ipv6\u00a0add\u00a02001:20::20/128</code></p> <p>Verify</p> <p><code>show\u00a0ipv6\u00a0pim\u00a0anycast-rp</code></p>"},{"location":"cisco/Cisco_PIM/#ssm","title":"SSM","text":"<p>IPv6 SSM fungerar ungef\u00e4r som embedded RP multicast fast det inte finns n\u00e5got embedded RP prefix eftersom MLD tillhandah\u00e5ller den informationen. SSM mapping kan anv\u00e4ndas f\u00f6r hostar som inte st\u00f6djer MLDv2, d\u00e5 kan man antingen anv\u00e4nda DNS eller static maps f\u00f6r att kolla upp k\u00e4llan i MLDv1 report.</p> <p><code>interface\u00a0gi3</code> <code>ipv6\u00a0mld\u00a0join-group\u00a0FF36:10::10\u00a02001:20::20</code></p>"},{"location":"cisco/Cisco_PIM/#nx-os","title":"NX-OS","text":"<p>H\u00e4r f\u00f6ljer Nexus-specifik information. Beroende p\u00e5 skillnader i h\u00e5rdvara mellan de olika Nexusplattformarna finns det st\u00f6d f\u00f6r olika multicast capabilities, referera alltid till Ciscos dokumentation. N\u00e5gra grundl\u00e4ggande skillnader mot IOS \u00e4r att det saknas st\u00f6d f\u00f6r IGMP version 1 och Version 3 Lite, PIM version 1 och dense mode operation. PIM har \u00e4ven SSM group range 232.0.0.0/8 by default (\u00e4ven i VRF:er). Se \u00e4ven IGMP f\u00f6r NX-OS.</p>"},{"location":"cisco/Cisco_PIM/#konfiguration_1","title":"Konfiguration","text":"<p><code>feature\u00a0pim</code></p> <p><code>ip\u00a0pim\u00a0log-neighbor-changes</code> <code>ip\u00a0pim\u00a0rp-address\u00a0172.16.1.10\u00a0group-list\u00a0224.0.0.0/4</code> <code>ip\u00a0pim\u00a0bfd</code></p> <p><code>interface\u00a0Ethernet1/1</code> <code>ip\u00a0address\u00a0192.168.1.1/24</code> <code>ip\u00a0pim\u00a0sparse-mode</code></p> <p>VRF</p> <p><code>vrf\u00a0context\u00a0Tenant1</code> <code>ip\u00a0pim\u00a0rp-address\u00a0172.16.1.10\u00a0group-list\u00a0224.0.0.0/4</code></p> <p>Auto-RP</p> <p><code>ip\u00a0pim\u00a0auto-rp\u00a0rp-candidate\u00a0loopback1\u00a0group-list\u00a0224.0.0.0/4</code> <code>ip\u00a0pim\u00a0auto-rp\u00a0mapping-agent\u00a0loopback1</code> <code>ip\u00a0pim\u00a0auto-rp\u00a0forward\u00a0listen</code></p> <p>BSR</p> <p><code>ip\u00a0pim\u00a0bsr\u00a0bsr-candidate\u00a0loopback1</code> <code>ip\u00a0pim\u00a0bsr\u00a0rp-candidate\u00a0loopback1\u00a0group-list\u00a0224.0.0.0/4</code> <code>ip\u00a0pim\u00a0bsr\u00a0forward\u00a0listen</code></p> <p>Neighbor Authentication</p> <p><code>interface\u00a0Ethernet1/1</code> <code>ip\u00a0pim\u00a0sparse-mode</code> <code>ip\u00a0pim\u00a0hello-authentication\u00a0ah-md5\u00a03\u00a0a667d47acc18ea6b</code></p> <p>Anycast RP Anycast-RP (RFC 4610) inneb\u00e4r att man assignar en grupp routrar till en RP-adress som finns konfad p\u00e5 flera routrar. PIM messages skickas till den router som routingtabellen tycker \u00e4r n\u00e4rmast. Detta ger lastdelning och redundans. Denna feature finns inte p\u00e5 IOS.</p> <p><code>interface\u00a0loopback10</code> <code>description\u00a0Anycast-RP-Address</code> <code>ip\u00a0address\u00a0172.16.1.10/32</code> <code>ip\u00a0pim\u00a0sparse-mode</code></p> <p><code>ip\u00a0pim\u00a0rp-address\u00a0172.16.1.10</code> <code>ip\u00a0pim\u00a0anycast-rp\u00a0172.16.1.10\u00a0192.168.10.1</code> <code>ip\u00a0pim\u00a0anycast-rp\u00a0172.16.1.10\u00a0192.168.10.2</code></p> <p>Verify</p> <p><code>show\u00a0running-configuration\u00a0pim</code> <code>show\u00a0ip\u00a0mroute</code> <code>show\u00a0ip\u00a0pim\u00a0interface</code> <code>show\u00a0ip\u00a0pim\u00a0group-range</code> <code>show\u00a0ip\u00a0route\u00a0rpf</code> <code>show\u00a0ip\u00a0static-route\u00a0multicast</code></p> <p>Maintenance mode Man kan isolera routern (ur ett PIM-perspektiv) genom att skicka ut PIM Hello message med holdtime 0 (goodbye) till alla grannar, d\u00e5 rivs alla PIM-grannskap direkt.</p> <p><code>ip\u00a0pim\u00a0isolate</code></p>"},{"location":"cisco/Cisco_PIM/#ios-xr","title":"IOS-XR","text":"<p>IOS-XR har SSM group range 232.0.0.0/8 by default.</p> <p>Konfiguration</p> <p><code>multicast-routing</code> <code>address-family\u00a0ipv4</code> <code>interface\u00a0HundredGigE0/0/0/0</code> <code>enable</code> <code>!</code> <code>!</code> <code>!</code> <code>router\u00a0pim</code> <code>address-family\u00a0ipv4</code> <code>rp-address\u00a010.0.0.10</code> <code>log\u00a0neighbor\u00a0changes</code></p> <p>Verify</p> <p><code>show\u00a0pim\u00a0group-map</code> <code>show\u00a0mfib\u00a0route</code> <code>show\u00a0pim\u00a0rpf\u00a0192.168.0.10</code> <code>show\u00a0pim\u00a0rpf\u00a0hash</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_PfR/","title":"Cisco PfR","text":"<p>Performance Routing (PfR) \u00e4r \"Application Path Optimization\". Det \u00e4r en vidareutveckling av Optimized Edge Routing (OER) som gav prefix-based route optimization. PfR och OER anv\u00e4nder sig av packet loss, response time, path availability och traffic load distribution f\u00f6r att fatta beslut. Det PfR ocks\u00e5 tar h\u00e4nsyn till \u00e4r application type och application performance requirements. PfR kan klassificera trafik utifr\u00e5n IP-adresser, protokoll, portnummer, DSCP och i nyare versioner av IOS \u00e4ven NBAR. Man beh\u00f6ver en Master Controller (som fattar besluten) och en eller flera Border Routers. Authentication \u00e4r inbyggt f\u00f6r all kommunikation till och fr\u00e5n MC och man m\u00e5ste anv\u00e4nda sig av key-chains (t.o.m. om MC och BR finns p\u00e5 samma router). Kommunikation mellan MC och BR g\u00f6rs med TCP och performance metrics samlas med NetFlow and IP SLA probes som konfigureras automatiskt. PfR route-maps s\u00e4tts p\u00e5 Internal Interface och f\u00f6r att dynamiska route-maps ska fungera kr\u00e4vs L3-konnektivitet mellan BRs annars m\u00f6ts inte PfR's PBR requirement och dynamiska route-maps fungerar ej. Om Master Controller g\u00e5r ner s\u00e5 m\u00e4rker Border Routers att deras kommunikation till MC inte l\u00e4ngre \u00e4r aktiv. Det som h\u00e4nder d\u00e5 \u00e4r att de kollar vilka routes som \u00e4r fr\u00e5n PfR och tar bort dessa och allt \u00e5terg\u00e5r till normal routing. N\u00e4tverket blir som det var innan PfR slogs p\u00e5. PfR \u00e4r inte VRF-aware.</p>"},{"location":"cisco/Cisco_PfR/#terminologi","title":"Terminologi","text":"<p>Master Controller: monitorerar utg\u00e5ende trafikfl\u00f6den f\u00f6r att kunna optimera routingen med hj\u00e4lp av policy. En MC kan ha hand om 10 border routers eller 20 external interfaces. Den beh\u00f6ver inte finnas i data plane forwarding path.</p> <p>Border Router: har ett eller flera external interfaces. Dessa rapporterar in prefix- och transit link measurements till MC som sedan fattar policy beslut. MC ber\u00e4ttar sedan f\u00f6r BR vad den ska g\u00f6ra.</p> <p>Internal interfaces: \u00e4r interface mot resten av n\u00e4tet och anv\u00e4nds f\u00f6r att kommunicera med control plane manager f\u00f6r PfR. MC dikterar vad som \u00e4r internal interfaces.</p> <p>External interfaces: anv\u00e4nds f\u00f6r att skicka paket till det lokala n\u00e4tverket. Det \u00e4r dessa som performance m\u00e4ts p\u00e5. MC dikterar vad som \u00e4r external interfaces.</p> <p>Local interfaces: finns p\u00e5 routern och \u00e4r source f\u00f6r kommunikationen med Master Controller.</p>"},{"location":"cisco/Cisco_PfR/#operational-phases","title":"Operational Phases","text":"<p>PfR delas in i olika faser som fyller olika syften.</p> <ul> <li>Profile Phase: L\u00e4ra sig vilka flows som har h\u00f6g latency och     throughput. MTC list inneh\u00e5ller alla Monitored Traffic Classes.</li> </ul> <ul> <li>Measure Phase: Samla in och r\u00e4kna p\u00e5 performance metrics f\u00f6r all     trafik p\u00e5 MTC list.</li> </ul> <ul> <li>Apply Policy Phase: Skapa low och high thresholds f\u00f6r att veta     vad som \u00e4r in-policy och vad som \u00e4r out-of-policy.</li> </ul> <ul> <li>Control Phase: P\u00e5verka trafik genom att manipulera routes eller     anv\u00e4nda PBR.</li> </ul> <ul> <li>Verify Phase: Kontrollera ifall n\u00e5got \u00e4r out-of-policy f\u00f6r att     is\u00e5fall r\u00e4tta till det.</li> </ul>"},{"location":"cisco/Cisco_PfR/#konfiguration","title":"Konfiguration","text":"<p>Key chain m\u00e5ste skapas p\u00e5 alla enheter.</p> <p><code>key\u00a0chain\u00a0PFR</code> <code>key\u00a01</code> <code>key-string\u00a0SECRET</code></p> <p><code>show\u00a0key\u00a0chain</code></p> <p>MC Det kr\u00e4vs minst 2 external interfaces (totalt) f\u00f6r att MC ska bli aktiv.</p> <p><code>pfr\u00a0master</code> <code>border\u00a02.2.2.2\u00a0key-chain\u00a0PFR</code> <code>interface\u00a0gi2\u00a0internal</code> <code>interface\u00a0gi3\u00a0external</code> <code>border\u00a03.3.3.3\u00a0key-chain\u00a0PFR</code> <code>interface\u00a0gi2\u00a0internal</code> <code>interface\u00a0gi3\u00a0external</code></p> <p>Defaults</p> <p><code>pfr\u00a0master</code> <code>learn</code> <code>throughput</code> <code>periodic-interval\u00a00</code> <code>monitor-period\u00a01</code></p> <p><code>border\u00a02.2.2.2\u00a0key-chain\u00a0PFR</code> <code>interface\u00a0GigabitEthernet3\u00a0external</code> <code>max-xmit-utilization\u00a0percentage\u00a090</code> <code>maximum\u00a0utilization\u00a0receive\u00a0percentage\u00a0100</code></p> <p>Verify</p> <p><code>show\u00a0pfr\u00a0master\u00a0border</code> <code>show\u00a0pfr\u00a0master\u00a0exits</code></p> <p>Border</p> <p><code>pfr\u00a0border</code> <code>master\u00a01.1.1.1\u00a0key-chain\u00a0PFR</code> <code>local\u00a0loopback\u00a00</code> <code>logging</code></p> <p>Verify</p> <p><code>show\u00a0pfr\u00a0border</code> <code>show\u00a0ip\u00a0sla\u00a0summary</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_QoS/","title":"Cisco QoS","text":"<p>Quality of Service \u00e4r anv\u00e4ndbart om en l\u00e4nk eller interface g\u00e5r fullt och viss trafik \u00e4r viktigare \u00e4n annan. Man kan klassificera och markera paket som man vill att intermediate systems ska prioritera och skicka iv\u00e4g i f\u00f6rsta hand. IP/ATM/Frame Relay-headers har f\u00e4lt som kan anv\u00e4ndas f\u00f6r detta, t.ex. IP DSCP (RFC 3260). QoS \u00e4r endast aktivt n\u00e4r det \u00e4r \u00f6verbelastat. QoS g\u00e5r att ha time based genom att matcha mot time based ACLer. Se \u00e4ven Cisco RSVP.</p> <p>QoS Features</p> <ul> <li>Classification: Kolla packet headers och best\u00e4mma k\u00f6</li> <li>Drop policy: Regler f\u00f6r vad som ska droppas n\u00e4r det g\u00e5r fullt</li> <li>Scheduling: Logiken som best\u00e4mmer vad som ska skickas h\u00e4rn\u00e4st</li> <li>Number of queues: Unika klasser av paket f\u00f6r queueing tools</li> <li>Queue length: Maximala antalet paket i en enskild k\u00f6</li> </ul>"},{"location":"cisco/Cisco_QoS/#mqc","title":"MQC","text":"<p>Modular QoS CLI togs fram f\u00f6r att skapa en homogen syntax f\u00f6r QoS p\u00e5 IOS-enheter. Det f\u00f6renar QoS features under ett gr\u00e4nsnitt och man kan konfigurera allt som har med classification, congestion management, traffic metering, marking och traffic shaping att g\u00f6ra. Man kan \u00e4ven anv\u00e4nda en route-map f\u00f6r att s\u00e4tta markeringar p\u00e5 paket men det \u00e4r inte det rekommenderade s\u00e4ttet.</p> <ul> <li>Class Map \u2013 Definiera typer av trafik</li> <li>Policy Map \u2013 Definiera vad som ska g\u00f6ras med trafiken, t.ex. s\u00e4tta     QoS-markering eller shapea.</li> <li>Service Policy \u2013 Definiera interface och riktning</li> </ul> <p>Class, man kan bl.a. matcha p\u00e5 ACLer/MAC-adresser/QoS-markeringar/protokoll. Det g\u00e5r att v\u00e4lja mellan AND-logik (match-all) eller OR-logik (match-any) om man beh\u00f6ver flera match-statements. Det g\u00e5r \u00e4ven att anv\u00e4nda nested class-maps f\u00f6r mer avancerad logik.</p> <p><code>class-map\u00a0CLASS-MAP</code> <code>match\u00a0access-group\u00a0name</code> <code>match\u00a0cos</code> <code>match\u00a0mpls\u00a0experimental</code> <code>match\u00a0not\u00a0destination-address\u00a0mac</code> <p><code>show\u00a0class-map</code></p> <p>Policy</p> <p><code>policy-map\u00a0POLICY-MAP</code> <code>class\u00a0CLASS-MAP</code> <code>set\u00a0ip\u00a0dscp\u00a0&lt;0-63&gt;</code></p> <p><code>show\u00a0policy-map\u00a0interface</code></p> <p>Interface</p> <p><code>interface\u00a0Gi0/0</code> <code>service-policy\u00a0input\u00a0POLICY-MAP</code></p> <p><code>show\u00a0policy-map\u00a0interface\u00a0brief</code> <code>show\u00a0run\u00a0|\u00a0i\u00a0interface|service-policy</code></p> <p>Om service-policy rejectas kan det bero p\u00e5 avsaknad av CEF p\u00e5 enheten.</p>"},{"location":"cisco/Cisco_QoS/#packet-marking","title":"Packet Marking","text":"<p> <p>P\u00e5 vissa plattformar n\u00e4r man k\u00f6r med L2 etherchannel m\u00e5ste man sl\u00e5 p\u00e5 att qos ska titta p\u00e5 vlan-taggade paket.</p> <p><code>interface\u00a0Port-channel4</code> <code>platform\u00a0qos\u00a0vlan-based</code></p> <p>Non-IP Marking Alla enheter kanske inte har m\u00f6jligheten att kolla p\u00e5 L3-headern, t.ex. en LSR (MPLS) ser endast labels. Det man kan g\u00f6ra \u00e4r att l\u00e5ta ingress LSR f\u00f6ra \u00f6ver QoS-klassificeringen till MPLS-headern som har ett 3-bitars f\u00e4lt f\u00f6r detta (EXP).</p>"},{"location":"cisco/Cisco_QoS/#nbar","title":"NBAR","text":"<p>Vill man matcha p\u00e5 ett visst protokoll i sin class-map kan man anv\u00e4nda Network Based Application Recognition som finns inbyggt i IOS. Det finns v\u00e4ldigt m\u00e5nga f\u00f6rdefinierade protokoll. NBAR \u00e4r i passive och active mode beroende p\u00e5 hur det anv\u00e4nds.</p> <p><code>class-map\u00a0NBAR</code> <code>match\u00a0protocol\u00a0?</code></p> <p>NBAR p\u00e5 CSR 1000V matchar inte ICMP echo packets under icmp utan har eget kommando.</p> <p><code>class-map\u00a0match-any\u00a0ICMP</code> <code>match\u00a0protocol\u00a0icmp</code> <code>match\u00a0protocol\u00a0ping</code></p> <p>Man kan ocks\u00e5 anv\u00e4nda NBAR f\u00f6r att samla trafikdata om paketen som g\u00e5r \u00f6ver ett interface.</p> <p><code>interface\u00a0gi2</code> <code>ip\u00a0nbar\u00a0protocol-discovery</code></p> <p><code>show\u00a0ip\u00a0nbar\u00a0protocol-discovery</code></p> <p>Beh\u00f6ver man l\u00e4gga in ett nytt protokoll f\u00e5r man ladda ner en PDLM-fil fr\u00e5n Cisco och ladda upp till IOS-enheten och aktivera.</p> <p><code>ip\u00a0nbar\u00a0pdlm</code><code>name</code></p>"},{"location":"cisco/Cisco_QoS/#congestion-management","title":"Congestion Management","text":"<p>K\u00f6er som skapas p\u00e5 interface av queueing tools kallas software queues och h\u00e5ller det paket som inte kan skickas iv\u00e4g p\u00e5 en g\u00e5ng. N\u00e4r sedan paketen kan skickas iv\u00e4g flyttas de till en liten FIFO queue i hardware, denna kallas Tx ring (a special buffer control structure). N\u00e4r ett paket har l\u00e4mnat Tx ring kan n\u00e4sta encodas och skickas iv\u00e4g utan software interupt till CPU, detta m\u00f6jligg\u00f6r full anv\u00e4ndning av interfacets bandbredd. Denna k\u00f6 anv\u00e4nder alltid FIFO-logik och kan inte p\u00e5verkas av IOS queuing tools. Det \u00e4r n\u00e4r tx ring g\u00e5r full som ett interface \u00e4r \u00f6verbelastat. Det som h\u00e4nder n\u00e4r man anv\u00e4nder queuing tools \u00e4r att hardware queue minskas lite f\u00f6r att ge mjukvaran mer utrymme att spela med eftersom mer trafik d\u00e5 hamnar i software queue.</p> <p><code>show\u00a0controllers</code></p> <p>tx_ring \u00e4r hardware queue, hold queue \u00e4r software queue</p> <p><code>interface\u00a0gi2</code> <code>tx-ring-limit</code> <code>hold-queue\u00a0375\u00a0in</code> <code>hold-queue\u00a040\u00a0out</code></p> <p>Catalyst 3850 Soft Buffers \u00e4r assignade till en k\u00f6 men kan delas med andra k\u00f6er och interface om de inte anv\u00e4nds. Det totala antalet tillg\u00e4ngliga buffrar default \u00e4r mindre \u00e4n vad h\u00e5rdvaran klarar av men detta kan \u00f6kas globalt i switchen.</p> <p><code>qos\u00a0queue-softmax-multiplier\u00a01200</code> <code>qos\u00a0queue-stats-frame-count</code></p> <p>\u00c4ven \"hold-queue out\" \u00e4r lite sn\u00e5lt st\u00e4llt default p\u00e5 3850.</p>"},{"location":"cisco/Cisco_QoS/#selective-packet-discard","title":"Selective Packet Discard","text":"<p>SPD anv\u00e4nds n\u00e4r input queue \u00e4r full och det inneb\u00e4r att mer minne till\u00e5ts ifall det \u00e4r control plane packets som ska till CPU. Input queue kommer b\u00f6rja t\u00f6mmas f\u00f6r ge utrymme ifall det kommer in ytterliggare control plane packets. SPD \u00e4r p\u00e5 default b\u00e5de f\u00f6r IPv4 och IPv6.</p> <p><code>show\u00a0ip\u00a0spd</code></p>"},{"location":"cisco/Cisco_QoS/#cbwfq","title":"CBWFQ","text":"<p>Tanken med Class-Based Weighted Fair Queueing \u00e4r att anv\u00e4nda samma scheduling logic som WFQ fast med konfigurerbara klasser som har extra l\u00e5g weight vilket g\u00f6r dem mer viktiga \u00e4n den dynamiska omvandlingen. Det fungerar som WFQ fast man har mer flexibel flow classification med MQC syntax. Det \u00e4r skapat fr\u00e5n legacy-metoderna PQ och CQ. CBWFQ reserverar bandbredd f\u00f6r varje k\u00f6 f\u00f6r att sedan anv\u00e4nda WFQ f\u00f6r paket i default-k\u00f6n. Default-k\u00f6n finns alltid och beh\u00f6ver inte konfigureras, d\u00e4r hamnar paket som inte matchar n\u00e5gon class-map. Finns det tomma k\u00f6er kan den bandbredden anv\u00e4ndas av andra klasser s\u00e5l\u00e4nge det inte g\u00e5r fullt. Summan av alla bandbreddsreservationer kan inte \u00f6verstiga 75% av interfacets bandbredd pga max-reserved-bandwidth defaults. Det g\u00e5r ej att kombinera bandwidth och bandwidth percent kommandona i samma policy-map.</p> <p><code>class-map\u00a0match-all\u00a0R2</code> <code>match\u00a0access-group\u00a0name\u00a0R2</code></p> <p><code>policy-map\u00a0CBWFQ</code> <code>class\u00a0R2</code> <code>bandwidth\u00a0percent\u00a05</code> <code>class\u00a0class-default</code></p> <p><code>interface\u00a0Gi\u00a00/1</code> <code>bandwidth\u00a01000</code> <code>service-policy\u00a0output\u00a0CBWFQ</code></p> <p>Verify</p> <p><code>show\u00a0policy-map\u00a0interface</code></p>"},{"location":"cisco/Cisco_QoS/#llq","title":"LLQ","text":"<p>Low Latency Queueing fungerar som CBWFQ men ut\u00f6kar det med priority queues \u00e4ven kallat low-latency queues. Det som behandlas f\u00f6rst \u00e4r paket i prio-k\u00f6erna. LLQ f\u00f6rhindrar \u00e4ven starvation av \u00f6vriga k\u00f6er eftersom den prioriterade k\u00f6ns bandbredd f\u00f6rutom garanterad minimum ocks\u00e5 \u00e4r policed max-bandbredd (vid congestion). Har man flera klasser som \u00e4r prioriterade \u00e4r det FIFO som g\u00e4ller eftersom det endast finns en intern prio-k\u00f6. F\u00f6rdelen med detta \u00e4r att man kan styra s\u00e5 att man kan ha flera prioriterade klasser men ingen kan ta upp all bandbredd. Endast paket inom den konfigurerade bandbredden/procenten kommer att prioriteras men i \u00f6vrigt f\u00e5r fl\u00f6dena anv\u00e4nda all bandbredd, dvs LLQ anv\u00e4nds endast n\u00e4r hardware queues g\u00e5r fulla. Notera att LLQ policern tar h\u00e4nsyn till L2 framesens l\u00e4ngd.</p> <p><code>class-map\u00a0http</code> <code>match\u00a0protocol\u00a0http</code> <code>class-map\u00a0voice</code> <code>match\u00a0protocol\u00a0rtp</code></p> <p><code>policy-map\u00a0VOICE_PRIO</code> <code>class\u00a0http</code> <code>bandwidth\u00a0percent\u00a020</code> <code>class\u00a0voice</code> <code>priority\u00a0percent\u00a050</code></p> <p>Verify</p> <p><code>show\u00a0policy-map\u00a0interface</code></p> <p>"},{"location":"cisco/Cisco_QoS/#ethernet-subinterface","title":"Ethernet Subinterface","text":"<p>Subinterfaces har inget eget s\u00e4tt att veta om det \u00e4r fulla k\u00f6er p\u00e5 huvudinterfacet d\u00e4rf\u00f6r till\u00e5ter inte Cisco IOS att policy-maps med queuing policies appliceras direkt p\u00e5 subinterfacen. Det man kan g\u00f6ra \u00e4r att ha en policy p\u00e5 huvudinterfacet och matcha p\u00e5 vlan-taggningen f\u00f6r att kunna anv\u00e4nda queuing policies p\u00e5 subinterfacen.</p> <p><code>class-map\u00a0match-any\u00a0Server</code> <code>match\u00a0vlan\u00a010</code> <code>class-map\u00a0match-any\u00a0DMZ</code> <code>match\u00a0vlan\u00a020</code></p> <p><code>policy-map\u00a0Vlans</code> <code>class\u00a0Server</code> <code>bandwidth\u00a0percent\u00a020</code> <code>class\u00a0DMZ</code> <code>police\u00a0cir\u00a010000000\u00a0bc\u00a01875000</code></p> <p><code>interface\u00a0GigabitEthernet1</code> <code>no\u00a0ip\u00a0address</code> <code>service-policy\u00a0output\u00a0Vlans</code></p>"},{"location":"cisco/Cisco_QoS/#congestion-avoidance","title":"Congestion Avoidance","text":"<p>N\u00e4r en k\u00f6 \u00e4r full har inte routern plats f\u00f6r paket utan de droppas vilket p\u00e5verkar n\u00e4tverksprestandan. TCP skickar s\u00e5 mycket som m\u00f6jligt tills paket droppas och/eller delay (RTT) \u00f6kar och d\u00e5 s\u00e4nks sending rate lite. N\u00e4r transmit buffer (egress) fylls helt blir det tail drops. Detta f\u00e5r p\u00e5verkan p\u00e5 annan trafik som ocks\u00e5 blir droppad. Global synkronisering uppst\u00e5r n\u00e4r flera TCP-hostar minskar sina \u00f6verf\u00f6ringshastigheter som svar p\u00e5 packet drops f\u00f6r att sedan \u00f6ka sin \u00f6verf\u00f6ringshastigheter igen n\u00e4r tr\u00e4ngseln minskar. F\u00f6r att f\u00f6rhindra trafikspikar som leder till att m\u00e5nga paket droppas hj\u00e4lper det att droppa n\u00e5gra paket n\u00e4r en k\u00f6 b\u00f6rjar bli full f\u00f6r att g\u00f6ra s\u00e5 att TCP-hostar s\u00e4nker sending rate tidigare. Detta \u00f6kar overall throughput. Cisco har utvecklat Weighted Random Early Detection som h\u00e5ller koll p\u00e5 k\u00f6erna och undviker global synchronization. F\u00f6r att avg\u00f6ra n\u00e4r paket ska b\u00f6rja droppas anv\u00e4nds average queue depth som m\u00e4ts mot minimum och maximum queue threshold och agerar sedan utifr\u00e5n det. Ligger average queue depth under minimum droppas ingenting, ligger det mellan minimum och maximum droppas en stigande procent av paketen p\u00e5 random och ligger det \u00f6ver maximum droppas alla nya paket. Eftersom WRED tittar p\u00e5 k\u00f6er m\u00e5ste det konfigureras ihop med en k\u00f6 och alla k\u00f6mekanismer har inte st\u00f6d f\u00f6r WRED.</p> <p>Fysiskt interface (allt blir en FIFO p\u00e5 interfacet)</p> <p><code>interface\u00a0gi0/0</code> <code>random-detect</code></p> <p><code>show\u00a0queueing\u00a0random-detect</code></p> <p>F\u00f6r att sl\u00e5 p\u00e5 WRED i class-default kan man antingen konfigurera en bandbreddsreservation f\u00f6r att g\u00f6ra om klassens k\u00f6 till FIFO och sedan sl\u00e5 RED eller sl\u00e5 p\u00e5 RED med WFQ. D\u00e5 aktiveras RED dropping ist\u00e4llet f\u00f6r Congestive Discard Threshold-based drops.</p>"},{"location":"cisco/Cisco_QoS/#ecn","title":"ECN","text":"<p>TCP Explicit Congestion Notification \u00e4r ett slags till\u00e4gg till WRED som kan anv\u00e4ndas f\u00f6r att signalera att trafikfl\u00f6dena ska sakta ner ist\u00e4llet f\u00f6r att det faktiskt b\u00f6rjar droppas paket. N\u00e4tverket signalerar till TCP flow receiver att man \u00e4r n\u00e4ra att b\u00f6rja droppa paket som d\u00e5 kan reagera p\u00e5 detta, t.ex. signalera till sender att s\u00e4nka sending rate. Detta leder till b\u00e4ttre TCP-prestanda overall j\u00e4mf\u00f6rt med drops som leder till TCP slow start och att paket m\u00e5ste skickas om. TCP ECN fungerar tillsammans med RED genom att byta exceed action fr\u00e5n random drops till ECN marking. Denna marking anv\u00e4nder de tv\u00e5 least-significant bitarna av TOS-byten i IP-headern, se bilden ovan.</p> <p><code>random-detect\u00a0ecn</code></p> <p>IOS anv\u00e4nder inte ECN default, global inst\u00e4llning.</p> <p><code>ip\u00a0tcp\u00a0ecn</code></p>"},{"location":"cisco/Cisco_QoS/#traffic-shaping","title":"Traffic Shaping","text":"<p>Det finns tv\u00e5 s\u00e4tt att begr\u00e4nsa m\u00e4ngden trafik som l\u00e4mnar ett interface, policing och shaping. Traffic shaping f\u00f6rhindrar bit raten p\u00e5 de paket som l\u00e4mnar ett interface fr\u00e5n att \u00f6verstiga konfigurerat v\u00e4rde. Shaping monitors h\u00e5ller koll p\u00e5 det som skickas och om det \u00f6verskrider gr\u00e4nsv\u00e4rde s\u00e5 h\u00e5lls paketen kvar i en shaping queue och sl\u00e4pps iv\u00e4g \u00f6ver tiden f\u00f6r att p\u00e5 s\u00e5 s\u00e4tt ge en viss rate. D\u00e4rf\u00f6r \u00e4r shaping alltid outbound och det har potentialen att utnyttja bandbredden mer effektivt \u00e4n policing f\u00f6r att det blir ett j\u00e4mnare fl\u00f6de p\u00e5 TCP-str\u00f6mmarna. Routrar skickar bits enligt den fysiska kapaciteten/frekvensen p\u00e5 sina interface, f\u00f6r att kunna ha en l\u00e4gre bandbredd m\u00e5ste routern medvetet v\u00e4xla mellan att skicka och att vara tyst. Ett s\u00e5dant tidsinterval kallas Tc och m\u00e4ts i millisekunder. Under Tc f\u00e5r det endast skickas en viss m\u00e4ngd bitar, denna m\u00e4ngd kallas commited burst (Bc). Har man varit tyst ett tag kan man bursta lite extra, denna bitm\u00e4ngd kallas Be (excess burst). I \u00e4ldre IOS-versioner anv\u00e4ndas Generic Traffic Shaping (GTS), det \u00e4r grundl\u00e4ggande och man kan styra vad som ska shapeas med ACL. Det rekommenderade s\u00e4ttet \u00e4r dock att anv\u00e4nda class-based shaping som finns i IOS 15. D\u00e5 skapar man class-maps och policy-maps med MQC vilket ger mer granul\u00e4r kontroll \u00f6ver shaping.</p> <p><code>policy-map\u00a0SHAPE</code> <code>class\u00a0CLASS</code> <code>shape\u00a0average\u00a0500000\u00a0\u00a0#BW</code></p> <p><code>interface\u00a0Gi2</code> <code>service-policy\u00a0output\u00a0SHAPE</code></p> <p>Man kan v\u00e4lja att shapea average, adaptive eller peak.</p> <p>Verify</p> <p><code>show\u00a0policy-map\u00a0interface</code> <code>show\u00a0traffic-shape</code><code>#Legacy</code> <code>show\u00a0traffic-shape\u00a0queue</code></p>"},{"location":"cisco/Cisco_QoS/#policing","title":"Policing","text":"<p>Class-Based Policing \u00e4r en funktion som h\u00e5ller koll p\u00e5 bit raten p\u00e5 interface och om konfigurerat v\u00e4rde \u00f6verskrids kan policing agera, t.ex. s\u00e4tta en viss DSCP/Precedence-markering eller droppa paketen. Det fungerar b\u00e5de ingress och egress p\u00e5 interface och subinterface. Man kan konfigurera en enskild bit rate och paket kommer att kategoriseras som conforming eller exceeding, detta kallas Single-Rate Two-Color Policing. Vill man ha lite utrymme f\u00f6r burst f\u00e5r man s\u00e4tta upp Single-Rate Three-Color Policing och d\u00e5 finns det \u00e4ven en violate-kategori som konfigureras som paket kan hamna i. Detta till\u00e5ter tillf\u00e4lliga bursts och trafikm\u00e4ngden m\u00e5ste g\u00e5 ner f\u00f6r att det ska kunna burstas igen. Vill man till\u00e5ta lite l\u00e4ngre perioder med burst kan man anv\u00e4nda Two-Rate Three-Color Policing, d\u00e5 konfigurerar man \u00e4ven en Peak Information Rate (PIR). Man kan \u00e4ven ta flera aktioner med paketen, t.ex. s\u00e4tta flera olika markeringar, detta kallas multi-action policing.</p> <p><code>ip\u00a0access-list\u00a0extended\u00a0ACL-HTTP</code> <code>permit\u00a0tcp\u00a0any\u00a0any\u00a0eq\u00a0http</code></p> <p><code>class-map\u00a0HTTP</code> <code>match\u00a0ip\u00a0access-list\u00a0ACL-HTTP</code></p> <p><code>policy-map\u00a0POLICE</code> <code>class\u00a0HTTP</code> <code>police\u00a064000\u00a012000\u00a024000\u00a0conform-action\u00a0transmit\u00a0exceed-action\u00a0drop</code> <code>class\u00a0class-default</code> <code>police\u00a0cir\u00a0percent\u00a025\u00a0bc\u00a0500\u00a0ms\u00a0be\u00a0500\u00a0ms\u00a0conform-action\u00a0transmit\u00a0exceed-action\u00a0drop</code></p> <p><code>int\u00a0Gi1</code> <code>service-policy\u00a0input\u00a0POLICE</code></p> <p>Verify</p> <p><code>show\u00a0policy-map\u00a0interface</code></p> <p>Single-Rate Three-Color</p> <p><code>policy-map\u00a0POLICE</code> <code>class\u00a0HTTP</code> <code>police\u00a0cir\u00a064000</code> <code>conform-action\u00a0set-prec-transmit\u00a01</code> <code>exceed-action\u00a0set-prec-transmit\u00a00</code> <code>violate-action\u00a0drop</code></p> <p>Two-Rate Three-Color Detta \u00e4r hierarkisk policing med three color.</p> <p><code>policy-map\u00a0POLICE</code> <code>class\u00a0HTTP</code> <code>police\u00a0cir\u00a064000</code> <code>service-policy\u00a0SUBRATE_POLICER</code></p> <p><code>policy-map\u00a0SUBRATE_POLICER</code> <code>class\u00a0SITE1</code> <code>police\u00a0cir\u00a032000</code> <code>conform-action\u00a0set-prec-transmit\u00a01</code> <code>exceed-action\u00a0set-prec-transmit\u00a00</code> <code>violate-action\u00a0drop</code> <code>class\u00a0SITE2</code> <code>police\u00a0cir\u00a032000</code> <code>conform-action\u00a0set-prec-transmit\u00a01</code> <code>exceed-action\u00a0set-prec-transmit\u00a00</code> <code>violate-action\u00a0drop</code></p> <p>CAR Committed Access Rate \u00e4r ett \u00e4ldre alternativ till CB-Policing som inte anv\u00e4nder MQC-syntax. Det till\u00e5ter burst men endast Single-Rate Two-Color.</p>"},{"location":"cisco/Cisco_QoS/#layer-2-qos","title":"Layer 2 QoS","text":"<p>L2 QoS kan skilja sig mycket mellan switchmodeller eftersom hur QoS fungerar beror p\u00e5 switch-arkitekturen och h\u00e5rdvaran. QoS baseras p\u00e5 intern DSCP som tas ut baserat p\u00e5 den trust configuration som finns. Trust betyder vilka f\u00e4lt som kollas f\u00f6r att f\u00e5 fram internal DSCP f\u00f6r varje paket. Default \u00e4r L2 QoS inte p\u00e5slaget men om man enablear det globalt s\u00e5 kommer internal DSCP tas fr\u00e5n interfacets default CoS som \u00e4r 0 och d\u00e4rmed ta bort eventuell marking. V\u00e4ljer man att lita p\u00e5 CoS s\u00e5 kollas L2-headern i ISL eller det 802.1Q-taggade paketet. Litar man p\u00e5 DSCP eller IP precedence tas QoS-niv\u00e5n ifr\u00e5n L3 headern. Att lita p\u00e5 CoS \u00e4r endast giltigt p\u00e5 trunk-l\u00e4nkar och DSCP/precedence fungerar endast p\u00e5 IP-paket.</p> <p> <p>Global</p> <p><code>mls\u00a0qos</code> <code>mls\u00a0qos\u00a0monitor\u00a0packets</code> <code>ip\u00a0precedence\u00a0to\u00a0dscp\u00a0mapping</code> <code>no\u00a0mls\u00a0qos\u00a0rewrite\u00a0ip\u00a0dscp</code></p> <p>Verify</p> <p><code>show\u00a0mls\u00a0qos\u00a0interface\u00a0g0/3\u00a0statistics</code></p> <p>Switch Database Management, anv\u00e4nds f\u00f6r att dela upp TCAM.</p> <p><code>show\u00a0sdm\u00a0prefer</code></p>"},{"location":"cisco/Cisco_QoS/#catalyst-3560","title":"Catalyst 3560","text":"<p>En Catalyst 3560 switch har k\u00f6er b\u00e5de f\u00f6r input och output. Det finns tv\u00e5 k\u00f6er f\u00f6r input och scheduler anv\u00e4nder Shared Round-Robin (SRR) f\u00f6r att skicka paketen till internal switch fabric. F\u00f6r att best\u00e4mma discard thresholds f\u00f6r varje k\u00f6 anv\u00e4nds Weighted Tail Drop (WTD) n\u00e4r QoS sl\u00e5s p\u00e5. Weight f\u00f6r respektive k\u00f6 \u00e4r konfigurerbart med relativa v\u00e4rden, dvs ratio. Default n\u00e4r man sl\u00e5r p\u00e5 QoS hamnar paket med COS 5 i k\u00f6 2 och \u00f6vrig trafik i k\u00f6 1. K\u00f6 2 har \u00e4ven 10% bandbredd reserverat. N\u00e4r man ska prioritera trafik konfigurerar man den ena k\u00f6n f\u00f6r det. Ingress QoS konfigureras globalt s\u00e5 det g\u00e4ller alla interface.</p> <p><code>mls\u00a0qos\u00a0srr-queue\u00a0input\u00a0priority-queue\u00a02\u00a0bandwidth\u00a030</code></p> <p>K\u00f6 2 kommer att f\u00e5 30% av bandbredden och resterande delas mellan k\u00f6erna.</p> <p><code>show\u00a0mls\u00a0qos\u00a0input-queue</code></p> <p>Man kan dela p\u00e5 resterande bandbredd med en ratio, default \u00e4r 4:4.</p> <p><code>srr-queue\u00a0input\u00a0bandwidth\u00a04\u00a04</code></p> <p>Man kan mappa annan trafik till k\u00f6 2, t.ex. COS 6.</p> <p><code>mls\u00a0qos\u00a0srr-queue\u00a0input\u00a0cos-map\u00a0queue\u00a02\u00a06</code></p> <p>Verify</p> <p><code>show\u00a0mls\u00a0qos\u00a0maps\u00a0cos-input-q</code></p> <p>Egress Cisco 3560 har fyra k\u00f6er f\u00f6r egress per interface och man kan mappa COS/DCSP, anv\u00e4nda weight och s\u00e4tta drop thresholds per k\u00f6. SRR anv\u00e4nds f\u00f6r att undvika queue starvation om man har en prio-k\u00f6. Egress QoS konfigureras per interface med undantag buffers och WTD som g\u00f6rs globalt. Det finns Sharing och Shaping, b\u00e5da fungerar lika bra n\u00e4r det finns paket i alla k\u00f6er och servar eventuell prio-k\u00f6 direkt n\u00e4r Tx \u00e4r ledigt. Men Shaping s\u00e4tter rate-limit p\u00e5 k\u00f6erna s\u00e5 att de inte \u00f6verstiger tilldelad bandbredd.</p> <p>Per interface, ratio mellan fyra k\u00f6er</p> <p><code>interface\u00a0Gi2</code> <code>queue-set\u00a01</code> <code>srr-queue\u00a0bandwidth\u00a0share\u00a0&lt;1&gt;\u00a0&lt;2&gt;\u00a0&lt;3&gt;\u00a0&lt;4&gt;</code> <code>srr-queue\u00a0bandwidth\u00a0shape\u00a0&lt;1&gt;\u00a0&lt;2&gt;\u00a0&lt;3&gt;\u00a0&lt;4&gt;</code> <code>priority-queue\u00a0out</code></p> <p>Buffer och WTD</p> <p><code>mls\u00a0qos\u00a0queue-set\u00a0output\u00a01\u00a0buffers\u00a0&lt;1&gt;\u00a0&lt;2&gt;\u00a0&lt;3&gt;\u00a0&lt;4&gt;</code> <code>mls\u00a0qos\u00a0queue-set\u00a0output\u00a01\u00a0threshold\u00a02\u00a0&lt;1&gt;\u00a0&lt;2&gt;\u00a0&lt;3&gt;\u00a0&lt;4&gt;</code></p> <p>Verify</p> <p><code>show\u00a0mls\u00a0qos\u00a0interface\u00a0Gi2\u00a0queueing</code></p>"},{"location":"cisco/Cisco_QoS/#mpls","title":"MPLS","text":"<p>N\u00e4r man g\u00f6r label imposition \u00e4r default beteende att kopiera IP Precedence till MPLS EXP p\u00e5 alla labels som impose:as. Se \u00e4ven Cisco MPLS.</p>"},{"location":"cisco/Cisco_QoS/#pipe-mode","title":"Pipe mode","text":"<p>I detta mode r\u00f6r inte SP kundens paketm\u00e4rkningar utan policy genom n\u00e4tverket baseras enbart p\u00e5 SP-m\u00e4rkning. Policy enforceas p\u00e5 ingress PE som s\u00e4tter EXP. \u00c4ven policy p\u00e5 edge mot kund baseras p\u00e5 EXP-bitar men kunds m\u00e4rkningar \u00e4r intakta. Kunden f\u00e5r veta hur paket ska m\u00e4rkas f\u00f6r att hamna i de olika klasser/k\u00f6er som SP erbjuder.</p> <p>Ingress PE</p> <p><code>class-map\u00a0match-all\u00a0PREC6</code> <code>match\u00a0ip\u00a0precedence\u00a06</code> <code>!</code> <code>policy-map\u00a0from-ce</code> <code>class\u00a0PREC6</code> <code>set\u00a0mpls\u00a0experimental\u00a0imposition\u00a03</code> <code>!</code> <code>int\u00a0gi2</code> <code>service-policy\u00a0input\u00a0from-ce</code></p> <p>Egress PE</p> <p><code>mpls\u00a0ldp\u00a0explicit-null</code> <code>!</code> <code>class-map\u00a0match-all\u00a0EXP3</code> <code>match\u00a0mpls\u00a0experimental\u00a0topmost\u00a03</code> <code>!</code> <code>policy-map\u00a0from-core</code> <code>class\u00a0EXP3</code> <code>set\u00a0qos-group\u00a03</code> <code>!</code> <code>int\u00a0gi1</code> <code>service-policy\u00a0input\u00a0from-core</code> <code>!</code> <code>class-map\u00a0match-all\u00a0GROUP3</code> <code>match\u00a0qos-group\u00a03</code> <code>!</code> <code>policy-map\u00a0to-ce</code> <code>class\u00a0GROUP3</code> <code>bandwidth\u00a0percent\u00a015</code> <code>!</code> <code>int\u00a0gi2</code> <code>service-policy\u00a0output\u00a0to-ce</code></p>"},{"location":"cisco/Cisco_QoS/#short-pipe-mode","title":"Short Pipe mode","text":"<p>Short pipe mode funkar p\u00e5 samma s\u00e4tt som pipe mode men SP kommer att konfigurera egress policy utifr\u00e5n kundens paketm\u00e4rkningar, dvs DSCP i IP-headern. Eftersom top label EXP marking till egress PE inte beh\u00f6vs kan man k\u00f6ra med default implicit null, PHP.</p> <p>Ingress PE</p> <p><code>class-map\u00a0match-all\u00a0PREC6</code> <code>match\u00a0ip\u00a0precedence\u00a06</code> <code>!</code> <code>policy-map\u00a0from-ce</code> <code>class\u00a0PREC6</code> <code>set\u00a0mpls\u00a0experimental\u00a0imposition\u00a03</code> <code>!</code> <code>int\u00a0gi2</code> <code>service-policy\u00a0input\u00a0from-ce</code></p> <p>Egress PE</p> <p><code>class-map\u00a0match-all\u00a0PREC6</code> <code>match\u00a0ip\u00a0precedence\u00a06</code> <code>!</code> <code>policy-map\u00a0to-ce</code> <code>class\u00a0PREC6</code> <code>bandwidth\u00a0percent\u00a05</code> <code>!</code> <code>int\u00a0gi2</code> <code>service-policy\u00a0output\u00a0to-ce</code></p>"},{"location":"cisco/Cisco_QoS/#uniform-mode","title":"Uniform mode","text":"<p>I detta mode kommer egress PE att kopiera ner EXP till IP-headern innan paketen skickas till CE, dvs corets MPLS-m\u00e4rkning reflekters till IP-paketen. Det betyder att man har en uniform end-to-end qos-policy. Det vanliga \u00e4r att kund m\u00e4rker paket ingress och om det \u00e4ndras n\u00e5nstans l\u00e4ngs MPLS-v\u00e4gen s\u00e5 kommer \u00e4ven IP-paketen p\u00e5 andra sidan ha dessa nya m\u00e4rkningar. Detta mode anv\u00e4nds oftast n\u00e4r man sj\u00e4lv \u00e4ger MPLS-n\u00e4tet.</p> <p>Egress PE</p> <p><code>mpls\u00a0ldp\u00a0explicit-null</code> <code>!</code> <code>class-map\u00a0match-all\u00a0EXP3</code> <code>match\u00a0mpls\u00a0experimental\u00a0topmost\u00a03</code> <code>!</code> <code>policy-map\u00a0from-core</code> <code>class\u00a0EXP3</code> <code>set\u00a0qos-group\u00a03</code> <code>!</code> <code>int\u00a0gi1</code> <code>service-policy\u00a0input\u00a0from-core</code> <code>!</code> <code>class-map\u00a0match-all\u00a0GROUP3</code> <code>match\u00a0qos-group\u00a03</code> <code>!</code> <code>policy-map\u00a0to-ce</code> <code>class\u00a0GROUP3</code> <code>set\u00a0ip\u00a0precedence\u00a03</code> <code>!</code> <code>int\u00a0gi2</code> <code>service-policy\u00a0output\u00a0to-ce</code></p> <p>Ingress PE g\u00f6r inget speciellt.</p>"},{"location":"cisco/Cisco_QoS/#autoqos","title":"AutoQoS","text":"<p>AutoQoS \u00e4r ett macro man kan anv\u00e4nda f\u00f6r att smidigt sl\u00e5 p\u00e5 f\u00f6rdefinierad QoS-konfiguration utifr\u00e5n Ciscos rekommendationer. Man kan anv\u00e4nda det f\u00f6r VoIP och Enterprise. VoIP \u00e4r gjort f\u00f6r video och voice och finns b\u00e5de p\u00e5 routrar och switchar. Man sl\u00e5r p\u00e5 det per interface men det genererar konfiguration b\u00e5de p\u00e5 interface och globalt. P\u00e5 accessportar anv\u00e4nds CDP f\u00f6r att kolla om det finns telefoner och st\u00e4ller d\u00e5 in QoS, finns ingen telefon blir det DSCP 0. P\u00e5 trunkar litas det p\u00e5 DSCP och COS v\u00e4rden som kommer in. Ingress och egress k\u00f6er konfigureras p\u00e5 interfacen samt class-maps och policy-maps enableas. K\u00e4nd trafik som voice, video, real-time, routingprotokoll och BPDUer prioriteras av AutoQoS voip.</p> <p>VoIP</p> <p><code>interface\u00a0Gi0/0</code> <code>auto\u00a0qos\u00a0voip</code></p> <p>Uplink</p> <p><code>auto\u00a0qos\u00a0voip\u00a0trust</code></p> <p>Verify</p> <p><code>show\u00a0auto\u00a0qos\u00a0interface</code> <code>show\u00a0mls\u00a0qos</code></p> <p>Enterprise G\u00e4ller VoIP plus andra applikationer och kr\u00e4ver att interface bandwidth \u00e4r konfigurerat samt att CEF \u00e4r p\u00e5. NBAR anv\u00e4nds f\u00f6r trafikigenk\u00e4nning.</p> <p><code>interface\u00a0Gi0/0</code> <code>auto\u00a0discovery\u00a0qos</code></p> <p>Discovery b\u00f6r st\u00e5 p\u00e5 ett tag s\u00e5 att NBAR hinner samla in information om paketen som g\u00e5r \u00f6ver interfacet. Sedan sl\u00e5r man p\u00e5 QoS och d\u00e5 skapas l\u00e4mpliga class-maps och policy-maps.</p> <p><code>auto\u00a0qos</code></p> <p>Verify</p> <p><code>show\u00a0auto\u00a0discovery\u00a0qos</code> <code>show\u00a0auto\u00a0qos</code></p>"},{"location":"cisco/Cisco_QoS/#nx-os","title":"NX-OS","text":"<p>NX-OS anv\u00e4nder MQC men har ett lite annorlunda QoS-uppl\u00e4gg j\u00e4mf\u00f6rt med IOS. NX-OS sl\u00e5r alltid p\u00e5 en system-defined default queuing policy p\u00e5 varje port och port-channel. QoS-statistik \u00e4r ocks\u00e5 p\u00e5 default.</p> <p>NX-OS har tre typer av QoS.</p> <ul> <li>network qos - Defines the characteristics of QoS properties     network wide.</li> <li>qos - Defines MQC objects that you can use for marking and     policing.</li> <li>queuing - Defines MQC objects that you can use for queuing and     scheduling.</li> </ul> <p>Verify</p> <p><code>show\u00a0policy-map</code> <code>show\u00a0policy-map\u00a0vlan</code> <code>show\u00a0policy-map\u00a0interface\u00a0e1/15\u00a0type\u00a0queuing</code> <code>show\u00a0policy-map\u00a0interface\u00a0e1/15\u00a0type\u00a0qos</code></p> <p>Notera att \"type queuing\" visar L2 MTU och \"type qos\" visar L3 MTU.</p> <p>Shared Policer Med en shared policer kan man ha en policy som g\u00e4ller f\u00f6r flera interface samtidigt.</p> <p><code>qos\u00a0shared-policer\u00a0type\u00a0qos\u00a0POLICE\u00a0cir\u00a04\u00a0gbps\u00a0conform\u00a0transmit\u00a0exceed\u00a0drop</code></p> <p><code>policy-map\u00a0type\u00a0qos\u00a0PMAP</code> <code>class\u00a0type\u00a0qos\u00a0class-default</code> <code>police\u00a0aggregate\u00a0POLICE</code></p> <p><code>show\u00a0qos\u00a0shared-policer\u00a0POLICE</code></p> <p>Network QoS Med en network qos policy kan man konfa pause behavior, congestion control mechanisms, MTU. Man kan \u00e4ven v\u00e4lja vilket protokoll som g\u00e4ller f\u00f6r ett visst CoS-v\u00e4rde, t.ex. FCoE, iSCSI eller TCP. Det anv\u00e4nds sedan i DCB Exchanges. Default f\u00f6r drop CoS s\u00e5 anv\u00e4nds tail drop. Att v\u00e4lja en template med no-drop CoS betyder inte att det automatiskt blir no-drop beteende utan det funkar bara f\u00f6r de CoS-v\u00e4rdena p\u00e5 portar d\u00e4r PFC \u00e4r p\u00e5slaget och successfully negotiated. Att byta network qos policy \u00e4r disruptive. K\u00f6r man med VDC:er s\u00e5 g\u00e5r det endast anv\u00e4nda den i default-VDC:n.</p> <p><code>system\u00a0qos</code> <code>service-policy\u00a0type\u00a0network-qos\u00a0my_template</code></p> <p><code>show\u00a0policy-map\u00a0type\u00a0network-qos</code> <code>show\u00a0policy-map\u00a0system\u00a0type\u00a0network-qos</code></p> <p>Default CoS Man kan ange att frames med CoS 0 ska f\u00e5 en viss CoS-m\u00e4rkning n\u00e4r de kommer in p\u00e5 ett interface.</p> <p><code>interface\u00a0e1/1</code> <code>untagged\u00a0cos\u00a04</code></p> <p>Mutation mapping Mutation mapping \u00e4r ett s\u00e4tt att \u00e4ndra ett QoS-f\u00e4lt i alla paket p\u00e5 ett interface. Notera att p\u00e5 ingress s\u00e5 h\u00e4nder det f\u00f6re traffic classification och alla andra actions. Medans p\u00e5 egress s\u00e5 h\u00e4nder det efter traffic classification men f\u00f6re andra actions. Man kan applicera det p\u00e5 CoS, DSCP och IP precedence f\u00e4lt.</p> <p><code>table-map\u00a0mutate_dscp</code> <code>default\u00a0copy</code> <code>from\u00a00\u00a0to\u00a00</code> <code>from\u00a01\u00a0to\u00a01</code> <code>from\u00a02\u00a0to\u00a01</code> <code>from\u00a063\u00a0to\u00a046</code></p> <p><code>policy-map\u00a0type\u00a0qos\u00a0parent_policy</code> <code>class\u00a0class-default</code> <code>set\u00a0dscp\u00a0dscp\u00a0table\u00a0mutate_dscp</code> <code>service-policy\u00a0type\u00a0qos\u00a0child_qos_policy</code></p> <p>Session Manager Vill man dubbelkolla att QoS-konfen \u00e4r giltig och att det finns tillr\u00e4ckligt med resurser innan man l\u00e4gger det i running kan man dra nytta av session manager.</p> <p><code>configure\u00a0session\u00a0myQoS</code> <code>...</code> <code></code> <code>...</code> <p><code>verify</code> <code>commit\u00a0/\u00a0abort</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_RIP/","title":"Cisco RIP","text":"<p>Routing Information Protocol \u00e4r ett distance vector routing protocol som anv\u00e4nder hop count som metric, det \u00e4r designat f\u00f6r sm\u00e5 n\u00e4tverk. I denna artikel anv\u00e4nds RIP synonymt med RIPv2 (RFC 2453), RIPv1 skickar inte med subnet mask i uppdateringarna och har d\u00e4rmed inte st\u00f6d f\u00f6r VLSM s\u00e5 det \u00e4r v\u00e4ldigt legacy. Varje router kan annonsera sina directly connected networks plus det som de l\u00e4r sig fr\u00e5n andra RIP-routrar. Som med \u00f6vriga distance vector routing protocols p\u00e5 IOS annonseras endast n\u00e4tverk som hamnar i routingtabellen vidare, dvs annonsera endast det som routern sj\u00e4lv anv\u00e4nder. Man skickar k\u00e4nda n\u00e4tverk med deras metric med multicast s\u00e5 alla som lyssnar p\u00e5 224.0.0.9 f\u00e5r uppdateringar. Med tanke p\u00e5 att man inte k\u00e4nner till hela topologin utan endast n\u00e4tverk och riktning \u00e4r det st\u00f6rre risk f\u00f6r loopar \u00e4n med t.ex. link-state routing protokoll. En stor nackdel med RIP \u00e4r konvergenstiden.</p> <p>Type: Distance Vector</p> <p>Algorithm: Bellman-Ford</p> <p>AD: 120</p> <p>Protocols: IP</p> <p>Packets: 2</p>"},{"location":"cisco/Cisco_RIP/#packets","title":"Packets","text":"<p>RIP-routrar byter information med varandra genom att skicka uppdateringar p\u00e5 alla RIP-enableade interface baserat p\u00e5 update timer (30 sec default). Man skickar all information man har varje g\u00e5ng, max 25 route entries f\u00e5r plats per enskilt paket. Det skickas inga Hellos och inga grannskap uppr\u00e4ttas utan uppdateringar skickas till 01:00:5E:00:00:09 224.0.0.9 UDP port 520 var 30 sekund. RIP har tv\u00e5 meddelandetyper, Requests och Responses. Requests anv\u00e4nds f\u00f6r att be en granne skicka en partial eller full update direkt utan att v\u00e4nta p\u00e5 Update timer. Skickar en router en request som inneh\u00e5ller en rad med address family ID 0 och metric 16 vill den ha en full update. Annars ska grannen svara med uppdateringar f\u00f6r de n\u00e4t som st\u00e5r speccade i Requesten, dvs partial update, dock \u00e4r inte partial requests implementerat p\u00e5 IOS. Full update fr\u00e5gas efter n\u00e4r en Ciscorouter bootar upp, ett RIP-interface kommer upp eller clear ip route * k\u00f6rs. CSR:er verkar inte anv\u00e4nda sig av Requests \u00f6verhuvudtaget.</p>   Response packet:    [](/File:Cisco_RIP_Update.PNG \"wikilink\")"},{"location":"cisco/Cisco_RIP/#metric","title":"Metric","text":"<p>F\u00f6r metric anv\u00e4nds hop count och upp till 15 \u00e4r anv\u00e4ndbart, 16 anses som infinity. Som med alla distance vector protokoll anv\u00e4nds den route med l\u00e4gst metric, dvs b\u00e4sta v\u00e4gen, och \u00f6vriga v\u00e4gar p\u00e5verkar inte routingtabellen. Enda undantaget till denna regel \u00e4r om next-hop skickar en h\u00f6gre metric \u00e4n tidigare d\u00e5 accepteras den direkt, t.ex. vid route poisoning. Enda s\u00e4ttet att f\u00e5 p\u00e5verkningsm\u00f6jlighet \u00e4r att annonsera l\u00e4gst metric. Om en route failar kan man skicka ut en triggered update om denna routen med en metric satt till infinity d\u00e5 propagerar uppdateringen till alla routrar och de slutar anv\u00e4nda den failade routen, detta kallas route poisoning. D\u00e4remot sparas routen i den interna RIP-databasen men markeras som possibly down. En skillnad med RIP kontra EIGRP och RIPng \u00e4r att metric l\u00e4ggs p\u00e5 n\u00e4r en route skickas iv\u00e4g ist\u00e4llet f\u00f6r n\u00e4r den kommer in. Finns det flera v\u00e4ger till en destination med samma metric installeras det default upp till 4 routes i routingtabellen. Detta g\u00e5r att \u00e4ndra med maximum-paths-kommandot, max \u00e4r 16.</p>"},{"location":"cisco/Cisco_RIP/#split-horizon","title":"Split Horizon","text":"<p>F\u00f6r att f\u00f6rhindra loopar anv\u00e4nds flera tekniker. Split Horizon, ist\u00e4llet f\u00f6r att skicka exakt alla routes till en granne X tas routes med next-hop granne X bort fr\u00e5n uppdateringen. Detta \u00e4r p\u00e5slaget default p\u00e5 alla interface f\u00f6rutom fysiska Frame Relay och ATM. En \u00e4nnu kraftfullare variant \u00e4r att l\u00e4gga till Poison Reverse, d\u00e5 skickas uppdateringarna med next-hop granne X till granne X men med en metric satt till infinity. Detta har inte Cisco RIPv2 st\u00f6d f\u00f6r.</p> <p>Om tv\u00e5 routrar k\u00e4nner till samma n\u00e4t kommer den som annonserade ut det f\u00f6rst att vara den som g\u00e4ller f\u00f6r \u00f6vriga routrar oavsett hop count eftersom split horizon g\u00f6r att routes man f\u00e5r in p\u00e5 ett interface aldrig annonseras ut p\u00e5 det interfacet. S\u00e5 \u00e4ven om den \"sena\" routern har en b\u00e4ttre v\u00e4g kan den inte ber\u00e4tta det f\u00f6r n\u00e5gon eftersom den har f\u00e5tt in en uppdatering om routen p\u00e5 de interface d\u00e4r det finns RIP-routrar. Secondary addresses kommer inte heller att annonseras om man inte st\u00e4nger av split horizon. Det g\u00e5r att st\u00e4nga av split horizon men det \u00e4r inte rekommenderat. Det kan dock beh\u00f6vas st\u00e4ngas av p\u00e5 DMVPN-hubb.</p> <p><code>no\u00a0ip\u00a0split-horizon</code></p> <p>Om tv\u00e5 routergrannar ser sig sj\u00e4lva som next-hop f\u00f6r samma n\u00e4tverk (kan h\u00e4nda om Split Horizon \u00e4r avst\u00e4ngt) kommer de att turas om att uppdatera varandra med grannens metric plus 1 och den blir h\u00f6gre och h\u00f6gre f\u00f6r att tillslut n\u00e5 infinity och den ena slutar. Med RIP kan detta ta l\u00e5ng tid. Detta kallas Counting to infinity och \u00e4r en m\u00f6jlig konsekvens av distance vector protokoll.</p> <p>Source Validation RIP har en inbyggd kontrollmekanism som kollar p\u00e5 source-adressen p\u00e5 uppdateringarna som kommer in. Detta g\u00e5r att \u00e4ndra s\u00e5 att man kan godta uppdateringar oavsett vilken IP de kommer ifr\u00e5n. F\u00f6ljande RIP-kommando st\u00e4nger av sanity checks against source address of routing updates. Unnumbered IP interfaces har inte denna check.</p> <p><code>no\u00a0validate-update-source</code></p> <p>Route tag Med RIPv2 kom st\u00f6d f\u00f6r route tags, det \u00e4r ett 2 byte integer value som man kan s\u00e4tta p\u00e5 routes f\u00f6r att tagga dem. Route tagging st\u00f6ds endast vid redistribution och anv\u00e4nds om man vill skilja p\u00e5 internal och external routes.</p>"},{"location":"cisco/Cisco_RIP/#konfiguration","title":"Konfiguration","text":"<p>RIP-processen startar inte utan ett network-kommando.</p> <p><code>router\u00a0rip</code> <code>version\u00a02</code> <code>no\u00a0auto-summary</code> <code>distance\u00a0120</code> <code>network\u00a010.0.0.0</code></p> <p>Version per interface</p> <p><code>interface\u00a0gi2</code> <code>ip\u00a0rip\u00a0send\u00a0version\u00a01</code> <code>ip\u00a0rip\u00a0receive\u00a0version\u00a01</code></p> <p>Ett passivt interface skickar inte ut n\u00e5gra uppdateringar men d\u00e4remot tas fortfarande uppdateringar emot och behandlas.</p> <p><code>passive-interface\u00a0default</code> <code>no\u00a0passive-interface\u00a0gi2</code></p> <p>Verify</p> <p><code>show\u00a0ip\u00a0protocols</code> <code>show\u00a0ip\u00a0rip\u00a0database</code></p> <p>Clearing routing process</p> <p><code>clear\u00a0ip\u00a0route\u00a0*</code></p> <p>Debug</p> <p><code>debug\u00a0ip\u00a0ripv2</code> <code>debug\u00a0ip\u00a0ripv2\u00a0events</code></p> <p>Unicast RIP bygger inga grannskap men man kan anv\u00e4nda unicast. Det skickas d\u00e5 dubbla uppdateringar, en till konfigurerad granne med unicast och en till multicast/broadcast som vanligt. Neighbor-kommandot anv\u00e4nds p\u00e5 vissa n\u00e4tverkstyper, t.ex. multipoint Frame Relay subinterface.</p> <p><code>neighbor\u00a010.0.0.10</code></p> <p>Broadcast 255.255.255.255</p> <p><code>interface\u00a0gi2</code> <code>ip\u00a0rip\u00a0v2-broadcast</code></p> <p>Subnet broadcast</p> <p><code>interface\u00a0gi2</code> <code>ip\u00a0broadcast-address\u00a010.0.0.255</code></p>"},{"location":"cisco/Cisco_RIP/#authentication","title":"Authentication","text":"<p>En RIP-router vet om n\u00e5gon annan st\u00f6djer autentisering genom att kolla p\u00e5 AFI-f\u00e4ltet i uppdateringen, 0xFFFF betyder authentication. Det finns st\u00f6d f\u00f6r plain-text och MD5 och implementeras med hj\u00e4lp av key-chain. Ett h\u00f6gre nyckelv\u00e4rde godtar l\u00e4gre nyckelv\u00e4rde om key-string \u00e4r samma men ej tv\u00e4rtom. Anv\u00e4nder man autentisering s\u00e4nks antalet prefix som f\u00e5r plats i ett RIP-meddelande fr\u00e5n 25 till 24. Key chain m\u00e5ste skapas innan det anv\u00e4nds f\u00f6r RIP authentication!</p> <p><code>key\u00a0chain\u00a0RIP-KEYS</code> <code>key\u00a01</code> <code>key-string\u00a0HACKER</code></p> <p><code>interface\u00a0gi2</code> <code>ip\u00a0rip\u00a0authentication\u00a0mode\u00a0md5</code> <code>ip\u00a0rip\u00a0authentication\u00a0key-chain\u00a0RIP-KEYS</code></p> <p>Verifiera vilka interface som anv\u00e4nder vilken key chain</p> <p><code>show\u00a0ip\u00a0protocols\u00a0|\u00a0b\u00a0rip</code></p>"},{"location":"cisco/Cisco_RIP/#convergence","title":"Convergence","text":"<p>Optimization &amp; Scalability</p> <p>Om det ska skickas fler routes \u00e4n vad som f\u00e5r plats i ett Response packet kommer det att skickas flera paket direkt efter varandra. Detta kan \u00f6verbelasta CPU p\u00e5 mindre routrar om det handlar om m\u00e5nga paket. Man kan konfigurera ett tidsintervall mellan paketen f\u00f6r att ta h\u00e4nsyn f\u00f6r detta.</p> <p><code>output-delay</code> <p>Hur m\u00e5nga obehandlade uppdateringar som till\u00e5ts.</p> <p><code>input-queue\u00a0150</code></p> <p>Triggered Updates RIP g\u00e5r att g\u00f6ra till ett event-drivet protokoll (RFC 2091), d\u00e5 skickas en full update en g\u00e5ng f\u00f6rst f\u00f6r att sedan endast skicka partial updates vid f\u00f6r\u00e4ndringar. RIP har st\u00f6d f\u00f6r triggered updates p\u00e5 serial point-to-point interface, dvs om en f\u00f6r\u00e4ndring sker kan en partial update skickas ut direkt. Eftersom RIP anv\u00e4nder UDP g\u00e5r det inte att lita p\u00e5 att exakt alla paket \u00e4r r\u00e4tt. Det konfigureras per interface och shut/noshut f\u00f6r att aktivera.</p> <p><code>ip\u00a0rip\u00a0triggered</code></p> <p>Suppress triggered updates when next regular update due within 10 seconds</p> <p><code>flash-update-threshold\u00a010</code> <code>show\u00a0ip\u00a0protocols\u00a0|\u00a0i\u00a0Flash</code></p> <p>Timers Varje router har f\u00f6r varje route en tillh\u00f6rande invalid after timer (default 180 sekunder) som tickar varje sekund och resetas varje g\u00e5ng den kommer in en uppdatering inneh\u00e5llandes routen. Kommer det inte in n\u00e5gon uppdateringen med routen blir den invalid och holddown timern startar. D\u00e5 b\u00f6rjar routern skicka ut uppdateringar om att denna route inte \u00e4r n\u00e5bar (infinte metric) genom sig sj\u00e4lv eftersom det har h\u00e4nt n\u00e5got med routen ur det egna perspektivet s\u00e5 \u00f6vriga routrar f\u00e5r hitta en annan v\u00e4g. Samtidigt som den inte accepterar n\u00e5gra uppdateringar g\u00e4llandes denna route tills holddown timear ut (default 180 sekunder). Huvudsyftet med holddown \u00e4r f\u00f6rdr\u00f6ja processandet av uppdateringar om n\u00e4tverk vars n\u00e5barhet inte \u00e4r s\u00e4ker eftersom de mottagna uppdateringarna kanske inte inneh\u00e5ller up-to-date information.</p> <p>Det finns ocks\u00e5 en flushed after timer som tickar och resetas p\u00e5 samma s\u00e4tt som invalid after. Om routern inte h\u00f6r n\u00e5got p\u00e5 240 sekunder (default) tas routen bort fr\u00e5n routingtabellen. Denna finns f\u00f6r att en route inte ska vara oviss f\u00f6r evigt. Eftersom invalid after \u00e4r 180 sekunder och flushed after \u00e4r 240 f\u00e5r inte holddown k\u00f6ra klart utan det bryts efter 60 sekunder. Det finns \u00e4ven en sleep timer som avg\u00f6r hur l\u00e4nge en inkommen flash update ska ligga innan routing-infon anv\u00e4nds, denna timer \u00e4r disabled default.</p> <p>Timers g\u00e5r att tuna men det b\u00f6r vara samma \u00f6verallt.</p> <p><code>timers\u00a0basic\u00a010\u00a060\u00a060\u00a080\u00a0100</code> <code>show\u00a0ip\u00a0protocols\u00a0|\u00a0include\u00a0seconds</code></p> <p>Per interface</p> <p><code>ip\u00a0rip\u00a0advertise</code> <p>BFD BFD kan anv\u00e4ndas med RIP unicast.</p> <p><code>router\u00a0rip</code> <code>bfd\u00a0all-interfaces</code> <code>neighbor\u00a01.1.1.1\u00a0bfd</code></p> <p>RIP requires you to be advertising a route other than the transit link for the BFD relationship to establish.</p> <p><code>show\u00a0ip\u00a0rip\u00a0neighbors</code></p>"},{"location":"cisco/Cisco_RIP/#summarization","title":"Summarization","text":"<p>Make RIPv2 classless</p> <p><code>no\u00a0auto-summary</code></p> <p>Eftersom RIP \u00e4r ett distance vector routingprotokoll g\u00f6rs summary per interface. Det m\u00e5ste finnas en mindre specifik route i rib f\u00f6r att summeringen ska annonseras ut. D\u00e4remot installerar inte RIP n\u00e5gon discard route default men man kan manuellt skapa null routes om man vill.</p> <p><code>int\u00a0gi2</code> <code>ip\u00a0summary-address\u00a0rip\u00a010.0.0.0\u00a0255.255.0.0</code></p> <p>no auto-summary beh\u00f6vs ocks\u00e5 f\u00f6r detta.</p>"},{"location":"cisco/Cisco_RIP/#default-route","title":"Default route","text":"<p>Det finns flera olika metoder f\u00f6r att skicka en default route till en granne. Det kr\u00e4vs ingen gateway of last resort f\u00f6r att RIP ska kunna originera en default route.</p> <p><code>int\u00a0gi2</code> <code>ip\u00a0summary-address\u00a0rip\u00a00.0.0.0\u00a00.0.0.0</code></p> <p>Default-information</p> <p><code>router\u00a0rip</code> <code>default-information\u00a0originate</code></p> <p>Static</p> <p><code>ip\u00a0route\u00a00.0.0.0\u00a00.0.0.0\u00a0null\u00a00</code> <code>router\u00a0rip</code> <code>network\u00a00.0.0.0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0#Alt\u00a01</code> <code>redistribute\u00a0static\u00a0\u00a0#Alt\u00a02</code></p> <p>Default-network (deprecated)</p> <p><code>ip\u00a0route\u00a020.0.0.0\u00a0255.0.0.0\u00a0null\u00a00</code> <code>ip\u00a0default-network\u00a020.0.0.0</code></p> <p>Finns det en default route i rib s\u00e5 skickas det ut men metricen m\u00e5ste vara valid f\u00f6r RIP.</p> <p><code>router\u00a0rip</code> <code>default-metric\u00a03</code></p> <p>Conditional Default Routing</p> <p><code>ip\u00a0prefix-list\u00a0TRACK\u00a0seq\u00a05\u00a0permit\u00a01.1.1.1/32</code> <code>route-map\u00a0TRACK_ROUTE\u00a0permit\u00a010</code> <code>match\u00a0ip\u00a0address\u00a0prefix-list\u00a0TRACK</code> <code>router\u00a0rip</code> <code>default-information\u00a0originate\u00a0route-map\u00a0TRACK_ROUTE</code></p>"},{"location":"cisco/Cisco_RIP/#filtering","title":"Filtering","text":"<p>Prefix-list</p> <p><code>router\u00a0rip</code> <code>distribute-list\u00a0gateway\u00a0\u00a0\u00a0\u00a0\u00a0#Filtering\u00a0incoming\u00a0updates\u00a0based\u00a0on\u00a0gateway</code> <code>distribute-list\u00a0prefix\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0#Filter\u00a0prefixes\u00a0in\u00a0routing\u00a0updates</code></p> <p>Exempel, filtrera allt fr\u00e5n en RIP sender.</p> <p><code>ip\u00a0prefix-list\u00a0ROUTERS\u00a0seq\u00a05\u00a0deny\u00a0192.168.0.3/32</code> <code>ip\u00a0prefix-list\u00a0ROUTERS\u00a0seq\u00a010\u00a0permit\u00a00.0.0.0/0\u00a0le\u00a032</code> <code>ip\u00a0prefix-list\u00a0PREFIXLIST\u00a0seq\u00a010\u00a0permit\u00a00.0.0.0/0\u00a0le\u00a032</code></p> <p><code>router\u00a0rip</code> <code>distribute-list\u00a0prefix\u00a0PREFIXLIST\u00a0gateway\u00a0ROUTERS\u00a0in</code></p> <p>ACL Extended ACL tolkas av RIP distribute som:</p> <p><code>access-list\u00a0100\u00a0permit\u00a0ip\u00a0host</code><code>host</code> <p>Exempel</p> <p><code>access-list\u00a0100\u00a0deny\u00a0ip\u00a0host\u00a010.0.0.10\u00a0host\u00a0172.20.0.0</code> <code>access-list\u00a0100\u00a0permit\u00a0ip\u00a0any\u00a0any</code></p> <p><code>router\u00a0rip</code> <code>distribute-list\u00a0100\u00a0in\u00a0Gi2</code></p> <p>Det g\u00e5r \u00e4ven att blockera specifika avs\u00e4ndare med hj\u00e4lp av interface ACL</p> <p><code>access-list\u00a010\u00a0deny\u00a02.2.2.2\u00a00.0.0.0</code> <code>access-list\u00a010\u00a0permit\u00a0any</code></p> <p><code>interface\u00a0gi2</code> <code>ip\u00a0access-group\u00a010\u00a0in</code></p> <p>Offset list L\u00e4gg till 5 p\u00e5 hop count till det som skickas ut p\u00e5 interface Gi2</p> <p><code>router\u00a0rip</code> <code>offset-list\u00a010\u00a0out\u00a05\u00a0Gi2</code> <code>access-list\u00a010\u00a0permit\u00a0any</code></p> <p><code>show\u00a0ip\u00a0protocols\u00a0|\u00a0i\u00a0metric</code></p> <p>offset-list 0 tr\u00e4ffar alla routes</p> <p>Administrative Distance Det g\u00e5r att filtrera routes med hj\u00e4lp av AD. Exempel: filtrera vissa prefix fr\u00e5n en viss granne. AD 255 = UNKNOWN.</p> <p><code>access-list\u00a010\u00a0permit\u00a0192.168.0.0</code> <code>access-list\u00a010\u00a0permit\u00a0172.30.0.0</code></p> <p><code>router\u00a0rip</code> <code>distance\u00a0255\u00a020.0.0.20\u00a00.0.0.0\u00a010</code></p> <p>Filtrera routes som tr\u00e4ffar acl 10 men kan komma fr\u00e5n alla routrar.</p> <p><code>distance\u00a0255\u00a00.0.0.0\u00a0255.255.255.255\u00a010</code></p>"},{"location":"cisco/Cisco_RIP/#redistribution","title":"Redistribution","text":"<p>Med auto-summary p\u00e5slaget redistribueras endast classful networks. RIP har heller ingen seed metric.</p> <p><code>router\u00a0rip</code> <code>no\u00a0auto-summary</code> <code>redistribute\u00a0ospf\u00a01\u00a0metric\u00a03</code></p> <p>Detta s\u00e4tter samma metric p\u00e5 alla routes som redistribueras. Vill man ha \u00f6kad flexibilitet kan man anv\u00e4nda en route-map som matchar routes mot ACLer och s\u00e4tter metric d\u00e4refter. Default-metric anv\u00e4nds som fallback ifall en route inte tr\u00e4ffar route-mapen. T.ex. redistribuerade OSPF E2 routes (cost 20) kommar att ha infinite metric n\u00e4r transparent anv\u00e4nds om man inte manipulerar metricen.</p> <p><code>default-metric\u00a05</code></p> <p>Om man redistribuerar mellan t.ex. RIP och OSPF p\u00e5 flera punkter m\u00e5ste man f\u00f6rhindra suboptimal routing. Ett s\u00e4tt att g\u00f6ra detta \u00e4r genom att flagga redistribuerade routes med h\u00f6gre AD lokalt p\u00e5 redistributionsnoderna. RIP kan inte skilja p\u00e5 internal och external routes s\u00e5 det andra routingprotokollet f\u00e5r l\u00f6sa det.</p> <p><code>router\u00a0ospf\u00a01</code> <code>distance\u00a0ospf\u00a0external\u00a0180</code></p> <p>Man kan ocks\u00e5 tagga routes som blivit redistribuerade f\u00f6r att kunna filtrera bort dem och p\u00e5 s\u00e5 s\u00e4tt undvika routingloop.</p> <p><code>route-map\u00a0TAG</code> <code>set\u00a0tag\u00a0100</code> <code>route-map\u00a0FILTER-TAG\u00a0deny\u00a010</code> <code>match\u00a0tag\u00a0100</code> <code>route-map\u00a0FILTER-TAG\u00a0permit\u00a020</code></p> <p><code>router\u00a0rip</code> <code>redistribute\u00a0ospf\u00a01\u00a0route-map\u00a0TAG</code> <code>distribute-list\u00a0route-map\u00a0FILTER-TAG\u00a0in</code></p>"},{"location":"cisco/Cisco_RIP/#ripng","title":"RIPng","text":"<p>RIP Next Generation \u00e4r RIP f\u00f6r IPv6. \u00c4ven om namnet l\u00e5ter flashigt har inte mycket av de underliggande mekanismerna f\u00f6r\u00e4ndrats \u00e4ven om UDP 521 ist\u00e4llet f\u00f6r 520 nu anv\u00e4nds f\u00f6r att undvika krock med RIPv1/v2. Destinationsaddress f\u00f6r uppdateringarna \u00e4r FF02::9. 15 hop \u00e4r max metric och 16 \u00e4r infinity men d\u00e4remot \u00f6kas metric vid mottagandet av annonsering ist\u00e4llet f\u00f6r skickandet som i tidigare versioner. Allt loopundvikande sker p\u00e5 samma s\u00e4tt. En uppdatering kan inneh\u00e5lla s\u00e5 m\u00e5nga entries som f\u00e5r plats i packetet vars max storlek avg\u00f6rs av IPv6 MTU p\u00e5 l\u00e4nken. RIPng har inte st\u00f6d f\u00f6r autentisering utan precis som med OSPFv3 sk\u00f6ts detta av IPsec, d\u00e4remot har inte Ciscos implementation st\u00f6d f\u00f6r detta. Passive interfaces och static neighbors finns inte heller men nyheter \u00e4r Route Poisoning (ut\u00f6kning av Split Horizon) och multipla RIPng-processer.</p>   Response packet:    [](/File:Cisco_RIPng_Update.png \"wikilink\")"},{"location":"cisco/Cisco_RIP/#konfiguration_1","title":"Konfiguration","text":"<p>Prereq</p> <p><code>ipv6\u00a0unicast-routing</code> <code>ipv6\u00a0cef</code></p> <p>En del features konfigureras under RIP-processen.</p> <p><code>ipv6\u00a0router\u00a0rip\u00a01</code> <code>poison-reverse</code> <code>no\u00a0split-horizon</code> <code>maximum-paths\u00a016\u00a0\u00a0#Max\u00a0\u00e4r\u00a032</code> <code>distance\u00a0120</code></p> <p>S\u00e4tt IP-adresser p\u00e5 interfacen och enablea sedan RIP.</p> <p><code>interface\u00a0gi\u00a00/0</code> <code>ipv6\u00a0address\u00a02001:10:10:10::1/64</code> <code>ipv6\u00a0rip\u00a01\u00a0enable</code></p> <p>Verify</p> <p><code>show\u00a0ipv6\u00a0rip</code> <code>show\u00a0ipv6\u00a0protocols</code> <code>show\u00a0ipv6\u00a0rip\u00a0next-hops</code> <code>debug\u00a0ipv6\u00a0rip\u00a0events</code></p> <p>Annonsera endast default route. Precis som med RIPv2 beh\u00f6ver det inte finnas n\u00e5gon default-route i RIB f\u00f6r att det ska kunna annonseras. Default metric f\u00f6r denna \u00e4r 1.</p> <p><code>interface\u00a0gi2</code> <code>ipv6\u00a0rip\u00a01\u00a0default-information\u00a0only</code></p> <p>Aggregate</p> <p><code>interface\u00a0gi2</code> <code>ipv6\u00a0rip\u00a01\u00a0summary-address\u00a02001:10:10:10::/64</code></p> <p>Filtering</p> <p><code>ipv6\u00a0router\u00a0rip\u00a01</code> <code>distribute-list\u00a0prefix-list\u00a0FILTER\u00a0in</code></p> <p>Sl\u00e5 p\u00e5 VRF-st\u00f6d.</p> <p><code>ipv6\u00a0rip\u00a0vrf-mode\u00a0enable</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_Routing/","title":"Cisco Routing","text":"<p>F\u00f6r dynamiska routingprotokoll se: BGP, OSPF, EIGRP, IS-IS och RIP. Se \u00e4ven: Cisco PfR och Cisco PE-CE.</p>"},{"location":"cisco/Cisco_Routing/#rib","title":"RIB","text":"<p>Kolla routingprocesser som kan populera RIB.</p> <p><code>show\u00a0ip\u00a0protocol\u00a0summary</code></p> <p>IOS har en inbyggd funktion f\u00f6r att profilera RIBen dvs kolla hur mycket som \u00e4ndras i den \u00f6ver tid.</p> <p><code>ip\u00a0route\u00a0profile</code> <code>show\u00a0ip\u00a0route\u00a0profile</code></p> <p>Med debug kan man se det mesta som r\u00f6r routingtabellen. B\u00f6r ej anv\u00e4ndas i produktionsmilj\u00f6er.</p> <p><code>debug\u00a0ip\u00a0routing\u00a0?</code></p>"},{"location":"cisco/Cisco_Routing/#static-routes","title":"Static Routes","text":"<p>Man kan konfigurera statiska routes med b\u00e5de forwarding address och outgoing interface. D\u00e4remot installeras inga recursive static routes default i RIB, detta \u00e4ndras med ip route static install-routes-recurse-via-nexthop.</p> <ul> <li>Next-hop IP: routen \u00e4r giltig s\u00e5l\u00e4nge det finns en route f\u00f6r     next-hop value.</li> <li>Outgoing interface: routen \u00e4r giltig s\u00e5l\u00e4nge som interfacet \u00e4r     UP/UP.</li> <li>Both next-hop value and outgoing interface: routen \u00e4r giltig     s\u00e5l\u00e4nge som next-hop value \u00e4r reachable \u00f6ver det specificerade     interfacet.</li> </ul> <p><code>ip\u00a0route\u00a00.0.0.0\u00a00.0.0.0\u00a0Gi0\u00a010.10.3.4</code></p> <p>Floating</p> <p><code>ip\u00a0route\u00a0172.16.10.0\u00a0255.255.255.0\u00a010.10.20.2</code><code>210</code></p> <p>Verify</p> <p><code>show\u00a0ip\u00a0static\u00a0route</code></p> <p>VRF, default till\u00e5ts static routes att peka p\u00e5 interface i andra VRF:er.</p> <p><code>ip\u00a0route\u00a0static\u00a0inter-vrf</code></p>"},{"location":"cisco/Cisco_Routing/#ipv6","title":"IPv6","text":"<p>EUI-64</p> <p><code>interface\u00a0Gi0</code> <code>ipv6\u00a0address\u00a02001:2:3:4::/64\u00a0eui-64</code></p> <p>ULA Unique Local Address (RFC 4193) \u00e4r motsvarigheten till IPv4 RFC 1918. Adressblocket \u00e4r FC00::/7.</p> <p>Router Advertisments</p> <p><code>interface\u00a0gi2</code> <code>ipv6\u00a0nd\u00a0ra\u00a0lifetime\u00a01800</code> <code>ipv6\u00a0nd\u00a0ra\u00a0interval\u00a0200</code></p> <p>Man kan annonsera prefix med ND RA men hostar f\u00e5r ej anv\u00e4nda det f\u00f6r auto-config.</p> <p><code>ipv6\u00a0nd\u00a0prefix\u00a02000::/64\u00a014400\u00a0no\u00a0auto-config</code></p> <p>OBS RA har AD 1 vilket kan d\u00e4rmed trumfa routingprotokoll.</p> <p>Verify</p> <p><code>show\u00a0ipv6\u00a0interface\u00a0gi2\u00a0prefix</code></p>"},{"location":"cisco/Cisco_Routing/#vrf","title":"VRF","text":"<p>Man kan se VRF:er som virtuella routrar fast med delat management. VRF:er utan MPLS kallas VRF Lite.</p> <p><code>show\u00a0vrf</code> <code>show\u00a0cef\u00a0vrf</code></p> <p>Konfiguration</p> <p><code>vrf\u00a0upgrade-cli\u00a0multi-af-mode\u00a0common-policies</code> <code>show\u00a0vrf\u00a0detail\u00a0|\u00a0i\u00a0CLI</code></p> <p>Kolla vilka interface som tillh\u00f6r vilken vrf.</p> <p><code>show\u00a0ip\u00a0vrf\u00a0interfaces</code></p> <p>Man kan i EXEC mode hoppa mellan vrf:er och kommandon som show ip route visar d\u00e5 den aktuella RIB:en.</p> <p><code>routing-context\u00a0vrf\u00a0Cust-A</code></p> <p>Import/Export Det g\u00e5r att styra vad och vilken community som ska s\u00e4ttas p\u00e5 det som ska importeras och exporteras med hj\u00e4lp av route-maps.</p> <p><code>ip\u00a0prefix-list\u00a0Cust-A_DENY\u00a0seq\u00a05\u00a0permit\u00a0172.20.0.0/24</code></p> <p><code>route-map\u00a0Cust-A_EXPORT\u00a0deny\u00a010</code> <code>match\u00a0ip\u00a0address\u00a0prefix-list\u00a0Cust-A_DENY</code> <code>route-map\u00a0Cust-A_EXPORT\u00a0permit\u00a020</code></p> <p><code>ip\u00a0vrf\u00a0Cust-A</code> <code>export\u00a0map\u00a0Cust-A_EXPORT</code></p> <p>VRF Selection Man kan styra p\u00e5 IP vilken VRF som paket ska hamna i men detta \u00e4r varken skalbart eller smidigt.</p> <p><code>vrf\u00a0selection\u00a0source\u00a0172.16.1.0\u00a0255.255.255.0\u00a0vrf\u00a0VRF1</code> <code>vrf\u00a0selection\u00a0source\u00a00.0.0.0\u00a00.0.0.0\u00a0vrf\u00a0VRF2</code></p> <p><code>interface\u00a0gi2</code> <code>ip\u00a0vrf\u00a0select\u00a0source</code> <code>ip\u00a0vrf\u00a0receive\u00a0VRF1</code> <code>ip\u00a0vrf\u00a0receive\u00a0VRF2</code></p>"},{"location":"cisco/Cisco_Routing/#ip-sla","title":"IP SLA","text":"<p>IP SLA l\u00e5ter en enhet m\u00e4ta och h\u00e5lla koll p\u00e5 response time, latency, jitter, packet loss eller bara connectivity mot en punkt utifr\u00e5n konfigurerbara tr\u00f6skelv\u00e4rden. Enheten kan sedan l\u00e5ta andra processer tracka detta och fatta routingbeslut utifr\u00e5n det. T.ex. om prim\u00e4r WAN gateway g\u00e5r ner sl\u00e5 automatiskt \u00f6ver till sekund\u00e4r gateway. IP SLA kan ocks\u00e5 anv\u00e4nda MD5-autentisering, detta konfigureras med ip sla key-chain.</p> <p><code>ip\u00a0sla\u00a01</code> <code>icmp-echo\u00a0100.0.0.20\u00a0source-interface\u00a0GigabitEthernet1</code> <code>threshold\u00a02000</code> <code>timeout\u00a02000</code> <code>frequency\u00a05</code> <code>ip\u00a0sla\u00a0schedule\u00a01\u00a0life\u00a0forever\u00a0start-time\u00a0now</code></p> <p>Verify</p> <p><code>show\u00a0ip\u00a0sla\u00a01</code> <code>show\u00a0ip\u00a0sla\u00a0configuration</code> <code>show\u00a0ip\u00a0sla\u00a0statistics</code></p>"},{"location":"cisco/Cisco_Routing/#tracking","title":"Tracking","text":"<p>F\u00f6r att andra processer ska kunna utnyttja IP SLA binder man IP SLA-objekten via tracking-processen. Tracking kan g\u00f6ras med CDP och IP SLA och polling interval g\u00e5r att konfigurera globalt med track timer. Tracking kan t.ex. anv\u00e4ndas av HSRP.</p> <p>Object Tracking</p> <ul> <li>Interface IP or line-protocol: Track either the line-protocol     (up/down) or the presence of an IP address.</li> <li>IP route: Track a route present in the routing table.</li> <li>IP SLA: Track an IP SLA object.</li> </ul> <p>Man kan \u00e4ven anv\u00e4nda en lista f\u00f6r att kombinera flera track objects baserat p\u00e5 vikt/procent eller boolean AND/OR.</p> <p><code>track\u00a010\u00a0ip\u00a0sla\u00a01\u00a0state</code> <code>ip\u00a0route\u00a00.0.0.0\u00a00.0.0.0\u00a010.10.10.2\u00a0track\u00a010</code></p> <p>Verify</p> <p><code>show\u00a0ip\u00a0route\u00a0track-table</code> <code>show\u00a0track\u00a0timers</code> <code>show\u00a0track\u00a0brief</code> <code>show\u00a0track\u00a0resolution</code> <code>debug\u00a0track</code></p>"},{"location":"cisco/Cisco_Routing/#pbr","title":"PBR","text":"<p>Policy routing l\u00e5ter routern forwardera trafik baserat p\u00e5 konfigurerbara kriterier utan att anv\u00e4nda routingtabellen. Om trafik inte tr\u00e4ffas av n\u00e5gon entry i route-map anv\u00e4nds routingtabellen som vanligt. Vill man ha drop-beteende med PBR kan man anv\u00e4nda set interface Null0.</p> <p>PBR prioriterar set-kommandona i f\u00f6ljande ordning:</p> <ol> <li>Next-hop</li> <li>Next-hop recursive</li> <li>Interface</li> <li>Default next-hop</li> <li>Default interface</li> </ol> <p>Konfigurationsexempel</p> <p><code>access-list\u00a01\u00a0permit\u00a0192.168.1.10</code> <code>access-list\u00a02\u00a0permit\u00a0192.168.1.20</code></p> <p><code>route-map\u00a0TEST\u00a0permit\u00a010</code> <code>match\u00a0ip\u00a0address\u00a01</code> <code>set\u00a0ip\u00a0next-hop\u00a010.10.10.2</code> <code>route-map\u00a0TEST\u00a0permit\u00a020</code> <code>match\u00a0ip\u00a0address\u00a02</code> <code>set\u00a0ip\u00a0next-hop\u00a010.10.10.60</code></p> <p><code>interface\u00a0Gi0/0</code> <code>ip\u00a0policy\u00a0route-map\u00a0TEST</code></p> <p><code>show\u00a0ip\u00a0policy</code></p> <p>Recursive PBR Recursive Next Hop feature l\u00e5ter route-maps konfigureras med next-hops som inte \u00e4r directly reachable via n\u00e5got interface. Dessa installeras d\u00e5 i routingtabellen och g\u00f6r att man kan dra nytta av CEF load sharing. Om next-hop IP inte \u00e4r m\u00f6jlig att resolva s\u00e5 g\u00e5r paketen p\u00e5 default routen. Med IPv6 fungerar det men st\u00f6djer ej load sharing.</p> <p><code>set\u00a0ip\u00a0next-hop\u00a0recursive\u00a010.10.10.2</code></p> <p>Default Det g\u00e5r \u00e4ndra endast default next-hop (eller interface) f\u00f6r det som matchas av en route-map. D\u00e5 kommer routingtabellen kollas som vanligt f\u00f6rutom att gateway of last resort inte kommer att anv\u00e4ndas.</p> <p><code>route-map\u00a0TEST\u00a0permit\u00a010</code> <code>match\u00a0ip\u00a0address\u00a01</code> <code>set\u00a0ip\u00a0default\u00a0next-hop\u00a010.0.0.10</code></p> <p>VRF Man kan med hj\u00e4lp av en route-map ta in viss trafik i en annan vrf \u00e4n det som interfacet tillh\u00f6r. De kommandon som s\u00e4tter vrf-tillh\u00f6righet har f\u00f6retr\u00e4de \u00f6ver de andra set interface, next-hop etc.</p> <p><code>route-map\u00a0VRF\u00a0permit\u00a010</code> <code>match\u00a0ip\u00a0address\u00a010</code> <code>set\u00a0ip\u00a0vrf</code> <p>Continue Vanligtvis \u00e4r en route-map first match only men vill man \u00e4ndra det kan man anv\u00e4nda continue f\u00f6r att hoppa vidare till n\u00e4sta entry.</p> <p><code>route-map\u00a0TEST\u00a0permit\u00a010</code> <code>set\u00a0metric\u00a0150</code> <code>continue</code> <code>route-map\u00a0TEST\u00a0permit\u00a020</code> <code>match\u00a0ip\u00a0address\u00a01</code> <code>set\u00a0ip\u00a0next-hop\u00a010.10.10.2</code></p> <p>OBS funkar inte med redistribution.</p>"},{"location":"cisco/Cisco_Routing/#local-policy-routing","title":"Local Policy Routing","text":"<p>LPR p\u00e5verkar trafik genererad av routern sj\u00e4lv och konfigureras globalt.</p> <p><code>ip\u00a0local\u00a0policy\u00a0route-map\u00a0ROUTE-MAP</code> <code>show\u00a0ip\u00a0local\u00a0policy</code></p>"},{"location":"cisco/Cisco_Routing/#reliable-pbr","title":"Reliable PBR","text":"<p>IP SLA och Enhanced Object Tracking</p> <p><code>route-map\u00a0POLICY_ROUTING\u00a0permit\u00a010</code> <code>set\u00a0ip\u00a0next-hop\u00a0verify-availability\u00a0100.0.1.5\u00a01\u00a0track\u00a01</code></p> <p>CDP, reachability verifieras genom att kolla att det finns n\u00e5gon CDP-granne som har 100.0.1.5. Detta g\u00e5r ocks\u00e5 att anv\u00e4nda ihop med set ip default next-hop. Alla kommandon som \u00e4ndrar routing programmeras i h\u00e5rdvara utom set ip next-hop verify availability eftersom CDP-info ej finns i linecards.</p> <p><code>route-map\u00a0POLICY_ROUTING\u00a0permit\u00a020</code> <code>set\u00a0ip\u00a0next-hop\u00a0100.0.1.5</code> <code>set\u00a0ip\u00a0next-hop\u00a0verify-availability</code></p>"},{"location":"cisco/Cisco_Routing/#others","title":"Others","text":"<p>On-demand routing ODR \u00e4r ett slags simpelt routingprotokoll som har administrative distance 160. Det anv\u00e4nder CDP som b\u00e4rare f\u00f6r uppdateringarna s\u00e5 fungerande CDP \u00e4r ett prereq. ODR har st\u00f6d f\u00f6r det grundl\u00e4ggande som filtrering, redistribution, timers och passiva interface. Inga \u00e4ndra routingprotokoll b\u00f6r k\u00f6ras.</p> <p><code>router\u00a0odr</code> <code>network\u00a00.0.0.0</code></p> <p>Verify</p> <p><code>show\u00a0ip\u00a0protocols</code> <code>show\u00a0ip\u00a0route\u00a0odr</code></p> <p>Backup Interface Det prim\u00e4ra interfacet b\u00f6r vara ett point-to-point interface annars kan inte up/down status avg\u00f6ras. Backup interfacet f\u00e5r ej vara ett subinterface eftersom dess state avg\u00f6rs av main interfacet.</p> <p><code>interface\u00a0gi2</code> <code>backup\u00a0interface\u00a0gi4</code> <code>backup\u00a0delay\u00a03\u00a060</code></p> <p>Verify</p> <p><code>show\u00a0backup</code></p> <p>IRDP En router kan hitta en gateway router med hj\u00e4lp av ICMP Router Discovery Protocol. IRDP skickar ut ICMP Router Advertisement (ICMP type 9 packets) p\u00e5 subn\u00e4tet f\u00f6r att informera om att det finns en potentiell gateway. Detta funkar endast om IP routing och proxy ARP \u00e4r avslaget p\u00e5 enheterna som tar emot ICMP RA.</p> <p><code>ip\u00a0subnet-zero</code> <code>show\u00a0ip\u00a0irdp</code></p> <p>IP Event Dampening</p> <p><code>interface\u00a0gi2</code> <code>dampening\u00a030</code> <code>show\u00a0dampening</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_SNMP/","title":"Cisco SNMP","text":"<p>Simple Network Management Protocol \u00e4r ett protokoll definierat av IETF som anv\u00e4nds f\u00f6r att \u00f6vervaka och hantera n\u00e4tverk baserade p\u00e5 TCP/IP. En SNMP-agent \u00e4r en router eller en switch med information som kan fr\u00e5gas om med SNMP. Vilken typ av information som h\u00e5lls av enheten kallas en MIB (Management Information Base), SNMP Object Navigator. SNMPv1 does not support 64 bit counters, only 32 bit counters.</p>"},{"location":"cisco/Cisco_SNMP/#konfiguration","title":"Konfiguration","text":"<p><code>snmp-server\u00a0contact\u00a0Admin</code> <code>snmp-server\u00a0location\u00a0Molnet</code> <code>snmp-server\u00a0community\u00a0Hackernet</code></p> <p><code>show\u00a0snmp</code> <code>show\u00a0snmp\u00a0community</code></p> <p>Maintain ifindex values across reboots. Detta kommando hette tidigare snmp-server ifindex persist. Det g\u00e5r \u00e4ven att g\u00f6ra per interface.</p> <p><code>snmp\u00a0ifmib\u00a0ifindex\u00a0persist</code> <code>show\u00a0snmp\u00a0mib\u00a0ifmib\u00a0ifindex</code></p>"},{"location":"cisco/Cisco_SNMP/#access-control","title":"Access control","text":"<p>Vitlista de som ska f\u00e5 prata SNMP.</p> <p><code>access-list\u00a010\u00a0permit\u00a0172.16.0.0\u00a00.0.0.255</code> <code>access-list\u00a010\u00a0deny\u00a0any\u00a0log</code></p> <p><code>snmp-server\u00a0community\u00a0PUBLIC\u00a0ro\u00a010</code></p>"},{"location":"cisco/Cisco_SNMP/#views","title":"Views","text":"<p>Med views kan man begr\u00e4nsa vad som f\u00e5r fr\u00e5gas om, t.ex. endast vissa MIB subtree. Man kan specificera object name eller OID. Exempel: alla Cisco-MIBar utom de EIGRP-relaterade.</p> <p><code>snmp-server\u00a0view\u00a0CISCO\u00a0cisco\u00a0included</code> <code>snmp-server\u00a0view\u00a0CISCO\u00a0ciscoEigrpMIB\u00a0excluded</code></p> <p>Users och communities g\u00e5r att binda till views.</p> <p><code>snmp-server\u00a0community\u00a0PUBLIC\u00a0view\u00a0CISCO</code></p> <p>Verify</p> <p><code>show\u00a0snmp\u00a0view</code></p>"},{"location":"cisco/Cisco_SNMP/#traps","title":"Traps","text":"<p>SNMP Traps skickas default till UDP 162.</p> <p><code>snmp-server\u00a0enable\u00a0traps</code> <code>snmp-server\u00a0host\u00a010.0.0.10\u00a0traps\u00a0v2c-community/v3-username</code> <code>show\u00a0snmp\u00a0host</code></p> <p>Det g\u00e5r att skicka traps vid t.ex. linkup och down p\u00e5 interface.</p> <p><code>snmp-server\u00a0enable\u00a0traps\u00a0snmp\u00a0linkup\u00a0linkdown</code></p> <p>Per interface</p> <p><code>int\u00a0gi2</code> <code>snmp\u00a0trap\u00a0link-status\u00a0permit\u00a0duplicates</code> <code>snmp\u00a0trap\u00a0ip\u00a0verify\u00a0drop-rate</code></p> <p>Det g\u00e5r att skicka traps med Syslog. F\u00f6rst skickas det lokalt till en speciell history buffer och sedan replikerar SNMP agenten det till traps.</p> <p><code>snmp-server\u00a0enable\u00a0traps\u00a0syslog</code></p>"},{"location":"cisco/Cisco_SNMP/#snmpv3","title":"SNMPv3","text":"<p>Den stora skillnaden med SNMPv3 kontra tidigare varianter \u00e4r s\u00e4kerheten. Med version 3 kan b\u00e5de autentisering och kryptering anv\u00e4ndas.</p> <ul> <li>noauth: no auth, no enrypt</li> <li>auth: auth, no enrypt</li> <li>priv: auth, enrypt</li> </ul> <p>Skapa grupp f\u00f6r version 3. Grupper definierar access rights f\u00f6r users till MIBar genom att kopplas till MIB views.</p> <p><code>snmp-server\u00a0group\u00a0v3GROUP\u00a0v3\u00a0priv</code> <code>show\u00a0snmp\u00a0group</code></p> <p>Skapa user, detta sparas ej i runnning conf. SNMPv3 user passwords hashas utifr\u00e5n local Engine-ID.</p> <p><code>snmp-server\u00a0user\u00a0SNMPUSER\u00a0v3GROUP\u00a0v3\u00a0auth\u00a0sha\u00a0SECRETKEY\u00a0priv\u00a0aes\u00a0128\u00a0SECRETKEY</code> <code>show\u00a0snmp\u00a0user</code></p>"},{"location":"cisco/Cisco_SNMP/#nx-os","title":"NX-OS","text":"<p>NX-OS har inte st\u00f6d f\u00f6r SNMPv3 noAuthNoPriv security level.</p> <p>Privacy, enforces message encryption f\u00f6r alla users.</p> <p><code>snmp-server\u00a0globalEnforcePriv</code></p> <p>Skapa user</p> <p><code>snmp-server\u00a0user\u00a0SNMPUSER\u00a0network-operator\u00a0auth\u00a0sha\u00a0SECRETKEY\u00a0priv\u00a0aes-128\u00a0SEVRETKEY</code> <code>show\u00a0snmp\u00a0user</code></p> <p>VRF</p> <p><code>snmp-server\u00a0host\u00a010.1.2.4\u00a0use-vrf\u00a0management</code></p> <p>Traps</p> <p><code>snmp-server\u00a0host\u00a010.1.2.4\u00a0traps\u00a0version\u00a03\u00a0priv\u00a0SNMPUSER</code></p> <p>Man kan kolla vilka interface som anv\u00e4nds som source f\u00f6r SNMP-paket.</p> <p><code>show\u00a0snmp\u00a0source-interface</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_SPAN/","title":"Cisco SPAN","text":"<p>Switch Port Analyzer \u00e4r Ciscos namn p\u00e5 att spegla trafik, antingen mellan portar p\u00e5 samma switch eller till en remote switch. Alla typer av portar kan speglas. SPAN best\u00e5r av source (portar eller VLAN) och destination port/ar. Med RSPAN fungerar source p\u00e5 samma s\u00e4tt men destination port finns p\u00e5 en annan switch s\u00e5 det skickas i ett RSPAN VLAN till den andra switchen. ERSPAN (Encapsulated Remote SPAN) \u00e4r samma som RSPAN men att det kapslas in med GRE s\u00e5 att det kan routas till en annan switch. Man kan \u00e4ven ha Wireshark som endpoint f\u00f6r GRE-tunneln. Man kan v\u00e4lja om rx, tx eller att b\u00e5de och ska speglas, default \u00e4r all rx och tx med undantag vissa control plane frames (t.ex. CDP, BPDU, VTP, DTP, PAgP). SPAN ligger f\u00f6re trafikmodifikation f\u00f6r receive, t.ex. VACL, QoS och ingress policing. F\u00f6r tx ligger det efter s\u00e5 med andra ord SPAN h\u00e4nder l\u00e4ngst ut. P\u00e5 vissa low-end switchar m\u00e5ste man l\u00e5na en asic fr\u00e5n en oanv\u00e4nd port f\u00f6r att switchen ska kunna spegla trafik.</p> <p>Begr\u00e4nsningar</p> <ul> <li>All konfigurationen p\u00e5 en port inaktiveras n\u00e4r den blir konfad som     destination port f\u00f6r SPAN. Inklusive     EtherChannel.</li> <li>Destination port har inte st\u00f6d f\u00f6r     802.1x, Private     VLAN,     CDP, STP,     VTP, DTP,     etc.</li> <li>Som source g\u00e5r det ej att mixa portar och VLAN.</li> <li>Destinationporten \u00e4r best effort, dvs \u00f6verfl\u00f6d sl\u00e4ngs.</li> <li>Endast en SPAN-session kan skicka trafik till en destination port.</li> </ul>"},{"location":"cisco/Cisco_SPAN/#span","title":"SPAN","text":"<p><code>monitor\u00a0session\u00a01\u00a0source\u00a0interface\u00a0fa0/2\u00a0rx</code> <code>monitor\u00a0session\u00a01\u00a0source\u00a0interface\u00a0fa0/3\u00a0both</code> <code>monitor\u00a0session\u00a01\u00a0destination\u00a0interface\u00a0fa0/10\u00a0encapsulation\u00a0replicate</code></p> <p>Encapsulation replicate g\u00f6r att exakt alla frames speglas.</p> <p><code>monitor\u00a0session\u00a01\u00a0filter\u00a0vlan\u00a02\u00a0-\u00a05</code></p> <p>Speglar man en trunkport kan man filtrera s\u00e5 att endast vissa VLAN speglas.</p> <p>Verify</p> <p><code>show\u00a0monitor\u00a0session\u00a01</code> <code>show\u00a0platform\u00a0software\u00a0monitor\u00a0session\u00a01</code></p> <p>NX-OS Destination</p> <p><code>interface\u00a0Ethernet1/1</code> <code>description\u00a0MONITOR-SESSION-1</code> <code>switchport</code> <code>switchport\u00a0monitor</code> <code>no\u00a0shutdown</code></p> <p>Monitor session</p> <p><code>monitor\u00a0session\u00a01</code> <code>description\u00a0SPAN-to-SERVER</code> <code>source\u00a0vlan\u00a010-20\u00a0both</code> <code>rate-limit\u00a0auto</code> <code>destination\u00a0interface\u00a0Ethernet1/1</code> <code>no\u00a0shut</code></p>"},{"location":"cisco/Cisco_SPAN/#rspan","title":"RSPAN","text":"<p>Skapa RSPAN VLAN p\u00e5 alla switchar. RSPAN vlan st\u00e4nger av mac learning och allt som kommer in floodas till alla portar som \u00e4r konfigurerade som destination.</p> <p><code>vlan\u00a0999</code> <code>name\u00a0RSPAN</code> <code>remote\u00a0span</code> <code>exit</code></p> <p>Source</p> <p><code>monitor\u00a0session\u00a01\u00a0source\u00a0interface\u00a0fa0/3\u00a0both</code> <code>monitor\u00a0session\u00a01\u00a0destination\u00a0remote\u00a0vlan\u00a0999</code></p> <p>Switch 2</p> <p><code>monitor\u00a0session\u00a01\u00a0source\u00a0remote\u00a0vlan\u00a0999</code> <code>monitor\u00a0session\u00a01\u00a0destination\u00a0interface\u00a0gi0/8</code></p> <p>Verify</p> <p><code>show\u00a0monitor\u00a0session\u00a01</code> <code>show\u00a0vlan\u00a0remote-span</code></p>"},{"location":"cisco/Cisco_SPAN/#erspan","title":"ERSPAN","text":"<p>ERSPAN finns i tv\u00e5 versioner. I version 1 (type II) anv\u00e4nds en ERSPAN header innan GRE-enkapsuleringen. Den inneh\u00e5ller metadata om sessions id och speglade VLAN. I version 2 (type III) \u00e4r headern st\u00f6rre vilket ger mer flexibilitet, t.ex. finns det \u00e4ven plats f\u00f6r info om performance och latency analysis. PTP timestamp information anv\u00e4nds f\u00f6r att r\u00e4kna ut packet latency \u00f6ver edge, aggregate och core switches. De skiljs \u00e5t med hj\u00e4lp av GRE Protocol Type value, 0x88BE och 0x22EB.</p> <p>Source</p> <p><code>monitor\u00a0session\u00a01\u00a0type\u00a0erspan-source</code> <code>source\u00a0interface\u00a0gi0/1\u00a0both</code> <code>no\u00a0shut</code> <code>destination</code> <code>erspan-id\u00a0101</code> <code>ip\u00a0address\u00a010.0.0.20</code> <code>origin\u00a0ip\u00a0address\u00a0172.20.0.10</code></p> <p>Destination</p> <p><code>monitor\u00a0session\u00a01\u00a0type\u00a0erspan-destination</code> <code>destination\u00a0interface\u00a0gi0/2</code> <code>no\u00a0shut</code> <code>source</code> <code>erspan-id\u00a0101</code> <code>ip\u00a0address\u00a010.0.0.20</code></p> <p>Verify</p> <p><code>show\u00a0monitor\u00a0session\u00a01</code> <code>show\u00a0capability\u00a0feature\u00a0monitor\u00a0erspan-source</code> <code>show\u00a0capability\u00a0feature\u00a0monitor\u00a0erspan-destination</code></p> <p>NX-OS</p> <p><code>monitor\u00a0erspan\u00a0origin\u00a0ip-address\u00a010.1.2.1</code> <code>monitor\u00a0session\u00a01\u00a0type\u00a0erspan-source</code> <code>description\u00a0ERSPAN\u00a0direct\u00a0to\u00a0Sniffer\u00a0PC</code> <code>erspan-id\u00a032\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0#\u00a0required,\u00a0#\u00a0between\u00a01-1023</code> <code>vrf\u00a0default\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0#\u00a0required</code> <code>destination\u00a0ip\u00a010.1.2.3\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0#\u00a0IP\u00a0address\u00a0of\u00a0Sniffer\u00a0PC</code> <code>source\u00a0interface\u00a0port-channel1\u00a0both\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0#\u00a0Port(s)\u00a0to\u00a0be\u00a0sniffed</code> <code>filter\u00a0vlan\u00a03900\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0#\u00a0limit\u00a0VLAN(s)\u00a0(optional)</code> <code>no\u00a0shut\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0#\u00a0enable</code></p> <p>Verify</p> <p><code>show\u00a0monitor\u00a0session\u00a0all</code></p>"},{"location":"cisco/Cisco_SPAN/#embedded-packet-capture","title":"Embedded Packet Capture","text":"<p>P\u00e5 vissa enheter g\u00e5r det att g\u00f6ra en lokal packet capture. Man kan f\u00e5nga paket i b\u00e5da riktningen p\u00e5 ett interface samt begr\u00e4nsa s\u00e5 att inte allt f\u00e5ngas. Man kan s\u00e5klart ha en permit ip any any acl men n\u00e5got slags filter m\u00e5ste konfigureras. Detta \u00e4r IOS-XE syntax.</p> <p><code>ip\u00a0access-list\u00a0extended\u00a0CAPTURE</code> <code>permit\u00a0udp\u00a0host\u00a0172.17.0.13\u00a0host\u00a0172.16.0.14\u00a0eq\u00a053</code> <code>permit\u00a0udp\u00a0host\u00a0172.16.0.14\u00a0host\u00a0172.17.0.13\u00a0eq\u00a053</code></p> <p><code>monitor\u00a0capture\u00a01\u00a0access-list\u00a0CAPTURE\u00a0interface\u00a0g0/0\u00a0both</code></p> <p>Start / Stop / Clean up</p> <p><code>monitor\u00a0capture\u00a01\u00a0start</code> <code>monitor\u00a0capture\u00a01\u00a0stop</code> <code>no\u00a0monitor\u00a0capture\u00a01</code></p> <p>Show</p> <p><code>show\u00a0mon\u00a0cap\u00a01\u00a0buffer\u00a0brief</code> <code>show\u00a0mon\u00a0cap\u00a01\u00a0parameter</code></p>"},{"location":"cisco/Cisco_SPAN/#ethanalyzer","title":"Ethanalyzer","text":"<p>Ethanalyzer \u00e4r ett protocol analyzer-verktyg f\u00f6r NX-OS. Det \u00e4r en CLI-variant av Wireshark med st\u00f6d f\u00f6r filter.</p> <ul> <li>capture-filter: tcpdump capture filter syntax</li> <li>display-filter: wireshark display filter syntax</li> </ul> <p>Exempel: titta p\u00e5 trafik till och fr\u00e5n supervisor p\u00e5 mgmt-interface.</p> <p><code>ethanalyzer\u00a0local\u00a0interface\u00a0mgmt</code> <code>ethanalyzer\u00a0local\u00a0interface\u00a0mgmt\u00a0capture-filter\u00a0\"host\u00a010.0.0.10\"\u00a0limit-captured-frames\u00a050\u00a0write\u00a0bootflash:CAP_MGMT.pcap</code></p> <p>Man kan inte se trafik som g\u00e5r i h\u00e5rdvaran (ASIC) men man kan anv\u00e4nda en ACL med log option som workaround.</p> <p><code>ip\u00a0access-list\u00a0ACL-CAP</code> <code>permit\u00a0tcp\u00a010.0.0.3/32\u00a010.0.0.10/32\u00a0eq\u00a05000\u00a0log</code> <code>permit\u00a0ip\u00a0any\u00a0any</code> <code>interface\u00a0e1/1</code> <code>ip\u00a0access-group\u00a0ACL-CAP\u00a0in</code></p> <p><code>ethanalyzer\u00a0local\u00a0interface\u00a0inband\u00a0capture-filter\u00a0\u201ctcp\u00a0port\u00a05000\u201d</code></p> <p>En annan mer kraftfull workaround man kan g\u00f6ra \u00e4r att spegla trafik fr\u00e5n ASIC (cloud scale) till CPU och sedan anv\u00e4nda ethanalyzer.</p> <p><code>monitor\u00a0session\u00a01</code> <code>source\u00a0interface\u00a0e1/15</code> <code>destination\u00a0interface\u00a0sup-eth\u00a00</code> <code>no\u00a0shut</code></p> <p><code>ethanalyzer\u00a0local\u00a0interface\u00a0inband\u00a0mirror\u00a0limit-captured-frames\u00a050</code></p>"},{"location":"cisco/Cisco_SPAN/#rite","title":"RITE","text":"<p>P\u00e5 routrar heter SPANs motsvarighet Router IP Traffic Export och man anger en mac-adress man vill skicka paketen till, det skulle t.ex. kunna vara en IDS. Man kan matcha det man vill ska skickas mot en acl och man kan sampla.</p> <p><code>ip\u00a0traffic-export\u00a0profile\u00a0IDS</code> <code>interface\u00a0Gi0/0</code> <code>mac-address\u00a00123.0005.abcd</code> <code>incoming\u00a0sample\u00a0one-in-every\u00a05</code> <code>interface\u00a0Gi0/2</code> <code>ip\u00a0traffic-export\u00a0apply\u00a0IDS</code></p> <p>Show</p> <p><code>show\u00a0ip\u00a0traffic-export</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_SR/","title":"Cisco SR","text":"<p>Segment Routing (SR) \u00e4r ett flexibelt och skalbart s\u00e4tt att g\u00f6ra source routing, det \u00e4r inget routingprotokoll utan ett koncept. Den f\u00f6rsta noden v\u00e4ljer path och kodar det i packet header genom en ordnad lista av \"segment\". Det g\u00e5r att anv\u00e4nda MPLS data plane (labels) eller IPv6 data plane (header extensions), denna artikel fokuserar p\u00e5 MPLS. Segment Routing integrerar med dom multi-service capabilities som finns med MPLS, inklusive L3VPN, VPWS, VPLS och EVPN.</p> <p>Segment representerar subpaths som en router kan kombinera f\u00f6r att f\u00e5 fram en komplett route till destination. Varje segment har en identifier (Segment Identifier) som distribueras genom n\u00e4tverket med hj\u00e4lp av extensions till IGP (IS-IS/OSPF). Segment routing till\u00e5ter d\u00e4rmed att man v\u00e4ljer hela pathen fr\u00e5n ingress port till egress port utan att f\u00f6rlita sig p\u00e5 t.ex. IGP shortest path table. Det \u00e4r samtidigt simplare \u00e4n de flesta andra typer av traffic engineering. SR g\u00f6r \u00e4ven ECMP till skillnad fr\u00e5n RSVP-TE. F\u00f6r att tunea en path s\u00e5 anv\u00e4nds lokal TE policy alternativt BGP-LU, man annonserar en unicast route med en associerad MPLS label. SR kr\u00e4ver inget label distribution protocol s\u00e5 det beh\u00f6vs t.ex. ingen synkronisering mellan routingprotokoll och LDP.</p> <ul> <li>Prefix SID - Ett segment ID som inneh\u00e5ller IP-prefix, detta     m\u00e5ste vara globally unique. Prefix SID konfas manuellt ur     SRGB-rangen. Kallas \u00e4ven Node SID.</li> <li>Adjacency SID - Ett segment ID som inneh\u00e5ller en routers     adjacency till en granne, dvs det \u00e4r l\u00e4nken mellan tv\u00e5 routrar.     Eftersom adjacency SID \u00e4r relativ till en specifik router s\u00e5 \u00e4r den     locally unique och endast giltig p\u00e5 den nod som allokerade den.</li> </ul> <p>Man kan anv\u00e4nda b\u00e5de Prefix SID och Adjacency SID f\u00f6r att beskriva en path. Om ett interface g\u00e5r ner kommer Adj-SID att finnas kvar i 30 minuter och kallas d\u00e5 f\u00f6r zombie label.</p> <p>Det g\u00e5r \u00e4ven att stitcha IGP-dom\u00e4ner genom att konfigurera multipla IGP-instanser p\u00e5 loopback p\u00e5 domain border nodes. Man anger samma prefix SID under flera IGP-instanser och d\u00e4rmed blir prefix och prefix SID n\u00e5bara i flera dom\u00e4ner.</p>"},{"location":"cisco/Cisco_SR/#konfiguration","title":"Konfiguration","text":""},{"location":"cisco/Cisco_SR/#ios","title":"IOS","text":"<p>Segment Routing Global Block (SRGB) och Segment Routing Local Block (SRLB) \u00e4r de label ranges som \u00e4r reserverad f\u00f6r segment routing. Default value f\u00f6r SRGB \u00e4r 16000 till 23999, det \u00e4r rekommenderat att anv\u00e4nda default SRGB range (utom vid multi vendor).</p> <p><code>show\u00a0mpls\u00a0label\u00a0range</code> <code>show\u00a0ip\u00a0ospf\u00a0segment-routing\u00a0global-block</code></p> <p>Associera SID values med lokala prefix, detta prefix m\u00e5ste \u00e4ven annonseras i IGP.</p> <p><code>interface\u00a0Loopback0</code> <code>ip\u00a0address\u00a02.2.2.2\u00a0255.255.255.255</code></p> <p><code>segment-routing\u00a0mpls</code> <code>connected-prefix-sid-map</code> <code>address-family\u00a0ipv4</code> <code>2.2.2.2/32\u00a0index\u00a02</code></p> <p>Sedan g\u00e5r man in under IGP och sl\u00e5r p\u00e5 segment-routing, detta enablear MPLS p\u00e5 alla IGP-interface och l\u00e4gger in MPLS labels f\u00f6r forwarding. F\u00f6r \u00f6vrig konfiguration se IS-IS och OSPF.</p> <p><code>router\u00a0ospf\u00a01</code> <code>segment-routing\u00a0mpls</code></p> <p>Verify</p> <p><code>show\u00a0segment-routing\u00a0mpls\u00a0state</code> <code>show\u00a0mpls\u00a0forwarding-table</code> <code>show\u00a0ip\u00a0ospf\u00a0segment-routing\u00a0local-prefix</code> <code>show\u00a0ip\u00a0ospf\u00a0segment-routing\u00a0sid-database</code></p> <p>Kolla Adjacency SID</p> <p><code>show\u00a0ip\u00a0ospf\u00a0neighbor\u00a0detail\u00a0|\u00a0i\u00a0Neighbor|SR</code></p> <p>Node SID Redistribution router ospf 1</p> <p><code>segment-routing\u00a0mpls</code> <code>distribute\u00a0link-state</code></p>"},{"location":"cisco/Cisco_SR/#bgp-sr","title":"BGP-SR","text":"<p>Man kan \u00e4ven g\u00f6ra segment routing med hj\u00e4lp av BGP-SR, d\u00e5 anv\u00e4nds BGP-LU. Se \u00e4ven Cisco BGP.</p> <p><code>router\u00a0bgp\u00a01</code> <code>neighbor\u00a010.1.1.2\u00a0remote-as\u00a02</code> <code>!</code> <code>address-family\u00a0ipv4</code> <code>redistribute\u00a0connected</code> <code>segment-routing\u00a0mpls</code> <code>neighbor\u00a010.1.1.2\u00a0activate</code> <code>neighbor\u00a010.1.1.2\u00a0send-label</code> <code>exit-address-family</code></p>"},{"location":"cisco/Cisco_SR/#ios-xr","title":"IOS-XR","text":"<p>Segment Routing med MPLS Data Plane. SR funkar \u00e4ven med Multi-topology.</p> <p><code>router\u00a0isis\u00a01</code> <code>address-family\u00a0ipv4\u00a0unicast</code> <code>segment-routing\u00a0mpls</code> <code>!</code> <code>interface\u00a0Loopback0</code> <code>address-family\u00a0ipv4\u00a0unicast</code> <code>prefix-sid\u00a0absolute\u00a016001</code></p> <p>Verify</p> <p><code>show\u00a0isis\u00a0segment-routing\u00a0label\u00a0table</code> <code>show\u00a0isis\u00a0route\u00a0sr-only</code> <code>show\u00a0mpls\u00a0label\u00a0table\u00a0summary</code></p> <p>Detta g\u00e4ller vid imposition</p> <p><code>segment-routing\u00a0mpls</code> <code>set-attributes</code> <code>address-family\u00a0ipv4</code> <code>sr-label-preferred</code></p> <p>PHP PHP g\u00e5r att st\u00e4nga av per prefix SID.</p> <p><code>router\u00a0isis\u00a01</code> <code>interface\u00a0Loopback0</code> <code>address-family\u00a0ipv4\u00a0unicast</code> <code>prefix-sid\u00a0index\u00a01\u00a0explicit-null</code></p> <p>Microloop Protection</p> <p><code>microloop\u00a0avoidance\u00a0segment-routing</code></p> <p>Anycast SID Vill man anv\u00e4nda en prefix SID f\u00f6r anycast m\u00e5ste man st\u00e4nga av att den annonseras som en nod i LSDB.</p> <p><code>router\u00a0isis\u00a01</code> <code>interface\u00a0Loopback0</code> <code>address-family\u00a0ipv4\u00a0unicast</code> <code>prefix-sid\u00a0index\u00a01\u00a0n-flag-clear</code></p> <p>OAM ping sr-mpls 4.4.4.4/32</p> <p><code>traceroute\u00a0sr-mpls\u00a03.3.3.3/32\u00a0verbose</code></p> <p>BGP Peer Adjacency SID Man kan \u00e4ven skapa Adj-SID f\u00f6r eBGP-grannar, t.ex. p\u00e5 inter-AS-l\u00e4nkar. Man forwarderar d\u00e4r det finns en BGP-granne, detta kan anv\u00e4ndas f\u00f6r Egress Peering Engineering applications.</p> <p><code>router\u00a0bgp\u00a01</code> <code>neighbor\u00a010.1.1.2</code> <code>remote-as\u00a02</code> <code>egress-engineering</code> <code>address-family\u00a0ipv4\u00a0unicast</code></p>"},{"location":"cisco/Cisco_SR/#ldp","title":"LDP","text":"<p>SR kan samk\u00f6ras med LDP men ska man koppla ihop ett LDP-n\u00e4t med SR-n\u00e4t m\u00e5ste man s\u00e4tta upp mapping servers. Alla destinationer m\u00e5ste ha ett prefix SID. Om en nod inte kan annonsera det sj\u00e4lv (t.ex. en LDP-only nod) s\u00e5 g\u00f6r mapping servern det p\u00e5 dennes v\u00e4gnar. Alla Segment Routing routers beh\u00f6ver ocks\u00e5 vara mapping clients. Mapping server beh\u00f6ver ej finnas i data path.</p> <p>Mapping server</p> <p><code>router\u00a0isis\u00a01</code> <code>address-family\u00a0ipv4\u00a0unicast</code> <code>segment-routing\u00a0prefix-sid-map\u00a0advertise-local</code> <code>!</code> <code>segment-routing</code> <code>mapping-server</code> <code>prefix-sid-map</code> <code>address-family\u00a0ipv4</code> <code>1.1.1.1/32\u00a01001\u00a0range\u00a08</code></p> <p>Range 8 betyder prefix 1.1.1.1/32 - 1.1.1.8/32 med start label 17001 vilket g\u00f6r det l\u00e4tt att se vilka labels som kommer ifr\u00e5n mapping server.</p> <p>Mapping client</p> <p><code>router\u00a0isis\u00a01</code> <code>address-family\u00a0ipv4\u00a0unicast</code> <code>segment-routing\u00a0prefix-sid-map\u00a0receive</code></p> <p>Verify</p> <p><code>show\u00a0isis\u00a0segment-routing\u00a0prefix-sid-map\u00a0active-policy\u00a0detail</code></p> <p>SR vs LDP preference</p> <p><code>router\u00a0isis\u00a01</code> <code>address-family\u00a0ipv4\u00a0unicast</code> <code>segment-routing\u00a0mpls\u00a0sr-prefer</code></p>"},{"location":"cisco/Cisco_SR/#nx-os","title":"NX-OS","text":"<p>Se \u00e4ven NX-OS MPLS.</p> <p><code>install\u00a0feature-set\u00a0mpls</code> <code>feature-set\u00a0mpls</code> <code>feature\u00a0mpls\u00a0segment-routing</code></p> <p><code>segment-routing\u00a0mpls</code></p> <p><code>router\u00a0bgp\u00a065000</code> <code>address-family\u00a0ipv4\u00a0unicast</code> <code>network\u00a02.2.2.2/32\u00a0route-map\u00a0assign_label</code> <code>allocate-label\u00a0all</code> <code>neighbor\u00a010.1.1.2\u00a0remote-as\u00a065000</code> <code>address-family\u00a0ipv4\u00a0labeled-unicast</code> <code>send-community\u00a0extended</code></p>"},{"location":"cisco/Cisco_SR/#sr-te","title":"SR-TE","text":"<p>SR-TE kallas SR Policy. Med SR-TE beh\u00f6ver inte l\u00e4ngre n\u00e4tet h\u00e5lla n\u00e5got state per-flow eller per-applikation utan man f\u00f6ljer bara det forwarding-instruktioner som finns i paketet. Man nyttjar \u00e4ven bandbredd b\u00e4ttre eftersom man kan dra nytta av ECMP d\u00e4r det finns. Eftersom man l\u00e5ter en extern k\u00e4lla r\u00e4kna p\u00e5 required paths genom n\u00e4tverket l\u00e4ttar man lasten f\u00f6r \u00f6vriga routrar.</p> <p>F\u00f6r att styra en path s\u00e5 anv\u00e4nds lokal TE policy alternativt BGP-LU, man annonserar en unicast route med en associerad MPLS labelstack. Se exempel med ExaBGP.</p> <p><code>segment-routing</code> <code>traffic-eng</code> <code>segment-list\u00a0SIDLIST1</code> <code>index\u00a010\u00a0address\u00a0ipv4\u00a01.1.1.3</code> <code>index\u00a020\u00a0mpls\u00a0label\u00a024006</code> <code>index\u00a030\u00a0mpls\u00a0label\u00a016008</code> <code>!</code> <code>policy\u00a0POLICY1</code> <code>binding-sid\u00a0mpls\u00a015000</code> <code>color\u00a010\u00a0end-point\u00a0ipv4\u00a01.1.1.10</code> <code>candidate-paths</code> <code>preference\u00a0100</code> <code>explicit\u00a0segment-list\u00a0SIDLIST1</code></p> <p>Verify</p> <p><code>show\u00a0segment-routing\u00a0traffic-eng\u00a0policy</code> <code>show\u00a0segment-routing\u00a0traffic-eng\u00a0forwarding\u00a0policy</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_STP/","title":"Cisco STP","text":"<p>Spanning Tree Protocol blockar portar p\u00e5 switchar s\u00e5 att det p\u00e5 L2 skapas en logisk tr\u00e4dtopologi och p\u00e5 s\u00e5 s\u00e4tt h\u00e5lls ethernetsegment loopfria. Enheter som anv\u00e4nder STP skickar BPDU-meddelanden mellan varandra f\u00f6r att utbyta information. De skickas till 01:80:C2:00:00:00/01:00:0C:CC:CC:CD. Den BPDU som \u00e4r superior har f\u00f6retr\u00e4de och \u00f6vriga kan ignoreras. F\u00f6r att avg\u00f6ra vilken som \u00e4r b\u00e4st j\u00e4mf\u00f6rs f\u00f6ljande v\u00e4rden i skriven ordning: Root Bridge ID, Root Path Cost, Sender Bridge ID, Sender Port ID, Receiver Port ID (RPID f\u00f6ljer ej med i BPDUn utan switchen sj\u00e4lv vet ju detta). Det f\u00f6rsta v\u00e4rdet d\u00e4r det skiljer sig avg\u00f6r och l\u00e4gst vinner. BPDUer skickas ej p\u00e5 non-designated portar eftersom de inte \u00e4r superior och d\u00e4rmed on\u00f6diga att skicka. Varenda port p\u00e5 varenda switch i STP sparar superior BPDUn p\u00e5 det segmentet. Non-designated portar sparar BPDU fr\u00e5n andra sidan och Designated portar sparar sin egen BPDU.</p> <p>Se \u00e4ven Cisco MST.</p>"},{"location":"cisco/Cisco_STP/#stp","title":"STP","text":"<p>STP (IEEE 802.1D) anv\u00e4nder BPDUer med Version 0. Kommer det inte in n\u00e5gon BPDU innan MaxAge (minus MessageAge) har g\u00e5tt ut m\u00e5ste STP r\u00e4kna om. Rotbryggan avg\u00f6r dessa timers. Root Path Cost skickas med i varje Hello och genom att addera det med costen p\u00e5 interfacet d\u00e4r Hellon kom in vet switchen hur l\u00e5ngt det \u00e4r till rotbryggan.</p>   **BPDU**    [](/File:Cisco_STP_BPDU.png \"wikilink\")   <p>Process STP-processen b\u00f6rjar med att alla switchar ser sig sj\u00e4lva som root och skickar ut Hellos. Sedan g\u00f6rs f\u00f6ljande val:</p> <ol> <li>Root Bridge: Lowest BID = Priority + MAC (Den ursprungliga     STP-varianten hade ej med VLAN ID)</li> <li>Root Port: Av alla BPDUer p\u00e5 alla portar vilken \u00e4r superior. Dvs     b\u00e4sta v\u00e4gen bandbreddsm\u00e4ssigt till rotbryggan, en per nonroot     switch.</li> <li>Designated Port: Superior BPDU p\u00e5 ett segment</li> <li>Non Designated: \u00d6vriga</li> </ol> <p>P\u00e5 rotbryggan finns det ingen root port utan alla \u00e4r designated. STP-processen slutar aldrig utan varje BDPU som kommer in ska j\u00e4mf\u00f6ras.</p> <p>PVST-processen skiljer sig lite grann:</p> <ul> <li>Root Bridge: Lowest BID (Priority + VLANID + MAC)</li> </ul> <p>Topology Change Det finns en slags BPDU i 802.1D som heter TCN (Topology Change Notification), den anv\u00e4nds f\u00f6r att informera \u00f6vriga om en f\u00f6r\u00e4ndring. Detta skickas om: det kommer in en TCN BPDU p\u00e5 en designated port, en port g\u00e5r fr\u00e5n Learning till Forwarding eller Blocking, en switch blir rotbrygga. Kom ih\u00e5g att vanliga BPDUer som inte \u00e4r superior ignoreras d\u00e4rf\u00f6r m\u00e5ste en TCN skickas till root (g\u00f6rs genom root port) som sedan kan skicka ut det till alla. En TCN skickas med varje Hello tills en TCA (Acknowledgement) f\u00e5s som svar, sedan g\u00f6r n\u00e4sta switch samma sak till det n\u00e5r root. Rotbryggan s\u00e4tter nu TC-biten i sina utg\u00e5ende BPDUer som instruerar \u00f6vriga att f\u00f6rkorta Aging Time till ForwardDelay f\u00f6r att p\u00e5skynda konvergens.</p> <p>Timers Det finns flera olika typer av timers som skickas med i BPDUerna. MessageAge \u00e4r en uppskattning p\u00e5 hur l\u00e4nge sedan BPDUn l\u00e4mnade rotbryggan (med detta satt till 0). \u00d6vriga switchar brukar plussa p\u00e5 1 innan de skickar det vidare. MaxAge, HelloTime och ForwardDelay \u00e4r v\u00e4rden satta p\u00e5 rotbryggan, har andra switchar andra v\u00e4rden konfigurerade spelar det ingen roll f\u00f6r det \u00e4r rotbryggan som best\u00e4mmer. Hellos skickas default var 2 sekund.</p> <p><code>spanning-tree\u00a0vlan\u00a01-4094\u00a0hello-time\u00a02</code> <code>spanning-tree\u00a0vlan\u00a01-4094\u00a0forward-time\u00a015</code> <code>spanning-tree\u00a0vlan\u00a01-4094\u00a0max-age\u00a020</code></p> <p>Interface states N\u00e4r n\u00e4tverket konvergerar kan portar byta mellan Blocking och Forwarding men detta kan inte g\u00f6ras direkt utan att riskera tillf\u00e4lliga loopar. D\u00e4rf\u00f6r g\u00e5r interfacen igenom olika tillst\u00e5nd. L\u00e4ngden p\u00e5 transitory statesen avg\u00f6rs av ForwardDelay, 15 sek default.</p> State Forwards data frames Learns source MACs of received frames Stable Blocking No No Stable (show spanning-tree blockedports) Listening No No Transitory Learning No Yes Transitory Forwarding Yes Yes Stable Disabled No No Stable"},{"location":"cisco/Cisco_STP/#rapid-st","title":"Rapid ST","text":"<p>Rapid Spanning Tree Protocol (802.1w) och RPVST+ (Cisco) f\u00f6rb\u00e4ttrar konvergens avsev\u00e4rt, under 1 sekund i bra byggda n\u00e4t. Man har introducerat att l\u00e4nkar \u00e4r point-to-point f\u00f6r att kunna ha b\u00e4ttre mekanismer f\u00f6r recovery (konvergenstid). Det finns ocks\u00e5 shared links men det b\u00f6r alltid vara p2p nuf\u00f6rtiden om inget \u00e4r half duplex.</p> <p>Man anv\u00e4nder 2 nya porttyper.</p> <ul> <li>Alternate Port: prospekt till root port. G\u00e5r root port ner kan     denna ta \u00f6ver snabbt.</li> <li>Backup Port: prospekt till designated port. Finns om switchen     har flera portar i samma segment.</li> </ul> <p>BPDU I RSTP finns endast en sorts BDPU (Version 2) som anv\u00e4nds f\u00f6r allt. Man har uppdaterat flag fields och skillnad fr\u00e5n tidigare finns nu Proposal bit, Port role bits, Learning bit, Forwarding bit och Agreement bit. Alla switchar originerar sina egna BPDUer oavsett BPDUn p\u00e5 root porten vilket leder till att de \u00e4r mer p\u00e5litliga som Hello-mekanism. Om det slutar komma BPDU v\u00e4ntar en switch 3x Hello interval sedan blir BPDUn p\u00e5 den porten age out. MessageAge anv\u00e4nds nu endast f\u00f6r hop count och \u00e4r det samma eller h\u00f6gre \u00e4n MaxAge discardas BPDUn.</p> <p>Med STP ignoreras inferior BPDUer men i RSTP accepteras de direkt och switchen utv\u00e4rderar sin roll och state p\u00e5 interfacet som vanligt. Detta leder till att switchen snabbt kan agera ifall den som brukade skicka superior BDPUer har disruption till root bridge. Kanske finns det en ny root bridge eller s\u00e5 har costen till root \u00f6kat den v\u00e4gen, hursom ska det ageras p\u00e5 direkt.</p> <p>Proposal/Agreement Process N\u00e4r man l\u00e4gger till en l\u00e4nk i topologin kan en tillf\u00e4llig switching-loop uppst\u00e5 eftersom en switch d\u00e5 kan v\u00e4lja den tillagda l\u00e4nken som ny root port och \u00f6vriga switchar inte k\u00e4nner till det direkt. F\u00f6r att skydda mot detta har RSTP en Proposal/Agreement-mekanism p\u00e5 p2p-l\u00e4nkar (vilket alla l\u00e4nkar b\u00f6r vara). Eftersom man inte kan styra andra switchar m\u00e5ste det loop-skyddas lokalt n\u00e4r man byter root port. Genom att s\u00e4tta alla (inklusive gamla root) non-edge designated portar i discarding state innan den nya root port blir forwarding f\u00f6rhindrar man en loop. Dock st\u00e4ngs l\u00e4nkar och det tar lite tid att \u00e5terst\u00e4lla s\u00e5 genom att ha ett signaling scheme mellan enheterna som anv\u00e4nds f\u00f6r att f\u00f6rs\u00e4kra sig om att det \u00e4r safe att s\u00e4tta designated portar i forwarding kan man uppn\u00e5 snabb konvergens, detta kallas Proposal/Agreement. Proposal st\u00e5r f\u00f6r de portar som vill bli forwarding och Agreement st\u00e5r f\u00f6r till\u00e5telse att g\u00f6ra s\u00e5. N\u00e4r en ny p2p-l\u00e4nk kommer upp mellan tv\u00e5 switchar blir port state Designated Discarding p\u00e5 non-edge portar. N\u00e4r porten blir Learning skickas BPDUer med Proposal-biten satt.</p> <p>Topology Change Till skillnad fr\u00e5n 802.1D \u00e4r den enda g\u00e5ng en topologi\u00e4ndring anses h\u00e4nda n\u00e4r en non-edge port g\u00e5r fr\u00e5n non-forwarding till forwarding. Den nya portan kan ha en b\u00e4ttre v\u00e4g f\u00f6r MAC-adresserna och CAM-tabellen m\u00e5ste uppdateras. G\u00e5r en port fr\u00e5n forwarding till non-forwarding spelar det ingen roll f\u00f6r d\u00e5 \u00e4r de MAC-adresserna unreachable, dyker de upp n\u00e5gon annanstans \u00e4r det f\u00f6r n\u00e5gon annan port har g\u00e5tt fr\u00e5n non-forwarding till forwarding och d\u00e5 \u00e4r det en topologi\u00e4ndring iallafall. I 802.1D skickades en TCN upstream, i RSTP floodas BPDUer med TC-biten satt till alla non-edge designated ports och root port utom porten d\u00e4r \u00e4ndringen kom in p\u00e5. Samt flusha alla MAC-adresser p\u00e5 den porten.</p> <p>F\u00f6r att RSTP/RPVST+ ska kunna tillhandah\u00e5lla snabb konvergens m\u00e5ste alla switchar k\u00f6ra RSTP eller RPVST+, alla inter-switchl\u00e4nkar m\u00e5ste vara p2p och alla portar mot end systems m\u00e5ste vara edge ports. Annars kommer prestandan att degraderas.</p> <p>Interface states Med RSTP har man g\u00e5tt fr\u00e5n 5 interface states till 3.</p> Administrative State STP RSTP Enabled Blocking Discarding Enabled Listening Discarding Enabled Learning Learning Enabled Forwarding Forwarding Disabled Disabled Discarding <p>Discarding lyssnar och skickar (beroende p\u00e5 roll) fortfarande BPDUer och \u00f6vrig control plane traffic till och fr\u00e5n switchen. Forwarding och Discarding \u00e4r stable state medans Learning \u00e4r transitory.</p>"},{"location":"cisco/Cisco_STP/#konfiguration","title":"Konfiguration","text":"<p>Bridge ID med VLAN, detta \u00e4r default och g\u00e5r ej att ta bort p\u00e5 nyare switchar f\u00f6r det konsumerar fler MAC-adresser. Kolla den lokala MAC-adressen som anv\u00e4nds till Bridge ID: show version | i bia|Base</p> <p><code>spanning-tree\u00a0extend\u00a0system-id</code> <code>spanning-tree\u00a0mode\u00a0rapid-pvst</code> <code>show\u00a0spanning-tree</code></p> <p>Cost 802.1D-1998, 1G = 4</p> <p><code>spanning-tree\u00a0pathcost\u00a0method\u00a0short</code></p> <p>802.1D-2004, 1G = 20000</p> <p><code>spanning-tree\u00a0pathcost\u00a0method\u00a0long</code> <code>show\u00a0spanning-tree\u00a0pathcost\u00a0method</code></p> <p>Root Bridge Konfigurera root brygga. Priority 0 \u00e4r det absolut l\u00e4gsta medans root primary s\u00e4tter prio till 24k f\u00f6rutsatt att det ger root-rollen, detta \u00e4ndras inte dynamiskt.</p> <p><code>spanning-tree\u00a0priority\u00a00</code> <code>spanning-tree\u00a0root\u00a0primary</code></p> <p>Verify</p> <p><code>show\u00a0spanning-tree\u00a0root</code></p> <p>Default-v\u00e4rden</p> <p><code>default\u00a0spanning-tree\u00a0vlan\u00a01-4094\u00a0priority</code></p> <p>Portar Root Port och Designated Port</p> <p><code>interface\u00a0range\u00a0gi0/7</code> <code>spanning-tree\u00a0cost\u00a01000</code> <code>spanning-tree\u00a0port-priority\u00a0128</code></p> <p>Restart the protocol migration process</p> <p><code>clear\u00a0spanning-tree\u00a0detected-protocols</code></p> <p>Troubleshoot</p> <p><code>test\u00a0spanning-tree\u00a0diameter\u00a03</code> <code>test\u00a0spanning-tree\u00a0get\u00a0configuration\u00a0vlan</code> <code>debug\u00a0spanning-tree\u00a0events</code> <code>debug\u00a0spanning-tree\u00a0backbone\u00a0fast</code> <code>debug\u00a0spanning-tree\u00a0pvst+</code></p>"},{"location":"cisco/Cisco_STP/#legacy-extensions","title":"Legacy Extensions","text":"<p>Det finns m\u00e5nga till\u00e4gg till Spanning-tree som b\u00f6r anv\u00e4ndas, de hj\u00e4lper till att \u00f6ka stabilitet, s\u00e4kerhet och kompabilitet. Se \u00e4ven MST Extensions.</p> <p>UplinkFast Cisco-proprietary teknik som l\u00e5ter en alternate port g\u00e5 direkt till forwarding om root port g\u00e5r ner. F\u00f6r att f\u00f6rs\u00e4kra sig att en switch med uplinkfast inte blir en transit switch s\u00e4tts bridge priority automatiskt till 49152 och port costen blir 3000. Detta kan d\u00e4rf\u00f6r inte anv\u00e4ndas p\u00e5 en switch som har sin STP prio modifierad. N\u00e4r \u00f6verslag g\u00f6rs s\u00e5 skickas dummy frames till mac 01:00:0c:cc:cc:cc fr\u00e5n alla adresser i cam tabellen f\u00f6r att snabba upp konvergens i \u00f6vriga n\u00e4tet. Uplinkfast p\u00e5 default och konfigureras globalt.</p> <p><code>spanning-tree\u00a0uplinkfast</code> <code>show\u00a0spanning-tree\u00a0uplinkfast</code></p> <p>BackboneFast Cisco-proprietary teknik som anv\u00e4nds f\u00f6r att snabba upp konvergens vid indirect link failure genom att l\u00e5ta MaxAge timer g\u00e5 ut direkt. Om n\u00e5gon annan pl\u00f6tsligt h\u00e4vdar sig vara root kanske den tappat sin uplink till root och d\u00e5 kan man timea ut den tidigare BPDU:n man f\u00e5tt fr\u00e5n den enheten f\u00f6r att snabba upp konvergens. RLQ skickas ocks\u00e5 till root f\u00f6r att dubbelkollla att man sj\u00e4v inte tappat root. RSTP och MST har detta inbyggt men b\u00f6r i \u00f6vrigt anv\u00e4ndas p\u00e5 alla enheter, s\u00e5 f\u00f6rhoppningsvis inga...</p> <p><code>spanning-tree\u00a0backbonefast</code> <code>show\u00a0spanning-tree\u00a0backbonefast</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_Security/","title":"Cisco Security","text":"<p>Cisco IOS har st\u00f6d f\u00f6r m\u00e5nga s\u00e4kerhetsmekanismer och protokoll. Se \u00e4ven L2 Security, L3 Security, DMVPN och Cisco IPsec.</p>"},{"location":"cisco/Cisco_Security/#device-security","title":"Device Security","text":"<p>Login enhancements</p> <p><code>login\u00a0block-for\u00a0[seconds]\u00a0attempts\u00a0[attempts]\u00a0within\u00a0[seconds]</code> <code>login\u00a0on-failure\u00a0log\u00a0every\u00a03</code></p> <p><code>show\u00a0login</code> <code>show\u00a0login\u00a0failures</code></p> <p>L\u00e4gg till undantag</p> <p><code>ip\u00a0access-list\u00a0standard\u00a0TRUSTED_HOSTS</code> <code>permit\u00a0host\u00a010.0.0.10</code> <code>login\u00a0quiet-mode\u00a0access-class\u00a0TRUSTED_HOSTS</code></p> <p>Default genereras det ett syslog-meddelande om det g\u00f6rs 8 misslyckade inloggningsf\u00f6rs\u00f6k inom en minut. Detta tr\u00f6skelv\u00e4rde g\u00e5r att konfigurera.</p> <p><code>security\u00a0authentication\u00a0failure\u00a0rate\u00a08\u00a0log</code></p> <p>Password recovery \u00e4r p\u00e5 default men g\u00e5r att st\u00e4nga av.</p> <p><code>no\u00a0service\u00a0password-recovery</code></p>"},{"location":"cisco/Cisco_Security/#ssh","title":"SSH","text":"<p><code>ip\u00a0ssh\u00a0version\u00a02</code> <code>crypto\u00a0key\u00a0generate\u00a0rsa\u00a0modulus\u00a02048</code></p> <p><code>line\u00a0vty\u00a00\u00a015</code> <code>transport\u00a0input\u00a0ssh</code></p> <p>Verify</p> <p><code>show\u00a0ssh</code> <code>show\u00a0ip\u00a0ssh</code> <code>show\u00a0users</code></p> <p>Public key SSH authentication Ens SSH-nyckel f\u00e5r inte plats p\u00e5 en rad utan man f\u00e5r l\u00e4gga in det p\u00e5 flera rader och avsluta med exit.</p> <p><code>ip\u00a0ssh\u00a0pubkey-chain</code> <code>username\u00a0cisco</code> <code>key-string</code> <code>AAAAB3NzaC1yc2EAAAADAQABAAABAQDLf...</code> <code>VPrV/fn35p1xq5Pc7b2oTxhe2sPEssVM7...</code> <code>exit</code></p> <p>Enable key based authentication only. Ordning p\u00e5 authentication methods \u00e4r default: publickey, keyboard-interactive, password.</p> <p><code>ip\u00a0ssh\u00a0server\u00a0algorithm\u00a0authentication\u00a0publickey</code></p>"},{"location":"cisco/Cisco_Security/#control-plane","title":"Control Plane","text":"<p>Det \u00e4r viktigt att skydda CPU i sina enheter, man kan styra accessen (Control-Plane Policing) och man kan \u00f6verbelastningsskydda (Control-Plane Protection). CoPP skyddar route processor genom att behandla det som en separat enhet med eget ingress interface. Man kan styra trafik till control plane med hj\u00e4lp av ACL:er och QoS-filter.</p> <p><code>class-map\u00a0match-all\u00a0COPP-IN-IP</code> <code>match\u00a0protocol\u00a0ip</code></p> <p><code>policy-map\u00a0COPP-INBOUND</code> <code>class\u00a0COPP-IN-IP</code> <code>police\u00a0rate\u00a010\u00a0pps\u00a0conform-action\u00a0transmit\u00a0\u00a0exceed-action\u00a0drop</code></p> <p><code>control-plane</code> <code>service-policy\u00a0input\u00a0COPP-INBOUND</code></p> <p><code>show\u00a0policy-map\u00a0control-plane</code></p> <p>Default CoPP</p> <p><code>cpp\u00a0system-default</code></p> <p>Management Plane Protection</p> <p><code>control-plane\u00a0host</code> <code>management-interface\u00a0GigabitEthernet\u00a00/1\u00a0allow\u00a0ssh\u00a0https</code></p> <p><code>show\u00a0management-interface</code></p> <p>AutoSecure AutoSecure finns i tv\u00e5 modes, Interactive och Noninteractive d\u00e4r det senare \"Automatically executes the recommended Cisco default settings\" vilket bland annat st\u00e4nger av ICMP redirects, unreachables och Proxy-ARP p\u00e5 alla interface.</p> <p><code>auto-secure\u00a0no-interact</code> <code>show\u00a0auto\u00a0secure\u00a0config</code></p>"},{"location":"cisco/Cisco_Security/#aaa","title":"AAA","text":"<p>AAA authentication p\u00e5 IOS kan konfigureras att anv\u00e4nda upp till fyra olika metoder f\u00f6r autentisering. Enheten kommer att anv\u00e4nda metoderna i ordning och det \u00e4r endast vid error som n\u00e4sta metod anv\u00e4nds, detta g\u00f6r att man kan ha fallbacks. aaa new-model g\u00f6r att lokala usernames och passwords p\u00e5 enheten anv\u00e4nds vid avsaknad av andra AAA statements.</p> <p><code>aaa\u00a0new-model</code> <code>aaa\u00a0authentication\u00a0username-prompt\u00a0\"Enter\u00a0Username:\"</code> <code>aaa\u00a0authentication\u00a0password-prompt\u00a0\"Enter\u00a0Password:\"</code></p> <p><code>aaa\u00a0authentication\u00a0enable\u00a0default\u00a0group\u00a0tacacs+\u00a0enable</code> <code>aaa\u00a0authentication\u00a0login\u00a0default\u00a0group\u00a0tacacs+\u00a0local</code></p> <p>Debug</p> <p><code>debug\u00a0aaa\u00a0authentication</code></p> <p>Fallback user account ifall AAA-server \u00e4r unreachable</p> <p><code>username\u00a0fallback\u00a0privilege\u00a015\u00a0secret\u00a0SECRETS</code></p> <p>Max failed attempts to lock the user</p> <p><code>aaa\u00a0local\u00a0authentication\u00a0attempts\u00a0max-fail\u00a010</code> <code>show\u00a0aaa\u00a0local\u00a0user\u00a0lockout</code> <code>clear\u00a0aaa\u00a0local\u00a0user\u00a0locked</code></p>"},{"location":"cisco/Cisco_Security/#tacacs","title":"TACACS","text":"<p>TACACS+ \u00e4r Ciscoproperit\u00e4rt och all trafik \u00e4r krypterad. Tacacs kommunicerar p\u00e5 TCP port 49.</p> <p><code>aaa\u00a0group\u00a0server\u00a0tacacs+</code> <code>server-private\u00a010.0.0.20\u00a0key\u00a07\u00a0078905478...</code> <code>server-private\u00a010.0.0.21\u00a0key\u00a07\u00a0134272319...</code> <code>ip\u00a0vrf\u00a0forwarding\u00a0Mgmt</code> <code>ip\u00a0tacacs\u00a0source-interface\u00a0gi0</code></p> <p><code>aaa\u00a0authentication\u00a0login\u00a0default\u00a0group\u00a0tacacs+\u00a0local</code> <code>aaa\u00a0authorization\u00a0exec\u00a0default\u00a0group\u00a0tacacs+\u00a0if-authenticated</code></p> <p>Verify</p> <p><code>test\u00a0aaa\u00a0group\u00a0tacacs+\u00a0USER\u00a0SECRET123\u00a0new-code</code> <code>show\u00a0tacacs</code></p>"},{"location":"cisco/Cisco_Security/#radius","title":"Radius","text":"<p>Cisco IOS RADIUS anv\u00e4nder AV pairs, UDP port 1645-1646 eller 1812-1813, accounting \u00e4r separat fr\u00e5n authentication och authorization. Endast l\u00f6senord \u00e4r krypterat.</p> <p><code>radius\u00a0server\u00a0ISE1</code> <code>address\u00a0ipv4\u00a010.0.0.30\u00a0auth-port\u00a01812\u00a0acct-port\u00a01813</code> <code>key\u00a07\u00a001300F175804575D72</code></p> <p><code>aaa\u00a0group\u00a0server\u00a0radius\u00a0ISE-GROUP</code> <code>server\u00a0name\u00a0ISE1</code> <code>server\u00a0name\u00a0ISE2</code> <code>ip\u00a0vrf\u00a0forwarding\u00a0mgmt</code> <code>ip\u00a0radius\u00a0source-interface\u00a0Vlan100</code> <code>retransmit\u00a02</code> <code>timeout\u00a04</code> <code>deadtime\u00a01</code></p> <p><code>aaa\u00a0authentication\u00a0login\u00a0VTY-LINES\u00a0group\u00a0ISE-GROUP\u00a0local</code> <code>aaa\u00a0authorization\u00a0exec\u00a0default\u00a0group\u00a0radius\u00a0local</code></p> <p>Verify</p> <p><code>test\u00a0aaa\u00a0group\u00a0radius\u00a0USER\u00a0SECRET123\u00a0new-code</code> <code>show\u00a0radius</code></p>"},{"location":"cisco/Cisco_Security/#ips","title":"IPS","text":"<p>IOS kan s\u00e4ttas upp som ett Intrusion Prevention System.</p> <p><code>mkdir\u00a0ips</code> <code>ip\u00a0ips\u00a0config\u00a0location\u00a0flash:/ips</code> <code>ip\u00a0ips\u00a0name\u00a0IPS</code></p> <p><code>show\u00a0ip\u00a0ips\u00a0config</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_Services/","title":"Cisco Services","text":"<p>Cisco IOS har st\u00f6d f\u00f6r diverse protokoll f\u00f6r mgmt och fil\u00f6verf\u00f6ring.</p> <p>Kontrollera vilka portar som \u00e4r aktiva: show control-plane host open-ports</p> <p>Samt vilken service som anv\u00e4nder vilken port: show ip port-map</p>"},{"location":"cisco/Cisco_Services/#http","title":"HTTP","text":"<p><code>ip\u00a0http\u00a0server</code> <code>ip\u00a0http\u00a0secure-server</code> <code>show\u00a0ip\u00a0http\u00a0server\u00a0all</code></p> <p>Fil\u00f6verf\u00f6ring med HTTP brukar vara snabbare \u00e4n tftp och scp.</p> <p><code>copy</code><code>http://10.0.0.10/ios.bin</code><code>flash:</code></p>"},{"location":"cisco/Cisco_Services/#dns","title":"DNS","text":"<p>Server</p> <p><code>ip\u00a0dns\u00a0server</code> <code>ip\u00a0dns\u00a0spoofing\u00a02.2.2.2</code> <code>ip\u00a0name-server\u00a08.8.4.4\u00a08.8.8.8</code> <code>ip\u00a0domain\u00a0round-robin</code></p> <p>Verify</p> <p><code>show\u00a0ip\u00a0dns\u00a0primary</code> <code>debug\u00a0domain</code></p> <p>Hosts</p> <p><code>ip\u00a0host\u00a0r1\u00a010.0.0.10</code> <code>show\u00a0hosts</code></p>"},{"location":"cisco/Cisco_Services/#ntp","title":"NTP","text":"<p>NTP \u00e4r v\u00e4ldigt effektivt f\u00f6r att synkronisera klockan mellan tv\u00e5 system, ett paket i minuten r\u00e4cker f\u00f6r att synka det till en millisekunds noggrannhet. I nyare versioner av IOS anv\u00e4nds NTPv4 (show ntp information) och det finns d\u00e4rmed st\u00f6d f\u00f6r IPv6. Det g\u00e5r dock att st\u00e4lla NTP-version per interface eller peer. Offset m\u00e5ste vara mindre \u00e4n 1000 msec f\u00f6r att servern ska anses sane. Om det \u00e4r mycket offset s\u00e5 kommer synk-processen att ta l\u00e5ng tid.</p> <p>Packet types</p> <ul> <li>Control messages: peer status och set management parameters</li> <li>Update/request messages: time synchronization</li> </ul>   Client:    [](/File:Cisco_NTP_client.png \"wikilink\")     Server:    [](/File:Cisco_NTP_server.png \"wikilink\")   <p><code>ntp\u00a0logging</code> <code>debug\u00a0ntp\u00a0all</code></p> <p>Tidszon (Sverige)</p> <p><code>clock\u00a0timezone\u00a0CET\u00a01</code> <code>clock\u00a0summer-time\u00a0CEST\u00a0recurring\u00a0last\u00a0sunday\u00a0march\u00a002:00\u00a0last\u00a0sunday\u00a0october\u00a003:00</code></p> <p>Server</p> <p><code>ntp\u00a0master</code><code>#8\u00a0\u00e4r\u00a0default</code> <code>show\u00a0ntp\u00a0packets\u00a0mode\u00a0server</code> <p>Klient</p> <p><code>ntp\u00a0server\u00a010.0.0.10</code> <code>ntp\u00a0server\u00a0vrf\u00a0Mgmt\u00a0130.236.254.102</code></p> <p>OBS det kan ta l\u00e5ng tid innan klient synkar med server f\u00f6rsta g\u00e5ngen.</p> <p>Peer B\u00e5da enheter kan uppdatera sina klockor mot varandra, som ett NTP-kluster</p> <p><code>ntp\u00a0peer\u00a010.0.0.10\u00a0[key\u00a020]</code></p> <p>Verify F\u00f6r att veta att NTP fungerar som det ska kan man kolla p\u00e5 reach-f\u00e4ltet. Det \u00e4r en 8-bitars buffer d\u00e4r varje lyckat paket representeras av en 1:a och det som st\u00e5r i reach-f\u00e4ltet \u00e4r p\u00e5 basen 8 s\u00e5 det man vill se \u00e4r 377, annars betyder det att n\u00e5gon av de senaste 8 ntp-paketen inte kommit fram. N\u00e4r server och klient n\u00e4rmar sig synk och inga paket droppas kommer poll-intervallet att \u00f6ka \u00f6ver tid, till max 1024. Det g\u00e5r ej att \u00e4ndra routerns NTP poll intervall eftersom det best\u00e4ms av en heuristisk algorithm.</p> <p><code>show\u00a0ntp\u00a0status</code> <code>show\u00a0ntp\u00a0associations</code></p> <p>St\u00e4ll klockan manuellt. Kan g\u00f6ras f\u00f6r att skynda p\u00e5 klocksynkronisering.</p> <p><code>clock\u00a0set\u00a012:00:00\u00a020\u00a0July\u00a02020</code></p> <p>Access control Med ACL, NTP Access control levels:</p> <p><code>ntp\u00a0access-group\u00a0ipv4</code> <p>Authentication enable authentication, configure a key with a key index, trust the key.</p> <p><code>ntp\u00a0authenticate</code> <code>ntp\u00a0authentication-key\u00a020\u00a0md5\u00a0SECRET</code> <code>ntp\u00a0trusted-key\u00a020</code></p> <p><code>show\u00a0ntp\u00a0associations\u00a0detail\u00a0\u00a0|\u00a0inc\u00a0auth</code></p> <p>Broadcast NTP-paket g\u00e5r \u00e4ven att skicka med broadcast eller multicast, detta h\u00e4nder allts\u00e5 utan att klienten \"best\u00e4ller\" det.</p> <p><code>interface\u00a0gi2</code> <code>ntp\u00a0broadcast|multicast</code> <code>ntp\u00a0broadcast\u00a0key\u00a020</code></p> <p>Receiver</p> <p><code>int\u00a0vlan\u00a0101</code> <code>ntp\u00a0broadcast|multicast\u00a0client</code></p> <p>Others Default-inst\u00e4llningar</p> <p><code>ntp\u00a0max-associations\u00a0100</code> <code>ntp\u00a0allow\u00a0mode\u00a0control\u00a03</code> <code>ntp\u00a0mindistance\u00a01</code> <code>ntp\u00a0maxdistance\u00a08</code></p> <p>Enable hardware clock synchronization</p> <p><code>ntp\u00a0update-calendar</code></p> <p>If my peer or configured master's clock is more than 1,000 seconds (default) off of my clock, reject the update and syslog.</p> <p><code>ntp\u00a0panic\u00a0update</code></p> <p>Distance, 1 \u00e4r slow convergence, 16 \u00e4r fast</p> <p><code>ntp\u00a0maxdistance\u00a0&lt;1-16&gt;</code></p> <p>Orphan kicks in when we lose sync with our server. The number here is a stratum number, and must be a number lower than your real upstream NTP server</p> <p><code>ntp\u00a0orphan\u00a0&lt;1-16&gt;</code></p>"},{"location":"cisco/Cisco_Services/#nx-os","title":"NX-OS","text":"<p>NX-OS k\u00f6r ocks\u00e5 NTPv4.</p> <p><code>feature\u00a0ntp</code> <code>ntp\u00a0logging</code></p> <p>Cisco Fabric Services (CFS) kan anv\u00e4ndas f\u00f6r att distribuera NTP-konfigurationen mellan Nexus-switchar. N\u00e4r man g\u00f6r NTP-konfiguration s\u00e5 blir NTP l\u00e5st network-wide (Fabric Lock).</p> <p><code>ntp\u00a0distribute</code></p> <p><code>ntp\u00a0master</code> <code>ntp\u00a0server\u00a010.0.1.10</code> <code>ntp\u00a0source-interface\u00a0loopback0</code></p> <p><code>ntp\u00a0commit\u00a0/\u00a0abort</code></p> <p>Verify</p> <p><code>show\u00a0ntp\u00a0status</code> <code>show\u00a0ntp\u00a0peers</code></p> <p>Notera att det endast \u00e4r en VDC som synkar klockan i switchen.</p> <p><code>clock\u00a0protocol\u00a0ntp\u00a0vdc</code>"},{"location":"cisco/Cisco_Services/#scp","title":"SCP","text":"<p>Secure copy protocol p\u00e5 IOS kr\u00e4ver AAA f\u00f6r user authentication och authorization eftersom copy \u00e4r ett exec-kommando.</p> <p>Server</p> <p><code>ip\u00a0scp\u00a0server\u00a0enable</code></p> <p>Push ios to switch</p> <p><code>scp\u00a0ios.bin\u00a0admin@10.0.0.10:ios.bin</code></p> <p>Fetch ios from server</p> <p><code>copy\u00a0scp://10.0.0.10:ios.bin\u00a0flash:ios.bin</code></p>"},{"location":"cisco/Cisco_Services/#tftp","title":"TFTP","text":"<p>Server, dela ut fil med TFTP.</p> <p><code>tftp-server\u00a0nvram:startup-config\u00a0alias\u00a0TEST</code></p> <p>Klient</p> <p><code>ip\u00a0tftp\u00a0source-interface\u00a0loopback0</code> <code>copy</code><code>tftp://10.0.0.10/TEST</code><code>null:</code></p> <p>F\u00f6r att s\u00e4kerst\u00e4lla interoperability med gamla TFTP-servrar kan man beh\u00f6va st\u00e4lla ner blocksize.</p> <p><code>ip\u00a0tftp\u00a0blocksize\u00a01024</code></p> <p>Debug</p> <p><code>debug\u00a0tftp\u00a0events</code></p>"},{"location":"cisco/Cisco_Services/#ftp","title":"FTP","text":"<p>Server, because of numerous vulnerabilities (bug ID CSCse29244, IOS crash when transferring files via FTP) Cisco has removed the FTP server functionality from recent IOS releases.</p> <p>Klient</p> <p><code>no\u00a0ip\u00a0ftp\u00a0passive</code> <code>ip\u00a0ftp\u00a0source-interface\u00a0Loopback0</code> <code>ip\u00a0ftp\u00a0username\u00a0USER</code> <code>ip\u00a0ftp\u00a0password\u00a0SECRET</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_TCLSH/","title":"Cisco TCLSH","text":"<p>Cisco IOS Tcl shell designades f\u00f6r att kunna k\u00f6ra tcl-kommandon direkt i IOS. Man kan k\u00f6ra script i detta skal.</p> <p><code>#tclsh</code></p>"},{"location":"cisco/Cisco_TCLSH/#ping-sweeps","title":"Ping sweeps","text":"<p>Flera hostar</p> <p><code>foreach\u00a0ip\u00a0{</code> <code>192.168.0.5</code> <code>192.168.0.6</code> <code>8.8.8.8}\u00a0{</code> <code>ping\u00a0$ip\u00a0repeat\u00a02\u00a0timeout\u00a01\u00a0}</code></p> <p>Ett subn\u00e4t</p> <p><code>for\u00a0{set\u00a0i\u00a01}\u00a0{$i\u00a0&lt;\u00a0255}\u00a0{incr\u00a0i}\u00a0{</code> <code>ping\u00a0192.168.0.$i\u00a0re\u00a02\u00a0ti\u00a00</code></p> <p>Flera subn\u00e4t</p> <p><code>foreach\u00a0subnet\u00a0{</code> <code>14</code> <code>15</code> <code>100\u00a0}\u00a0{</code> <code>for\u00a0{set\u00a0i\u00a01}\u00a0{$i\u00a0&lt;\u00a0255}\u00a0{incr\u00a0i}\u00a0{</code> <code>ping\u00a0172.0.$subnet.$i\u00a0re\u00a02\u00a0ti\u00a00</code> <code>}</code> <code>}</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_UDLD/","title":"Cisco UDLD","text":"<p>UDLD \u00e4r en echo-mekanism p\u00e5 lager 2 som g\u00f6r att enheter som \u00e4r anslutna via fiberoptiska eller partvinnade Ethernet-kablar kan \u00f6vervaka det fysiska v\u00e4lm\u00e5endet av interface och kablar f\u00f6r att kunna uppt\u00e4cka n\u00e4r en enkelriktad l\u00e4nk existerar. UDLD-meddelanden skickas var 7:e sekund p\u00e5 koppar och var 15:e sekund p\u00e5 fiber, med destination 01:00:0C:CC:CC:CC. Meddelandet inneh\u00e5ller switch-id, port-id och Timeout Echo Value som tillsammans bildar originator samt en lista p\u00e5 switch/port-par som h\u00f6rts p\u00e5 segmentet. Om det kommer ett UDLD-meddelande d\u00e4r switchen sj\u00e4lv inte finns med betyder det att andra sidan inte h\u00f6r switchen och man kan utg\u00e5 ifr\u00e5n unidirectional link. Kommer det in UDLD med sig sj\u00e4lv som originator betyder det self-looped port. Om n\u00e5got av detta h\u00e4nder blir interfacet error disabled (oavsett mode). UDLD \u00e4r good guy protocol som kan anv\u00e4ndas i kombination med STP/MST. Om man inte k\u00f6r Bridge Assurance eller BFD b\u00f6r man k\u00f6ra UDLD.</p>   UDLD-paket:    [](/File:Cisco_UDLD.png \"wikilink\")"},{"location":"cisco/Cisco_UDLD/#normal-vs-aggressive-mode","title":"Normal vs Aggressive mode","text":"<p>Vad som ska h\u00e4nde n\u00e4r det slutar komma in UDLD-meddelanden beror p\u00e5 vilket mode UDLD \u00e4r konfigurerat i. I Normal mode f\u00f6rs\u00f6ker switchen aktivt \u00e5teruppta grannskap genom att skicka 8 UDLD frames, sedan h\u00e4nder ingenting och porten f\u00f6rblir up. Med Aggressive mode f\u00f6rs\u00f6ker switchen att \u00e5teruppta grannskap genom att skicka 8 UDLD frames men om det inte lyckas blir porten error disable. I Aggressive mode blir ett interface endast error disable om l\u00e4nken g\u00e5r \u201cBidirectional\u201d -&gt; \u201cUnidirectional\u201d, dvs den m\u00e5ste f\u00f6rst ha varit uppe och haft fungerande grannskap.</p> <p>Normal och Aggressive mode \u00e4r kompatibelt med varandra eftersom det endast handlar om lokalt beteende vid avsaknad av UDLD-meddelanden.</p>"},{"location":"cisco/Cisco_UDLD/#konfiguration","title":"Konfiguration","text":"<p>Global, g\u00e4ller fiberportar.</p> <p><code>udld\u00a0enable|aggressive</code></p> <p>Per interface, g\u00e4ller oavsett media.</p> <p><code>interface\u00a0gi0/20</code> <code>udld\u00a0port\u00a0[aggressive]</code></p> <p>Verify</p> <p><code>show\u00a0udld</code> <code>show\u00a0udld\u00a0neighbors</code></p> <p>Restore alla interface som \u00e4r error-disabled pga link failure.</p> <p><code>udld\u00a0reset</code></p> <p>Auto Recovery</p> <p><code>errdisable\u00a0recovery\u00a0cause\u00a0udld</code> <code>show\u00a0errdisable\u00a0recovery</code></p> <p>P\u00e5 vissa plattformar kan man v\u00e4lja att UDLD endast ska rapportera errors ist\u00e4llet f\u00f6r att err-disablea porten.</p> <p><code>udld\u00a0fast-hello\u00a0error-reporting</code></p> <p>Time in seconds between sending of messages in steady state.</p> <p><code>udld\u00a0message\u00a0time\u00a0&lt;7-90&gt;</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_VLAN/","title":"Cisco VLAN","text":"<p>Virtual LAN \u00e4r alla broadcastdom\u00e4ner som \u00e4r partitionerade och isolerade p\u00e5 lager 2 i ett n\u00e4tverk. Vill man managera VLAN p\u00e5 m\u00e5nga Cisco-switchar centralt kan man anv\u00e4nda VTP. Det kan maximalt finnas 4094 VLAN, f\u00f6r att skala f\u00f6rbi det se Cisco VXLAN.</p> <p>Standard: 1-1005 (1002-1005 \u00e4r reserverade)</p> <p>Extended: 1006-4094</p>"},{"location":"cisco/Cisco_VLAN/#vlan","title":"VLAN","text":"<p>St\u00e4ng ett VLAN lokalt i switchen och suspenda det i VTP.</p> <p><code>vlan\u00a020</code> <code>shutdown</code> <code>state\u00a0suspend</code></p> <p>Show</p> <p><code>show\u00a0vlan\u00a0brief</code> <code>show\u00a0vlan\u00a0internal\u00a0usage</code></p> <p>Layer 2 Traceroute Man kan tracea mac-adresser i ett vlan. OBS CDP \u00e4r ett prereq f\u00f6r detta annars blir det Unable to send a l2trace request. Max hops \u00e4r 10.</p> <p><code>traceroute\u00a0mac\u00a00050.5600.0001\u00a00000.aabb.ccdd\u00a0vlan\u00a020</code></p> <p>Det g\u00e5r \u00e4ven att ta reda p\u00e5 vilken v\u00e4g en frame tar utifr\u00e5n IP-adresser. ARP anv\u00e4nds f\u00f6r IP-to-MAC resolution och b\u00e5da adresserna m\u00e5ste finnas i samma subn\u00e4t.</p> <p>Voice</p> <p><code>interface\u00a0GigabitEthernet0/1</code> <code>switchport\u00a0mode\u00a0access</code> <code>switchport\u00a0access\u00a0vlan\u00a020</code> <code>switchport\u00a0voice\u00a0vlan\u00a030</code></p> <p>Alternativt konfigurera en trunk som till\u00e5ter voice-vlanet. S\u00e5 fort man anv\u00e4nder kommandot switchport voice vlan enableas portfast.</p> <p>Database mode \u00c4r gammalt och st\u00f6ds inte l\u00e4ngre p\u00e5 alla switchar.</p> <p><code>vlan\u00a0database</code> <code>vlan\u00a020\u00a0name\u00a0Old-school</code> <code>apply</code></p>"},{"location":"cisco/Cisco_VLAN/#trunking","title":"Trunking","text":"<p>IEEE 802.1q \u00e4r standarden f\u00f6r att supportera VLAN \u00f6ver ethernet.</p> <p>Vitlista VLAN</p> <p><code>switchport\u00a0trunk\u00a0allowed\u00a0vlan\u00a01-5,8</code> <code>show\u00a0interface\u00a0trunk</code></p> <p>Se till att native VLAN matchar p\u00e5 trunkar, b\u00e5de CDP och DTP kan uppt\u00e4cka mismatch.</p> <p><code>switchport\u00a0trunk\u00a0native\u00a0vlan\u00a020</code></p> <p>Man kan tagga alla frames p\u00e5 en trunk.</p> <p><code>vlan\u00a0dot1q\u00a0tag\u00a0native</code> <code>show\u00a0vlan\u00a0dot1q\u00a0tag\u00a0native</code></p>"},{"location":"cisco/Cisco_VLAN/#dtp","title":"DTP","text":"<p>Dynamic Trunking Protocol \u00e4r ett Cisco-properit\u00e4rt protokoll som anv\u00e4nds av switchar f\u00f6r att f\u00f6rhandla med andra sidan om ett interface ska vara trunk eller ej samt ISL eller 802.1q. DTP advertisements skickas med destination mac 01:00:0C:CC:CC:CC var 30:e sekund och inneh\u00e5ller VTP domain name s\u00e5 det m\u00e5ste matcha f\u00f6r att DTP ska kunna f\u00f6rhandla upp trunk (ena sidan kan ha vtp domain NULL s\u00e5 funkar det ocks\u00e5). DTP \u00e4r p\u00e5slaget default och skickas b\u00e5de som vanlig ethernet men ocks\u00e5 ISL-enkapsulerat. DTP \u00e4r inte supporterat p\u00e5 n\u00e5gon Nexus-plattform.</p>   DTP frame:    [](/File:Cisco_DTP.png \"wikilink\")   <p><code>show\u00a0dtp</code></p> <p>Port Modes, vissa switchmodeller har desirable som default (3560) och vissa har auto (2960)</p> <ul> <li>dynamic desirable: switchen kommer aktivt att f\u00f6rs\u00f6ka f\u00f6rhandla     trunk genom att generera DTP frames.</li> <li>dynamic auto: switchen lyssnar och accepterar DTP frames men     skickar inga sj\u00e4lv.</li> </ul> <p>St\u00e4nga av DTP. OBS porten m\u00e5ste vara konfad som n\u00e5got f\u00f6r att kunna anv\u00e4nda nonegotiate, annars blir det Conflict between 'nonegotiate' and 'dynamic' status.</p> <p><code>switchport\u00a0mode\u00a0trunk\u00a0/\u00a0access</code> <code>switchport\u00a0nonegotiate</code></p> <p>Verify</p> <p><code>show\u00a0dtp\u00a0interface</code> <code>show\u00a0interfaces\u00a0switchport\u00a0|\u00a0i\u00a0Name|Negotiation</code></p>"},{"location":"cisco/Cisco_VLAN/#private-vlan","title":"Private VLAN","text":"<p>Vanligtvis kan allt i ett VLAN n\u00e5 \u00f6vrigt i samma VLAN obehindrat men det kan finnas situationer n\u00e4r man vill begr\u00e4nsa konnektivitet inom en broadcastdom\u00e4n. F\u00f6r att l\u00f6sa det togs protected ports fram, det konfas per interface med switchport protected. Om en port var protected kunde den endast n\u00e5 portar som inte var protected i det VLANet, dvs tv\u00e5 protected portar kan aldrig prata med varandra. Detta funkade lokalt inom switchen men ej mellan switchar och var d\u00e4rf\u00f6r inte s\u00e5 praktiskt i milj\u00f6er med fler \u00e4n en switch. F\u00f6r att l\u00f6sa det implementerades Private VLAN (RFC 5517). Detta anv\u00e4nds vanligtvis hos service providers som vill segmentera kunder fr\u00e5n varandra men bara anv\u00e4nda ett IP-n\u00e4t. PVLAN \u00e4r en mekanism som delar upp ett VLAN (primary) i secondary VLANs. Secondary VLAN finns i tv\u00e5 varianter, isolated och community. Secondary VLAN m\u00e5ste tillh\u00f6ra exakt ett primary VLAN. Det kan finnas flera community men isolated f\u00e5r det bara finnas ett av per primary.</p> <p>Inom en PVLAN-dom\u00e4n finns det tre separata porttyper. Varje porttyp har sin egen unika upps\u00e4ttning regler som reglerar en ansluten enhets f\u00f6rm\u00e5ga att kommunicera med andra anslutna enheter inom samma private VLAN. * Isolated port: En isolated port kan inte prata med n\u00e5gon annan port i private VLAN-dom\u00e4nen med undantag f\u00f6r promiscuous ports.</p> <ul> <li>Community port: En community port \u00e4r en del av en grupp med     portar. Portar i en community kan ha L2 kommunikation med varandra     och kan \u00e4ven prata med en promiscuous port.</li> </ul> <ul> <li>Promiscuous port: En promiscuous port kan prata med alla andra     typer av portar och tillh\u00f6r primary VLANet.</li> </ul> <p>Private VLAN fungerar \u00f6ver trunkl\u00e4nkar och d\u00e4rmed mellan switchar. Kommer en frame fr\u00e5n ett secondary VLAN och ska skickas \u00f6ver en trunkl\u00e4nk s\u00e5 taggas den med sitt VLAN ID. Kommer det en frame p\u00e5 en promiscuous port s\u00e5 taggas den med primary VLAN. Dvs om en frame ska fr\u00e5n en isolated port p\u00e5 en switch till en promiscuous port p\u00e5 en annan och sedan tillbaka kommer den ha olika VLAN-taggar p\u00e5 dit och tillbakav\u00e4gen, s\u00e5kallad assymetrisk VLAN-taggning. Det sker aldrig n\u00e5gon dubbeltaggning men switcharna m\u00e5ste \u00e4nd\u00e5 ha st\u00f6d f\u00f6r private VLAN och vara konfade likadant (PVLAN-m\u00e4ssigt) annars vet inte switcharna hur VLANen \u00e4r associerade med varandra.</p> <p>Det finns undantag till detta beteende t.ex. om man har en router-on-stick s\u00e5 vet inte den vad PVLAN \u00e4r. D\u00e5 kan man anv\u00e4nda promiscuous PVLAN trunk och p\u00e5 den skickas det aldrig ut n\u00e5got som \u00e4r taggat med ett secondary VLAN utan allt skrivs om till primary VLAN ID. Det finns \u00e4ven isolated PVLAN trunk, det fungerar tv\u00e4rtom, d\u00e5 skickas det alltid ut taggat som ett secondary vlan. Det \u00e4r anv\u00e4ndbart om man ska koppla ihop PVLAN med en switch som inte har st\u00f6d f\u00f6r det utan endast kan k\u00f6ra protected ports.</p> <p>Det \u00e4r m\u00f6jligt f\u00f6r tv\u00e5 isolerade hostar att kommunicera om ip local-proxy-arp \u00e4r konfigurerat p\u00e5 gateway. Det fungerar som proxy ARP fast inom subn\u00e4tet. Funktionerna DHCP Snooping, ARP Inspection och Source Guard p\u00e5 primary VLANet enablear det \u00e4ven p\u00e5 secondary VLANs.</p>"},{"location":"cisco/Cisco_VLAN/#konfiguration","title":"Konfiguration","text":"<p><code>vtp\u00a0mode\u00a0transparent</code></p> <p>Alternativt kan VTP version 3 anv\u00e4ndas.</p> <p>VLAN</p> <p><code>vlan\u00a0101</code> <code>private-vlan\u00a0isolated</code> <code>vlan\u00a0102</code> <code>private-vlan\u00a0community</code> <code>vlan\u00a0100</code> <code>private-vlan\u00a0primary</code> <code>private-vlan\u00a0assoc\u00a0101,102</code></p> <p>Access Ports</p> <p><code>interface\u00a0g0/1</code> <code>description\u00a0Gateway</code> <code>switchport\u00a0mode\u00a0private-vlan\u00a0promiscuous</code> <code>switchport\u00a0private-vlan\u00a0mapping\u00a0100\u00a0101-102</code></p> <p><code>interface\u00a0g0/2</code> <code>description\u00a0Isolated</code> <code>switchport\u00a0mode\u00a0private-vlan\u00a0host</code> <code>switchport\u00a0private-vlan\u00a0host-association\u00a0100\u00a0101</code></p> <p><code>interface\u00a0g0/3</code> <code>description\u00a0Community</code> <code>switchport\u00a0mode\u00a0private-vlan\u00a0host</code> <code>switchport\u00a0private-vlan\u00a0host-association\u00a0100\u00a0102</code></p> <p>Other switch</p> <p><code>interface\u00a0g0/4</code> <code>switchport\u00a0mode\u00a0trunk</code></p> <p>Promiscuous PVLAN Trunk Port</p> <p><code>interface\u00a0g0/5</code> <code>switchport\u00a0private-vlan\u00a0trunk\u00a0allowed\u00a0vlan\u00a0100-103</code> <code>switchport\u00a0private-vlan\u00a0mapping\u00a0trunk\u00a0103\u00a0130-135</code> <code>switchport\u00a0mode\u00a0private-vlan\u00a0trunk\u00a0promiscuous</code></p> <p>Notera att primary vlan ska vara med i allowed vlan list. Om man har t.ex. en ASA kan man k\u00f6ra med en vanlig switchport mode trunk om man vill f\u00f6r ASA har native st\u00f6d f\u00f6r PVLAN.</p> <p>SVI</p> <p><code>interface\u00a0Vlan100</code> <code>ip\u00a0address\u00a010.0.0.1\u00a0255.255.255.0</code> <code>private-vlan\u00a0mapping\u00a0101,102</code></p> <p>Verify</p> <p><code>show\u00a0vlan\u00a0private-vlan</code> <code>show\u00a0interfaces\u00a0vlan100\u00a0private-vlan\u00a0mapping</code> <code>ping\u00a0255.255.255.255</code></p>"},{"location":"cisco/Cisco_VLAN/#q-in-q","title":"Q-in-Q","text":"<p>Med IEEE 802.1Q tunneling kan man bygga en simpel L2 VPN genom att dubbeltagga Ethernet-frames.</p> <p>prereq</p> <p><code>system\u00a0mtu\u00a01504</code> <code>reload</code> <code>show\u00a0system\u00a0mtu</code></p> <p>Port</p> <p><code>switchport\u00a0mode\u00a0dot1q-tunnel</code> <code>l2protocol-tunnel\u00a0cdp</code></p> <p>Verify</p> <p><code>show\u00a0dot1q-tunnel</code></p> <p>Dubbeltaggning p\u00e5 router</p> <p><code>int\u00a0gi2</code> <code>mtu\u00a01504</code> <code>int\u00a0gi2.10</code> <code>encapsulation\u00a0dot1q\u00a010\u00a0second-dot1q\u00a0100,101</code></p>"},{"location":"cisco/Cisco_VLAN/#bridging","title":"Bridging","text":"<p>Med bridging kan man \u00e4ndra en routers beteende att bli mer likt hur en switch fungerar. F\u00f6r IOS-XE se l\u00e4ngre ner.</p> <p>Transparent Routern blir precis som en L2-switch, dvs ingen IP routing och STP anv\u00e4nds f\u00f6r loop prevention.</p> <p><code>no\u00a0ip\u00a0routing</code> <code>bridge\u00a01\u00a0protocol\u00a0vlan-bridge</code></p> <p><code>interface\u00a0gi0</code> <code>bridge-group\u00a01</code> <code>interface\u00a0gi1</code> <code>bridge-group\u00a01</code></p> <p>Verify</p> <p><code>show\u00a0bridge</code></p> <p>CRB Transparent bridging har en stor nackdel, en router kan inte b\u00e5de routa paket och brygga interface, d\u00e4rf\u00f6r finns Concurrent Routing and Bridging som till\u00e5ter b\u00e5de routing och bridging samtidigt. Dock inte p\u00e5 samma interface-grupper.</p> <p><code>bridge\u00a0crb</code> <code>ip\u00a0routing</code></p> <p><code>bridge\u00a01\u00a0protocol\u00a0vlan-bridge</code></p> <p><code>interface\u00a0gi0</code> <code>bridge-group\u00a01</code> <code>interface\u00a0gi1</code> <code>bridge-group\u00a01</code></p> <p>Verify</p> <p><code>show\u00a0bridge</code></p> <p>IRB En nackdel med CRB \u00e4r att det inte g\u00e5r att koppla ihop en routed domain med en bridged domain inom samma enhet, d\u00e4rf\u00f6r finns Integrated Routing and Bridging. D\u00e5 skapas Bridge Group Virtual Interface (BVI) som fungerar som SVI p\u00e5 L3-switchar.</p> <p>Prereqs &amp; Configuration</p> <p><code>bridge\u00a0irb</code> <code>ip\u00a0routing</code></p> <p><code>bridge\u00a01\u00a0route\u00a0ip</code> <code>bridge\u00a01\u00a0protocol\u00a0vlan-bridge</code></p> <p><code>interface\u00a0gi0</code> <code>bridge-group\u00a01</code> <code>interface\u00a0gi1</code> <code>bridge-group\u00a01</code> <code>interface\u00a0bvi1</code> <code>ip\u00a0address\u00a010.0.0.10\u00a0255.255.255.0</code></p> <p>Verify</p> <p><code>show\u00a0bridge</code></p> <p>Fallback Bridging Fallback Bridging anv\u00e4nds f\u00f6r att brygga icke-routebara protokoll mellan SVIer och routade interface. Ett protokoll kan routas medans det andra bryggas, t.ex. IPv4 kan routas medans IPv6 bryggas.</p> <p><code>bridge\u00a01\u00a0protocol\u00a0vlan-bridge</code></p> <p><code>interface\u00a0Gi0/2</code> <code>no\u00a0switchport</code> <code>ip\u00a0address\u00a010.0.2.10\u00a0255.255.255.0</code> <code>bridge-group\u00a01</code></p> <p><code>interface\u00a0Vlan10</code> <code>ip\u00a0address\u00a010.0.10.10\u00a0255.255.255.0</code> <code>bridge-group\u00a01</code></p> <p>IOS-XE P\u00e5 IOS-XE g\u00f6rs bridging med bridge domains och Ethernet flow points (EFP).</p> <p><code>interface\u00a0gi0/0/1</code> <code>service\u00a0instance\u00a01\u00a0ethernet</code> <code>encapsulation\u00a0untagged</code> <code>bridge-domain\u00a01</code></p> <p><code>interface\u00a0gi0/0/2</code> <code>service\u00a0instance\u00a01\u00a0ethernet</code> <code>encapsulation\u00a0untagged</code> <code>bridge-domain\u00a01</code> <code>l2protocol\u00a0peer\u00a0stp</code> <code>mac\u00a0limit\u00a0maximum\u00a0addresses\u00a050</code></p> <p><code>interface\u00a0bdi1</code> <code>ip\u00a0address\u00a010.0.0.10\u00a0255.255.255.0</code></p> <p>Verify</p> <p><code>show\u00a0bridge-domain</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_VSS/","title":"Cisco VSS","text":"<p>Virtual Switching System anv\u00e4nds f\u00f6r att g\u00f6ra tv\u00e5 stycken fysiska switchar till en logisk enhet. Fysiskt \u00e4r det tv\u00e5 switchar och man kan dra allt kablage redundant. Med detta beh\u00f6ver man inte anv\u00e4nda HSRP eller VRRP samt att L2-topologin g\u00e5r att h\u00e5lla loopfri. En f\u00f6rdel \u00e4r att det blir f\u00e4rre manageringspunkter, en nackdel att ett fel kan f\u00e5 st\u00f6rre blast radius. VSS har st\u00f6d f\u00f6r EtherChannel s\u00e5 detta \u00e4r en variant av MLAG. N\u00e4r switcharna bootar upp anv\u00e4nder de Link Management Protocol (LMP) och Role Resolution Protocol (RRP) f\u00f6r att f\u00f6rhandla om vem som ska vara active och s\u00e5ledes blir den andra standby. B\u00e5da switcharna st\u00e5r f\u00f6r data plane men endast den aktiva st\u00e5r f\u00f6r management och control plane. Mellan switcharna har man en Virtual Switch Link som all sorts trafik g\u00e5r p\u00e5, d\u00e4remot har control plane och management h\u00f6gre prio p\u00e5 denna l\u00e4nk. Denna b\u00f6r dimensioneras kraftigt.</p>"},{"location":"cisco/Cisco_VSS/#installation","title":"Installation","text":"<p>Man beh\u00f6ver 2st cisco 4500-x, 4500-e eller 6500-e. I e-modellerna s\u00e5 beh\u00f6vs Cisco Catalyst Supervisor Engine 7-E eller 7-LE men i x-modellerna \u00e4r den inbyggd.</p>"},{"location":"cisco/Cisco_VSS/#konfiguration","title":"Konfiguration","text":"<p>s\u00e4tt Virtual Switch domain samt switch nummer</p> <p><code>SW1#conf\u00a0t</code> <code>Enter\u00a0configuration\u00a0commands,\u00a0one\u00a0per\u00a0line.\u00a0End\u00a0with\u00a0CNTL/Z.</code> <code>SW1(config)#switch\u00a0virtual\u00a0domain\u00a010</code> <code>Domain\u00a0ID\u00a010\u00a0config\u00a0will\u00a0take\u00a0effect\u00a0only</code> <code>after\u00a0the\u00a0exec\u00a0command\u00a0'switch\u00a0convert\u00a0mode\u00a0virtual'\u00a0is\u00a0issued</code> <code>SW1(config-vs-domain)#switch\u00a01</code> <code>SW1(config-vs-domain)#exit</code> <code>SW1(config)#</code></p> <p><code>SW2#conf\u00a0t</code> <code>Enter\u00a0configuration\u00a0commands,\u00a0one\u00a0per\u00a0line.\u00a0End\u00a0with\u00a0CNTL/Z.</code> <code>SW2(config)#switch\u00a0virtual\u00a0domain\u00a010</code> <code>Domain\u00a0ID\u00a010\u00a0config\u00a0will\u00a0take\u00a0effect\u00a0only</code> <code>after\u00a0the\u00a0exec\u00a0command\u00a0'switch\u00a0convert\u00a0mode\u00a0virtual'\u00a0is\u00a0issued</code> <code>SW2(config-vs-domain)#switch\u00a02</code> <code>SW2(config-vs-domain)#exit</code> <code>SW2(config)#</code></p> <p>Konfigurera VSL Port Channel</p> <p><code>SW1(config)#int\u00a0port-channel\u00a05</code> <code>SW1(config-if)#switchport</code> <code>SW1(config-if)#switch\u00a0virtual\u00a0link\u00a01</code> <code>SW1(config-if)#no\u00a0shut</code> <code>SW1(config-if)#exit</code> <code>*Jan\u00a024\u00a005:19:57.092:\u00a0%SPANTREE-6-PORTDEL_ALL_VLANS:\u00a0Port-channel5\u00a0deleted\u00a0from\u00a0all\u00a0Vlans</code></p> <p><code>SW2(config)#int\u00a0port-channel\u00a010</code> <code>SW2(config-if)#switchport</code> <code>SW2(config-if)#switch\u00a0virtual\u00a0link\u00a02</code> <code>SW2(config-if)#no\u00a0shut</code> <code>SW2(config-if)#exit</code> <code>SW2(config)#</code> <code>*Jan\u00a024\u00a005:14:17.273:\u00a0%SPANTREE-6-PORTDEL_ALL_VLANS:\u00a0Port-channel10\u00a0deleted\u00a0from\u00a0all\u00a0Vlans</code></p> <p>Konfigurera VSL portarna</p> <p><code>SW1(config)#int\u00a0range\u00a0gig7/3\u00a0-\u00a04</code> <code>SW1(config-if-range)#switchport\u00a0mode\u00a0trunk</code> <code>SW1(config-if-range)#channel-group\u00a05\u00a0mode\u00a0on</code> <code>WARNING:\u00a0Interface\u00a0GigabitEthernet7/3\u00a0placed\u00a0in\u00a0restricted\u00a0config\u00a0mode.\u00a0All\u00a0extraneous\u00a0configs\u00a0removed!</code> <code>WARNING:\u00a0Interface\u00a0GigabitEthernet7/4\u00a0placed\u00a0in\u00a0restricted\u00a0config\u00a0mode.\u00a0All\u00a0extraneous\u00a0configs\u00a0removed!</code> <code>SW1(config-if-range)#exit</code></p> <p><code>SW2(config)#int\u00a0range\u00a0gig4/45\u00a0-\u00a046</code> <code>SW2(config-if-range)#switchport\u00a0mode\u00a0trunk</code> <code>SW2(config-if-range)#channel-group\u00a010\u00a0mode\u00a0on</code> <code>WARNING:\u00a0Interface\u00a0GigabitEthernet4/45\u00a0placed\u00a0in\u00a0restricted\u00a0config\u00a0mode.\u00a0All\u00a0extraneous\u00a0configs\u00a0removed!</code> <code>WARNING:\u00a0Interface\u00a0GigabitEthernet4/46\u00a0placed\u00a0in\u00a0restricted\u00a0config\u00a0mode.\u00a0All\u00a0extraneous\u00a0configs\u00a0removed!</code> <code>SW2(config-if-range)#exit</code></p> <p>Switcha \u00f6ver till VSS fr\u00e5n vanlig</p> <p><code>SW1#switch\u00a0convert\u00a0mode\u00a0virtual</code></p> <p><code>SW2#switch\u00a0convert\u00a0mode\u00a0virtual</code></p> <p>Kolla s\u00e5 att det fungerar</p> <p><code>SW1#show\u00a0switch\u00a0virtual</code></p> <p><code>Executing\u00a0the\u00a0command\u00a0on\u00a0VSS\u00a0member\u00a0switch\u00a0role\u00a0=\u00a0VSS\u00a0Active,\u00a0id\u00a0=\u00a01</code></p> <p><code>Switch\u00a0mode\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0:\u00a0Virtual\u00a0Switch</code> <code>Virtual\u00a0switch\u00a0domain\u00a0number\u00a0:\u00a010</code> <code>Local\u00a0switch\u00a0number\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0:\u00a01</code> <code>Local\u00a0switch\u00a0operational\u00a0role:\u00a0Virtual\u00a0Switch\u00a0Active</code> <code>Peer\u00a0switch\u00a0number\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0:\u00a02</code> <code>Peer\u00a0switch\u00a0operational\u00a0role\u00a0:\u00a0Virtual\u00a0Switch\u00a0Standby</code></p> <p><code>Executing\u00a0the\u00a0command\u00a0on\u00a0VSS\u00a0member\u00a0switch\u00a0role\u00a0=\u00a0VSS\u00a0Standby,\u00a0id\u00a0=\u00a02</code></p> <p><code>Switch\u00a0mode\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0:\u00a0Virtual\u00a0Switch</code> <code>Virtual\u00a0switch\u00a0domain\u00a0number\u00a0:\u00a010</code> <code>Local\u00a0switch\u00a0number\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0:\u00a02</code> <code>Local\u00a0switch\u00a0operational\u00a0role:\u00a0Virtual\u00a0Switch\u00a0Standby</code> <code>Peer\u00a0switch\u00a0number\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0:\u00a01</code> <code>Peer\u00a0switch\u00a0operational\u00a0role\u00a0:\u00a0Virtual\u00a0Switch\u00a0Active</code></p>"},{"location":"cisco/Cisco_VSS/#dual-active-detection","title":"Dual-Active Detection","text":"<p>F\u00f6rhindra att b\u00e5da supervisors blir aktiva vid VSL link failure.</p> <p><code>switch\u00a0virtual\u00a0domain\u00a010</code> <code>dual-active\u00a0detection\u00a0fast-hello</code></p> <p><code>interface\u00a0te1/1/24</code> <code>description\u00a0VSS\u00a0Fast-Hello</code> <code>no\u00a0switchport</code> <code>no\u00a0ip\u00a0address</code> <code>no\u00a0cdp\u00a0enable</code> <code>dual-active\u00a0fast-hello</code> <code>no\u00a0shut</code></p> <p>Verify</p> <p><code>show\u00a0switch\u00a0virtual\u00a0dual-active\u00a0fast-hello</code></p>"},{"location":"cisco/Cisco_VSS/#felsokning","title":"Fels\u00f6kning","text":"<p><code>show\u00a0switch\u00a0virtual</code> <code>show\u00a0switch\u00a0virtual\u00a0role</code> <code>show\u00a0switch\u00a0virtual\u00a0link</code></p> <p>Giants Om man ser giants counter g\u00e5 upp p\u00e5 VSL interface s\u00e5 \u00e4r det normalt eftersom VSL inter-switch control frame packets skickas som 1518 bytes + 32 byte DBUS header mellan switcharna.</p>"},{"location":"cisco/Cisco_VSS/#tips-n-trix","title":"Tips N Trix","text":"<p>Man kan anv\u00e4nda sig av 10ge interface ocks\u00e5 och inte enbart 1ge som st\u00e5r i guiden. Kommando f\u00f6r att byta vilken switch som \u00e4r aktiv.</p> <p><code>redundancy\u00a0force-switchover</code></p>"},{"location":"cisco/Cisco_VSS/#stackwise","title":"StackWise","text":"<p>F\u00f6r de lite mindre switchmodellerna finns StackWise f\u00f6r att koppla ihop flera enheter till en logisk. Switcharna kopplas ihop med speciella StackWise-kablar p\u00e5 baksidan. Man v\u00e4ljer en switch som man konfigurerar som master och sedan kopplar man ihop dem och bootar upp dem.</p> <p><code>switch\u00a01\u00a0priority\u00a015</code></p> <p>Kolla status p\u00e5 stacken</p> <p><code>show\u00a0switch</code> <code>show\u00a0switch\u00a0stack-bandwidth</code> <code>show\u00a0switch\u00a0stack-mode</code></p> <p>Firmware</p> <p><code>software\u00a0auto-upgrade\u00a0enable</code></p> <p>Reset the switch mode to N+1</p> <p><code>switch\u00a0clear\u00a0stack-mode</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_VTP/","title":"Cisco VTP","text":"<p>VTP st\u00e5r f\u00f6r VLAN Trunking Protocol men t\u00e4nk VLAN Management Protocol d\u00e5 det anv\u00e4nds f\u00f6r att managera VLAN-databaser p\u00e5 flera switchar centralt fr\u00e5n en switch. Det g\u00e5r endast \u00f6ver ISL/802.1q-l\u00e4nkar s\u00e5 trunk mellan switcharna \u00e4r ett m\u00e5ste. VTP annonserar VLAN ID, namn, typ och tillst\u00e5nd men dock inget om vilka portar som tillh\u00f6r vilket VLAN. VTP jobbar med revisionsnummer f\u00f6r att veta vilka databas som \u00e4r korrekt uppdaterad, h\u00f6gre revisionsnummer vinner. Se \u00e4ven Cisco VLAN.</p> <p>OBS VTP har potentialen att s\u00e4nka en hel L2-milj\u00f6 p\u00e5 n\u00e5gra enstaka sekunder, f\u00f6rst\u00e5 hur det fungerar och r\u00e4kna med riskerna.</p>"},{"location":"cisco/Cisco_VTP/#max-vtp-vlan","title":"Max VTP Vlan","text":"<p>I varje switchmodell s\u00e5 finns det ett max antal vlan den kan f\u00e5 ifr\u00e5n servern, sl\u00e5r detta i taket s\u00e5 g\u00e5r switchen in i transparent mode, dvs den tar inte emot nya utan k\u00f6r p\u00e5 det som finns.</p> Switch Max Vlan 2960TT,2960S,2960CX 255 2960CG,2960X,3750 1005 3650 4096"},{"location":"cisco/Cisco_VTP/#versioner","title":"Versioner","text":"<p>VTP finns i version 1, 2 och 3. VTPv1 \u00e4r default.</p> <p>Skillnader mellan v1 och v2.</p> <ul> <li>St\u00f6d f\u00f6r diverse Token Ring VLAN</li> <li>St\u00f6d f\u00f6r unknown TLV records, v1 ignorerar dessa.</li> <li>VLAN-databasen konsistenscheckas ej om \u00e4ndringen kommer med VTP.     Implementation optimization.</li> </ul>"},{"location":"cisco/Cisco_VTP/#pakettyper","title":"Pakettyper","text":"<p>G\u00e4ller VTPv1 och v2. Summary advertisements Skickas av server och client var 5 minut eller vid VLAN-modifikation och inneh\u00e5ller allt utom sj\u00e4lva VLAN-databasen. Inneh\u00e5ller VTP domain name, revision number, identity of last updater, time stamp of last update, MD5 sum of VLAN database, VTP password och antalet efterkommande Subset advertisements.</p>   Exempel:    [](/File:Cisco_VTP_Summary.png \"wikilink\")   <p>Subset advertisement Skickas ut efter en VLAN-f\u00f6r\u00e4ndring och inneh\u00e5ller hela databasen. Kan dock beh\u00f6vas flera paket ifall det \u00e4r en stor databas.</p>   Exempel:    [](/File:Cisco_VTP_Subset.png \"wikilink\")   <p>Advertisement requests Skickas av server och client n\u00e4r de vill ha hela VLAN-databasen, t.ex. n\u00e4r de f\u00e5r in en Summary Advertisement med h\u00f6gre revisionsnummer. Skickas \u00e4ven av klienter n\u00e4r de startas om eller blir client.</p>   Exempel:    [](/File:Cisco_VTP_Request.png \"wikilink\")   <p>VTP join messages Skickas av server och client var 6 sekund om pruning \u00e4r p\u00e5slaget. Ber\u00e4ttar om vilka VLAN som \u00e4r aktiva.</p>   Exempel:    [](/File:Cisco_VTP_Join.png \"wikilink\")"},{"location":"cisco/Cisco_VTP/#konfiguration","title":"Konfiguration","text":"<p><code>vtp\u00a0version\u00a0[version]</code></p> <p>Vill man byta vlan.dat kan man g\u00f6ra det, det har bara lokal signifikans.</p> <p><code>vtp\u00a0file</code><code>filename</code></p> <p>VTP kan st\u00e4ngas av per interface</p> <p><code>no\u00a0vtp</code> <code>show\u00a0vtp\u00a0interface</code></p> <p>Debug</p> <p><code>debug\u00a0sw-vlan\u00a0vtp\u00a0events</code> <code>debug\u00a0sw-vlan\u00a0vtp\u00a0packets</code></p>"},{"location":"cisco/Cisco_VTP/#domain","title":"Domain","text":"<p>Dom\u00e4n m\u00e5ste vara samma p\u00e5 alla enheter annars ignoreras updates, har man inget dom\u00e4nnamn konfigurerat l\u00e5nar man det som andra sidan skickar med i sina paket (v3 g\u00f6r ej s\u00e5). Byt namn p\u00e5 dom\u00e4n f\u00f6r att resetta revision number.</p> <p><code>vtp\u00a0domain\u00a0[domain]</code> <code>show\u00a0vtp\u00a0status</code></p> <p>Anv\u00e4nd l\u00f6senord f\u00f6r att skydda din milj\u00f6 annars kan t.ex. dom\u00e4ner propagera till switchar automatiskt. Detta skyddar ej mot eavesdropping utan endast mot unauthorized switches. En MD5-summa r\u00e4knas fram av VLAN-databasen och l\u00f6senordet f\u00f6r att sedan skickas med Summary advertisement. Hidden password \u00e4r VTPv3 only och d\u00e5 hashas l\u00f6senordet i vlan.dat ocks\u00e5, v1/2 funkar inte ifall det finns ett hidden password konfigurerat.</p> <p><code>vtp\u00a0password\u00a0SECRETZ\u00a0{hidden|secret}</code> <code>show\u00a0vtp\u00a0password</code></p>"},{"location":"cisco/Cisco_VTP/#modes","title":"Modes","text":"<p>Server P\u00e5 VTP-servrar skapar, modifierar och tar man bort VLAN, detta propageras sedan ut till klienter och \u00f6vriga servrar. Detta \u00e4r default f\u00f6r Cisco IOS men uppdateringar skickas inte f\u00f6rrens VTP domain \u00e4r konfigurerat. Uppdateringar accepteras fr\u00e5n server och client och VLAN sparas i vlan.dat.</p> <p><code>vtp\u00a0mode\u00a0server</code></p> <p>Client Beh\u00f6ver ej ha VTP domain konfigurerat utan tar det fr\u00e5n den f\u00f6rsta VTP-uppdateringen som tas emot. Dock m\u00e5ste vtp mode client konfigureras. Uppdateringar accepteras fr\u00e5n server och client och VLAN sparas i vlan.dat. Eftersom klienter originerar uppdateringar kan en klient med h\u00f6gre revisionsnummer uppdatera databasen p\u00e5 en server.</p> <p><code>vtp\u00a0mode\u00a0client</code></p> <p>Transparent Enheter i VTP mode transparent sl\u00e4pper igenom VTP frames om VTP domain matchar men behandlar dem aldrig sj\u00e4lv, VTP LOG RUNTIME: Relaying packet received on trunk Gi0/2 - in TRANSPARENT MODE. VLAN p\u00e5 dessa enheter sparas lokalt i running config och vlan.dat. OBS transparent mode forwarderar VTP om domain \u00e4r NULL.</p> <p><code>vtp\u00a0mode\u00a0transparent</code></p> <p>Off Finns endast med VTPv3 och st\u00e4nger av VTP-forwarding helt.</p> <p><code>vtp\u00a0mode\u00a0off</code></p>"},{"location":"cisco/Cisco_VTP/#pruning","title":"Pruning","text":"<p>VTP pruning erbjuder en dynamisk mekanism som automatisk konfigurerar vilka VLAN som ska till\u00e5tas p\u00e5 trunkar inom VTP-dom\u00e4nen. Sl\u00e5 p\u00e5 pruning f\u00f6r att hindra flooding i alla VLAN till switchar som inte har portar i alla VLAN. F\u00f6r utbyte av information om aktiva VLAN anv\u00e4nds VTP join messages. VTP pruning kan l\u00e4ras av VTP-klienter, s\u00e5 om man sl\u00e5r p\u00e5 det p\u00e5 en VTP-server och den b\u00f6rjar skicka ut join messages s\u00e5 kommer ocks\u00e5 klienterna att sl\u00e5 p\u00e5 pruning automatiskt.</p> <p><code>vtp\u00a0pruning</code></p> <p>By default \u00e4r alla VLAN utom 1 prune eligible. Vill man att endast vissa VLAN ska vara med i VTP pruning kan man l\u00e4gga dem per trunk i Prune Eligible List.</p> <p><code>switchport\u00a0trunk\u00a0pruning\u00a0vlan\u00a0VLAN-RANGE</code></p> <p>Verify</p> <p><code>show\u00a0interface\u00a0trunk</code></p>"},{"location":"cisco/Cisco_VTP/#vtpv3","title":"VTPv3","text":"<p>Med VTPv3 introduceras primary server och det \u00e4r bara dennes VLAN-databas som f\u00e5r modifieras och skickas ut i dom\u00e4nen. Alla andra servrar blir secondary. Vilken switch som \u00e4r primary server m\u00e5ste switcharna vara eniga om f\u00f6r att kommunicera. \u00c4r switchar oeniga blir det konflikt och ingen databas synkas, show vtp devices conflicts. Detta minskar ytterliggare risken f\u00f6r att oavsiktligt skriva \u00f6ver en VLAN-databas.</p> <p>Skillnader mellan v2 och v3.</p> <ul> <li>M\u00f6jligt att anv\u00e4nda krypterade l\u00f6senord \u00e4ven i vlan.dat.</li> <li>St\u00f6d f\u00f6r private och extended vlan, dvs \u00f6ver 1005.</li> <li>Off mode, alla VTP-meddelanden droppas, globalt eller per interface.</li> <li>St\u00f6d f\u00f6r mer \u00e4n bara VLAN-databassynk, det finns \u00e4ven en instans f\u00f6r     MST-konfiguration samt forwarda VTP-frames     f\u00f6r UNKNOWN features ifall det hittas p\u00e5 n\u00e5got i framtiden.</li> <li>St\u00f6d f\u00f6r att flagga VLAN som RSPAN,     dvs disables MAC learning i VLANet p\u00e5 alla switchar.</li> <li>Serverrollen, se nedan.</li> </ul> <p>Bak\u00e5tkompabilitet f\u00e5r man n\u00e4r man k\u00f6r v1/v2 p\u00e5 ena sidan och v3 p\u00e5 den andra d\u00e5 kommer v3 k\u00e4nna av det och \u00e5terg\u00e5 till v2 vilket tvingar den f\u00f6rsta switchen att anv\u00e4nda v2-only. v2-sidan kan aldrig uppdatera v3-dom\u00e4nen s\u00e5 allt i v2 b\u00f6r vara client.</p> <p>Konfiguration</p> <p><code>vtp\u00a0domain\u00a0hackernet.se</code> <code>vtp\u00a0version\u00a03</code></p> <p>Skapa VLAN</p> <p><code>vtp\u00a0mode\u00a0server</code> <code>vlan\u00a0100</code> <code>VTP`` ``VLAN`` ``configuration`` ``not`` ``allowed`` ``when`` ``device`` ``is`` ``not`` ``the`` ``primary`` ``server`` ``for`` ``vlan`` ``database.</code></p> <p>F\u00f6r att bli primary kr\u00e4vs l\u00f6senordet. Primary \u00e4r endast operational state, det \u00e4r inget som sparas i running eller startup.</p> <p><code>vtp\u00a0primary</code></p> <p>Ta primary utan att f\u00f6rst kontrollera efter conflicting devices (som annars kan ta lite tid).</p> <p><code>vtp\u00a0primary\u00a0vlan\u00a0force</code></p> <p>Verify</p> <p><code>show\u00a0vtp\u00a0status</code> <code>show\u00a0vtp\u00a0devices\u00a0\u00a0#Endast\u00a0v3-enheter\u00a0syns</code> <code>show\u00a0vtp\u00a0counters</code></p>"},{"location":"cisco/Cisco_VTP/#extended-vlans","title":"Extended VLANs","text":"<p>Varje g\u00e5ng man skapar en routed port eller SVI i en L3-switch binds ett VLAN till det interfacet f\u00f6r intern kommunikation till control plane. Detta g\u00f6rs lokalt och kan d\u00e4rmed skilja mellan switcharna i milj\u00f6n. Detta leder till att om man skapar ett h\u00f6gnummer-VLAN p\u00e5 en VTP server switch utan SVI:er s\u00e5 funkar det bra men det kanske inte skapas p\u00e5 alla switchar \u00e4ven om VTP fungerar som det ska, \"VLAN_CREATE_FAIL\" pga \"VLAN 1007 currently in use by GigabitEthernet0/3\". Vilka VLAN en switch anv\u00e4nder till detta beror p\u00e5 global policy i switchen.</p> <p><code>show\u00a0vlan\u00a0internal\u00a0usage</code></p> <p>Default \u00e4r att starta allokering p\u00e5 VLAN 1006 och g\u00e5 upp\u00e5t.</p> <p><code>vlan\u00a0internal\u00a0allocation\u00a0policy\u00a0ascending</code></p> <p>P\u00e5 nyare switchar kan man \u00e4ndra detta till att starta p\u00e5 vlan 4094 och g\u00e5 ner\u00e5t ist\u00e4llet.</p> <p><code>vlan\u00a0internal\u00a0allocation\u00a0policy\u00a0descending</code></p>"},{"location":"cisco/Cisco_VTP/#mst","title":"MST","text":"<p>MST-konfiguration kan ocks\u00e5 distribueras med hj\u00e4lp av VTPv3. Precis som f\u00f6r VLAN f\u00e5r endast \u00e4ndringar g\u00f6ras p\u00e5 primary server (som ej beh\u00f6ver vara samma som f\u00f6r feature VLAN).</p> <p><code>vtp\u00a0mode\u00a0server\u00a0mst</code> <code>vtp\u00a0mode\u00a0client\u00a0mst</code></p> <p>OBS att \u00e4ndra VTP mode f\u00f6r MST p\u00e5verkar spanning tree s\u00e5 det b\u00f6r g\u00f6ras under kontrollerade former.</p> <p>Ta primary-rollen</p> <p><code>vtp\u00a0primary\u00a0mst</code> <code>vtp\u00a0primary\u00a0mst\u00a0force</code></p> <p>Verify</p> <p><code>show\u00a0vtp\u00a0status</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_VXLAN/","title":"Cisco VXLAN","text":"<p>Virtual Extensible LAN (VXLAN) \u00e4r en network virtualization technology, med andra ord enkapsuleringsteknik (overlay). Det maximala antalet VLAN p\u00e5 ett Ethernet-n\u00e4tverk \u00e4r 4094 (IEEE 802.1Q). Med VXLAN h\u00f6js denna gr\u00e4ns till 16 miljoner. Ethernet frames enkapsuleras i IP-paket och transporteras med UDP, default UDP destination port \u00e4r 4789. Tack vare att det \u00e4r vanliga IP-paket som traverserar fabricen kan alla l\u00e4nkar anv\u00e4ndas och det finns st\u00f6d f\u00f6r ECMP. VXLAN i sig har inget separat control plane utan signalering f\u00e5r sk\u00f6tas av en extern controller, BGP EVPN eller flood and learn. Vid det senare s\u00e5 kommer L2 flooding (unknown unicast, broadcast) att emuleras med multicast och VTEP:arna kommer p\u00e5 s\u00e5 s\u00e4tt att l\u00e4ra sig vilka MAC-adresser som finns p\u00e5 andra sidan. Detta leder till att VXLAN i sig har ingen inbyggd felisolering s\u00e5 som t.ex. OTV har. VXLAN har inte st\u00f6d f\u00f6r service tags s\u00e5 som t.ex. Geneve har. Ska NX-OS manageras av en third-party controller m\u00e5ste man sl\u00e5 p\u00e5 NXDB. Se \u00e4ven Cisco VLAN.</p>"},{"location":"cisco/Cisco_VXLAN/#flood-and-learn","title":"Flood and Learn","text":"<p>VXLAN Gateway anv\u00e4nder sig av Network Virtualization Endpoint (NVE) Interface. F\u00f6r att kunna anv\u00e4nda multicast m\u00e5ste man k\u00f6ra PIM p\u00e5 underlay network. Om man ska enkapsulera frames som \u00e4r VLAN-taggade m\u00e5ste man ta bort taggen n\u00e4r det skickas VLAN -&gt; VXLAN och s\u00e4tta p\u00e5 den igen i andra riktningen, se exemplet (BD-oriented mode).</p> <p><code>interface\u00a0lo0</code> <code>ip\u00a0address\u00a011.11.11.11\u00a0255.255.255.255</code></p> <p><code>interface\u00a0nve1</code> <code>source-interface\u00a0Loopback0</code> <code>member\u00a0vni\u00a05001\u00a0mcast-group\u00a0239.0.10.10</code></p> <p><code>interface\u00a0GigabitEthernet2</code> <code>service\u00a0instance\u00a01\u00a0ethernet</code> <code>encapsulation\u00a0dot1q\u00a0100</code> <code>rewrite\u00a0ingress\u00a0tag\u00a0pop\u00a01\u00a0symmetric</code></p> <p><code>bridge-domain\u00a01</code> <code>member\u00a0vni\u00a05001</code> <code>member\u00a0GigabitEthernet2\u00a0service-instance\u00a01</code></p> <p>Unicast Om man inte kan k\u00f6ra multicast g\u00e5r det l\u00f6sa med unicast och headend replication (HER). D\u00e5 konfigurerar man member vni utan mcast-group och ist\u00e4llet pekar ut andra sidan VTEP:s manuellt.</p> <p><code>interface\u00a0nve1</code> <code>ingress-replication\u00a022.22.22.22</code></p> <p>Verify</p> <p><code>show\u00a0nve\u00a0vni</code> <code>show\u00a0nve\u00a0peers</code> <code>show\u00a0bridge-domain\u00a01</code> <code>show\u00a0mac\u00a0address-table\u00a0nve</code></p>"},{"location":"cisco/Cisco_VXLAN/#nexus","title":"Nexus","text":"<p>VXLAN \u00e4r en vanlig overlay-teknik i datacenter. Underlay ska l\u00f6sa routing mellan IPv4-loopbacks samt ha st\u00f6d f\u00f6r jumbo frames (mtu 9216). Man kan k\u00f6ra IP Unnumbered mellan leaf och spine. UDP port number \u00e4r 4789, detta g\u00e5r ej att st\u00e4lla om. ARP suppression \u00e4r supporterat. F\u00f6r tenants IGMP notera att interface nve1 default \u00e4r en static mrouter-port.</p> <p><code>feature\u00a0nv\u00a0overlay</code> <code>feature\u00a0vn-segment-vlan-based</code> <code>interface\u00a0nve1</code> <code>no\u00a0shutdown</code> <code>source-interface\u00a0loopback0</code></p> <p>Bridge domain med static flood list.</p> <p><code>vlan\u00a0100</code> <code>vn-segment\u00a010100</code></p> <p><code>interface\u00a0nve1</code> <code>member\u00a0vni\u00a010100</code> <code>ingress-replication\u00a0protocol\u00a0static</code> <code>peer-ip\u00a010.0.0.3</code> <code>peer-ip\u00a010.0.0.4</code> <code>peer-ip\u00a010.0.0.5</code></p> <p>Verify</p> <p><code>show\u00a0nve\u00a0int\u00a0nve1</code> <code>show\u00a0nve\u00a0peers</code> <code>show\u00a0nve\u00a0vni</code> <code>show\u00a0nve\u00a0vni\u00a0ingress-replication</code></p> <p>Multicast underlay Ingress replication supporteras p\u00e5 Nexus 9000 men inte Nexus 5600 eller Nexus 7000. Man f\u00e5r d\u00e5 l\u00f6sa BUM med multicast. Alla noder m\u00e5ste routa multicast. Best practice \u00e4r att ha RP i spine-lagret. Anv\u00e4nd anycast RP f\u00f6r lastdelning samt redundans. Notera att multicast kontra unicast \u00e4r ett designval som inneb\u00e4r en trade-off mellan control plane scalability och data plane efficiency.</p> <p>Spine</p> <p><code>ip\u00a0pim\u00a0rp-address\u00a010.0.0.100\u00a0group-list\u00a0224.0.0.0/4</code> <code>ip\u00a0pim\u00a0anycast-rp\u00a010.0.0.100\u00a010.0.0.2</code> <code>ip\u00a0pim\u00a0anycast-rp\u00a010.0.0.100\u00a010.0.0.3</code></p> <p><code>show\u00a0ip\u00a0mroute</code></p> <p>Nexus 5600 Nexus 5600 m\u00e5ste k\u00f6ra i store-and-forward switching mode f\u00f6r att supportera VXLAN encapsulation.</p> <p><code>hardware\u00a0ethernet\u00a0store-and-fwd-switching</code> <code>copy\u00a0run\u00a0start</code> <code>reload</code> <code>show\u00a0switching-mode</code></p>"},{"location":"cisco/Cisco_VXLAN/#vpc","title":"vPC","text":"<p>N\u00e4r man k\u00f6r vPC med VXLAN m\u00e5ste man s\u00e4tta en secondary IP address p\u00e5 det loopback som \u00e4r source f\u00f6r NVE. Denna ska vara samma p\u00e5 b\u00e5de vPC-peers och det \u00e4r s\u00e5 dom presenterar sig sj\u00e4lva som en enda VTEP till remote NVE peers. CFS dubbelkollar att man har gjort r\u00e4tt. D\u00e4remot om peer-linken g\u00e5r ner s\u00e5 kommer loopback primary address att anv\u00e4ndas som source p\u00e5 de VXLAN-enkapsulerade paketen som skickas iv\u00e4g.</p> <p>vPC Best practice n\u00e4r man k\u00f6r VXLAN.</p> <p><code>vpc\u00a0domain\u00a01</code> <code>peer-switch</code> <code>peer-keepalive\u00a0destination\u00a010.0.0.2\u00a0source\u00a010.0.0.1</code> <code>peer-gateway</code> <code>ipv6\u00a0nd\u00a0synchronize</code> <code>ip\u00a0arp\u00a0synchronize</code></p> <p>Man b\u00f6r ocks\u00e5 s\u00e4tta upp ett nve-peer-link-vlan f\u00f6r att f\u00f6rhindra suboptimal routing. Detta vlan ska endast till\u00e5tas p\u00e5 trunken som \u00e4r peer-link.</p> <p><code>vlan\u00a010</code></p> <p><code>vpc\u00a0nve\u00a0peer-link-vlan\u00a010</code></p> <p><code>interface\u00a0vlan10</code> <code>ip\u00a0router\u00a0ospf\u00a01\u00a0area\u00a00</code> <code>ip\u00a0ospf\u00a0cost\u00a02</code> <code>ip\u00a0pim\u00a0sparse-mode</code> <code>no\u00a0shut</code></p>"},{"location":"cisco/Cisco_VXLAN/#evpn","title":"EVPN","text":"<p>Se Cisco EVPN.</p>"},{"location":"cisco/Cisco_VXLAN/#gpe","title":"GPE","text":"<p>VXLAN Generic Protocol Extension finns till f\u00f6r att ge VXLAN till\u00e4gg s\u00e5som OAM och versionsm\u00f6jligheter.</p> <p><code>interface\u00a0Tunnel1</code> <code>ip\u00a0address\u00a0192.168.1.1\u00a0255.255.255.0</code> <code>tunnel\u00a0source\u00a0GigabitEthernet2</code> <code>tunnel\u00a0mode\u00a0vxlan-gpe\u00a0ipv4</code> <code>tunnel\u00a0destination\u00a010.0.0.20</code> <code>tunnel\u00a0vxlan\u00a0vni\u00a012345</code></p>"},{"location":"cisco/Cisco_VXLAN/#fhrp-over-vxlan","title":"FHRP \u00f6ver VXLAN","text":"<p>Man kan anv\u00e4nda FHRP-protokoll tillsammans med VXLAN. De skickar hello packets som d\u00e5 floodas \u00f6ver VXLAN overlayet. Man m\u00e5ste ge tcam till detta, hardware access-list tcam region arp-ether 256. Detta funkar endast med flood and learn VXLAN.</p> <p><code>interface\u00a0vlan\u00a0100</code> <code>ip\u00a0address\u00a0192.168.1.2/24</code> <code>hsrp\u00a0100</code> <code>ip\u00a0192.168.1.1</code></p>"},{"location":"cisco/Cisco_VXLAN/#q-in-vni","title":"Q-in-VNI","text":"<p>Endast VXLAN Bridging funkar med Q-in-VNI.</p> <p><code>interface\u00a0nve1</code> <code>overlay-encapsulation\u00a0vxlan-with-tag</code></p> <p><code>interface\u00a0ethernet\u00a01/4</code> <code>switchport\u00a0mode\u00a0dot1q-tunnel</code> <code>switchport\u00a0access\u00a0vlan\u00a0100</code> <code>spanning-tree\u00a0bpdufilter\u00a0enable</code></p> <p>Man kan \u00e4ven sl\u00e4ppa \u00f6ver LACPDU:er.</p> <p><code>interface\u00a0nve1</code> <code>overlay-encapsulation\u00a0vxlan-with-tag\u00a0tunnel-control-frames\u00a0lacp</code></p> <p>QinQ-QinVNI</p> <p><code>interface\u00a0Ethernet1/4</code> <code>switchport\u00a0trunk\u00a0allow-multi-tag</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_WAN/","title":"Cisco WAN","text":"<p>Den vanligaste L2-tekniken nuf\u00f6rtiden \u00e4r Ethernet men det finns andra.</p>"},{"location":"cisco/Cisco_WAN/#hdlc","title":"HDLC","text":"<p>Ciscos implementation av HDLC har ett 2-byte stort Type-f\u00e4lt som g\u00f6r det properit\u00e4rt, detta f\u00f6r att st\u00f6dja multipla protkoll \u00f6ver HDLC-l\u00e4nkar. HDLC \u00e4r default enkapsulering p\u00e5 seriella interface p\u00e5 Cisco-routrar och keepalives skickas default var 10:e sekund. DCE-\u00e4nden av kabeln st\u00e5r f\u00f6r clockrate.</p> <p>DCE eller DTE?</p> <p><code>show\u00a0controllers\u00a0serial\u00a00/0</code></p> <p>HDLC \u00e4r default.</p> <p><code>interface\u00a0serial\u00a00/0</code> <code>encapsulation\u00a0hdlc</code> <code>show\u00a0interface\u00a0serial\u00a00/0</code></p>"},{"location":"cisco/Cisco_WAN/#ppp","title":"PPP","text":"<p>PPP anv\u00e4nder likadan header som ursprungs HDLC men har ett Protocol-f\u00e4lt s\u00e5 det blir i princip Cisco HDLC. Det har dessutom fler features. PPP anv\u00e4nder kontrollprotokoll f\u00f6r L2 och L3. F\u00f6r L2 heter dessa Link Control Protocol (LCP) och f\u00f6r L3 heter de Network Control Protocol (NCP). Ett exempel p\u00e5 PPP NCP \u00e4r IPCP f\u00f6r IP och m\u00f6jligg\u00f6r dynamic address assignment. N\u00e4r LCP har f\u00f6rhandlat klart om Link Quality Monitoring, Looped link detection, LB/MLPPP och autentiseringsmetoder och sett resultat av dessa tar NCP vid.</p>   LCP Request:    [](/File:Cisco_WAN_LCP_Request.png \"wikilink\")     LCP Ack:    [](/File:Cisco_WAN_LCP_Ack.png \"wikilink\")     IPCP Request:    [](/File:Cisco_WAN_IPCP_Request.png \"wikilink\")     IPCP Ack:    [](/File:Cisco_WAN_IPCP_Ack.png \"wikilink\")   <p><code>interface\u00a0serial\u00a00/0</code> <code>encapsulation\u00a0ppp</code> <code>show\u00a0interface\u00a0serial\u00a00/0</code></p> <p>LQM st\u00e4lls med:</p> <p><code>ppp\u00a0quality\u00a0&lt;%&gt;</code></p> <p>Peer neighbor route \u00e4r en PPP feature som l\u00e5ter connected interfaces som inte \u00e4r p\u00e5 samma subn\u00e4t att kommunicera. Detta \u00e4r anv\u00e4ndbart t.ex. n\u00e4r man anv\u00e4nder ip unnumbered interfaces p\u00e5 PPP-l\u00e4nken men kan st\u00e4ngas av om interfacen befinner sig p\u00e5 samma subn\u00e4t. Detta \u00e4r p\u00e5slaget default p\u00e5 Cisco IOS n\u00e4r man anv\u00e4nder PPP-enkapsulering.</p> <p><code>interface</code> <code>no\u00a0peer\u00a0neighbor-route</code>"},{"location":"cisco/Cisco_WAN/#authentication","title":"Authentication","text":"<p>PPP har bl.a. st\u00f6d f\u00f6r PAP, CHAP, MS-CHAPv1/v2 och EAP.</p> <p>PAP</p> <p><code>username\u00a0R2\u00a0password\u00a0SECRET</code></p> <p><code>interface\u00a0serial\u00a00/0</code> <code>ppp\u00a0authentication\u00a0pap</code> <code>ppp\u00a0pap\u00a0sent-username\u00a0R1\u00a0password\u00a0SECRET</code></p> <p>CHAP, default anv\u00e4nds routerns hostname som username.</p> <p><code>username\u00a0R2\u00a0password\u00a0SECRET</code></p> <p><code>interface\u00a0serial\u00a00/0</code> <code>ppp\u00a0authentication\u00a0chap</code> <code>ppp\u00a0chap\u00a0hostname\u00a0R1</code> <code>ppp\u00a0chap\u00a0password\u00a0SECRET</code></p> <p>Anv\u00e4nd andra metoden som fallback genom att ange dem p\u00e5 samma rad.</p> <p><code>ppp\u00a0authentication\u00a0chap\u00a0pap</code></p> <p>Troubleshoot</p> <p><code>debug\u00a0ppp\u00a0authentication</code></p>"},{"location":"cisco/Cisco_WAN/#compression","title":"Compression","text":"<p>Det finns tv\u00e5 typer av compression, layer 2 payload compression och TCP/RTP header compression. Payload compression funkar b\u00e4st med stora paket medans header compression funkar b\u00e4st med sm\u00e5 paket. L2 payload compression kan g\u00f6ras med stacker, MPPC eller predictor. De f\u00f6rsta tv\u00e5 anv\u00e4nder lite mer CPU men brukar resultera i b\u00e4ttre ratio.</p> <p><code>compress\u00a0predictor</code></p> <p>TCP Header. Detta \u00e4r legacy-metoden f\u00f6r att konfigurera det, man kan ocks\u00e5 anv\u00e4nda MQC.</p> <p><code>ip\u00a0tcp\u00a0header-compression</code></p> <p>Encryption</p> <p><code>ppp\u00a0encrypt\u00a0mppe\u00a040\u00a0required</code></p> <p>Verify</p> <p><code>show\u00a0compress\u00a0details</code> <code>show\u00a0ppp\u00a0mppe</code></p>"},{"location":"cisco/Cisco_WAN/#mlppp","title":"MLPPP","text":"<p>Multilink PPP \u00e4r en teknik f\u00f6r att L2-lastdela p\u00e5 tv\u00e5 eller fler parallella seriella l\u00e4nkar. MLPPP fragmenterar frames och skickar dem \u00f6ver olika l\u00e4nkar.</p> <p><code>interface\u00a0multilink1</code> <code>encapsulation\u00a0ppp</code> <code>ppp\u00a0multilink</code> <code>ppp\u00a0multilink\u00a0group\u00a01</code></p> <p><code>interface\u00a0serial\u00a00/0</code> <code>encapsulation\u00a0ppp</code> <code>ppp\u00a0multilink</code> <code>ppp\u00a0multilink\u00a0group\u00a01</code></p> <p>Verify</p> <p><code>show\u00a0ppp\u00a0multilink</code> <code>show\u00a0interface\u00a0multilink1</code></p> <p>Interleaving F\u00f6r att f\u00f6rhindra att sm\u00e5 delay-k\u00e4nsliga paket hamnar bakom stora paket som tar l\u00e5ng tid att serialisera kan man anv\u00e4nda LFI. Det \u00e4r ett Cisco QoS tool som g\u00f6r att de sm\u00e5 paketen kan skickas mellan fragmenten av de stora paketen.</p> <p><code>interface\u00a0multilink1</code> <code>ppp\u00a0multilink\u00a0fragment-delay\u00a010</code> <code>ppp\u00a0multilink\u00a0interleave</code></p>"},{"location":"cisco/Cisco_WAN/#pppoe","title":"PPPoE","text":"<p>PPPoE (RFC 2516) \u00e4r enkapsulering av PPP \u00f6ver ethernet och anv\u00e4nds mest i gamla DSL-tj\u00e4nster. Det anv\u00e4nder en ethernet-baserad discovery-funktion f\u00f6r att klient ska hitta till server. PPPoE har inte support f\u00f6r MLPPP.</p>   Initiation (broadcast):    [](/File:Cisco_WAN_PPPoE_PADI.png \"wikilink\")     Offer:    [](/File:Cisco_WAN_PPPoE_PADO.png \"wikilink\")     Request:    [](/File:Cisco_WAN_PPPoE_PADR.png \"wikilink\")     Session-confirmation:    [](/File:Cisco_WAN_PPPoE_PADS.png \"wikilink\")     Termination:    [](/File:Cisco_WAN_PPPoE_PADT.png \"wikilink\")   <p>N\u00e4r MAC-adressen f\u00f6r servern \u00e4r k\u00e4nd och sessionen \u00e4r uppr\u00e4ttad kan PPP ta vid.</p>"},{"location":"cisco/Cisco_WAN/#server","title":"Server","text":"<p>P\u00e5 ethernet-interfacen beh\u00f6ver man inte ha n\u00e5gon IP-adress alls eftersom discovery-funktionen \u00e4r ethernet-baserad.</p> <p><code>bba-group\u00a0pppoe\u00a0global</code> <code>virtual-template\u00a01</code> <code>sessions\u00a0per-mac\u00a0limit\u00a02</code></p> <p><code>interface\u00a0gi2</code> <code>no\u00a0ip\u00a0address</code> <code>pppoe\u00a0enable\u00a0group\u00a0global</code></p> <p><code>interface\u00a0virtual-template\u00a01</code> <code>ip\u00a0address\u00a0192.168.0.1\u00a0255.255.255.0</code> <code>peer\u00a0default\u00a0ip\u00a0address\u00a0pool\u00a0PPPoE</code></p> <p><code>ip\u00a0local\u00a0pool\u00a0PPPoE\u00a0192.168.0.10\u00a0192.168.0.20</code></p>"},{"location":"cisco/Cisco_WAN/#klient","title":"Klient","text":"<p>PPPoE-klienter b\u00f6r ha MTU 1492 p\u00e5 sina dialer interface f\u00f6r att undvika fragmentering p\u00e5 ethernet-interface eftersom PPPoE l\u00e4gger p\u00e5 8 bytes header. Man kan anv\u00e4nda statiska ip-adresser, ip unnumbered eller dynamiska med hj\u00e4lp av IPCP p\u00e5 PPP-interfacet.</p> <p><code>interface\u00a0Fa0/1</code> <code>no\u00a0shut</code> <code>pppoe\u00a0enable</code> <code>pppoe-client\u00a0dial-pool-number\u00a01</code></p> <p><code>interface\u00a0Dialer1</code> <code>ip\u00a0mtu\u00a01492</code> <code>ip\u00a0tcp\u00a0adjust-mss\u00a01452</code> <code>encapsulation\u00a0ppp</code> <code>ip\u00a0address\u00a0negotiated</code><code>#IPCP</code> <code>dialer\u00a0pool\u00a01</code></p> <p>Verify</p> <p><code>show\u00a0pppoe\u00a0summary</code> <code>show\u00a0ppp\u00a0all</code> <code>show\u00a0pppoe\u00a0session</code> <code>show\u00a0derived-config\u00a0interface\u00a0virtual-access1.1</code></p> <p>Default route PPP kan dynamiskt installera en default route n\u00e4r IPCP-f\u00f6rhandlingen lyckas och ta bort den igen n\u00e4r dialer-interfacet g\u00e5r ner. Denna route \u00e4r en static route och f\u00e5r d\u00e4rmed AD 1 s\u00e5 det g\u00e5r ej att trumfa den.</p> <p><code>interface\u00a0Dialer1</code> <code>encapsulation\u00a0ppp</code> <code>ppp\u00a0ipcp\u00a0route\u00a0default</code></p> <p>SNMP</p> <p><code>snmp-server\u00a0enable\u00a0traps\u00a0pppoe</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_Wireless/","title":"Cisco Wireless","text":""},{"location":"cisco/Cisco_Wireless/#wlc-discovery","title":"WLC Discovery","text":"<ol> <li>Broadcast</li> <li>DNS</li> <li>DHCP option 43</li> <li>Hardcoded</li> <li>Previous WLC</li> </ol>"},{"location":"cisco/Cisco_Wireless/#ip-helper","title":"IP helper","text":"<p><code>ip\u00a0forward-protocol\u00a0udp\u00a05246</code> <code>ip\u00a0helper\u00a0[WLC-IP]</code></p>"},{"location":"cisco/Cisco_Wireless/#ap-join-troubleshooting","title":"AP Join Troubleshooting","text":"<ol> <li>Layer 3 connectivity (ping)</li> <li>AP Policy</li> <li>Controller time in relation to AP cert</li> <li>regulatory domain</li> <li>license limit</li> <li>AP model not supported on WLC version</li> <li>Mesh APs - AP Auth</li> <li>no AP Manager</li> </ol>"},{"location":"cisco/Cisco_Wireless/#tips-n-trix","title":"Tips N Trix","text":"<p>Om accesspunkt inte kopplar upp sig via DHCP eller dns s\u00e5 m\u00e5ste man h\u00e5rdkoda WLCn d\u00e5 det \u00e4r en bugg i den firmwaren som skickas med men uppgraderas n\u00e4r den f\u00e5r kontakt med WLC</p> <p><code>\"Capwap\u00a0AP\u00a0controller\u00a0IP\u00a0address\u00a0x.x.x.x\"\u00a0D\u00e4r\u00a0x.x.x.x\u00a0\u00e4r\u00a0IP\u00a0adressen\u00a0p\u00e5\u00a0din\u00a0WLC</code></p> <p>Om du har en MESH ap s\u00e5 m\u00e5ste du l\u00e4gga till en exception i WLCn f\u00f6r den skall koppla upp sig. Tex 1532E</p> <p><code>Security-&gt;AAA-&gt;AP\u00a0policys\u00a0d\u00e4r\u00a0under\u00a0l\u00e4gger\u00a0du\u00a0in\u00a0macadressen\u00a0p\u00e5\u00a0APn\u00a0sen\u00a0f\u00e5r\u00a0man\u00a0g\u00e5\u00a0in\u00a0p\u00e5\u00a0den\u00a0under\u00a0Monitor-&gt;\u00a0Detail\u00a0all\u00a0APs-&gt;\u00a0sen\u00a0den\u00a0valda\u00a0APn\u00a0och\u00a0byta\u00a0fr\u00e5n\u00a0Bridge\u00a0mode\u00a0till\u00a0Local\u00a0s\u00e5\u00a0fungerar\u00a0den\u00a0som\u00a0en\u00a0vanlig</code> <code>accesspunkt\u00a0igen.\u00a0D\u00e4r\u00a0under\u00a0kan\u00a0du\u00a0ocks\u00e5\u00a0byta\u00a0namn\u00a0p\u00e5\u00a0den.</code></p> <p>Om du vill Byta aktiv WLC i ett HA cluster anv\u00e4nder du kommandot:</p> <p><code>Redundancy\u00a0force-switchover</code></p> <p>L\u00e4gg till radius server (webgui)</p> <p><code>Logga\u00a0in\u00a0p\u00e5\u00a0WLC\u00a0sen\u00a0Security-&gt;AAA-&gt;Radius-&gt;Authentication\u00a0d\u00e4r\u00a0fyller\u00a0du\u00a0i\u00a0IP\u00a0adressen\u00a0till\u00a0din\u00a0radius\u00a0server\u00a0samt\u00a0den\u00a0PREshared\u00a0key\u00a0du\u00a0anv\u00e4nder\u00a0dig\u00a0av.</code></p> <p>Se hur redundansen ser ut p\u00e5 enheten</p> <p><code>show\u00a0redundancy\u00a0summary</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Cisco_pyATS/","title":"Cisco pyATS","text":"<p>Cisco pyATS \u00e4r ett testing framework skrivet i python. Det kan anv\u00e4ndas f\u00f6r att ta en snapshot p\u00e5 \"state\" i n\u00e4tverket. pyATS  runt och samlar in show-kommandon ifr\u00e5n n\u00e4tinfrastrukturen."},{"location":"cisco/Cisco_pyATS/#setup","title":"Setup","text":"<p>Installera</p> <p><code>pip\u00a0install\u00a0pyats[full]</code></p> <p>Skapa ett inventory, \u00e4ven kallat testbed.</p> <p><code>pyats\u00a0create\u00a0testbed\u00a0interactive\u00a0--output\u00a0testbed1.yml\u00a0--encode-password</code></p>"},{"location":"cisco/Cisco_pyATS/#diff","title":"Diff","text":"<p><code>pyats\u00a0learn\u00a0ospf\u00a0interface\u00a0routing\u00a0pim\u00a0mcast\u00a0vrf\u00a0ntp\u00a0arp\u00a0vlan\u00a0config\u00a0--testbed-file=aci_ipn.yml\u00a0--output=before_change</code></p> <p><code>**make\u00a0change\u00a0to\u00a0network**</code></p> <p><code>pyats\u00a0learn\u00a0ospf\u00a0interface\u00a0routing\u00a0pim\u00a0mcast\u00a0vrf\u00a0ntp\u00a0arp\u00a0vlan\u00a0config\u00a0--testbed-file=aci_ipn.yml\u00a0--output=after_change</code></p> <p><code>pyats\u00a0diff\u00a0before_change\u00a0after_change</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Nexus_1000V/","title":"Nexus 1000V","text":"<p>Nexus 1000V \u00e4r en distribuerad virtuell switch som str\u00e4cker sig \u00f6ver m\u00e5nga hypervisor-hostar. Varje server i datacentret representeras som ett linjekort i Nexusen och kan hanteras som om det vore ett linjekort i en fysisk Cisco switch. N1Kv har bl.a. st\u00f6d f\u00f6r NetFlow, IGMP Snooping, SPAN, VXLAN, Private VLAN, DHCP Snooping, DAI och IPSG. Nexus 1000V kan k\u00f6ras tillsammans med vSphere, Hyper-V eller KVM.</p> <p>Virtual Ethernet Module (VEM) \u00e4r ett virtuellt linjekort och k\u00f6rs som en del av ESXi-k\u00e4rnan (VEM agent) och ers\u00e4tter vSwitcharna.</p> <p>Virtual Supervisor Module (VSM) \u00e4r control plane och styr alla VEMs. I st\u00e4llet f\u00f6r fysiska SUPar k\u00f6rs VSM som vms p\u00e5 ESXi-hostarna. Konfigurationen g\u00f6rs i VSM och sl\u00e5r p\u00e5 alla VEMs.</p> <p>Du beh\u00f6ver vSphere Enterprise Plus licensiering f\u00f6r att kunna anv\u00e4nda Nexus 1000V.</p>"},{"location":"cisco/Nexus_1000V/#installation","title":"Installation","text":"<p>Dokumentation</p> <p><code>http://www.cisco.com/c/en/us/support/switches/nexus-1000v-switch-vmware-vsphere/products-installation-guides-list.html</code></p>"},{"location":"cisco/Nexus_1000V/#vsm","title":"VSM","text":"<p>VSM installeras som en vm.</p>"},{"location":"cisco/Nexus_1000V/#registrera-nexus-i-vcenter","title":"Registrera Nexus i vCenter","text":"<p><code>http://VSM-IP</code></p> <p>Ladda ner cisco_nexus1000v_extension.xml vCenter Manage Plug-ins -&gt; New Plug-in -&gt; xml file -&gt; Register Plug-in</p>"},{"location":"cisco/Nexus_1000V/#svs-connection","title":"SVS Connection","text":"<p>Kan g\u00f6ras i L2 eller L3 mode.</p> <p><code>svs\u00a0connection\u00a0vCenterName</code> <code>protocol\u00a0vmware-vim</code> <code>remote\u00a0ip\u00a0address</code> <code>vmware\u00a0dvs\u00a0datacenter-name</code> <code>max-ports\u00a08192</code> <code>connect</code> <p>Verify</p> <p><code>show\u00a0svs\u00a0connections</code> <code>show\u00a0module</code></p>"},{"location":"cisco/Nexus_1000V/#vem","title":"VEM","text":"<p>Linjekort, ett per esxi-host. Default s\u00e4tts ID dynamiskt men man kan binda det till uuid.</p> <p><code>vem\u00a03</code> <code>host\u00a0vmware\u00a0id\u00a08f862310-4c63-11e2-0000-00000000000f</code> <code>vem\u00a04</code> <code>host\u00a0vmware\u00a0id\u00a08f862310-4c63-11e2-0000-00000000001f</code></p> <p>Show</p> <p><code>show\u00a0module</code></p>"},{"location":"cisco/Nexus_1000V/#port-profile","title":"Port Profile","text":"<p>Fysiska NICs konfas med \"type ethernet\".</p> <p><code>port-profile\u00a0type\u00a0ethernet\u00a0vMotion-Uplink</code> <code>vmware\u00a0port-group</code> <code>switchport\u00a0mode\u00a0trunk</code> <code>switchport\u00a0trunk\u00a0allowed\u00a0vlan\u00a099</code> <code>no\u00a0shutdown</code> <code>state\u00a0enabled</code></p> <p><code>port-profile\u00a0type\u00a0ethernet\u00a0VM-Guests-Uplink</code> <code>vmware\u00a0port-group</code> <code>switchport\u00a0mode\u00a0trunk</code> <code>switchport\u00a0trunk\u00a0allowed\u00a0vlan\u00a0100,110,111,112,120,121</code> <code>no\u00a0shutdown</code> <code>system\u00a0vlan\u00a0100,120,121</code> <code>state\u00a0enabled</code></p> <p>System VLAN \u00e4r speciella vlan som f\u00e5r kommunicera innan VEM:en har lagts i vDS. Det betyder att forwarding p\u00e5 VEM kan g\u00f6ras innan VSM har programmerat forwarding tables.</p> <p>Management network.</p> <p><code>port-profile\u00a0type\u00a0vethernet\u00a0VMKernel</code> <code>capability\u00a0l3control</code> <code>vmware\u00a0port-group</code> <code>switchport\u00a0mode\u00a0access</code> <code>switchport\u00a0access\u00a0vlan\u00a0100</code> <code>no\u00a0shutdown</code> <code>system\u00a0vlan\u00a0100</code> <code>state\u00a0enabled</code></p> <p>Port profiles \"type vethernet\" \u00e4r motsvarigheten till port groups i VMware och f\u00f6r varje port profile i Nexus 1000v skapas en portgrupp i VMware.</p> <p><code>port-profile\u00a0type\u00a0vethernet\u00a0vMotion</code> <code>vmware\u00a0port-group</code> <code>switchport\u00a0mode\u00a0access</code> <code>switchport\u00a0access\u00a0vlan\u00a0116</code> <code>no\u00a0shutdown</code> <code>state\u00a0enabled</code></p> <p><code>port-profile\u00a0type\u00a0vethernet\u00a0VM-110</code> <code>vmware\u00a0port-group</code> <code>switchport\u00a0mode\u00a0access</code> <code>switchport\u00a0access\u00a0vlan\u00a0110</code> <code>no\u00a0shutdown</code> <code>state\u00a0enabled</code></p> <p><code>port-profile\u00a0type\u00a0vethernet\u00a0VM-111</code> <code>vmware\u00a0port-group</code> <code>switchport\u00a0mode\u00a0access</code> <code>switchport\u00a0access\u00a0vlan\u00a0111</code> <code>no\u00a0shutdown</code> <code>state\u00a0enabled</code></p> <p><code>port-profile\u00a0type\u00a0vethernet\u00a0N1Kv-Control</code> <code>vmware\u00a0port-group</code> <code>switchport\u00a0mode\u00a0access</code> <code>switchport\u00a0access\u00a0vlan\u00a0120</code> <code>no\u00a0shutdown</code> <code>system\u00a0vlan\u00a0120</code> <code>state\u00a0enabled</code></p> <p><code>port-profile\u00a0type\u00a0vethernet\u00a0N1Kv-Management</code> <code>vmware\u00a0port-group</code> <code>switchport\u00a0mode\u00a0access</code> <code>switchport\u00a0access\u00a0vlan\u00a0121</code> <code>no\u00a0shutdown</code> <code>system\u00a0vlan\u00a0121</code> <code>state\u00a0enabled</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Nexus_FabricPath/","title":"Nexus FabricPath","text":"<p>FabricPath \u00e4r en Ethernet fabric-teknologi framtagen av Cisco f\u00f6r Nexus-plattformen. Det \u00e4r designat f\u00f6r att ge h\u00f6g skalbarhet och flexibilitet inom ett datacenter genom att kombinera funktioner fr\u00e5n b\u00e5de lager 2 och lager 3. Det \u00e4r MAC-in-MAC overlay som ers\u00e4tter Spanning-tree protocol med f\u00f6rdelen att inte beh\u00f6va n\u00e5gra blockerade l\u00e4nkar i ett switchat core (L2MP). FabricPath-enheterna nyttjar protokollet Intermediate System to Intermediate System (IS-IS) f\u00f6r att utbyta information om hur milj\u00f6n ser ut (vilka switch ID som finns var) och bygger ett SPT (Shortest Path Tree) baserat p\u00e5 den informationen. Ingen STP k\u00f6rs inom FabricPath-n\u00e4tverket men alla FabricPath Layer 2 gateway devices ska ha samma l\u00e5ga prio f\u00f6r att FP ska vara STP-root och utifr\u00e5n sett \u00e4r alla FP-enheter en enda stor STP-switch.</p> <p>F\u00f6r data plane s\u00e5 enkapsuleras ethernet frames med en FabricPath-header med outside source address och outside destination address vilket sedan kan routas. FP anv\u00e4nder conversational learning och BUM skickas i ett MDT som automatiskt byggs av alla enheter, s\u00e5 alla f\u00e5r denna trafik och det \u00e4r loopfritt. F\u00f6r att veta hur multidestinationstrafik ska forwarderas anv\u00e4nds FTAG-f\u00e4ltet i FP-headern. Eftersom det anv\u00e4nds multipla FTAG:s som hashas emellan ger detta lastdelning. F\u00f6r att synka FTAG:ar anv\u00e4nds en extension till FabricPath IS-IS som heter DRAP (Dynamic Resource Allocation Protocol). DRAP anv\u00e4nds ocks\u00e5 f\u00f6r att assigna unika switch ID:n inom FP-dom\u00e4nen men detta g\u00e5r \u00e4ven att konfa manuellt.</p> <p>N\u00e4r man ska spegla portar (SPAN) kan man v\u00e4lja om man ska strippa fabricpath-headern eller inte. BFD kan man anv\u00e4nda om man k\u00f6r fabricpath som DCI-l\u00f6sning f\u00f6r att snabba upp konvergens. N\u00e4r man k\u00f6r vPC i kombination med FabricPath skapas en logisk switch genom att samma FP switch-id annonseras ut fr\u00e5n b\u00e5da noderna i vPC-dom\u00e4nen, detta kallas vPC+. Se \u00e4ven Nexus vPC.</p> <p>Wireshark kan inte avkoda FabricPath-frames.  <p>MAC Learning * Traditional = Learn SRC MAC of all received traffic</p> <ul> <li>FabricPath = Only learn SRC MAC if you already know DST MAC</li> </ul> <p><code>show\u00a0mac\u00a0address-table\u00a0learning\u00a0mode</code></p>"},{"location":"cisco/Nexus_FabricPath/#konfiguration","title":"Konfiguration","text":"<p>Aktivera FabricPath</p> <p><code>install\u00a0feature-set\u00a0fabricpath</code> <code>feature-set\u00a0fabricpath</code></p> <p>Skapa nyckel f\u00f6r autentisering</p> <p><code>key\u00a0chain\u00a0FABRICPATH</code> <code>key\u00a00</code> <code>key-string\u00a0topsecret123</code></p> <p>Global konfiguration med autentisering och fast convergence</p> <p><code>fabricpath\u00a0switch-id\u00a01</code> <code>fabricpath\u00a0timers\u00a0linkup-delay\u00a060</code></p> <p><code>fabricpath\u00a0domain\u00a0default</code> <code>spf-interval\u00a050\u00a050\u00a050</code> <code>lsp-gen-interval\u00a050\u00a050\u00a050</code> <code>authentication-type\u00a0md5\u00a0\u00a0\u00a0#LSP\u00a0authentication</code> <code>authentication\u00a0key-chain\u00a0FABRICPATH</code> <code>authentication-check</code> <code>log-adjacency-changes</code></p> <p>Konfigurera interface f\u00f6r FabricPath</p> <p><code>interface\u00a0Ethernet1/25</code> <code>switchport</code> <code>switchport\u00a0mode\u00a0fabricpath</code> <code>no\u00a0fabricpath\u00a0isis\u00a0hello-padding</code> <code>fabricpath\u00a0isis\u00a0authentication-type\u00a0md5\u00a0\u00a0\u00a0#hello\u00a0authentication</code> <code>fabricpath\u00a0isis\u00a0authentication\u00a0key-chain\u00a0FABRICPATH</code></p> <p><code>show\u00a0fabricpath\u00a0isis\u00a0interface\u00a0br</code></p> <p>VLAN</p> <p><code>vlan\u00a010</code> <code>mode\u00a0fabricpath</code> <code>name\u00a0Server</code> <code>vlan\u00a020</code> <code>mode\u00a0fabricpath</code> <code>name\u00a0DB</code> <code>exit</code></p> <p>Show</p> <p><code>show\u00a0fabricpath\u00a0switch-id</code> <code>show\u00a0fabricpath\u00a0topology</code> <code>show\u00a0fabricpath\u00a0conflict\u00a0all</code> <code>show\u00a0fabricpath\u00a0route</code> <code>show\u00a0fabricpath\u00a0isis</code></p> <p>Effektivisera LSP-hanteringen genom att byta IS-IS network type fr\u00e5n broadcast till p2p.</p> <p><code>interface\u00a0e1/1</code> <code>medium\u00a0p2p</code></p> <p>Traffic Engineering FabricPath g\u00f6r ECMP default men man kan styra vilka l\u00e4nkar som anv\u00e4nds genom att manipulera IGP-metricen. Detta g\u00f6rs per interface.</p> <p><code>interface\u00a0e1/1</code> <code>fabricpath\u00a0isis\u00a0metric\u00a0400</code></p> <p>BFD Man kan sl\u00e5 p\u00e5 BFD p\u00e5 alla FP-interface men notera att VLAN 1 m\u00e5ste vara i fabricpath mode. BFD-klienten blir fabricpath-isis. Echo mode inte \u00e4r supporterat.</p> <p><code>fabricpath\u00a0domain\u00a0default</code> <code>bfd</code></p> <p><code>show\u00a0bfd\u00a0neighbors\u00a0fabricpath</code></p>"},{"location":"cisco/Nexus_FabricPath/#anycast-hsrp","title":"Anycast HSRP","text":"<p>De aktiva HSRP-routrarna annonserar anycast switch ID som source switch ID f\u00f6r HSRP MAC i FabricPath IS-IS. Alla andra kan d\u00e5 lastdela genom att skicka till vilken HSRP-router som helst i gruppen. Max antal aktiva HSRP-routrar \u00e4r 4 st. Se \u00e4ven Cisco HSRP.</p> <p><code>hsrp\u00a0anycast\u00a01\u00a0ipv4</code> <code>switch-id\u00a0111</code> <code>vlan\u00a010,11,12</code> <code>priority\u00a0120</code> <code>no\u00a0shutdown</code></p> <p>Man m\u00e5ste k\u00f6ra HSRP version 2 p\u00e5 alla SVI:er som ska dra nytta av Anycast HSRP.</p> <p><code>show\u00a0hsrp\u00a0anycast</code></p>"},{"location":"cisco/Nexus_FabricPath/#troubleshooting","title":"Troubleshooting","text":"<p><code>ping\u00a0fabricpath\u00a0switch-id\u00a0101</code></p> <p>Send OAM Path Trace Request message to the egress switch ID</p> <p><code>traceroute\u00a0fabricpath\u00a0switch-id\u00a0101</code></p> <p>Operation, Administration, and Maintenance</p> <p><code>fabricpath-oam</code> <code>show\u00a0fabricpath\u00a0oam\u00a0loopback\u00a0database</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Nexus_VDC/","title":"Nexus VDC","text":"<p>Virtual Device Context kan anv\u00e4ndas f\u00f6r att virtualisera Nexusswitchar p\u00e5 Nexusswitchar. En fysisk switch blir flera logiska med egna fysiska portar och processer. Detta \u00e4r en partitioneringsteknik och varje VDC manageras f\u00f6r sig. Eftersom varje VDC har egen data plane, control plane och mgmt plane inneb\u00e4r detta en viss grad av fault isolation d\u00e4remot kan inte olika VDC:er k\u00f6ra olika versioner av NX-OS. Det fysiska mgmt0 interface delas dock men varje VDC f\u00e5r ha egen IP-adress. Varje VDC har \u00e4ven egna unika MAC-adresser, detta tas ifr\u00e5n backplanet (show sprom backplane). Notera att FCoE kr\u00e4ver sin egna VDC. Se \u00e4ven Cisco Nexus.</p> <p>User rights Default-VDC</p> <ul> <li>Network-Admin = VDC-Admin</li> <li>Network-Operator = VDC-Operator</li> </ul> <p>Non-Default VDC</p> <ul> <li>VDC-Admin = all read/write for that particular VDC</li> <li>VDC-Operator = read only access to that particular VDC</li> </ul>"},{"location":"cisco/Nexus_VDC/#konfiguration","title":"Konfiguration","text":"<p>Requires Advanced Services license</p> <p>Skapa Admin VDC, denna kontrollerar \u00f6vriga VDC:er. Denna har t.ex. hand om VDC creation, resource allocation, NX-OS upgrade, Ethanalyzer, System wide QoS, Port Channel load balancing hash, EEM applets. Inga line cards till\u00e5tna.</p> <p><code>conf</code> <code>system\u00a0admin-vdc</code></p> <p>Skapa VDC</p> <p><code>vdc</code><code>id\u00a02</code> <code>cpu-share\u00a010</code> <code>allocate\u00a0interface\u00a0Ethernet1/1-8</code> <code>boot-order\u00a01</code> <code>limit-resource\u00a0vlan\u00a0minimum\u00a0512\u00a0maximum\u00a04094</code> <p><code>vdc\u00a0VDC3\u00a0id\u00a03</code> <code>cpu-share\u00a010</code> <code>allocate\u00a0interface\u00a0Ethernet2/1-8</code> <code>boot-order\u00a02</code> <code>limit-resource\u00a0vlan\u00a0minimum\u00a0512\u00a0maximum\u00a04094</code></p> <p>Notera att \u00e4ndringar av en VDC \u00e4r disruptive. Man kan inte heller allokera enskilda interface till en VDC utan man allokerar en (eller flera) interface-range. Vilka interface som kan ing\u00e5 i en range avg\u00f6rs av hardware port group (asic) dvs detta skiljer sig mellan olika plattformar och linjekort. Skriver man en ogiltig range s\u00e5 kommer dock NX-OS korrigera det automatiskt. Man kan allts\u00e5 r\u00e5ka sno interface ifr\u00e5n en annan VDC om man inte t\u00e4nker sig f\u00f6r.</p> <p>Hoppa mellan VDC:ers CLI.</p> <p><code>switchto\u00a0vdc</code> <code>switchback</code> <p>Alias</p> <p><code>cli\u00a0alias\u00a0name\u00a0changeto\u00a0switchto\u00a0vdc</code></p> <p>Default visas VDC hostname som -, detta g\u00e5r att st\u00e4nga av. <p><code>no\u00a0vdc\u00a0combined-hostname</code></p>"},{"location":"cisco/Nexus_VDC/#high-availability","title":"High Availability","text":"<p>Man kan konfa vad som ska h\u00e4nda om en VDC kraschar. Man kan ha olika settings f\u00f6r single kontra dual supervisor. Det man kan v\u00e4lja p\u00e5 \u00e4r RESTART vdc, BRINGDOWN vdc, RELOAD supervisor, SWITCHOVER to standby supervisor.</p> <p><code>ha-policy\u00a0single-sup\u00a0bringdown\u00a0dual-sup\u00a0switchover</code></p>"},{"location":"cisco/Nexus_VDC/#verify","title":"Verify","text":"<p><code>show\u00a0vdc</code> <code>show\u00a0vdc\u00a0resource</code> <code>show\u00a0vdc\u00a0membership</code> <code>copy\u00a0running-config\u00a0startup-config\u00a0vdc-all</code></p> <p>Notera att det finns en VDC med ID 0, den anv\u00e4nds endast som en container f\u00f6r interface som inte f\u00e5r vara med i n\u00e5gon annan VDC.</p> <p>Nexus \u00e4r en switch men varje VLAN representeras internt av en bridge domain. Detta g\u00f6r att flera VDC:er kan deploya VLAN med samma ID.</p> <p><code>show\u00a0vlan\u00a0internal\u00a0bd-info\u00a0vlan-to-bd\u00a0all-vlan</code></p> <p>Har man f\u00f6r lite str\u00f6m f\u00f6r att klara ett PSU-bortfall startas inte alla linjekort, show module s\u00e4ger \"pwr-denied\". Man kan \u00e4ndra detta beteende f\u00f6r att st\u00e4nga av redundans.</p> <p><code>power\u00a0redundancy-mode\u00a0combined</code></p>"},{"location":"cisco/Nexus_VDC/#routing-tables","title":"Routing tables","text":"<p>Man kan styra hur mycket minne en VDC minimum och maximum f\u00e5r till IPv4 och IPv6 unicast och multicast routes.</p> <p><code>vdc\u00a0VDC3</code> <code>limit-resource\u00a0u4route-mem\u00a0minimum\u00a02\u00a0maximum\u00a0100</code></p> <p><code>show\u00a0vdc\u00a0resource\u00a0u4route-mem\u00a0detail</code></p> <p>Man ska s\u00e5klart monitorera hur mycket resurser sina VDC:er anv\u00e4nder men man kan ocks\u00e5 kolla hur mycket minne som beh\u00f6vs f\u00f6r en viss m\u00e4ngd routes.</p> <p><code>show\u00a0routing\u00a0ip\u00a0unicast\u00a0memory\u00a0estimate\u00a0routes\u00a0100000\u00a0next-hops\u00a02</code></p>"},{"location":"cisco/Nexus_VDC/#storage-vdc","title":"Storage VDC","text":"<p>Man kan anv\u00e4nda en Storage VDC f\u00f6r att k\u00f6ra Ethernet och FCoE i samma switch.</p> <p><code>license\u00a0fcoe\u00a0module\u00a02</code></p> <p><code>system\u00a0qos</code> <code>service-policy\u00a0type\u00a0network-qos\u00a0default-nq-7e-4q8q-policy</code></p> <p><code>vdc\u00a0SAN\u00a0type\u00a0storage</code> <code>allocate\u00a0interface\u00a0e2/1-8</code> <code>allocate\u00a0fcoe-vlan-range\u00a0100-101</code></p> <p>Category:Cisco</p>"},{"location":"cisco/Nexus_vPC/","title":"Nexus vPC","text":"<p>Virtual Port-Channel \u00e4r Ciscos MLAG-variant f\u00f6r Nexus-switchar. B\u00e5da switchar i paret \u00e4r aktiva f\u00f6r data plane men den ena noden st\u00e5r f\u00f6r control plane och tar d\u00e4rmed hand om BPDUer och LACPDUer. Det \u00e4r inte delad management plane, som t.ex. Cisco VSS. F\u00f6r att avg\u00f6ra om noderna i paret har kompatibel konfiguration (consistency validation) skickas en kopia med Cisco Fabric Services \u00f6ver peer-l\u00e4nken. Alla mac-adresser och IGMP snooping som switcharna l\u00e4r sig synkroniseras ocks\u00e5 mha CFS \u00f6ver peer-l\u00e4nken. Peer-l\u00e4nken \u00e4r med i STP men BPDU-hanteringen \u00e4r modifierad s\u00e5 peer link kommer aldrig att bli blocking/discarding. Icke-vPC portar kommer att hanteras av den lokala STP-processen p\u00e5 varje switch. Se \u00e4ven Cisco EtherChannel.</p> <p>Det g\u00e5r att k\u00f6ra dynamisk routing \u00f6ver vPC men generellt sett \u00e4r det inte rekommenderat samt att det endast g\u00e5r p\u00e5 vissa releaser. Det konfigureras under vPC-dom\u00e4nen med layer3 peer-router.</p>"},{"location":"cisco/Nexus_vPC/#initial-setup","title":"Initial setup","text":"<p>Aktivera vPC</p> <p><code>feature\u00a0vpc</code> <code>feature\u00a0lacp</code></p> <p>vPC peers skickar varje sekund keepalives mellan varandra. Man kan t.ex. anv\u00e4nda mgmt-portarna f\u00f6r keepalives, det \u00e4r endast sm\u00e5 UDP-paket som ska skickas och tas emot.</p>   Keepalive message:    [](/File:Nexus-vPC-Keepalive.PNG \"wikilink\")   <p>Exempel: skapa en dedikerad vrf f\u00f6r keepalives och assigna interface.</p> <p><code>vrf\u00a0context\u00a0VPC-KEEPALIVE</code> <code>interface\u00a0po1</code> <code>no\u00a0switchport</code> <code>vrf\u00a0member\u00a0VPC-KEEPALIVE</code> <code>ip\u00a0address\u00a010.255.255.1/30</code> <code>no\u00a0shut</code></p> <p>Dom\u00e4nkonfiguration En VPC-dom\u00e4n har default en restore-delay p\u00e5 30 sekunder.</p> <p><code>vpc\u00a0domain</code> <code>role\u00a0priority\u00a01</code> <code>system-priority\u00a01000</code> <code>system-mac\u00a000:00:11:11:22:22</code> <code>peer-keepalive\u00a0destination\u00a010.255.255.2\u00a0source\u00a010.255.255.1\u00a0vrf\u00a0VPC-KEEPALIVE</code> <code>peer-gateway</code> <code>auto-recovery</code> <code>ip\u00a0arp\u00a0synchronize</code> <code>ipv6\u00a0nd\u00a0synchronize</code> <p>Default-v\u00e4rden f\u00f6r keepalive: udp-port 3200, vrf management, interval 1000, timeout 5, precedence 6, hold-timeout 3</p> <p>\"system-priority\" och \"system-mac\" best\u00e4mmer vilken LACP system priority och actor system som ska anv\u00e4ndas i LACPDU:er. System MAC anv\u00e4nds \u00e4ven f\u00f6r BPDU:er. Om man k\u00f6r FabricPath l\u00e4gg \u00e4ven till: fabricpath switch-id  under dom\u00e4nkonfigurationen. Auto-recovery \u00e4r p\u00e5 default och det b\u00f6r det vara, det ser till att man kan bli forwarding trots att peer aldrig kommer upp, t.ex. om man endast har en switch eller den andra inte startar efter ett str\u00f6mavbrott. <p>Konfigurera vPC peer-link</p> <p><code>interface\u00a0port-channel2</code> <code>switchport</code> <code>switchport\u00a0mode\u00a0trunk</code> <code>spanning-tree\u00a0port\u00a0type\u00a0network\u00a0\u00a0#f\u00f6r\u00a0Bridge\u00a0Assurance</code> <code>vpc\u00a0peer-link</code></p> <p>Verify</p> <p><code>show\u00a0vpc</code> <code>show\u00a0vpc\u00a0peer-keepalive</code> <code>show\u00a0vpc\u00a0role</code> <code>logging\u00a0level\u00a0vpc\u00a05</code></p> <p>F\u00f6r att byta role: vpc role preempt</p>"},{"location":"cisco/Nexus_vPC/#konfiguration","title":"Konfiguration","text":"<p>Skapa vPC:er genom att assigna interface. Status p\u00e5 dessa vPC member ports signaleras med CFS mellan peers.</p> <p><code>interface\u00a0Ethernet1/20</code> <code>switchport\u00a0mode\u00a0trunk</code> <code>channel-group\u00a020\u00a0mode\u00a0active</code></p> <p><code>interface\u00a0port-channel20</code> <code>switchport\u00a0mode\u00a0trunk</code> <code>vpc\u00a020</code></p> <p>LACP NX-OS har \u201dgraceful convergence\u201d aktiverat som standard. Denna funktion f\u00f6rb\u00e4ttrar hanteringen av handskakningen f\u00f6r LACP. N\u00e4r en PortChannel g\u00e5r mot en enhet som inte k\u00f6r NX-OS s\u00e5 ska denna funktion st\u00e4ngas av f\u00f6r att minska risken att en individuell port g\u00e5r ner i \u201dsuspended state\u201d. Notera att man emot vmware esxi b\u00f6r sl\u00e5 p\u00e5 graceful convergence, CSCuy84084.</p> <p><code>interface\u00a0port-channel10</code> <code>no\u00a0lacp\u00a0graceful-convergence</code></p> <p>Individual port Portar som inte f\u00e5r in LACPDU:er r\u00e4knas som \"individual\". Man kan v\u00e4lja om portar som inte lyckas med LACP-f\u00f6rhandling ska fallbacka till individuella switchportar eller suspendas. Detta \u00e4r t.ex. anv\u00e4ndbart om man har servrar med multipla NIC som ska PXE-boota. Individuella switchportarna kommer att forts\u00e4tta skicka LACPDU:er f\u00f6r att f\u00f6rs\u00f6ka etablera LACP negotiation. Standardparametrarna f\u00f6r hanteringen av individuella portar inom en PortChannel skiljer sig mellan Nexus 7000 och Nexus 5000. N\u00e4r man uppgraderar till nyare NX-OS s\u00e5 l\u00e4ggs \"no lacp suspend-individual\" till i running config p\u00e5 interface med default-konfiguration, innan syntes inte detta. N\u00e4r Nexus 5000 ansluts till andra n\u00e4tverksenheter, anv\u00e4nd suspend-individual f\u00f6r PortChannel:n.</p> <p><code>interface\u00a0port-channel10</code> <code>lacp\u00a0suspend-individual</code></p> <p>Verify show vpc brief</p> <p><code>show\u00a0port-channel\u00a0database</code> <code>show\u00a0vpc\u00a0consistency-parameters\u00a0vpc\u00a05</code> <code>show\u00a0vpc\u00a0orphan\u00a0ports</code> <code>show\u00a0lacp\u00a0neighbor</code></p> <p>Vid en Type 1 mismatch f\u00f6r ett visst vlan s\u00e5 kommer vlanet endast att suspendas p\u00e5 vPC:er p\u00e5 secondary vPC peer, detta kallas graceful consistency check och \u00e4r p\u00e5 default.</p> <p>Advanced troubleshooting</p> <p><code>show\u00a0cfs\u00a0status</code> <code>show\u00a0cfs\u00a0peers</code> <code>show\u00a0cfs\u00a0internal\u00a0notification\u00a0log\u00a0name\u00a0vpc</code></p> <p>Load balancing method</p> <p><code>show\u00a0port-channel\u00a0load-balance</code></p> <p>Notera att p\u00e5 Nexus 7000 g\u00e5r det endast \u00e4ndra load balancing method i default VDC:n och detta sl\u00e5r chassis-wide, d\u00e4remot g\u00e5r det att st\u00e4lla in per linjekort.</p> <p>Multicast Peers utbyter metrics \u00f6ver CFS f\u00f6r nya sources.</p> <p><code>show\u00a0ip\u00a0pim\u00a0internal\u00a0vpc\u00a0rpf</code></p> <p>BDPU \u00c4ndra s\u00e5 att VPCer anv\u00e4nder Cisco OUI i BPDUer ist\u00e4llet f\u00f6r 0026.fxxx.0000.</p> <p><code>Nexus7000(config-vpc-domain)#\u00a0mac-address\u00a0bpdu\u00a0source\u00a0version\u00a02</code></p>"},{"location":"cisco/Nexus_vPC/#vpc-enhancements","title":"vPC Enhancements","text":"<p>Peer-switch vPC Peer-switch m\u00f6jligg\u00f6r f\u00f6r ett vPC-par att presentera sig som en logisk enhet i STP genom att de delar p\u00e5 ett virtuellt bridge ID. B\u00e5da peer-enheterna kommer \u00e4ven att skicka ut dessa identiska BPDU:er, samt processa inkommande BPDU:er. Om peer-switch inte \u00e4r p\u00e5slaget, \u00e4r det endast prim\u00e4r-enheten skickar ut BPDU:er och sekund\u00e4r-enheten agerar proxy f\u00f6r prim\u00e4ren och forwarderar inkommande BPDU:er till den \u00f6ver peer-l\u00e4nken. Tack vare peer-switch kortas trafikavbrottet till f\u00f6ljd av en peer-krasch ned avsev\u00e4rt, enligt Cisco sj\u00e4lva till under sekunden, p\u00e5 grund av att ingen logisk topologif\u00f6r\u00e4ndring sker i STP. Det rekommenderas att anv\u00e4nda sig av peer-switch i en vPC-dom\u00e4n.</p> <p>Med peer-switch p\u00e5slaget \u00e4r b\u00e5da peer-enheterna tvungna att ha exakt samma spanning tree-konfiguration f\u00f6r samtliga vPC VLAN. Peer-switch m\u00e5ste \u00e4ven det vara konfigurerat p\u00e5 b\u00e5da sidor. F\u00f6r att sl\u00e5 p\u00e5 peer-switch:</p> <p><code>vpc\u00a0domain\u00a01</code> <code>peer-switch</code></p> <p>Peer-gateway vPC Peer-gateway till\u00e5ter en vPC peer-enhet att agera gateway f\u00f6r paket som adresserats till den andra peer-enhetens MAC-adress. P\u00e5 s\u00e5 vis beh\u00e5lls routingen lokalt ist\u00e4llet f\u00f6r att i on\u00f6dan traversera peer-l\u00e4nken. Denna funktion \u00e4r huvudsakligen till f\u00f6r att p\u00e5 ett b\u00e4ttre s\u00e4tt hantera enheter som inte anv\u00e4nder standard-ARP f\u00f6r sin default gateway, till exempel vissa lastbalanserare. Det finns inga nackdelar med denna teknologi och rekommenderas att aktivera i alla vPC-installationer, \u00e4ven denna funktion ska aktiveras p\u00e5 b\u00e5da peer-enheterna. B\u00e5da vpc-peers blir ocks\u00e5 aktiva forwarders f\u00f6r HSRPs vMAC. F\u00f6r att sl\u00e5 p\u00e5 peer-gateway:</p> <p><code>vpc\u00a0domain\u00a01</code> <code>peer-gateway</code></p> <p>ARP Sync F\u00f6r att snabba upp \u00e5terskapandet av ARP-tabellen efter exempelvis peer-flap eller att ett SVI g\u00e5tt up kan man anv\u00e4nda sig av ARP-synkronisering mellan vPC-enheterna. Efter att n\u00e5got av tidigare n\u00e4mnda h\u00e4ndelser intr\u00e4ffat kommer b\u00e5da enheterna d\u00e5 att synkronisera sina ARP-tabeller med varandra \u00f6ver peer-l\u00e4nken. Det rekommenderas starkt att alltid aktivera IP ARP synchronization p\u00e5 b\u00e5da peer-enheterna. F\u00f6r att aktivera ARP sync:</p> <p><code>vpc\u00a0domain\u00a01</code> <code>ip\u00a0arp\u00a0synchronize</code></p> <p><code>show\u00a0ip\u00a0arp\u00a0vpc-statistics</code></p> <p>Nexus 9000 Om man sl\u00e5r p\u00e5 vPC Fast Convergence s\u00e5 enablear man en feature som heter MCT Down Handler. D\u00e5 skapas en lista med member ports, layer-3 interfaces (SVI:er) och alla vlan de anv\u00e4nder. Om peer-linken failar s\u00e5 skickas ett suspend-meddelande till alla dem samtidigt. Det betyder att SVI:erna inte st\u00e4ngs ner f\u00f6rst vilket f\u00f6rhindrar traffic loss.</p> <p><code>vpc\u00a0domain\u00a01</code> <code>fast-convergence</code></p> <p>Detta anv\u00e4nds f\u00f6r att f\u00f6rb\u00e4ttra konvergens av Layer 2 EVPN VXLAN.</p> <p><code>interface\u00a0port-channel\u00a010</code> <code>lacp\u00a0vpc-convergence</code></p> <p>Hybrid Setup - Spanning Tree Om man har en mix av enheter p\u00e5 vPC och icke-vPC-portar kopplade till sin vPC-dom\u00e4n kan man \u00e4nd\u00e5 v\u00e4lja att switcharna skickar ut olika BPDU:er och d\u00e4rmed lastdela trafiken VLAN-baserat. Denna konfig overidar annan stp rootprio-konf.</p> <p><code>spanning-tree\u00a0pseudo-information</code> <code>vlan\u00a010,20\u00a0root\u00a0priority\u00a016384</code> <code>vlan\u00a010\u00a0designated\u00a0priority\u00a04096</code> <code>vlan\u00a020\u00a0designated\u00a0priority\u00a061440</code></p>"},{"location":"cisco/Nexus_vPC/#failover-behavior","title":"Failover Behavior","text":"<p>Olika fel kan uppst\u00e5 i ett datacenter och vPC har vissa mekanismer f\u00f6r att hantera det. Om peer-l\u00e4nken g\u00e5r ner s\u00e5 anv\u00e4nds peer-keepalive f\u00f6r att kolla status p\u00e5 peeren. Om b\u00e5da noder \u00e4r aktiva kommer sekund\u00e4ren att st\u00e4nga ner alla sina vPC-portar, detta f\u00f6r att f\u00f6rhindra loopar. G\u00e5r b\u00e5de peer-l\u00e4nk och peer-keepalive ner samtidigt kan det vara sv\u00e5rt att uppt\u00e4cka samt m\u00f6jlig service disruption. K\u00f6r man heartbeats p\u00e5 mgmt-porten s\u00e5 m\u00e4rks \u00e5tminstone att man tappat mgmt av noderna. Heartbeat-gr\u00e4nser g\u00e5r att konfigurera.</p> <p>Om hela ena noden g\u00e5r ner s\u00e5 kommer den kvarvarande att ta \u00f6ver all forwardering. Var l\u00e4nkar redan innan device failure \u00f6verlastade kan det s\u00e5klart bli traffic drops. Finns det n\u00e5got konfigurationsfel mellan noderna s\u00e5 g\u00e5r inte Consistency Check igenom och d\u00e5 kommer endast den prim\u00e4ra noden att vara aktiv f\u00f6r forwardering. Beroende p\u00e5 typ av mismatch s\u00e5 genereras syslog-meddelanden.</p> <p><code>show\u00a0vpc\u00a0consistency-parameters\u00a0global</code></p>"},{"location":"cisco/Nexus_vPC/#back-to-back","title":"Back to Back","text":"<p>Man kan koppla ett vpc-par till ett annat vpc-par och k\u00f6ra en vpc p\u00e5 varje sida, detta kallas back-to-back vPC. Detta kan t.ex. anv\u00e4ndas mellan aggregation och access layer. Det g\u00e5r ocks\u00e5 att anv\u00e4nda som DCI-l\u00f6sning om man inte anv\u00e4nder n\u00e5gon overlay-teknik eller om man vill ha alla l\u00e4nkar aktiva och avgr\u00e4nsa STP. Man kan st\u00e4nga av att BPDU:er skickas (portfast) och ha varje DC i egen STP-dom\u00e4n.</p> <p>Det finns inga speciella kommandon eller h\u00e5rdvarukrav f\u00f6r detta utan det \u00e4r en implementationsvariant, man konfar vpc p\u00e5 b\u00e5da sidor. Dock m\u00e5ste vPC domain ID skilja sig mellan paren.</p> <p> <p>Category:Cisco</p>"},{"location":"cumulus/Cumulus_EVPN/","title":"Cumulus EVPN","text":"<p>Ethernet VPN (RFC 7432) \u00e4r en modernare variant \u00e4n VPLS f\u00f6r att tillhandah\u00e5lla Ethernet multipoint services \u00f6ver IP (VXLAN) eller MPLS utan att beh\u00f6va en central controller. EVPN \u00e4r en adressfamilj i BGP som anv\u00e4nds f\u00f6r peer discovery och f\u00f6r att distribuera lokala MAC-adresser och MAC/IP bindings till andra tunnel endpoints. Man anv\u00e4nder b\u00e5de L2 och L3 forwarding information och det fungerar ihop med externa IP-prefix. Next-hop i EVPN-uppdateringarna \u00e4r antingen egress Label Switch Router eller VXLAN Tunnel Endpoint. EVPN skalar bra och har bl.a. features f\u00f6r att h\u00e5lla koll p\u00e5 hostar som flyttar mellan datacenter (sekvensnummer-community i annonseringarna) och kan d\u00e5 konvergera snabbt. Ett EVPN-n\u00e4tverk kan g\u00f6ra b\u00e5de bridging och routing och har inbyggd support f\u00f6r multi-tenancy (VPN).</p> <p>Protokollet \u00e4r \u00f6ppet s\u00e5 det finns interoperability med andra network vendors, se t.ex. Arista, Cisco och Quagga EVPN.</p>"},{"location":"cumulus/Cumulus_EVPN/#konfiguration","title":"Konfiguration","text":"<p>EVPN kan konfigureras p\u00e5 olika s\u00e4tt beroende p\u00e5 hur designen ser ut. Denna artikel har fokus p\u00e5 VXLAN f\u00f6r data plane encapsulation.</p>"},{"location":"cumulus/Cumulus_EVPN/#underlay","title":"Underlay","text":"<p>Underlay routing kan g\u00f6ras med IGP, iBGP eller eBGP. Alla VTEP:s m\u00e5ste kunna n\u00e5 varandra. Simpelt exempel:</p> <p><code>net\u00a0add\u00a0loopback\u00a0lo\u00a0ip\u00a0address\u00a01.1.1.1/32</code> <code>net\u00a0add\u00a0ospf\u00a0redistribute\u00a0connected</code> <code>net\u00a0add\u00a0ospf\u00a0network\u00a00.0.0.0/0\u00a0area\u00a00</code></p>"},{"location":"cumulus/Cumulus_EVPN/#overlay","title":"Overlay","text":"<p>EVPN-peering kan g\u00f6ras b\u00e5de med iBGP och eBGP, det \u00e4r designen som avg\u00f6r. Om man k\u00f6r eBGP mellan leaf och spine f\u00e5r inte spine \u00e4ndra next-hop i EVPN-uppdateringarna. Man kan v\u00e4lja att alla lokala VNI:er ska annonseras med BGP.</p> <p><code>net\u00a0add\u00a0bgp\u00a0autonomous-system\u00a065000</code> <code>net\u00a0add\u00a0bgp\u00a0neighbor\u00a0172.16.0.2\u00a0remote-as\u00a065000</code> <code>net\u00a0add\u00a0bgp\u00a0neighbor\u00a0172.16.0.2\u00a0update-source\u00a0lo</code> <code>net\u00a0add\u00a0bgp\u00a0l2vpn\u00a0evpn\u00a0neighbor\u00a0172.16.0.2\u00a0activate</code> <code>net\u00a0add\u00a0bgp\u00a0l2vpn\u00a0evpn\u00a0advertise-all-vni</code></p> <p>EBGP EVPN</p> <p><code>net\u00a0add\u00a0bgp\u00a0bestpath\u00a0as-path\u00a0multipath-relax</code></p> <p>Show</p> <p><code>net\u00a0show\u00a0bgp\u00a0evpn\u00a0summary</code></p>"},{"location":"cumulus/Cumulus_EVPN/#bridging","title":"Bridging","text":"<p>P\u00e5 varje leaf switch mappas local VLAN till ett VNI (VLAN-based mode). Man b\u00f6r disablea data plane MAC learning eftersom EVPN tar hand om att utbyta mac-adresser mellan VTEP:s. VNI membership utbyts mellan VTEP:s med hj\u00e4lp av EVPN type-3. RD/RT-derivering samt import och export g\u00f6rs automatiskt.</p> <p><code>net\u00a0add\u00a0vlan\u00a0100</code></p> <p><code>net\u00a0add\u00a0vxlan\u00a0VNI100\u00a0vxlan\u00a0id\u00a010100</code> <code>net\u00a0add\u00a0vxlan\u00a0VNI100\u00a0vxlan\u00a0local-tunnelip\u00a01.1.1.1</code> <code>net\u00a0add\u00a0vxlan\u00a0VNI100\u00a0bridge\u00a0access\u00a0100</code> <code>net\u00a0add\u00a0vxlan\u00a0VNI100\u00a0bridge\u00a0learning\u00a0off</code> <code>net\u00a0add\u00a0vxlan\u00a0VNI100\u00a0mtu\u00a09216</code></p> <p>Show</p> <p><code>net\u00a0show\u00a0evpn\u00a0vni</code> <code>net\u00a0show\u00a0bridge\u00a0macs</code></p>"},{"location":"cumulus/Cumulus_EVPN/#l3","title":"L3","text":"<p>Cumulus kan g\u00f6ra b\u00e5de symmetric och asymmetric VXLAN-routing och har st\u00f6d f\u00f6r L3 multi-tenancy. F\u00f6r asymmetric mode beh\u00f6vs ingen mer konf \u00e4n att man per tenant skapar ett anycast SVI p\u00e5 alla leaf. F\u00f6r symmetric mode routing beh\u00f6ver BGP en 1-till-1 mappning mellan L3VNI och tenant-VRF, detta m\u00e5ste vara samma \u00f6verallt. Man installerar mac-adresser f\u00f6r remote VTEP:s samt genererar RMAC lokalt med ett \"dummy\"-SVI per switch. RT-import och export g\u00f6rs automatiskt utifr\u00e5n ASN och VNI.</p> <p>Distributed symmetric routing</p> <p><code>net\u00a0add\u00a0vrf\u00a0Tenant1</code></p> <p><code>net\u00a0add\u00a0vxlan\u00a0VNI30001\u00a0vxlan\u00a0id\u00a030001</code> <code>net\u00a0add\u00a0vxlan\u00a0VNI30001\u00a0bridge\u00a0access\u00a02301</code> <code>net\u00a0add\u00a0vxlan\u00a0VNI30001\u00a0vxlan\u00a0local-tunnelip\u00a01.1.1.1</code> <code>net\u00a0add\u00a0vxlan\u00a0VNI30001\u00a0bridge\u00a0learning\u00a0off</code> <code>net\u00a0add\u00a0vxlan\u00a0VNI30001\u00a0bridge\u00a0arp-nd-suppress\u00a0on</code> <code>net\u00a0add\u00a0bridge\u00a0bridge\u00a0ports\u00a0VNI30001</code></p> <p><code>net\u00a0add\u00a0vlan\u00a02301\u00a0vrf\u00a0Tenant1</code> <code>net\u00a0add\u00a0vrf\u00a0Tenant1\u00a0vni\u00a030001</code></p> <p>Show</p> <p><code>net\u00a0show\u00a0evpn\u00a0vni</code> <code>net\u00a0show\u00a0evpn\u00a0rmac\u00a0vni\u00a0all</code></p> <p>Anycast GW</p> <p><code>net\u00a0add\u00a0vlan\u00a0100\u00a0ip\u00a0address-virtual\u00a000:00:11:11:22:22\u00a010.0.0.1/24</code> <code>net\u00a0add\u00a0vlan\u00a0100\u00a0vrf\u00a0Tenant1</code></p> <p>ARP/ND Suppression Man kan l\u00e5ta en lokal ARP-proxy hantera requests f\u00f6r att suppressa ARP flooding \u00f6ver VXLAN s\u00e5 mycket som m\u00f6jligt. MAC+IP address advertisement beh\u00f6vs f\u00f6r ARP suppression.</p> <p><code>net\u00a0add\u00a0vxlan\u00a0VNI100\u00a0bridge\u00a0arp-nd-suppress\u00a0on</code></p> <p>Show</p> <p><code>net\u00a0show\u00a0evpn\u00a0arp-cache\u00a0vni\u00a0all</code></p> <p>Type-5 Routes Prefix-based routing anv\u00e4nds prim\u00e4rt f\u00f6r destinations utanf\u00f6r DC. EVPN-routes har L3-VNI och RMAC enligt symmetric routing model.</p> <p><code>net\u00a0add\u00a0bgp\u00a0vrf\u00a0Tenant1\u00a0autonomous-system\u00a065000</code> <code>net\u00a0add\u00a0bgp\u00a0vrf\u00a0Tenant1\u00a0l2vpn\u00a0evpn\u00a0advertise\u00a0ipv4\u00a0unicast</code></p>"},{"location":"cumulus/Cumulus_EVPN/#mlag","title":"MLAG","text":"<p>Cumulus har st\u00f6d f\u00f6r dual-attached hosts i VXLAN active-active mode. Det kr\u00e4vs ingen speciell konfiguration f\u00f6r detta mer \u00e4n att alla VNI:er m\u00e5ste konfas identiskt och att peerlinken tillh\u00f6r bridge. MAC synchronization g\u00f6rs inte med EVPN utan med MLAG.</p> <p><code>interface\u00a0lo</code> <code>address\u00a01.1.1.1/32</code> <code>clagd-vxlan-anycast-ip\u00a01.1.1.100</code></p> <p>Denna anycast-adress s\u00e4tts som next-hop i de EVPN-uppdaterignar som skickas ut s\u00e5 den adressen m\u00e5ste annonseras i underlay.</p> <p>Category:Cumulus</p>"},{"location":"cumulus/Cumulus_Linux/","title":"Cumulus Linux","text":"<p>Cumulus Linux \u00e4r ett \u00f6ppet Network OS som man kan k\u00f6ra p\u00e5 white-box switches. Det \u00e4r baserat p\u00e5 Debian och man har tillg\u00e5ng till allt som Debian \u00e4r kapabelt till. Cumulus st\u00e5r f\u00f6r en switch daemon, asic drivers och Network Command Line Utility (NCLU) och kan bootstrapas med ONIE. Routingmotorn i Cumulus Linux \u00e4r Free Range Routing (FRR) och allt som FRR st\u00f6djer fungerar. Default \u00e4r ARP-timeouten 18 minuter. Cumulus-mjukvaran i sig \u00e4r gratis att anv\u00e4nda men det kr\u00e4vs en licens f\u00f6r att aktivera front-panel interfaces.</p>"},{"location":"cumulus/Cumulus_Linux/#cumulus-vx","title":"Cumulus VX","text":"<p>Cumulus Linux finns som free virtual appliance att ladda ner fr\u00e5n Cumulus Networks hemsida. Det finns image f\u00f6r KVM och VMware. Se \u00e4ven EVE-NG.</p>"},{"location":"cumulus/Cumulus_Linux/#architecture","title":"Architecture","text":"<p>"},{"location":"cumulus/Cumulus_Linux/#konfiguration","title":"Konfiguration","text":"<p>H\u00e4r nedan f\u00f6ljer hur man g\u00f6r grundl\u00e4ggande konfiguration av Cumulus Linux. \u00c4r man os\u00e4ker p\u00e5 hur n\u00e5got konfas kan man alltid kolla exempel med hj\u00e4lp av net example . <p>Hostname</p> <p><code>net\u00a0add\u00a0hostname\u00a0Cum01</code></p> <p>Configuration, kan visas i olika format</p> <p><code>net\u00a0show\u00a0configuration</code> <code>net\u00a0show\u00a0configuration\u00a0commands</code></p> <p>Commit</p> <p><code>net\u00a0pending</code> <code>net\u00a0commit</code></p> <p><code>net\u00a0show\u00a0commit\u00a0last</code> <code>net\u00a0show\u00a0commit\u00a0history</code></p> <p>Switch upgrade</p> <p><code>sudo\u00a0apt-get\u00a0update\u00a0&amp;&amp;\u00a0sudo\u00a0apt-get\u00a0upgrade</code></p> <p>Mgmt VRF. Notera att services som syslog, ntp etc default ligger i default-tabellen och m\u00e5ste bindas om ifall de ska nyttja mgmt-vrf:en.</p> <p><code>net\u00a0add\u00a0vrf\u00a0mgmt</code></p> <p>Skapa vlan. Cumulus reserverar default vlan 3000-3999 f\u00f6r internal usage men det g\u00e5r att \u00e4ndra.</p> <p><code>net\u00a0add\u00a0vlan\u00a0100-200</code></p> <p>Access port</p> <p><code>net\u00a0add\u00a0interface\u00a0swp4\u00a0bridge\u00a0access\u00a0100</code></p> <p>SVI</p> <p><code>net\u00a0add\u00a0vlan\u00a0100\u00a0ip\u00a0address\u00a0192.168.10.1/24</code></p> <p>Switchport trunk allowed vlan</p> <p><code>net\u00a0add\u00a0interface\u00a0swp3\u00a0bridge\u00a0vids\u00a0200,205</code></p> <p>Det spelar inte n\u00e5gon roll vad man v\u00e4ljer att konfigurera f\u00f6rst. N\u00e4r man commitar n\u00e5got switchrelaterat s\u00e5 skapas det en global switch (bridge).</p> <p>Useful show commands</p> <p><code>net\u00a0show\u00a0version</code> <code>net\u00a0show\u00a0interface</code> <code>net\u00a0show\u00a0bridge\u00a0vlan</code> <code>net\u00a0show\u00a0bridge\u00a0macs</code></p> <p>Factory reset, detta rensar ej mgmt vrf.</p> <p><code>net\u00a0del\u00a0all</code></p> <p>Adding Question Mark Ability to NCLU. Logga ut, logga in f\u00f6r att \u00e4ndringen ska l\u00e4sas in.</p> <p><code>sed\u00a0-i\u00a0\"s/#\u00a0?:\u00a0complete/\u00a0?:\u00a0complete/g\"\u00a0/home/cumulus/.inputrc</code></p>"},{"location":"cumulus/Cumulus_Linux/#prescriptive-topology-manager","title":"Prescriptive Topology Manager","text":"<p>PTM anv\u00e4nds f\u00f6r att validera att man har kopplat kablar r\u00e4tt. Man skapar en fil med hur det ska vara kopplat, denna distribuerar man sedan till alla switchar som j\u00e4mf\u00f6r denna m\u00e5lbild med vilka LLDP-grannskap som finns. P\u00e5 s\u00e5 s\u00e4tt kan man uppt\u00e4cka om n\u00e5got har kopplats fel.</p>"},{"location":"cumulus/Cumulus_Linux/#zero-touch-provisioning","title":"Zero Touch Provisioning","text":"<p>ZTP g\u00f6rs genom att mgmt-porten (eth0) vid boot ropar efter DHCP option 239. Man pekar ut ett shell script som ska tankas ner och exekveras. Detta kan vara bash, python, perl, ruby vilket ger flexibilitet.</p> <p>Exempel:</p> <pre><code>#!/bin/bash\n\n#CUMULUS-AUTOPROVISIONING\n\napt-get update -y\n\nnet add vrf mgmt\nnet commit\n\nexit 0\n</code></pre> <p>Ska man aktivera mgmt-vrf b\u00f6r det g\u00f6ras sist.</p> <p>Enable ztp on next switch boot.</p> <p><code>sudo\u00a0ztp\u00a0-e</code></p> <p>Status &amp; Debugging</p> <p><code>sudo\u00a0ztp\u00a0-s</code> <code>sudo\u00a0systemctl\u00a0-l\u00a0status\u00a0ztp.service</code> <code>sudo\u00a0ztp\u00a0-v\u00a0-r</code><code>http://192.168.0.50/ztp-script.sh</code></p> <p>Category:Cumulus</p>"},{"location":"extreme/Extreme_VLAN/","title":"Extreme VLAN","text":""},{"location":"extreme/Extreme_VLAN/#konfiguration","title":"Konfiguration","text":"<p>Skapa vlan</p> <p><code>create\u00a0vlan\u00a0[vlan-name]\u00a0tag\u00a0[vlan-id]</code></p> <p>Access port</p> <p><code>configure\u00a0vlan\u00a0[vlan-name]\u00a0add\u00a0ports\u00a01\u00a0untagged</code></p> <p>Trunk port</p> <p><code>configure\u00a0vlan\u00a0[vlan-name]\u00a0add\u00a0ports\u00a01\u00a0tagged</code></p> <p>Category:Extreme</p>"},{"location":"extreme/Extreme_XOS/","title":"Extreme XOS","text":"<p>Extreme XOS bygger p\u00e5 linux k\u00e4rnan och busybox.</p>"},{"location":"extreme/Extreme_XOS/#konfiguration","title":"Konfiguration","text":"<p>Hostnamn</p> <p><code>configure\u00a0snmp\u00a0sysName\u00a0[hostname]</code></p> <p>Sommartid/vintertid</p> <p><code>configure\u00a0timezone\u00a0name\u00a0MET\u00a060\u00a0autodst\u00a0\u00a0begins\u00a0every\u00a0last\u00a0sunday\u00a0march\u00a0at\u00a02\u00a00\u00a0ends\u00a0every\u00a0last\u00a0sunday\u00a0october\u00a0at\u00a03\u00a00</code></p> <p>Mgmt port</p> <p><code>configure\u00a0vlan\u00a0Mgmt\u00a0ipaddress\u00a0192.168.0.1\u00a0255.255.255.0</code> <code>configure\u00a0iproute\u00a0add\u00a0default\u00a0[gw]\u00a0vr\u00a0VR-Mgmt</code></p> <p>Skapa anv\u00e4ndare</p> <p><code>create\u00a0account\u00a0admin\u00a0[username]\u00a0[password]</code></p> <p>S\u00e4tta password p\u00e5 anv\u00e4ndare</p> <p><code>configure\u00a0account\u00a0[konto]\u00a0password</code></p> <p>Enable SSH</p> <p>SSH modulen kan man beh\u00f6va l\u00e4gga p\u00e5 i efterhand. Man l\u00e4gger p\u00e5 modulen p\u00e5 samma s\u00e4tt som man l\u00e4gger p\u00e5 ny firmware.</p> <p><code>enable\u00a0ssh</code></p> <p>LLDP</p> <p><code>enable\u00a0lldp\u00a0ports\u00a0all</code> <code>configure\u00a0lldp\u00a0ports\u00a0all\u00a0advertise\u00a0port-description</code> <code>configure\u00a0lldp\u00a0ports\u00a0all\u00a0advertise\u00a0system-name</code> <code>configure\u00a0lldp\u00a0ports\u00a0all\u00a0advertise\u00a0management-address</code></p>"},{"location":"extreme/Extreme_XOS/#firmware","title":"Firmware","text":"<p>Byt mellan primary och secondary image.</p> <p><code>use\u00a0image\u00a0primary/secondary</code></p>"},{"location":"extreme/Extreme_XOS/#tftp","title":"TFTP","text":"<p>Fr\u00e5n VR-Mgmt(mgmt port)</p> <p><code>download\u00a0image\u00a0[ip]\u00a0firmware/images/exos/[image]</code></p> <p>Fr\u00e5n VR-Default(vanlig port/vlan)</p> <p><code>download\u00a0image\u00a0[ip]\u00a0firmware/images/exos/[image]\u00a0vr\u00a0vr-d</code></p> <p>Category:Extreme</p>"},{"location":"f5/F5_Big-IP/","title":"F5 Big-IP","text":"<p>Category:F5</p> <p>F5 Big-IP \u00e4r en plattform utf\u00e4rdad av f\u00f6retaget F5 med m\u00f6jlighet att k\u00f6ra lastbalancering, remote vpn, ddos skydd p\u00e5 olika niv\u00e5er. Alla funktionerna styrs till olika moduler p\u00e5 den Linuxbaserade enheten och man kan specificera hur m\u00e5nga k\u00e4rnor man vill l\u00e4gga till vilken adc. En adc kallas den enhet som k\u00f6r flera VMar p\u00e5 den fysiska appliancen med ber\u00f6rda moduler och h\u00e5rdvaruspecifikation tilldelat till sig.</p>"},{"location":"f5/F5_Big-IP/#moduler","title":"Moduler","text":"<ul> <li>LTM (Local Traffic     Manager)</li> <li>APM (Access Policy     Manager)</li> <li>AFM (Advanced Firewall     Manager)</li> <li>AAM (Application Acceleration     Manager)</li> <li>ASM (Application Security     Manager)</li> <li>GTM (Global Traffic     Manager)</li> <li>Link     Controller</li> <li>PSM (Procotol Security Module)</li> </ul>"},{"location":"f5/F5_Big-IP/#big-ip-appliance","title":"Big-IP Appliance","text":"<p>H\u00e5rdvaruplattformen som modulerna i fr\u00e5ga aktiveras p\u00e5 finns det olika specifikation p\u00e5 beroende p\u00e5 throughput och portdensitet. Modelerna som \u00e4r aktuella i dagsl\u00e4get \u00e4r de som b\u00f6rja p\u00e5 (i). Det finns \u00e4ven chassibaserade enheter som kallas Viprion. Dessa k\u00f6rs i stor skala hos de st\u00f6rre leverant\u00f6rena och kan i sitt chassi basera p\u00e5 konfiguration simulera flera mindre ADC enheter eller k\u00f6ra en all-in-one l\u00f6sning.</p>"},{"location":"f5/F5_Big-IP/#http2","title":"HTTP2","text":"<p>Detta protokoll \u00e4r mycket anv\u00e4ndbart framf\u00f6rallt f\u00f6r att man ut\u00f6ckar m\u00f6jligheten att h\u00e4mta information fr\u00e5n en webbfront mycket snabbare och s\u00e4krare. HTTP2 bygger p\u00e5 en ny struktur ist\u00e4llet f\u00f6r HTTP1.0/1.1. Man har i HTTP2 m\u00f6jlighet att k\u00f6ra f\u00f6ljande features.</p> <ul> <li>Multiplexing</li> <li>Server Push</li> <li>Header Compression</li> <li>Binary format</li> <li> <p>Extended Security</p> </li> <li> <p>Minimum Keys</p> </li> <li>Ephemeral key</li> <li>TLS 1.2</li> </ul> <p>Alla dessa features bidrar till en snabbare och s\u00e4krare publicering av webbtj\u00e4nster och F5an har m\u00f6jlighet att publicera HTTP2 n\u00e4r servern bakom inte kan eller endast kan k\u00f6ra HTTP1.1.</p>"},{"location":"hardware/HPE_BL460c_G7/","title":"HPE BL460c G7","text":"<p>Category:Hardware Detta \u00e4r den \u00e4ldre versionen av HPE's bladservrar</p>"},{"location":"hardware/HPE_BL460c_G7/#problem","title":"Problem","text":"<p>K\u00e4nda problem</p> <p>Vmware</p> <ul> <li>Vid installation av Vmware 6.5 med HPE iso s\u00e5 f\u00e5r den PSOD fel 13     samt 14.(detta beror p\u00e5 att den inte \u00e4r supporterad av HPE och att     Vibarna inte har st\u00f6d f\u00f6r G7 servrear)</li> </ul> <p>HPE SPP</p> <ul> <li>NIC NC553i(emulex) slutar fungera vid firmware uppdatering till FW     11.1.183.23 som ligger med p\u00e5 SPP2016.10 vid nergradering till     10.5.155.0     s\u00e5 fungerar den igen</li> </ul>"},{"location":"hardware/HPE_BL460c_Gen9/","title":"HPE BL460c Gen9","text":"<p>Category:Hardware Generation 9 av HPE's bladservrar.</p>"},{"location":"hardware/HPE_BL460c_Gen9/#problem","title":"Problem","text":"<p>K\u00e4nda problem</p> <p>Vmware</p> <ul> <li>\"A SmartArray controller Battery status hase changed from non-OK to     OK\" dock blir den aldrig non-OK detta h\u00e4nder om du har     HPE_bootbank_hpe-smx-provider installerat p\u00e5 VMware 5.5U3 men     f\u00f6rsvinner om man l\u00e4gger p\u00e5 HPE_bootbank_hpe-smx-limited.</li> </ul>"},{"location":"hardware/Lenovo_BIOS_update/","title":"Lenovo BIOS update","text":"<p>Category:Hardware Ladda ner senaste BIOS versionen f\u00f6r din x220a @ http://support.lenovo.com/us/en/products/laptops-and-netbooks/thinkpad-x-series-laptops/thinkpad-x220/downloads/ (I mitt fall s\u00e5 laddade jag ner \"8duj25us.iso\" )</p>"},{"location":"hardware/Lenovo_BIOS_update/#sjalva-processen-for-att-skapa-imagefilen","title":"Sj\u00e4lva processen f\u00f6r att skapa imagefilen:","text":"<p>F\u00f6r att extrahera boot imagen s\u00e5 anv\u00e4nder man sig av ett perlscript vid namn \"geteltorito\"</p> <p><code>wget``</code><code>http://www.uni-koblenz.de/~krienke/ftp/noarch/geteltorito/geteltorito.pl</code></p> <p>- (St\u00e4ll dig i den map d\u00e4r b\u00e5de .iso filen samt geteltorito perlscriptet ligger)</p> <p><code>perl`` ``geteltorito.pl`` ``8duj25us.iso`` ``&gt;`` ``biosupdate.img</code></p> <p>Man skall kunna f\u00f6ra \u00f6ver imagefilen till usbminnet enligt f\u00f6ljande: ''sudo dd if=biosupdate.img of=/dev/sdb1 bs=512K ''</p> <p>I mitt fall blev filerna korrupta och beh\u00f6vde ist\u00e4llet f\u00f6ra \u00f6ver imagen till en windowsmilj\u00f6 och anv\u00e4nde '''\"win32 disk imager\" '''f\u00f6r att fixa till det.</p> <p>In med USB minnet i laptopen, k\u00f6r F12 vid boot och boota fr\u00e5n USB minnet.</p> <p>Source: http://forums.lenovo.com/t5/Linux-Discussion/SUPPORT-REQUEST-X220-BIOS-UPDATE-INSTRUCTIONS-USB/td-p/532077</p>"},{"location":"juniper/Juniper_Aggregated_Ethernet/","title":"Juniper Aggregated Ethernet","text":"<p>Aggregated Ethernet(ae) \u00e4r Junipers implementation av IEEE 802.3ad som anv\u00e4nds f\u00f6r att bundla ihop flera fysiska interface till ett logiskt interface som kallas LAG. Med hj\u00e4lp av ett ae interface kan man f\u00e5 h\u00f6gre redundans och \u00e4ven h\u00f6gre hastighet eftersom att man kan last balansera trafiken p\u00e5 flera portar.</p> <p>Ciscos motsvarighet heter EtherChannel</p>"},{"location":"juniper/Juniper_Aggregated_Ethernet/#link-aggregation-control-protocol","title":"Link Aggregation Control Protocol","text":"<p>LACP \u00e4r en subkomponent till IEEE 802.3ad som tillf\u00f6r extra kontroll f\u00f6r att h\u00e5lla koll p\u00e5 din LAG och att det finns mindre risk f\u00f6r konfigurationsmisstag. F\u00f6r att LACP ska kunna fungera s\u00e5 kr\u00e4vs det att b\u00e5da sidorna anv\u00e4nder LACP. N\u00e4r LACP \u00e4r p\u00e5slaget s\u00e5 skickas det LACPDU en g\u00e5ng i sekunden med information tills f\u00f6rhandlingen \u00e4r genomf\u00f6rd sedan \u00e5terg\u00e5r det till vad keepalive \u00e4r satt till.</p> <ul> <li>Keepalive \u00e4r hur ofta enheterna skickar LACPDU d\u00e4r default mode     slow=30s och fast=1s.</li> <li>LACP anv\u00e4nder alltid multicast MAC adressen 01:80:c2:00:00:02 f\u00f6r     att skicka sina frames.</li> </ul> <p>F\u00f6rdelen med att anv\u00e4nda LACP \u00e4r att din enhet inte kommer f\u00f6rs\u00f6ka skicka trafik mot ett interface som inte svarar p\u00e5 LACPDU och att kommunikationen failar f\u00f6r andra applikationer. Har man en mediaconverter p\u00e5 en l\u00e4nk mellan 2st enheter som utbyter LACPDU s\u00e5 kommer den ena enheten k\u00e4nna till om den andra enheten skulle tappa kontakten med mediaconvertern p\u00e5 sin sida och d\u00e4rav sluta skicka trafik p\u00e5 det interfacet.</p> <p>Category:Juniper</p>"},{"location":"juniper/Juniper_JunOS/","title":"Juniper JunOS","text":"<p>Junos bygger p\u00e5 FreeBSD och man kan d\u00e4rf\u00f6r f\u00e5 shell access och k\u00f6ra m\u00e5nga unix kommandon p\u00e5 switchen.</p> <p>Junos CLI \u00e4r uppdelat i tv\u00e5 kommandol\u00e4gen.</p> <ul> <li>Operational Mode</li> <li>Configuration Mode</li> </ul> <p>Till skillnad fr\u00e5n tex Cisco, HP och Extreme d\u00e4r en \u00e4ndring sker direkt n\u00e4r man skrivit kommandot s\u00e5 m\u00e5ste man i JunOS skriva commit.</p>"},{"location":"juniper/Juniper_JunOS/#operational","title":"Operational","text":"<p>G\u00e5 till operational mode. H\u00e4r kan man k\u00f6ra kommandon f\u00f6r att troubleshoota och monitorera.</p> <p><code>cli</code></p> <p>Lista conf i set kommandon. Andv\u00e4ndbart om man beh\u00f6ver paste in conf.</p> <p><code>show\u00a0configuration\u00a0|\u00a0display\u00a0set</code></p> <p>Lista conf efter hierarchy level.(Funkar enbart om man g\u00e5tt in i edit l\u00e4ge p\u00e5 tex ett interface.)</p> <p><code>show\u00a0configuration\u00a0|\u00a0display\u00a0set\u00a0relative</code></p> <p>Visa mac tabellen.</p> <p><code>show\u00a0ethernet-switching\u00a0table</code></p>"},{"location":"juniper/Juniper_JunOS/#configuration","title":"Configuration","text":"<p>G\u00e5 till configuration mode.</p> <p><code>configure</code></p> <p>G\u00e5r till configuration mode och l\u00e5ser den globala configurationen, s\u00e5 att andra anv\u00e4ndare inte kan commita f\u00f6rens du l\u00e4mnat</p> <p>configuration mode.</p> <p><code>configure\u00a0exclusive</code></p> <p>L\u00e4mna configuration mode utan att commita.</p> <p><code>exit</code></p> <p>K\u00f6r operational mode kommandon i configuration mode.</p> <p><code>run</code>"},{"location":"juniper/Juniper_JunOS/#commit","title":"Commit","text":"<p>L\u00e4mna configuration mode och commita \u00e4ndringar.</p> <p><code>commit\u00a0and-quit</code></p> <p>Visa vad som kan commitas.</p> <p><code>show\u00a0|\u00a0compware</code></p> <p>Ta bort all conf som ligger redo att commitas.</p> <p><code>rollback</code></p> <p>Rollbacka till en conf vid en viss tid.</p> <p><code>rollback\u00a0?</code></p> <p>Commita och k\u00f6r en autorollback efter 2 miniut. F\u00f6r att stoppa autorollback skriv <code>commit</code> bara.</p> <p><code>commit\u00a0confirmed\u00a02</code></p>"},{"location":"juniper/Juniper_JunOS/#konfiguration","title":"Konfiguration","text":"<p>Hostnamn</p> <p><code>set\u00a0system\u00a0host-name\u00a0[hostname]</code></p> <p>L\u00f6senord p\u00e5 root(autoencryption)</p> <p><code>set\u00a0root-authentication\u00a0plain-text-password</code></p> <p>Om du redan har en krypterad str\u00e4ng av l\u00f6senordet anv\u00e4nd f\u00f6ljande.</p> <p><code>set\u00a0root-authentication\u00a0encrypted-password</code></p> <p>Till\u00e5t enbart root logins \u00f6ver console.</p> <p><code>set\u00a0services\u00a0ssh\u00a0root-login\u00a0deny</code></p> <p>Skapa anv\u00e4ndare</p> <p><code>set\u00a0system\u00a0login\u00a0user\u00a0admin\u00a0uid\u00a02000</code> <code>set\u00a0system\u00a0login\u00a0user\u00a0admin\u00a0class\u00a0super-user</code></p> <p>Mgmt port</p> <p><code>set\u00a0interfaces\u00a0vme\u00a0unit\u00a00\u00a0family\u00a0inet\u00a0address\u00a0192.168.0.0/24</code> <code>set\u00a0routing-options\u00a0static\u00a0route\u00a00.0.0.0/0\u00a0next-hop\u00a0192.168.0.1</code></p> <p>LLDP</p> <p><code>set\u00a0protocols\u00a0lldp\u00a0interface\u00a0all</code></p> <p>Tid</p> <p><code>set\u00a0system\u00a0time-zone\u00a0Europe/Stockholm</code></p> <p><code>set\u00a0system\u00a0ntp\u00a0server\u00a0[ip]\u00a0prefer</code> <code>set\u00a0system\u00a0ntp\u00a0server\u00a0[ip]</code></p>"},{"location":"juniper/Juniper_JunOS/#firmware","title":"Firmware","text":""},{"location":"juniper/Juniper_JunOS/#scp","title":"Scp","text":"<p>B\u00f6rja med att skicka \u00f6ver imagen till JunOS.</p> <p><code>scp\u00a0[image]\u00a0root@[juniper]:/var/tmp/[image]</code></p> <p>Fr\u00e5n operational mode k\u00f6r sedan f\u00f6ljande.</p> <p><code>request\u00a0system\u00a0software\u00a0add\u00a0/var/tmp/[image]\u00a0no-copy\u00a0no-validate\u00a0unlink\u00a0reboot</code></p>"},{"location":"juniper/Juniper_JunOS/#usb","title":"USB","text":"<p>B\u00f6rja med att mounta usb stickan med.</p> <p><code>mount_msdosfs\u00a0/dev/da0s1\u00a0/mnt</code></p> <p>Kopiera imagen till JunOS.</p> <p><code>cp\u00a0/mnt/[image]\u00a0/var/tmp/</code></p> <p>Unmounta usb stickan.</p> <p><code>unmount\u00a0/mnt</code></p> <p>G\u00e5 in i operational mode.</p> <p><code>request\u00a0system\u00a0software\u00a0add\u00a0/var/tmp/[image]\u00a0no-copy\u00a0no-validate\u00a0unlink\u00a0reboot</code></p>"},{"location":"juniper/Juniper_JunOS/#backup","title":"Backup","text":""},{"location":"juniper/Juniper_JunOS/#configuration_1","title":"Configuration","text":"<p>Man kan anv\u00e4nda system som Rancid eller Oxidized f\u00f6r att backa upp sin JunOS device. Om man inte har n\u00e5got s\u00e5nt system uppsatt s\u00e5 kan man s\u00e4tta transfer-on-commit eller transfer-interval.</p> <p>transfer-on-commit kommer att skicka din config fil till ditt valda archive-sites varje g\u00e5ng du commitar.</p> <p>transfer-interval g\u00f6r samma sak fast den skickar iv\u00e4g configen en g\u00e5ng i timmen bara.</p> <p>B\u00f6rja med att s\u00e4tta dina archive-sites</p> <p><code>set\u00a0system\u00a0archival\u00a0configuration\u00a0archive-sites\u00a0scp://backupusr@10.10.10.200:/opt/backup/R1\u00a0password\u00a0hackernet</code></p> <p>Byt ut SCP mot FTP om du hellre vill anv\u00e4nda det.</p> <p>Efter det s\u00e5 v\u00e4ljer du n\u00e4r du vill skicka configen.</p> <p><code>set\u00a0system\u00a0archival\u00a0configuration\u00a0transfer-on-commit</code> <code>set\u00a0system\u00a0archival\u00a0configuration\u00a0transfer-interval</code><code>interval-in-minutes</code></p> <p>Filen kommer att sparas som _YYYYMMDD_HHMMSS_juniper.conf.n.gz."},{"location":"juniper/Juniper_JunOS/#image","title":"Image","text":"<p>Man kan backupa en hel JunOS image och hur configen ser ut vid tillf\u00e4llet till en annan partition s\u00e5 ifall en firmware upgrade skulle g\u00e5 snett kan man boota ifr\u00e5n den.</p> <p>Skapa en recovery snapshot</p> <p><code>request\u00a0system\u00a0snapshot\u00a0recovery</code></p> <p>P\u00e5 \u00e4ldre platformar k\u00f6r man</p> <p><code>request\u00a0system\u00a0snapshot\u00a0slice\u00a0alternate</code></p> <p>Category:Juniper</p>"},{"location":"juniper/Juniper_VLAN/","title":"Juniper VLAN","text":""},{"location":"juniper/Juniper_VLAN/#konfiguration","title":"Konfiguration","text":"<p>Skapa vlan</p> <p><code>set\u00a0vlans\u00a0[VLAN-name]\u00a0vlan-id\u00a0[VLAN-id]</code></p> <p>Access port</p> <p><code>set\u00a0interfaces\u00a0ge-0/0/0\u00a0unit\u00a00\u00a0family\u00a0ethernet-switching\u00a0vlan\u00a0members\u00a0[VLAN-name]</code></p> <p>Trunk port</p> <p><code>set\u00a0interfaces\u00a0ge-0/0/0\u00a0unit\u00a00\u00a0family\u00a0ethernet-switching\u00a0port-mode\u00a0trunk</code> <code>set\u00a0interfaces\u00a0ge-0/0/0\u00a0unit\u00a00\u00a0family\u00a0ethernet-switching\u00a0vlan\u00a0members\u00a0[VLAN-name]</code></p> <p>Category:Juniper</p>"},{"location":"juniper/Juniper_VRRP/","title":"Juniper VRRP","text":"<p>Virtual Router Redundancy Protocol (RFC 3768) \u00e4r ett \u00f6ppet FHRP. Det fungerar v\u00e4ldigt likt HSRP men med n\u00e5gra skillnader. Source-IP f\u00f6r VRRP-paket \u00e4r interface IP, destination-IP \u00e4r 224.0.0.18 och protokoll \u00e4r 112. Hellos skickas default varje sekund. Man kan till skillnad fr\u00e5n HSRP ha samma virtual ip som interface ip. Konfigurerar man det \u00e4ndras VRRP-prio till 255 p\u00e5 den enheten som har samma IP som VIP. Backupenheter har 100 som default.</p> <p>En virtual router m\u00e5ste anv\u00e4nda f\u00f6ljande mac adress 00:00:5E:00:01:XX. D\u00e4r XX \u00e4r Virtual Router IDentifier(VRID), som skiljer sig p\u00e5 alla virtual routers i n\u00e4tverket.</p>"},{"location":"juniper/Juniper_VRRP/#konfiguration","title":"Konfiguration","text":"<p>VRRP konfigurerar man p\u00e5 interfacet. Interfacet kan vara en ae, irb eller fysiskt interface.</p>"},{"location":"juniper/Juniper_VRRP/#basic","title":"Basic","text":"<p><code>{master:0}[edit\u00a0interfaces\u00a0irb\u00a0unit\u00a010]</code> <code>root@R1#\u00a0show</code> <code>family\u00a0inet\u00a0{</code> <code>address\u00a0192.168.1.2/24\u00a0{</code> <code>vrrp-group\u00a010\u00a0{</code> <code>virtual-address\u00a0192.168.1.1;</code> <code>priority\u00a0250;</code> <code>}</code> <code>}</code> <code>}</code></p>"},{"location":"juniper/Juniper_VRRP/#autentisering","title":"Autentisering","text":"<p>F\u00f6r att s\u00e4kra upp VRRP kan man anv\u00e4nda sig av autentisering. L\u00f6senordet kommer inte sparas i klartext.</p> <p><code>set\u00a0interfaces</code><code>unit</code><code>family\u00a0inet\u00a0address</code><code>vrrp-group</code><code>authentication-type\u00a0simple</code> <code>set\u00a0interfaces</code><code>unit</code><code>family\u00a0inet\u00a0address</code><code>vrrp-group</code><code>authentication-key\u00a0hackernet</code>"},{"location":"juniper/Juniper_VRRP/#verify","title":"Verify","text":"<p><code>show\u00a0vrrp</code> <code>show\u00a0vrrp\u00a0interface</code><code>interface-name</code></p> <p>Category:Juniper</p>"},{"location":"linux_kickstart/Kickstart_Debian/","title":"Kickstart Debian","text":""},{"location":"linux_kickstart/Kickstart_Debian/#unattended","title":"Unattended","text":"<p>Bootparameter</p> <p><code>append\u00a0vga=normal\u00a0initrd=os/debian7/initrd.gz\u00a0preseed/url=</code><code>http://</code><code>/Debian.conf\u00a0interface=auto\u00a0priority=critical\u00a0auto=true</code> <p><code>####################################################################</code> <code>#\u00a0\u00a0PRESEED\u00a0-\u00a0Created\u00a0Wed\u00a0Apr\u00a0\u00a01\u00a013:18:08\u00a02015</code> <code>####################################################################</code></p> <p><code>#\u00a0Wiki:</code><code>http://wiki.debian.org/DebianInstaller/Preseed</code> <code>#\u00a0Great\u00a0work!\u00a0\u00a0Thanks\u00a0for\u00a0preseed\u00a0and\u00a0the\u00a0d-i\u00a0installer</code></p> <p><code>####################################################################</code> <code>#\u00a0Installation\u00a0Sources</code> <code>####################################################################</code></p> <p><code>#\u00a0Where\u00a0are\u00a0we\u00a0pulling\u00a0bits\u00a0from?</code> <code>#</code> <code>#\u00a0Note:\u00a0\u00a0To\u00a0use\u00a0your\u00a0own\u00a0local\u00a0repository,\u00a0this\u00a0is\u00a0what\u00a0you\u00a0want</code> <code>#\u00a0to\u00a0edit.</code> <code>#</code> <code>#\u00a0It\u00a0should\u00a0look\u00a0like\u00a0this:</code> <code>#d-i\u00a0\u00a0\u00a0\u00a0\u00a0mirror/http/hostname\u00a0\u00a0\u00a0\u00a0string\u00a0(IP\u00a0Address\u00a0of\u00a0your\u00a0local\u00a0server)</code> <code>#d-i\u00a0\u00a0\u00a0\u00a0\u00a0mirror/http/directory\u00a0\u00a0\u00a0string\u00a0(HTTP\u00a0Path\u00a0to\u00a0your\u00a0Repository\u00a0-\u00a0like\u00a0/natty\u00a0)</code></p> <p><code>d-i\u00a0\u00a0\u00a0\u00a0\u00a0mirror/http/hostname\u00a0\u00a0\u00a0\u00a0string\u00a0ftp.se.debian.org</code> <code>d-i\u00a0\u00a0\u00a0\u00a0\u00a0mirror/http/directory\u00a0\u00a0\u00a0string\u00a0/debian/</code> <code>d-i\u00a0\u00a0\u00a0\u00a0\u00a0mirror/suite\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0string</code></p> <p><code>#\u00a0Post\u00a0install\u00a0APT\u00a0setup</code> <code>d-i\u00a0\u00a0\u00a0\u00a0\u00a0apt-setup/uri_type\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0select\u00a0d-i</code> <code>d-i\u00a0\u00a0\u00a0\u00a0\u00a0apt-setup/hostname\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0string\u00a0ftp.se.debian.org</code> <code>d-i\u00a0\u00a0\u00a0\u00a0\u00a0apt-setup/directory\u00a0\u00a0\u00a0\u00a0\u00a0string\u00a0/debian/</code> <code>d-i\u00a0\u00a0\u00a0\u00a0\u00a0apt-setup/another\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0boolean\u00a0false</code> <code>d-i\u00a0\u00a0\u00a0\u00a0\u00a0apt-setup/security-updates\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0boolean\u00a0false</code> <code>d-i\u00a0\u00a0\u00a0\u00a0\u00a0finish-install/reboot_in_progress\u00a0note</code> <code>d-i\u00a0\u00a0\u00a0\u00a0\u00a0prebaseconfig/reboot_in_progress\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0note</code></p> <p><code>d-i\u00a0\u00a0\u00a0\u00a0\u00a0apt-setup/non-free\u00a0\u00a0\u00a0\u00a0\u00a0boolean\u00a0true</code> <code>d-i\u00a0\u00a0\u00a0\u00a0\u00a0apt-setup/contrib\u00a0\u00a0boolean\u00a0true</code></p> <p><code>####################################################################</code> <code>#\u00a0Networking</code> <code>####################################################################</code></p> <p><code>#\u00a0Network\u00a0Configuration</code></p> <p><code>d-i\u00a0\u00a0\u00a0\u00a0\u00a0netcfg/get_hostname\u00a0\u00a0\u00a0\u00a0\u00a0string\u00a0unassigned-hostname</code> <code>d-i\u00a0\u00a0\u00a0\u00a0netcfg/get_hostname\u00a0\u00a0\u00a0\u00a0\u00a0seen\u00a0true</code> <code>d-i\u00a0\u00a0\u00a0\u00a0\u00a0netcfg/get_domain\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0string\u00a0unassigned-domain</code> <code>d-i\u00a0\u00a0\u00a0\u00a0netcfg/get_domain\u00a0\u00a0\u00a0seen\u00a0true</code> <code>d-i\u00a0\u00a0\u00a0\u00a0\u00a0netcfg/disable_dhcp\u00a0\u00a0\u00a0\u00a0\u00a0boolean\u00a0false</code> <code>d-i\u00a0\u00a0\u00a0\u00a0mirror/http/proxy\u00a0\u00a0\u00a0string</code> <code>d-i\u00a0\u00a0\u00a0\u00a0\u00a0netcfg/choose_interface\u00a0select\u00a0eth0</code> <code>d-i\u00a0\u00a0\u00a0\u00a0\u00a0netcfg/wireless_wep\u00a0\u00a0\u00a0\u00a0\u00a0string</code></p> <p><code>####################################################################</code> <code>#\u00a0Disk\u00a0Partitioning/Boot\u00a0loader</code> <code>####################################################################</code></p> <p><code>d-i\u00a0\u00a0\u00a0\u00a0\u00a0partman-auto/disk\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0string\u00a0/dev/sda</code> <code>d-i\u00a0\u00a0\u00a0\u00a0\u00a0partman-auto/method\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0string\u00a0regular</code> <code>d-i\u00a0\u00a0\u00a0\u00a0partman-auto/choose_recipe\u00a0\u00a0select\u00a0atomic</code></p> <p><code>#\u00a0This\u00a0makes\u00a0partman\u00a0automatically\u00a0partition\u00a0without\u00a0confirmation.</code> <code>d-i\u00a0\u00a0\u00a0\u00a0\u00a0partman/confirm\u00a0boolean\u00a0true</code> <code>d-i\u00a0\u00a0\u00a0\u00a0\u00a0partman-partitioning/confirm_write_new_label\u00a0boolean\u00a0true</code> <code>d-i\u00a0\u00a0\u00a0\u00a0\u00a0partman/choose_partition\u00a0select\u00a0finish</code> <code>d-i\u00a0\u00a0\u00a0\u00a0\u00a0partman/confirm_nooverwrite\u00a0boolean\u00a0true</code> <code>d-i\u00a0\u00a0\u00a0\u00a0partman/confirm_write_new_label\u00a0boolean\u00a0true</code></p> <p><code>#\u00a0This\u00a0one\u00a0makes\u00a0grub-installer\u00a0install\u00a0to\u00a0the\u00a0MBR\u00a0even\u00a0if\u00a0finds\u00a0some\u00a0other\u00a0OS</code> <code>#\u00a0too,\u00a0which\u00a0is\u00a0less\u00a0safe\u00a0as\u00a0it\u00a0might\u00a0not\u00a0be\u00a0able\u00a0to\u00a0boot\u00a0that\u00a0other\u00a0OS.</code> <code>d-i\u00a0\u00a0\u00a0\u00a0\u00a0grub-installer/with_other_os\u00a0\u00a0\u00a0\u00a0boolean\u00a0true</code></p> <p><code>####################################################################</code> <code>#\u00a0Localizations</code> <code>####################################################################</code></p> <p><code>#\u00a0Install\u00a0Time</code> <code>d-i\u00a0\u00a0\u00a0\u00a0console-tools/archs\u00a0string\u00a0skip-config</code> <code>d-i\u00a0\u00a0\u00a0\u00a0debian-installer/locale\u00a0string\u00a0en_US</code> <code>d-i\u00a0\u00a0\u00a0\u00a0console-keymaps-at/keymap\u00a0select\u00a0sv</code></p> <p><code>d-i\u00a0\u00a0\u00a0\u00a0\u00a0languagechooser/language-name-fb\u00a0\u00a0\u00a0\u00a0select\u00a0English</code> <code>d-i\u00a0\u00a0\u00a0\u00a0\u00a0debian-installer/locale\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0select\u00a0en_US.UTF-8</code></p> <p><code>#\u00a0Timezone</code> <code>d-i\u00a0\u00a0\u00a0\u00a0\u00a0tzconfig/gmt\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0boolean\u00a0true</code> <code>d-i\u00a0\u00a0\u00a0\u00a0\u00a0tzconfig/choose_country_zone/Europe\u00a0select\u00a0Stockholm</code> <code>d-i\u00a0\u00a0\u00a0\u00a0\u00a0tzconfig/choose_country_zone_single\u00a0boolean\u00a0true</code> <code>d-i\u00a0\u00a0\u00a0\u00a0time/zone\u00a0\u00a0\u00a0select\u00a0\u00a0Europe/Stockholm</code> <code>d-i\u00a0\u00a0\u00a0\u00a0clock-setup/utc\u00a0boolean\u00a0true</code> <code>d-i\u00a0\u00a0\u00a0\u00a0kbd-chooser/method\u00a0\u00a0select\u00a0\u00a0American\u00a0English</code> <code>d-i\u00a0\u00a0\u00a0\u00a0mirror/country\u00a0\u00a0string\u00a0\u00a0manual</code> <code>d-i\u00a0\u00a0\u00a0\u00a0\u00a0clock-setup/ntp\u00a0boolean\u00a0false</code></p> <p><code>#\u00a0X11\u00a0config</code> <code>xserver-xorg\u00a0\u00a0\u00a0\u00a0\u00a0xserver-xorg/autodetect_monitor\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0boolean\u00a0true</code> <code>xserver-xorg\u00a0\u00a0\u00a0\u00a0\u00a0xserver-xorg/config/monitor/selection-method\u00a0select\u00a0medium</code> <code>xserver-xorg\u00a0\u00a0\u00a0\u00a0\u00a0xserver-xorg/config/monitor/mode-list\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0select\u00a01024x768\u00a0@\u00a060\u00a0Hz</code> <code>xserver-xorg\u00a0\u00a0\u00a0\u00a0\u00a0xserver-xorg/config/display/modes\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0multiselect\u00a01024x768,\u00a0800x600</code></p> <p><code>####################################################################</code> <code>#\u00a0User\u00a0Creation</code> <code>####################################################################</code></p> <p><code>#\u00a0Root\u00a0User</code> <code>d-i\u00a0\u00a0\u00a0\u00a0passwd/root-password-crypted\u00a0\u00a0\u00a0\u00a0passwd\u00a0\u00a0\u00a0Pa$$w0rd</code></p> <p><code>#\u00a0Mortal\u00a0User</code> <code>d-i\u00a0\u00a0\u00a0\u00a0passwd/user-fullname\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0string</code> <code>d-i\u00a0\u00a0\u00a0\u00a0passwd/username\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0string\u00a0hacker</code> <code>d-i\u00a0\u00a0\u00a0\u00a0passwd/user-password-crypted\u00a0\u00a0\u00a0\u00a0passwd\u00a0Pa$$w0rd</code></p> <p><code>####################################################################</code> <code>#\u00a0Software\u00a0Selections</code> <code>####################################################################</code></p> <p><code>popularity-contest\u00a0popularity-contest/participate\u00a0boolean\u00a0false</code></p> <p><code>tasksel\u00a0\u00a0\u00a0\u00a0tasksel/first\u00a0\u00a0\u00a0multiselect\u00a0standard</code> <code>d-i\u00a0\u00a0\u00a0\u00a0pkgsel/include\u00a0\u00a0string\u00a0\u00a0\u00a0openssh-server\u00a0open-vm-tools\u00a0systemd-sysv</code> <code>d-i\u00a0\u00a0\u00a0\u00a0grub-installer/only_debian\u00a0\u00a0boolean\u00a0true</code> <code>####################################################################</code> <code>#\u00a0Additional\u00a0preseed\u00a0entries\u00a0(from\u00a0data/debconf)</code> <code>####################################################################</code></p> <p><code>exim4-config\u00a0exim4/no_config\u00a0boolean\u00a0true</code></p> <p>Category:Kickstart</p>"},{"location":"linux_kickstart/Kickstart_Fedora/","title":"Kickstart Fedora","text":"<p>Fedora 23</p> <p><code>#\u00a0Network\u00a0information</code> <code>network\u00a0\u00a0--bootproto\u00a0static\u00a0--ip\u00a0172.10.0.20\u00a0--netmask\u00a0255.255.255.0\u00a0--gateway\u00a0172.10.0.1\u00a0--nameserver\u00a0172.10.0.1\u00a0--device=eno16780032\u00a0--ipv6=auto\u00a0--activate</code> <code>network\u00a0\u00a0--hostname=fedora.hackernet.se</code></p> <p><code>graphical</code> <code>auth\u00a0--enableshadow\u00a0--passalgo=sha512</code> <code>url\u00a0--url=\"</code><code>http://download.fedoraproject.org/pub/fedora/linux/releases/23/Server/x86_64/os</code><code>\"</code> <code>firstboot\u00a0--enable</code> <code>ignoredisk\u00a0--only-use=sda</code> <code>keyboard\u00a0--vckeymap=se\u00a0--xlayouts='se'</code> <code>lang\u00a0en_US.UTF-8</code> <code>rootpw\u00a0--lock</code> <code>timezone\u00a0Europe/Stockholm\u00a0--isUtc</code> <code>user\u00a0--groups=wheel\u00a0--name=skeletor\u00a0--password=$6$0mOr4b/kgDAOoxgg$vgPmtqFEZB0//fc3J9RW90eM6nDIISyE0IxT.06ufRvGnfx6ET2ollSHP46OefzAvYUs5hqbqHXzUzhptDefM1\u00a0--iscrypted\u00a0--gecos=\"skeletor\"</code> <code>bootloader\u00a0--location=mbr\u00a0--boot-drive=sda</code> <code>autopart\u00a0--type=lvm</code> <code>zerombr</code> <code>clearpart\u00a0--all\u00a0--initlabel</code> <code>reboot</code></p> <p><code>%packages</code> <code>@^server-product-environment</code> <code>%end</code></p> <p><code>%anaconda</code> <code>pwpolicy\u00a0root\u00a0--minlen=0\u00a0--minquality=1\u00a0--notstrict\u00a0--nochanges\u00a0--emptyok</code> <code>pwpolicy\u00a0user\u00a0--minlen=0\u00a0--minquality=1\u00a0--notstrict\u00a0--nochanges\u00a0--emptyok</code> <code>pwpolicy\u00a0luks\u00a0--minlen=0\u00a0--minquality=1\u00a0--notstrict\u00a0--nochanges\u00a0--emptyok</code> <code>%end</code></p>"},{"location":"linux_kickstart/Kickstart_Fedora/#fraga-efter-hostnamn","title":"Fr\u00e5ga efter hostnamn","text":"<p>F\u00e5 fedora/centos/redhat att fr\u00e5ga efter hostnamn under installation.</p> <p><code>%pre</code> <code>#!/bin/sh</code> <code>exec\u00a0&lt;\u00a0/dev/tty3\u00a0&gt;\u00a0/dev/tty3\u00a02&gt;&amp;1</code> <code>chvt\u00a03</code> <code>hn=\"\"</code></p> <p><code>while\u00a0[\u00a0\"$hn\"\u00a0==\u00a0\"\"\u00a0];\u00a0do</code> <code>clear</code> <code>echo\u00a0\"\u00a0***\u00a0Please\u00a0enter\u00a0the\u00a0following\u00a0details:\u00a0***\u00a0\"</code> <code>echo</code> <code>read\u00a0-p\u00a0\"Hostname:\u00a0\"\u00a0hn</code> <code>done</code> <code>clear</code> <code>chvt\u00a01</code> <code>echo\u00a0\"network\u00a0--device=link\u00a0--bootproto=dhcp\u00a0--noipv6\u00a0--hostname\u00a0${hn}.hackernet.se\u00a0--activate\"\u00a0&gt;\u00a0/tmp/network.txt</code> <code>%end</code></p> <p>Category:Kickstart</p>"},{"location":"linux_kickstart/Kickstart_Ubuntu/","title":"Kickstart Ubuntu","text":"<p>Exempel p\u00e5 ks-fil f\u00f6r Ubuntu server</p> <p><code>network\u00a0--bootproto=static\u00a0--hostname=host7.hackernet.se\u00a0--ip=172.20.0.4\u00a0--netmask=255.255.255.0\u00a0--gateway=172.20.0.1\u00a0--nameserver=8.8.8.8\u00a0--device=eth0</code> <code>lang\u00a0en_US</code> <code>langsupport\u00a0en_US</code> <code>keyboard\u00a0se</code> <code>mouse</code> <code>timezone\u00a0Europe/Stockholm</code> <code>rootpw\u00a0--disabled</code> <code>#Initial\u00a0user</code> <code>user\u00a0doge\u00a0--fullname\u00a0\"skeletor\"\u00a0--password\u00a0suchpw</code> <code>#Reboot\u00a0after\u00a0installation</code> <code>reboot</code> <code>text</code> <code>install</code> <code>#Use\u00a0Web\u00a0installation</code> <code>url\u00a0--url</code><code>http://se.archive.ubuntu.com/ubuntu</code> <code>bootloader\u00a0--location=mbr</code> <code>zerombr\u00a0yes</code> <code>clearpart\u00a0--all\u00a0--initlabel</code> <code>part\u00a0/\u00a0--fstype\u00a0ext4\u00a0--size\u00a01\u00a0--grow</code> <code>part\u00a0swap\u00a0--recommended</code> <code>auth\u00a0\u00a0--useshadow</code> <code>firewall\u00a0--disabled</code> <code>skipx</code></p> <p><code>%packages</code> <code>openssh-server</code> <code>fail2ban</code> <code>open-vm-tools</code> <code>ntp</code></p> <p>Category:Kickstart</p>"},{"location":"linux_networking/BIRD/","title":"BIRD","text":"<p>Bird Internet Routing Daemon. Senaste version: 1.5.0 (22.4.2015)</p>"},{"location":"linux_networking/BIRD/#installation","title":"Installation","text":"<p><code>sudo\u00a0apt-get\u00a0update\u00a0&amp;&amp;\u00a0sudo\u00a0apt-get\u00a0install\u00a0bird</code> <code>sudo\u00a0dnf\u00a0install\u00a0bird</code></p>"},{"location":"linux_networking/BIRD/#konfiguration","title":"Konfiguration","text":"<p>Ubuntu</p> <p>Enable IPv4 and IPv6 Forwarding:</p> <p><code>echo\u00a0\"net.ipv4.conf.all.forwarding=1\"\u00a0|\u00a0sudo\u00a0tee\u00a0-a\u00a0/etc/sysctl.conf</code> <code>echo\u00a0\"net.ipv4.conf.default.forwarding=1\"\u00a0|\u00a0sudo\u00a0tee\u00a0-a\u00a0/etc/sysctl.conf</code> <code>sed\u00a0's/#net.ipv6.conf.all.forwarding=1/net.ipv6.conf.all.forwarding=1/g'\u00a0/etc/sysctl.conf\u00a0|\u00a0sudo\u00a0tee\u00a0/etc/sysctl.conf</code> <code>echo\u00a0\"net.ipv6.conf.default.forwarding=1\"\u00a0|\u00a0sudo\u00a0tee\u00a0-a\u00a0/etc/sysctl.conf</code> <code>sudo\u00a0sysctl\u00a0-p</code></p> <p>Backup the configuration files:</p> <p><code>sudo\u00a0cp\u00a0/etc/bird/bird.conf\u00a0/etc/bird/bird.conf.original</code> <code>sudo\u00a0cp\u00a0/etc/bird/bird6.conf\u00a0/etc/bird/bird6.conf.original</code></p> <p>Create the configuration files:</p> <p><code>sudo\u00a0nano\u00a0/etc/bird/bird.conf</code> <code>sudo\u00a0nano\u00a0/etc/bird/bird6.conf</code></p> <p>Restart the daemons:</p> <p><code>sudo\u00a0service\u00a0bird\u00a0restart</code> <code>sudo\u00a0service\u00a0bird6\u00a0restart</code></p> <p>Fedora</p> <p>Backup</p> <p><code>sudo\u00a0cp\u00a0/etc/bird.conf\u00a0/etc/bird.conf.original</code></p> <p>Edit</p> <p><code>sudo\u00a0nano\u00a0/etc/bird.conf</code></p> <p>Restart</p> <p><code>sudo\u00a0systemctl\u00a0restart\u00a0bird</code></p>"},{"location":"linux_networking/BIRD/#cli","title":"CLI","text":"<p>G\u00e5 till cli</p> <p><code>sudo\u00a0birdc</code> <code>bird&gt;\u00a0show\u00a0route</code></p> <p>Quit</p> <p><code>bird&gt;\u00a0exit</code></p>"},{"location":"linux_networking/BIRD/#ospf","title":"OSPF","text":"<p><code>show\u00a0ospf\u00a0interface</code> <code>show\u00a0ospf\u00a0neighbors</code> <code>show\u00a0ospf\u00a0state</code> <code>show\u00a0ospf\u00a0topology</code></p>"},{"location":"linux_networking/BIRD/#bgp","title":"BGP","text":"<p><code>protocol\u00a0bgp\u00a0{</code> <code>#\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0disabled;</code> <code>description\u00a0\"My\u00a0BGP\u00a0uplink\";</code> <code>local\u00a0as\u00a065002;</code> <code>neighbor\u00a0172.22.0.90\u00a0as\u00a065000;</code> <code>#\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0multihop;</code> <code>hold\u00a0time\u00a0240;</code> <code>startup\u00a0hold\u00a0time\u00a0240;</code> <code>connect\u00a0retry\u00a0time\u00a0120;</code> <code>keepalive\u00a0time\u00a080;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0#\u00a0defaults\u00a0to\u00a0hold\u00a0time\u00a0/\u00a03</code> <code>start\u00a0delay\u00a0time\u00a05;\u00a0\u00a0\u00a0\u00a0\u00a0#\u00a0How\u00a0long\u00a0do\u00a0we\u00a0wait\u00a0before\u00a0initial\u00a0connect</code> <code>error\u00a0wait\u00a0time\u00a060,\u00a0300;#\u00a0Minimum\u00a0and\u00a0maximum\u00a0time\u00a0we\u00a0wait\u00a0after\u00a0an\u00a0error\u00a0(when\u00a0consecutive</code> <code>error\u00a0forget\u00a0time\u00a0300;\u00a0\u00a0#\u00a0...\u00a0until\u00a0this\u00a0timeout\u00a0expires)</code> <code>path\u00a0metric\u00a01;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0#\u00a0Prefer\u00a0routes\u00a0with\u00a0shorter\u00a0paths\u00a0(like\u00a0Cisco\u00a0does)</code> <code>default\u00a0bgp_med\u00a00;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0#\u00a0MED\u00a0value\u00a0we\u00a0use\u00a0for\u00a0comparison\u00a0when\u00a0none\u00a0is\u00a0defined</code> <code>default\u00a0bgp_local_pref\u00a00;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0#\u00a0The\u00a0same\u00a0for\u00a0local\u00a0preference</code> <code>source\u00a0address\u00a0172.22.0.19;\u00a0\u00a0\u00a0\u00a0\u00a0#\u00a0What\u00a0local\u00a0address\u00a0we\u00a0use\u00a0for\u00a0the\u00a0TCP\u00a0connection</code> <code>#\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0password\u00a0\"secret\";\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0#\u00a0Password\u00a0used\u00a0for\u00a0MD5\u00a0authentication</code> <code>}</code></p> <p>Birdc</p> <p><code>show\u00a0protocols\u00a0all\u00a0bgp1</code></p> <p>Category:Network</p>"},{"location":"linux_networking/Bridge/","title":"Bridge","text":"<p>Linux Bridge \u00e4r en kernel-modul som introducerades i kernel 2.2 och administreras med kommandot brctl. Man kan g\u00f6ra om portar p\u00e5 en Linuxmaskin till switchportar. Se \u00e4ven Open vSwitch och Linux VXLAN.</p>"},{"location":"linux_networking/Bridge/#installation","title":"Installation","text":"<p><code>sudo\u00a0apt-get\u00a0install\u00a0bridge-utils</code> <code>sudo\u00a0yum\u00a0install\u00a0bridge-utils</code></p>"},{"location":"linux_networking/Bridge/#konfiguration","title":"Konfiguration","text":"<p><code>ifconfig\u00a0eth0\u00a00.0.0.0</code> <code>ifconfig\u00a0eth1\u00a00.0.0.0</code> <code>brctl\u00a0addbr\u00a0bridge1</code> <code>brctl\u00a0addif\u00a0bridge1\u00a0eth0\u00a0eth1</code> <code>brctl\u00a0show</code></p> <p><code>brctl\u00a0delif\u00a0bridge1\u00a0eth0</code></p> <p>/etc/network/interfaces</p> <p><code>auto\u00a0bridge</code> <code>iface\u00a0bridge</code> <code>bridge-vlan-aware\u00a0yes</code> <code>bridge-ports\u00a0eth0\u00a0eth1\u00a0eth7</code> <code>bridge-vids\u00a03\u00a04\u00a06-10\u00a0\u00a0\u00a0#allowed\u00a0vlan</code> <code>bridge-pvid\u00a01\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0#native\u00a0vlan</code> <code>bridge_waitport\u00a00\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0#portfast</code> <code>bridge-stp\u00a0on</code> <code>mstpctl-treeprio\u00a020480</code></p> <p>VLAN</p> <p><code>aptitude\u00a0install\u00a0vlan\u00a0ifenslave</code> <code>echo\u00a0\"8021q\"\u00a0&gt;&gt;\u00a0/etc/modules</code></p> <p>Spanning-Tree</p> <p><code>sudo\u00a0brctl\u00a0stp\u00a0bridge1\u00a0on</code></p> <p>/etc/network/interfaces</p> <p><code>auto\u00a0bond0</code> <code>iface\u00a0bond0\u00a0inet\u00a0manual</code> <code>up\u00a0ifconfig\u00a0bond0\u00a00.0.0.0\u00a0up</code> <code>slaves\u00a0eth0\u00a0eth1</code> <code>bond-mode\u00a04\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0#bond-mode\u00a04\u00a0=\u00a0802.3ad</code> <code>bond-miimon\u00a0100</code> <code>bond-downdelay\u00a0200</code> <code>bond-updelay\u00a0200</code> <code>bond-lacp-rate\u00a01</code> <code>bond-xmit-hash-policy\u00a0layer2+3</code></p> <p>Kolla packet</p> <p><code>cat\u00a0/proc/net/bonding/bond0</code></p>"},{"location":"linux_networking/Bridge/#mac-table","title":"MAC Table","text":"<p>Man kan kolla MAC-tabellen p\u00e5 en brygga med f\u00f6ljande kommando:</p> <p><code>brctl\u00a0show</code> <code>brctl\u00a0showmacs</code> <p>Category:Network</p>"},{"location":"linux_networking/ExaBGP/","title":"ExaBGP","text":"<p>ExaBGP \u00e4r en BGP route announcer som det g\u00e5r att scripta mot. Se \u00e4ven Cisco BGP och Arista BGP.</p>"},{"location":"linux_networking/ExaBGP/#installation","title":"Installation","text":"<p><code>pip\u00a0install\u00a0exabgp</code></p>"},{"location":"linux_networking/ExaBGP/#konfiguration","title":"Konfiguration","text":"<p>Exempel d\u00e4r man kan skicka in v\u00e4ldigt mycket routes till BGP.</p> <p>Script f\u00f6r att generera prefix: bs-prefixes.py</p> <p><code>chmod\u00a0+x\u00a0bs-prefixes.py</code></p> <p>Script f\u00f6r att annonsera prefix</p> <p><code>touch\u00a0announce.sh\u00a0&amp;&amp;\u00a0chmod\u00a0+x\u00a0announce.sh</code></p> <p>cat announce.sh</p> <pre><code>#!/bin/sh\n\n# ignore Control C\n# if the user ^C exabgp we will get that signal too, ignore it and let exabgp send us a SIGTERM\nTEMPFILE=/tmp/prefixes.bgp\nPREFIXES=50000\nBLOCK=128\n\ntrap '' SIGINT\n\n# Dump our prefixs in a file for parsing a block at a time\n/path/to/bs-prefixes.py $PREFIXES &gt; $TEMPFILE\n\n# Pause a bit to let BGP sessions come up\nsleep 10\n\nLINE=0\nwhile [ $LINE -lt $PREFIXES ]; do\n   LINE=$(( $LINE + $BLOCK ))\n   for pfx in `head -n $LINE $TEMPFILE | tail -n $BLOCK`; do\n      echo \"announce route $pfx next-hop 10.0.0.0\"\n   done\n   sleep 2\ndone\n</code></pre> <p>Konfigurationsfil f\u00f6r exaBGP, edit exabgp.conf</p> <p><code>neighbor\u00a010.0.0.11\u00a0{</code> <code>description\u00a0\"R2\";</code> <code>router-id\u00a066.66.66.66;</code> <code>local-address\u00a010.0.0.10;</code> <code>local-as\u00a0666;</code> <code>peer-as\u00a0101;</code> <code>hold-time\u00a0600;</code> <code>graceful-restart;</code></p> <p><code>#\u00a0advertise\u00a0prefixes</code> <code>process\u00a0service-1\u00a0{</code> <code>run\u00a0/path/to/announce.sh;</code> <code>}</code></p> <p>K\u00f6r</p> <p><code>exabgp\u00a0exabgp.conf</code></p>"},{"location":"linux_networking/ExaBGP/#segment-routing","title":"Segment Routing","text":"<p>ExaBGP kan anv\u00e4ndas f\u00f6r att skicka in segment-lista dvs g\u00f6ra traffic engineering. ExaBGP kan ocks\u00e5 parsea IS-IS segment routing extensions genom BGP-LS. Detta betyder att man kan ta emot segment identifiers (node och adjacency id:s) genom samma BGP-LS session. Med label-informationen kan man programera LSP:er via BGP-LU sessionen till PE. Se \u00e4ven Arista SR och Cisco SR.</p> <p>cat ./config/exabgp</p> <p><code>neighbor\u00a0172.16.0.20\u00a0{</code> <code>group-updates\u00a0true;</code> <code>local-address\u00a0172.16.0.10;</code> <code>peer-as\u00a065000;</code> <code>local-as\u00a065000;</code> <code>family\u00a0{</code> <code>ipv4\u00a0nlri-mpls;</code> <code>}</code> <code>static\u00a0{</code> <code>route\u00a010.1.1.15/32\u00a0{</code> <code>next-hop\u00a010.0.0.2;</code> <code>label\u00a0[\u00a0800005\u00a0800007\u00a0800006\u00a0800008\u00a0];</code> <code>}</code> <code>route\u00a010.1.1.15/32\u00a0{\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0#egress\u00a0PE\u00a0loopback</code> <code>next-hop\u00a010.0.0.3;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0#physical\u00a0next-hop\u00a0in\u00a0core\u00a0to\u00a0get\u00a0towards\u00a0egress\u00a0PE</code> <code>label\u00a0[\u00a0800005\u00a0800006\u00a0800008\u00a0];</code> <code>}</code> <code>}</code> <code>}</code></p> <p>Category:Network</p>"},{"location":"linux_networking/IPv6/","title":"IPv6","text":"<p>M\u00e4ngden IPv4-trafik f\u00f6rutsp\u00e5s peaka \u00e5r 2020, IPv6 ska ingenstans. Testa dig och dina servrar (och f\u00e5 en t-shirt!):</p> <p><code>https://ipv6.he.net/certification/</code></p>"},{"location":"linux_networking/IPv6/#subnet-security","title":"Subnet Security","text":"<ul> <li>RA Guard</li> <li>DHCPv6 Guard</li> <li>SAVI</li> <li>IPv6 ND Inspection</li> </ul>"},{"location":"linux_networking/IPv6/#dhcp","title":"DHCP","text":"<p>Stateless DHCPv6: with this option SLAAC is still used to get the IP address, but DHCP is used to obtain \u201cother\u201d configuration options, usually things like DNS, NTP, etc.</p> <p>Stateful DCHPv6: functions exactly the same as IPv4 DHCP in which hosts receive both their IPv6 address and additional parameters from the DHCP server.</p>"},{"location":"linux_networking/IPv6/#tunnlar","title":"Tunnlar","text":"<p>IPv6 g\u00e5r att tunnla p\u00e5 diverse olika s\u00e4tt, se Cisco IPv6.</p> <p>Category:Network</p>"},{"location":"linux_networking/Mininet/","title":"Mininet","text":"<p>An Instant Virtual Network on your computer.</p> <p>Intro: https://www.youtube.com/watch?v=jmlgXaocwiE</p> <p>Projektets hemsida: http://mininet.org/</p>"},{"location":"linux_networking/Mininet/#installation","title":"Installation","text":"<p><code>wget</code><code>https://raw.github.com/mininet/mininet/master/util/vm/install-mininet-vm.sh</code> <code>bash\u00a0-v\u00a0install-mininet-vm.sh\u00a0master</code> <code>~/mininet/bin/mn\u00a0--version</code> <code>cd\u00a0~/mininet;\u00a0git\u00a0fetch\u00a0--all;\u00a0git\u00a0checkout\u00a0master;\u00a0git\u00a0pull\u00a0--rebase\u00a0origin\u00a0master</code> <code>sudo\u00a0-n\u00a0make\u00a0install</code> <code>sudo\u00a0-n\u00a0mn\u00a0--test\u00a0pingall</code> <code>sudo\u00a0sed\u00a0-i\u00a0-e\u00a0's/^GRUB_TERMINAL=serial/#GRUB_TERMINAL=serial/'\u00a0/etc/default/grub;\u00a0sudo\u00a0update-grub</code> <code>reboot</code></p>"},{"location":"linux_networking/Mininet/#ovf","title":"OVF","text":"<p>Ladda ned ovf:n och importera till ditt vmware-system. HWversion ligger p\u00e5 11 s\u00e5 det kanske du m\u00e5ste s\u00e4nka i vmx-filen f\u00f6r att kunna starta vm:n. Credentials: mininet - mininet</p>"},{"location":"linux_networking/Mininet/#basic","title":"Basic","text":"<p>http://mininet.org/walkthrough/</p> <p>K\u00f6r igenom kommandona f\u00f6r att komma ig\u00e5ng.</p> <p><code>sudo\u00a0mn</code></p>"},{"location":"linux_networking/Mininet/#setups","title":"Setups","text":"<p>http://sdnhub.org/resources/useful-mininet-setups/</p>"},{"location":"linux_networking/Mininet/#controller","title":"Controller","text":"<p>Det blir lite roligare om man har en controller till sitt virtuella n\u00e4tverk s\u00e5 man kan peka och klicka lite.</p> <p><code>sudo\u00a0mn\u00a0--controller=remote,ip=</code><code>,port=6633\u00a0--switch\u00a0ovsk,protocols=OpenFlow13\u00a0--topo=tree,3</code> <p>http://mininet.org/blog/2013/06/03/automating-controller-startup/</p>"},{"location":"linux_networking/Mininet/#opendaylight","title":"OpenDaylight","text":"<p>Se OpenDaylight</p>"},{"location":"linux_networking/Mininet/#floodlight","title":"Floodlight","text":"<p>Installation</p> <p><code>sudo\u00a0apt-get\u00a0update\u00a0&amp;&amp;\u00a0sudo\u00a0apt-get\u00a0-y\u00a0install\u00a0build-essential\u00a0default-jdk\u00a0ant\u00a0python-dev\u00a0eclipse\u00a0screen</code> <code>git\u00a0clone</code><code>git://github.com/floodlight/floodlight.git</code> <code>cd\u00a0floodlight\u00a0&amp;&amp;\u00a0git\u00a0checkout\u00a0fl-last-passed-build</code> <code>ant;</code> <code>sudo\u00a0mkdir\u00a0/var/lib/floodlight\u00a0&amp;&amp;\u00a0sudo\u00a0chmod\u00a0777\u00a0/var/lib/floodlight</code> <code>screen</code> <code>java\u00a0-jar\u00a0target/floodlight.jar</code></p> <p>http://IP:8080/ui/index.html</p> <p><code>sudo\u00a0mn\u00a0--controller=remote,ip=127.0.0.1,port=6633\u00a0--switch\u00a0ovsk,protocols=OpenFlow13</code></p> <p>Category:Network</p>"},{"location":"linux_networking/Netmiko/","title":"Netmiko","text":"<p>Netmiko \u00e4r ett open-source Python library som anv\u00e4nds f\u00f6r att SSHa till n\u00e4tverksenheter. Det \u00e4r baserat p\u00e5 paramiko och har st\u00f6d f\u00f6r flera olika plattformar fr\u00e5n olika tillverkare. M\u00e5let \u00e4r att f\u00f6renkla anv\u00e4ndandet av show och conf-kommandon mot n\u00e4tverksutrustning fr\u00e5n script.</p> <p>Exempel p\u00e5 device types som st\u00f6ds</p> <ul> <li>cisco_ios</li> <li>cisco_xe</li> <li>cisco_xr</li> <li>cisco_asa</li> <li>cisco_nxos</li> <li>juniper</li> <li>arista_eos</li> <li>hp_procurve</li> </ul>"},{"location":"linux_networking/Netmiko/#installation","title":"Installation","text":"<p><code>sudo\u00a0pip\u00a0install\u00a0netmiko</code></p>"},{"location":"linux_networking/Netmiko/#getting-started","title":"Getting started","text":"<p>Python</p> <p><code>from\u00a0netmiko\u00a0import\u00a0ConnectHandler</code></p> <p>Connect</p> <p><code>R1\u00a0=\u00a0{'device_type':\u00a0'cisco_xe',\u00a0'ip':\u00a0'10.0.0.10',\u00a0'username':\u00a0'cisco',\u00a0'password':\u00a0'cisco',\u00a0'secret':\u00a0'cisco'}</code> <code>net_connect\u00a0=\u00a0ConnectHandler(**R1)</code></p> <p>Byt mellan olika prompts</p> <p><code>net_connect.find_prompt()</code> <code>net_connect.enable()</code> <code>net_connect.find_prompt()</code> <code>net_connect.config_mode()</code> <code>net_connect.find_prompt()</code> <code>net_connect.disconnect()</code></p> <p>Skicka kommandon Send command down the SSH channel, return output back</p> <p><code>net_connect.send_command(arguments)</code></p> <p>Send a set of configuration commands to remote device</p> <p><code>net_connect.send_config_set(arguments)</code></p> <p>Send a set of configuration commands loaded from a file</p> <p><code>net_connect.send_config_from_file(arguments)</code></p> <p>Exempel</p> <p><code>IPintbrief\u00a0=\u00a0net_connect.send_command(\"show\u00a0ip\u00a0int\u00a0brief\")</code> <code>print\u00a0IPintbrief</code></p> <p>SSHDetect Netmiko kan \u00e4ven gissa vad det \u00e4r f\u00f6r device type.</p> <p><code>from\u00a0netmiko.ssh_autodetect\u00a0import\u00a0SSHDetect</code> <code>remote_device\u00a0=\u00a0{'device_type':\u00a0'autodetect','host':\u00a0'10.0.0.10','username':\u00a0'cisco','password':\u00a0'cisco'}</code> <code>guesser\u00a0=\u00a0SSHDetect(**remote_device)</code> <code>best_match\u00a0=\u00a0guesser.autodetect()</code> <code>print(best_match)</code></p>"},{"location":"linux_networking/Netmiko/#skapa-vlan","title":"Skapa VLAN","text":"<p><code>from\u00a0netmiko\u00a0import\u00a0ConnectHandler</code> <code>import\u00a0getpass</code></p> <p><code>SW1\u00a0=\u00a0{'device_type':\u00a0'cisco_ios',\u00a0'ip':\u00a0'10.0.0.11',\u00a0'username':\u00a0'cisco',\u00a0'password':\u00a0'cisco',\u00a0'secret':\u00a0'cisco'}</code> <code>SW2\u00a0=\u00a0{'device_type':\u00a0'cisco_ios',\u00a0'ip':\u00a0'10.0.0.12',\u00a0'username':\u00a0'cisco'}</code></p> <p><code>pw\u00a0=\u00a0getpass.getpass(\"Enter\u00a0password:\")</code> <code>SW02['password']\u00a0=\u00a0pw</code></p> <p><code>all_devices\u00a0=\u00a0[SW1,\u00a0SW2]</code></p> <p><code>config_commands\u00a0=\u00a0[\u00a0'vlan\u00a0100',\u00a0'name\u00a0NewVLAN',\u00a0'exit'\u00a0]</code></p> <p><code>for\u00a0a_device\u00a0in\u00a0all_devices:</code> <code>net_connect\u00a0=\u00a0ConnectHandler(**a_device)</code> <code>net_connect.enable()</code> <code>output\u00a0=\u00a0net_connect.send_config_set(config_commands)</code> <code>print\u00a0output</code> <code>net_connect.disconnect()</code></p> <p>Category:Network</p>"},{"location":"linux_networking/Netsim-tools/","title":"Netsim-tools","text":"<p>Orkestrator f\u00f6r Vagrant-Libvirt, Vagrant-Virtualbox och Containerlab.</p>"},{"location":"linux_networking/Netsim-tools/#installation-ubuntu","title":"Installation Ubuntu","text":"<pre><code>sudo apt update &amp;&amp; sudo apt install -y python3-pip\nsudo python3 -m pip install netsim-tools\nnetlab install ubuntu ansible libvirt\n</code></pre>"},{"location":"linux_networking/Netsim-tools/#nexus-9300v","title":"Nexus 9300v","text":"<p>Download box file, example: nexus9300v.9.3.8.box</p> <pre><code>sudo vagrant plugin install vagrant-mutate\nsudo vagrant box add nexus9300v.9.3.8.box --name cisco/nexus9300v\nsudo vagrant mutate cisco/nexus9300v libvirt\nsudo vagrant box remove cisco/nexus9300v --provider virtualbox\n</code></pre> <p>Topology file</p> <p><code>---</code> <code>defaults:</code> <code>device:\u00a0nxos</code></p> <p><code>nodes:\u00a0[\u00a0sw1,\u00a0sw2\u00a0]</code> <code>links:\u00a0[\u00a0sw1-sw2\u00a0]</code></p> <p>Setup lab and start devices</p> <p><code>sudo\u00a0netlab\u00a0create</code> <code>sudo\u00a0netlab\u00a0up</code> <code>netlab\u00a0connect\u00a0sw1</code></p> <p>Category:Network</p>"},{"location":"linux_networking/OpenDaylight/","title":"OpenDaylight","text":"<p>OpenDaylight \u00e4r en \u00f6ppen kontroller-infrastruktur byggd f\u00f6r SDN-implementeringar.</p>"},{"location":"linux_networking/OpenDaylight/#installation","title":"Installation","text":"<p>Ladda ner senaste version: https://www.opendaylight.org/downloads</p> <p><code>wget</code><code>https://nexus.opendaylight.org/content/repo</code><code>...-SR1.tar.gz</code></p> <p>Beryllium on Ubuntu</p> <p><code>sudo\u00a0apt-get\u00a0-y\u00a0install\u00a0openjdk-7-jdk</code> <code>cd\u00a0&amp;&amp;\u00a0echo\u00a0\"export\u00a0JAVA_HOME=/usr/lib/jvm/java-1.7.0-openjdk-amd64\"\u00a0&gt;&gt;\u00a0.profile</code> <code>tar\u00a0-xzf\u00a0distribution-karaf-0.4.1-Beryllium-SR1.tar.gz</code></p> <p>St\u00e4ng av ipv6, java har ipv6 som preferred.</p>"},{"location":"linux_networking/OpenDaylight/#konfiguration","title":"Konfiguration","text":"<p>Starta OpenDaylight</p> <p><code>cd\u00a0./distribution-karaf-[TAB]</code> <code>bin/karaf\u00a0\u00a0\u00a0#starta\u00a0med\u00a0karaf\u00a0console</code> <code>bin/start\u00a0\u00a0\u00a0#starta\u00a0i\u00a0bakgrund</code> <code>bin/stop\u00a0\u00a0\u00a0\u00a0#stoppa\u00a0controller</code></p> <p>Fr\u00e5n b\u00f6rjan \u00e4r ODL tomt s\u00e5 man f\u00e5r ladda in de features man vill anv\u00e4nda. En feature installeras en g\u00e5ng sedan \u00e4r den aktiverad \u00e4ven efter omstart. Lista tillg\u00e4ngliga features och installera n\u00e5gra basic:</p> <p><code>feature:list</code> <code>feature:install\u00a0odl-restconf\u00a0odl-l2switch-switch\u00a0odl-dlux-all</code> <code>feature:list\u00a0--installed</code></p> <p>OpenFlow</p> <p><code>feature:install\u00a0odl-openflowplugin-flow-services-ui</code></p> <p>DLUX web gui, admin pw: admin</p> <p><code>http://</code><code>:8181/index.html</code> <p>Unable to login Det tar n\u00e5gra minuter innan man kan logga in.</p>"},{"location":"linux_networking/OpenDaylight/#network","title":"Network","text":"<p>ODL kan prata med n\u00e4tverksutrustning med m\u00e5nga olika protokoll, t.ex. OpenFlow, NETCONF, BGP och OVSDB. Se Mininet. F\u00f6r Open_vSwitch:</p> <p><code>ovs-vsctl\u00a0set-controller\u00a0br0\u00a0tcp:10.0.0.20:6633</code></p> <p>Category:Network</p>"},{"location":"linux_networking/Open_vSwitch/","title":"Open vSwitch","text":"<p>Open vSwitch \u00e4r en virtuell multi layer switch, open source licensierad under Apache 2.0. Det anv\u00e4nds oftast med hypervisors f\u00f6r att koppla ihop vms med varandra mellan hostar och n\u00e4tverk, t.ex. med KVM eller Xen. Det kan ocks\u00e5 anv\u00e4ndas med dedikerad switchh\u00e5rdvara eller SDN-l\u00f6sningar. Open vSwitch har st\u00f6d f\u00f6r de flesta traditionella tekniker inklusive STP, VLAN, LACP, GRE, VXLAN, BFD, QoS och net/sflow. Open vSwitch best\u00e5r i huvudsak av VSWITCHD, OVSDB-server och en kernel-modul. Det g\u00e5r \u00e4ven k\u00f6ra distribuerat \u00f6ver flera hostar likt VMwares vDS och Cisco Nexus 1000V.</p> <p>Tools</p> <ul> <li>ovs-vsctl: configuring the ovs-vswitchd configuration database</li> <li>ovs-ofctl: monitor and administer OpenFlow switches</li> <li>ovs-dpctl: administer Open vSwitch datapaths</li> <li>ovs\u2212appctl: query and controll Open vSwitch daemons</li> </ul>"},{"location":"linux_networking/Open_vSwitch/#installation","title":"Installation","text":"<p>Ubuntu</p> <p><code>apt-cache\u00a0show\u00a0openvswitch-switch\u00a0|\u00a0grep\u00a0Version</code> <code>sudo\u00a0apt-get\u00a0install\u00a0openvswitch-switch</code></p> <p>Fedora</p> <p><code>sudo\u00a0dnf\u00a0info\u00a0openvswitch\u00a0|\u00a0grep\u00a0Version</code> <code>sudo\u00a0dnf\u00a0install\u00a0openvswitch</code></p> <p><code>sudo\u00a0systemctl\u00a0start\u00a0openvswitch</code> <code>lsmod\u00a0|\u00a0grep\u00a0openv</code></p> <p>Start at boot</p> <p><code>sudo\u00a0systemctl\u00a0enable\u00a0openvswitch</code></p>"},{"location":"linux_networking/Open_vSwitch/#konfiguration","title":"Konfiguration","text":"<p>Skapa en virtuell switch och koppla interface till den.</p> <p><code>ovs-vsctl\u00a0add-br\u00a0br0</code> <code>ovs-vsctl\u00a0add-port\u00a0br0\u00a0eth0</code> <code>ovs-vsctl\u00a0list-ifaces\u00a0br0</code></p> <p>Show</p> <p><code>ovs-vsctl\u00a0show</code> <code>ovs-vsctl\u00a0list-br</code> <code>ovs-ofctl\u00a0show\u00a0br0</code></p> <p>/etc/network/interfaces</p> <p><code>allow-ovs\u00a0ovsbr0</code> <code>iface\u00a0ovsbr0\u00a0inet\u00a0manual</code> <code>ovs_type\u00a0OVSBridge</code> <code>ovs_ports\u00a0eth1</code></p> <p>Adress till hosten</p> <p><code>ifconfig\u00a0eth0\u00a00</code> <code>dhclient\u00a0br0</code></p>"},{"location":"linux_networking/Open_vSwitch/#interface","title":"Interface","text":"<p>default all ports are VLAN trunks Access</p> <p><code>ovs-vsctl\u00a0set\u00a0port\u00a0eth1\u00a0vlan_mode=access\u00a0tag=1</code></p> <p>Trunk</p> <p><code>ovs-vsctl\u00a0set\u00a0port\u00a0eth1\u00a0vlan_mode=tagged</code></p> <p>Hybrid</p> <p><code>ovs-vsctl\u00a0set\u00a0port\u00a0eth1\u00a0vlan_mode=native-untagged\u00a0trunks=[1,3]\u00a0tag=2</code></p> <p>Show</p> <p><code>ovs-vsctl\u00a0list\u00a0port\u00a0eth1</code></p>"},{"location":"linux_networking/Open_vSwitch/#bond","title":"Bond","text":"<p><code>ovs-vsctl\u00a0add-bond\u00a0br0\u00a0bond0\u00a0eth0\u00a0eth1\u00a0lacp=active\u00a0trunks=10,11,12</code> <code>ovs-vsctl\u00a0list\u00a0port\u00a0bond0</code></p>"},{"location":"linux_networking/Open_vSwitch/#stp","title":"STP","text":"<p><code>ovs-vsctl\u00a0set\u00a0bridge\u00a0br0\u00a0stp_enable=true</code></p>"},{"location":"linux_networking/Open_vSwitch/#svi","title":"SVI","text":"<p><code>ovs-vsctl\u00a0add-port\u00a0br0\u00a0vlan90\u00a0tag=09\u00a0--\u00a0set\u00a0interface\u00a0vlan09\u00a0type=internal</code></p> <p>Interface till vms</p> <p><code>ip\u00a0tuntap\u00a0add\u00a0mode\u00a0tap\u00a0vport1</code> <code>ip\u00a0tuntap\u00a0add\u00a0mode\u00a0tap\u00a0vport2</code> <code>ovs-vsctl\u00a0add-port\u00a0testbridge\u00a0vport1</code> <code>ovs-vsctl\u00a0add-port\u00a0testbridge\u00a0vport2</code> <code>ovs-vsctl\u00a0show</code></p> <p>Kolla mac-tabell</p> <p><code>ovs-appctl\u00a0fdb/show\u00a0testbridge</code></p>"},{"location":"linux_networking/Open_vSwitch/#controller","title":"Controller","text":"<p><code>ovs-vsctl\u00a0set-controller\u00a0br0\u00a0tcp:10.0.0.20:6633</code> <code>ovs-vsctl\u00a0list\u00a0controller</code></p> <p>Tappar man konnektivitet med controllern s\u00e4tter man antingen upp flows sj\u00e4lv eller inte alls beroende p\u00e5 standalone eller secure mode.</p> <p><code>ovs-vsctl\u00a0get-fail-mode\u00a0br0</code></p> <p>Ta bort controller</p> <p><code>ovs-vsctl\u00a0del-controller\u00a0br0</code></p>"},{"location":"linux_networking/Open_vSwitch/#openflow","title":"OpenFlow","text":"<p>Open vSwitch har st\u00f6d f\u00f6r OpenFlow.</p> <p><code>ovs-vsctl\u00a0--\u00a0set\u00a0bridge\u00a0br0\u00a0protocols=openflow14</code></p>"},{"location":"linux_networking/Open_vSwitch/#patch-port","title":"Patch Port","text":"<p>Med patchportar kan man koppla ihop flera ovs:er med varandra internt inom en host. Sw1</p> <p><code>ovs-vsctl\u00a0add-port\u00a0br1\u00a0patch1-2</code> <code>ovs-vsctl\u00a0set\u00a0interface\u00a0patch1-2\u00a0type=patch</code> <code>ovs-vsctl\u00a0set\u00a0interface\u00a0patch1-2\u00a0options:peer=patch2-1</code></p> <p>Sw2</p> <p><code>ovs-vsctl\u00a0add-port\u00a0br2\u00a0patch2-1</code> <code>ovs-vsctl\u00a0set\u00a0interface\u00a0patch2-1\u00a0type=patch</code> <code>ovs-vsctl\u00a0set\u00a0interface\u00a0patch2-1\u00a0options:peer=patch1-2</code></p> <p><code>ovs-vsctl\u00a0show</code></p>"},{"location":"linux_networking/Open_vSwitch/#sflow","title":"sFlow","text":"<p>Open vSwitch kan streama telemetry med sFlow.</p> <p><code>service\u00a0sflowovsd\u00a0start</code></p> <p>Category:Network</p>"},{"location":"linux_networking/Quagga/","title":"Quagga","text":"<p>Quagga \u00e4r en network routing software suite och har st\u00f6d f\u00f6r OSPF, BGP, RIP och IS-IS. Konfigurationsyntaxen \u00e4r generellt v\u00e4ldigt lik Cisco IOS. Quagga har en core daemon som heter zebra och sedan klienter till det, ospfd, isisd, ripd, ospf6d, ripngd och bgpd. Zebra \u00e4r en IP-routing manager som st\u00e5r f\u00f6r kommunikation med kernel, interface och redistribution mellan olika routingprotokoll.</p>"},{"location":"linux_networking/Quagga/#installation","title":"Installation","text":"<p>Vill man ha senaste versionen kan man beh\u00f6va ta ner paketet och installera manuellt annars funkar pakethanterare.</p> <p><code>dnf\u00a0install\u00a0quagga</code> <code>apt-get\u00a0install\u00a0quagga</code></p> <p>Allow routing in os</p> <p><code>echo\u00a0\"net.ipv4.conf.all.forwarding=1\"\u00a0|\u00a0sudo\u00a0tee\u00a0-a\u00a0/etc/sysctl.conf</code> <code>echo\u00a0\"net.ipv4.conf.default.forwarding=1\"\u00a0|\u00a0sudo\u00a0tee\u00a0-a\u00a0/etc/sysctl.conf</code> <code>sudo\u00a0sysctl\u00a0-p</code></p>"},{"location":"linux_networking/Quagga/#konfiguration","title":"Konfiguration","text":"<p>Sl\u00e5 p\u00e5 det som \u00e4r \u00f6nskv\u00e4rt genom att editera daemons-filen.</p> <p><code>sudo\u00a0nano\u00a0/etc/quagga/daemons</code></p> <p>L\u00e4gg sedan in grundkonf f\u00f6r zebra.</p> <p><code>sudo\u00a0cp\u00a0/usr/share/doc/quagga/examples/zebra.conf.sample\u00a0/etc/quagga/zebra.conf</code> <code>sudo\u00a0service\u00a0quagga\u00a0restart</code></p> <p>File Permissions</p> <p><code>sudo\u00a0chown\u00a0quagga.quaggavty\u00a0/etc/quagga/*.conf</code> <code>sudo\u00a0chmod\u00a0640\u00a0/etc/quagga/*.conf</code></p> <p>Zebra-only CLI</p> <p><code>telnet\u00a0localhost\u00a0zebra</code></p> <p>VTYSH, CLI som anv\u00e4nds f\u00f6r att sk\u00f6ta all quagga-konfiguration.</p> <p><code>sudo\u00a0cp\u00a0/usr/share/doc/quagga/examples/vtysh.conf.sample\u00a0/etc/quagga/vtysh.conf</code> <code>sudo\u00a0chown\u00a0quagga:quaggavty\u00a0/etc/quagga/vtysh.conf\u00a0&amp;&amp;\u00a0sudo\u00a0chmod\u00a0660\u00a0/etc/quagga/vtysh.conf</code> <code>sudo\u00a0su\u00a0-</code> <code>export\u00a0VTYSH_PAGER=more</code> <code>vtysh</code></p> <p>wr f\u00f6r att spara</p>"},{"location":"linux_networking/Quagga/#ospf","title":"OSPF","text":"<p>Se Cisco OSPF f\u00f6r mer info om OSPF.</p> <p><code>sudo\u00a0cp\u00a0/usr/share/doc/quagga/examples/ospfd.conf.sample\u00a0/etc/quagga/ospfd.conf</code> <code>sudo\u00a0nano\u00a0/etc/quagga/ospfd.conf\u00a0&amp;&amp;\u00a0sudo\u00a0service\u00a0quagga\u00a0restart</code> <code>hostname\u00a0ospfd</code> <code>router\u00a0ospf</code> <code>network\u00a010.0.0.0/24\u00a0area\u00a00</code></p> <p>OSPF-only CLI</p> <p><code>telnet\u00a0localhost\u00a0ospfd</code></p> <p>wr f\u00f6r att spara</p>"},{"location":"linux_networking/Quagga/#bgp","title":"BGP","text":"<p>Se Cisco BGP f\u00f6r mer info om BGP.</p> <p><code>sudo\u00a0cp\u00a0/usr/share/doc/quagga/examples/bgpd.conf.sample\u00a0/etc/quagga/bgpd.conf</code> <code>sudo\u00a0nano\u00a0/etc/quagga/bgpd.conf\u00a0&amp;&amp;\u00a0sudo\u00a0service\u00a0quagga\u00a0restart</code> <code>hostname\u00a0bgpd</code> <code>router\u00a0bgp\u00a0100</code> <code>bgp\u00a0router-id\u00a010.0.0.1</code> <code>network\u00a010.0.0.0/24</code> <code>neighbor\u00a010.0.0.2\u00a0remote-as\u00a0100</code></p> <p>BGP-only CLI</p> <p><code>telnet\u00a0localhost\u00a0bgpd</code></p> <p>wr f\u00f6r att spara</p>"},{"location":"linux_networking/Quagga/#evpn","title":"EVPN","text":"<p>Ethernet VPN (RFC 7432) \u00e4r en modernare variant \u00e4n VPLS f\u00f6r att tillhandah\u00e5lla Ethernet multipoint services \u00f6ver MPLS eller IP. Det \u00e4r \u00f6ppet s\u00e5 det finns interoperability med andra network vendors, se t.ex. Cisco VXLAN.</p> <p>OBS detta finns \u00e4n s\u00e5l\u00e4nge endast i en community fork av Quagga som heter FRR.</p> <p>VTEP</p> <p><code>router\u00a0bgp\u00a0100</code> <code>address-family\u00a0evpn</code> <code>neighbor\u00a010.0.0.10\u00a0activate</code> <code>advertise-all-vni</code> <code>exit-address-family</code></p> <p>Route reflector</p> <p><code>address-family\u00a0evpn</code> <code>neighbor\u00a010.0.0.11\u00a0activate</code> <code>neighbor\u00a010.0.0.11\u00a0route-reflector-client</code> <code>exit-address-family</code></p> <p>Verify</p> <p><code>show\u00a0bgp\u00a0evpn\u00a0route</code> <code>show\u00a0evpn\u00a0vni</code> <code>show\u00a0evpn\u00a0mac\u00a0vni\u00a0100</code></p> <p>Category:Network</p>"},{"location":"linux_networking/Suzieq/","title":"Suzieq","text":"<p>Suzieq \u00e4r ett open-source multi-vendor network observability tool som man kan anv\u00e4nda f\u00f6r att analysera ett n\u00e4tverk med hj\u00e4lp av olika queries. Det finns st\u00f6d f\u00f6r Arista, Cisco, Juniper mm.</p> <p>Skapa ett device inventory, t.ex. /home/USER/suzieq_inventory.yml.</p> <pre><code>sources:\n- name: device_list\n  hosts:\n    - url: ssh://10.1.0.10\n    - url: ssh://10.1.0.11\n    - url: ssh://10.1.0.12\n\nauths:\n- name: svc\n  username: svc-readonly\n  password: password123\n\ndevices:\n- name: nxos\n  devtype: nxos\n  ignore-known-hosts: true\n\nnamespaces:\n- name: oob\n  source: device_list\n  auth: svc\n  device: nxos\n</code></pre> <p>S\u00e4tt upp Suzieq med Docker</p> <pre><code>docker volume create suzieq-storage\ndocker run -itd --rm -p 8501:8501 -e TZ=Europe/Stockholm \\\n  -v suzieq-storage:/suzieq/parquet \\\n  -v /home/USER/suzieq_inventory.yml:/suzieq/inventory/suzieq.yml \\\n  --name suzieq netenglabs/suzieq:latest\n\ndocker attach suzieq\n\nsq-poller -I /suzieq/inventory/suzieq.yml &amp;\nsuzieq-gui &amp;\n</code></pre> <p>Webgui n\u00e5r man sedan p\u00e5 port 8501.</p> <p>Category:Network</p>"},{"location":"linux_networking/VPP/","title":"VPP","text":"<p>Vector Packet Processing \u00e4r en network packet processing stack f\u00f6r x86-h\u00e5rdvara. Det k\u00f6r en Linux user space process och har st\u00f6d f\u00f6r bl.a. IPSEC, GRE, VXLAN, MPLS, VRF, VLAN, Segment Routing. Med denna mjukvara kan en vanlig server kan bli en router/switch med v\u00e4ldigt h\u00f6g throughput. Det \u00e4r en open source version av Cisco's Vector Packet Processing (VPP) teknologi.</p>"},{"location":"linux_networking/VPP/#installation","title":"Installation","text":"<p>Ubuntu 16.04</p> <p><code>echo\u00a0\"deb</code><code>https://nexus.fd.io/content/repositories/fd.io.ubuntu.xenial.main/</code><code>./\"\u00a0|\u00a0sudo\u00a0tee\u00a0-a\u00a0/etc/apt/sources.list.d/99fd.io.list</code> <code>sudo\u00a0apt\u00a0update\u00a0&amp;&amp;\u00a0sudo\u00a0apt\u00a0install\u00a0vpp\u00a0vpp-lib\u00a0vpp-dpdk-dkms</code></p> <p>Fedora</p> <p><code>sudo\u00a0curl\u00a0-o\u00a0/etc/yum.repos.d/fdio.repo</code><code>https://paste.fedoraproject.org/355177/60579220/raw/</code> <code>sudo\u00a0dnf\u00a0update\u00a0&amp;&amp;\u00a0sudo\u00a0dnf\u00a0install\u00a0vpp</code></p>"},{"location":"linux_networking/VPP/#konfiguration","title":"Konfiguration","text":"<p><code>cat\u00a0/etc/vpp/startup.conf</code></p> <p>Service</p> <p><code>sudo\u00a0systemctl\u00a0start\u00a0vpp</code> <code>sudo\u00a0systemctl\u00a0status\u00a0vpp</code></p> <p>VPP lyssnar default p\u00e5 tcp port 5000</p> <p><code>telnet\u00a00\u00a05000</code></p> <p>VPP shell</p> <p><code>show\u00a0interface</code></p> <p>Bash</p> <p><code>sudo\u00a0vppctl\u00a0show\u00a0ip\u00a0arp</code></p> <p>Honeycomb \u00e4r en agent man kan k\u00f6ra p\u00e5 samma host som tillhandah\u00e5ller yang models via netconf/restconf f\u00f6r remote management.</p> <p><code>sudo\u00a0yum\u00a0install\u00a0honeycomb</code></p> <p>Category:Network</p>"},{"location":"linux_networking/VyOS/","title":"VyOS","text":"<p>VyOS \u00e4r ett Linux-baserat network operating system med mjukvaru-routing, firewall och VPN funktionalitet. Det \u00e4r en community fork av Vyatta Core med JunOS-liknande syntax och bygger p\u00e5 Debian och Quagga routing engine. Det har bl.a. st\u00f6d f\u00f6r DMVPN, VXLAN, OSPF, BGP och IPv6. Men saknar tyv\u00e4rr st\u00f6d f\u00f6r Multicast routing och MPLS. Det finns m\u00f6jlighet att installera FastNetMon direkt p\u00e5 en VyOS-router, se l\u00e4nk 1</p>"},{"location":"linux_networking/VyOS/#installation","title":"Installation","text":"<p>Ladda ner OVA alternativt installera fr\u00e5n iso eller netbootxyz. PW: vyos</p> <p><code>vyos@vyos:~$\u00a0install\u00a0image</code></p>"},{"location":"linux_networking/VyOS/#uppgradering","title":"Uppgradering","text":"<p><code>add\u00a0system\u00a0image</code><code>https://s3.amazonaws.com/s3-us.vyos.io/rolling/current/vyos-rolling-latest.iso</code> <code>show\u00a0system\u00a0image</code></p>"},{"location":"linux_networking/VyOS/#konfiguration","title":"Konfiguration","text":"<p>Byt till konfigurationsl\u00e4ge.</p> <p><code>configure</code></p> <p>\u00c4ndringar m\u00e5ste commitas. F\u00f6r att spara till startup config anv\u00e4nds save.</p> <p><code>commit</code> <code>save</code></p> <p>Show run</p> <p><code>show\u00a0conf</code></p> <p>Show run kommandon</p> <p><code>show\u00a0configuration\u00a0commands</code></p> <p>SSH</p> <p><code>set\u00a0service\u00a0ssh\u00a0port\u00a0'22'</code> <code>set\u00a0service\u00a0ssh\u00a0listen-address\u00a0'172.20.0.1'</code></p> <p>Logga in med ssh-nyckel</p> <p><code>set\u00a0system\u00a0login\u00a0user\u00a0vyos\u00a0authentication\u00a0public-keys\u00a0user@mgm\u00a0key\u00a0'AAAAC3NzaC1lZAAAIGCW6VcUwAzbX0gipoiDYBxxxxxxxxx'</code> <code>set\u00a0system\u00a0login\u00a0user\u00a0vyos\u00a0authentication\u00a0public-keys\u00a0user@mgm\u00a0type\u00a0'ssh-ed25519'</code></p> <p>Live logging</p> <p><code>monitor\u00a0log</code></p> <p>System</p> <p><code>set\u00a0system\u00a0domain-name\u00a0hackernet.se</code> <code>set\u00a0system\u00a0host-name\u00a0vyos01</code> <code>set\u00a0system\u00a0name-server\u00a0208.67.222.222</code> <code>set\u00a0system\u00a0name-server\u00a0208.67.220.220</code> <code>set\u00a0system\u00a0time-zone\u00a0Europe/Stockholm</code></p> <p>Backup</p> <p><code>set\u00a0system\u00a0config-management\u00a0commit-archive\u00a0location\u00a0scp://user@172.20.0.20:/vyos_backups/</code></p> <p>Testa backuptagning manuellt.</p> <p><code>copy\u00a0file\u00a0running://config/config.boot\u00a0to\u00a0scp://user@172.20.0.20:/vyos_backups/</code></p> <p>Interface</p> <p><code>configure</code> <code>set\u00a0interfaces\u00a0ethernet\u00a0eth0\u00a0address\u00a0'10.0.0.1/24'</code> <code>set\u00a0interfaces\u00a0ethernet\u00a0eth0\u00a0description\u00a0'INSIDE'</code> <code>show\u00a0interfaces</code></p> <p>Default route</p> <p><code>set\u00a0protocols\u00a0static\u00a0route\u00a00.0.0.0/0\u00a0next-hop\u00a010.0.10.1\u00a0distance\u00a0'1'</code></p> <p>Verify</p> <p><code>show\u00a0ip\u00a0route</code></p> <p>Comments Man kan l\u00e4gga in kommentarer var som helst i konfigurationen.</p> <p><code>comment</code><code>path-config-section</code><code>\"comment\"</code></p> <p>Default editerar man fr\u00e5n top level ([edit]) men f\u00f6r att undvika att alltid skriva l\u00e5nga kommandon kan man st\u00e4lla sig var som helst i strukturen och anv\u00e4nda relativa paths. \"up\" \u00e4r f\u00f6r att backa.</p> <p><code>edit\u00a0interfaces\u00a0ethernet\u00a0eth0</code> <code>set\u00a0address\u00a0'10.0.0.1/24'</code></p> <p>\u00d6ka ring queue buffer size</p> <p><code>sudo\u00a0ethtool\u00a0-g\u00a0eth0</code> <code>sudo\u00a0ethtool\u00a0-G\u00a0eth0\u00a0tx\u00a04096\u00a0rx\u00a04096</code></p>"},{"location":"linux_networking/VyOS/#nat","title":"NAT","text":"<p>Overload/PAT</p> <p><code>set\u00a0nat\u00a0source\u00a0rule\u00a010\u00a0outbound-interface\u00a0eth0</code> <code>set\u00a0nat\u00a0source\u00a0rule\u00a010\u00a0source\u00a0address\u00a010.0.0.0/24</code> <code>set\u00a0nat\u00a0source\u00a0rule\u00a010\u00a0translation\u00a0address\u00a0masquerade</code></p>"},{"location":"linux_networking/VyOS/#ipv6","title":"IPv6","text":"<p>Din ISP m\u00e5ste supporta IPv6 prefix delegation. F\u00f6ljande funkade f\u00f6r Bahnhof.</p> <p>Sl\u00e5 p\u00e5 prefix-delegation(pd) p\u00e5 ditt wan interface, och assigna ett prefix till ditt interface i detta fallet eth2.</p> <p><code>set\u00a0interfaces\u00a0ethernet\u00a0eth0\u00a0address\u00a0'dhcpv6'</code> <code>set\u00a0interfaces\u00a0ethernet\u00a0eth0\u00a0description\u00a0'WAN'</code> <code>set\u00a0interfaces\u00a0ethernet\u00a0eth0\u00a0dhcpv6-options\u00a0pd\u00a00\u00a0interface\u00a0eth2\u00a0sla-id\u00a0'2'</code> <code>set\u00a0interfaces\u00a0ethernet\u00a0eth0\u00a0dhcpv6-options\u00a0pd\u00a00\u00a0length\u00a0'56'</code></p> <p>S\u00e4tt sedan p\u00e5 router-advert p\u00e5 eth2 f\u00f6r att ge ut en IPv6 address och DNS server till klienterna.</p> <p><code>set\u00a0service\u00a0router-advert\u00a0interface\u00a0eth2\u00a0name-server\u00a0'2001:4860:4860::8888'</code> <code>set\u00a0service\u00a0router-advert\u00a0interface\u00a0eth2\u00a0name-server\u00a0'2001:4860:4860::8844'</code> <code>set\u00a0service\u00a0router-advert\u00a0interface\u00a0eth2\u00a0prefix\u00a0::/64</code></p>"},{"location":"linux_networking/VyOS/#router-on-a-stick","title":"Router-on-a-stick","text":"<p>Sub-interfaces</p> <p><code>set\u00a0firewall\u00a0name\u00a0LOCAL\u00a0default-action\u00a0'drop'</code> <code>set\u00a0firewall\u00a0name\u00a0LOCAL\u00a0rule\u00a010\u00a0action\u00a0'accept'</code> <code>set\u00a0firewall\u00a0name\u00a0LOCAL\u00a0rule\u00a010\u00a0state\u00a0established\u00a0'enable'</code> <code>set\u00a0firewall\u00a0name\u00a0LOCAL\u00a0rule\u00a010\u00a0state\u00a0related\u00a0'enable'</code> <code>set\u00a0firewall\u00a0name\u00a0OUTSIDE\u00a0default-action\u00a0'drop'</code> <code>set\u00a0firewall\u00a0name\u00a0OUTSIDE\u00a0rule\u00a010\u00a0action\u00a0'accept'</code> <code>set\u00a0firewall\u00a0name\u00a0OUTSIDE\u00a0rule\u00a010\u00a0state\u00a0established\u00a0'enable'</code> <code>set\u00a0firewall\u00a0name\u00a0OUTSIDE\u00a0rule\u00a010\u00a0state\u00a0related\u00a0'enable'</code> <code>set\u00a0interfaces\u00a0ethernet\u00a0eth0\u00a0vif\u00a02\u00a0address\u00a0'172.20.0.1/24'</code> <code>set\u00a0interfaces\u00a0ethernet\u00a0eth0\u00a0vif\u00a02\u00a0description\u00a0'LAN'</code> <code>set\u00a0interfaces\u00a0ethernet\u00a0eth0\u00a0vif\u00a03\u00a0address\u00a0'dhcp'</code> <code>set\u00a0interfaces\u00a0ethernet\u00a0eth0\u00a0vif\u00a03\u00a0description\u00a0'WAN'</code> <code>set\u00a0interfaces\u00a0ethernet\u00a0eth0\u00a0vif\u00a03\u00a0firewall\u00a0in\u00a0name\u00a0'OUTSIDE'</code> <code>set\u00a0interfaces\u00a0ethernet\u00a0eth0\u00a0vif\u00a03\u00a0firewall\u00a0local\u00a0name\u00a0'LOCAL'</code></p>"},{"location":"linux_networking/VyOS/#zerotier","title":"Zerotier","text":"<pre><code>sudo -i\ncurl -s https://install.zerotier.com | sudo bash\ncd /var/lib &amp;&amp; mv /var/lib/zerotier-one /config/scripts/ &amp;&amp; ln -s /config/scripts/zerotier-one\n/var/lib/zerotier-one/zerotier-cli join af78xxxxxxx\n</code></pre> <p>Upgrade</p> <pre><code>sudo -i\napt update &amp;&amp; apt install zerotier-one\n</code></pre>"},{"location":"linux_networking/VyOS/#netbootxyz","title":"netboot.xyz","text":"<p>DHCP-server + TFTP-server + netboot.xyz, all-in-one.</p> <p><code>set\u00a0service\u00a0dhcp-server\u00a0shared-network-name\u00a0LAN\u00a0subnet\u00a0172.20.0.0/24\u00a0bootfile-server\u00a0172.20.0.1</code> <code>set\u00a0service\u00a0dhcp-server\u00a0shared-network-name\u00a0LAN\u00a0subnet\u00a0172.20.0.0/24\u00a0bootfile-name\u00a0netboot.xyz.efi</code> <code>set\u00a0service\u00a0tftp-server\u00a0directory\u00a0/config/tftproot</code> <code>set\u00a0service\u00a0tftp-server\u00a0listen-address\u00a0172.20.0.1</code> <code>commit</code></p> <p><code>sudo\u00a0-i</code> <code>mkdir\u00a0/config/tftproot\u00a0&amp;&amp;\u00a0cd\u00a0/config/tftproot/\u00a0&amp;&amp;\u00a0wget</code><code>https://boot.netboot.xyz/ipxe/netboot.xyz.efi</code></p> <p>OBS funkar endast med EFI-klienter (med Secure Boot avst\u00e4ngt).</p> <p>Category:Network</p>"},{"location":"linux_os/Debian/","title":"Debian","text":"<p>Category:Distar Debian \u00e4r en dist som \u00e4r inriktad p\u00e5 stabilitet.</p>"},{"location":"linux_os/Debian/#first-5-minutes","title":"First 5 minutes","text":"<p>Debian server installeras med rootkontot som enda kontot. G\u00f6r f\u00f6ljande f\u00f6r att \u00f6ka s\u00e4kerheten. Logga in som root:</p>"},{"location":"linux_os/Debian/#user","title":"User","text":"<p><code>adduser\u00a0trevor</code> <code>apt-get\u00a0update\u00a0&amp;&amp;\u00a0apt-get\u00a0install\u00a0sudo</code> <code>usermod\u00a0-a\u00a0-G\u00a0sudo\u00a0trevor</code> <code>sed\u00a0-i\u00a0-r\u00a0's/PermitRootLogin\u00a0yes/PermitRootLogin\u00a0no/g'\u00a0/etc/ssh/sshd_config</code> <code>systemctl\u00a0restart\u00a0ssh</code></p>"},{"location":"linux_os/Debian/#hostname","title":"Hostname","text":"<p><code>echo\u00a0\"hostname\"\u00a0&gt;\u00a0/etc/hostname</code> <code>hostname\u00a0-F\u00a0/etc/hostname</code></p>"},{"location":"linux_os/Debian/#tidszon","title":"Tidszon","text":"<p><code>dpkg-reconfigure\u00a0tzdata</code></p>"},{"location":"linux_os/Debian/#pakethanterare","title":"Pakethanterare","text":"<p>Apt</p>"},{"location":"linux_os/Debian/#goodies","title":"Goodies","text":"<p>Debian Goodies \u00e4r en upps\u00e4ttning verktyg som \u00e4r bra att k\u00e4nna till.</p> <p><code>apt-get\u00a0install\u00a0debian-goodies</code></p> <p>N\u00e4r man installerar ett nytt paket kan det h\u00e4nda att program som redan k\u00f6rs anv\u00e4nder filer som blivit uppgraderade. F\u00f6r att ta reda p\u00e5 detta:</p> <p><code>checkrestart</code> <code>checkrestart\u00a0-v</code></p> <p>Vilket installerat paket tar mest plats:</p> <p><code>dpigs</code></p> <p>Fels\u00f6k varf\u00f6r n\u00e5got slutat fungera vid uppdatering</p> <p><code>which-pkg-broke</code><code>packagename</code></p>"},{"location":"linux_os/Fedora/","title":"Fedora","text":"<p>Fedora \u00e4r en RPM-baserad linuxdistribution fr\u00e4mst utvecklad av Red Hat. Hela distributionen \u00e4r fri programvara och anv\u00e4nds som en bas (l\u00e4s PoC) f\u00f6r den kommersiella distributionen Red Hat Enterprise Linux. Kickstartfil: Fedora.</p>"},{"location":"linux_os/Fedora/#pakethanterare","title":"Pakethanterare","text":"<p>Se Yum Se DNF</p>"},{"location":"linux_os/Fedora/#network","title":"Network","text":"<p><code>systemctl\u00a0stop\u00a0NetworkManager.service\u00a0&amp;&amp;\u00a0systemctl\u00a0disable\u00a0NetworkManager.service</code> <code>systemctl\u00a0enable\u00a0network.service\u00a0&amp;&amp;\u00a0systemctl\u00a0start\u00a0network.service</code></p>"},{"location":"linux_os/Fedora/#uppgradering","title":"Uppgradering","text":"<p>Till 23 med hj\u00e4lp av fedup som tankar alla n\u00f6dv\u00e4ndiga filer.</p> <p><code>sudo\u00a0dnf\u00a0-y\u00a0update\u00a0&amp;&amp;\u00a0sudo\u00a0dnf\u00a0-y\u00a0install\u00a0fedup\u00a0&amp;&amp;\u00a0sudo\u00a0fedup\u00a0--network\u00a023</code> <code>reboot</code></p>"},{"location":"linux_os/Fedora/#auto-update","title":"Auto update","text":"<p><code>sudo\u00a0dnf\u00a0-y\u00a0install\u00a0dnf-automatic</code> <code>sudo\u00a0systemctl\u00a0enable\u00a0dnf-automatic.timer</code></p> <p>Default kollas det efter uppdateringar en g\u00e5ng per dygn</p>"},{"location":"linux_os/Fedora/#ssh","title":"SSH","text":"<p><code>sudo\u00a0systemctl\u00a0enable\u00a0sshd.service</code></p>"},{"location":"linux_os/Fedora/#gnome","title":"Gnome","text":"<p>I det grafiska gr\u00e4nsnittet g\u00e5r det bara att s\u00e4tta 15 minuter som max p\u00e5 Blank screen under Power saving. H\u00f6gre v\u00e4rde g\u00e5r att s\u00e4tta med kommando.</p> <p><code>gsettings\u00a0set\u00a0org.gnome.desktop.session\u00a0idle-delay\u00a03600\u00a0\u00a0\u00a0#sekunder</code> <code>gsettings\u00a0set\u00a0org.gnome.desktop.screensaver\u00a0lock-delay\u00a010</code></p> <p>Desktop</p> <p><code>gsettings\u00a0set\u00a0org.gnome.desktop.background\u00a0show-desktop-icons\u00a0true</code> <code>gsettings\u00a0set\u00a0org.gnome.nautilus.desktop\u00a0home-icon-visible\u00a0false</code></p>"},{"location":"linux_os/Fedora/#grub-menu","title":"GRUB menu","text":"<p>Fedora anv\u00e4nder GRUB2 som bootloader och default visas menyn i 5 sekunder vid uppstart. Detta g\u00e5r att ta bort genom att \u00e4ndra/l\u00e4gga till f\u00f6ljande.</p> <p><code>sudo\u00a0nano\u00a0/etc/default/grub</code> <code>GRUB_TIMEOUT=0</code> <code>GRUB_HIDDEN_TIMEOUT=1</code> <code>GRUB_HIDDEN_TIMEOUT_QUIET=true</code></p> <p>Hidden timeout 1 ger m\u00f6jligheten att komma \u00e5t menyn med ESC i 1 sekund under uppstart.</p> <p>Uppdatera GRUB</p> <p><code>sudo\u00a0grub2-mkconfig\u00a0-o\u00a0/boot/grub2/grub.cfg</code></p> <p>OBS K\u00f6r man UEFI kan filen heta /boot/efi/EFI/fedora/grub.cfg</p> <p>Category:Distar</p>"},{"location":"linux_os/Kali_Linux/","title":"Kali Linux","text":"<p>Category:Distar Kali Linux \u00e4r en Debian-baserad Linuxdistribution avsedd f\u00f6r digitala penetrationstester och etisk hacking. Kali \u00e4r uppf\u00f6ljaren till BackTrack.</p> <p>https://www.kali.org/</p>"},{"location":"linux_os/Kali_Linux/#grundsetup","title":"Grundsetup","text":"<p>IP</p> <p><code>ifconfig\u00a0eth0\u00a010.0.0.5/24\u00a0up</code> <code>route\u00a0add\u00a0default\u00a0gw\u00a010.0.0.1</code> <code>echo\u00a0nameserver\u00a08.8.8.8\u00a0&gt;\u00a0/etc/resolv.conf</code></p> <p>SSH-server</p> <p><code>start\u00a0networking</code> <code>sshd-generate</code> <code>start\u00a0ssh</code> <code>update-rc.d\u00a0-f\u00a0ssh\u00a0defaults</code></p>"},{"location":"linux_os/Kali_Linux/#docker","title":"Docker","text":"<p>Et snabbt s\u00e4tt att komma ig\u00e5ng med Kali \u00e4r med docker.</p> <p><code>docker\u00a0pull\u00a0kalilinux/kali-linux-docker</code> <code>docker\u00a0run\u00a0-t\u00a0-i\u00a0kalilinux/kali-linux-docker\u00a0/bin/bash</code> <code>root@aaca1ac4f5b5:/#\u00a0ping\u00a08.8.8.8</code></p>"},{"location":"linux_os/Kali_Linux/#verktyg","title":"Verktyg","text":"<p>Kali \u00e4r utrustat med v\u00e4ldigt m\u00e5nga verktyg. H\u00e4r listas n\u00e5gra och vad de anv\u00e4nds till.</p> <p>Nmap Security Scanner</p> <p>Yersinia Attacker mot det mesta som har med n\u00e4tverk att g\u00f6ra, inkl DHCP, STP, CDP, DTP, HSRP, VTP, 802.1q, 802.1x. Startas med:</p> <p><code>yersinia\u00a0-G</code></p> <p>ARPSpoof</p> <p><code>echo\u00a01\u00a0&gt;\u00a0/proc/sys/net/ipv4/ip_forward</code> <code>arpsoof\u00a0-i\u00a0eth0\u00a0-t\u00a010.0.0.15\u00a010.0.0.1</code> <code>arpsoof\u00a0-i\u00a0eth0\u00a0-t\u00a010.0.0.1\u00a010.0.0.15</code></p> <p>Samla sedan data</p> <p><code>driftnet\u00a0-i\u00a0eth0</code> <code>urlsnarf\u00a0-i\u00a0eth0</code></p> <p>TCP Synflood</p> <p><code>use\u00a0auxiliary/dos/tcp/synflood</code> <code>set\u00a0RHOST\u00a0192.168.1.1</code> <code>set\u00a0SHOST\u00a010.0.0.50</code> <code>run</code></p> <p>Hydra Password cracker</p> <p>Maltego Gather information about ip addresses and domains</p> <p>Metasploit Vulnerability testing</p> <p>Burp Suite Proxy/Spider</p> <p>Scapy Packet Manipulation Tool</p> <p>Hping3 - TCP Ping</p> <p><code>hping3\u00a0-S\u00a010.10.10.10\u00a0-a\u00a010.10.10.12\u00a0-p\u00a022\u00a0--flood</code></p> <p>Parasite6 - IPv6 MITM</p> <p><code>echo\u00a01\u00a0&gt;\u00a0/proc/sys/net/ipv6/conf/all/forwarding</code> <code>parasite6\u00a0-lR\u00a0eth0</code></p>"},{"location":"linux_os/Kali_Linux/#wireless","title":"Wireless","text":"<p>B\u00f6rja med att konfa svenska inst\u00e4llningar</p> <p><code>iw\u00a0reg\u00a0set\u00a0SE</code> <code>iwconfig\u00a0wlan0\u00a0txpower\u00a027</code></p> <p>Uncovering Hidden SSID</p> <p><code>airmon-ng\u00a0start\u00a0wlan0</code> <code>airodump-ng\u00a0mon0</code> <code>airodump-ng\u00a0-c\u00a011\u00a0mon0</code> <code>aireplay-ng\u00a0-0\u00a02\u00a0-a\u00a0[BSSID]\u00a0mon0</code></p> <p><code>iwconfig\u00a0wlan0\u00a0essid\u00a0[ESSID]\u00a0channel\u00a011</code> <code>macchanger\u00a0-m\u00a0[MAC\u00a0address]\u00a0wlan0</code></p> <p>WPA2</p> <p><code>airmon-ng\u00a0start\u00a0wlan0</code> <code>airodump-ng\u00a0-w\u00a0OURFILE\u00a0-c\u00a011\u00a0--bssid\u00a0[BSSID]\u00a0mon0</code> <code>aireplay-ng\u00a0-0\u00a02\u00a0-a\u00a0[BSSID]\u00a0mon0</code> <code>aircrack-ng\u00a0OURFILE-01.cap\u00a0-w\u00a0/pentest/passwords/wordlists/darkc0de.lst</code></p> <p><code>wpaclean\u00a0&lt;out.cap&gt;\u00a0&lt;in.cap&gt;</code></p> <p>with crunch:</p> <p><code>crunch\u00a0x\u00a0X\u00a0\"characters\"\u00a0|\u00a0aircrack-ng\u00a0\".cap\u00a0file\"\u00a0-w\u00a0-\u00a0-e\u00a0\"essid\"</code></p> <p>with john the ripper:</p> <p><code>john\u00a0-stdout\u00a0-incremental:all\u00a0|\u00a0aircrack-ng\u00a0\".cap\u00a0file\"\u00a0-w\u00a0-\u00a0-e\u00a0\"essid\"</code></p> <p>Rogue AP</p> <p><code>apt-get\u00a0install\u00a0dhcp3-server\u00a0-y</code> <code>mv\u00a0/etc/dhcp3/dhcpd.conf\u00a0/etc/dhcp3/dhcpd.conf.bak</code> <code>nano\u00a0/etc/dhcp3/dhcpd.conf</code> <code>ddns-update-style\u00a0ad-hoc;</code> <code>default-lease-time\u00a0600;</code> <code>max-lease-time\u00a07200;</code> <code>subnet\u00a0192.168.1.0\u00a0netmask\u00a0255.255.255.0\u00a0{</code> <code>option\u00a0subnet-mask\u00a0255.255.255.0;</code> <code>option\u00a0broadcast-address\u00a0192.168.1.255;</code> <code>option\u00a0routers\u00a0192.168.1.1;</code> <code>option\u00a0domain-name-servers\u00a0192.168.1.1;</code> <code>range\u00a0192.168.1.10\u00a0192.168.1.100;</code> <code>}</code></p> <p><code>airmon-ng\u00a0start\u00a0wlan0</code> <code>airodump-ng\u00a0mon0</code> <code>airbase-ng\u00a0--essid\u00a0\"Hitlerklubben\"\u00a0-c\u00a011\u00a0mon0</code> <code>ifconfig\u00a0at0\u00a0192.168.1.1/24\u00a0up</code> <code>route\u00a0add\u00a0-net\u00a0192.168.1.0\u00a0netmask\u00a0255.255.255.0\u00a0gw\u00a0192.168.1.1</code> <code>dhcpd3\u00a0-cf\u00a0/etc/dhcp3/dhcpd.conf\u00a0-pf\u00a0/var/run/dhcp3-server/dhcpd.pid\u00a0at0</code> <code>/etc/init.d/dhcp3-server\u00a0start</code> <code>iptables\u00a0--table\u00a0nat\u00a0--append\u00a0POSTROUTING\u00a0--out-interface\u00a0eth0\u00a0-j\u00a0MASQUERADE</code> <code>iptables\u00a0--append\u00a0FORWARD\u00a0--in-interface\u00a0at0\u00a0-j\u00a0ACCEPT</code> <code>echo\u00a01\u00a0&gt;\u00a0/proc/sys/net/ipv4/ip_forward</code></p> <p>Bridging</p> <p><code>airmon-ng\u00a0start\u00a0wlan0</code> <code>airodump-ng\u00a0mon0</code> <code>airbase-ng\u00a0--essid\u00a0\"Hitlerklubben\"\u00a0-c\u00a011\u00a0mon0</code> <code>ifconfig\u00a0at0</code> <code>brctl\u00a0addbr\u00a0BR1</code> <code>brctl\u00a0addif\u00a0BR1\u00a0eth0</code> <code>brctl\u00a0addif\u00a0BR1\u00a0at0</code> <code>brctl\u00a0show</code> <code>ifconfig\u00a0eth0\u00a00.0.0.0\u00a0up</code> <code>ifconfig\u00a0at0\u00a00.0.0.0\u00a0up</code> <code>ifconfig\u00a0BR1\u00a0192.168.1.50/24\u00a0up</code> <code>echo\u00a01\u00a0&gt;\u00a0/proc/sys/net/ipv4/ip_forward</code></p>"},{"location":"linux_os/Kali_Linux/#ipv6","title":"IPv6","text":"<p>Med IPv6 finns det mycket att t\u00e4nka p\u00e5 och testa.</p> <p><code>fake_router6\u00a0eth0\u00a02001::/64</code> <code>detect-new-ip6\u00a0eth0</code> <code>dos-new-ip6\u00a0eth0</code> <code>flood_router6\u00a0eth0</code> <code>flood_advertise6\u00a0eth0</code> <code>implementation6\u00a0eth0\u00a02001::1</code> <code>smurf6\u00a0eth0\u00a02001::1</code></p>"},{"location":"linux_os/Kali_Linux/#captive-portal","title":"Captive portal","text":"<p>M\u00e5nga f\u00f6retag tex hotel anv\u00e4nder en captive portal f\u00f6r att kontrollera vilka som anv\u00e4nder deras tr\u00e5dl\u00f6sa n\u00e4tverk.</p> <p>M\u00e5nga portaler filtrerar p\u00e5 MAC s\u00e5 om man hittar en som fungerar via en ipscan s\u00e5 r\u00e4cker det f\u00f6r att komma \u00e5t internet.</p>"},{"location":"linux_os/OS_X/","title":"OS X","text":"<p>OS X heter operativsystemet som k\u00f6rs p\u00e5 Apple Mac datorer. OS X bygger p\u00e5 UNIX i botten.</p>"},{"location":"linux_os/OS_X/#tipsntrix","title":"Tips'N'Trix","text":""},{"location":"linux_os/OS_X/#homebrew","title":"Homebrew","text":"<p>Homebrew \u00e4r en paket hanterare som liknar apt och som OS X inte har. Mer info finns p\u00e5 deras hemsida.</p>"},{"location":"linux_os/OS_X/#byt-mac-adress","title":"Byt MAC adress","text":"<p>F\u00f6r att s\u00e4tta en egen mac adress:</p> <p><code>sudo\u00a0ifconfig\u00a0en0\u00a0ether\u00a0aa:bb:cc:dd:ee:ff</code></p> <p>F\u00f6r att s\u00e4tta en random mac adress:</p> <p><code>openssl\u00a0rand\u00a0-hex\u00a06\u00a0|\u00a0sed\u00a0's/</code>..<code>/\\1:/g;\u00a0s/.$//'\u00a0|\u00a0xargs\u00a0sudo\u00a0ifconfig\u00a0en0\u00a0ether</code></p> <p>\u00c4ndringen \u00e4r inte permanent utan f\u00f6rsvinner vid omstart.</p> <p>Category:Distar</p>"},{"location":"linux_os/Security_Onion/","title":"Security Onion","text":"<p>Category:Distar Artikel under arbete</p> <p>\"Security Onion is a Linux distro for intrusion detection, network security monitoring, and log management. It's based on Ubuntu and contains Snort, Suricata, Bro, OSSEC, Sguil, Squert, Snorby, ELSA, Xplico, NetworkMiner, and many other security tools. The easy-to-use Setup wizard allows you to build an army of distributed sensors for your enterprise in minutes\"</p> <p>Det finns utm\u00e4rkt dokumentation p\u00e5 deras wiki-sida, https://github.com/Security-Onion-Solutions/security-onion/wiki Denna sida inneh\u00e5ller endast quick 'n dirty-guider.</p> <p>IDS Om man speglar trafik till Security Onion kan man s\u00e4tta upp det som en IDS.</p>"},{"location":"linux_os/Ubuntu/","title":"Ubuntu","text":"<p>Ubuntu \u00e4r en dist som bygger p\u00e5 Debian men har egna repos, \u00e4ven om en del paket synkas fr\u00e5n Debians repos.</p>"},{"location":"linux_os/Ubuntu/#first-5-minutes","title":"First 5 minutes","text":"<p>G\u00f6r f\u00f6ljande f\u00f6r att \u00f6ka s\u00e4kerheten. Switch user till root:</p> <p><code>sed\u00a0-i\u00a0-r\u00a0's/PermitRootLogin\u00a0yes/PermitRootLogin\u00a0no/g'\u00a0/etc/ssh/sshd_config</code> <code>systemctl\u00a0restart\u00a0ssh</code></p>"},{"location":"linux_os/Ubuntu/#hostname","title":"Hostname","text":"<p><code>echo\u00a0\"hostname\"\u00a0&gt;\u00a0/etc/hostname</code> <code>hostname\u00a0-F\u00a0/etc/hostname</code></p>"},{"location":"linux_os/Ubuntu/#tidszon","title":"Tidszon","text":"<p><code>dpkg-reconfigure\u00a0tzdata</code></p>"},{"location":"linux_os/Ubuntu/#andra-namn-pa-nic","title":"\u00c4ndra namn p\u00e5 NIC","text":"<p>\u00c4ndra i filen <code>/etc/udev/rules.d/70-persistent-net.rules</code></p> <p>Finns inte filen kan man skapa den. Man m\u00e5ste k\u00f6ra alla 3 kommandon f\u00f6r varje interface man vill l\u00e4gga till i <code>/etc/udev/rules.d/70-persistent-net.rules</code></p> <p><code>export\u00a0INTERFACE=eth0</code> <code>export\u00a0MATCHADDR=$(ip\u00a0addr\u00a0show\u00a0$INTERFACE\u00a0|\u00a0grep\u00a0ether\u00a0|\u00a0awk\u00a0'{print\u00a0$2}')</code> <code>/lib/udev/write_net_rules</code></p>"},{"location":"linux_os/Ubuntu/#pakethanterare","title":"Pakethanterare","text":"<p>B\u00e5de Debian och Ubuntu tillhandah\u00e5ller flera pakethanterare.</p>"},{"location":"linux_os/Ubuntu/#apt","title":"Apt","text":"<p>Se Apt</p>"},{"location":"linux_os/Ubuntu/#dpkg","title":"dpkg","text":"<p>Debian packaging tool Lista p\u00e5 installerade program</p> <p><code>dpkg\u00a0--get-selections</code> <code>dpkg\u00a0-l</code></p>"},{"location":"linux_os/Ubuntu/#tips-o-trix","title":"Tips o trix","text":"<p>Automatiska uppdateringar</p> <p><code>sudo\u00a0apt-get\u00a0-y\u00a0install\u00a0unattended-upgrades</code> <code>sudo\u00a0dpkg-reconfigure\u00a0-plow\u00a0unattended-upgrades</code></p> <p>Minimal Ubuntu Server Vill man reducera m\u00e4ngden CPU och RAM som beh\u00f6vs f\u00f6r ens vm kan man under installationen trycka f4 och v\u00e4lja att installera en minimal variant av Ubuntu Server.</p> <p>Mer funktionalitet \u00c4r man tr\u00f6tt p\u00e5 att det saknas funktioner p\u00e5 sin maskin kan man l\u00e4gga till alla paketen med f\u00f6ljande kommando:</p> <p><code>sudo\u00a0aptitude\u00a0install\u00a0'~T'</code></p>"},{"location":"linux_os/Ubuntu/#diverse","title":"Diverse","text":"<p>Network IDS - psad</p> <p><code>sudo\u00a0apt-get\u00a0install\u00a0-y\u00a0psad\u00a0&amp;&amp;\u00a0sudo\u00a0psad\u00a0--sig-update</code> <code>sudo\u00a0service\u00a0psad\u00a0restart\u00a0&amp;&amp;\u00a0sudo\u00a0service\u00a0psad\u00a0status</code></p> <p>Host IDS - Aide</p> <p><code>sudo\u00a0apt-get\u00a0install\u00a0-y\u00a0aide\u00a0&amp;&amp;\u00a0sudo\u00a0aideinit</code> <code>sudo\u00a0aide\u00a0-u</code></p> <p>Log Reporting</p> <p><code>sudo\u00a0apt-get\u00a0install\u00a0-y\u00a0logwatch</code> <code>sudo\u00a0echo\u00a0\"/usr/sbin/logwatch\u00a0--output\u00a0mail\u00a0--mailto\u00a0${email_address}\u00a0--detail\u00a0high\"\u00a0&gt;&gt;\u00a0/etc/cron.daily/00logwatch</code></p> <p>Category:Distar</p>"},{"location":"linux_services/Ansible/","title":"Ansible","text":"<p>Ansible \u00e4r ett automatiseringsverktyg som hj\u00e4lper till att managera din milj\u00f6. Ansible ansluter till flera hostar samtidigt och k\u00f6r sm\u00e5 program som heter \"moduler\" i den ordning som har specificerats i \"playbooks\".</p> <p>\u201cI wanted a tool that I could not use for 6 months, come back later, and still remember how it worked.\u201d - Michael DeHaan, creator.</p> <p>\u00c4r det r\u00e4tt verktyg f\u00f6r dig? http://www.infoworld.com/article/2609482/data-center/data-center-review-puppet-vs-chef-vs-ansible-vs-salt.html</p>"},{"location":"linux_services/Ansible/#installation","title":"Installation","text":"<p>Till skillnad mot t.ex. puppet finns det inga agenter/klienter utan man installerar endast p\u00e5 en maskin, dvs standalone.</p> <p><code>#Ubuntu</code> <code>sudo\u00a0apt-get\u00a0install\u00a0software-properties-common</code> <code>sudo\u00a0apt-add-repository\u00a0ppa:ansible/ansible</code> <code>sudo\u00a0apt-get\u00a0update\u00a0&amp;&amp;\u00a0sudo\u00a0apt-get\u00a0-y\u00a0install\u00a0ansible</code></p> <p><code>#CentOS/Fedora</code> <code>sudo\u00a0yum\u00a0install\u00a0ansible</code></p> <p><code>#Alternativt</code> <code>sudo\u00a0pip\u00a0install\u00a0ansible</code></p>"},{"location":"linux_services/Ansible/#grunder","title":"Grunder","text":"<p>Efter installation \u00e4r det dags att s\u00e4tta ihop sin inventory-fil. D\u00e4r listar och grupperar man alla hostar som man ska jobba med, se n\u00e4sta stycke. F\u00f6rslagsvis anv\u00e4nder man inte IP-adresser utan namn i DNS/hosts-fil f\u00f6r att hitta r\u00e4tt. Det beh\u00f6ver ocks\u00e5 fixas SSH-nycklar p\u00e5 alla hostar s\u00e5 att ansible kan autentisera sig p\u00e5 hostarna utan l\u00f6senord. Se Jumpgate f\u00f6r hur man genererar nycklar och skickar ut. Har man olika anv\u00e4ndarnamn p\u00e5 maskinerna man ska in p\u00e5 kan man specificera det i sin inventory-fil men f\u00f6r att h\u00e5lla den s\u00e5 ren som m\u00f6jligt kan det ocks\u00e5 g\u00f6ras i \\~/.ssh/config, se Jumpgate.</p>"},{"location":"linux_services/Ansible/#konfiguration","title":"Konfiguration","text":"<p>I ditt inventory l\u00e4ggs alla maskiner till och finns default i: /etc/ansible/hosts</p> <p><code>#[all]\u00a0g\u00e4ller\u00a0alla</code> <code>cacti</code> <code>ns02</code> <code>beeswarm:2222</code></p> <p><code>[dbservers]</code> <code>dbsrv1</code> <code>dbsrv2</code></p> <p><code>[webservers]</code> <code>websrv1</code> <code>websrv2</code></p>"},{"location":"linux_services/Ansible/#moduler","title":"Moduler","text":"<p>http://docs.ansible.com/modules_by_category.html</p> <p><code>ansible\u00a0-m\u00a0[modulnamn]\u00a0all</code> <code>ansible\u00a0-m\u00a0shell\u00a0-a\u00a0'free\u00a0-m'\u00a0host1:host3</code></p> <p>Testa s\u00e5 att det funkar. Ping-modulen loggar in p\u00e5 maskinerna och k\u00f6r ping 127.0.0.1, output blir success eller fail.</p> <p><code>ansible\u00a0all\u00a0-m\u00a0ping</code></p> <p>Default anv\u00e4nds SSH-nyckel f\u00f6r autentisering, f\u00f6r pw-fr\u00e5ga ist\u00e4llet l\u00e4gg till: -k</p>"},{"location":"linux_services/Ansible/#playbooks","title":"Playbooks","text":"<p>En playbook \u00e4r en upps\u00e4ttning instruktioner skrivna i yaml. Yaml \u00e4r l\u00e4ttl\u00e4st f\u00f6r oss m\u00e4nniskor.</p> <p><code>ansible-playbook\u00a0-i\u00a0inventory_file\u00a0dinplaybook.yml</code></p> <p>Exempel p\u00e5 playbook:</p> <pre><code>---\n- hosts: all\n  sudo: true\n  tasks:\n  - name: install apache2\n    apt:\n      pkg: apache\n      state: present\n      update_cache: true\n  - name: start service\n    service:\n      name: apache2\n      state: started\n</code></pre> <p>Om man har angett hosts i playbooken beh\u00f6vs de inte anges n\u00e4r man k\u00f6r kommandot. Annars kan man specificera enskilda hosts.</p> <p><code>ansible-playbook\u00a0-l\u00a0host5\u00a0apache.yml</code></p> <p>Kolla vilka hostar som eventuellt skulle ber\u00f6ras</p> <p><code>ansible-playbook\u00a0playbook.yml\u00a0--list-hosts</code></p> <p>Sudo</p> <p><code>ansible-playbook\u00a0apache.yml\u00a0-K\u00a0\u00a0#--ask-sudo-pass</code></p>"},{"location":"linux_services/Ansible/#ladda-upp-filer","title":"Ladda upp filer","text":"<p>Man kan ladda upp lokala filer i tasken.</p> <p><code>-\u00a0name:\u00a0Upload\u00a0default\u00a0index.html\u00a0for\u00a0host</code> <code>copy:\u00a0src=localfiles/index.html\u00a0dest=/var/www/html/\u00a0mode=0644</code></p>"},{"location":"linux_services/Ansible/#ladda-ner-filer","title":"Ladda ner filer","text":"<p><code>-\u00a0name:\u00a0Download\u00a0file\u00a0from\u00a0website</code> <code>get_url:\u00a0url=</code><code>http://hackernet.se/file.htm</code><code>dest=/var/www/html/index.html</code></p>"},{"location":"linux_services/Ansible/#roller","title":"Roller","text":"<p>Med roller kan man kalla p\u00e5 variabler, tasks och handlers som \u00e4r f\u00f6rdefinierade. Det kr\u00e4ver att man har en filstruktur f\u00f6r det.</p> <p><code>mkdir\u00a0-p\u00a0/etc/ansible/roles/</code></p>"},{"location":"linux_services/Ansible/#yaml","title":"YAML","text":"<p>Yaml anv\u00e4nder mellanslag som delimiter, anv\u00e4nd ej tab.</p> <pre><code>---\n- hosts: [target hosts]\n  remote_user: [yourname]\n  tasks:\n    - [task 1]\n    - [task 2]\n</code></pre> <p>handlers: Handler \u00e4r samma sak som task fast k\u00f6rs bara om de blivit kallade p\u00e5 av en notify. Notify l\u00e4ggs i en task.</p> <pre><code>tasks:\n  - [task 1]\n    notify:\n      - restart apache\n\nhandlers:\n  - name: restart apache\n    service: name=apache state=restarted\n</code></pre> <p>vars_prompt</p> <pre><code>vars_prompt:\n\n- name: \"Password\"\n  prompt: \"Enter password\"\n  private: yes\n\n...\n  password: \"{{Password}}\"\n...\n</code></pre>"},{"location":"linux_services/Ansible/#templates","title":"Templates","text":"<p>Bygg och testa jinja-templates: https://ansible.sivel.net/test/</p>"},{"location":"linux_services/Ansible/#vault","title":"Vault","text":"<p>Med vault kan man skydda sina l\u00f6senord och nycklar med assymetrisk AES-kryptering.</p> <p><code>ansible-vault\u00a0create\u00a0vault.yml</code> <code>ansible-vault\u00a0edit\u00a0vault.yml</code> <code>ansible-playbook\u00a0vault.yml\u00a0--ask-vault-pass</code></p> <p>Category:Guider</p>"},{"location":"linux_services/Apache/","title":"Apache","text":"<p>Apache \u00e4r en av v\u00e4rldens mest anv\u00e4nda webbservrar. Och hostar idag ca 35-40% av alla hemsidor i v\u00e4rlden. Apache \u00e4r en v\u00e4ldigt enkel webbserver att konfigurera och har \u00e4ven flera anv\u00e4ndbara till\u00e4gg.</p>"},{"location":"linux_services/Apache/#installation","title":"Installation","text":"<p><code>sudo\u00a0apt-get\u00a0install\u00a0apache2</code></p>"},{"location":"linux_services/Apache/#apache-kommandon","title":"Apache kommandon","text":"<p><code>a2ensite</code> F\u00f6r att aktivera en sida. Tillg\u00e4ngliga sidor finns i mappen <code>/etc/apache2/sites-available</code></p> <p><code>a2dissite</code> F\u00f6r att inaktivera av en sida. Aktiverade sidor finns i mappen <code>/etc/apache2/sites-enabled</code></p> <p><code>a2dismod</code> F\u00f6r att st\u00e4nga av ett till\u00e4gg. Aktiverade till\u00e4gg finns i mappen <code>/etc/apache2/mods-enabled</code></p> <p><code>a2enmod</code> F\u00f6r att aktivera ett till\u00e4gg. Tillg\u00e4ngliga till\u00e4gg finns i mappen <code>/etc/apache2/mods-available</code></p>"},{"location":"linux_services/Apache/#konfiguration","title":"Konfiguration","text":"<p>vHosts \u00e4r bra att anv\u00e4nda om man bara har en IP ut\u00e5t och vill dela port 80/443 med flera hemsidor men ha olika dom\u00e4nnamn. F\u00f6r att f\u00e5 virtualhost att fungera s\u00e5 r\u00e4cker det att man l\u00e4gger till denna raden i apache configen.</p> <p><code>ServerName\u00a0hackernet.se</code></p> <p>Kopiera default filen under sites-available.</p> <p><code>cp\u00a0/etc/apache2/sites-available/default\u00a0/etc/apache2/sites-available/hackernet</code></p> <p>\u00d6ppna den nya filen och l\u00e4gg till raden precis under <code>ServerAdmin</code> och \u00f6ver <code>DocumentRoot</code></p> <p>\u00c4ndra \u00e4ven <code>DocumentRoot</code> och <code>Directory</code> ifall du vill att en annan hemsida ska visas ist\u00e4llet f\u00f6r orginal.</p> <p>Aktivera sedan sidan med</p> <p><code>a2ensite\u00a0hackernet</code></p>"},{"location":"linux_services/Apache/#apachectl","title":"Apachectl","text":"<p>Kolla grundl\u00e4ggande konfiguration:</p> <p><code>apachectl\u00a0-S</code></p> <p>K\u00f6r ett configtest:</p> <p><code>apachectl\u00a0-t</code></p>"},{"location":"linux_services/Apache/#permissions","title":"Permissions","text":"<p>F\u00f6ljande \u00e4r en bra grund f\u00f6r filr\u00e4ttigheter.</p> <p><code>chown\u00a0root:www-data\u00a0/var/www/html\u00a0-R</code> <code>chmod\u00a0g+s\u00a0/var/www/html</code> <code>chmod\u00a0o-wrx\u00a0/var/www/html\u00a0-R</code></p> <p>www-data, apache2\u2032s user, har nu grupp-\u00e4garskapet f\u00f6r default web root och alla filer d\u00e4ri. g+s s\u00e4ger \u00e5t filsystemet att alla nya filer som skapas f\u00e5r samma grupp-\u00e4garskap.</p>"},{"location":"linux_services/Apache/#log-files","title":"Log files","text":"<p><code>tail\u00a0-f\u00a0/var/log/apache2/access.log</code></p>"},{"location":"linux_services/Apache/#ssl","title":"SSL","text":"<p>Enable module</p> <p><code>sudo\u00a0a2enmod\u00a0ssl\u00a0&amp;&amp;\u00a0sudo\u00a0a2enmod\u00a0headers\u00a0&amp;&amp;\u00a0sudo\u00a0service\u00a0apache2\u00a0restart</code></p> <p>Certifikat Fixa ett certifikat, antingen fr\u00e5n en CA (t.ex. Let's Encrypt) eller self-signed.</p> <p>Konfiguration med s\u00e4kerhet i fokus.</p> <p><code>https://cipherli.st/</code></p> <p>Aktivera vHost</p> <p><code>sudo\u00a0a2ensite\u00a0hackernet\u00a0&amp;&amp;\u00a0sudo\u00a0service\u00a0apache2\u00a0restart</code></p>"},{"location":"linux_services/Apache/#dolj-version","title":"D\u00f6lj Version","text":"<p>Skriv f\u00f6ljande i <code>Apache.conf/httpd.conf</code></p> <p><code>ServerTokens\u00a0ProductOnly</code> <code>ServerSignature\u00a0Off</code></p>"},{"location":"linux_services/Apache/#apachebench","title":"ApacheBench","text":"<p>Benchmarking tool</p> <p><code>sudo`` ``apt-get`` ``install`` ``apache2-utils</code> <code>ab\u00a0-n\u00a0500\u00a0-c\u00a0100</code><code>http://example.com/</code></p>"},{"location":"linux_services/Apache/#known-errors","title":"Known errors","text":""},{"location":"linux_services/Apache/#warn-default-virtualhost-overlap-on-port-443-the-first-has-precedence","title":"[warn] default VirtualHost overlap on port 443, the first has precedence","text":"<p>Kan man f\u00e5 n\u00e4r man f\u00f6rs\u00f6ker skapa flera vhost p\u00e5 port 443. Man m\u00e4rker ocks\u00e5 problemet att alla olika vhostar p\u00e5 port 443 pekar p\u00e5 samma sida.</p> <p>F\u00f6r att fixa l\u00e4gg till <code>NameVirtualHost *:443</code> i din <code>ports.conf</code> eller <code>httpd.conf</code> fil.</p> <pre><code> &lt;IfModule mod_ssl.c&gt;\n     # If you add NameVirtualHost *:443 here, you will also have to change\n     # the VirtualHost statement in /etc/apache2/sites-available/default-ssl\n     # to &lt;VirtualHost *:443&gt;\n     # Server Name Indication for SSL named virtual hosts is currently not\n     # supported by MSIE on Windows XP.\n     NameVirtualHost *:443\n     Listen 443\n &lt;/IfModule&gt;\n</code></pre> <p>Category:Guider</p>"},{"location":"linux_services/AutoFS/","title":"AutoFS","text":"<p>autofs \u00e4r ett program f\u00f6r att automatiskt mounta kataloger efter behov n\u00e4r det beh\u00f6vs. Auto-mounts \u00e4r endast mountade n\u00e4r de anv\u00e4nds, och umountas efter en period av inaktivitet. Mount av en remote share genom fstab f\u00f6rblir mountad s\u00e5vida du inte umountar den. Automounting NFS/Samba-shares sparar bandbredd och ger b\u00e4ttre prestanda j\u00e4mf\u00f6rt med statiska mounts genom fstab. fstab kan dessutom orsaka problem om sharen blir otillg\u00e4nglig, vilket resulterar i inaktuella mounts. Till exempel kan filservern du ansluter till krascha eller n\u00e4tverket kan g\u00e5 ner.</p>"},{"location":"linux_services/AutoFS/#installation","title":"Installation","text":"<p><code>sudo\u00a0apt-get\u00a0install\u00a0autofs</code> <code>sudo\u00a0yum\u00a0install\u00a0autofs</code></p>"},{"location":"linux_services/AutoFS/#konfiguration","title":"Konfiguration","text":"<p>Skapa en mount point eller v\u00e4lj en befintlig katalog, t.ex. /mnt eller /media. Du kommer att beh\u00f6va definiera mount points f\u00f6r att ange hur du ansluter till din n\u00e4tverksresurs.</p> <p><code>sudo\u00a0mkdir\u00a0/nfs-share</code> <code>sudo\u00a0mkdir\u00a0/smb-share</code></p> <p>Redigera konfigurationsfilen f\u00f6r autofs:</p> <p><code>sudo\u00a0nano\u00a0/etc/auto.master</code> <code>/nfs-share\u00a0\u00a0\u00a0/etc/auto.nfs-share</code> <code>/smb-share\u00a0\u00a0\u00a0/etc/auto.smb-share</code></p> <p>Skapa en ny fil i /etc/.</p> <p>SMB</p> <p><code>sudo\u00a0nano\u00a0/etc/auto.smb-share</code> <code>filserver\u00a0-fstype=smbfs,rw,username=buenos,password=nachos,file_mode=0777,dir_mode=0777\u00a0://192.168.0.50/share</code></p> <p>D\u00e4r \"filserver\" anger den mapp som ska skapas under /share som host f\u00f6r dina shares</p> <p>NFS</p> <p><code>sudo\u00a0nano\u00a0/etc/auto.nfs-share</code> <code>filserver\u00a0-fstype=nfs,rw,soft,tcp,nolock\u00a0192.168.0.50:/mnt/ProdPool</code></p> <p>Klienten beh\u00f6ver samma \u00e4ndringar i /etc/default/nfs-common f\u00f6r att ansluta till en NFSv4-server.</p> <p><code>NEED_IDMAPD\u00a0=\u00a0yes</code> <code>NEED_GSSD\u00a0=\u00a0no\u00a0#\u00a0no\u00a0\u00e4r\u00a0default</code></p> <p>CIFS F\u00e5r man inte s\u00e4ga, http://blog.fosketts.net/2012/02/16/cifs-smb/</p>"},{"location":"linux_services/AutoFS/#home-folder","title":"Home Folder","text":"<p>F\u00f6r att mounta hem-mapparna med autofs enkelt och slippa att skapa en rad f\u00f6r varje anv\u00e4ndare i autofs filerna eller att man mountar alla hem mappar som finns p\u00e5 sharen kan man anv\u00e4nda sig av wildcard.</p> <p><code>echo\u00a0*\u00a0-fstype=nfs,user,auto,rw,async,hard,intr\u00a0192.168.1.200:/mnt/zfs/Home/&amp;\u00a0&gt;\u00a0/etc/auto.home</code> <code>echo\u00a0/home\u00a0/etc/auto.home\u00a0&gt;&gt;\u00a0/etc/auto.master</code></p> <p>D\u00e4r \"*\" och \"&amp;\" \u00e4r wildcard.</p>"},{"location":"linux_services/AutoFS/#felsokning","title":"Fels\u00f6kning","text":"<p>Reboota och f\u00f6rs\u00f6k komma \u00e5t din share.</p> <p><code>ls\u00a0/nfs-share</code> <code>cd\u00a0/smb-share</code></p> <p>Om det inte fungerar, m\u00e5ste du fels\u00f6ka. Stoppa autofs demonen</p> <p><code>sudo\u00a0service\u00a0autofs\u00a0stop</code></p> <p>K\u00f6r automount i f\u00f6rgrunden med verbose</p> <p><code>sudo\u00a0automount\u00a0-f\u00a0-v</code></p> <p>Category:Guider</p>"},{"location":"linux_services/BIND/","title":"BIND","text":"<p>BIND \u00e4r ett open source, flexibelt och fullt utrustat DNS-system.</p> <p>Mjukvaran best\u00e5r av tre delar:</p> <ul> <li>Domain Name Resolver</li> <li>Domain Name Authority server</li> <li>Tools</li> </ul>"},{"location":"linux_services/BIND/#installation","title":"Installation","text":"<p><code>apt-get\u00a0install\u00a0bind9\u00a0bind9utils\u00a0bind9-doc\u00a0dnsutils</code></p>"},{"location":"linux_services/BIND/#konfiguration","title":"Konfiguration","text":""},{"location":"linux_services/BIND/#domain-name-resolver","title":"Domain Name Resolver","text":""},{"location":"linux_services/BIND/#domain-name-authority-server","title":"Domain Name Authority server","text":""},{"location":"linux_services/BIND/#zone-transfers","title":"Zone transfers","text":"<p>Har man flera servrar kan det vara smidigt att vid \u00e4ndring i en zone att den syncas \u00f6ver till de andra bind servarna.</p> <p>Skapa en ACL p\u00e5 master servern i <code>named.conf.local</code>.</p> <p><code>acl\u00a0slave\u00a0{</code> <code>172.22.0.0/24;</code> <code>172.22.0.10;</code> <code>};</code></p> <p>I zonen l\u00e4gg till f\u00f6ljande:</p> <p><code>zone\u00a0\"hackernet.se\"\u00a0{</code> <code>....</code> <code>type\u00a0master;</code> <code>allow-transfer\u00a0{\u00a0slave;\u00a0};</code> <code>};</code></p> <p>P\u00e5 din slav server l\u00e4gg till f\u00f6ljande i zonen:</p> <p><code>zone\u00a0\"hackernet.se\u00a0{</code> <code>....</code> <code>type\u00a0slave;</code> <code>masters\u00a0{\u00a0192.168.1.10;\u00a0};</code> <code>}</code></p> <p>Starta sedan om tj\u00e4nsten p\u00e5 b\u00e5da servarna.</p>"},{"location":"linux_services/BIND/#tsig","title":"TSIG","text":"<p>Transaction Signature (TSIG) kan anv\u00e4ndas f\u00f6r att s\u00e4kra upp zone transfern.</p> <p>Starta med att generera nykeln som ska anv\u00e4ndas p\u00e5 master DNS'n.</p> <p><code>dnssec-keygen\u00a0-a\u00a0HMAC-SHA512\u00a0-b\u00a0512\u00a0-n\u00a0HOST\u00a0-r\u00a0/dev/urandom\u00a0tsigkey</code></p> <p>Tv\u00e5 filer kommer att skapas. I private filen finns nykeln efter Key:. Kopiera nykeln och skapa filen:</p> <p><code>vim\u00a0/etc/bind/named.conf.tsigkeys</code></p> <p>Med f\u00f6ljande info:</p> <p><code>key\u00a0\"my-tsig\"\u00a0{</code> <code>algorithm\u00a0HMAC-SHA512;</code> <code>secret\u00a0\"</code><code>\";</code> <code>};</code> <p>S\u00e4g till bind att l\u00e4sa in filen. L\u00e4gg till f\u00f6ljande i slutet p\u00e5 named.conf:</p> <p><code>include\u00a0\"/etc/bind/named.conf.tsigkeys\";</code></p> <p>F\u00f6r att s\u00e4kra upp en zone skriv f\u00f6ljande.</p> <p><code>zone\u00a0\"hackernet.se\"\u00a0{</code> <code>....</code> <code>allow-transfer\u00a0{\u00a0key\u00a0\"my-tsig\";\u00a0};</code> <code>};</code></p> <p>Starta sedan om tj\u00e4nsten.</p> <p>P\u00e5 DNS slaven skapa samma tsigkeys fil:</p> <p><code>vim\u00a0/etc/bind/named.conf.tsigkeys</code></p> <p>Och kopiera in samma inneh\u00e5ll fr\u00e5n master servern, men l\u00e4gg till f\u00f6ljande i slutet. F\u00f6r att s\u00e4ga till vilken nykel den ska anv\u00e4nda:</p> <p><code>.....</code> <code>server\u00a0192.168.2.254\u00a0{</code> <code>keys\u00a0{\u00a0my-tsig;\u00a0};</code> <code>};</code></p> <p>L\u00e4gg till f\u00f6ljande rad i /etc/bind/named.conf</p> <p><code>include\u00a0\"/etc/bind/named.conf.tsigkeys\";</code></p> <p>Och starta om tj\u00e4nsten. Zone transfer ska nu funka, f\u00f6r att prova k\u00f6ra f\u00f6ljande p\u00e5 slaven.</p> <p><code>dig\u00a0@{master-dns-ip}\u00a0hackernet.se\u00a0axfr</code></p> <p>Om du fick f\u00f6ljande error:</p> <p><code>;\u00a0&lt;&lt;&gt;&gt;\u00a0DiG\u00a09.8.4-rpz2+rl005.12-P1\u00a0&lt;&lt;&gt;&gt;\u00a0@ns1\u00a0hackernet.se\u00a0axfr</code> <code>;\u00a0(1\u00a0server\u00a0found)</code> <code>;;\u00a0global\u00a0options:\u00a0+cmd</code> <code>;\u00a0Transfer\u00a0failed.</code></p> <p>S\u00e5 visar det att en zone transfer gick inte att k\u00f6ra utan en tsig nykel.</p> <p>F\u00f6r att anv\u00e4nda tsig nykeln k\u00f6r f\u00f6ljande kommando:</p> <p><code>dig\u00a0@{master-dns-ip}\u00a0hackernet.se\u00a0axfr\u00a0-k\u00a0/etc/bind/named.conf.tsigkeys</code></p>"},{"location":"linux_services/BIND/#srv-record","title":"SRV record","text":"<p>Med hj\u00e4lp av service record(SRV) s\u00e5 kan man peka ut p\u00e5 vilken port och bakom vilket hostnamn en tj\u00e4nst k\u00f6rs tex LDAP, SIP, Lync.</p> <p>Ett SRV record ser ut p\u00e5 f\u00f6ljande s\u00e4tt.</p> <p><code>_service._proto.name.\u00a0TTL\u00a0class\u00a0SRV\u00a0priority\u00a0weight\u00a0port\u00a0target.</code></p> <ul> <li>service: namnet p\u00e5 tj\u00e4nsten.</li> <li>proto: vilket transport protokoll som ska anv\u00e4ndas, vanligast \u00e4r TCP     eller UDP.</li> <li>name: vilket dom\u00e4n namn recordet \u00e4r till f\u00f6r.</li> <li>TTL: time to live.</li> <li>class: standard DNS klass. Denna \u00e4r alltid IN.</li> <li>priority: hosten med l\u00e4gst prioritet anv\u00e4nds i f\u00f6rsta hand.</li> <li>weight: anv\u00e4nds vid lastbalansering. Om 2 hostar har samma priority     s\u00e5 har den host med h\u00f6gre weight st\u00f6rre chans att bli vald.</li> <li>port: port p\u00e5 tj\u00e4nsten.</li> <li>target: hostnamnet p\u00e5 servern.</li> </ul>"},{"location":"linux_services/BIND/#ldap-autodiscovery","title":"LDAP autodiscovery","text":"<p>Skriv f\u00f6ljande i din zonefil.</p> <p><code>_ldap._tcp.hackernet.se.\u00a0\u00a0\u00a0IN\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0SRV\u00a0\u00a0\u00a0\u00a0\u00a010\u00a00\u00a0389\u00a0ldap1.hackernet.se.</code> <code>_ldap._tcp.hackernet.se.\u00a0\u00a0\u00a0IN\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0SRV\u00a0\u00a0\u00a0\u00a0\u00a020\u00a00\u00a0389\u00a0ldap2.hackernet.se.</code></p>"},{"location":"linux_services/BIND/#dynamic-dns","title":"Dynamic DNS","text":""},{"location":"linux_services/BIND/#isc-dhcp","title":"ISC DHCP","text":"<p>S\u00e4tt upp DDNS s\u00e5 att lokala klienter som f\u00e5r IP fr\u00e5n en dhcp server uppdaterar din lokala forward och reverse zone.</p>"},{"location":"linux_services/BIND/#generera-en-nykel","title":"Generera en nykel","text":"<p><code>dnssec-keygen\u00a0-a\u00a0HMAC-MD5\u00a0-b\u00a0128\u00a0-r\u00a0/dev/urandom\u00a0-n\u00a0USER\u00a0DDNS_UPDATE</code></p> <p>\u00d6ppna filen *.private och kopiera allt efter Key:</p> <p>Skapa en ny fil som heter ddns.key som ser ut som f\u00f6ljande och kopiera in texten fr\u00e5n *.private filen:</p> <p><code>key\u00a0DDNS_UPDATE\u00a0{</code> <code>algorithm\u00a0HMAC-MD5.SIG-ALG.REG.INT;</code> <code>secret\u00a0\"</code><code>\";</code> <code>};</code> <p>Kopiera sedan ddns.key filen till bind mappen och dhcp serverns mapp.</p> <p><code>install\u00a0-o\u00a0root\u00a0-g\u00a0bind\u00a0-m\u00a00640\u00a0ddns.key\u00a0/etc/bind/ddns.key</code> <code>install\u00a0-o\u00a0root\u00a0-g\u00a0root\u00a0-m\u00a00640\u00a0ddns.key\u00a0/etc/dhcp/ddns.key</code></p>"},{"location":"linux_services/BIND/#bind-konfiguration","title":"Bind konfiguration","text":"<p>L\u00e4gg in f\u00f6ljande rad i din named.conf.local fil:</p> <p><code>include\u00a0\"/etc/bind/ddns.key\";</code></p> <p>L\u00e4gg till denna raden allow-update { key DDNS_UPDATE; }; i varje zone som ska uppdateras.</p> <p><code>zone\u00a0\"example.org\"\u00a0{</code> <code>type\u00a0master;</code> <code>notify\u00a0no;</code> <code>file\u00a0\"/var/cache/bind/db.example.org\";</code> <code>allow-update\u00a0{\u00a0key\u00a0DDNS_UPDATE;\u00a0};</code> <code>};</code> <code>zone\u00a0\"1.168.192.in-addr.arpa\"\u00a0{</code> <code>type\u00a0master;</code> <code>notify\u00a0no;</code> <code>file\u00a0\"/var/cache/bind/db.192.168.2\";</code> <code>allow-update\u00a0{\u00a0key\u00a0DDNS_UPDATE;\u00a0};</code> <code>};</code></p>"},{"location":"linux_services/BIND/#dhcp-konfiguration","title":"DHCP konfiguration","text":"<p>F\u00f6ljande globala inst\u00e4llningar beh\u00f6vs i din dhcpd.conf' fil:</p> <p><code>option\u00a0domain-name\u00a0\"example.org\";</code></p> <p><code>ddns-updates\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0on;</code> <code>ddns-update-style\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0interim;</code> <code>ignore\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0client-updates;</code> <code>update-static-leases\u00a0\u00a0\u00a0on;</code></p> <p>option domain-name: Specificerar vilket dom\u00e4n namn som delas ut, anv\u00e4nds ocks\u00e5 av DDNS. ddns-update-style: B\u00f6r alltid vara interim. Adhoc finns som val ocks\u00e5 men \u00e4r utdaterat. client-updates: Om du anv\u00e4nder allow client-updates s\u00e5 l\u00e5ter du klienter registrera sitt dom\u00e4n namn p\u00e5 DNS servern sj\u00e4lv. Default \u00e4r ignore client-updates. update-static-leases: Default s\u00e5 uppdaterar inte DHCP-servern DNS rader som \u00e4r statiska leases.</p> <p>L\u00e4gg ocks\u00e5 till f\u00f6ljande rader i din dhcpd.conf fil:</p> <p><code>include\u00a0\"/etc/dhcp/ddns.key\";</code></p> <p><code>zone\u00a0example.org.\u00a0{</code> <code>primary\u00a0127.0.0.1;</code> <code>key\u00a0DDNS_UPDATE;</code> <code>}</code></p> <p><code>zone\u00a01.168.192.in-addr.arpa.\u00a0{</code> <code>primary\u00a0127.0.0.1;</code> <code>key\u00a0DDNS_UPDATE;</code> <code>}</code></p> <p>Se till att bind har skrivr\u00e4ttigheter i mappen d\u00e4r zone filen finns sparad annars kan den inte uppdatera.</p> <p>Starta sedan om tj\u00e4nsterna.</p> <p><code>/etc/init.d/isc-dhcp-server\u00a0restart</code> <code>/etc/init.d/bind9\u00a0restart</code></p>"},{"location":"linux_services/BIND/#tips-n-trix","title":"Tips n Trix","text":""},{"location":"linux_services/BIND/#chroot","title":"Chroot","text":"<p>F\u00f6r att \u00f6ka s\u00e4kerheten b\u00f6r man l\u00e4gga tj\u00e4nsten i en chroot-milj\u00f6.</p> <p><code>yum\u00a0install\u00a0bind-chroot\u00a0-y</code> <code>service\u00a0named\u00a0restart</code></p>"},{"location":"linux_services/BIND/#serial-number-reset","title":"Serial number reset","text":"<p>Har man r\u00e5kat s\u00e4tta f\u00f6r h\u00f6gt serienummer i en zon kan man resetta det med f\u00f6ljande metod. S\u00e4tt serienumret till:</p> <p><code>4294967295</code></p> <p>L\u00e5t det propagera till slavarna och sedan kan man s\u00e4tta vad man vill.</p>"},{"location":"linux_services/BIND/#statistics","title":"Statistics","text":"<p>Vill du se lite statistik p\u00e5 din DNS-server kan konfa f\u00f6ljande och sedan surfa in p\u00e5 http://:8080 <p><code>acl\u00a0\"trusted\"\u00a0{</code> <code>192.168.1.0/24;</code> <code>};</code> <code>statistics-channels\u00a0{</code> <code>inet\u00a0*\u00a0\u00a0port\u00a08080\u00a0allow\u00a0{\u00a0trusted;\u00a0};</code> <code>};</code></p>"},{"location":"linux_services/BIND/#response-rate-limiting","title":"Response Rate Limiting","text":""},{"location":"linux_services/BIND/#tools","title":"Tools","text":"<p>K\u00f6r igenom toolsen f\u00f6r att f\u00e5 en k\u00e4nsla f\u00f6r dem. Short output</p> <p><code>dnsget\u00a0hackernet.se</code> <code>dig\u00a0hackernet.se\u00a0+short</code></p> <p>Kolla SOA p\u00e5 alla namnservrar</p> <p><code>dig\u00a0hackernet.se\u00a0+nssearch</code></p> <p>Kolla om records finns mot wordlist</p> <p><code>dnsmap\u00a0hackernet.se</code></p> <p>Kolla version p\u00e5 DNS-server</p> <p><code>ldns-chaos\u00a0hackernet.se</code></p> <p>Monitor queries</p> <p><code>sudo\u00a0dnstop\u00a0eth0</code></p> <p>Capture queries</p> <p><code>sudo\u00a0dnscap\u00a0-g</code></p> <p>Visualisera</p> <p><code>sudo\u00a0tcpdump\u00a0-i\u00a0eth0\u00a0-w\u00a0dnsdump.pcap\u00a0port\u00a053</code> <code>dnspktflow\u00a0dnsdump.pcap</code> <code>eog\u00a0out.png</code></p>"},{"location":"linux_services/BIND/#rndc","title":"rndc","text":"<p>\u00c4r ett program f\u00f6r att uppdatera dnservern med nya zoner eller uppdatera befintliga zoner. F\u00f6rdelen med att anv\u00e4nda rndc \u00e4r att man beh\u00f6ver inte ladda om alla zoner om man bara g\u00f6r \u00e4ndringar i en zone. Har man m\u00e5nga stora zoner kan DNS sluta svara under n\u00e5gra sekunder.</p> <p><code>rndc\u00a0reconfig\u00a0-\u00a0Anv\u00e4nds\u00a0om\u00a0du\u00a0gjort\u00a0n\u00e5gon\u00a0\u00e4ndring\u00a0i\u00a0.conf\u00a0filerna\u00a0eller\u00a0f\u00f6r\u00a0att\u00a0l\u00e4sa\u00a0in\u00a0nya\u00a0zoner.\u00a0Den\u00a0kommer\u00a0inte\u00a0bry\u00a0sig\u00a0om\u00a0du\u00a0gjort\u00a0n\u00e5gon\u00a0\u00e4ndring\u00a0i\u00a0n\u00e5n\u00a0zone\u00a0fil.</code> <code>rndc\u00a0reload\u00a0-\u00a0F\u00f6r\u00a0att\u00a0ladda\u00a0om\u00a0alla\u00a0zone\u00a0filer.</code> <code>rndc\u00a0reload</code><code>-\u00a0F\u00f6r\u00a0att\u00a0enbart\u00a0ladda\u00a0om\u00a0den\u00a0zonen\u00a0du\u00a0gjort\u00a0en\u00a0\u00e4ndring\u00a0p\u00e5.</code>"},{"location":"linux_services/BIND/#dnstracer","title":"dnstracer","text":"<p>Dnstracer f\u00f6ljer alla dns servrar tills man hittar den servern man letar efter.</p> <p><code>dnstracer\u00a0-o4s\u00a0.\u00a0hackernet.se</code></p>"},{"location":"linux_services/BIND/#felsok","title":"Fels\u00f6k","text":"<p>Se hur l\u00e5ngt i resolve-processen det funkar</p> <p><code>dig\u00a0hackernet.se\u00a0+trace</code></p> <p>Kolla efter syntax-errors alla inladdade zoner</p> <p><code>named-checkconf\u00a0-z</code></p>"},{"location":"linux_services/BIND/#dnssec","title":"DNSSEC","text":""},{"location":"linux_services/BIND/#known-errors","title":"Known errors","text":""},{"location":"linux_services/BIND/#journal-out-of-sync-error","title":"Journal out of sync error","text":"<p>Om man har en dynamisk zone som uppdateras fr\u00e5n tex en DHCP och denna zonen skulle uppdateras manuellt s\u00e5 kommer den inte l\u00e4ngre laddas korrekt och ger f\u00f6ljande meddelande.</p> <p><code>zone\u00a0hackernet.se/IN:\u00a0journal\u00a0rollforward\u00a0failed:\u00a0journal\u00a0out\u00a0of\u00a0sync\u00a0with\u00a0zone</code> <code>zone\u00a0hackernet.se/IN:\u00a0not\u00a0loaded\u00a0due\u00a0to\u00a0errors.</code></p> <p>L\u00f6sningen \u00e4r att ta bort .jnl filen som tillh\u00f6r zonen. Efter det \u00e4r det bara att starta om BIND.</p> <p>Om du skulle beh\u00f6va uppdatera en zone manuellt b\u00f6rja med att frysa zonen.</p> <p><code>rndc\u00a0freeze\u00a0hackernet.se</code> <code>(\u00e4ndra`` ``i`` ``zonefilen)</code> <code>rndc\u00a0reload\u00a0hackernet.se</code> <code>rndc\u00a0thaw\u00a0hackernet.se</code></p> <p>Category:Guider</p>"},{"location":"linux_services/Bcache/","title":"Bcache","text":"<p>Bcache \u00e4r en Linux kernel block layer cache.</p>"},{"location":"linux_services/Bcache/#installation","title":"Installation","text":"<p><code>sudo\u00a0add-apt-repository\u00a0ppa:g2p/storage</code> <code>sudo\u00a0apt-get\u00a0update\u00a0&amp;&amp;\u00a0sudo\u00a0apt-get\u00a0-y\u00a0install\u00a0bcache-tools</code></p>"},{"location":"linux_services/Bcache/#konfiguration","title":"Konfiguration","text":"<p>F\u00f6rst skapar man caching devices, SSDer.</p> <p><code>sudo\u00a0make-bcache\u00a0-C\u00a0/dev/sdc1</code></p> <p>Sedan skapar man backing devices, HDDer.</p> <p><code>sudo\u00a0make-bcache\u00a0-B\u00a0/dev/sdb1</code></p> <p>Registrera samtliga devices. (Endast om inte udev anv\u00e4nds p\u00e5 systemet)</p> <p><code>sudo\u00a0echo\u00a0/dev/sdX1\u00a0&gt;\u00a0/sys/fs/bcache/register</code></p> <p>Skapa filsystem och mounta.</p> <p>Attach</p> <p><code>ls\u00a0/sys/fs/bcache</code> <code>echo\u00a0bcache-UUID\u00a0&gt;\u00a0/sys/block/bcache0/bcache/attach</code></p>"},{"location":"linux_services/Bcache/#writeback","title":"Writeback","text":"<p>Default \u00e4r det read cache (writethrough), f\u00f6r att sl\u00e5 p\u00e5 write cache.</p> <p><code>echo\u00a0writeback\u00a0&gt;\u00a0/sys/block/bcache0/bcache/cache_mode</code></p> <p>Category:Guider</p>"},{"location":"linux_services/Beeswarm/","title":"Beeswarm","text":"<p>Beeswarm \u00e4r ett IDS-projekt som ger enkel konfiguration, drifts\u00e4ttning och hantering av honeypots. Med honeypots kan man uppt\u00e4cka om man har Hackers i sitt n\u00e4tverk. Projektets hemsida: http://www.beeswarm-ids.org/</p> <p>Image:Beeswarm_overview.png</p> <ul> <li>Server: Managerar och tar in rapporter fr\u00e5n honeypots och     klienter.</li> <li>Honeypot: Lyssnar p\u00e5 olika tj\u00e4nster t.ex. SSH, SMTP, FTP, HTTP</li> <li>Klient: F\u00f6rs\u00f6ker logga in p\u00e5 honeypotsen med fake-credentials,     om n\u00e5gon annan f\u00f6rs\u00f6ker logga in med samma credentials vet man att     trafik har avlyssnats.</li> </ul>"},{"location":"linux_services/Beeswarm/#installation","title":"Installation","text":"<p>Ubuntu</p> <p><code>sudo\u00a0apt-get\u00a0install\u00a0libffi-dev\u00a0build-essential\u00a0python-dev\u00a0python-pip\u00a0libssl-dev\u00a0libxml2-dev\u00a0libxslt1-dev\u00a0ntp</code> <code>sudo\u00a0pip\u00a0install\u00a0pydes\u00a0--allow-external\u00a0pydes\u00a0--allow-unverified\u00a0pydes</code> <code>sudo\u00a0pip\u00a0install\u00a0beeswarm</code></p> <p>OBS om f\u00f6ljande h\u00e4nder: \"The required version of setuptools (&gt;=6.0.1) is not available, and can't be installed while this script is running. Please install a more recent version first, using 'easy_install -U setuptools'\" K\u00f6r:</p> <p><code>sudo\u00a0easy_install\u00a0-U\u00a0setuptools</code> <code>sudo\u00a0pip\u00a0install\u00a0beeswarm</code></p> <p>P\u00e5 server:</p> <p><code>mkdir\u00a0server_workdir\u00a0&amp;&amp;\u00a0cd\u00a0server_workdir</code> <code>beeswarm\u00a0--server\u00a0--customize</code></p> <p>Svara p\u00e5 fr\u00e5gorna samt kopiera l\u00f6senordet, webgui next.</p> <p><code>https://10.1.2.3:5000</code> <code>+Drone\u00a0-&gt;\u00a02\u00a0minuter\u00a0p\u00e5\u00a0dig\u00a0att\u00a0registrera\u00a0drone</code></p> <p>P\u00e5 honeypot:</p> <p><code>sudo\u00a0su\u00a0-</code> <code>mkdir\u00a0/root/drone_workdir\u00a0&amp;&amp;\u00a0cd\u00a0/root/drone_workdir</code> <code>beeswarm\u00a0--config</code><code>https://10.1.2.3:5000/ws/drone/add/f12345</code></p> <p>P\u00e5 honeypoten m\u00e5ste beeswarm k\u00f6ras som root f\u00f6r att kunna binda portar. Resten g\u00f6rs i webguit</p>"},{"location":"linux_services/Beeswarm/#autostart","title":"Autostart","text":"<p><code>sudo\u00a0touch\u00a0/root/beeswarm.sh\u00a0&amp;&amp;\u00a0sudo\u00a0chmod\u00a0700\u00a0/root/beeswarm.sh\u00a0&amp;&amp;\u00a0sudo\u00a0nano\u00a0/root/beeswarm.sh</code></p> <p>Server</p> <p><code>#!/bin/sh</code> <code>su\u00a0-\u00a0user1\u00a0-c\u00a0\"/usr/local/bin/beeswarm\u00a0--server\u00a0--workdir\u00a0/home/user1/server_workdir\"</code></p> <p>Honeypot</p> <p><code>#!/bin/sh</code> <code>/usr/local/bin/beeswarm\u00a0--workdir\u00a0/root/drone_workdir</code></p> <p>Klient</p> <p><code>#!/bin/sh</code> <code>su\u00a0-\u00a0user1\u00a0-c\u00a0\"/usr/local/bin/beeswarm\u00a0--workdir\u00a0/home/user1/drone_workdir\"</code></p> <p>L\u00e4gg in f\u00f6ljande i rc.local</p> <p><code>/root/beeswarm.sh\u00a0&gt;\u00a0/dev/null\u00a02&gt;&amp;1\u00a0&amp;</code></p>"},{"location":"linux_services/Beeswarm/#uppgradering","title":"Uppgradering","text":"<p><code>sudo\u00a0pip\u00a0install\u00a0--upgrade\u00a0beeswarm\u00a0--allow-external\u00a0pydes\u00a0--allow-unverified\u00a0pydes</code></p>"},{"location":"linux_services/Beeswarm/#ntp","title":"NTP","text":"<p>Tidssynk \u00e4r mycket viktigt och om klockorna g\u00e5r fel slutar det att funka. Detta kan h\u00e4nda till och med n\u00e4r NTP \u00e4r installerat, om man k\u00f6r default-inst\u00e4llningar. S\u00e5 trimma dem.</p> <p><code>sudo\u00a0nano\u00a0/etc/ntp.conf</code> <code>server\u00a00.ubuntu.pool.ntp.org\u00a0minpoll\u00a06\u00a0maxpoll\u00a06</code></p> <p>6 betyder var 64 sekund</p> <p>Category:Guider</p>"},{"location":"linux_services/Cacti/","title":"Cacti","text":"<p>Cacti \u00e4r en grafningsl\u00f6sning f\u00f6r n\u00e4tverk. http://www.cacti.net/</p>"},{"location":"linux_services/Cacti/#installation","title":"Installation","text":"<p>Ubuntu 14.04</p> <p><code>sudo\u00a0apt-get\u00a0update\u00a0&amp;&amp;\u00a0sudo\u00a0apt-get\u00a0upgrade\u00a0&amp;&amp;\u00a0sudo\u00a0apt-get\u00a0-y\u00a0install\u00a0snmpd\u00a0snmp\u00a0mysql-server\u00a0\\</code> <code>apache2\u00a0libapache2-mod-php5\u00a0php5-mysql\u00a0php5-cli\u00a0php5-snmp\u00a0php5-gd\u00a0ntp</code></p> <p><code>sudo\u00a0apt-get\u00a0-y\u00a0install\u00a0cacti</code></p> <p>\u201clibphp-adodb\u201d = \u201cOk\u201d. \u201cConfiguring Cacti\u201d = \u201cApache2\u201d \u201cConfiguring cacti\u201d = dbconfig-common MySQL = l\u00f6senordet du skapa tidigare</p>"},{"location":"linux_services/Cacti/#konfiguration","title":"Konfiguration","text":"<p>Logga in p\u00e5 webbgr\u00e4nsnittet, d\u00e4r g\u00f6rs den mesta konfigurationen.</p> <p><code>http://[serverip]/cacti</code></p> <p>admin/admin</p> <p>1 minute polling OBS \"Fix the RRA settings first, because this is the one thing you must get right from the start. Once you start collecting data with bad RRA settings, it is extremely difficult to correct it. And by \u201cextremely difficult\u201d, I mean \u201cjust throw it away and start over\u201d.\"</p> <p>http://www.tolaris.com/2013/07/09/cacti-and-1-minute-polling/</p> <p>T\u00e4nk p\u00e5:</p> <ul> <li>B\u00e5de in och out under stycket: Adjust \u201cStep\u201d and \u201cHeartbeat\u201d on all     Data Source templates</li> <li>Starta om crond f\u00f6r att \u00e4ndringarna ska l\u00e4sas in</li> </ul> <p>VM-snapshots \u00e4r din v\u00e4n.</p> <p>Spine Spine Polling Daemon \u00e4r en ers\u00e4ttare f\u00f6r polling-scriptet som k\u00f6rs default.</p> <p><code>sudo\u00a0apt-get\u00a0install\u00a0cacti-spine</code></p> <p>\u201cSettings\u201d -&gt; \u201cConfiguration\u201d -&gt; \u201cPoller\u201d -&gt; \u201cPoller Type\u201d och v\u00e4lj \u201cSpine\u201d.</p> <p>Visual H\u00f6j vissa standardv\u00e4rden f\u00f6r att kunna se l\u00e4ngre descriptions. \u201cSettings\u201d -&gt; \u201cVisual\u201d</p> <ul> <li>Maximum Title Length</li> <li>Maximum Field Length</li> </ul> <p>Interface Description</p> <p><code>|host_description|\u00a0-\u00a0|query_ifName|\u00a0-\u00a0|query_ifAlias|</code></p>"},{"location":"linux_services/Cacti/#plugins","title":"Plugins","text":"<p>Cacti har ett pluginsystem d\u00e4r man kan l\u00e4gga de plugins man vill. Exempel p\u00e5 anv\u00e4ndbara plugins:</p> <ul> <li>Aggregate</li> <li>Intropage</li> </ul> <p>Templates</p> <ul> <li>Advanced     Ping</li> </ul>"},{"location":"linux_services/Cacti/#weathermap","title":"Weathermap","text":"<p>En av de absolut coolaste grejerna med cacti \u00e4r en plugin som heter weathermap. Det funkar som plugin f\u00f6r Cacti eller MRTG men g\u00e5r ocks\u00e5 att integrera med Observium. Den senaste versionen av weathermap \u00e4r fr\u00e5n Apr 10, 2013, var beredd p\u00e5 att n\u00e4stan h\u00e4lften av knapparna i det grafiska gr\u00e4nssnittet inte fungerar som det ska, man f\u00e5r testa sig fram.</p> <p>Exempel</p> <p>Download and unzip php-weathermap-latest.zip</p> <pre><code> wget http://network-weathermap.com/files/php-weathermap-0.97c.zip\n sudo apt-get install unzip\n unzip php-weathermap-0.97c.zip\n sudo mv weathermap /usr/share/cacti/site/plugins\n sudo sed -i '63i$plugins = array();' /usr/share/cacti/site/include/config.php\n sudo sed -i '64i$plugins[] = 'weathermap';' /usr/share/cacti/site/include/config.php\n sudo sed -i -r 's/ENABLED=false/ENABLED=true/g' /usr/share/cacti/site/plugins/weathermap/editor.php\n sudo touch /usr/share/cacti/site/plugins/weathermap/configs/wmap.conf\n sudo chown www-data /usr/share/cacti/site/plugins/weathermap/{output,configs}\n sudo chown www-data /usr/share/cacti/site/plugins/weathermap/configs/wmap.conf\n</code></pre> <p>N\u00e4sta steg g\u00f6rs i det grafiska gr\u00e4nssnittet. F\u00f6rst ska \"wmap\" enableas sedan g\u00f6rs resten i Weathermap GUI Editor.</p> <p>Bakgrundsbilder laddas upp till /usr/share/cacti/site/plugins/weathermap/images/ och kan sedan v\u00e4ljas i editorn.</p> <p>wmap.conf Storlek i pixlar</p> <p><code>WIDTH\u00a01900</code> <code>HEIGHT\u00a0900</code></p> <p>Tidsst\u00e4mpel</p> <p><code>TIMEPOS\u00a01300\u00a040\u00a0Created:\u00a0%b\u00a0%d\u00a0%Y\u00a0%H:%M:%S</code></p> <p>Template nodes</p> <p><code>NODE\u00a0DEFAULT</code> <code>LABELBGCOLOR\u00a0169\u00a05\u00a010</code> <code>LABELFONTCOLOR\u00a0216\u00a0248\u00a03</code> <code>MAXVALUE\u00a0100</code></p> <p>Template links</p> <p><code>LINK\u00a0DEFAULT</code> <code>WIDTH\u00a05</code> <code>BANDWIDTH\u00a01000M</code></p> <p>Noder</p> <p><code>NODE\u00a0Firewall01</code> <code>LABEL\u00a0Firewall01</code> <code>LABELOFFSET\u00a0W\u00a0\u00a0\u00a0#S\u00e4tt\u00a0label\u00a0i\u00a0f\u00f6rh\u00e5llande\u00a0till\u00a0nod.\u00a0N,\u00a0S,\u00a0W,\u00a0E,\u00a0C</code> <code>ICON\u00a0images/Firewall.png</code> <code>POSITION\u00a0500\u00a0500</code></p> <p>L\u00e4nkar</p> <p><code>LINK\u00a0Switch01-Firewall01</code> <code>WIDTH\u00a08\u00a0\u00a0\u00a0#i\u00a0pixlar</code> <code>INFOURL\u00a0/cacti/graph.php?rra_id=all&amp;local_graph_id=101</code> <code>OVERLIBGRAPH\u00a0/cacti/graph_image.php?local_graph_id=101&amp;rra_id=0&amp;graph_nolegend=true&amp;graph_height=100&amp;graph_width=300</code> <code>BWSTYLE\u00a0angled\u00a0\u00a0\u00a0#skriv\u00a0l\u00e4ngs\u00a0med\u00a0ist\u00e4llet\u00a0f\u00f6r\u00a0horisontellt</code> <code>BWLABEL\u00a0bits\u00a0\u00a0\u00a0#byt\u00a0fr\u00e5n\u00a0procent\u00a0till\u00a0bits</code> <code>BWFONT\u00a0106\u00a0\u00a0\u00a0#m\u00e5ste\u00a0finnas\u00a0definierade</code> <code>BWLABELPOS\u00a075\u00a025\u00a0\u00a0\u00a0#placera\u00a0label</code> <code>TARGET\u00a0/var/www/cacti/rra/traffic_in_1000.rrd</code> <code>NODES\u00a0Switch01\u00a0Firewall01</code> <code>BANDWIDTH\u00a0100M</code> <code>ARROWSTYLE\u00a0compact</code></p> <p>Aggregera l\u00e4nkar</p> <p><code>TARGET\u00a0/var/www/cacti/rra/traffic_in_1000.rrd\u00a0/var/www/cacti/rra/traffic_in_1001.rrd</code></p> <p>Multiple via</p> <p><code>VIA\u00a0x\u00a0y</code> <code>VIA\u00a0x2\u00a0y2</code></p> <p>Visningssida f\u00f6r Weathermap Detta \u00e4r ett exempel p\u00e5 en simpel visningssida f\u00f6r den nyskapade Weathermap:n Med lite html-kunskaper och fantasi g\u00e5r detta att utveckla v\u00e4ldigt mycket. Inspiration</p> <p><code>sudo\u00a0ln\u00a0-s\u00a0/usr/share/cacti/site/plugins/weathermap/output\u00a0/var/www/html/</code></p> <pre><code> sudo dd of=/var/www/html/index.html &lt;&lt; EOF\n &lt;html&gt;\n &lt;head&gt;\n &lt;title&gt;Internet Load Map&lt;/title&gt;\n &lt;META HTTP-EQUIV=\"REFRESH\" CONTENT=\"60\"&gt;\n &lt;/head&gt;\n &lt;body bgcolor=\"#000000\"&gt;\n &lt;img src=\"../output/12345.png\"&gt;&lt;/img&gt;\n &lt;/body&gt;\n &lt;/html&gt;\n EOF\n</code></pre> <p><code>sudo\u00a0sed\u00a0-i\u00a0\"s/12345/$(find\u00a0/usr/share/cacti/site/plugins/weathermap/output/\u00a0\\</code> <code>-name\u00a0\"*.thumb.png\"\u00a0-exec\u00a0basename\u00a0\\{}\u00a0.thumb.png\u00a0\\;)/g\"\u00a0/var/www/html/index.html</code></p> <p>Fels\u00f6kning Om error codes i loggen: http://network-weathermap.com/manual/0.97b/pages/errorcodes.html</p>"},{"location":"linux_services/Cacti/#extern-hemsida","title":"Extern hemsida","text":"<p>Visa cacti-grafer p\u00e5 en extern hemsida.</p> <p>1) Enable guest access Console -&gt; Settings -&gt; Authentication</p> <ul> <li>Guest User : guest</li> </ul> <p>Console -&gt; User Management -&gt; guest</p> <ul> <li>Enabled : on</li> <li>Realm Permissions : View Graphs = on</li> </ul> <p>2) Logga in med Guest usern en g\u00e5ng</p> <p>3) L\u00e4gg in en img src i din html kod d\u00e4r \u00e4r X.X.X.X ipadressen till cactin</p> <p><code>&lt;.img\u00a0src=\"</code><code>http://X.X.X.X/cacti/graph_image.php?action=edit&amp;local_graph_id=55&amp;rra_id=1</code><code>\"&gt;</code></p> <p>&amp;local_graph_id=55 d\u00e4r 55 \u00e4r IDet p\u00e5 grafen, &amp;rra_id=1 1an betyder att den k\u00f6r p\u00e5 en dag 2 \u00e4r 1 vecka osv.</p> <p>Category:Guider</p>"},{"location":"linux_services/Certbot/","title":"Certbot","text":"<p>Category:Guider Certbot anv\u00e4nds f\u00f6r att enkelt kunna automatisera nya cert ifr\u00e5n Let's Encrypt.</p>"},{"location":"linux_services/Certbot/#installation","title":"Installation","text":"<ul> <li>#tab1|CentOS 7</li> <li>#tab2|Ubuntu 18.04</li> </ul>   B\u00f6rja med att installera EPEL repot.  `yum\u00a0-y\u00a0install\u00a0epel-release\u00a0yum-utils`  Installera sedan Certbot  `yum\u00a0install\u00a0certbot\u00a0python2-certbot-nginx`     B\u00f6rja med l\u00e4gga till nya repon.  `apt-get\u00a0update` `apt-get\u00a0install\u00a0software-properties-common` `add-apt-repository\u00a0universe` `add-apt-repository\u00a0ppa:certbot/certbot` `apt-get\u00a0update`  Installera sedan certbot.  `apt-get\u00a0install\u00a0certbot\u00a0python-certbot-nginx` `\u00a0\u00a0`"},{"location":"linux_services/Certbot/#konfiguration","title":"Konfiguration","text":"<p>Certbot k\u00f6rs f\u00f6rsta g\u00e5ngen som en oneliner. Efter det skapas en config fil under /etc/certbot/renewal/ med alla inst\u00e4llningar du valde.</p> <p>Certifikat sparas under /etc/letsencrypt/live/"},{"location":"linux_services/Certbot/#signera-certifikat","title":"Signera certifikat","text":""},{"location":"linux_services/Certbot/#renew","title":"Renew","text":"<p>Om du en g\u00e5ng skapat ett certifikat och vill signa om det f\u00f6r att det \u00e4r p\u00e5 v\u00e4g att g\u00e5 ut kan du k\u00f6ra:</p> <p><code>certbot\u00a0renew</code></p> <p>Om du vill g\u00f6ra en dry run g\u00f6r du det med:</p> <p><code>certbot\u00a0renew\u00a0--dry-run</code></p> <p>Certifikat kommer inte renewas om det \u00e4r mer \u00e4n 30 dagar kvar tills dom g\u00e5r ut by default .</p>"},{"location":"linux_services/Certbot/#webroot","title":"Webroot","text":"<p>Webroot signering fungerar genom att certbot l\u00e4gger en fil i en viss mapp som sedan Let's Encrypts ACME server kommer f\u00f6rs\u00f6ka h\u00e4mta f\u00f6r att validera att dom\u00e4nen du vill signa f\u00f6r pekar mot dig och att det \u00e4r du.</p> <p>F\u00f6ljande kommando kommer att signera ett cert f\u00f6r hackernet.se och www.hackernet.se.</p> <p><code>certbot\u00a0certonly\u00a0--webroot\u00a0--agree-tos\u00a0--no-eff-email\u00a0--email\u00a0dinmail@hackernet.nu\u00a0-w\u00a0/path/to/webfolder\u00a0-d\u00a0hackernet.se,\u00a0www.hackernet.se</code></p>"},{"location":"linux_services/Certbot/#dns-01","title":"DNS-01","text":"<p>Man kan anv\u00e4nda sig av DNS record f\u00f6r att verifera sitt cert. Med DNS challenge kan man ocks\u00e5 signa wildcard certifikat.</p> <p>B\u00f6rja med att skapa filen /etc/letsencrypt/dns-01.ini med f\u00f6ljande inneh\u00e5ll:</p> <p><code>#\u00a0Target\u00a0DNS\u00a0server</code> <code>dns_rfc2136_server\u00a0=</code> <code>#\u00a0Target\u00a0DNS\u00a0port</code> <code>dns_rfc2136_port\u00a0=\u00a053</code> <code>#\u00a0TSIG\u00a0key\u00a0name</code> <code>dns_rfc2136_name\u00a0=</code><code>.</code> <code>#\u00a0TSIG\u00a0key\u00a0secret</code> <code>dns_rfc2136_secret\u00a0=</code> <code>#\u00a0TSIG\u00a0key\u00a0algorithm</code> <code>dns_rfc2136_algorithm\u00a0=\u00a0HMAC-SHA512</code> <p>K\u00f6r sedan f\u00f6ljande kommando:</p> <p><code>certbot\u00a0certonly\u00a0--agree-tos\u00a0--no-eff-email\u00a0--email\u00a0dinmail@hackernet.nu\u00a0--dns-rfc2136\u00a0--dns-rfc2136-credentials\u00a0/etc/letsencrypt/dns-01.ini\u00a0-d\u00a0*.subdomain1.hackernet.se,*.subdomain2.hackernet.se,*.subdomain3.hackernet.se</code></p>"},{"location":"linux_services/Certbot/#automatisera-certifikat","title":"Automatisera certifikat","text":""},{"location":"linux_services/Certbot/#renew_1","title":"Renew","text":"<p>Med hj\u00e4lp av systemd timers kan man k\u00f6ra certbot renew med mellanrum f\u00f6r att se till att alla ens certifikat \u00e4r giltiga.</p> <p>B\u00f6rja med att skapa f\u00f6ljande service fil:</p> <p>/etc/systemd/system/certbot-renewal.service</p> <p>[Unit] Description=Certbot Renewal</p> <p>[Service] ExecStart=/usr/bin/certbot renew</p> <p>Skapa sedan timer filen som kommer trigga servicen.</p> <p>/etc/systemd/system/certbot-renewal.timer</p> <p>[Unit] Description=Timer for Certbot Renewal</p> <p>[Timer] OnBootSec=300 OnUnitActiveSec=1w</p> <p>[Install] WantedBy=multi-user.target</p> <p>Tj\u00e4nsten kommer k\u00f6ras en g\u00e5ng i veckan och 300 sekunder efter boot. Eftersom certbot by default inte signerar nya cert om dom det \u00e4r mer \u00e4n 30 dagar kvar s\u00e5 r\u00e4cker det med 1 g\u00e5ng i veckan.</p> <p>Starta sedan timern:</p> <p><code>systemctl\u00a0start\u00a0certbot-renewal.timer</code></p> <p>Enable timern s\u00e5 att den startas vid boot:</p> <p><code>systemctl\u00a0enable\u00a0certbot-renewal.timer</code></p> <p>F\u00f6r att visa alla aktiva timers k\u00f6rs:</p> <p><code>systemctl\u00a0list-timers</code></p>"},{"location":"linux_services/Certbot/#hooks","title":"Hooks","text":"<p>Certbot kan kalla p\u00e5 olika script f\u00f6re, under och efter en k\u00f6rning.</p> Path Help /etc/letsencrypt/renewal-hooks/deploy K\u00f6rs enbart efter ett lyckat renewal av ett cert. /etc/letsencrypt/renewal-hooks/pre K\u00f6rs alltid f\u00f6re en renew. /etc/letsencrypt/renewal-hooks/post K\u00f6rs alltid efter en renew. <p>Ett exempel p\u00e5 en fil under deploy f\u00f6r att starta om nginx:</p> <pre><code>#!/bin/bash\nsystemctl reload nginx.service\n</code></pre>"},{"location":"linux_services/Clogin/","title":"Clogin","text":"<p>Clogin \u00e4r ett script som anv\u00e4nds f\u00f6r inloggning p\u00e5 Ciscoenheter. Det \u00e4r en komponent f\u00f6r Rancid.</p>"},{"location":"linux_services/Clogin/#installation","title":"Installation","text":"<p><code>sudo\u00a0apt-get\u00a0-y\u00a0install\u00a0rancid</code></p>"},{"location":"linux_services/Clogin/#forberedelser","title":"F\u00f6rberedelser","text":"<p>Kopiera clogin till ditt hem-directory, t.ex. cp /var/lib/rancid/bin/clogin \\~/</p> <p>cloginrc</p> <p><code>cd\u00a0&amp;&amp;\u00a0nano\u00a0.cloginrc</code> <code>#add\u00a0autoenable\u00a0*\u00a01</code> <code>add\u00a0method\u00a0*\u00a0ssh</code> <code>add\u00a0user\u00a0*\u00a0cisco</code> <code>add\u00a0password\u00a0*\u00a0cisco\u00a0cisco</code></p> <p>Skydda filen s\u00e5 gott det g\u00e5r</p> <p><code>chmod\u00a0600\u00a0.cloginrc</code></p> <p>Script</p> <p><code>nano\u00a0clogin-execute.sh</code> <code>#!/bin/bash</code> <code>for\u00a0line\u00a0in\u00a0$(cat\u00a0device-iplist.txt\u00a0|\u00a0grep\u00a0-v\u00a0'#')</code> <code>do</code> <code>/home/$USER/clogin\u00a0-x\u00a0commands.txt\u00a0$line</code> <code>done</code></p> <p>R\u00e4ttigheter</p> <p><code>chmod\u00a0+x\u00a0clogin-execute.sh</code></p>"},{"location":"linux_services/Clogin/#konfiguration","title":"Konfiguration","text":"<p>Lista vilka enheter kommandona ska k\u00f6ras p\u00e5.</p> <p><code>nano\u00a0device-iplist.txt</code> <code>#\u00a0Kommentera\u00a0ut\u00a0med\u00a0#</code> <code>10.0.0.100</code> <code>10.0.0.101</code> <code>#10.0.0.102</code> <code>...</code></p> <p>Lista vilka kommandon som ska k\u00f6ras p\u00e5 varje enhet. Exempel, skapa vlan.</p> <p><code>nano\u00a0commands.txt</code> <code>show\u00a0vlan\u00a0id\u00a050\u00a0|\u00a0i\u00a050</code> <code>conf\u00a0t</code> <code>vlan\u00a050</code> <code>name\u00a0Vlan50</code> <code>mode\u00a0fabricpath</code> <code>exit</code> <code>exit</code> <code>show\u00a0vlan\u00a0id\u00a050\u00a0|\u00a0i\u00a050</code> <code>wr</code> <code>exit</code></p> <p>Exekvera scriptet</p> <p><code>./clogin-execute.sh</code></p> <p>Category:Cisco</p>"},{"location":"linux_services/Digitala_Certifikat/","title":"Digitala Certifikat","text":"<p>Ett digitalt certifikat \u00e4r en datafil som best\u00e5r av kryptonycklar. Certifikatet kan anv\u00e4ndas f\u00f6r kryptering, digitala signaturer och autentisering (OBS ej SSH autentisering). Certifikat utf\u00e4rdas av en certifikatauktoritet, CA. Den senaste standarden \u00e4r X.509 version 3 X509-certifikat anv\u00e4nds av alla sorts system och hur du hanterar dina certifikat \u00e4r plattformsoberoende. H\u00e4r \u00e4r kort l\u00e4sning om certifikatshantering p\u00e5 Windows och Red Hat: http://techworld.idg.se/2.2524/1.498006/windows-vs-linux---nu-avgors-kampen/sida/5/terminalfunktioner-och-certifikattjanster</p> <p>Om man inte litar p\u00e5 Microsoft CryptoAPI kan man anv\u00e4nda t.ex. OpenSSL f\u00f6r att generera nycklarna och sedan Windowsverktyg f\u00f6r att hantera och signera certifikaten. Med OpenSSL kan du generera i princip hur stora RSA-nycklar som helst f\u00f6rutsatt att du har en superdator alternativt evigt liv. Hur stora nycklar som g\u00e5r att anv\u00e4nda varierar fr\u00e5n applikation till applikation, t.ex. OpenVPN klarar inte st\u00f6rre \u00e4n 4096-bitar annars blir meddelandena \"f\u00f6r l\u00e5nga\".</p>"},{"location":"linux_services/Digitala_Certifikat/#format","title":"Format","text":"<p>DER is a binary encoding of a certificate. Typically these use the file extension of .crt or .cer.</p> <p>PEM is a Base64 encoding of a certificate represented in ASCII therefore it is readable as a block of text. This is very useful as you can open it in a text editor work with the data more easily.</p>"},{"location":"linux_services/Digitala_Certifikat/#lets-encrypt","title":"Let's Encrypt","text":"<p>Let\u2019s Encrypt \u00e4r en certificate authority som \u00e4r gratis, automatiserad och \u00f6ppen. Det \u00e4r ett initiativ av Internet Security Research Group som backas upp av en m\u00e4ngd stora f\u00f6retag d\u00e4r m\u00e5let \u00e4r att tillhandah\u00e5lla TLS helt gratis. L\u00e4s mer p\u00e5 Let's Encrypt hur du kan skapa dina egna godk\u00e4nda certifikat.</p>"},{"location":"linux_services/Digitala_Certifikat/#self-signed","title":"Self-signed","text":"<p>Man kan skapa certifikat och signera dem sj\u00e4lv med OpenSSL.</p> <p><code>openssl\u00a0req\u00a0-newkey\u00a0rsa:4096\u00a0-nodes\u00a0-keyout\u00a0selfsigned.key\u00a0-x509\u00a0-days\u00a03650\u00a0-out\u00a0selfsigned.crt</code></p>"},{"location":"linux_services/Digitala_Certifikat/#xca","title":"XCA","text":"<p>XCA \u00e4r ett smidigt och kompetent verktyg f\u00f6r certifikatshantering som k\u00f6r OpenSSL f\u00f6r den kryptografiska biten. Det jobbar mot en databasfil som \u00e4r viktig att h\u00e5lla reda om du inte har backup p\u00e5 dina kryptonycklar. Databasfilen m\u00e5ste ocks\u00e5 l\u00f6senordsskyddas. http://sourceforge.net/projects/xca/</p>"},{"location":"linux_services/Digitala_Certifikat/#egen-ca","title":"Egen CA","text":"<p>T\u00e4nk igenom noggrant hur du vill ha det f\u00f6r n\u00e4r rootcertet \u00e4r skapat och du b\u00f6rjar rulla ut signerade certifikat till servrar och klienter g\u00e5r det inte att \u00e4ndra n\u00e5got i efterhand!</p> <p>Starta xca.exe, skapa en ny databas med File -&gt; New DataBase. L\u00e4gg databasen p\u00e5 l\u00e4mpligt st\u00e4lle och v\u00e4lj ett s\u00e4kert l\u00f6senord. F\u00f6r att kunna skapa ett certifikat m\u00e5ste man ha kryptonycklar. Dessa kan man importera till databasen eller generera nya med det inbyggda verktyget, Private Keys -&gt; New Key.</p> <p>B\u00f6rja med att skapa ett certifikat som ska vara rootcert f\u00f6r din CA. Detta anv\u00e4nds f\u00f6r att signera dina certifikat och ska distribueras till alla klienter som ska kunna verifiera dina certifikat.</p> <p>V\u00e4lj Certificates -&gt; New Certificate. H\u00e4r ska all information om rootcertet fyllas i.</p>"},{"location":"linux_services/Digitala_Certifikat/#source","title":"Source","text":"<p>Ditt rootcert m\u00e5ste vara self signed men kan ha valfritt serienummer. Signature algorithm: Valfritt (md5 ej rekommenderat) Det f\u00f6ljer med en CA-template som \u00e4r en bra utg\u00e5ngspunkt, Apply all.</p>"},{"location":"linux_services/Digitala_Certifikat/#subject","title":"Subject","text":"<p><code>Internal\u00a0name:\u00a0Anv\u00e4nds\u00a0endast\u00a0lokalt\u00a0i\u00a0din\u00a0databas,\u00a0s\u00e4tt\u00a0n\u00e5got\u00a0informativt.</code></p> <p>H\u00e4r kan du v\u00e4lja vad du vill. Nedan \u00e4r exempel fr\u00e5n GeoTrusts rootcert som bland annat har signerat Googles hemsidecertifikat.</p> <p><code>countryName:\u00a0US</code> <code>stateOrProvinceName:</code> <code>localityName:</code> <code>organizationName:\u00a0GeoTrust\u00a0Inc.</code> <code>organizationalUnitName</code> <code>commonName:\u00a0GeoTrust\u00a0Global\u00a0CA</code> <code>emailAddress:</code></p> <p>Private key: V\u00e4lj en befintlig nyckel eller generera en ny</p>"},{"location":"linux_services/Digitala_Certifikat/#extensions","title":"Extensions","text":"<p>Det som f\u00f6ljer med templaten fungerar bra. T.ex. 10 \u00e5rs validitet.</p> <p>Det som \u00e4r viktigt p\u00e5 denna sida \u00e4r X509v3 Distribution Points och Authority Information Access. H\u00e4r beh\u00f6vs ett designval g\u00f6ras. Man kan l\u00e4mna dessa tomma och det fungerar \u00e4nd\u00e5. Den klara nackdelen med det blir att man aldrig n\u00e5gonsin kan g\u00f6ra ett signerat certifikat ogiltigt. Dvs ber\u00e4tta f\u00f6r klienterna att ett certifikat inte ska litas p\u00e5. Detta kan g\u00f6ras p\u00e5 olika s\u00e4tt med respektive f\u00f6r och nackdelar.</p> <p>CRL vs OCSP (Arbete p\u00e5g\u00e5r, l\u00e4mnar denna l\u00e4nk s\u00e5l\u00e4nge: https://www.fir3net.com/Security/Concepts-and-Terminology/certificate-revocation.html)</p>"},{"location":"linux_services/Digitala_Certifikat/#key-usage","title":"Key usage","text":"<p>Certificate- och CRL sign fungerar bra. Detta \u00e4r endast informationsf\u00e4lt s\u00e5 man vet vad certifikatet \u00e4r t\u00e4nkt att anv\u00e4ndas till.</p>"},{"location":"linux_services/Digitala_Certifikat/#netscape","title":"Netscape","text":"<p>Allt h\u00e4r kan tas bort. Finns endast med f\u00f6r bak\u00e5tkompabilitet med gamla gamla standarder.</p>"},{"location":"linux_services/Digitala_Certifikat/#advanced","title":"Advanced","text":"<p>\u00d6versikt \u00f6ver ditt certifikat. Kolla igenom s\u00e5 allt \u00e4r korrekt.</p> <p>OK = klart</p>"},{"location":"linux_services/Digitala_Certifikat/#distribution","title":"Distribution","text":"<p>Nu kan ditt rootcert b\u00f6rja skickas ut. Du kan exempelvis l\u00e4gga det p\u00e5 en publik webbserver s\u00e5 kan vem som helst enkelt ladda ner det.</p>"},{"location":"linux_services/Digitala_Certifikat/#ecc","title":"ECC","text":"<p>Elliptic Curve Cryptography erbjuder mindre nycklar med liknande s\u00e4kerhet som traditionell kryptering med \u00f6ppen nyckel, vilket leder till h\u00f6gre krypteringsprestanda. OpenSSL har st\u00f6d f\u00f6r Elliptic Curve Cryptography-certifikat men tyv\u00e4rr har inte XCA det. Working directory</p> <p><code>sudo\u00a0mkdir\u00a0/etc/nginx/ssl</code></p> <p>Skapa privat nyckel</p> <p><code>sudo\u00a0openssl\u00a0ecparam\u00a0-out\u00a0/etc/nginx/ssl/nginx.key\u00a0-name\u00a0prime256v1\u00a0-genkey</code></p> <p>Skapa CSR</p> <p><code>sudo\u00a0openssl\u00a0req\u00a0-new\u00a0-key\u00a0/etc/nginx/ssl/nginx.key\u00a0-out\u00a0/etc/nginx/ssl/csr.pem</code></p> <p>Nu kan du signera csr:n med ditt rootcert alternativt sj\u00e4lv-signera med f\u00f6ljande:</p> <p><code>sudo\u00a0openssl\u00a0req\u00a0-x509\u00a0-nodes\u00a0-days\u00a0365\u00a0-key\u00a0/etc/nginx/ssl/nginx.key\u00a0-in\u00a0/etc/nginx/ssl/csr.pem\u00a0-out\u00a0/etc/nginx/ssl/nginx.pem</code></p> <p>Category:Guider</p>"},{"location":"linux_services/Docker/","title":"Docker","text":"<p>Docker \u00e4r ett open source-projekt som automatiserar utrullning av applikationer i containers genom att l\u00e4gga ett extra lager av abstraktion och automatisering av virtualisering p\u00e5 Linux. Docker anv\u00e4nder resursisoleringsfunktioner i Linuxk\u00e4rnan, s\u00e5som cgroups och kernel namespace f\u00f6r att till\u00e5ta oberoende \"containers\" att k\u00f6ra i en och samma Linuxinstans. Detta minskar overhead j\u00e4mf\u00f6rt med virtuella maskiner. Mer info: http://www.nkode.io/2014/08/24/valuable-docker-links.html</p>"},{"location":"linux_services/Docker/#installation","title":"Installation","text":"<p>Fedora 23</p> <p><code>sudo\u00a0dnf\u00a0-y\u00a0install\u00a0docker-io</code></p> <p>Ubuntu 14.04</p> <p><code>sudo\u00a0apt-key\u00a0adv\u00a0--keyserver\u00a0hkp://keyserver.ubuntu.com:80\u00a0--recv-keys\u00a036A1D7869245C8950F966E92D8576A8BA88D21E9</code> <code>sudo\u00a0sh\u00a0-c\u00a0\"echo\u00a0deb</code><code>https://get.docker.com/ubuntu</code><code>docker\u00a0main\u00a0&gt;\u00a0/etc/apt/sources.list.d/docker.list\"</code> <code>sudo\u00a0apt-get\u00a0update\u00a0&amp;&amp;\u00a0sudo\u00a0apt-get\u00a0-y\u00a0install\u00a0lxc-docker</code></p> <p>Alternativt</p> <p><code>wget\u00a0-qO-</code><code>https://get.docker.com/</code><code>|\u00a0sh</code></p>"},{"location":"linux_services/Docker/#starta","title":"Starta","text":"<p><code>sudo\u00a0docker\u00a0daemon\u00a0&amp;</code></p> <p>Add user till grupp</p> <p><code>sudo\u00a0usermod\u00a0-aG\u00a0docker\u00a0$(whoami)</code></p>"},{"location":"linux_services/Docker/#imagehantering","title":"Imagehantering","text":"<p>Snapshots av containers eller OS-images, t.ex. ubuntu</p> <p><code>sudo\u00a0docker\u00a0search\u00a0ubuntu</code> <code>sudo\u00a0docker\u00a0pull\u00a0ubuntu</code></p> <p>Visa tillg\u00e4ngliga images</p> <p><code>sudo\u00a0docker\u00a0images</code></p> <p>Starta en container utifr\u00e5n en image.</p> <p><code>docker\u00a0run\u00a0-i\u00a0-t\u00a0ubuntu\u00a0/bin/bash</code></p> <p>F\u00f6r att spara det man har gjort i en image m\u00e5ste man commita</p> <p><code>sudo\u00a0docker\u00a0commit\u00a0[container\u00a0ID]\u00a0[image\u00a0name]</code></p> <p>Remove image</p> <p><code>docker\u00a0image\u00a0ls</code> <code>docker\u00a0rmi</code>"},{"location":"linux_services/Docker/#containerhantering","title":"Containerhantering","text":"<p>Kolla aktiva och inaktiva containers.</p> <p><code>sudo\u00a0docker\u00a0ps</code> <code>sudo\u00a0docker\u00a0ps\u00a0-l</code></p> <p>Starta och stoppa en container.</p> <p><code>sudo\u00a0docker\u00a0run\u00a0[container\u00a0ID]</code> <code>sudo\u00a0docker\u00a0stop\u00a0[container\u00a0ID]</code></p> <p>\u00d6ppna ett bash skal i en container</p> <p><code>sudo\u00a0docker\u00a0exec\u00a0-it\u00a0[container\u00a0namn]\u00a0bash</code></p> <p>Starta och stoppa alla containers:</p> <p><code>docker\u00a0stop\u00a0$(docker\u00a0ps\u00a0-aq)</code> <code>docker\u00a0start\u00a0$(docker\u00a0ps\u00a0-aq)</code></p> <p>Ta bort alla containers:</p> <p><code>docker\u00a0rm\u00a0$(docker\u00a0ps\u00a0-aq)</code></p> <p>Ta bort alla images:</p> <p><code>docker\u00a0rmi\u00a0$(docker\u00a0images\u00a0-q)</code></p>"},{"location":"linux_services/Docker/#inspect","title":"Inspect","text":"<p>Med docker inspect kan man f\u00e5 ut info om images och containers. T.ex. IP-adresser, hostname, kommentarer mm.</p> <p><code>docker\u00a0inspect\u00a0myself/myimage</code> <code>docker\u00a0inspect\u00a0container-id</code> <code>docker\u00a0inspect\u00a0--format\u00a0\"{{\u00a0.NetworkSettings.IPAddress\u00a0}}\"\u00a0$(docker\u00a0ps\u00a0-q)</code></p>"},{"location":"linux_services/Docker/#clean-up","title":"Clean up","text":"<p>St\u00e4da bort alla stoppade containrar, oanv\u00e4nda networks, dangling images samt dangling build cache.</p> <p><code>docker\u00a0system\u00a0prune</code></p> <p>F\u00f6r att \u00e4ven ta bort alla unused images.</p> <p><code>docker\u00a0system\u00a0prune\u00a0-a</code></p>"},{"location":"linux_services/Docker/#dockerfile","title":"Dockerfile","text":"<p><code>nano\u00a0Dockerfile</code> <code>sudo\u00a0docker\u00a0build\u00a0-t\u00a0my_test\u00a0.</code></p>"},{"location":"linux_services/Docker/#registryhubdockercom","title":"registry.hub.docker.com","text":"<p>Docker Hub \u00e4r en central punkt f\u00f6r Docker, d\u00e4r hostas offentliga images. Vill man ladda upp det man har gjort m\u00e5ste man f\u00f6rst regga sig p\u00e5 hemsidan. Sedan kan man pusha imagear.</p> <p><code>sudo\u00a0docker\u00a0push\u00a0username/imagename</code></p>"},{"location":"linux_services/Docker/#central-hantering","title":"Central hantering","text":"<p>Central Dockerhantering g\u00f6r det m\u00f6jligt att managera images, containers, hostar och \u00f6vriga Dockerresurser fr\u00e5n ett och samma st\u00e4lle. Exempel p\u00e5 detta \u00e4r Shipyard, Swarm och Rancher</p>"},{"location":"linux_services/Docker/#network","title":"Network","text":"<p>Fr.o.m version 1.9 finns docker network. Nu anv\u00e4nder man Docker Engine f\u00f6r att skapa virtuella n\u00e4tverk som kan sp\u00e4nna \u00f6ver flera hostar. Overlay g\u00f6rs med VXLAN.</p> <p><code>docker\u00a0network\u00a0--help</code> <code>docker\u00a0network\u00a0ls</code></p> <p>Default finns det 3 n\u00e4tverk. Host mode: containern kopplas till samma L2-dom\u00e4n som hosten.</p> <p><code>docker\u00a0run\u00a0-d\u00a0--name\u00a0webb1\u00a0--net=host</code></p> <p>Bridge mode: (default) containern hamnar bakom hostens ip och man kan portforwarda.</p> <p><code>docker\u00a0run\u00a0-d\u00a0--name\u00a0webb1\u00a0-p\u00a08081:80</code></p> <p>None mode: inget n\u00e4tverk.</p> <p><code>docker\u00a0run\u00a0-d\u00a0--name\u00a0webb1\u00a0--net=none</code></p> <p>New bridge network</p> <p><code>docker\u00a0network\u00a0create\u00a0--driver=bridge\u00a0--subnet=192.168.100.0/24\u00a0--gateway=192.168.100.1\u00a0--ip-range=192.168.100.128/25\u00a0testbridge</code></p> <p>IP-adresser till containerar allokeras fr\u00e5n rangen.</p> <p><code>docker\u00a0network\u00a0connect\u00a0testbridge\u00a0webb1</code></p>"},{"location":"linux_services/Docker/#overlay","title":"Overlay","text":"<p><code>docker\u00a0network\u00a0create\u00a0-d\u00a0overlay\u00a0--subnet=10.10.0.0/24\u00a0testoverlay</code></p> <p>Category:Guider</p>"},{"location":"linux_services/ELK/","title":"ELK","text":"<p>Elasticsearch, Logstash, och Kibana 4 f\u00f6r centraliserad loggning. Det \u00e4r anv\u00e4ndbart f\u00f6r att f\u00f6rs\u00f6ker identifiera problem med servrar och program, eftersom det till\u00e5ter att s\u00f6ka igenom alla loggar p\u00e5 ett och samma st\u00e4lle.</p> <p>Elasticsearch lagrar alla loggar Logstash \u00e4r ett open source-verktyg f\u00f6r att samla in loggar. Logstash kan samla loggar av alla slag. Kibana 4 \u00e4r ett webbgr\u00e4nssnitt som kan anv\u00e4ndas f\u00f6r att s\u00f6ka och visa loggarna som Logstash har indexerat.</p>"},{"location":"linux_services/ELK/#installation","title":"Installation","text":"<p>Ubuntu 14.04 Java</p> <p><code>sudo\u00a0apt-get\u00a0-y\u00a0install\u00a0software-properties-common</code> <code>sudo\u00a0add-apt-repository\u00a0-y\u00a0ppa:webupd8team/java</code> <code>sudo\u00a0apt-get\u00a0update\u00a0&amp;&amp;\u00a0sudo\u00a0apt-get\u00a0-y\u00a0install\u00a0oracle-java8-installer</code></p> <p>Elasticsearch</p> <p><code>wget\u00a0-O\u00a0-</code><code>http://packages.elasticsearch.org/GPG-KEY-elasticsearch</code><code>|\u00a0sudo\u00a0apt-key\u00a0add\u00a0-</code> <code>echo\u00a0\"deb</code><code>http://packages.elastic.co/elasticsearch/2.0/debian</code><code>stable\u00a0main\"\u00a0|\u00a0sudo\u00a0tee\u00a0-a\u00a0/etc/apt/sources.list.d/elasticsearch-2.0.list</code> <code>sudo\u00a0apt-get\u00a0update\u00a0&amp;&amp;\u00a0sudo\u00a0apt-get\u00a0-y\u00a0install\u00a0elasticsearch</code> <code>sudo\u00a0sed\u00a0-i\u00a0's/#network.host:\u00a0192.168.0.1/network.host:\u00a0localhost/g'\u00a0/etc/elasticsearch/elasticsearch.yml</code></p> <p>Init.d</p> <p><code>sudo\u00a0service\u00a0elasticsearch\u00a0restart</code> <code>sudo\u00a0update-rc.d\u00a0elasticsearch\u00a0defaults\u00a095\u00a010</code></p> <p>Kibana</p> <p><code>echo\u00a0'deb</code><code>http://packages.elastic.co/kibana/4.1/debian</code><code>stable\u00a0main'\u00a0|\u00a0sudo\u00a0tee\u00a0/etc/apt/sources.list.d/kibana.list</code> <code>sudo\u00a0apt-get\u00a0update\u00a0&amp;&amp;\u00a0sudo\u00a0apt-get\u00a0-y\u00a0install\u00a0kibana</code> <code>sudo\u00a0sed\u00a0-i\u00a0's/host:\u00a0\"0.0.0.0\"/host:\u00a0\"localhost\"/g'\u00a0/opt/kibana/config/kibana.yml</code> <code>sudo\u00a0update-rc.d\u00a0kibana\u00a0defaults\u00a096\u00a09</code> <code>sudo\u00a0service\u00a0kibana\u00a0start</code></p> <p>Nginx</p> <p><code>sudo\u00a0apt-get\u00a0-y\u00a0install\u00a0nginx\u00a0apache2-utils</code> <code>sudo\u00a0htpasswd\u00a0-c\u00a0/etc/nginx/htpasswd.users\u00a0kibanaadmin</code> <code>sudo\u00a0nano\u00a0/etc/nginx/sites-available/default</code></p> <p><code>server\u00a0{</code> <code>listen\u00a080;</code> <code>server_name\u00a0kibana.local;</code></p> <p><code>auth_basic\u00a0\"Restricted\u00a0Access\";</code> <code>auth_basic_user_file\u00a0/etc/nginx/htpasswd.users;</code></p> <p><code>location\u00a0/\u00a0{</code> <code>proxy_pass</code><code>http://localhost:5601</code><code>;</code> <code>proxy_http_version\u00a01.1;</code> <code>proxy_set_header\u00a0Upgrade\u00a0$http_upgrade;</code> <code>proxy_set_header\u00a0Connection\u00a0'upgrade';</code> <code>proxy_set_header\u00a0Host\u00a0$host;</code> <code>proxy_cache_bypass\u00a0$http_upgrade;</code> <code>}</code> <code>}</code> <code>sudo\u00a0service\u00a0nginx\u00a0restart</code></p> <p>http://IP</p> <p>Logstash Se Logstash</p> <p>Category:Guider</p>"},{"location":"linux_services/EVE-NG/","title":"EVE-NG","text":"<p>EVE-NG (Emulated Virtual Environment New Generation) \u00e4r en uppdaterad variant av Unetlab som det tidigare hette. EVE-NG fungerar precis som GNS3 d\u00e4r man kan virtualisera sin n\u00e4tverksmilj\u00f6 med routrar, brandv\u00e4ggar, switchar men \u00e4ven klienter och servrar som Windows, Linux och ESXi.</p> <p>EVE-NG \u00e4r clientless s\u00e5 det enda som beh\u00f6vs \u00e4r en webbl\u00e4sare f\u00f6r att kunna n\u00e5 sina enheter.</p> <p>Kolla denna lista \u00f6ver vilka enheter EVE-NG har support f\u00f6r.</p> <p>N\u00e5gra m\u00e4rken som EVE-NG har st\u00f6d f\u00f6r \u00e4r Cisco, Juniper, Extreme Network, Arista, PaloAlto, VyOS, pfSense, F5, Fortigate.</p>"},{"location":"linux_services/EVE-NG/#installation","title":"Installation","text":"<p>Tanka hem deras senaste ova eller iso fr\u00e5n deras hemsida.</p> <p><code>http://www.eve-ng.net/index.php/downloads/eve-ng</code></p> <p>Surfa sedan in p\u00e5 den IP du gett EVE-NG, default username och password \u00e4r admin/eve</p>"},{"location":"linux_services/EVE-NG/#installera-images","title":"Installera images","text":"<p>F\u00f6r att l\u00e4gga in en Qemu supportad enhet s\u00e5 m\u00e5ste man d\u00f6pa den p\u00e5 ett specifikt s\u00e4tt och ladda upp filen till /opt/unetlab/addons/qemu/</p> <p>EVE tillhandah\u00e5ller en lista p\u00e5 hur man ska d\u00f6pa en image.</p>"},{"location":"linux_services/EVE-NG/#cumulus","title":"Cumulus","text":"<p>Download URL: Cumulus VX</p> <p>Cumulus VX har ingen schysst device icon i EVE men det g\u00e5r att l\u00e4gga till sj\u00e4lv genom att l\u00e4gga png-filer i \"/opt/unetlab/html/images/icons/\". Default har Cumulus VX templaten f\u00f6r lite minne vilket g\u00f6r att netd krashar.</p> <p><code>sed\u00a0-i\u00a0's/=\u00a0256/=\u00a0512/'\u00a0/opt/unetlab/html/templates/cumulus.php</code></p>"},{"location":"linux_services/EVE-NG/#extreme","title":"Extreme","text":"<p>Download URL: EXOS-VM_v21.1.1.4-disk1.qcow2 Filen ska d\u00f6pas till extremexos-21.1.1.4/hda.qcow2</p> <p>Extreme Network har \u00e4ven lagt upp n\u00e5gra images p\u00e5 deras GitHub som man kan anv\u00e4nda.</p> <p>Category:Guider</p>"},{"location":"linux_services/Emby_Server/","title":"Emby Server","text":"<p>Category:Guider Category:Sparco Emby \u00e4r en opensource media server. Emby fungerar lite som Netflix fast man m\u00e5ste sj\u00e4lv st\u00e5 f\u00f6r filmerna.</p> <p><code>http://emby.media/</code></p>"},{"location":"linux_services/Emby_Server/#installation","title":"Installation","text":"<p>Debian Jessie</p> <p><code>wget\u00a0-qO\u00a0-</code><code>http://download.opensuse.org/repositories/home:emby/Debian_8.0/Release.key</code><code>|\u00a0sudo\u00a0apt-key\u00a0add\u00a0-</code> <code>sudo\u00a0sh\u00a0-c\u00a0\"echo\u00a0'deb</code><code>http://download.opensuse.org/repositories/home:/emby/Debian_8.0/</code><code>/'\u00a0&gt;&gt;\u00a0/etc/apt/sources.list.d/emby-server.list\"</code> <code>sudo\u00a0apt-get\u00a0update</code> <code>sudo\u00a0apt-get\u00a0install\u00a0mono-runtime\u00a0mediainfo\u00a0libsqlite3-dev\u00a0imagemagick-6.q8\u00a0libmagickwand-6.q8-2\u00a0libmagickcore-6.q8-2</code> <code>sudo\u00a0apt-get\u00a0install\u00a0emby-server</code></p> <p>Ett fel som jag fick under installationen som dom h\u00e5ller p\u00e5 att fixa \u00e4r att <code>/usr/lib/emby-server/emby-server.sh</code> hade permissions fel. Det l\u00f6stes med detta kommandot,</p> <p><code>chmod\u00a0+x\u00a0/usr/lib/emby-server/emby-server.sh</code></p> <p>Starta emby-server</p> <p><code>service\u00a0emby-server\u00a0start</code></p> <p>Surfa in p\u00e5 webinterfacet och f\u00f6lj wizarden.</p> <p><code>http://</code><code>:8096</code>"},{"location":"linux_services/Emby_Server/#tipsntrix","title":"Tips'n'Trix","text":"<p>Emby kan inte spela upp filmer som ligger i rar arkiv. Anv\u00e4nd d\u00e4rf\u00f6r rar2fs.</p>"},{"location":"linux_services/Fabric/","title":"Fabric","text":"<p>Fabric \u00e4r ett bibliotek och command-line verktyg f\u00f6r att automatisera deployment och diverse tasks via ssh.</p> <p>I grunden f\u00f6ljer det med en bibliotek av funktioner f\u00f6r antingen lokal eller remote kommandon samt uppladdning / nerladdning av filer. Man kan \u00e4ven bygga egna moduler f\u00f6r att ut\u00f6ka funktionerna av fabric.</p>"},{"location":"linux_services/Fabric/#installation","title":"Installation","text":"<p><code>sudo\u00a0apt-get\u00a0install\u00a0fabric</code></p> <p>Eller med hj\u00e4lp av Python PIP.</p> <p><code>pip\u00a0install\u00a0-e\u00a0git+https://github.com/paramiko/paramiko/#egg=paramiko</code> <code>pip\u00a0install\u00a0-e\u00a0git+https://github.com/fabric/fabric/#egg=fabric</code></p>"},{"location":"linux_services/Fabric/#konfiguration","title":"Konfiguration","text":"<p>Exempel: Fabric fil</p> <pre><code>from __future__ import with_statement\nfrom fabric.api import *\nfrom fabric.utils import warn\nfrom fabric.contrib.files import exists\nfrom fabric.contrib.project import  rsync_project\nfrom fabric.contrib.files import sed\nfrom fabric.contrib.files import append\nfrom fabric.colors import *\nimport os.path\nimport server\nserver.setup_fabric()\nenv.user = 'root'\ndef upgrade_packages():\n    run('apt-get update &amp;&amp; apt-get -y upgrade')\n\ndef pkg_list_backp():\n    package_list = './backups/packageLists/%s.packagesList' % env.host_string\n    run('dpkg --get-selections &gt; /var/backups/packages.list')\n    get('/var/backups/packages.list', package_list)\n\ndef conf_sshd():\n    sed('/etc/ssh/sshd_config',\n        '#PasswordAuthentication yes',\n        'PasswordAuthentication no' )\n    sed('/etc/ssh/sshd_config',\n        'PasswordAuthentication yes',\n        'PasswordAuthentication no' )\n    sed('/etc/ssh/sshd_config',\n        'X11Forwarding yes',\n        'X11Forwarding no' )\n    sed('/etc/ssh/sshd_config',\n        'AllowTcpForwarding yes',\n        'AllowTcpForwarding no' )\n    run('echo \"AllowTcpForwarding no\" &gt;&gt; /etc/ssh/sshd_config')\n    run ('echo \"AllowUsers root op\"  &gt;&gt; /etc/ssh/sshd_config')\n    run ('service ssh restart')\n\ndef deploy_gluster():\n    put('./upload/glusterfs/gluster.list','/etc/apt/sources.list.d/') #L\u00e4gger den lokala filen gluster.list i remote foldern\n    dist = run('lsb_release -cs')\n    sed('/etc/apt/sources.list.d/gluster.list', 'precise', (dist) ) #ers\u00e4tter \"precise\" med versionen som k\u00f6rs\n    run(\"apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 3FE869A9\")\n    run(\"apt-get update\")\n    run(\"apt-get install -y glusterfs-client\")\n\ndef doitall():\n    upgrade_packages()\n    pkg_list_backp()\n    conf_sshd()\n    deploy_gluster()\n</code></pre>"},{"location":"linux_services/Fabric/#server-lista","title":"Server Lista","text":"<p>F\u00f6r att g\u00f6ra olika tasks enklare och \u00f6versk\u00e5dligare rekommenderas det att skapa serverdeffinitioner med olika roller och platser. Exempel server.py</p> <pre><code>from fabric.api import env\nclass Server:\n   def __init__(self, name, rack, roles):\n        self.name = name\n        self.rack = rack\n        if isinstance(roles, list):\n            self.roles = roles\n        else:\n            self.roles = list(roles)\nservers = [\n    Server('upload1',      'A1', ['sr04', 'ipmi', 'metal',  'bm', 'upload']),\n    Server('upload2',       'A2', ['sr04', 'ipmi', 'esxi',  'drz', 'upload']),\n    Server('csgo1',       'A2', ['sr04', 'ipmi', 'kvm',  'drz', 'csgo']),\n    Server('voip1',         'A3', ['sr04', 'ipmi', 'metal',  'drz', 'voip']),\n</code></pre> <p>F\u00f6r att sedan anv\u00e4nda listan importerar du den bara i ditt huvudfabric skript med import server server.setup_fabric()</p>"},{"location":"linux_services/Fabric/#kor-bara-kor","title":"K\u00f6r bara K\u00f6r!","text":"<p>Med serverlista och roller</p> <pre><code>fab -R Roll task\n</code></pre> <p>Med enskilda hostar</p> <pre><code>fab -H host1,host2 task\n</code></pre> <p>Category:Guider</p>"},{"location":"linux_services/Fail2Ban/","title":"Fail2Ban","text":"<p>Category:Guider Fail2ban s\u00f6ker av log filerna f\u00f6r olika tj\u00e4nster som ssh, apache etc och letar efter tex bruteforce attacker eller om en exploit f\u00f6rs\u00f6kt k\u00f6ras. Fail2ban uppdaterar d\u00e5 brandv\u00e4ggen att blocka all trafik fr\u00e5n den IP'n i ex antal minuter.</p>"},{"location":"linux_services/Fail2Ban/#installation","title":"Installation","text":"<p>Deb baserad.</p> <p><code>apt-get\u00a0install\u00a0fail2ban</code></p> <p>RPM baserad</p> <p><code>yum\u00a0install\u00a0fail2ban</code></p>"},{"location":"linux_services/Fail2Ban/#konfiguration","title":"Konfiguration","text":"<p>Fail2ban kommer med bra inst\u00e4llningar ifr\u00e5n b\u00f6rjan. Vill man \u00e4ndra dom g\u00f6r man det i <code>/etc/fail2ban/jail.conf</code></p> maxretry Antalet g\u00e5nger n\u00e5got f\u00e5r h\u00e4nda. Tex 5 felaktiga l\u00f6senord. findtime Hur m\u00e5nga g\u00e5nger man f\u00e5r skriva tex felaktigt l\u00f6senord under en tidsperiod. bantime Hur l\u00e4nge en IP blir bannad. Skrivs i sekunder, -1 ger en permanent ban."},{"location":"linux_services/Fail2Ban/#ssh-repeater-permanent-ban","title":"SSH Repeater permanent ban","text":"<p>Om en IP f\u00f6rs\u00f6ker bruteforca dig s\u00e5 kan det vara sk\u00f6nt att blocka IP'n permanent ist\u00e4llet.</p> <p>Skapa f\u00f6ljande fil <code>/etc/fail2ban/action.d/iptables-repeater.conf</code></p> <p><code>#\u00a0Fail2ban\u00a0configuration\u00a0file</code> <code>#</code> <code>#\u00a0Author:\u00a0Phil\u00a0Hagen\u00a0&lt;phil@identityvector.com&gt;</code> <code>#</code></p> <p><code>[Definition]</code></p> <p><code>#\u00a0Option:\u00a0\u00a0actionstart</code> <code>#\u00a0Notes.:\u00a0\u00a0command\u00a0executed\u00a0once\u00a0at\u00a0the\u00a0start\u00a0of\u00a0Fail2Ban.</code> <code>#\u00a0Values:\u00a0\u00a0CMD</code> <code>#</code> <code>actionstart\u00a0=\u00a0iptables\u00a0-N\u00a0fail2ban-REPEAT-</code> <code>iptables\u00a0-A\u00a0fail2ban-REPEAT-</code><code>-j\u00a0RETURN</code> <code>iptables\u00a0-I\u00a0INPUT\u00a0-j\u00a0fail2ban-REPEAT-</code> <code>#\u00a0set\u00a0up\u00a0from\u00a0the\u00a0static\u00a0file</code> <code>cat\u00a0/etc/fail2ban/ip.blocklist.</code><code>|grep\u00a0-v\u00a0^\\s*#|awk\u00a0'{print\u00a0$1}'\u00a0|\u00a0while\u00a0read\u00a0IP;\u00a0do\u00a0iptables\u00a0-I\u00a0fail2ban-REPEAT-</code><code>1\u00a0-s\u00a0$IP\u00a0-j\u00a0DROP;\u00a0done</code> <p><code>#\u00a0Option:\u00a0\u00a0actionstop</code> <code>#\u00a0Notes.:\u00a0\u00a0command\u00a0executed\u00a0once\u00a0at\u00a0the\u00a0end\u00a0of\u00a0Fail2Ban</code> <code>#\u00a0Values:\u00a0\u00a0CMD</code> <code>#</code> <code>actionstop\u00a0=\u00a0iptables\u00a0-D\u00a0INPUT\u00a0-j\u00a0fail2ban-REPEAT-</code> <code>iptables\u00a0-F\u00a0fail2ban-REPEAT-</code> <code>iptables\u00a0-X\u00a0fail2ban-REPEAT-</code> <p><code>#\u00a0Option:\u00a0\u00a0actioncheck</code> <code>#\u00a0Notes.:\u00a0\u00a0command\u00a0executed\u00a0once\u00a0before\u00a0each\u00a0actionban\u00a0command</code> <code>#\u00a0Values:\u00a0\u00a0CMD</code> <code>#</code> <code>actioncheck\u00a0=\u00a0iptables\u00a0-n\u00a0-L\u00a0INPUT\u00a0|\u00a0grep\u00a0-q\u00a0fail2ban-REPEAT-</code> <p><code>#\u00a0Option:\u00a0\u00a0actionban</code> <code>#\u00a0Notes.:\u00a0\u00a0command\u00a0executed\u00a0when\u00a0banning\u00a0an\u00a0IP.\u00a0Take\u00a0care\u00a0that\u00a0the</code> <code>#\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0command\u00a0is\u00a0executed\u00a0with\u00a0Fail2Ban\u00a0user\u00a0rights.</code> <code>#\u00a0Tags:</code><code>IP\u00a0address</code> <code>#</code><code>number\u00a0of\u00a0failures</code> <code>#</code><code>unix\u00a0timestamp\u00a0of\u00a0the\u00a0ban\u00a0time</code> <code>#\u00a0Values:\u00a0\u00a0CMD</code> <code>#</code> <code>actionban\u00a0=\u00a0iptables\u00a0-I\u00a0fail2ban-REPEAT-</code><code>1\u00a0-s</code><code>-j\u00a0DROP</code> <code>#\u00a0also\u00a0put\u00a0into\u00a0the\u00a0static\u00a0file\u00a0to\u00a0re-populate\u00a0after\u00a0a\u00a0restart</code> <code>!\u00a0grep\u00a0-Fq</code><code>/etc/fail2ban/ip.blocklist.</code><code>&amp;&amp;\u00a0echo\u00a0\"</code><code>#\u00a0fail2ban/$(\u00a0date\u00a0'+%%Y-%%m-%%d\u00a0%%T'\u00a0):\u00a0auto-add\u00a0for\u00a0repeat\u00a0offender\"\u00a0&gt;&gt;\u00a0/etc/fail2ban/ip.blocklist.</code> <p><code>#\u00a0Option:\u00a0\u00a0actionunban</code> <code>#\u00a0Notes.:\u00a0\u00a0command\u00a0executed\u00a0when\u00a0unbanning\u00a0an\u00a0IP.\u00a0Take\u00a0care\u00a0that\u00a0the</code> <code>#\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0command\u00a0is\u00a0executed\u00a0with\u00a0Fail2Ban\u00a0user\u00a0rights.</code> <code>#\u00a0Tags:</code><code>IP\u00a0address</code> <code>#</code><code>number\u00a0of\u00a0failures</code> <code>#</code><code>unix\u00a0timestamp\u00a0of\u00a0the\u00a0ban\u00a0time</code> <code>#\u00a0Values:\u00a0\u00a0CMD</code> <code>#</code> <code>actionunban\u00a0=\u00a0/bin/true</code> <p><code>[Init]</code></p> <p><code>#\u00a0Defaut\u00a0name\u00a0of\u00a0the\u00a0chain</code> <code>#</code> <code>name\u00a0=\u00a0REPEAT</code></p> <p>Skapa sedan ett jail i <code>/etc/fail2ban/jail.conf</code></p> <p><code>...</code> <code>[ssh-repeater]</code> <code>enabled\u00a0\u00a0=\u00a0true</code> <code>filter\u00a0\u00a0\u00a0=\u00a0sshd</code> <code>action\u00a0\u00a0\u00a0=\u00a0iptables-repeater[name=ssh]</code> <code>sendmail-whois[name=SSH-repeater,\u00a0dest=root,\u00a0sender=root]</code> <code>logpath\u00a0\u00a0=\u00a0/var/log/auth</code> <code>maxretry\u00a0=\u00a010</code> <code>findtime\u00a0=\u00a07200</code> <code>bantime\u00a0\u00a0=\u00a0-1</code> <code>...</code></p> <p>Denna regeln g\u00f6r att en IP blir permbannad om den skrivit fel l\u00f6senord \u00f6ver SSH mer \u00e4n 10 g\u00e5nger dom senaste 2 timmarna.</p>"},{"location":"linux_services/FastNetMon/","title":"FastNetMon","text":"<p>High performance DoS/DDoS load analyzer. Kan lyssna p\u00e5 bl.a. Netflow, IPFIX, sFLOW, PCAP, SPAN och PF_RING. Om en \u00f6verbelastningsattack uppt\u00e4cks exekveras ett script. Vad scriptet g\u00f6r avg\u00f6r man sj\u00e4lv, t.ex. maila/SMSa admin eller null routa prefix med ExaBGP.</p>"},{"location":"linux_services/FastNetMon/#installation","title":"Installation","text":"<p>Debian, Ubuntu, CentOS, Fedora</p> <p><code>wget</code><code>https://raw.githubusercontent.com/pavel-odintsov/fastnetmon/master/src/fastnetmon_install.pl</code><code>-Ofastnetmon_install.pl</code> <code>sudo\u00a0perl\u00a0fastnetmon_install.pl</code></p> <p>F\u00f6rsta g\u00e5ngen man startar det skapas konf-filer.</p> <p><code>sudo\u00a0/opt/fastnetmon/fastnetmon\u00a0--daemonize</code></p>"},{"location":"linux_services/FastNetMon/#konfiguration","title":"Konfiguration","text":"<p>Det mesta g\u00f6rs i huvudkonf-filen.</p> <p><code>nano\u00a0/etc/fastnetmon.conf</code></p> <p>Starta i screen</p> <p><code>screen\u00a0-S\u00a0fastnetmon\u00a0-d\u00a0-m\u00a0/root/fastnetmon/fastnetmon</code></p>"},{"location":"linux_services/FastNetMon/#networks","title":"Networks","text":"<p>L\u00e4gg in dina egna IP-n\u00e4t s\u00e5 fastnetmon vet vad som \u00e4r lokalt.</p> <p><code>nano\u00a0/etc/networks_list</code> <code>10.10.0.0/24</code> <code>20.20.0.0/24</code></p>"},{"location":"linux_services/FastNetMon/#klient","title":"Klient","text":"<p>Kolla live.</p> <p><code>/opt/fastnetmon/fastnetmon_client</code></p>"},{"location":"linux_services/FastNetMon/#notify","title":"Notify","text":"<p>Default: notify_script_path = /usr/local/bin/notify_about_attack.sh Skapa script</p> <p><code>nano\u00a0/usr/local/bin/notify_about_attack.sh</code> <code>chmod\u00a0+x\u00a0/usr/local/bin/notify_about_attack.sh</code></p>"},{"location":"linux_services/FastNetMon/#netflow","title":"NetFlow","text":"<p><code>netflow_port\u00a0=\u00a02055</code> <code>netflow_host\u00a0=\u00a00.0.0.0</code> <code>netflow_sampling_ratio\u00a0=\u00a01</code></p>"},{"location":"linux_services/FastNetMon/#graphite","title":"Graphite","text":"<p>Det finns \u00e4ven integration med Graphite (och s\u00e5ledes Grafana)</p> <p><code>graphite\u00a0=\u00a0on</code> <code>graphite_host\u00a0=\u00a0127.0.0.1</code> <code>graphite_port\u00a0=\u00a02003</code></p>"},{"location":"linux_services/FastNetMon/#loggar","title":"Loggar","text":"<p><code>tail\u00a0-f\u00a0/var/log/fastnetmon.log</code></p> <p>Category:Guider</p>"},{"location":"linux_services/Flexget/","title":"Flexget","text":"<p>Flexget \u00e4r ett avancerat automatiserings program f\u00f6r att tanka hem torrents, serier, filmer mm. Det kan ta RSS-feeds, html sidor, csv-filer eller s\u00f6kmotorer som k\u00e4lla f\u00f6r att ladda hem. Det finns \u00e4ven plugins f\u00f6r vissa sidor som inte har n\u00e5gon bra feed att f\u00f6lja.</p>"},{"location":"linux_services/Flexget/#installation","title":"Installation","text":"<p>F\u00f6r att installera Flexget verifera att du har Python' 2.6.x - 2.7.x.'</p> <p><code>python -v</code></p> <p>Sedan beh\u00f6ver du pip.</p> <p><code>apt-get update &amp;&amp; apt-get install python-pip</code></p> <p>Installera sedan Flexget med kommandot.</p> <p><code>pip install flexget</code></p> <p>Verifera att Flexget \u00e4r installerat med</p> <p><code>flexget -V</code></p>"},{"location":"linux_services/Flexget/#konfiguration","title":"Konfiguration","text":"<p>Flexget anv\u00e4nder sig av en configurations fil som man skriver i YAML.</p> <p>Se Flexgets Cookbook f\u00f6r flera olika exempel p\u00e5 hur man kan skriva.</p>"},{"location":"linux_services/Flexget/#tips-n-trix","title":"Tips n Trix","text":"<p>Har du conf filen i din hemmapp m\u00e5ste du anv\u00e4nda v\u00e4xeln <code>-c</code> tex, <code>flexget -c /home/user/flexget.yml</code></p> <p>F\u00f6r att validera din conf fil att den fungerar anv\u00e4nd kommandot.</p> <p><code>flexget -c flexget.yml check</code></p> <p>F\u00f6r att k\u00f6ra flexget anv\u00e4nd kommandot</p> <p><code>flexget -c flexget.yml execute</code></p>"},{"location":"linux_services/Flexget/#crontab","title":"Crontab","text":"<p>Flexget kan b\u00e5de k\u00f6ras som en deamon och anv\u00e4nda ett inbyggt schema f\u00f6r n\u00e4r den ska kolla efter saker eller s\u00e5 kan man anv\u00e4nda crontab.</p> <p>F\u00f6r att k\u00f6ra Flexget var 30e minut.</p> <p><code>*/30 * * * * /usr/local/bin/flexget -c /root/flexget.yml execute</code></p>"},{"location":"linux_services/Flexget/#pushover","title":"Pushover","text":"<p>Pushover \u00e4r en tj\u00e4nst f\u00f6r att kunna skicka pushnotiser till din Android, IOS eller webbl\u00e4sare. Man kan f\u00e5 Flexget att skicka en pushnotis varje g\u00e5ng den laddar hem n\u00e5got f\u00f6r att inte missa nerladdningen.</p> <p>Enda man beh\u00f6ver \u00e4r n\u00e5gra f\u00e5 rader i din YAML fil och ett konto hos pushover.</p> <p><code>pushover:</code> <code>userkey:</code> <code>-\u00a0uasdfVQ</code> <code>apikey:\u00a0aasdf6</code> <code>title:\u00a0Downloading\u00a0{{series_name}}</code> <code>message:\u00a0Episode\u00a0{{series_id}}</code></p> <p>Category:Guider</p>"},{"location":"linux_services/Foreman/","title":"Foreman","text":"<p>Foreman \u00e4r ett lifecycle management tool f\u00f6r on-premise VM's, bare-metal eller i cloud hos Amazon, Google, Microsoft eller Rackspace. Foreman klarar av provisioning och configuration till orchestration och monitorering. Till hj\u00e4lp har man en Foreman Smart-Proxy som managerar TFTP, DHCP, DNS, Puppet, Puppet CA, Ansible, Salt och Chef.</p> <p>Foreman styrs med hj\u00e4lp av ett webbaserat GUI, CLI eller ett REST API och klarar av allt fr\u00e5n 1 server till 10 000 servrar.</p>"},{"location":"linux_services/Foreman/#foremans-arkitektur","title":"Foremans arkitektur","text":"<p>Foreman agerar frontend mot anv\u00e4ndarna. Smart-Proxyn f\u00f6rser tj\u00e4nster med ett API som foreman kan agera mot. 790px</p>"},{"location":"linux_services/Foreman/#installation","title":"Installation","text":"<ul> <li>#tab1|CentOS 7</li> <li>#tab2|Ubuntu 16.04</li> </ul>   B\u00f6rja med att l\u00e4gga till Puppet 5.X repot som \u00e4r det rekommenderade.  `yum\u00a0-y\u00a0install\u00a0`[`https://yum.puppetlabs.com/puppet5/puppet5-release-el-7.noarch.rpm`](https://yum.puppetlabs.com/puppet5/puppet5-release-el-7.noarch.rpm)  Installera sedan EPEL (Extra Packages for Enterprise Linux) och Foreman repot.  `yum\u00a0-y\u00a0install\u00a0`[`http://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm`](http://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm) `yum\u00a0-y\u00a0install\u00a0`[`https://yum.theforeman.org/releases/1.16/el7/x86_64/foreman-release.rpm`](https://yum.theforeman.org/releases/1.16/el7/x86_64/foreman-release.rpm)  Ladda sedan hem Foreman.  `yum\u00a0-y\u00a0install\u00a0foreman-installer` `\u00a0\u00a0`     B\u00f6rja med att l\u00e4gga till Puppet 4.X repot som \u00e4r det rekommenderade.  `apt-get\u00a0-y\u00a0install\u00a0ca-certificates` `wget\u00a0`[`https://apt.puppetlabs.com/puppet5-release-xenial.deb`](https://apt.puppetlabs.com/puppet5-release-xenial.deb) `dpkg\u00a0-i\u00a0puppet5-release-xenial.deb`  L\u00e4gg sedan till Foreman repot.  `echo\u00a0\"deb\u00a0`[`http://deb.theforeman.org/`](http://deb.theforeman.org/)`\u00a0xenial\u00a01.16\"\u00a0&gt;\u00a0/etc/apt/sources.list.d/foreman.list` `echo\u00a0\"deb\u00a0`[`http://deb.theforeman.org/`](http://deb.theforeman.org/)`\u00a0plugins\u00a01.16\"\u00a0&gt;&gt;\u00a0/etc/apt/sources.list.d/foreman.list` `apt-get\u00a0-y\u00a0install\u00a0ca-certificates` `wget\u00a0-q\u00a0`[`https://deb.theforeman.org/pubkey.gpg`](https://deb.theforeman.org/pubkey.gpg)`\u00a0-O-\u00a0|\u00a0apt-key\u00a0add\u00a0-`  Ladda sedan hem Foreman.  `apt-get\u00a0update\u00a0&amp;&amp;\u00a0apt-get\u00a0-y\u00a0install\u00a0foreman-installer` `\u00a0\u00a0`   <p>K\u00f6r sedan Foreman installer.</p> <p><code>foreman-installer\u00a0-i\u00a0\\</code> <code>--enable-foreman-compute-vmware\u00a0\\</code> <code>--enable-foreman-plugin-templates\u00a0\\</code> <code>--enable-foreman-plugin-setup\u00a0\\</code> <code>--enable-foreman-cli\u00a0\\</code> <code>--enable-foreman\u00a0\\</code> <code>--enable-foreman-proxy\u00a0\\</code> <code>--enable-puppet\u00a0\\</code> <code>--foreman-proxy-tftp=true</code></p> <p>Installationen k\u00f6rs i en non-interactive l\u00e4ge som standard. Men konfigurationen kan \u00e4ndras genom att l\u00e4gga till options fr\u00e5n foreman-installer --help. Eller s\u00e5 kan man v\u00e4lja att k\u00f6ra installern i interaktivt l\u00e4ge med foreman-installer -i.</p> <p>Installern h\u00e4r \u00f6ver \u00e4r baserad p\u00e5 en milj\u00f6 d\u00e4r DHCP och DNS sk\u00f6ts av sig sj\u00e4lvt eller genom andra system. Och Foreman kommer bara att ta hand om TFTP servern och provisionering med hj\u00e4lp av Puppet. Installerar ocks\u00e5 pluginet f\u00f6r att kunna skapa VM's p\u00e5 en vmware milj\u00f6.</p> <p>N\u00e4r installern k\u00f6rt klart s\u00e5 ska man f\u00e5 upp liknande info ruta.</p> <p><code>*\u00a0Foreman\u00a0is\u00a0running\u00a0at</code><code>https://foreman.hackernet.se</code> <code>Initial\u00a0credentials\u00a0are\u00a0admin\u00a0/\u00a03ekw5xtyXCoXxS29</code> <code>*\u00a0Foreman\u00a0Proxy\u00a0is\u00a0running\u00a0at</code><code>https://foreman.hackernet.se:8443</code> <code>*\u00a0Puppetmaster\u00a0is\u00a0running\u00a0at\u00a0port\u00a08140</code> <code>The\u00a0full\u00a0log\u00a0is\u00a0at\u00a0/var/log/foreman-installer/foreman-installer.log</code></p>"},{"location":"linux_services/FreeIPA/","title":"FreeIPA","text":"<p>FreeIPA \u00e4r ett open source projekt f\u00f6r centraliserad Identity, Policy och Auditing (IPA) f\u00f6r unix/linux-system, likt Microsofts Active Directory. I botten anv\u00e4nds 389 Directory Server f\u00f6r LDAP, MIT's Kerberos 5 f\u00f6r authentication och single sign-on, BIND f\u00f6r integrerad DNS och Samba f\u00f6r integration mot Active Directory. Man sparar l\u00f6senord och SSH-nycklar centralt som autentisering p\u00e5 \u00f6vriga maskiner kan kolla mot. Man kan skapa anv\u00e4ndargrupper och styra sudo policy centralt. Det \u00e4r sponsrat av Red Hat.</p> <p>DNS Namnuppslag m\u00e5ste fungera. T.ex. f\u00f6r en server m\u00e5ste man anv\u00e4nda fqdn och det ska vara resolvable. Det g\u00e5r att l\u00f6sa med hosts-filen i en testsetup.</p>"},{"location":"linux_services/FreeIPA/#server","title":"Server","text":""},{"location":"linux_services/FreeIPA/#installation","title":"Installation","text":"<p>Fedora</p> <p><code>sudo\u00a0dnf\u00a0-y\u00a0install\u00a0freeipa-server</code></p> <p>CentOS</p> <p><code>yum\u00a0install\u00a0ipa-server</code></p>"},{"location":"linux_services/FreeIPA/#konfiguration","title":"Konfiguration","text":"<p>Starta wizarden som automatiskt konfigurerar upp din FreeIPA med det n\u00f6dv\u00e4ndigaste.</p> <p><code>sudo\u00a0ipa-server-install</code></p> <p>K\u00f6r kommandot kinit admin s\u00e5 f\u00e5r du en kerberos ticket som du beh\u00f6ver f\u00f6r att kunna k\u00f6ra IPA tools tex ipa user-add.</p>"},{"location":"linux_services/FreeIPA/#dns-records","title":"DNS records","text":"<p>Skapa f\u00f6ljande records om du k\u00f6r en DNS server som inte FreeIPA sk\u00f6ter. Dessa records g\u00f6r att autodiscovery fungerar och g\u00f6r det mycket enklare att konfigurera upp klienter.</p> <p><code>;\u00a0ldap\u00a0servers</code> <code>_ldap._tcp\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0IN\u00a0SRV\u00a00\u00a0100\u00a0389\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0freeipa</code></p> <p><code>;kerberos\u00a0realm</code> <code>_kerberos\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0IN\u00a0TXT\u00a0HACKERNET.SE</code></p> <p><code>;\u00a0kerberos\u00a0servers</code> <code>_kerberos._tcp\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0IN\u00a0SRV\u00a00\u00a0100\u00a088\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0freeipa</code> <code>_kerberos._udp\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0IN\u00a0SRV\u00a00\u00a0100\u00a088\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0freeipa</code> <code>_kerberos-master._tcp\u00a0\u00a0\u00a0IN\u00a0SRV\u00a00\u00a0100\u00a088\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0freeipa</code> <code>_kerberos-master._udp\u00a0\u00a0\u00a0IN\u00a0SRV\u00a00\u00a0100\u00a088\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0freeipa</code> <code>_kpasswd._tcp\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0IN\u00a0SRV\u00a00\u00a0100\u00a0464\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0freeipa</code> <code>_kpasswd._udp\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0IN\u00a0SRV\u00a00\u00a0100\u00a0464\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0freeipa</code></p> <p><code>;ntp\u00a0server</code> <code>_ntp._udp\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0IN\u00a0SRV\u00a00\u00a0100\u00a0123\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0freeipa</code></p> <p><code>;\u00a0CNAME\u00a0for\u00a0IPA\u00a0CA\u00a0replicas\u00a0(used\u00a0for\u00a0CRL,\u00a0OCSP)</code> <code>ipa-ca\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0IN\u00a0A\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0IP-to-FreeIPA</code></p>"},{"location":"linux_services/FreeIPA/#brandvaggsoppningar","title":"Brandv\u00e4ggs\u00f6ppningar","text":"<p>Beroende p\u00e5 vilken dist du anv\u00e4nder kanske du inte beh\u00f6ver \u00f6ppna portar i din egna brandv\u00e4gg.</p> <p><code>firewall-cmd\u00a0--permanent\u00a0--add-service=ntp</code> <code>firewall-cmd\u00a0--permanent\u00a0--add-service=http</code> <code>firewall-cmd\u00a0--permanent\u00a0--add-service=https</code> <code>firewall-cmd\u00a0--permanent\u00a0--add-service=ldap</code> <code>firewall-cmd\u00a0--permanent\u00a0--add-service=ldaps</code> <code>firewall-cmd\u00a0--permanent\u00a0--add-service=kerberos</code> <code>firewall-cmd\u00a0--permanent\u00a0--add-service=kpasswd</code> <code>firewall-cmd\u00a0--reload</code></p>"},{"location":"linux_services/FreeIPA/#skapa-user","title":"Skapa user","text":"<p><code>ipa\u00a0user-add</code> <code>ipa\u00a0passwd</code>"},{"location":"linux_services/FreeIPA/#web-ui","title":"Web UI","text":"<p>N\u00e5s p\u00e5 https://IP-to-FreeIPA</p>"},{"location":"linux_services/FreeIPA/#replikering","title":"Replikering","text":"<p>Det g\u00e5r att replikera datan mellan servrar.</p> <p><code>ipa-replica-manage\u00a0list</code></p>"},{"location":"linux_services/FreeIPA/#system-account","title":"System account","text":"<p>Vissa LDAP tj\u00e4nster beh\u00f6ver ett f\u00f6rkonfat konto tex LDAP Autofs och sudo. Oftast s\u00e5 anv\u00e4nder man en anv\u00e4ndares uppgifter n\u00e4r man bindar mot en LDAP server men det \u00e4r inte alltid m\u00f6jligt. Anledningen till varf\u00f6r man skapar ett service konto ist\u00e4llet f\u00f6r ett vanligt anv\u00e4ndar konto \u00e4r att ett system kontot endast finns f\u00f6r att binda mot LDAP servern och \u00e4r allts\u00e5 inget POSIX konto och kan d\u00e4rf\u00f6r inte logga in mot n\u00e5gra system.</p> <p>Skapa ett system account s\u00e5 h\u00e4r:</p> <p><code>ldapmodify\u00a0-x\u00a0-D\u00a0'cn=Directory\u00a0Manager'\u00a0-W</code></p> <p><code>dn:\u00a0uid=system,cn=sysaccounts,cn=etc,dc=hackernet,dc=se</code> <code>changetype:\u00a0add</code> <code>objectclass:\u00a0account</code> <code>objectclass:\u00a0simplesecurityobject</code> <code>uid:\u00a01337</code> <code>userPassword:\u00a0secret</code> <code>passwordExpirationTime:\u00a020380119031407Z</code> <code>nsIdleTimeout:\u00a00</code> <code>^D(CTRL+D)</code>"},{"location":"linux_services/FreeIPA/#groupofuniquenames","title":"GroupOfUniqueNames","text":"<p>GroupOfUniqueNames \u00e4r en objectclass som finns i grupper, vissa program s\u00f6ker i LDAP databasen efter denna class. Bland annat VMware vCenter.</p> <p>Logga in p\u00e5 IPA WebUI g\u00e5 till IPA Server ---&gt; Configuration --&gt; Group Options --&gt; Add --&gt; Fyll i GroupOfUniqueNames --&gt; Save --&gt; Refresh.</p> <p>Skapa sedan en Posix grupp och l\u00e4gg till anv\u00e4ndarna i gruppen.</p> <p>K\u00f6r sedan f\u00f6ljande kommando f\u00f6r varje anv\u00e4ndare.</p> <p><code>ipa\u00a0group-mod</code><code>--addattr=\"uniqueMember=uid=</code><code>changeme</code><code>,cn=users,cn=accounts,dc=hackernet,dc=se\"</code>"},{"location":"linux_services/FreeIPA/#active-directory-trust","title":"Active directory trust","text":"<p>FreeIPA har st\u00f6d f\u00f6r att s\u00e4tta upp en trust med ett AD.</p> <p>Din FreeIPA dom\u00e4n och AD dom\u00e4n f\u00e5r inte vara samma f\u00f6r att det ska fungera.</p> <p>Installera AD trust paketet:</p> <p><code>yum\u00a0install\u00a0ipa-server-trust-ad</code></p> <p>K\u00f6r ipa ad trust install f\u00f6r att l\u00e4gga till n\u00f6dv\u00e4ndiga object och skapa nya DNS records:</p> <p><code>ipa-adtrust-install\u00a0--netbios-name=IPA_NETBIOS\u00a0-a\u00a0admin_password</code></p> <p>Ifall din freeipa inte kan uppdatera din DNS med nya records s\u00e5 beh\u00f6ver du skapa f\u00f6ljande annars kan du skippa detta steget:</p> <p><code>_ldap._tcp.dc._msdc.</code><code>.\u00a03600\u00a0IN\u00a0SRV\u00a00\u00a0100\u00a0389</code> <code>_kerberos._tcp.dc._msdcs.</code><code>.\u00a03600\u00a0IN\u00a0SRV\u00a00\u00a0100\u00a088</code> <code>_kerberos._udp.dc._msdcs.</code><code>.\u00a03600\u00a0IN\u00a0SRV\u00a00\u00a0100\u00a088</code> <code>_ldap._tcp.Default-First-Site-Name._sites.dc._msdcs.</code><code>.\u00a03600\u00a0IN\u00a0SRV\u00a00\u00a0100\u00a0389</code> <code>_kerberos._tcp.Default-First-Site-Name._sites.dc._msdcs.</code><code>.\u00a03600\u00a0IN\u00a0SRV\u00a00\u00a0100\u00a088</code> <code>_kerberos._udp.Default-First-Site-Name._sites.dc._msdcs.</code><code>.\u00a03600\u00a0IN\u00a0SRV\u00a00\u00a0100\u00a088</code> <p>F\u00f6r att en trust ska fungera s\u00e5 m\u00e5ste AD servern kunna sl\u00e5 upp FreeIPA dom\u00e4nen och tv\u00e4rtom. Verifiera det med f\u00f6ljande kommando.</p> <p>AD DC</p> <p><code>C:\\&gt;\u00a0nslookup</code> <code>set\u00a0type=srv</code> <code>_ldap._tcp.ad_domain</code> <code>_ldap._tcp.ipa_domain</code></p> <p>IPA server</p> <p><code>dig\u00a0SRV\u00a0_ldap._tcp.ipa_domain</code> <code>dig\u00a0SRV\u00a0_ldap._tcp.ad_domain</code></p> <p>Om det inte fungerar s\u00e5 kan man beh\u00f6va forwarda request direkt till motsvarande dom\u00e4ns dns server.</p> <p>AD DC</p> <p><code>C:\\&gt;\u00a0dnscmd\u00a0127.0.0.1\u00a0/ZoneAdd\u00a0ipa_domain\u00a0/Forwarder\u00a0ipa_ip_address</code></p> <p>IPA server</p> <ul> <li>IPA v3.x:</li> </ul> <p><code>ipa\u00a0dnszone-add\u00a0ad_domain\u00a0--name-server=ad_hostname.ad_domain\u00a0--admin-email='hostmaster@ad_domain'\u00a0--force\u00a0--forwarder=ad_ip_address\u00a0--forward-policy=only\u00a0--ip-address=ad_ip_address</code></p> <ul> <li>IPA v4.x:</li> </ul> <p><code>ipa\u00a0dnsforwardzone-add\u00a0ad_domain\u00a0--forwarder=ad_ip_address\u00a0--forward-policy=only</code></p>"},{"location":"linux_services/FreeIPA/#skapa-och-verifiera-cross-realm-trust","title":"Skapa och verifiera cross-realm trust","text":"<p><code>ipa\u00a0trust-add\u00a0--type=ad\u00a0ad_domain\u00a0--admin\u00a0Administrator\u00a0--password</code></p> <p>Vid prompt ange l\u00f6senordet till AD dom\u00e4nens Administrator konto eller ett annat konto som \u00e4r med i Domain Admins gruppen, om allt \u00e4r uppsatt korekt s\u00e5 kommer IPA att s\u00e4tta upp en two-way forest trust med AD och validera den.</p> <p>Skapa sedan en external group och en POSIX group.</p> <ul> <li>External group funkar som en container d\u00e4r dina trusted dom\u00e4n     anv\u00e4ndare finns.</li> <li>L\u00e4gg sedan till den den externa gruppen i en POSIX group s\u00e5 att dina     AD dom\u00e4n anv\u00e4ndare f\u00e5r ett group id(gid) som kan anv\u00e4ndas som     default group.</li> </ul> <p><code>ipa\u00a0group-add\u00a0--desc='ad_domain\u00a0admins\u00a0external\u00a0map'\u00a0ad_admins_external\u00a0--external</code> <code>ipa\u00a0group-add\u00a0--desc='ad_domain\u00a0admins'\u00a0ad_admins</code> <code>ipa\u00a0group-add-member\u00a0ad_admins_external\u00a0--external\u00a0'ad_netbios\\Domain\u00a0Admins'</code></p> <p>N\u00e4r den fr\u00e5gar om member user och member group s\u00e5 l\u00e4mna det blankt och tryck enter.</p> <p>L\u00e4gg sedan till den externa gruppen i posix gruppen.</p> <p><code>ipa\u00a0group-add-member\u00a0ad_admins\u00a0--groups\u00a0ad_admins_external</code></p> <p>F\u00f6r att verifera att det fungerar s\u00e5 ska det g\u00e5 att logga in p\u00e5 en IPA ansluten server med ett AD konto. N\u00e4r du ansluter till en server m\u00e5ste du ange ad_user@ad_domain som username.</p>"},{"location":"linux_services/FreeIPA/#lets-encrypt-webui-ssl","title":"Let's Encrypt webui SSL","text":"<p>F\u00f6r att kunna anv\u00e4nda Let's Encrypts certifikat med FreeIPA beh\u00f6ver man importera deras root certifikat.</p> <p>B\u00f6rja med att clona f\u00f6ljande repo.</p> <p><code>git\u00a0clone</code><code>https://github.com/Hackernet-se/freeipa-letsencrypt</code><code>&amp;&amp;\u00a0cd\u00a0freeipa-letsencrypt</code></p> <p>Importera root certen.</p> <p><code>ipa-cacert-manage\u00a0install\u00a0\"DSTRootCAX3.pem\"\u00a0-n\u00a0DSTRootCAX3\u00a0-t\u00a0C,,</code> <code>ipa-cacert-manage\u00a0install\u00a0\"LetsEncryptAuthorityX3.pem\"\u00a0-n\u00a0letsencryptx3\u00a0-t\u00a0C,,</code></p> <p>Uppdatera sedan databasen.</p> <p><code>ipa-certupdate</code></p> <p>N\u00e4r dom tv\u00e5 certifikaten \u00e4r inlagda s\u00e5 kan man importera certifikaten man f\u00e5tt fr\u00e5n Let's Encrypt.</p> <p><code>ipa-server-certinstall\u00a0-w\u00a0fullchain.pem\u00a0privkey.pem</code></p> <p>Starta sedan om http tj\u00e4nsten och dirsrv.</p> <p><code>systemctl\u00a0restart\u00a0dirsrv@REALM.service</code> <code>systemctl\u00a0restart\u00a0httpd.service</code></p>"},{"location":"linux_services/FreeIPA/#klient","title":"Klient","text":""},{"location":"linux_services/FreeIPA/#installation_1","title":"Installation","text":"<p>Varje klient m\u00e5ste ha ett fully qualified domain name. Default kerberos domain \u00e4r din dom\u00e4n, t.ex. hackernet.se.</p> <p>Ubuntu</p> <p><code>apt-get\u00a0install\u00a0freeipa-client</code></p> <p>Fedora</p> <p><code>dnf\u00a0install\u00a0freeipa-client</code></p>"},{"location":"linux_services/FreeIPA/#enroll-host-till-freeipa","title":"Enroll host till FreeIPA","text":"<p>K\u00f6r f\u00f6ljande kommando f\u00f6r att starta en wizard som enrollar din klient i freeipa.</p> <p><code>sudo\u00a0ipa-client-install</code></p> <p>Om autodiscovery fungerar som det ska s\u00e5 \u00e4r alla f\u00e4lt i fyllda och det enda du beh\u00f6ver ange \u00e4r en anv\u00e4ndare som har beh\u00f6righet att enrolla klinter till freeipa.</p> <p>Man kan fylla i anv\u00e4ndarnamn och l\u00f6senord i f\u00f6rv\u00e4g s\u00e5 slipper svara p\u00e5 fr\u00e5gor.</p> <p><code>sudo\u00a0ipa-client-install\u00a0-p\u00a0admin\u00a0-w\u00a0secretpw\u00a0--unattended\u00a0--mkhomedir</code></p>"},{"location":"linux_services/FreeIPA/#ipa-advise","title":"IPA Advise","text":"<p>Med kommandot <code>ipa-advise</code> p\u00e5 servern kan du f\u00e5 konfigurations f\u00f6rslag p\u00e5 hur du konfigurerar en klient mot freeipa om du inte har tillg\u00e5ng till ipa klienten. Category:Guider</p>"},{"location":"linux_services/GNS3/","title":"GNS3","text":"<p>GNS3 \u00e4r en programvara d\u00e4r du kan emulera n\u00e4tverks enheter s\u00e5 som Cisco routrar, Juniper brandv\u00e4ggar och Extreme switchar och mycket mera. Sedan kopplar man ihop enheterna i en topologi s\u00e5 att man kan pr\u00f6va tex nya features eller \u00f6va inf\u00f6r certifikat utan att beh\u00f6va k\u00f6pa hem riktig h\u00e5rdvara. Ska man k\u00f6ra stora labbar s\u00e5 kommer GNS3 att kr\u00e4va en hel del CPU och RAM fr\u00e5n din h\u00e5rdvara.</p> <p>GNS3 \u00e4r uppdelat i en server och en client s\u00e5 att man inte beh\u00f6ver emulera p\u00e5 sin egen laptop tex.</p>"},{"location":"linux_services/GNS3/#supported-hardvara","title":"Supported h\u00e5rdvara","text":"<p>H\u00e5rdvara som kan emuleras av GNS3 finns l\u00e4ngst ner p\u00e5 f\u00f6ljande sida:</p> <p><code>https://docs.gns3.com/1FFbs5hOBbx8O855KxLetlCwlbymTN8L1zXXQzCqfmy4/index.html</code></p>"},{"location":"linux_services/GNS3/#images","title":"Images","text":"<p>Vissa tillverkare har lagt ut images p\u00e5 n\u00e4tet som man kan tanka utan att beh\u00f6va registrera sig. Medans vissa kr\u00e4ver att man har ett konto hos dom.</p>"},{"location":"linux_services/GNS3/#cisco","title":"Cisco","text":"<p>N\u00e5gra Cisco images finns p\u00e5 denna sidan.</p> <p><code>http://commonerrors.blogspot.se/search/label/GNS3%20IOS</code></p>"},{"location":"linux_services/GNS3/#extreme-networks","title":"Extreme Networks","text":"<p><code>https://github.com/extremenetworks/Virtual_EXOS</code></p>"},{"location":"linux_services/GNS3/#installation","title":"Installation","text":"<p>Det rekommenderade s\u00e4ttet att k\u00f6ra GNS3 \u00e4r att deploya deras f\u00e4rdiga server VM och sedan ansluta mot den med clienten.</p>"},{"location":"linux_services/GNS3/#server","title":"Server","text":"<p>Ladda ner servern till den hypervisor du t\u00e4nkt anv\u00e4nda.</p> <p><code>https://gns3.com/software/download-vm</code></p> <p>Packa upp filen och deploya den.</p> <p>Default username och password \u00e4r gns3.</p>"},{"location":"linux_services/GNS3/#client","title":"Client","text":"<p>F\u00f6r att slippa registrera sig p\u00e5 deras hemsida s\u00e5 kan man tanka hem clienten via deras Github.</p> <p><code>https://github.com/GNS3/gns3-gui/releases</code></p> <p>Filen man ska tanka heter all-in-one och inneh\u00e5ller allt man beh\u00f6ver f\u00f6r att k\u00f6ra en lokal instans av GNS3 ocks\u00e5.</p> <p>Efter installationen \u00e4r klar starta GNS3 och v\u00e4lj Run everything on a remote server.</p>"},{"location":"linux_services/GNS3/#tips-n-tricks","title":"Tips n Tricks","text":""},{"location":"linux_services/GNS3/#dynamips","title":"Dynamips","text":"<p>Om dynamips kraschar testa f\u00f6ljande:</p> <ul> <li>\u00d6ka p\u00e5 m\u00e4ngden ram images har blivit tilldelad.</li> <li>Pr\u00f6va en annan image.</li> <li>Byt platform.</li> </ul> <p>Category:Guider</p>"},{"location":"linux_services/Gammu/","title":"Gammu","text":"<p>Gammu \u00e4r ett program f\u00f6r att kunna styra din mobiltelefon eller 3G modem. Gammu k\u00f6rs med kommandon men finns ocks\u00e5 webinterface att anv\u00e4nda. Gammu kan prata med enheten \u00f6ver bluetooth, usb eller serielt. Med Gammu kan du g\u00f6ra f\u00f6ljande,</p> <ul> <li>Skicka, backupa och ta emot SMS.</li> <li>Ta emot MMS.</li> <li>Visa, importera och exportera telefonboken och kalendern.</li> <li>Komma \u00e5t filsystemet.</li> <li>Visa information om telefonen och dess n\u00e4tverk.</li> <li>Lista, initiera och hantera inkommande samtal.</li> </ul>"},{"location":"linux_services/Gammu/#forberedelse","title":"F\u00f6rberedelse","text":"<p>Du beh\u00f6ver en mobil eller modem som Gammu har st\u00f6d f\u00f6r. Se deras databas.</p>"},{"location":"linux_services/Gammu/#installera","title":"Installera","text":"<p><code>apt-get\u00a0install\u00a0gammu\u00a0usb-modeswitch</code></p> <p>Usb-modeswitch beh\u00f6ver man om man ska anv\u00e4nda ett usb modem som visar sig som b\u00e5de ett usb storage och 3g modem.</p>"},{"location":"linux_services/Gammu/#konfiguration","title":"Konfiguration","text":"<p>Skriv kommandot <code>gammu-detect</code> s\u00e5 listar den en tty som den tror gammu har st\u00f6d f\u00f6r. K\u00f6r sedan <code>gammu-config</code> f\u00f6r att skapa en konfig fil mot r\u00e4tt port samt v\u00e4lja vilken drivrutin den ska anv\u00e4nda.</p> <p>Filen kommer sparas i <code>$HOME/.gammurc</code> vill du anv\u00e4nda samma fil f\u00f6r flera anv\u00e4ndare flytta den till <code>/etc/gammurc</code>.</p>"},{"location":"linux_services/Gammu/#kommandon","title":"Kommandon","text":"<p>Ta reda p\u00e5 om du beh\u00f6ver sl\u00e5 in pin eller puk kod.</p> <p><code>gammu\u00a0--getsecuritystatus</code></p> <p>Sl\u00e5 in pin eller puk kod.</p> <p><code>gammu\u00a0--entersecuritycode\u00a0PIN/PUK</code> <p>Skicka ett SMS</p> <p><code>echo\u00a0Gammu\u00a0SMS\u00a0|\u00a0gammu\u00a0sendsms\u00a0TEXT</code>"},{"location":"linux_services/Gammu/#huawei","title":"Huawei","text":"<p>F\u00f6r att f\u00e5 ig\u00e5ng ett Huawei E367 3G modem beh\u00f6vde jag anv\u00e4nda usb-modeswitch. Samma knep funkar s\u00e4kert p\u00e5 fler Huawei modem.</p> <p><code>cd\u00a0/etc/usb_modeswitch.d</code> <code>sudo\u00a0tar\u00a0xzf\u00a0/usr/share/usb_modeswitch/configPack.tar.gz\u00a012d1:1446</code> <code>sudo\u00a0sed\u00a0-i\u00a0-e\u00a0's/14ac\"/14ac,1506\"/'\u00a012d1:1446</code> <code>modprobe\u00a0usbserial\u00a0vendor=0x12d1\u00a0product=0x1506</code></p> <p>Sedan kr\u00e4vs det att man startar om eller \u00e5teransluter modemet.</p> <p>Category:Guider Category:Sparco</p>"},{"location":"linux_services/Git/","title":"Git","text":"<p>Git \u00e4r ett versionshanteringsprogram som \u00e4r gratis och open source. Det skapades 2005 f\u00f6r att hantera k\u00e4llkoden till Linuxk\u00e4rnan. Ens lokala repository best\u00e5r av tre \"trees\" som git h\u00e5ller koll p\u00e5.</p> <ul> <li>Working Directory: h\u00e5ller alla filer som man jobbar med.</li> <li>Index: \u00e4r d\u00e4r filerna mellanlandar n\u00e4r man addar dem, innan commit.</li> <li>HEAD: pekar p\u00e5 den senaste commiten man gjort.</li> </ul>"},{"location":"linux_services/Git/#overview","title":"Overview","text":"<p>"},{"location":"linux_services/Git/#installation","title":"Installation","text":"<p><code>sudo\u00a0apt-get\u00a0install\u00a0git</code></p> <p>Alternativt git-all f\u00f6r att f\u00e5 med alla subpackages.</p>"},{"location":"linux_services/Git/#usage","title":"Usage","text":"<p>CLI</p> <p><code>git\u00a0status</code> <code>git\u00a0log</code> <code>git\u00a0shortlog</code> <code>git\u00a0config\u00a0color.ui\u00a0true</code></p> <p>Det finns flera grafiska program f\u00f6r git.</p>"},{"location":"linux_services/Git/#repo","title":"Repo","text":"<p>Skapa nytt lokalt repo.</p> <p><code>mkdir\u00a0~/reponame\u00a0&amp;&amp;\u00a0cd\u00a0~/reponame</code> <code>echo\u00a0\"reponame\"\u00a0&gt;&gt;\u00a0README.md</code> <code>git\u00a0init</code> <code>git\u00a0add\u00a0README.md</code> <code>git\u00a0commit\u00a0-m\u00a0\"first\u00a0commit\"</code></p> <p>Skapa en working copy av ett lokalt repo.</p> <p><code>git\u00a0clone\u00a0/path/to/repository</code></p> <p>L\u00e4gg till \u00e4ndring till Index.</p> <p><code>git\u00a0add</code> <code>git\u00a0add\u00a0*</code> <p>Commit till HEAD, dock \u00e4r det fortfarande lokalt.</p> <p><code>git\u00a0commit\u00a0-m\u00a0\"Commit\u00a0message\"</code></p> <p>Pusha \u00e4ndring till remote repo.</p> <p><code>git\u00a0push\u00a0origin\u00a0master</code></p> <p>F\u00f6r att uppdatera det lokala repot med de senaste commitsen.</p> <p><code>git\u00a0pull</code></p>"},{"location":"linux_services/Git/#branch","title":"Branch","text":"<p>Branches anv\u00e4nds f\u00f6r att utveckla features isolerat fr\u00e5n varandra. Man kan utveckla flera branches parallellt f\u00f6r att sedan mergea tillbaka dem till Master. Master branch \u00e4r \"default\" n\u00e4r man skapar ett repo.</p> <p>Skapa en ny branch</p> <p><code>git\u00a0checkout\u00a0-b\u00a0NAME</code></p> <p>Byt till en annan branch</p> <p><code>git\u00a0checkout\u00a0NAME</code></p> <p>Kolla branches</p> <p><code>git\u00a0branch</code></p>"},{"location":"linux_services/Git/#gitignore","title":".gitignore","text":"<p>\u00c4r en fil som anv\u00e4nds f\u00f6r att man ska skydda sig s\u00e5 att man av misstag inte commitar filer man inte vill eller som \u00e4r on\u00f6diga tex swp filer, log filer, l\u00f6senord eller databas filer. Github .gitignore templates</p> <p><code>sparco@jumpgate:~/ircbot$\u00a0cat\u00a0.gitignore</code> <code>*.swp</code> <code>test.py</code> <code>__pycache__/</code> <code>config.ini</code> <code>*.log</code></p>"},{"location":"linux_services/Git/#github","title":"GitHub","text":"<p>GitHub \u00e4r en webb-baserad Git repository hosting service. Det \u00e4r gratis att skapa ett konto och man kan pusha sin kod dit f\u00f6r att dela med sig till andra.</p> <p>Author name and email address</p> <p><code>git\u00a0config\u00a0--global\u00a0user.name\u00a0\"Skeletor\"</code> <code>git\u00a0config\u00a0--global\u00a0user.email\u00a0\"user@hackernet.se\"</code></p> <p>Connect local repository to a remote server, add the server to be able to push to it</p> <p><code>git\u00a0remote\u00a0add\u00a0origin</code><code>https://github.com/user/reponame.git</code> <code>git\u00a0remote\u00a0-v</code> <code>git\u00a0push\u00a0-u\u00a0origin\u00a0master</code></p> <p>Password cache</p> <p><code>git\u00a0config\u00a0--global\u00a0credential.helper\u00a0cache</code> <code>git\u00a0config\u00a0--global\u00a0credential.helper\u00a0'cache\u00a0--timeout=3600'</code></p> <p>Klona repo fr\u00e5n GitHub</p> <p><code>git\u00a0clone</code><code>https://github.com/username/reponame.git</code></p> <p>Category:Guider</p>"},{"location":"linux_services/Gitlab/","title":"Gitlab","text":"<p>Category:Guider Gitlab \u00e4r ett webbaserad git repositry manager med bland annat en inbyggd wiki. Gitlab fungerar som Github g\u00f6r och dom erbjuder att s\u00e5 man kan hosta sin egna l\u00f6sning p\u00e5 sin egen server. Se \u00e4ven Git.</p> <p>Det finns 2 version av Gitlab:</p> <ul> <li>Gitlab CE: Community Edition.</li> <li>Gitlab EE: Enterprise Edition.</li> </ul>"},{"location":"linux_services/Gitlab/#installation","title":"Installation","text":"<p>Installera dom n\u00f6dv\u00e4ndiga paketen. Postfix kan man skippa om man har en annan mailserver.</p> <p><code>sudo\u00a0apt-get\u00a0install\u00a0curl\u00a0openssh-server\u00a0ca-certificates\u00a0postfix</code></p> <p>L\u00e4gg till Gitlab's repo och installera sedan Gitlab CE.</p> <p><code>curl\u00a0-sS</code><code>https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.deb.sh</code><code>|\u00a0sudo\u00a0bash</code> <code>sudo\u00a0apt-get\u00a0install\u00a0gitlab-ce</code></p> <p>Konfigurera sedan Gitlab och starta det.</p> <p><code>sudo\u00a0gitlab-ctl\u00a0reconfigure</code></p>"},{"location":"linux_services/Gitlab/#konfiguration","title":"Konfiguration","text":"<p>Att konfigurera \u00e4r v\u00e4ldigt enkelt. Man g\u00f6r sina \u00e4ndringar i <code>/etc/gitlab/gitlab.rb</code> efter det k\u00f6r man <code>sudo gitlab-ctl reconfigure</code> f\u00f6r att dom ska b\u00f6rja g\u00e4lla.</p>"},{"location":"linux_services/Gitlab/#https","title":"HTTPS","text":"<p>\u00c4ndra f\u00f6ljande rad:</p> <p><code>external_url\u00a0\"</code><code>https://git.hackernet.se</code><code>\"</code></p> <p>Eftersom hostnamnet \u00e4r git.hackernet.se s\u00e5 kommer gitlab leta efter private key och certificate filen som heter git.hackernet.se.key/crt under <code>/etc/gitlab/ssl/</code>.</p> <p>Om du beh\u00f6ver \u00e4ndra vart cert filerna finns och vad dom heter \u00e4ndra dessa 2 rader.</p> <p><code>nginx['ssl_certificate']\u00a0=\u00a0\"/opt/cert/fullchain.pem\"</code> <code>nginx['ssl_certificate_key']\u00a0=\u00a0\"/opt/cert/privkey.pem\"</code></p> <p>Redirect HTTP till HTTPS \u00c4ndra f\u00f6ljande rad till true.</p> <p><code>nginx['redirect_http_to_https']\u00a0=\u00a0true</code></p>"},{"location":"linux_services/Gitlab/#ldap-authentication","title":"LDAP authentication","text":"<p>F\u00f6r mer info kolla Gitlab LDAP document</p> <p><code>gitlab_rails['ldap_enabled']\u00a0=\u00a0true</code> <code>gitlab_rails['ldap_servers']\u00a0=\u00a0YAML.load\u00a0&lt;&lt;-'EOS'\u00a0#\u00a0remember\u00a0to\u00a0close\u00a0this\u00a0block\u00a0with\u00a0'EOS'\u00a0below</code> <code>main:\u00a0#\u00a0'main'\u00a0is\u00a0the\u00a0GitLab\u00a0'provider\u00a0ID'\u00a0of\u00a0this\u00a0LDAP\u00a0server</code> <code>label:\u00a0'Hackernet'</code> <code>host:\u00a0'openldap.hackernet.se'</code> <code>port:\u00a0389</code> <code>uid:\u00a0'uid'</code> <code>method:\u00a0'plain'</code> <code>bind_dn:\u00a0'&gt;ldap\u00a0bind\u00a0username&gt;'</code> <code>password:\u00a0'</code><code>'</code> <code>active_directory:\u00a0false</code> <code>allow_username_or_email_login:\u00a0true</code> <code>block_auto_created_users:\u00a0false</code> <code>base:\u00a0'</code><code>'</code> <code>user_filter:\u00a0''</code> <code>attributes:</code> <code>username:\u00a0['uid',\u00a0'userid',\u00a0'sAMAccountName']</code> <code>email:\u00a0\u00a0\u00a0\u00a0['mail',\u00a0'email',\u00a0'userPrincipalName']</code> <code>name:\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0'cn'</code> <code>first_name:\u00a0'givenName'</code> <code>last_name:\u00a0\u00a0'sn'</code> <code>##\u00a0EE\u00a0only</code> <code>group_base:\u00a0'dc=hackernet,dc=se'</code> <code>admin_group:\u00a0'cn=wiki'</code> <code>sync_ssh_keys:\u00a0false</code> <code>EOS</code> <p>G\u00f6r LDAP anv\u00e4ndare till admin F\u00f6r att g\u00f6ra en LDAP anv\u00e4ndare till admin k\u00f6r f\u00f6ljande kommando i shell:</p> <p><code>sudo\u00a0gitlab-rails\u00a0console</code> <code>u\u00a0=\u00a0User.find_by_username(\"LDAPadmin\")</code> <code>u.admin\u00a0=\u00a0true</code> <code>u.save</code> <code>exit</code></p>"},{"location":"linux_services/Gitlab/#schemalagd-backup","title":"Schemalagd backup","text":"<p>Simpel backup g\u00f6rs mha crontab och /var/opt/gitlab/backups kan sedan  iv\u00e4g till remote site. <p><code>0\u00a04\u00a0*\u00a0*\u00a07\u00a0/opt/gitlab/bin/gitlab-backup\u00a0create\u00a0CRON=1</code> <code>1\u00a04\u00a0*\u00a0*\u00a07\u00a0cp\u00a0/etc/gitlab/gitlab-secrets.json\u00a0/var/opt/gitlab/backups/\u00a0&gt;/dev/null</code> <code>1\u00a04\u00a0*\u00a0*\u00a07\u00a0cp\u00a0/etc/gitlab/gitlab.rb\u00a0/var/opt/gitlab/backups/\u00a0&gt;/dev/null</code></p> <p>Limit backup lifetime to 60 days, /etc/gitlab/gitlab.rb.</p> <p><code>gitlab_rails['backup_keep_time']\u00a0=\u00a05184000</code></p>"},{"location":"linux_services/Gitlab/#cicd","title":"CI/CD","text":"<p>I ditt gitlab repo kan du skapa en fil som heter .gitlab-ci.yml.</p> <p>Det \u00e4r i denna filen som du specificerar vad din pipeline ska g\u00f6ra.</p>"},{"location":"linux_services/Gitlab/#yaml-lint","title":"YAML Lint","text":"<p>Pipeline som kollar att du har skrivit r\u00e4tt YAML syntax i ditt repo. Funkar bra tillsammans med tex Puppet hiera config.</p> <pre><code>stages:\n - lint\n\nlint-yaml:\n  stage: lint\n  image:\n    name: cytopia/yamllint:latest\n    entrypoint: [\"/bin/ash\", \"-c\"]\n  script:\n   - yamllint -f colored .\n</code></pre> <p>Om du vill att pipelinen ska skippa vissa filer eller du vill \u00e4ndra configen s\u00e5 kan du skapa en fil i rooten p\u00e5 ditt repo som heter .yamllint.yml:</p> <pre><code>extends: default\n\nignore: |\n  .yamllint.yml\n  .gitlab-ci.yml\n\nrules:\n  # 80 chars should be enough, but don't fail if a line is longer\n  line-length:\n    max: 80\n    level: warning\n\n  # accept both     key:\n  #                   - item\n  #\n  # and             key:\n  #                 - item\n  indentation:\n    indent-sequences: whatever\n</code></pre>"},{"location":"linux_services/GlusterFS/","title":"GlusterFS","text":"<p>GlusterFS \u00e4r ett open source och skalbart network-attached storage file system som numera utvecklas av Red Hat. Genom att klustra ihop resurser (servrar, diskar, filsystem etc.) kan man bygga High-Availability storage. Varje directory som ska lagra data kallas brick och med bricks bygger man volymer. Volymer kan sp\u00e4nna \u00f6ver flera servrar och kommunikation g\u00f6rs med TCP (eller InfiniBand). Det finns Gluster Native Client f\u00f6r t.ex. linuxhostar annars g\u00e5r det att dela ut en volym med klassiska protokoll som NFS.</p> <p>Det finns olika typer av volymer. Dessa g\u00e5r \u00e4ven att kombinera f\u00f6r att skapa en distributed-replicated volume.</p> <ul> <li>Distributed Mode: kombinera alla tillg\u00e4ngliga storage-resurser     till en volym.</li> <li>Replicated Mode: spegla datan (mirror) mellan resurser, likt     RAID 1. Synchronous replication.</li> </ul> <p>L\u00e4gger man till en ny tom brick till en Distributed volym med mycket data kan man balansera ut det med kommandot gluster volume rebalance VOLNAME start. GlusterFS har inbyggd self-heal funktion i replicated mode, dvs om en brick g\u00e5r offline och filer modifieras s\u00e5 synkas det upp n\u00e4r den kommer tillbaka.</p>"},{"location":"linux_services/GlusterFS/#installation","title":"Installation","text":"<p><code>sudo\u00a0dnf/apt-get\u00a0install\u00a0glusterfs-server</code> <code>systemctl\u00a0status\u00a0glusterfs-server</code></p> <p>Klient</p> <p><code>sudo\u00a0dnf/apt-get\u00a0install\u00a0glusterfs-client</code></p> <p>Version</p> <p><code>glusterfsd\u00a0--version</code></p>"},{"location":"linux_services/GlusterFS/#konfiguration","title":"Konfiguration","text":"<p>F\u00f6r att klustra noder m\u00e5ste man peera och l\u00e4gga till enheter till trusted server pool. Detta g\u00e5r \u00e4ven g\u00f6ra med hostnamn.</p> <p><code>sudo\u00a0gluster\u00a0peer\u00a0probe\u00a010.0.0.11</code> <code>gluster\u00a0peer\u00a0status</code></p>"},{"location":"linux_services/GlusterFS/#volym","title":"Volym","text":"<p>Replicated, 2 \u00e4r antalet noder med datan.</p> <p><code>sudo\u00a0gluster\u00a0volume\u00a0create\u00a0gluster-vol\u00a0replica\u00a02\u00a010.0.0.10:/data\u00a010.0.0.11:/data</code> <code>sudo\u00a0gluster\u00a0volume\u00a0start\u00a0gluster-vol</code></p> <p>Vitlista klienter baserat p\u00e5 IP-adresser.</p> <p><code>sudo\u00a0gluster\u00a0volume\u00a0set\u00a0gluster-vol\u00a0auth.allow\u00a010.0.0.*,10.5.5.10</code></p> <p>Verify</p> <p><code>sudo\u00a0gluster\u00a0volume\u00a0status</code> <code>sudo\u00a0gluster\u00a0volume\u00a0info</code></p>"},{"location":"linux_services/GlusterFS/#klient","title":"Klient","text":"<p><code>mount.glusterfs\u00a010.0.0.10:/data\u00a0/mnt/glusterfs</code> <code>df\u00a0-h</code></p>"},{"location":"linux_services/GlusterFS/#geo-replication","title":"Geo-replication","text":"<p>GlusterFS \u00e4r designat f\u00f6r datacenter men vill man \u00f6ver t.ex. ett WAN (high latency) b\u00f6r man anv\u00e4nda geo-replication. D\u00e5 anv\u00e4nds ist\u00e4llet asynchronous och inkrementell replikering. Ena sidan \u00e4r master och andra slave. Klockorna ska vara synkade och NTP b\u00f6r anv\u00e4ndas.</p> <p><code>gluster\u00a0volume\u00a0geo-replication\u00a0[SOURCE_DATASTORE]\u00a0[REMOTE_SERVER]:[REMOTE_PATH]\u00a0start</code></p> <p>Category:Guider</p>"},{"location":"linux_services/Golang/","title":"Golang","text":"<p>Category:Guider Intro Golang \u00e4r det nya hippa spr\u00e5ket som Google har utvecklat. Det \u00e4r enkelt att l\u00e4sa som Python, snabbt och low level som C.</p> <p>Golang Concurreny</p> <p>So basically goroutines are amazing in go, they are cheap, fast and even though one might think they run in parallel they don't. So lets say that I wanna run 2k HTTP GET requests towards skooog.se. Well I can do this concurrent, but we are gonna run into several issues, one being the amount of sockets we have on our client machine.</p> <p>So sockets are expensive, goroutines aren't, this is how we solve it.</p> <pre><code> package main\n\n import (\n    \"fmt\"\n    \"io/ioutil\"\n    \"net/http\"\n    \"sync\"\n )\n\n // We need something to recover in case one goroutine fails.\n // Otherwise our whole program might crash or hang\n\n func cleanup() {\n    if r := recover(); r != nil {\n        fmt.Println(\"recovered in cleanup\", r)\n    }\n }\n\n func getURL(c chan&lt;- *http.Response, wg *sync.WaitGroup, sem chan bool, url string) {\n    defer wg.Done()\n    defer cleanup()\n    sem &lt;- true\n    data, err := http.Get(url)\n    if err != nil {\n        panic(err)\n    }\n\n    c &lt;- data\n    &lt;-sem\n\n    // Tell the waitgroup we are done\n }\n\n func main() {\n    // Declare waitgroup\n    var wg sync.WaitGroup\n\n    // Make channels with buffersize to fit all our data\n    c := make(chan *http.Response, 1000)\n\n    /*\n     We create sem to act as a buffer, because goroutines are cheap and we can use a lot, however\n     sockets aren't. So we can easily spin up 10000 of goroutines without any issues,\n     but then we will start running out of sockets to use.\n    */\n    sem := make(chan bool, 50)\n    for i := 0; i &lt; 1000; i++ {\n        // Add 1 to the queue\n        wg.Add(1)\n        go getURL(c, &amp;wg, sem, \"http://skooog.se\")\n    }\n    // Wait until every job we added is done\n    wg.Wait()\n\n    // Close channel is needed for when we use the range statement below\n    // If we don't close it range will never know when it should stop iterating,\n    // this will cause the problem to hang\n    close(c)\n    fmt.Println(\"ok\")\n\n    httpResponses := [][]byte{}\n\n    for elem := range c {\n        content, _ := ioutil.ReadAll(elem.Body)\n        //fmt.Println(string(content))\n        httpResponses = append(httpResponses, content)\n    }\n\n    for _, slice := range httpResponses {\n        fmt.Println(string(slice))\n    }\n }\n</code></pre>"},{"location":"linux_services/Google_Authenticator/","title":"Google Authenticator","text":"<p>Med Google Authenticator kan man anv\u00e4nda time-based one-time password (TOTP) tillsammans med sitt vanliga l\u00f6senord p\u00e5 sin SSH-server f\u00f6r att f\u00e5 2-faktors-autentisering. Allt sker mellan server och mobil som b\u00e5da vet n\u00e4r nycklar \u00e4r giltiga.</p>"},{"location":"linux_services/Google_Authenticator/#installation","title":"Installation","text":"<p><code>sudo\u00a0apt-get\u00a0-y\u00a0install\u00a0libpam-google-authenticator</code> <code>echo\u00a0\"#Google\u00a0Authenticator\u00a0$(date)\"\u00a0|\u00a0sudo\u00a0tee\u00a0-a\u00a0/etc/pam.d/sshd\u00a0&amp;&amp;\u00a0echo\u00a0\"auth\u00a0required\u00a0pam_google_authenticator.so\"\u00a0|\u00a0sudo\u00a0tee\u00a0-a\u00a0/etc/pam.d/sshd</code> <code>sudo\u00a0sed\u00a0-i\u00a0's/ChallengeResponseAuthentication\u00a0no/ChallengeResponseAuthentication\u00a0yes/g'\u00a0/etc/ssh/sshd_config</code> <code>sudo\u00a0service\u00a0ssh\u00a0restart</code></p>"},{"location":"linux_services/Google_Authenticator/#konfiguration","title":"Konfiguration","text":"<p>Logga in p\u00e5 det lokala konto som ska k\u00f6ra MFA.</p> <p><code>google-authenticator</code></p> <p>Svara y, starta appen och scanna qr-koden.</p> <p>Vitlista n\u00e4tverk Man kan styra om MFA ska anv\u00e4ndas eller ej beroende p\u00e5 source address p\u00e5 SSH-sessionerna. L\u00e4gg in f\u00f6ljande i /etc/pam.d/sshd ovanf\u00f6r raden auth required pam_google_authenticator.so</p> <p><code>auth\u00a0[success=1\u00a0default=ignore]\u00a0pam_access.so\u00a0accessfile=/etc/security/access-local.conf</code></p> <p><code>cat\u00a0/etc/security/access-local.conf</code> <code>+\u00a0:\u00a0ALL\u00a0:\u00a010.0.0.0/24</code> <code>+\u00a0:\u00a0ALL\u00a0:\u00a0LOCAL</code> <code>-\u00a0:\u00a0ALL\u00a0:\u00a0ALL</code></p> <p>Category:Guider</p>"},{"location":"linux_services/Grafana/","title":"Grafana","text":"<p>Grafana \u00e4r webbaserat grafverktyg. Grafana beh\u00f6ver h\u00e4mta datan som ska grafas ifr\u00e5n n\u00e5gonstans. Detta kan g\u00f6ras fr\u00e5n bl.a. influxDB, Elasticsearch, Graphite eller Prometheus.</p>"},{"location":"linux_services/Grafana/#installation","title":"Installation","text":"<p><code>echo\u00a0\"deb</code><code>https://packagecloud.io/grafana/stable/debian/</code><code>wheezy\u00a0main\"\u00a0|\u00a0sudo\u00a0tee\u00a0-a\u00a0/etc/apt/sources.list</code></p> <p>Wheezy (och andra debianversioner)</p> <p><code>sudo\u00a0apt-get\u00a0-y\u00a0install\u00a0curl</code> <code>curl</code><code>https://packagecloud.io/gpg.key</code><code>|\u00a0sudo\u00a0apt-key\u00a0add\u00a0-</code> <code>sudo\u00a0apt-get\u00a0update</code> <code>sudo\u00a0apt-get\u00a0-y\u00a0install\u00a0grafana</code></p> <p>Ubuntu</p> <p><code>curl</code><code>https://packages.grafana.com/gpg.key</code><code>|\u00a0sudo\u00a0apt-key\u00a0add\u00a0-</code> <code>sudo\u00a0add-apt-repository\u00a0\"deb</code><code>https://packages.grafana.com/oss/deb</code><code>stable\u00a0main\"</code> <code>sudo\u00a0apt-get\u00a0update\u00a0&amp;&amp;\u00a0sudo\u00a0apt-get\u00a0install\u00a0grafana</code></p>"},{"location":"linux_services/Grafana/#alternativ-installation","title":"Alternativ installation","text":"<p>Finns officiell docker-container</p> <p><code>docker\u00a0run\u00a0-i\u00a0-p\u00a03000:3000\u00a0grafana/grafana</code></p>"},{"location":"linux_services/Grafana/#konfiguration","title":"Konfiguration","text":"<p>Detta startar tj\u00e4nsten som user grafana, som skapades under installation. Default HTTP-port \u00e4r 3000 och default user \u00e4r admin med pw admin.</p> <p>Init.d</p> <p><code>sudo\u00a0service\u00a0grafana-server\u00a0start</code> <code>sudo\u00a0update-rc.d\u00a0grafana-server\u00a0defaults\u00a095\u00a010</code></p> <p>Systemd</p> <p><code>systemctl\u00a0daemon-reload</code> <code>systemctl\u00a0start\u00a0grafana-server</code> <code>systemctl\u00a0status\u00a0grafana-server</code> <code>sudo\u00a0systemctl\u00a0enable\u00a0grafana-server.service</code></p> <p>grafana.ini I grafana.ini finns systeminst\u00e4llningarna. De g\u00e5r ocks\u00e5 att se p\u00e5 http://IP:3000/admin/settings</p> <p><code>sudo\u00a0nano\u00a0/etc/grafana/grafana.ini</code></p> <p>F\u00f6rslagsvis byts l\u00f6senordet f\u00f6r admin, det kan \u00e4ven g\u00f6ras i webguit.</p> <p>Category:Guider</p>"},{"location":"linux_services/Graylog/","title":"Graylog","text":"<p>Graylog \u00e4r en syslogserver f\u00f6r att man ska kunna analysera syslog, g\u00f6ra s\u00f6kningar och se trender p\u00e5 ett st\u00e4lle. Det \u00e4r open source och \u00e4r baserat p\u00e5 Elasticsearch, Java och MongoDB. Autentisering kan kopplas till AD eller LDAP.</p> <p>Dokumentation: http://docs.graylog.org/en/2.0/</p>"},{"location":"linux_services/Graylog/#installation","title":"Installation","text":"<p>Det snabbaste s\u00e4ttet att komma ig\u00e5ng \u00e4r att ladda ner f\u00e4rdig appliance och k\u00f6ra p\u00e5 hypervisor. https://www.graylog.org/download</p> <p>Installera sj\u00e4lv, Ubuntu MongoDB</p> <pre><code>sudo apt-get update &amp;&amp; sudo apt-get -y upgrade &amp;&amp; sudo apt-key adv --keyserver keyserver.ubuntu.com --recv 7F0CEB10\necho \"deb http://repo.mongodb.org/apt/ubuntu \"$(lsb_release -sc)\"/mongodb-org/3.0 multiverse\" | sudo tee /etc/apt/sources.list.d/mongodb-org-3.0.list\nsudo apt-get update &amp;&amp; sudo apt-get -y install mongodb-org\n</code></pre> <p>Elasticsearch</p> <pre><code>sudo apt-get install software-properties-common curl &amp;&amp; sudo add-apt-repository ppa:webupd8team/java\nsudo apt-get update &amp;&amp; sudo apt-get -y install oracle-java8-installer\nwget -qO - https://packages.elastic.co/GPG-KEY-elasticsearch | sudo apt-key add -\necho \"deb http://packages.elastic.co/elasticsearch/1.7/debian stable main\" | sudo tee -a /etc/apt/sources.list.d/elasticsearch-1.7.x.list\nsudo apt-get update &amp;&amp; sudo apt-get -y install elasticsearch\nsudo sed -i -e 's\\#cluster.name: elasticsearch\\cluster.name: graylog-prod\\' /etc/elasticsearch/elasticsearch.yml\nsudo sed -i -e 's\\#network.host: 192.168.0.1\\network.host: localhost\\' /etc/elasticsearch/elasticsearch.yml\nsudo sed -i -e 's\\#discovery.zen.ping.multicast.enabled:\\discovery.zen.ping.multicast.enabled:\\' /etc/elasticsearch/elasticsearch.yml\nsudo service elasticsearch restart &amp;&amp; sudo update-rc.d elasticsearch defaults 95 10\ncurl -XGET 'http://localhost:9200/_cluster/health?pretty=true'\n</code></pre> <p>Graylog</p> <pre><code>wget https://packages.graylog2.org/repo/packages/graylog-1.3-repository-ubuntu14.04_latest.deb\nsudo dpkg -i graylog-1.3-repository-ubuntu14.04_latest.deb\nsudo apt-get update &amp;&amp; sudo apt-get -y install apt-transport-https graylog-server pwgen\nSECRET=$(pwgen -s 96 1) &amp;&amp; sudo -E sed -i -e 's/password_secret =.*/password_secret = '$SECRET'/' /etc/graylog/server/server.conf\n</code></pre> <p>Password for user admin, \u00e4ndra CHANGETHIS</p> <pre><code>PASSWORD=$(echo -n CHANGETHIS | shasum -a 256 | awk '{print $1}') &amp;&amp; sudo -E sed -i -e 's/root_password_sha2 =.*/root_password_sha2 = '$PASSWORD'/' /etc/graylog/server/server.conf\n</code></pre> <p>Graylog-konf</p> <pre><code>sudo sed -i -e 's\\#root_timezone = UTC\\root_timezone = Europe/Stockholm\\' /etc/graylog/server/server.conf\nsudo sed -i -e 's\\#rest_transport_uri = http://192.168.1.1:12900/\\rest_transport_uri = http://127.0.0.1:12900/\\' /etc/graylog/server/server.conf\nsudo sed -i -e 's/elasticsearch_shards = 4/elasticsearch_shards = 1/' /etc/graylog/server/server.conf\nsudo sed -i -e 's/#elasticsearch_cluster_name = graylog2/elasticsearch_cluster_name = graylog-prod/' /etc/graylog/server/server.conf\nsudo sed -i -e 's/#elasticsearch_discovery_zen_ping_multicast_enabled/elasticsearch_discovery_zen_ping_multicast_enabled/' /etc/graylog/server/server.conf\nsudo sed -i -e 's/#elasticsearch_discovery_zen_ping_unicast_hosts/elasticsearch_discovery_zen_ping_unicast_hosts/' /etc/graylog/server/server.conf\nsudo start graylog-server\n</code></pre> <p>Graylog-web</p> <pre><code>sudo apt-get install graylog-web\nSECRET=$(pwgen -s 96 1) &amp;&amp; sudo -E sed -i -e 's/application\\.secret=\"\"/application\\.secret=\"'$SECRET'\"/' /etc/graylog/web/web.conf\nsudo sed -i -e 's\\graylog2-server.uris=\"\"\\graylog2-server.uris=\"http://127.0.0.1:12900/\"\\' /etc/graylog/web/web.conf\nsudo start graylog-web\n</code></pre>"},{"location":"linux_services/Graylog/#konfiguration","title":"Konfiguration","text":"<p><code>http://</code><code>:9000/</code> <p>Vill man ha web ui med HTTPS kan man t.ex. l\u00e4gga det bakom en Nginx proxy.</p>"},{"location":"linux_services/Graylog/#input","title":"Input","text":"<p>System -&gt; Inputs -&gt; Syslog UDP -&gt; Launch:</p> <ul> <li>Title: syslog</li> <li>Port: 5514</li> <li>Bind address: graylog_private_IP</li> </ul> <p>Launch</p>"},{"location":"linux_services/Graylog/#port-514","title":"Port 514","text":"<p>Graylog f\u00e5r inte binda till port 514 eftersom det \u00e4r en l\u00e5gnummerport utan man f\u00e5r l\u00f6sa det med en redirect.</p> <p><code>iptables\u00a0-t\u00a0nat\u00a0-A\u00a0PREROUTING\u00a0-i\u00a0eth0\u00a0-p\u00a0udp\u00a0-m\u00a0udp\u00a0--dport\u00a0514\u00a0-j\u00a0REDIRECT\u00a0--to-ports\u00a05514</code></p>"},{"location":"linux_services/Graylog/#klienter","title":"Klienter","text":"<p>St\u00e4ll in s\u00e5 dina maskiner skickar sin syslog till  UDP 514. <p>Category:Guider</p>"},{"location":"linux_services/HashiCorp_Vault/","title":"HashiCorp Vault","text":"<p>Vault \u00e4r ett system som centralt s\u00e4krar, lagrar och kontrollerar access till tokens, passwords, certificates och API keys. Allt \u00e4r krypterat by default, b\u00e5de offline och vid transit (TLS). Vault \u00e4r server/client och har CLI, web UI samt REST JSON/HTTP API. F\u00f6r att accessa Vault s\u00e5 finns ett auth-lager med backend, t.ex. LDAP eller AD. ACLer styr vem som f\u00e5r accessa vad och allt loggas i en audit-logg. Det finns st\u00f6d f\u00f6r Dynamic secrets (short-lived).</p>"},{"location":"linux_services/HashiCorp_Vault/#installation","title":"Installation","text":"<p>Ubuntu</p> <pre><code>curl -fsSL https://apt.releases.hashicorp.com/gpg | sudo apt-key add -\nsudo apt-add-repository \"deb [arch=amd64] https://apt.releases.hashicorp.com $(lsb_release -cs) main\"\nsudo apt-get update &amp;&amp; sudo apt-get install vault\n</code></pre>"},{"location":"linux_services/HashiCorp_Vault/#server","title":"Server","text":"<p>Starta server</p> <p><code>vault\u00a0server</code> <code>vault\u00a0status</code></p>"},{"location":"linux_services/HashiCorp_Vault/#klient","title":"Klient","text":"<p><code>export\u00a0VAULT_ADDR='</code><code>http://127.0.0.1:8200</code><code>'</code> <code>export\u00a0VAULT_TOKEN=\"s.Va50wjIqgl6zHReb4aLDb\"</code></p> <p>Write simple secret</p> <p><code>vault\u00a0kv\u00a0put\u00a0secret/hello\u00a0foo=world</code></p> <p>Read secret</p> <p><code>vault\u00a0secrets\u00a0list</code> <code>vault\u00a0kv\u00a0get\u00a0secret/hello</code> <code>vault\u00a0kv\u00a0get\u00a0-format=json\u00a0secret/hello\u00a0|\u00a0jq\u00a0.</code></p>"},{"location":"linux_services/HashiCorp_Vault/#konfiguration","title":"Konfiguration","text":""},{"location":"linux_services/HashiCorp_Vault/#ldapad-login","title":"LDAP/AD login","text":"<p>Enable LDAP login</p> <p><code>vault\u00a0auth\u00a0enable\u00a0ldap</code></p> <p>Konfa LDAP pluginet</p> <p><code>vault\u00a0write\u00a0auth/ldap/config\u00a0\\</code> <code>url=\"</code><code>ldaps://ad.hackernet.se</code><code>\"\u00a0\\</code> <code>userattr=\"sAMAccountName\"\u00a0\\</code> <code>userdn=\"OU=users,DC=hackernet,DC=se\"\u00a0\\</code> <code>groupdn=\"OU=groups,DC=hackernet,DC=se\"\u00a0\\</code> <code>groupattr=\"cn\"\u00a0\\</code> <code>binddn=\"CN=</code><code>,DC=hackernet,DC=se\"\u00a0\\</code> <code>bindpass='</code><code>'\u00a0\\</code> <code>insecure_tls=false\u00a0\\</code> <code>starttls=true</code> <p>Ge en AD/LDAP grupp login r\u00e4ttigheter samt default policyn.</p> <p><code>vault\u00a0write\u00a0auth/ldap/groups/</code><code>policies=default</code>"},{"location":"linux_services/Hastebin/","title":"Hastebin","text":"<p>Hastebin anv\u00e4nds f\u00f6r att tex dela kod eller n\u00e5n log fil med n\u00e5gon. Det funkar p\u00e5 samma s\u00e4tt som Pastebin. Hastebin \u00e4r v\u00e4ldigt enkelt att anv\u00e4nda och \u00e4r stilrent. En f\u00f6rdel med hastebin \u00e4r att dom har klienter som man kan k\u00f6ra i sitt skal s\u00e5 man kan tex k\u00f6ra cat p\u00e5 en fil och output \u00e4r hastebin.</p> <p>Hackernets egna hastebin server</p>"},{"location":"linux_services/Hastebin/#installation","title":"Installation","text":"<p>Clona hastebins git repo,</p> <p><code>git\u00a0clone</code><code>https://github.com/seejohnrun/haste-server</code></p> <p>K\u00f6r sedan. Vill du \u00e4ndra n\u00e5n inst\u00e4llning i <code>config.js</code> g\u00f6r det f\u00f6re detta steget.</p> <p><code>npm\u00a0install</code> <code>npm\u00a0start</code></p>"},{"location":"linux_services/Hastebin/#konfiguration","title":"Konfiguration","text":"<p>Det finns 3 olika s\u00e4tt att lagra sina paste p\u00e5. Memcache, redis eller p\u00e5 fil.</p>"},{"location":"linux_services/Hastebin/#memcache","title":"Memcache","text":"<p>F\u00f6ruts\u00e4tter att du redan har memcache server installerat p\u00e5 samma eller en annan server.</p> <p>Du beh\u00f6ver ocks\u00e5 modulen f\u00f6r memcache.</p> <p><code>npm\u00a0install\u00a0memcache</code></p> <p>Under <code>storage</code> i <code>config.js</code> \u00e4ndra till.</p> <p><code>\"storage\":\u00a0{</code> <code>\"type\":\u00a0\"memcached\",</code> <code>\"host\":\u00a0\"127.0.0.1\",</code> <code>\"port\":\u00a011211,</code> <code>\"expire\":\u00a02592000</code> <code>},</code></p> <p>expire s\u00e4ger hur m\u00e5nga sekunder en paste ska finnas kvar sedan den senast \u00f6ppnades.</p>"},{"location":"linux_services/Hastebin/#redis","title":"Redis","text":"<p>F\u00f6ruts\u00e4tter ocks\u00e5 att du har en redis server och du beh\u00f6ver modulen f\u00f6r redis.</p> <p><code>npm\u00a0install\u00a0redis</code></p> <p>Under <code>storage</code> i <code>config.js</code> \u00e4ndra till.</p> <p><code>\"storage\":\u00a0{</code> <code>\"type\":\u00a0\"redis\",</code> <code>\"host\":\u00a0\"0.0.0.0\",</code> <code>\"port\":\u00a06379,</code> <code>\"db\":\u00a02,</code> <code>\"expire\":\u00a02592000</code> <code>},</code></p>"},{"location":"linux_services/Hastebin/#file","title":"File","text":"<p>Under <code>storage</code> i <code>config.js</code> \u00e4ndra till.</p> <p><code>\"storage\":\u00a0{</code> <code>\"type\":\u00a0\"file\",</code> <code>\"path\":\u00a0\"./data\",</code> <code>\"expire\":\u00a02592000</code> <code>},</code></p> <p>N\u00e4r du \u00e4r klar med <code>config.js</code> k\u00f6r sedan.</p> <p><code>npm\u00a0install</code> <code>npm\u00a0start</code></p> <p>Tj\u00e4nsten g\u00e5r nu att n\u00e5 p\u00e5 http://:7777"},{"location":"linux_services/Hastebin/#reverse-proxy","title":"Reverse proxy","text":"<p>L\u00e5t en reverse proxy dela ut tj\u00e4nsten tex Apache.</p> <p><code>&lt;VirtualHost\u00a0*:80&gt;</code> <code>ServerAdmin\u00a0root@hackernet.se</code> <code>ServerName\u00a0paste.hackernet.se</code></p> <p><code>&lt;IfModule\u00a0mod_proxy.c&gt;</code> <code>ProxyVia\u00a0On</code> <code>ProxyRequests\u00a0Off</code> <code>ProxyPass\u00a0/</code><code>http://127.0.0.1:7777/</code> <code>ProxyPassReverse\u00a0/</code><code>http://127.0.0.1:7777/</code> <code>ProxyPreserveHost\u00a0on</code> <code>&lt;Proxy\u00a0*&gt;</code> <code>AllowOverride\u00a0All</code> <code>Order\u00a0allow,deny</code> <code>allow\u00a0from\u00a0all</code> <code></code> <code></code></p> <p><code>ErrorLog\u00a0${APACHE_LOG_DIR}/hastebin.log</code></p> <p><code>#\u00a0Possible\u00a0values\u00a0include:\u00a0debug,\u00a0info,\u00a0notice,\u00a0warn,\u00a0error,\u00a0crit,</code> <code>#\u00a0alert,\u00a0emerg.</code> <code>LogLevel\u00a0warn</code></p> <p><code>CustomLog\u00a0${APACHE_LOG_DIR}/access.log\u00a0combined</code></p> <p></p> <p>Se till att modulerna <code>proxy</code> och <code>proxy_http</code> \u00e4r ig\u00e5ng.</p>"},{"location":"linux_services/Hastebin/#systemd-service","title":"Systemd service","text":"<p>Under <code>/etc/systemd/system</code> skapa filen <code>haste.service</code> med texten. Anpassa <code>/opt/haste-server</code> efter vart du installerat det.</p> <p><code>[Service]</code> <code>ExecStart=/usr/bin/node\u00a0/opt/haste-server/server.js</code> <code>Restart=always</code> <code>StandardOutput=syslog</code> <code>SyslogIdentifier=hastebin</code> <code>User=root</code> <code>WorkingDirectory=/opt/haste-server</code></p> <p><code>[Install]</code> <code>WantedBy=multi-user.target</code></p> <p>K\u00f6r sedan dessa 2 kommandona f\u00f6r att skapa en syml\u00e4nk och starta hastebin.</p> <p><code>systemctl\u00a0enable\u00a0/etc/systemd/system/haste.service</code> <code>systemctl\u00a0start\u00a0haste.service</code></p>"},{"location":"linux_services/Hastebin/#klient","title":"Klient","text":"<p>Dom har flera klienter f\u00f6r linux och f\u00f6r windows.</p>"},{"location":"linux_services/Hastebin/#lightweight-client","title":"Lightweight client","text":"<p>Skriv denna raden i ditt skal f\u00f6r att klienten ska fungera.</p> <p><code>haste()\u00a0{\u00a0a=$(cat);\u00a0curl\u00a0-X\u00a0POST\u00a0-s\u00a0-d\u00a0\"$a\"</code><code>https://paste.hackernet.se/documents</code><code>|\u00a0awk\u00a0-F\u00a0'\"'\u00a0'{print\u00a0\"</code><code>https://paste.hackernet.se/\"$4</code><code>}';\u00a0}</code></p> <p>F\u00f6r att anv\u00e4nda klienten skriv,</p> <p><code>cat\u00a0testfil.txt\u00a0|\u00a0haste</code></p> <p>Category:Guider</p>"},{"location":"linux_services/IPXE/","title":"IPXE","text":"<p>iPXE \u00e4r en open source network boot firmware. Funkar precis som vanliga PXE fast med en del extra features som:</p> <ul> <li>Boota fr\u00e5n web server via HTTP.</li> <li>Boota fr\u00e5n ett iSCSI SAN, AoE SAN eller Fibre channel SAN via FCoE.</li> <li>Boota fr\u00e5n Wi-Fi eller WAN koppling.</li> <li>Boota fr\u00e5n ett Infiniband n\u00e4tverk.</li> <li>Kontrollera boot processen med hj\u00e4lp av script.</li> </ul> <p>Man kan flasha in iPXE ROM filen p\u00e5 sitt n\u00e4tverkskort. Vill man inte det kan man ladda iPXE \u00f6ver TFTP med PXE. Se \u00e4ven PXE-Deploy</p>"},{"location":"linux_services/IPXE/#forberedelse","title":"F\u00f6rberedelse","text":"<p>F\u00f6r att kunna bygga iPXE fr\u00e5n source koden beh\u00f6vs f\u00f6ljande paket:</p> <ul> <li>gcc (version 3 or later)</li> <li>binutils (version 2.18 or later)</li> <li>make</li> <li>perl</li> <li>syslinux (for isolinux, only needed for building .iso images)</li> <li>liblzma or xz header files</li> <li>zlib, binutils and libiberty header files (only needed for EFI     builds)</li> </ul>"},{"location":"linux_services/IPXE/#installation","title":"Installation","text":"<p>Ladda hem senaste source koden fr\u00e5n GIT.</p> <p><code>git\u00a0clone</code><code>git://git.ipxe.org/ipxe.git</code><code>&amp;&amp;\u00a0cd\u00a0ipxe/src</code> <code>make</code></p>"},{"location":"linux_services/IPXE/#bootbar-iso","title":"Bootbar ISO","text":"<p>iPXE har en egen bootbar ISO om man vill prova snabbt och enkelt.</p>"},{"location":"linux_services/IPXE/#vmware","title":"VMware","text":"<p>Du kan byta ut VMwares PXE rom med iPXE.</p> <p>iPXE har st\u00f6d f\u00f6r f\u00f6ljande vmware nics.</p> VMware name iPXE driver name PCI vendor:device IDs iPXE ROM image e1000 intel 8086:100f 8086100f.mrom e1000e intel 8086:10d3 808610d3.mrom vlance pcnet32 1022:2000 10222000.rom vmxnet (not supported) 15ad:0720 vmxnet3 vmxnet3 15ad:07b0 15ad07b0.rom <p>B\u00f6rja med att v\u00e4lja en av dom supportade nics genom att \u00e4ndra f\u00f6ljande rad i din .vmx fil.</p> <p><code>ethernet0.virtualDev\u00a0=\u00a0\"e1000\"</code></p> <p>Ladda hem source koden och bygg filerna med f\u00f6ljande kommando.</p> <p><code>git\u00a0clone</code><code>git://git.ipxe.org/ipxe.git</code><code>&amp;&amp;\u00a0cd\u00a0ipxe/src</code> <code>make\u00a0bin/8086100f.mrom\u00a0bin/808610d3.mrom\u00a0bin/10222000.rom\u00a0bin/15ad07b0.rom</code></p> <p>Kopiera sedan \u00f6ver f\u00f6ljande filer 8086100f.mrom, 808610d3.mrom, 10222000.rom och 15ad07b0.rom till din vmware server och l\u00e4gg dom p\u00e5 tex ett datastore.</p> <p>L\u00e4gg sedan till f\u00f6ljande rader i din .vmx fil.</p> <p><code>ethernet0.opromsize\u00a0=\u00a0262144</code> <code>e1000bios.filename\u00a0=\u00a0\"/path/to/datastore/8086100f.mrom\"</code> <code>e1000ebios.filename\u00a0=\u00a0\"/path/to/datastore/808610d3.mrom\"</code> <code>nbios.filename\u00a0=\u00a0\"/path/to/datastore/10222000.rom\"</code> <code>#\u00a0nxbios.filename\u00a0=\u00a0\"\"</code> <code>nx3bios.filename\u00a0=\u00a0\"/path/to/datastore/15ad07b0.rom\"</code></p> <p>Category:Guider</p>"},{"location":"linux_services/IRedMail/","title":"IRedMail","text":"<p>Category:Guider Att s\u00e4tta upp en e-postserver \u00e4r ett relativt stort projekt. Innan du b\u00f6rjar att installera och konfigurera de n\u00f6dv\u00e4ndiga paketen p\u00e5 mailservern b\u00f6r du l\u00e4ra dig vad allt betyder och f\u00f6rst\u00e5 hur komponenterna samverkar f\u00f6r att skicka och ta emot e-post. F\u00f6r detta finns m\u00e5nga resurser p\u00e5 internet. Det finns nackdelar med att k\u00f6ra sin egna mailserver. T.ex. om en anv\u00e4ndare har gl\u00f6mt eller vill byta l\u00f6senord m\u00e5ste du fixa det. F\u00e5r du problem med spam blir din dom\u00e4n svartlistad. Du kan beh\u00f6va unik relay-konfiguration f\u00f6r att f\u00e5 det att lira ut fr\u00e5n din ISP:s n\u00e4t.</p> <p>Denna artikel behandlar en av de smidigaste kompletta maill\u00f6sningarna idag, iRedMail.</p>"},{"location":"linux_services/IRedMail/#alternativ","title":"Alternativ","text":"<p>Vill man ist\u00e4llet s\u00e4tta upp alla komponenterna manuellt rekommenderar jag att man f\u00f6ljer f\u00f6ljande guide ist\u00e4llet:</p> <p><code>https://www.linode.com/docs/email/postfix/email-with-postfix-dovecot-and-mysql</code></p> <p>Det \u00e4r den absolut b\u00e4sta postfix/dovecot/mysql-guide som finns. Teoriavsnittet \u00e4r ocks\u00e5 v\u00e4lskrivet. Att k\u00f6ra igenom denna guide \u00e4r v\u00e4ldigt l\u00e4rorikt men ganska tidskr\u00e4vande.</p>"},{"location":"linux_services/IRedMail/#installation","title":"Installation","text":"<p>Vill man ha samma komponenter och funktionalitet men en smidigare installationsprocess \u00e4r iRedMail ett utm\u00e4rkt alternativ. Man f\u00e5r \u00e4ven ett webgui f\u00f6r kontohantering Rekommenderat OS: Ubuntu 14.04 / Debian 7</p> <p><code>sudo\u00a0su\u00a0-</code> <code>mkdir\u00a0/mailroot</code> <code>wget</code><code>https://bitbucket.org/zhb/iredmail/downloads/iRedMail-0.9.2.tar.bz2</code> <code>tar\u00a0xjf\u00a0iRedMail-0.9.2.tar.bz2\u00a0&amp;&amp;\u00a0cd\u00a0iRedMail-0.9.2</code> <code>bash\u00a0iRedMail.sh</code></p> <p>K\u00f6r igenom den sj\u00e4lvf\u00f6rklarande guiden</p> <p><code>rm\u00a0/root/iRedMail-0.9.2/config</code> <code>reboot</code></p>"},{"location":"linux_services/IRedMail/#administration","title":"Administration","text":"<p>Dom\u00e4n och kontohantering g\u00f6rs med webgui.</p> <p><code>https://192.168.0.10/iredadmin</code></p> <p>Vanlig webbmail ligger p\u00e5:</p> <p><code>https://192.168.0.10</code></p>"},{"location":"linux_services/IRedMail/#spf","title":"SPF","text":""},{"location":"linux_services/IRedMail/#dkim","title":"DKIM","text":""},{"location":"linux_services/IRedMail/#rsync","title":"Rsync","text":"<p>Rsync kan anv\u00e4ndas f\u00f6r att ta backup p\u00e5 /mailroot</p>"},{"location":"linux_services/IRedMail/#loggar","title":"Loggar","text":"<p>Kolla sammanst\u00e4llning av din loggfil.</p> <p><code>pflogsumm\u00a0/var/log/mail.log</code></p>"},{"location":"linux_services/ISC_DHCP/","title":"ISC DHCP","text":"<p>Category:Guider \"ISC's DHCP software is the most widely used open source DHCP implementation on the Internet. The same software can be used for LAN too. It is a carrier and enterprise grade solution to your host configuration needs.\" - nixCraft</p> <p>Se \u00e4ven Kea DHCP.</p>"},{"location":"linux_services/ISC_DHCP/#installation","title":"Installation","text":"<p><code>sudo\u00a0apt-get\u00a0-y\u00a0install\u00a0isc-dhcp-server</code> <code>sudo\u00a0sed\u00a0-i\u00a0-r\u00a0's/INTERFACES=\"\"/INTERFACES=\"eth0\"/g'\u00a0/etc/default/isc-dhcp-server</code></p>"},{"location":"linux_services/ISC_DHCP/#konfiguration","title":"Konfiguration","text":"<p><code>sudo\u00a0dd\u00a0of=/etc/dhcp/dhcpd.conf\u00a0&lt;&lt;\u00a0EOF</code> <code>#\u00a0Uppsatt\u00a0av:</code></p> <p><code>#\u00a0You\u00a0must\u00a0prevent\u00a0the\u00a0DHCP\u00a0server\u00a0from\u00a0receiving\u00a0DNS\u00a0information</code> <code>#\u00a0from\u00a0clients,\u00a0set\u00a0the\u00a0following\u00a0global\u00a0option\u00a0(this\u00a0is\u00a0a\u00a0security\u00a0feature):</code> <code>ddns-update-style\u00a0none;</code></p> <p><code>#\u00a0You\u00a0need\u00a0to\u00a0set\u00a0your\u00a0domain\u00a0name\u00a0and\u00a0name\u00a0server:</code> <code>option\u00a0domain-name\u00a0\"exempel.se\";</code> <code>option\u00a0domain-name-servers\u00a08.8.8.8,\u00a0208.67.222.222;</code></p> <p><code>#\u00a0Increase\u00a0the\u00a0lease\u00a0time.\u00a0The\u00a0time\u00a0is\u00a0set\u00a0in\u00a0seconds:</code> <code>default-lease-time\u00a07200;</code> <code>max-lease-time\u00a014400;</code></p> <p><code>#\u00a0If\u00a0this\u00a0DHCP\u00a0server\u00a0is\u00a0the\u00a0official\u00a0DHCP\u00a0server\u00a0for\u00a0the\u00a0local</code> <code>#\u00a0network,\u00a0the\u00a0authoritative\u00a0directive\u00a0should\u00a0be\u00a0uncommented.</code> <code>#\u00a0The\u00a0authoritative\u00a0directive\u00a0indicate\u00a0that\u00a0the\u00a0DHCP\u00a0server</code> <code>#\u00a0should\u00a0send\u00a0DHCPNAK\u00a0messages\u00a0to\u00a0misconfigured\u00a0clients.</code> <code>#\u00a0If\u00a0this\u00a0is\u00a0not\u00a0done,\u00a0clients\u00a0will\u00a0be\u00a0unable\u00a0to\u00a0get\u00a0a\u00a0correct</code> <code>#\u00a0IP\u00a0address\u00a0after\u00a0changing\u00a0subnets\u00a0until\u00a0their\u00a0old\u00a0lease\u00a0has</code> <code>#\u00a0expired,\u00a0which\u00a0could\u00a0take\u00a0quite\u00a0a\u00a0long\u00a0time.</code> <code>authoritative;</code></p> <p><code>#\u00a0Use\u00a0this\u00a0to\u00a0send\u00a0dhcp\u00a0log\u00a0messages\u00a0to\u00a0a\u00a0different\u00a0log\u00a0file\u00a0(you\u00a0also</code> <code>#\u00a0have\u00a0to\u00a0hack\u00a0syslog.conf\u00a0to\u00a0complete\u00a0the\u00a0redirection).</code> <code>log-facility\u00a0local7;</code></p> <p><code>#\u00a0No\u00a0service\u00a0will\u00a0be\u00a0given\u00a0on\u00a0this\u00a0subnet,\u00a0but\u00a0declaring\u00a0it\u00a0helps\u00a0the</code> <code>#\u00a0DHCP\u00a0server\u00a0to\u00a0understand\u00a0the\u00a0network\u00a0topology.</code> <code>subnet\u00a010.0.100.0\u00a0netmask\u00a0255.255.255.0\u00a0{</code> <code>}</code></p> <p><code>#Ranges</code> <code></code> <code>subnet\u00a010.0.1.0\u00a0netmask\u00a0255.255.255.0\u00a0{</code> <code>range\u00a010.0.1.100\u00a010.0.1.200;</code> <code>option\u00a0subnet-mask\u00a0255.255.255.0;</code> <code>option\u00a0broadcast-address\u00a010.0.1.255;</code> <code>option\u00a0routers\u00a010.0.1.1;</code> <code>}</code></p> <p><code>subnet\u00a010.0.2.0\u00a0netmask\u00a0255.255.255.0\u00a0{</code> <code>range\u00a010.0.2.100\u00a010.0.2.200;</code> <code>option\u00a0subnet-mask\u00a0255.255.255.0;</code> <code>option\u00a0broadcast-address\u00a010.0.2.255;</code> <code>option\u00a0routers\u00a010.0.2.1;</code> <code>}</code></p> <p><code>##\u00a0Slut</code> <code>EOF</code></p> <p>Testa</p> <p><code>sudo\u00a0dhcpd\u00a0-t\u00a0/etc/dhcp/dhcpd.conf</code></p>"},{"location":"linux_services/Icinga/","title":"Icinga","text":"<p>Icinga \u00e4r ett forkat project av Nagios det betyder att Icinga \u00e4r bak\u00e5tkompatibel med n\u00e4stan alla Nagios plugins och add-ons skrivna f\u00f6r Nagios.</p> <p>Icinga skapades f\u00f6r att fixa brister i Nagios utveckling och f\u00f6r att l\u00e4gga till nya funktioner som ett moderna web 2.0 interface, fler st\u00f6d f\u00f6r databaser(Oracle, PostgreSQL och MySQL) och ett REST API. Dom sl\u00e4pper ocks\u00e5 patcher oftare och snabbare \u00e4n vad Nagios gjorde.</p>"},{"location":"linux_services/Icinga/#arkitektur","title":"Arkitektur","text":"<p>200px|Arkitekturen|thumb Icinga \u00e4r uppdelat i tre olika delar.</p> <p>Core sk\u00f6ter all \u00f6vervakning sparar alla resultat och data p\u00e5 IDO DBn. Den skickar ocks\u00e5 ut en alert om n\u00e5got har h\u00e4nt.</p> <p>Icinga Data Out Database (IDODB) fungerar som lagringsyta f\u00f6r all \u00f6vervakningsdata som add-ons eller webinterfacet kan h\u00e4mta.</p> <p>Icinga's user interface som h\u00e4mtar data fr\u00e5n IDODBn och visar upp resultatet. Anv\u00e4nds ocks\u00e5 f\u00f6r att skicka kommandon mot Core.</p>"},{"location":"linux_services/Icinga/#forberedelse","title":"F\u00f6rberedelse","text":"<p>L\u00e4gg till lite repon f\u00f6r att f\u00e5 senaste versionen.</p>"},{"location":"linux_services/Icinga/#repository","title":"Repository","text":""},{"location":"linux_services/Icinga/#debian","title":"Debian","text":"<p>Icinga Debian repo</p> <p><code>wget\u00a0-O\u00a0-</code><code>http://packages.icinga.org/icinga.key</code><code>|\u00a0apt-key\u00a0add\u00a0-</code> <code>echo\u00a0deb</code><code>http://packages.icinga.org/debian</code><code>icinga-jessie\u00a0main\u00a0&gt;&gt;\u00a0/etc/apt/sources.list</code> <code>echo\u00a0deb-src</code><code>http://packages.icinga.org/debian</code><code>icinga-jessie\u00a0main\u00a0&gt;&gt;\u00a0/etc/apt/sources.list</code> <code>apt-get\u00a0update</code></p> <p>Debian backports repo</p> <p><code>echo\u00a0deb</code><code>http://ftp.se.debian.org/debian/</code><code>jessie-backports\u00a0main\u00a0&gt;&gt;\u00a0/etc/apt/sources.list</code> <code>apt-get\u00a0update</code></p> <p>Debmon repo</p> <p><code>wget\u00a0-O\u00a0-</code><code>http://debmon.org/debmon/repo.key</code><code>2&gt;/dev/null\u00a0|\u00a0apt-key\u00a0add\u00a0-</code> <code>echo\u00a0'deb</code><code>http://debmon.org/debmon</code><code>debmon-jessie\u00a0main'\u00a0&gt;/etc/apt/sources.list.d/debmon.list</code> <code>apt-get\u00a0update</code></p>"},{"location":"linux_services/Icinga/#ubuntu","title":"Ubuntu","text":"<p>Icinga Ubuntu repo'</p> <p><code>wget\u00a0-O\u00a0-</code><code>http://packages.icinga.org/icinga.key</code><code>|\u00a0apt-key\u00a0add\u00a0-</code> <code>echo\u00a0deb</code><code>http://packages.icinga.org/ubuntu</code><code>icinga-trusty\u00a0main\u00a0&gt;&gt;\u00a0/etc/apt/sources.list</code> <code>echo\u00a0deb-src</code><code>http://packages.icinga.org/ubuntu</code><code>icinga-trusty\u00a0main\u00a0&gt;&gt;\u00a0/etc/apt/sources.list</code> <code>apt-get\u00a0update</code></p> <p>Icinga PPA repo</p> <p><code>add-apt-repository\u00a0ppa:formorer/icinga</code> <code>apt-get\u00a0update</code></p>"},{"location":"linux_services/Icinga/#installation","title":"Installation","text":""},{"location":"linux_services/Icinga/#core","title":"Core","text":"<p>F\u00f6r att installera Icinga2 core skriv,</p> <p><code>apt-get\u00a0install\u00a0icinga2</code></p> <p>Utan plugins vet inte Icinga hur den ska kolla en tj\u00e4nst. Enklast \u00e4r att tanka hem en f\u00e4rdig bundle med plugins.</p> <p><code>apt-get\u00a0install\u00a0nagios-plugins</code></p>"},{"location":"linux_services/Icinga/#icinga-data-out-database","title":"Icinga Data Out Database","text":"<p>Guiden utg\u00e5r ifr\u00e5n att du kommer k\u00f6ra en lokal MySQL databas.</p> <p>Installera MySQL</p> <p><code>apt-get\u00a0install\u00a0mysql-server\u00a0mysql-client</code></p> <p>Logga in och skapa en databas samt en anv\u00e4ndare med r\u00e4ttigheter.</p> <p><code>mysql\u00a0-u\u00a0root\u00a0-p</code> <code>CREATE\u00a0DATABASE\u00a0icinga;</code> <code>GRANT\u00a0SELECT,\u00a0INSERT,\u00a0UPDATE,\u00a0DELETE,\u00a0DROP,\u00a0CREATE\u00a0VIEW,\u00a0INDEX,\u00a0EXECUTE\u00a0ON\u00a0icinga.*\u00a0TO\u00a0'icinga'@'localhost'\u00a0IDENTIFIED\u00a0BY\u00a0'icinga';</code></p> <p>L\u00e4gg sedan till MySQL ido paketet. Paketet har en wizard som du kan anv\u00e4nda eller skippa och g\u00f6ra det manuellt om du vill.</p> <p><code>apt-get\u00a0install\u00a0icinga2-ido-mysql</code></p> <p>Om du vill f\u00e5 upp wizarden igen skriv <code>dpkg-reconfigure icinga2-ido-mysql</code></p> <p>F\u00f6r att ansluta manuellt anv\u00e4nd conf filen <code>/etc/icinga2/features-available/ido-mysql.conf</code> Exempel conf MySQL</p> <p>Importera MySQL schemat.</p> <p><code>mysql\u00a0-u\u00a0root\u00a0-p\u00a0icinga\u00a0&lt;\u00a0/usr/share/icinga2-ido-mysql/schema/mysql.sql</code></p> <p>Enabla featuren ido-mysql</p> <p><code>icinga2\u00a0feature\u00a0enable\u00a0ido-mysql</code></p> <p>Starta om icinga2 f\u00f6r att det ska g\u00e4lla.</p> <p><code>service\u00a0icinga2\u00a0restart</code></p>"},{"location":"linux_services/Icinga/#icingas-user-interface","title":"Icinga's user interface","text":"<p>Icinga erbjuder tre st web interface, Icinga Web 2, Icinga Web och Classic UI.</p> <p>Guiden utg\u00e5r ifr\u00e5n att du har f\u00e4rdig LAMP server. Vill du LDAP/AD koppla inlogget kr\u00e4vs PHP LDAP library.</p>"},{"location":"linux_services/Icinga/#icinga-web-2","title":"Icinga Web 2","text":"<p>Det finns tv\u00e5 s\u00e4tt att installera Web 2. F\u00f6rsta med hj\u00e4lp av repot eller andra med git. \u00d6ver repot sker m\u00e5nga steg automatiskt men du f\u00e5r kanske inte senaste versionen. Med GIT f\u00e5r du senaste versionen men f\u00e5r g\u00f6ra fler steg sj\u00e4lv.</p>"},{"location":"linux_services/Icinga/#repo","title":"Repo","text":"<p><code>apt-get\u00a0install\u00a0icingaweb2\u00a0icingacli</code></p> <p>Skapa sedan en setup token med,</p> <p><code>icingacli\u00a0setup\u00a0token\u00a0create</code></p> <p>F\u00f6r att visa den ifall du skulle gl\u00f6mma av den skriv,</p> <p><code>icingacli\u00a0setup\u00a0token\u00a0show</code></p> <p>Surfa sedan till http://ip/icingaweb2/setup f\u00f6r att f\u00f6lja wizarden.</p>"},{"location":"linux_services/Icinga/#git","title":"Git","text":"<p>B\u00f6rja med att klona repot.</p> <p><code>git\u00a0clone</code><code>git://git.icinga.org/icingaweb2.git</code></p> <p>Flytta sedan repot och g\u00e5 till dess plats.</p> <p><code>mv\u00a0icingaweb2\u00a0/usr/share/icingaweb2\u00a0&amp;&amp;\u00a0cd\u00a0/usr/share/icingaweb2</code></p> <p>Skapa en konfigurationsfil till Apache eller Nginx.</p> <p>Apache</p> <p><code>./bin/icingacli\u00a0setup\u00a0config\u00a0webserver\u00a0apache\u00a0--document-root\u00a0/usr/share/icingaweb2/public\u00a0&gt;\u00a0/etc/apache2/sites-available/icingaweb2</code> <code>a2ensite\u00a0icingaweb2</code> <code>service\u00a0apache2\u00a0restart</code></p> <p>Nginx</p> <p><code>./bin/icingacli\u00a0setup\u00a0config\u00a0webserver\u00a0nginx\u00a0--document-root\u00a0/usr/share/icingaweb2/public</code></p> <p>B\u00e5de webusern och cli usern m\u00e5ste ha tillg\u00e5ng till conf och loggar. Permissions sk\u00f6ter man med en special grupp.</p> <p><code>addgroup\u00a0--system\u00a0icingaweb2\u00a0&amp;&amp;\u00a0usermod\u00a0-a\u00a0-G\u00a0icingaweb2\u00a0www-data</code></p> <p>Skapa ett configuration directory. Default \u00e4r <code>/etc/icingaweb2</code></p> <p><code>./bin/icingacli\u00a0setup\u00a0config\u00a0directory</code></p> <p>Skapa en setup token med kommandot.</p> <p><code>./bin/icingacli\u00a0setup\u00a0config\u00a0directory</code></p> <p>Visa setup token ifall du gl\u00f6mmer bort den.</p> <p><code>./bin/icingacli\u00a0setup\u00a0token\u00a0show</code></p> <p>Surfa sedan till http:///icingaweb2/setup f\u00f6r att f\u00f6lja wizarden."},{"location":"linux_services/Icinga/#kommandon","title":"Kommandon","text":"<p>Icinga har en h\u00f6g olika CLI kommandon.</p>"},{"location":"linux_services/Icinga/#features","title":"Features","text":"<p>Kolla vilka features som \u00e4r enablat.</p> <p><code>icinga2\u00a0feature\u00a0list</code></p>"},{"location":"linux_services/Icinga/#systemctlinit","title":"systemctl/init","text":"<p><code>systemctl\u00a0status\u00a0icinga2</code> <code>/etc/init.d/icinga2\u00a0status</code></p> start The start action starts the Icinga 2 daemon. stop The stop action stops the Icinga 2 daemon. restart The restart action is a shortcut for running the stop action followed by start. reload The reload action sends the HUP signal to Icinga 2 which causes it to restart. Unlike the restart action reload does not wait until Icinga 2 has restarted. checkconfig The checkconfig action checks if the /etc/icinga2/icinga2.conf configuration file contains any errors. status The status action checks if Icinga 2 is running."},{"location":"linux_services/Icinga/#konfiguration","title":"Konfiguration","text":"|Path Description /etc/icinga2 Contains Icinga 2 configuration files. /etc/init.d/icinga2 The Icinga 2 init script. /usr/sbin/icinga2 The Icinga 2 binary. /usr/share/doc/icinga2 Documentation files that come with Icinga 2. /usr/share/icinga2/include The Icinga Template Library and plugin command configuration. /var/run/icinga2 PID file. /var/run/icinga2/cmd Command pipe and Livestatus socket. /var/cache/icinga2 status.dat/objects.cache, icinga2.debug files /var/spool/icinga2 Used for performance data spool files. /var/lib/icinga2 Icinga 2 state file, cluster log, local CA and configuration files. /var/log/icinga2 Log file location and compat/ directory for the CompatLogger feature."},{"location":"linux_services/InspIRCd/","title":"InspIRCd","text":"<p>Category:Guider InspIRCd \u00e4r en modul\u00e4r IRC server. Servern \u00e4r skriven fr\u00e5n scratch f\u00f6r att vara stabil, modern och l\u00e4ttviktigt och st\u00f6d f\u00f6r m\u00e5nga extra features som SSL st\u00f6d med GNUTLS eller OpenSSL, LDAP st\u00f6d f\u00f6r anv\u00e4ndare med mera. Servern g\u00e5r att k\u00f6ra p\u00e5 Linux, Windows, BSD och Mac OSX.</p>"},{"location":"linux_services/InspIRCd/#installation","title":"Installation","text":"<p>B\u00f6rja med att installera paket f\u00f6r att kunna kompilera servern och kunna ladda ner moduler.</p> <p><code>apt-get\u00a0install\u00a0g++\u00a0clang\u00a0libwww-perl\u00a0pkg-config</code></p> <p>Clona ner senaste stabila releasen fr\u00e5n Github.</p> <p><code>git\u00a0clone\u00a0-b\u00a0insp20</code><code>git://github.com/inspircd/inspircd.git</code></p> <p>F\u00f6r att kolla vilka extra features det finns k\u00f6r:</p> <p><code>./configure\u00a0--list-extras</code></p> <p>F\u00f6r att l\u00e4gga till en feature tex SSL st\u00f6d med GNUTLS skriv:</p> <p><code>./configure\u00a0--enable-extras=m_ssl_gnutls.cpp</code></p> <p>OpenSSL vs. GnuTLS Det har k\u00f6rts benchmarks mellan GnuTLS och OpenSSL d\u00e4r GnuTLS har varit snabbare \u00e4n OpenSSL. D\u00e4rf\u00f6r rekommenderas det att anv\u00e4nda GnuTLS som SSL module.</p> <p>Om du vill l\u00e4gga till n\u00e5n extra modul anv\u00e4nd. Det g\u00e5r ocks\u00e5 att l\u00e4gga till moduler i efterhand med modulemanager.</p> <p><code>./modulemanager</code></p> <p>N\u00e4r du \u00e4r klar k\u00f6r f\u00f6ljande kommando. Du kommer f\u00e5 en del fr\u00e5gor att svara p\u00e5. Du beh\u00f6ver inte vara root f\u00f6r att kompilera eller starta servern.</p> <p><code>./configure</code> <code>make</code> <code>make\u00a0install</code></p>"},{"location":"linux_services/InspIRCd/#konfiguration","title":"Konfiguration","text":"<p>Kopiera exempel conf filerna fr\u00e5n exempel mappen och g\u00f6r dom \u00e4ndringar du k\u00e4nner f\u00f6r.</p> <p><code>cp\u00a0modules.conf.example\u00a0../modules.conf</code> <code>cp\u00a0inspircd.conf.example\u00a0../inspircd.conf</code> <code>cp\u00a0opers.conf.example\u00a0../opers.conf</code></p>"},{"location":"linux_services/InspIRCd/#gnutls","title":"GnuTLS","text":"<p>Om du vill att klienter ska kunna k\u00f6ra SSL beh\u00f6vs f\u00f6ljande rader:</p> <p>"},{"location":"linux_services/InspIRCd/#hashade-losenord","title":"Hashade l\u00f6senord","text":"<p>F\u00f6r att anv\u00e4nda en sha256 hash i conf filerna ist\u00e4llet f\u00f6r okrypterat l\u00f6senord kr\u00e4vs f\u00f6ljande module i modules.conf laddad:</p> <p> <p>Anv\u00e4nd denna sida f\u00f6r att generera en hash.</p> <p>F\u00f6r att anv\u00e4nda en hash till n\u00e5got kr\u00e4vs denna raden inom samma block:</p> <p><code>&lt;...\u00a0hash=\"sha256\"\u00a0password=\"SecretHash\"\u00a0...&gt;</code></p>"},{"location":"linux_services/InspIRCd/#losenords-skydda-servern","title":"L\u00f6senords skydda servern","text":"<p>Om du vill l\u00f6senords skydda din IRC server s\u00e5 ange f\u00f6ljande i connect blocket:</p> <p><code>password=\"SecretPW\"</code></p>"},{"location":"linux_services/InspIRCd/#skapa-ett-operator-konto","title":"Skapa ett operator konto","text":"<p>Ett operator konto kan vara bra att ha f\u00f6r att inte tappa kontrollen eller ladda om configen p\u00e5 servern utan att beh\u00f6va starta om.</p> <p>I oper.conf anger du f\u00f6ljande rad:</p> <p> <p>F\u00f6r att bli operator skriver du f\u00f6ljande i din IRC klient till servern:</p> <p><code>/oper\u00a0Username\u00a0password</code></p>"},{"location":"linux_services/InspIRCd/#tips-n-tricks","title":"Tips n Tricks","text":"<p>Medans InspIRCd har m\u00e5nga moduler och features s\u00e5 saknar den vissa saker som att kunna registrera sitt nickname, skydda sin kanal mot takeovers och andra bra och ha IRC tj\u00e4nster.</p> <p>D\u00e4rf\u00f6r kan man beh\u00f6va anv\u00e4nda sig av Shalt\u00fare IRC services.</p>"},{"location":"linux_services/Jumpgate/","title":"Jumpgate","text":"<p>En jumpgate kan anv\u00e4ndas f\u00f6r att \u00f6ka s\u00e4kerheten men ocks\u00e5 f\u00f6r att f\u00f6renkla maskinhantering genom att ha ett enda st\u00e4lle man loggar in p\u00e5 och kan managera \u00f6vriga resurser.</p>"},{"location":"linux_services/Jumpgate/#grundlaggande","title":"Grundl\u00e4ggande","text":"<p>Grundl\u00e4ggande f\u00f6r en jumpgate \u00e4r att ha en kompetent terminal multiplexer, t.ex Tmux.</p>"},{"location":"linux_services/Jumpgate/#screen","title":"Screen","text":"<pre><code>sudo apt-get update &amp;&amp; sudo apt-get upgrade &amp;&amp; sudo apt-get -y install screen\n\ncat &lt;&lt;'__EOF__'&gt;&gt; .screenrc\ndefscrollback 10000\nterm xterm-256color\ntermcapinfo xterm* ti@:te@\naltscreen on\nnethack on\nhardstatus alwayslastline\nshelltitle 'bash'\nhardstatus string '%{gk} %H [%{wk}%?%-Lw%?%{=b kR}(%{W}%n*%f %t%?(%u)%?%{=b kR})%{= w}%?%+Lw%?%? %{g} ] %{W}'\nscreen -t $ 0\nscreen -t $ 1 htop\nscreen -t bash 2\nselect 0\n__EOF__\n</code></pre> <p>\u00c4nnu mer grundl\u00e4ggande \u00e4r att ha en automagisk screen som alltid st\u00e4ller upp vid login.</p> <pre><code>cat &lt;&lt;'__EOF__'&gt;&gt; .bashrc\nif [ -z \"$STARTED_SCREEN\" ] &amp;&amp; [ -n \"$SSH_TTY\" ]\nthen\n case $- in\n   (*i*)\n     STARTED_SCREEN=1; export STARTED_SCREEN\n     mkdir -p -- \"$HOME/lib/screen-logs\"\n     screen -R -D -S main  ||\n       echo \"Screen failed! continuing with normal bash startup\"\n esac\nfi\n__EOF__\n</code></pre>"},{"location":"linux_services/Jumpgate/#tmux","title":"Tmux","text":"<p><code>sudo\u00a0apt-get\u00a0update\u00a0&amp;&amp;\u00a0sudo\u00a0apt-get\u00a0upgrade\u00a0&amp;&amp;\u00a0sudo\u00a0apt-get\u00a0-y\u00a0install\u00a0tmux</code></p> <p>Attacha automatiskt till din tmux session vid inloggning.</p> <pre><code>if  -z \"$TMUX\" ; then\n   tmux has-session &amp;&gt; /dev/null\n   if [ $? -eq 1 ]; then\n     exec tmux new\n     exit\n   else\n     exec tmux attach\n     exit\n   fi\nfi\n</code></pre> <p>Keep-Alive H\u00e5ll SSH-sessioner vid liv genom att skicka ett litet paket med j\u00e4mna mellanrum.</p> <p><code>echo\u00a0\"\u00a0\u00a0\u00a0\u00a0ServerAliveInterval\u00a0120\"\u00a0|\u00a0sudo\u00a0tee\u00a0-a\u00a0/etc/ssh/ssh_config</code></p>"},{"location":"linux_services/Jumpgate/#ssh-autentisering","title":"SSH Autentisering","text":"<p>F\u00f6r att g\u00f6ra inloggning mot andra maskiner smidigare kan man anv\u00e4nda sig av SSH-nycklar som autentisering. Och f\u00f6r att g\u00f6ra det mindre smidigt se Google Authenticator.</p> <p>F\u00f6rst m\u00e5ste man skaffa sig nyckelpar man kan distribuera till \u00f6vriga hostar. Detta g\u00f6rs endast en g\u00e5ng.</p> <p><code>ssh-keygen\u00a0-t\u00a0rsa\u00a0-b\u00a04096</code> <code>ssh-keygen\u00a0-t\u00a0ecdsa\u00a0-b\u00a0521</code> <code>ssh-keygen\u00a0-t\u00a0ed25519</code></p> <p>Sedan skicka ut nyckeln till hostarna med:</p> <p><code>ssh-copy-id\u00a0192.168.0.10</code></p> <p>Om ssh-copy-id ej finns tillg\u00e4ngligt</p> <p><code>cat\u00a0~/.ssh/id_rsa.pub\u00a0|\u00a0ssh\u00a0user@192.168.0.10\u00a0\"mkdir\u00a0-p\u00a0~/.ssh\u00a0&amp;&amp;\u00a0cat\u00a0&gt;&gt;\u00a0~/.ssh/authorized_keys\"</code></p> <p>Alternativt skicka med den vid automatiserad PXE-installation.</p>"},{"location":"linux_services/Jumpgate/#anvandarnamn","title":"Anv\u00e4ndarnamn","text":"<p>F\u00f6r att slippa skriva olika anv\u00e4ndarnamn beroende p\u00e5 host kan man l\u00e4gga in dem s\u00e5 de autoanv\u00e4nds vid anslutning.</p> <p><code>dd\u00a0of=~/.ssh/config\u00a0&lt;&lt;\u00a0EOF</code> <code>Host\u00a0server1</code> <code>User\u00a0root</code></p> <p><code>Host\u00a0192.168.0.1</code> <code>User\u00a0elnacho</code></p> <p><code>Host\u00a0fw02</code> <code>User\u00a0admin</code> <code>ServerAliveInterval\u00a060</code> <code>EOF</code></p>"},{"location":"linux_services/Jumpgate/#login-notification","title":"Login Notification","text":"<p>Sshd kan trigga script via PAM, t.ex. om man vill f\u00e5 en notis i slack n\u00e4r n\u00e5gon loggar in p\u00e5 en server.</p> <pre><code>echo \"#sshd login notify slack, $(date)\" | sudo tee -a /etc/pam.d/sshd &amp;&amp; \\\necho \"session  optional  pam_exec.so  /usr/sbin/sshd-login_notify-slack.sh\" | sudo tee -a /etc/pam.d/sshd\nsudo dd of=/usr/sbin/sshd-login_notify-slack.sh &lt;&lt; EOF\n#!/bin/bash\nif [ \"$PAM_TYPE\" != \"close_session\" ]; then\n    WEBHOOK_URL=\"https://hooks.slack.com/services/0FTBMMLJ/EWUYGN2J/aGq3nW2PjrNcPdhxxx\"\n    SERVER=\"$(hostname)\"\n    PAYLOAD=\" { \\\"text\\\": \\\"$PAM_USER logged in to $SERVER from remote host: $PAM_RHOST.\\\" }\"\n    curl -X POST -H 'Content-Type: application/json' -d \"$PAYLOAD\" \"$WEBHOOK_URL\"\nfi\nexit\nEOF\nsudo chmod +x /usr/sbin/sshd-login_notify-slack.sh\n</code></pre> <p>Testa</p> <p><code>PAM_USER=test\u00a0PAM_RHOST=1.2.3.4\u00a0PAM_TYPE=open_session\u00a0/usr/sbin/sshd-login_notify-slack.sh</code></p>"},{"location":"linux_services/Jumpgate/#bastion","title":"Bastion","text":"<p>En bastion fungerar som en reverse proxy f\u00f6r SSH-servrar. Komponenten som beh\u00f6vs \u00e4r SSH Agent Forwarding och finns inbyggt i OpenSSH. F\u00f6r att g\u00f6ra hoppet genom proxyn transparent m\u00e5ste SSH-nycklar anv\u00e4ndas f\u00f6r autentisering. DNS-uppslag p\u00e5 alla maskiner m\u00e5ste fungera.</p> <p>500px</p> <p><code>nano\u00a0~/.ssh/config</code> <code>Host\u00a0inside-server</code> <code>ProxyJump\u00a0bastion</code></p> <p><code>Host\u00a0bastion</code> <code>User\u00a0basse</code> <code>IdentityFile\u00a0~/.ssh/ed25519</code> <code>ForwardAgent\u00a0yes</code></p>"},{"location":"linux_services/Jumpgate/#bashrc","title":".bashrc","text":"<p>.bashrc \u00e4r en fil som k\u00f6rs varje g\u00e5ng bash laddas. I denna filen kan du skriva egna kommandon som du kan k\u00f6ra i kommandoprompten.</p> <p>Extract Skriv <code>extract</code> f\u00f6r att packa upp en fil. <pre><code> extract () {\n    if [ -f $1 ] ; then\n        case $1 in\n            *.tar.bz2)   tar xvjf $1    ;;\n            *.tar.gz)    tar xvzf $1    ;;\n            *.bz2)       bunzip2 $1     ;;\n            *.rar)       unrar x $1       ;;\n            *.gz)        gunzip $1      ;;\n            *.tar)       tar xvf $1     ;;\n            *.tbz2)      tar xvjf $1    ;;\n            *.tgz)       tar xvzf $1    ;;\n            *.zip)       unzip $1       ;;\n            *.Z)         uncompress $1  ;;\n            *.7z)        7z x $1        ;;\n            *)           echo \"don't know how to extract '$1'...\" ;;\n        esac\n    else\n        echo \"'$1' is not a valid file!\"\n    fi\n  }\n</code></pre> <p>Category:Guider</p>"},{"location":"linux_services/KVM/","title":"KVM","text":"<p>Kernel-based Virtual Machine \u00e4r en kernelmodul f\u00f6r h\u00e5rdvaruaccelerering och med hj\u00e4lp av Quick EMUlator blir det en type-1 hypervisor. QEMU sj\u00e4lv \u00e4r en type-2 hypervisor.</p>"},{"location":"linux_services/KVM/#installation","title":"Installation","text":"<p>Pre-requisites Intel CPU</p> <p><code>egrep\u00a0'(vmx)'\u00a0/proc/cpuinfo</code></p> <p>Installera</p> <p><code>dnf\u00a0groupinfo\u00a0virtualization</code> <code>dnf\u00a0groupinstall\u00a0\"Virtualization\"</code></p>"},{"location":"linux_services/KVM/#usage","title":"Usage","text":"<p>GUI</p> <p><code>virt-manager</code></p> <p>CLI</p> <p><code>virsh\u00a0list</code> <code>virsh\u00a0net-list</code></p> <p>Top</p> <p><code>virt-top</code></p> <p>OVA Nyare versioner av KVM/QEMU har st\u00f6d f\u00f6r vmdk. Packa upp och anv\u00e4nd sedan vmdk:n.</p> <p><code>tar\u00a0-xf\u00a0Appliance.ova</code></p> <p>Kickstart Skapa vm med kickstartfil</p> <p><code>virt-install\u00a0-x\u00a0ks=filename.ks</code></p> <p>Migration Requirements: CPU type, time sync, shared storage</p> <p><code>virsh\u00a0migrate\u00a0--live\u00a0TestVM\u00a0qemu+ssh://test2.example.com/system</code></p> <p>Category:Guider</p>"},{"location":"linux_services/Kea/","title":"Kea","text":"<p>Kea \u00e4r den nya DHCPv4/DHCPv6-servern fr\u00e5n ISC och \u00e4r en ers\u00e4ttare f\u00f6r ISC DHCP. M\u00e5let \u00e4r att skapa en dhcp server med h\u00f6g performance och utbyggbar med extensions f\u00f6r enterprises eller service providers.</p> <p>Features</p> <ul> <li>Fullt fungerande DHCPv4, DHCPv6 och Dynamic DNS server.</li> <li>OpenSSL support.</li> <li>Leases finns sparat i CSV fil, MySQL eller Postgres.</li> <li>On-Line configuration.</li> <li>Statistics</li> <li>API</li> </ul>"},{"location":"linux_services/Kea/#installation","title":"Installation","text":"<p><code>apt-get\u00a0install\u00a0build-essential\u00a0libssl-dev\u00a0libboost-dev\u00a0libboost-system-dev\u00a0make\u00a0liblog4cplus-dev</code> <code>wget</code><code>http://ftp.isc.org/isc/kea/1.0.0/kea-1.0.0.tar.gz</code><code>&amp;&amp;\u00a0tar\u00a0-xvf\u00a0kea-1.0.0.tar.gz</code> <code>cd\u00a0kea-1.0.0</code> <code>./configure\u00a0--prefix=/</code> <code>make</code> <code>make\u00a0install</code></p> <p>Ubuntu</p> <p><code>sudo\u00a0apt-get\u00a0install\u00a0kea-dhcp4-server</code></p> <p>Fedora</p> <p><code>dnf\u00a0install\u00a0kea</code></p>"},{"location":"linux_services/Kea/#konfiguration","title":"Konfiguration","text":"<p>G\u00f6rs i filen <code>/etc/kea/kea.conf</code>. En lista p\u00e5 DHCP options finns bland kea's egna dokumentation.</p> <p><code>#\u00a0Kea\u00a0DHCP\u00a0conf\u00a0by\u00a0Hackernet.se</code></p> <p><code>{</code> <code>#\u00a0DHCPv4\u00a0configuration\u00a0starts\u00a0in\u00a0this\u00a0line</code> <code>\"Dhcp4\":\u00a0{</code></p> <p><code>#\u00a0Global\u00a0values</code> <code>\"valid-lifetime\":\u00a04000,</code> <code>\"renew-timer\":\u00a01000,</code> <code>\"rebind-timer\":\u00a02000,</code></p> <p><code>#\u00a0Next\u00a0we\u00a0setup\u00a0the\u00a0interfaces\u00a0to\u00a0be\u00a0used\u00a0by\u00a0the\u00a0server.</code> <code>\"interfaces-config\":\u00a0{</code> <code>\"interfaces\":\u00a0[\u00a0\"eth0\"\u00a0]</code> <code>},</code></p> <p><code>#\u00a0And\u00a0we\u00a0specify\u00a0the\u00a0type\u00a0of\u00a0lease\u00a0database</code> <code>\"lease-database\":\u00a0{</code> <code>\"type\":\u00a0\"memfile\",</code> <code>\"persist\":\u00a0true,</code> <code>\"name\":\u00a0\"/var/kea/dhcp4.leases\"</code> <code>},</code></p> <p><code>#\u00a0Global\u00a0options</code> <code>\"option-data\":\u00a0[</code> <code>{</code> <code>\"name\":\u00a0\"domain-name-servers\",</code> <code>\"data\":\u00a0\"192.168.1.10,\u00a010.240.100.100\"</code> <code>},</code> <code>{</code> <code>\"name\":\u00a0\"tftp-server-name\",</code> <code>\"data\":\u00a0\"192.168.1.200\"</code> <code>},</code> <code>{</code> <code>\"code\":\u00a067,</code> <code>\"data\":\u00a0\"pxelinux.0\"</code> <code>},</code> <code>],</code></p> <p><code>#Some\u00a0clients\u00a0use\u00a0siaddr\u00a0field\u00a0in\u00a0the\u00a0DHCPv4\u00a0packet,\u00a0therefore\u00a0use\u00a0following\u00a0command.</code> <code>\"next-server\":\u00a0\"192.168.1.200\",</code></p> <p><code>#\u00a0List\u00a0subnets\u00a0where\u00a0we\u00a0will\u00a0be\u00a0leasing\u00a0addresses.</code> <code>\"subnet4\":\u00a0[</code> <code>{</code> <code>\"subnet\":\u00a0\"10.240.100.0/24\",</code> <code>\"pools\":\u00a0[\u00a0{\u00a0\"pool\":\u00a0\"10.240.100.20\u00a0-\u00a010.240.100.100\"\u00a0}\u00a0],</code> <code>\"option-data\":\u00a0[</code> <code>{</code> <code>\"name\":\u00a0\"routers\",</code> <code>\"data\":\u00a0\"10.240.100.1\"</code> <code>},</code> <code>{</code> <code>\"code\":\u00a015,</code> <code>\"data\":\u00a0\"hackernet.se\"</code> <code>},</code> <code>]</code> <code>}</code> <code>]</code></p> <p><code>#\u00a0DHCPv4\u00a0configuration\u00a0ends\u00a0with\u00a0this\u00a0line</code> <code>},</code></p> <p><code>\"Logging\":\u00a0{</code> <code>\"loggers\":\u00a0[</code> <code>{</code> <code>\"name\":\u00a0\"kea-dhcp4\",</code> <code>\"output_options\":\u00a0[</code> <code>{</code> <code>\"output\":\u00a0\"/var/log/kea4.log\",</code> <code>\"maxsize\":\u00a020480</code> <code>}</code> <code>],</code> <code>\"severity\":\u00a0\"INFO\",</code> <code>},</code> <code>]</code> <code>}</code></p> <p><code>}</code></p> <p>Verify</p> <p><code>systemctl\u00a0status\u00a0kea-dhcp4-server.service</code> <code>cat\u00a0/var/kea/dhcp4.leases</code></p> <p>Category:Guider</p>"},{"location":"linux_services/LAMP/","title":"LAMP","text":"<p>LAMP, \u00e4ven kallat LAMP-stack \u00e4r en vanlig open-source webbplatform som vanligtvis best\u00e5r av:</p> <ul> <li>Linux</li> <li>Apache HTTP Server</li> <li>MariaDB / MySQL</li> <li>PHP, Perl, eller Python</li> </ul> <p>Man kan \u00e4ven anv\u00e4nda sig av andra kombinationer f\u00f6r att uppn\u00e5 en liknande webbplatform. Tex:</p> <ul> <li>Byta ut Apache mot nginx     och d\u00e5 kallas det f\u00f6r LEMP-stack ist\u00e4llet.</li> <li>Anv\u00e4nda sig av en annan RDBMS som Postgresql eller SQLite.</li> </ul> <p>Flera stora hemsidor anv\u00e4nder idag LAMP som sin platform, stora akt\u00f6rer \u00e4r bl.a: Wikipedia, MediaWiki och Wordpress.</p> <p>Category:Guider</p>"},{"location":"linux_services/LUKS/","title":"LUKS","text":"<p>Linux Unified Key Setup \u00e4r standarden f\u00f6r h\u00e5rddiskkryptering i Linux.</p>"},{"location":"linux_services/LUKS/#cryptsetup","title":"Cryptsetup","text":"<p>cryptsetup \u00e4r ett verktyg som krypterar/avkrypterar blockenheter i realtid baserat p\u00e5 dm-crypt kernelmodulen.</p> <p><code>apt-get\u00a0install\u00a0cryptsetup</code> <code>yum\u00a0install\u00a0cryptsetup-luks</code></p>"},{"location":"linux_services/LUKS/#nuke","title":"Nuke","text":"<p>Vill man radera sin data v\u00e4ldigt snabbt oavsett m\u00e4ngd kan man s\u00e4tta upp en kill-switch.</p> <p><code>cryptsetup\u00a0luksAddNuke\u00a0/dev/sda5</code></p>"},{"location":"linux_services/LXD/","title":"LXD","text":"<p>LXD \u00e4r en container hypervisor f\u00f6r Linux. Det \u00e4r byggt utifr\u00e5n LXC. Man skapar containrar utifr\u00e5n images.</p>"},{"location":"linux_services/LXD/#installation","title":"Installation","text":"<p>16.04</p> <p><code>sudo\u00a0apt-get\u00a0-y\u00a0install\u00a0lxd</code></p> <p>Version</p> <p><code>lxd\u00a0--version</code></p>"},{"location":"linux_services/LXD/#images","title":"Images","text":"<p>Kolla tillg\u00e4ngliga k\u00e4llor f\u00f6r images.</p> <p><code>lxc\u00a0remote\u00a0list</code></p> <p>Lista tillg\u00e4ngliga images fr\u00e5n en viss k\u00e4lla.</p> <p><code>lxc\u00a0image\u00a0list\u00a0images:</code></p> <p>H\u00e4mta images</p> <p><code>sudo\u00a0lxc\u00a0image\u00a0copy\u00a0images:/ubuntu/trusty/amd64\u00a0local:\u00a0--alias=trusty-amd64</code> <code>sudo\u00a0lxc\u00a0image\u00a0list</code></p>"},{"location":"linux_services/LXD/#container","title":"Container","text":"<p>Starta container utifr\u00e5n image.</p> <p><code>lxc\u00a0launch\u00a0trusty-amd64\u00a0Test</code> <code>lxc\u00a0list</code></p>"},{"location":"linux_services/LXD/#remote-hosts","title":"Remote Hosts","text":"<p>Man kan med lxc-kommandot managera containrar p\u00e5 andra LXD-hostar.</p> <p>Allow management on remote machine</p> <p><code>lxc\u00a0config\u00a0set\u00a0core.https_address\u00a0[::]</code> <code>lxc\u00a0config\u00a0set\u00a0core.trust_password\u00a0PASSWORD</code></p> <p>Control</p> <p><code>lxc\u00a0remote\u00a0add\u00a0hostA</code> <code>lxc\u00a0exec\u00a0hostA:containername\u00a0--\u00a0apt-get\u00a0update</code> <p>Category:Guider</p>"},{"location":"linux_services/Let%27s_Encrypt/","title":"Let's Encrypt","text":"<p>Let\u2019s Encrypt \u00e4r en certificate authority som \u00e4r gratis, automatiserad och \u00f6ppen. Det \u00e4r ett initiativ av Internet Security Research Group som backas upp av en m\u00e4ngd stora f\u00f6retag d\u00e4r m\u00e5let \u00e4r att tillhandah\u00e5lla TLS helt gratis. Underliggande s\u00e4kra protokoll som anv\u00e4nds \u00e4r nyutvecklat och g\u00e5r under namnet ACME (Automated Certificate Management Environment) och anv\u00e4nds f\u00f6r att underl\u00e4tta verifiering av dom\u00e4nnamn. Detta har varit kr\u00e5ngligt tidigare d\u00e5 E-post och dylikt har anv\u00e4nds f\u00f6r SSL/TLS-certifikat.</p>"},{"location":"linux_services/Let%27s_Encrypt/#forberedelse","title":"F\u00f6rberedelse","text":"<ul> <li>\u00d6ppna port 80 mot servern.(Let's encrypt startar en python     webbserver som anv\u00e4nds f\u00f6r att verifiera att du \u00e4ger dom\u00e4nen)</li> </ul>"},{"location":"linux_services/Let%27s_Encrypt/#installation","title":"Installation","text":"<p>BETA. Denna guiden baseras p\u00e5 beta dokumentation och kan komma att \u00e4ndras n\u00e4r Let's encrypt sl\u00e4pps f\u00f6r alla.</p> <p><code>git\u00a0clone</code><code>https://github.com/letsencrypt/letsencrypt</code><code>&amp;&amp;\u00a0cd\u00a0letsencrypt</code></p>"},{"location":"linux_services/Let%27s_Encrypt/#konfiguration","title":"Konfiguration","text":"<p><code>./letsencrypt-auto\u00a0--agree-dev-preview\u00a0--server</code><code>https://acme-v01.api.letsencrypt.org/directory</code><code>auth</code></p> <p>Du kommer sedan f\u00e5 en fr\u00e5ga vilken mail som ska anv\u00e4ndas och vilka dom\u00e4ner du vill skapa ett cert f\u00f6r. F\u00f6r att kunna signa ett cert under beta perioden m\u00e5ste du f\u00e5tt din dom\u00e4n whitelistad. Certen skapas under <code>/etc/letsencrypt</code>. I live mappen finns symlink till senaste versionen av ett certifikat.</p> privkey.pem Din privata nykel, m\u00e5ste h\u00e5llas hemlig s\u00e5 ingen kan komma \u00e5t den. cert.pem Server certifikatet. chain.pem Alla certificat som en webbl\u00e4sare beh\u00f6ver utom server certificate. fullchain.pem Samma som chain.pem fast med server certificate ocks\u00e5."},{"location":"linux_services/Let%27s_Encrypt/#webroot","title":"Webroot","text":"<p>Webroot \u00e4r ett plugin som till\u00e5ter din server att validera din dom\u00e4n utan att stoppa webbserverm. Plugin l\u00e4gger en liten dold fil i document root p\u00e5 webbservern, den kan sedan l\u00e4sas av Let's Encrypt CA f\u00f6r att verifiera dom\u00e4nen.</p> <p><code>./letsencrypt-auto\u00a0certonly\u00a0-a\u00a0webroot\u00a0--agree-tos\u00a0--renew-by-default\u00a0--webroot-path=/var/www/html\u00a0-d\u00a0hackernet.se\u00a0-d\u00a0www.hackernet.se</code></p>"},{"location":"linux_services/Let%27s_Encrypt/#auto-renewal","title":"Auto-renewal","text":"<p>Finns inte inbyggt \u00e4n.</p>"},{"location":"linux_services/Let%27s_Encrypt/#tips-n-tricks","title":"Tips n Tricks","text":""},{"location":"linux_services/Let%27s_Encrypt/#cipherlist","title":"Cipherlist","text":"<p>Chiperlist \u00e4r en hemsida som har olika konfigurations exemplar f\u00f6r olika tj\u00e4nster med s\u00e4kerhet i fokus.</p>"},{"location":"linux_services/Let%27s_Encrypt/#signa-bakom-reverse-proxy","title":"Signa bakom reverse proxy","text":"<p>Om du anv\u00e4nder dig av en reverse proxy och vill signa med hj\u00e4lp av webroot kan man i apache g\u00f6ra att Let's encrypts anrop inte skickas vidare. Utan ist\u00e4llet g\u00e5r till en lokal mapp d\u00e4r din Let's encrypt klient lagt den dolda filen.</p> <p><code>Alias\u00a0/.well-known\u00a0/var/www/.well-known</code> <code>ProxyPass\u00a0/.well-known\u00a0!</code></p> <p>Category:Guider</p>"},{"location":"linux_services/LibreNMS/","title":"LibreNMS","text":"<p>LibreNMS \u00e4r ett \u00f6vervaknings verktyg f\u00f6r n\u00e4tverks tj\u00e4nster. LibreNMS g\u00e5r att intergrera med bla Rancid och Oxidized. LibreNMS har auto-discovery, plugins, API, och en IRC bot f\u00f6r att ta reda p\u00e5 status via IRC. Du kan autha dig mot bla MySQL(Default), LDAP eller HTTP f\u00f6r att f\u00e5 SSO st\u00f6d. LibreNMS \u00f6vervakar enheter med hj\u00e4lp av SNMP ,ping, check_mk_agent eller med hj\u00e4lp av Nagios plugins. LibreNMS \u00e4r en fork av Observium.</p>"},{"location":"linux_services/LibreNMS/#forberedelser","title":"F\u00f6rberedelser","text":"<p>Du beh\u00f6ver en fungerande MySQL databas och en Apache med PHP.</p>"},{"location":"linux_services/LibreNMS/#mysql","title":"MySQL","text":"<p>LibreNMS har inte st\u00f6d f\u00f6r MySQL strict mode \u00e4n, d\u00e4rf\u00f6r m\u00e5ste det st\u00e4ngas av.</p> <p>\u00d6ppna:</p> <p><code>vim\u00a0/etc/mysql/mysql.conf.d/mysqld.cnf</code></p> <p>L\u00e4gg till f\u00f6ljande inom [mysqld] delen:</p> <p><code>innodb_file_per_table=1</code> <code>sql-mode=\"\"</code></p> <p>Och starta om MySQL servern.</p>"},{"location":"linux_services/LibreNMS/#webserver","title":"Webserver","text":"<p>Installera f\u00f6ljande paket: Ubuntu 16.04</p> <p><code>apt-get\u00a0install\u00a0libapache2-mod-php7.0\u00a0php7.0-cli\u00a0php7.0-mysql\u00a0php7.0-gd\u00a0php7.0-snmp\u00a0php-pear\u00a0php7.0-curl\u00a0snmp\u00a0graphviz\u00a0php7.0-mcrypt\u00a0php7.0-json\u00a0apache2\u00a0fping\u00a0imagemagick\u00a0whois\u00a0mtr-tiny\u00a0nmap\u00a0python-mysqldb\u00a0snmpd\u00a0php-net-ipv4\u00a0php-net-ipv6\u00a0rrdtool\u00a0git</code></p> <p>I filerna <code>/etc/php/7.0/apache2/php.ini</code> och <code>/etc/php/7.0/cli/php.ini</code> se till att date.timezone \u00e4r satt till din tidszon. Se PHP tidszoner vad som st\u00f6ds.</p> <p>K\u00f6r f\u00f6ljande kommandon f\u00f6r att enable och disable n\u00e5gra php och apache moduler.</p> <p><code>a2enmod\u00a0php7.0</code> <code>a2dismod\u00a0mpm_event</code> <code>a2enmod\u00a0mpm_prefork</code> <code>phpenmod\u00a0mcrypt</code></p>"},{"location":"linux_services/LibreNMS/#skapa-librenms-anvandaren","title":"Skapa LibreNMS anv\u00e4ndaren","text":"<p><code>useradd\u00a0librenms\u00a0-d\u00a0/opt/librenms\u00a0-M\u00a0-r</code> <code>usermod\u00a0-a\u00a0-G\u00a0librenms\u00a0www-data</code></p>"},{"location":"linux_services/LibreNMS/#installation","title":"Installation","text":"<p>Clona ner repot.</p> <p><code>cd\u00a0/opt\u00a0&amp;&amp;\u00a0git\u00a0clone</code><code>https://github.com/librenms/librenms.git</code><code>librenms</code></p>"},{"location":"linux_services/LibreNMS/#webinterface","title":"Webinterface","text":"<p><code>cd\u00a0/opt/librenms</code> <code>mkdir\u00a0rrd\u00a0logs</code> <code>chmod\u00a0775\u00a0rrd</code> <code>vim\u00a0/etc/apache2/sites-available/librenms.conf</code></p> <p>L\u00e4gg in f\u00f6ljande rader:</p> <p><code>&lt;VirtualHost\u00a0*:80&gt;</code> <code>DocumentRoot\u00a0/opt/librenms/html/</code> <code>ServerName\u00a0\u00a0librenms.example.com</code> <code>CustomLog\u00a0/opt/librenms/logs/access_log\u00a0combined</code> <code>ErrorLog\u00a0/opt/librenms/logs/error_log</code> <code>AllowEncodedSlashes\u00a0NoDecode</code> <code>&lt;Directory\u00a0\"/opt/librenms/html/\"&gt;</code> <code>Require\u00a0all\u00a0granted</code> <code>AllowOverride\u00a0All</code> <code>Options\u00a0FollowSymLinks\u00a0MultiViews</code> <code></code> </p> <p>S\u00e4tt LibreNMS anv\u00e4ndaren som \u00e4gare av mappen:</p> <p><code>chown\u00a0-R\u00a0librenms:librenms\u00a0/opt/librenms</code></p> <p>Aktivera sidan och rewrite module och starta om apache.</p> <p><code>a2ensite\u00a0librenms.conf</code> <code>a2enmod\u00a0rewrite</code> <code>service\u00a0apache2\u00a0restart</code></p> <p>Om detta \u00e4r den enda sidan du hostar gl\u00f6m inte st\u00e4nga av default sidan.</p> <p><code>a2dissite\u00a0000-default.conf</code></p>"},{"location":"linux_services/LibreNMS/#snmpd","title":"Snmpd","text":"<p>Kopiera exempel filen fr\u00e5n LibreNMS och ers\u00e4tt raden <code>RANDOMSTRINGGOESHERE</code> med din egna commmunity str\u00e4ng:</p> <p><code>cp\u00a0/opt/librenms/snmpd.conf.example\u00a0/etc/snmp/snmpd.conf</code> <code>vim\u00a0/etc/snmp/snmpd.conf</code></p> <p>Starta om snmp servicen:</p> <p><code>service\u00a0snmpd\u00a0restart</code></p>"},{"location":"linux_services/LibreNMS/#cronjob","title":"Cronjob","text":"<p>L\u00e4gg till cronjob scriptet som sk\u00f6ter discovery, alerts och \u00f6vervakningen.</p> <p><code>cp\u00a0librenms.nonroot.cron\u00a0/etc/cron.d/librenms</code></p>"},{"location":"linux_services/LibreNMS/#web-installer","title":"Web installer","text":"<p>G\u00e5 sedan till http://librenms.example.com/install.php och g\u00e5 igenom stegen.</p>"},{"location":"linux_services/LibreNMS/#konfiguration","title":"Konfiguration","text":"<p>Scripten finns under /opt/librenms. Och mycket av konfigurationen g\u00f6rs direkt i <code>config.php</code> som ocks\u00e5 finns under /opt/librenms.</p>"},{"location":"linux_services/LibreNMS/#lagga-till-device","title":"L\u00e4gga till device","text":"<p>Kan g\u00f6ras via web interfacet under Devices &gt; Add device</p> <p>Eller fr\u00e5n CLI med addhost.php scriptet.</p> <p><code>php\u00a0addhost.php</code>"},{"location":"linux_services/LibreNMS/#irc-bot","title":"IRC Bot","text":"<p>L\u00e4gg in f\u00f6ljande rader i <code>config.php</code></p> <p><code>...</code> <code>$config['irc_host']\u00a0=\u00a0\"irc.freenode.org\";</code> <code>$config['irc_port']\u00a0=\u00a06667;</code> <code>$config['irc_chan']\u00a0=\u00a0\"#librenms,#otherchan,#noc\";</code> <code>...</code></p> <p>Om servern du vill ansluta mot k\u00f6r SSL s\u00e5 kan du ange ett + f\u00f6re porten.</p> <p><code>...</code> <code>$config['irc_port']\u00a0=\u00a0\"+6667\";</code> <code>...</code></p> <p>Om servern har ett l\u00f6senord:</p> <p><code>$config['irc_pass']\u00a0=\u00a0\"Passphrase123\";</code></p> <p>F\u00f6r att \u00e4ndra namn fr\u00e5n LibreNMS till n\u00e5got annat:</p> <p><code>$config['irc_nick']\u00a0=\u00a0\"NotLibreNMSbot\"</code></p>"},{"location":"linux_services/LibreNMS/#systemd-service","title":"Systemd service","text":"<p><code>cat\u00a0&lt;&lt;'__EOF__'&gt;/etc/systemd/system/librenms-irc-bot.service</code> <code>[Unit]</code> <code>Description=IRC\u00a0bot\u00a0for\u00a0LibreNMS</code> <code>After=network.target</code></p> <p><code>[Service]</code> <code>ExecStart=/usr/bin/php\u00a0/opt/librenms/irc.php</code> <code>User=librenms</code> <code>Group=librenms</code></p> <p><code>[Install]</code> <code>WantedBy=multi-user.target</code> <code>__EOF__</code></p> <p>K\u00f6r sedan f\u00f6ljande kommando f\u00f6r att enable tj\u00e4nsten vid omstart och f\u00f6r att starta tj\u00e4nsten.</p> <p><code>systemctl\u00a0enable\u00a0librenms-irc-bot.service\u00a0&amp;&amp;\u00a0systemctl\u00a0start\u00a0librenms-irc-bot.service</code></p>"},{"location":"linux_services/LibreNMS/#irc-kommandon","title":"IRC kommandon","text":"<p>Note: Det g\u00e5r bara att autha sig mot boten om man anv\u00e4nder MySQL som inloggning. LDAP st\u00f6d \u00e4r f\u00f6rhoppningsvis p\u00e5v\u00e4g se issue p\u00e5 LibreNMS Github.</p> Kommando Beskrivning .auth  : Requsta auth token. : Authar sig. Man m\u00e5ste autha sig f\u00f6r att kunna anv\u00e4nda boten. .device  Ger basic info om hosten. .down Listar alla hostnamn som \u00e4r nere. .help Tillg\u00e4ngliga kommandon. .join  Joinar en kanal om anv\u00e4ndaren har admin-level. .listdevices Listar hostnamnet p\u00e5 alla k\u00e4nda devices. .log [] Listar N linje ur eventlogen. .port  Listar info relaterat till porten. .quit Boten disconnectar fr\u00e5n IRC. .reload Reloadar konfigurationen. .status  Listar status info fr\u00e5n den valda typen. En type kan vara devices, services, ports. F\u00f6rkortning: dev, srv, prt. .version Printar <code>$this-&gt;config['project_name_version']</code>"},{"location":"linux_services/LibreNMS/#ldap","title":"LDAP","text":"<p>Kr\u00e4ver att paketet <code>php-ldap</code> \u00e4r installerat. L\u00e4gg in f\u00f6ljande rader i <code>config.php</code></p> <p><code>$config['auth_mechanism']\u00a0=\u00a0\"ldap\";</code></p> <p><code>$config['auth_ldap_version']\u00a0=\u00a03;\u00a0#\u00a0v2\u00a0or\u00a0v3</code> <code>$config['auth_ldap_server']\u00a0=\u00a0\"ldap.example.com\";</code> <code>$config['auth_ldap_port']\u00a0\u00a0\u00a0=\u00a0389;</code> <code>$config['auth_ldap_prefix']\u00a0=\u00a0\"uid=\";</code> <code>$config['auth_ldap_suffix']\u00a0=\u00a0\",ou=People,dc=example,dc=com\";</code> <code>$config['auth_ldap_group']\u00a0\u00a0=\u00a0\"cn=groupname,ou=groups,dc=example,dc=com\";</code></p> <p><code>$config['auth_ldap_groupbase']\u00a0=\u00a0\"ou=group,dc=example,dc=com\";</code> <code>$config['auth_ldap_groups']['admin']['level']\u00a0=\u00a010;</code> <code>$config['auth_ldap_groups']['noc']['level']\u00a0=\u00a05;</code> <code>$config['auth_ldap_groupmemberattr']\u00a0=\u00a0\"memberUid\";</code></p>"},{"location":"linux_services/LibreNMS/#user-levels","title":"User levels","text":"<ul> <li>1: Normal anv\u00e4ndare. Kr\u00e4ver att en admin tilldelar devices och     portar som dessa f\u00e5r l\u00e4sa.</li> <li>5: F\u00e5r l\u00e4sa allt om alla devices.</li> <li>10: Admin konto som f\u00e5r skriva och l\u00e4sa.</li> <li>11: Demo konto. Samma som 10 fast f\u00e5r inte ta bort devices.</li> </ul>"},{"location":"linux_services/LibreNMS/#auto-discovery","title":"Auto discovery","text":"<p>Det finns st\u00f6d f\u00f6r att automatiskt l\u00e4gga till devices. F\u00f6r att det ska fungera m\u00e5ste man ange en default SNMP community f\u00f6r v1, v2c eller v3, man m\u00e5ste ocks\u00e5 st\u00e4lla in vilka subnet som \u00e4r ens egna. Discovery k\u00f6rs var 6h och inom 5 minuter om det \u00e4r en ny enhet. Man m\u00e5ste ocks\u00e5 ha minst en enhet tillagd f\u00f6re auto discovery funkar. Om LibreNMS hittar en enhet s\u00e5 f\u00f6rs\u00f6ker den g\u00f6ra ett reverse uppslag mot DNS f\u00f6r att f\u00e5 namnet p\u00e5 devicen. Om det inte g\u00e5r s\u00e5 kommer den heller inte l\u00e4gga till devicen, detta \u00e4r inst\u00e4llt default men g\u00e5r att st\u00e4nga av.</p>"},{"location":"linux_services/LibreNMS/#konfiguration_1","title":"Konfiguration","text":"<p>B\u00f6rja med att s\u00e4tta SNMP community eller anv\u00e4ndarnamn &amp; l\u00f6senord om du k\u00f6r v3:</p> <p><code>//\u00a0v1\u00a0or\u00a0v2c</code> <code>$config['snmp']['community'][]\u00a0=\u00a0\"my_custom_public\";</code> <code>$config['snmp']['community'][]\u00a0=\u00a0\"another_public\";</code></p> <p><code>//\u00a0v3</code> <code>$config['snmp']['v3'][0]['authlevel']\u00a0=\u00a0'AuthPriv';</code> <code>$config['snmp']['v3'][0]['authname']\u00a0=\u00a0'my_username';</code> <code>$config['snmp']['v3'][0]['authpass']\u00a0=\u00a0'my_password';</code> <code>$config['snmp']['v3'][0]['authalgo']\u00a0=\u00a0'MD5';</code> <code>$config['snmp']['v3'][0]['cryptopass']\u00a0=\u00a0'my_crypto';</code> <code>$config['snmp']['v3'][0]['cryptoalgo']\u00a0=\u00a0'AES';</code></p> <p>Ange vilka subn\u00e4t som \u00e4r dina:</p> <p><code>$config['nets'][]\u00a0=\u00a0'192.168.0.0/16';</code> <code>$config['nets'][]\u00a0=\u00a0'172.16.0.0/12';</code></p> <p>Det g\u00e5r \u00e4ven att utesluta n\u00e4tverk om man vill:</p> <p><code>$config['autodiscovery']['nets-exclude'][]\u00a0=\u00a0'192.168.1.0/24';</code></p>"},{"location":"linux_services/LibreNMS/#discovery-methods","title":"Discovery methods","text":"<p>Det finns fyra stycken alternativ f\u00f6r att l\u00e4gga till devices och en manuell.</p> <p>ARP</p> <p>Disable by default.</p> <p>Kan sl\u00e5s p\u00e5 med f\u00f6ljande kommando:</p> <p><code>$config['discovery_modules']['discovery-arp']\u00a0=\u00a01;</code></p> <p>XDP</p> <p>Enabled by default.</p> <p>F\u00f6r att st\u00e4nga av:</p> <p><code>$config['autodiscovery']['xdp']\u00a0=\u00a0false;</code></p> <p>XDP inkluderar FDP, CDP och LLDP.</p> <p>OSPF</p> <p>Enabled by default.</p> <p>F\u00f6r att st\u00e4nga av:</p> <p><code>$config['autodiscovery']['ospf']\u00a0=\u00a0false;</code></p> <p>BGP</p> <p>Enabled by default.</p> <p>F\u00f6r att st\u00e4nga av:</p> <p><code>$config['autodiscovery']['bgp']\u00a0=\u00a0false;</code></p> <p>SNMP Scan</p> <p>Denna metod m\u00e5ste du starta sj\u00e4lv. Om den bara k\u00f6rs direkt utan v\u00e4xlar s\u00e5 kommer den scanna n\u00e4ten i din config fil. Med v\u00e4xeln -r kan du s\u00e4ga till vilket n\u00e4t den ska skanna.</p> <p><code>snmp-scan.php\u00a0-r\u00a0172.22.0.0/24</code></p>"},{"location":"linux_services/LibreNMS/#korta-hostnamn","title":"Korta hostnamn","text":"<p>Om dina devices vid en SNMP fr\u00e5ga svarar med sitt hostnamn ist\u00e4llet f\u00f6r FQDN kan du l\u00e4gga p\u00e5 din dom\u00e4n med f\u00f6ljande kommando:</p> <p><code>$config['mydomain']\u00a0=\u00a0'hackernet.se';</code></p>"},{"location":"linux_services/LibreNMS/#lagg-till-device-med-ip","title":"L\u00e4gg till device med IP","text":"<p>Utifall LibreNMS inte kan g\u00f6ra reverse uppslag mot DNS s\u00e5 kommer inte devicen att l\u00e4ggas till. Det g\u00e5r att st\u00e4nga av s\u00e5 att den l\u00e4ggs till \u00e4nd\u00e5 fast med IP ist\u00e4llet.</p> <p><code>$config['discovery_by_ip']\u00a0=\u00a0true;</code></p>"},{"location":"linux_services/LibreNMS/#nagios-plugins","title":"Nagios plugins","text":"<p>LibreNMS kan k\u00f6ra Nagios plugins som inte anv\u00e4nder Nagios NRPE klient.</p> <p>B\u00f6rja med att s\u00e4tta p\u00e5 services i LibreNMS och peka ut vart Nagios scripten ligger.</p> <p><code>$config['show_services']\u00a0=\u00a01;</code> <code>$config['nagios_plugins']\u00a0\u00a0\u00a0=\u00a0\"/usr/lib/nagios/plugins\";</code></p> <p>Installera nagios-snmp-plugins paketet om du vill ha ett n\u00e5gra f\u00e4rdiga script som fungerar.</p> <p><code>apt-get\u00a0install\u00a0nagios-snmp-plugins</code></p> <p>I webbinterfacet s\u00e5 finns nu en ny knapp som heter Services d\u00e4r man kan l\u00e4gga till vilken service som ska k\u00f6ras p\u00e5 vilken host.</p> <p>Ett tips \u00e4r att k\u00f6ra scripten med -h p\u00e5 i skalet s\u00e5 att man ser vilka parametrar man beh\u00f6ver st\u00e4lla in f\u00f6r att det ska fungera.</p> <p>P\u00e5 Nagios Exchange finns ett stort antal plugins att ladda hem.</p>"},{"location":"linux_services/LibreNMS/#overvakning","title":"\u00d6vervakning","text":"<p>LibreNMS har st\u00f6d f\u00f6r att \u00f6vervaka n\u00e5gra standard tj\u00e4nster direkt fr\u00e5n start med hj\u00e4lp av snmp eller med deras klient check_mk.</p> <p>Dessa \u00e4r n\u00e5gra av tj\u00e4nsterna det finns st\u00f6d f\u00f6r och hur dom \u00f6vervakas:</p> <ul> <li>Apache - Agent, extend SNMP</li> <li>BIND9/named - Agent</li> <li>MySQL - Agent, extend SNMP</li> <li>NGINX - extend SNMP</li> <li>NTPD - Agent, extend SNMP,</li> <li>PowerDNS - Agent, extend SNMP</li> <li>PowerDNS Recursor - Agent, extend SNMP</li> <li>TinyDNS/djbdns - Agent</li> <li>OS Updates - extend SNMP</li> <li>DHCP Stats - extend SNMP</li> <li>Memcached - Agent, extend SNMP</li> <li>Unbound - Agent</li> <li>Proxmox - extend SNMP</li> <li>Raspberry PI - extend SNMP</li> </ul>"},{"location":"linux_services/LibreNMS/#agent-installation","title":"Agent installation","text":"<p>Agenten pratar default p\u00e5 port 6556/TCP.</p> <p>Clona librenms-agent repot:</p> <p><code>cd\u00a0/opt/</code> <code>git\u00a0clone</code><code>https://github.com/librenms/librenms-agent.git</code> <code>cd\u00a0librenms-agent</code></p> <p>Kopiera check_mk_agent filen och g\u00f6r den k\u00f6rbar:</p> <p><code>cp\u00a0check_mk_agent\u00a0/usr/bin/check_mk_agent\u00a0&amp;&amp;\u00a0chmod\u00a0+x\u00a0/usr/bin/check_mk_agent</code></p> <p>Skapa f\u00f6ljande mappar d\u00e4r du sedan ska l\u00e4gga scripten till tj\u00e4nsterna du vill ha grafer p\u00e5.</p> <p><code>mkdir\u00a0-p\u00a0/usr/lib/check_mk_agent/plugins\u00a0/usr/lib/check_mk_agent/local</code></p> <p>Kopiera scripten fr\u00e5n agent-local mappen till /usr/lib/check_mk_agent/local och g\u00f6r dom k\u00f6rbara med chmod +x</p> <p>Kopiera sedan systemd filen och g\u00f6r att den startar vid boot och starta agenten.</p> <p><code>cp\u00a0check_mk@.service\u00a0check_mk.socket\u00a0/etc/systemd/system</code> <code>systemctl\u00a0enable\u00a0check_mk.socket\u00a0&amp;&amp;\u00a0systemctl\u00a0start\u00a0check_mk.socket</code></p> <p>F\u00f6r att agenten ska fungera s\u00e5 m\u00e5ste man s\u00e4tta p\u00e5 unix-agent under modules p\u00e5 varje device i web interfacet. Och enable dom tj\u00e4nsterna man vill \u00f6vervaka under application.</p>"},{"location":"linux_services/LibreNMS/#mysql_1","title":"MySQL","text":"<p>MySQL scriptet kr\u00e4ver en extra konfigurationsfil med anv\u00e4ndarnamn och l\u00f6senord till databasen som ska \u00f6vervakas.</p> <p>Skapa f\u00f6ljande fil /usr/lib/check_mk_agent/local/mysql.cnf med inneh\u00e5llet:</p> <p><code>&lt;?php</code> <code>$mysql_user\u00a0=\u00a0'root';</code> <code>$mysql_pass\u00a0=\u00a0'toor';</code> <code>$mysql_host\u00a0=\u00a0'localhost';</code> <code>$mysql_port\u00a0=\u00a03306;</code></p> <p>Verifera att scriptet fungerar genom att k\u00f6ra</p> <p><code>/usr/lib/check_mk_agent/local/mysql</code></p> <p>L\u00e4gg sedan in en extend rad i /etc/snmp/snmpd.conf:</p> <p><code>extend\u00a0mysql\u00a0/usr/lib/check_mk_agent/local/mysql</code></p>"},{"location":"linux_services/LibreNMS/#nginx","title":"NGINX","text":"<p>Nginx kr\u00e4ver att status sidan \u00e4r aktiverad f\u00f6r localhost.</p> <p><code>location\u00a0/nginx-status\u00a0{</code> <code>stub_status\u00a0on;</code> <code>access_log\u00a0\u00a0\u00a0off;</code> <code>allow\u00a0127.0.0.1;</code> <code>deny\u00a0all;</code> <code>}</code></p> <p>Verifera att scriptet fungerar genom att k\u00f6ra</p> <p><code>/usr/lib/check_mk_agent/local/nginx</code></p> <p>L\u00e4gg sedan in en extend rad i /etc/snmp/snmpd.conf:</p> <p><code>extend\u00a0nginx\u00a0/usr/lib/check_mk_agent/local/nginx</code></p>"},{"location":"linux_services/LibreNMS/#apache","title":"Apache","text":"<p>Flytta apache scriptet till /usr/lib/check_mk_agent/local/</p> <p>Verifera att scriptet fungerar genom att k\u00f6ra:</p> <p><code>/usr/lib/check_mk_agent/local/apache</code></p> <p>Och l\u00e4gg sedan in en extend rad i /etc/snmp/snmpd.conf:</p> <p><code>extend\u00a0apache\u00a0/usr/lib/check_mk_agent/local/apache</code></p>"},{"location":"linux_services/LibreNMS/#powerdns","title":"PowerDNS","text":"<p>Flytta powerdns scriptet till /usr/lib/check_mk_agent/local/</p> <p>Verifera att scriptet fungerar genom att k\u00f6ra:</p> <p><code>/usr/lib/check_mk_agent/local/powerdns</code></p> <p>Och l\u00e4gg sedan in en extend rad i /etc/snmp/snmpd.conf:</p> <p><code>extend\u00a0powerdns\u00a0/usr/lib/check_mk_agent/local/powerdns</code></p>"},{"location":"linux_services/LibreNMS/#powerdns-recursor","title":"PowerDNS Recursor","text":"<p>Flytta powerdns-recursor scriptet till /usr/lib/check_mk_agent/local/</p> <p>Verifera att scriptet fungerar genom att k\u00f6ra:</p> <p><code>/usr/lib/check_mk_agent/local/powerdns-recursor</code></p> <p>Och l\u00e4gg sedan in en extend rad i /etc/snmp/snmpd.conf:</p> <p><code>extend\u00a0apache\u00a0/usr/lib/check_mk_agent/local/powerdns-recursor</code></p> <p>Category:Guider</p>"},{"location":"linux_services/Logstash/","title":"Logstash","text":"<p>Logstash sparar alla loggar fr\u00e5n olika system p\u00e5 ett centralt st\u00e4lle och hj\u00e4lper dig att s\u00f6ka bland dom.</p>"},{"location":"linux_services/Logstash/#installation","title":"Installation","text":"<p><code>wget\u00a0-qO\u00a0-</code><code>https://packages.elastic.co/GPG-KEY-elasticsearch</code><code>|\u00a0sudo\u00a0apt-key\u00a0add\u00a0-</code> <code>echo\u00a0\"deb</code><code>https://packages.elastic.co/logstash/2.3/debian</code><code>stable\u00a0main\"\u00a0|\u00a0sudo\u00a0tee\u00a0-a\u00a0/etc/apt/sources.list</code> <code>sudo\u00a0apt-get\u00a0update\u00a0&amp;&amp;\u00a0sudo\u00a0apt-get\u00a0-y\u00a0install\u00a0logstash</code></p>"},{"location":"linux_services/Logstash/#konfiguration","title":"Konfiguration","text":"<p>Java Ska logstash lyssna p\u00e5 portar under 1000 (t.ex. syslog 514) m\u00e5ste java till\u00e5tas att binda dessa portar.</p> <p><code>sudo\u00a0setcap\u00a0cap_net_bind_service=+epi\u00a0/usr/lib/jvm/java-8-oracle/jre/bin/java</code></p>"},{"location":"linux_services/Logstash/#syslog","title":"Syslog","text":"<p>(RFC 3164)</p> <pre><code>sudo dd of=/etc/logstash/conf.d/10-syslog.conf &lt;&lt; EOF\ninput {\n  tcp {\n    port =&gt; 514\n    type =&gt; syslog\n  }\n  udp {\n    port =&gt; 514\n    type =&gt; syslog\n  }\n}\n\nfilter {\n  if [type] == \"syslog\" {\n    grok {\n      match =&gt; { \"message\" =&gt; \"%{SYSLOGTIMESTAMP:syslog_timestamp} %{SYSLOGHOST:syslog_hostname} %{DATA:syslog_program}(?:\\[%{POSINT:syslog_pid}\\])$\n      add_field =&gt; [ \"received_at\", \"%{@timestamp}\" ]\n      add_field =&gt; [ \"received_from\", \"%{host}\" ]\n    }\n    syslog_pri { }\n    date {\n      match =&gt; [ \"syslog_timestamp\", \"MMM  d HH:mm:ss\", \"MMM dd HH:mm:ss\" ]\n    }\n  }\n}\n\noutput {\n  elasticsearch { host =&gt; localhost }\n  stdout { codec =&gt; rubydebug }\n}\nEOF\n</code></pre>"},{"location":"linux_services/Logstash/#ssl","title":"SSL","text":"<p>Logstash forwarder (klienter) anv\u00e4nder certifikat f\u00f6r autentisering och SSL f\u00f6r kommunikation med Logstash server. Skapa cert p\u00e5 servern.</p> <p><code>sudo\u00a0mkdir\u00a0-p\u00a0/etc/pki/tls/certs\u00a0&amp;&amp;\u00a0sudo\u00a0mkdir\u00a0/etc/pki/tls/private</code> <code>sudo\u00a0nano\u00a0/etc/ssl/openssl.cnf</code></p> <p>Find the [ v3_ca ] section and add:</p> <p><code>subjectAltName\u00a0=\u00a0IP:\u00a010.0.0.10</code> <code>cd\u00a0/etc/pki/tls</code> <code>sudo\u00a0openssl\u00a0req\u00a0-config\u00a0/etc/ssl/openssl.cnf\u00a0-x509\u00a0-days\u00a03650\u00a0-batch\u00a0-nodes\u00a0-newkey\u00a0rsa:2048\u00a0-keyout\u00a0private/logstash-forwarder.key\u00a0-out\u00a0certs/logstash-forwarder.crt</code></p>"},{"location":"linux_services/Logstash/#forwarder","title":"Forwarder","text":"<p>Category:Guider</p>"},{"location":"linux_services/MEAN/","title":"MEAN","text":"<p>MEAN, \u00e4ven kallat MEAN-stack \u00e4r en relativt ny open-source webbplatform som \u00e4r anpassad f\u00f6r dynamiska sidor som k\u00f6r JavaScript. En MEAN-stack best\u00e5r av:</p> <ul> <li>MongoDB - NoSQL databas.</li> <li>Express.js - Web framework</li> <li>Angular.js - Frontend framework</li> <li>Node.js - Webbserver</li> </ul> <p>N\u00e5gra f\u00f6rdelar med att k\u00f6ra MEAN-stack \u00e4r att man anv\u00e4nder samma programmeringsspr\u00e5k genom hela applikationen och JSON-formatering. Detta g\u00f6r det simplare att skriva snabba och responsiva applikationer samtidigt som det \u00e4r l\u00e4ttare att fels\u00f6ka, eftersom te.x objekt i databasen ser likadana ut f\u00f6r b\u00e5de back- och frontend.</p>"},{"location":"linux_services/Mailserver/","title":"Mailserver","text":"<p>Category:Guider Category:Sparco F\u00f6r att s\u00e4tta upp en mailserver snabbt kan man anv\u00e4nda IRedMail. Om man vill s\u00e4tta upp en sj\u00e4lv med Dovecot och Postfix och koppla allt till OpenLDAP f\u00f6r att l\u00e4ttare hantera login och skapandet av nya anv\u00e4ndare. Och s\u00e4tta upp en Roundcube f\u00f6r att hantera webmail.</p>"},{"location":"linux_services/Mailserver/#forberedelse","title":"F\u00f6rberedelse","text":"<p>\u00d6ppna portar i brandv\u00e4ggen.</p> <ul> <li>25 (SMTP)</li> <li>80 (HTTP)</li> <li>110 (POP3)</li> <li>143 (IMAP)</li> <li>443 (HTTPS)</li> </ul> <p>Skapa ett A och MX record i DNSen som spekar mot mailservern.</p> <p>Importera postfix schema p\u00e5 OpenLDAP servern.</p>"},{"location":"linux_services/Mailserver/#postfix","title":"Postfix","text":""},{"location":"linux_services/Mailserver/#installation","title":"Installation","text":"<p><code>apt-get\u00a0install\u00a0postfix\u00a0postfix-pcre\u00a0postfix-ldap</code></p> <p>Om man vill kunna skicka testmails(swaks) och enkelt styra mailboxen(mutt).</p> <p><code>apt-get\u00a0install\u00a0mutt\u00a0swaks</code></p>"},{"location":"linux_services/Mailserver/#konfiguration","title":"Konfiguration","text":"<p>Konfigurations filerna finns under <code>/etc/postfix</code></p>   `main.cf` Detta \u00e4r main konfigurations filen.   <pre><code>#!/bin/bash\n###################################################################################################\n### Base Settings ###\n#####################\n\n# Listen on all interfaces\ninet_interfaces = all\n\n# Use TCP IPv4\ninet_protocols = ipv4\n\n# Greet connecting clients with this banner\nsmtpd_banner = $myhostname ESMTP $mail_name (Ubuntu)\n\n# Fully-qualified hostname\nmyhostname = mail.example.com\n\n# Do not append domain part to incomplete addresses (this is the MUA's job)\nappend_dot_mydomain = no\n\n# Trusted networks/hosts (these are allowed to relay without authentication)\nmynetworks =\n    # Local\n    127.0.0.0/8\n    # External\n    1.2.3.4/32\n\n\n###################################################################################################\n### Local Transport ###\n#######################\n\n# Disable local transport (so that system accounts can't receive mail)\nlocal_transport = error:Local Transport Disabled\n\n# Don't use local alias maps\nalias_maps =\n\n# Local domain (could be omitted, since it is automatically derived from $myhostname)\nmydomain = example.com\n\n# Mails for these domains will be transported locally\nmydestination =\n    $myhostname\n    localhost.$mydomain\n    localhost\n\n\n###################################################################################################\n### Virtual Transport ###\n#########################\n\n# Deliver mail for virtual recipients to Dovecot\nvirtual_transport = dovecot\n\n# Process one mail at one time\ndovecot_destination_recipient_limit = 1\n\n# Valid virtual domains\nvirtual_mailbox_domains = hash:/etc/postfix/virtual_domains\n\n# Valid virtual recipients\nvirtual_mailbox_maps = proxy:ldap:/etc/postfix/ldap_virtual_recipients.cf\n\n# Virtual aliases\nvirtual_alias_maps = proxy:ldap:/etc/postfix/ldap_virtual_aliases.cf\n\n\n###################################################################################################\n### ESMTP Settings ###\n######################\n\n### SASL ###\n\n# Enable SASL (required for SMTP authentication)\nsmtpd_sasl_auth_enable = yes\n\n# Enable SASL for Outlook-Clients as well\nbroken_sasl_auth_clients = yes\n\n### TLS ###\n\n# Enable TLS (required to encrypt the plaintext SASL authentication)\nsmtpd_tls_security_level = may\n\n# Only offer SASL in a TLS session\nsmtpd_tls_auth_only = yes\n\n# Certification Authority\nsmtpd_tls_CAfile = /etc/postfix/certs/example-cacert.pem\n\n# Public Certificate\nsmtpd_tls_cert_file = /etc/postfix/certs/mail_public_cert.pem\n\n# Private Key (without passphrase)\nsmtpd_tls_key_file = /etc/postfix/certs/mail_private_key.pem\n\n# Randomizer for key creation\ntls_random_source = dev:/dev/urandom\n\n# TLS related logging (set to 2 for debugging)\nsmtpd_tls_loglevel = 0\n\n# Avoid Denial-Of-Service-Attacks\nsmtpd_client_new_tls_session_rate_limit = 10\n\n# Activate TLS Session Cache\nsmtpd_tls_session_cache_database = btree:/etc/postfix/smtpd_session_cache\n\n# Deny some TLS-Ciphers\nsmtpd_tls_exclude_ciphers =\n        EXP\n        EDH-RSA-DES-CBC-SHA\n        ADH-DES-CBC-SHA\n        DES-CBC-SHA\n        SEED-SHA\n\n# Diffie-Hellman Parameters for Perfect Forward Secrecy\n# Can be created with:\n# openssl dhparam -2 -out dh_512.pem 512\n# openssl dhparam -2 -out dh_1024.pem 1024\nsmtpd_tls_dh512_param_file = ${config_directory}/certs/dh_512.pem\nsmtpd_tls_dh1024_param_file = ${config_directory}/certs/dh_1024.pem\n\n\n###################################################################################################\n### Connection Policies ###\n###########################\n\n# Reject Early Talkers\npostscreen_greet_action = enforce\n\n\n###################################################################################################\n### Session Policies ###\n########################\n\n# Recipient Restrictions (RCPT TO related)\nsmtpd_recipient_restrictions =\n        # Allow relaying for SASL authenticated clients and trusted hosts/networks\n        # This can be put to smtpd_relay_restrictions in Postfix 2.10 and later\n        permit_sasl_authenticated\n        permit_mynetworks\n        reject_non_fqdn_recipient\n        reject_unknown_recipient_domain\n        reject_unauth_destination\n        # Reject the following hosts\n        check_sender_ns_access cidr:/etc/postfix/drop.cidr\n        check_sender_mx_access cidr:/etc/postfix/drop.cidr\n        # Additional blacklist\n        reject_rbl_client ix.dnsbl.manitu.net\n        # Finally permit (relaying still requires SASL auth)\n        permit\n\n# Reject the request if the sender is the null address and there are multiple recipients\nsmtpd_data_restrictions = reject_multi_recipient_bounce\n\n# Sender Restrictions\nsmtpd_sender_restrictions =\n        reject_non_fqdn_sender\n        reject_unknown_sender_domain\n\n# HELO/EHLO Restrictions\nsmtpd_helo_restrictions =\n        permit_mynetworks\n        check_helo_access pcre:/etc/postfix/identitycheck.pcre\n        #reject_non_fqdn_helo_hostname\n        reject_invalid_hostname\n\n# Deny VRFY recipient checks\ndisable_vrfy_command = yes\n\n# Require HELO\nsmtpd_helo_required = yes\n\n# Reject instantly if a restriction applies (do not wait until RCPT TO)\nsmtpd_delay_reject = no\n\n# Client Restrictions (IP Blacklist)\nsmtpd_client_restrictions = check_client_access cidr:/etc/postfix/drop.cidr\n</code></pre>   `virtual_domains` Inneh\u00e5ller vilka dom\u00e4ner server tar emot mail f\u00f6r.   <pre><code>#!/bin/bash\n# Domain        Anything\nexample.com     OK\n</code></pre>   `ldap_virtual_recipients.cf` LDAP fr\u00e5ga f\u00f6r att validera mottagaren.   <pre><code>#!/bin/bash\nbind = yes\nbind_dn = uid=postfix,ou=services,dc=example,dc=com\nbind_pw = secret\nserver_host = ldap://127.0.0.1:389\nsearch_base = ou=people,dc=example,dc=com\ndomain = example.com\nquery_filter = (&amp;(mail=%s)(mailEnabled=TRUE))\nresult_attribute = mail\n</code></pre>   `ldap_virtual_aliases.cf` LDAP fr\u00e5ga f\u00f6r att f\u00e5 fram aliases och forwarding adress.   <pre><code>#!/bin/bash\nbind = yes\nbind_dn = uid=postfix,ou=services,dc=example,dc=com\nbind_pw = secret\nserver_host = ldap://127.0.0.1:389\nsearch_base = ou=people,dc=example,dc=com\ndomain = example.com\nquery_filter = (&amp;(mailAlias=%s)(mailEnabled=TRUE))\nresult_attribute = mail, email\n</code></pre>   `identitycheck.pcre` Regexp f\u00f6r att blocka klienter som anv\u00e4nder ditt hostnamn.   <pre><code>#!/bin/bash\n# Identity (RegEx)      Action\n\n/^(mail\\.example\\.com)$/    REJECT Hostname Abuse: $1\n/^(1\\.2\\.3\\.4)$/        REJECT Hostname Abuse: $1\n/^(\\[1\\.2\\.3\\.4\\])$/        REJECT Hostname Abuse: $1\n</code></pre>   `drop.cidr` Inneh\u00e5ller svartlistade IP-adresser.   <pre><code>#!/bin/bash\n# IP/CIDR           Action\n\n1.2.3.0/24          REJECT Blacklisted\n</code></pre> <p>Tempor\u00e4rt kommentera ut f\u00f6ljande rader eftersom att Dovecot och TLS inte \u00e4r konfigurerat i main.cf:</p> <ul> <li>dovecot_destination_recipient_limit = 1</li> <li>smtpd_tls_security_level = may</li> <li>smtpd_tls_auth_only = yes</li> <li>smtpd_tls_CAfile = /etc/postfix/certs/example-cacert.pem</li> <li>smtpd_tls_cert_file = /etc/postfix/certs/mail_public_cert.pem</li> <li>smtpd_tls_key_file = /etc/postfix/certs/mail_private_key.pem</li> </ul> <p>Skapa en postmap db fil f\u00f6r din dom\u00e4n.</p> <p><code>postmap\u00a0hash:/etc/postfix/virtual_domains</code></p> <p>Starta postfix och anslut mot servern med telnet mot port 25. Prova att skicka <code>EHLO client</code>, d\u00e5 ska du f\u00e5 f\u00f6ljande svar:</p> <pre><code>Trying 127.0.0.1...\nConnected to 127.0.0.1.\nEscape character is '^]'.\n220 mail.example.com ESMTP Postfix (Ubuntu)\nEHLO client\n250-mail.example.com\n250-PIPELINING\n250-SIZE 10240000\n250-ETRN\n250-AUTH DIGEST-MD5 NTLM CRAM-MD5 LOGIN PLAIN\n250-AUTH=DIGEST-MD5 NTLM CRAM-MD5 LOGIN PLAIN\n250-ENHANCEDSTATUSCODES\n250-8BITMIME\n250 DSN\nQUIT\n221 2.0.0 Bye\n</code></pre> <p>Testa att st\u00e4lla en LDAP fr\u00e5ga.</p> <p><code>postmap\u00a0-q\u00a0user@example.com</code><code>ldap:/etc/postfix/ldap_virtual_recipients.cf</code> <code>postmap\u00a0-q\u00a0postmaster@example.com</code><code>ldap:/etc/postfix/ldap_virtual_aliases.cf</code></p> <p>B\u00e5da fr\u00e5gorna b\u00f6r ge user@example.com som svar.</p>"},{"location":"linux_services/Mailserver/#dovecot","title":"Dovecot","text":""},{"location":"linux_services/Mailserver/#installation_1","title":"Installation","text":"<p><code>apt-get\u00a0install\u00a0dovecot-core\u00a0dovecot-imapd\u00a0dovecot-pop3d\u00a0dovecot-lmtpd\u00a0dovecot-ldap</code></p>"},{"location":"linux_services/Mailserver/#konfiguration_1","title":"Konfiguration","text":"<p>St\u00e4ng av protocol som du inte beh\u00f6ver i filen <code>/etc/dovecot/conf.d/10-master.conf</code> genom att s\u00e4tta porten p\u00e5 0. Och s\u00e4tt permissions, anv\u00e4ndare och grupp f\u00f6r authentication-userdb i samma fil:</p> <pre><code>inet_listener imaps {\n    port = 0\n    #port = 993\n    #ssl = yes\n}\n</code></pre> <pre><code>inet_listener pop3s {\n    port = 0\n    #port = 995\n    #ssl = yes\n}\n</code></pre> <pre><code>unix_listener auth-userdb {\n    mode = 0600\n    user = vmail\n    group = vmail\n}\n</code></pre> <p>St\u00e4ng av system-based authentication och s\u00e4tt p\u00e5 LDAP-based authentication ist\u00e4llet i <code>/etc/dovecot/conf.d/10-auth.conf</code>:</p> <pre><code>auth_mechanisms = plain login\n#!include auth-system.conf.ext\n!include auth-ldap.conf.ext\n</code></pre> <p>S\u00e4tt dom LDAP relaterade inst\u00e4llningarna i <code>/etc/dovecot/dovecot-ldap.conf.ext</code>:</p> <pre><code>hosts = 127.0.0.1\ndn = uid=dovecot,ou=services,dc=example,dc=com\ndnpass = secret\nldap_version = 3\nbase = ou=people,dc=example,dc=com\nuser_attrs = mailHomeDirectory=home,mailUidNumber=uid,mailGidNumber=gid,mailStorageDirectory=mail\nuser_filter = (&amp;(objectClass=PostfixBookMailAccount)(uniqueIdentifier=%n))\npass_attrs = uniqueIdentifier=user,userPassword=password\npass_filter = (&amp;(objectClass=PostfixBookMailAccount)(uniqueIdentifier=%n))\ndefault_pass_scheme = CRYPT\n</code></pre> <p>Aktivera loggning i <code>/etc/dovecot/conf.d/10-logging.conf</code>:</p> <p><code>log_path\u00a0=\u00a0syslog</code> <code>syslog_facility\u00a0=\u00a0mail</code> <code>auth_debug\u00a0=\u00a0yes</code></p> <p>S\u00e4tt SSL cert i <code>/etc/dovecot/conf.d/10-ssl.conf</code>:</p> <p><code>ssl_cert\u00a0=</code>&lt;/etc/dovecot/mail_public_cert.pem  ssl_key = &lt;/etc/dovecot/private/mail_private_key.pem</p> <p>Skapa en anv\u00e4ndare och en grupp som heter '''vmail''' med uid och gid 5000:  addgroup --system --gid 5000 vmail  adduser --system --home /srv/vmail --uid 5000 --gid 5000 --disabled-password --disabled-login vmail</p> <p>Starta dovecot och g\u00f6r ett IMAP connection &amp; authentication test med hj\u00e4lp av telnet. Om du inte vill starta dovecot i bakgrunden anv\u00e4nd <code><code>dovecot\u00a0-f</code></code><code>.</code></p> <p><code>telnet 127.0.0.1 143</code> och skicka <code>1 login user@example.com secret</code></p> <pre><code>Trying 127.0.0.1...\nConnected to localhost.\nEscape character is '^]'.\n* OK [CAPABILITY IMAP4rev1 LITERAL+ SASL-IR LOGIN-REFERRALS ID ENABLE IDLE STARTTLS AUTH=PLAIN AUTH=LOGIN] Dovecot (Ubuntu) ready.\n1 login user@example.com secret\n1 OK [CAPABILITY IMAP4rev1 LITERAL+ SASL-IR LOGIN-REFERRALS ID ENABLE IDLE SORT SORT=DISPLAY THREAD=REFERENCES THREAD=REFS THREAD=ORDEREDSUBJECT MULTIAPPEND URL-PARTIAL CATENATE UNSELECT CHILDREN NAMESPACE UIDPLUS LIST-EXTENDED I18NLEVEL=1 CONDSTORE QRESYNC ESEARCH ESORT SEARCHRES WITHIN CONTEXT=SEARCH LIST-STATUS SPECIAL-USE BINARY MOVE] Logged in\n2 logout\n* BYE Logging out\n</code></pre> <p>Aktivera Dovecot deliver i Postfix genom att l\u00e4gga till f\u00f6ljande rad i <code>/etc/postfix/master.cf</code>:</p> <pre><code>dovecot   unix  -       n       n       -       -       pipe\n        flags=ODRhu user=vmail:vmail argv=/usr/lib/dovecot/deliver -e -f ${sender} -d ${recipient}\n</code></pre> <p>S\u00e4tt en postmaster adress i <code>/etc/dovecot/conf.d/15-lda.conf</code>:</p> <p><code>postmaster_address\u00a0=\u00a0postmaster@example.com</code></p> <p>Starta om Dovecot och Postfix och g\u00f6r sedan ett deliver test.</p> <p><code>swaks\u00a0--from\u00a0user1@example.com\u00a0--to\u00a0user2@example.com\u00a0--server\u00a0127.0.0.1:25</code></p> <p>Kolla i log filerna eller i user2 mailbox</p> <p><code>mutt\u00a0-f\u00a0/srv/vmail/user2@example.com/Maildir/</code></p>"},{"location":"linux_services/Mailserver/#sasl","title":"SASL","text":""},{"location":"linux_services/Mailserver/#installation_2","title":"Installation","text":"<p><code>apt-get\u00a0install\u00a0libsasl2-2\u00a0sasl2-bin</code></p>"},{"location":"linux_services/Mailserver/#konfiguration_2","title":"Konfiguration","text":"<p>Skapa \"smtpd.conf\" i <code>/etc/postfix/sasl/</code>:</p> <p><code>log_level:\u00a03</code> <code>pwcheck_method:\u00a0saslauthd</code> <code>mech_list:\u00a0PLAIN\u00a0LOGIN</code></p> <p>S\u00e4tt p\u00e5 autostart v\u00e4lj LDAP som mekanism och s\u00e4tt options f\u00f6r en chrootad Postfix i <code>/etc/default/saslauthd</code>:</p> <p><code>START=yes</code> <code>MECHANISMS=\"ldap\"</code> <code>OPTIONS=\"-c\u00a0-m\u00a0/var/spool/postfix/var/run/saslauthd\"</code></p> <p>Skapa LDAP konfigurationen i <code>/etc/saslauthd.conf</code>:</p> <p><code>ldap_servers:</code><code>ldap://127.0.0.1/</code> <code>ldap_bind_dn:\u00a0uid=saslauthd,ou=services,dc=example,dc=com</code> <code>ldap_bind_pw:\u00a0secret</code> <code>ldap_timeout:\u00a010</code> <code>ldap_time_limit:\u00a010</code> <code>ldap_scope:\u00a0sub</code> <code>ldap_search_base:\u00a0ou=people,dc=example,dc=com</code> <code>ldap_auth_method:\u00a0bind</code> <code>ldap_filter:\u00a0(&amp;(uniqueIdentifier=%u)(mailEnabled=TRUE))</code> <code>ldap_debug:\u00a00</code> <code>ldap_verbose:\u00a0off</code> <code>ldap_ssl:\u00a0no</code> <code>ldap_starttls:\u00a0no</code> <code>ldap_referrals:\u00a0yes</code></p> <p>S\u00e4tt sedan r\u00e4tt permissions p\u00e5 filen.</p> <p><code>chown\u00a0root:sasl\u00a0/etc/saslauthd.conf</code> <code>chmod\u00a0640\u00a0/etc/saslauthd.conf</code></p> <p>L\u00e4gg till Postfix anv\u00e4ndaren i sasl gruppen.</p> <p><code>adduser\u00a0postfix\u00a0sasl</code></p> <p>Starta sedan SASL och g\u00f6r ett auth test:</p> <p><code>testsaslauthd\u00a0-u\u00a0user\u00a0-p\u00a0secret\u00a0-f\u00a0/var/spool/postfix/var/run/saslauthd/mux</code></p> <p>Om det funkar \u00e4r svaret 0: OK \u201cSuccess.\u201d</p> <p>F\u00f6r att testa s\u00e5 att SASL fungerar med SMTP m\u00e5ste vi g\u00f6ra om username och password till base64.</p> <p><code>perl\u00a0-MMIME::Base64\u00a0-e\u00a0'print\u00a0encode_base64(\"user\\@example.com\");'</code> <code>perl\u00a0-MMIME::Base64\u00a0-e\u00a0'print\u00a0encode_base64(\"secret\");'</code></p> <p>\u00d6ppna sedan en telnet session och skicka <code>EHLO test.local</code> f\u00f6ljt av <code>AUTH LOGIN</code>. Servern kommer d\u00e5 att fr\u00e5ga efter username och password, skicka det som base64 encoded.</p> <pre><code>telnet localhost 25\n\nTrying 127.0.0.1...\nConnected to localhost.\nEscape character is '^]'.\n220 mail.example.com ESMTP Postfix (Ubuntu)\nEHLO test.local\n250-mail.example.com\n250-PIPELINING\n250-SIZE 10240000\n250-ETRN\n250-STARTTLS\n250-AUTH PLAIN LOGIN\n250-AUTH=PLAIN LOGIN\n250-ENHANCEDSTATUSCODES\n250-8BITMIME\n250 DSN\nAUTH LOGIN\n334 VXNlcm5hbWU6\nYWxpY2VAZXhhbXBsZS5jb20=\n334 UGFzc3dvcmQ6\nc2VjcmV0\n235 2.7.0 Authentication successful\nQUIT\n221 2.0.0 Bye\n</code></pre> <p>Om allt fungera ska du f\u00e5 svaret 235 2.7.0 Authentication successful. Om det inte fungera titta i log filerna. Om log filerna inte hj\u00e4lpte sl\u00e5 p\u00e5 extended logging genom att l\u00e4gga till -v i smtpd kommandot i <code>/etc/postfix/master.cf</code>:</p> <p><code>smtp\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0inet\u00a0\u00a0n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0-\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0-\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0-\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0-\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0smtpd\u00a0-v</code></p> <p>Prova att skicka ett test mail med authentication.</p> <p><code>swaks\u00a0--from\u00a0user1@example.com\u00a0--to\u00a0user2@example.com\u00a0--server\u00a0127.0.0.1:25\u00a0--auth\u00a0plain\u00a0--auth-user=user1@example.com</code></p>"},{"location":"linux_services/Mailserver/#tlspostfix","title":"TLS(Postfix)","text":"<p>Just nu s\u00e5 skickas l\u00f6senorden i plaintext. F\u00f6r att kryptera dom skapa certifikat och l\u00e4gg dom i <code>/etc/postfix/certs</code>. Kolla i main.cf vilket filnamn dom ska ha. Skapa \u00e4ven 2st Diffie-Hellman filer i samma map.</p> <p><code>openssl\u00a0dhparam\u00a0-2\u00a0-out\u00a0dh_512.pem\u00a0512</code> <code>openssl\u00a0dhparam\u00a0-2\u00a0-out\u00a0dh_1024.pem\u00a01024</code></p> <p>S\u00e4tt r\u00e4tt permissions p\u00e5 mappen.</p> <p><code>chown\u00a0-R\u00a0root:root\u00a0/etc/postfix/certs/</code> <code>chmod\u00a0-R\u00a0600\u00a0/etc/postfix/certs/</code></p> <p>Ta bort dom 6 kommentarerna du gjorde i <code>/etc/postfix/main.cf</code> filen i b\u00f6rjan av guiden och starta om Postfix.</p> <p>Om du nu telnetar till Postfix servern och skickar EHLO client s\u00e5 ska det st\u00e5 STARTTLS ist\u00e4llet f\u00f6r LOGIN PLAIN.</p> <p>Med f\u00f6ljande kommando kan du prova att ansluta med STARTTLS.</p> <p><code>openssl\u00a0s_client\u00a0-CAfile\u00a0certs/example-cacert.pem\u00a0-starttls\u00a0smtp\u00a0-connect\u00a0localhost:25</code></p>"},{"location":"linux_services/Mailserver/#tipsntrix","title":"Tips'N'Trix","text":"<p>S\u00e4kra upp Dovecot och Postfix med TLS conf ifr\u00e5n chiperlist.</p> <p>Testa s\u00e4kerheten p\u00e5 mailservern med starttls eller ssl-tools.</p>"},{"location":"linux_services/Mailserver/#klient","title":"Klient","text":"<p>Du kan nu ansluta n\u00e5n mail klient tex Thunderbird eller Outlook mot servern och autentisera med ditt OpenLDAP login.</p> <p>Man kan ocks\u00e5 s\u00e4tta upp Roundcube f\u00f6r att enkelt skicka och l\u00e4sa din mail fr\u00e5n en dator med en webbl\u00e4sare.</p> <p>Category:Guider Category:Sparco</p>"},{"location":"linux_services/MediaWiki/","title":"MediaWiki","text":"<p>Category:Guider Category:Sparco MediaWiki \u00e4r en open-source wiki application som driver tv\u00e5 av dom st\u00f6rsta och b\u00e4sta wiki hemsidorna p\u00e5 n\u00e4tet Hackernet och Wikipedia.</p>"},{"location":"linux_services/MediaWiki/#forberedelser","title":"F\u00f6rberedelser","text":"<p>F\u00f6r att kunna k\u00f6ra mediawiki kr\u00e4vs det att du har LAMP.</p>"},{"location":"linux_services/MediaWiki/#valfria-program","title":"Valfria program","text":"<p>Man kan installera dom i efterhand ocks\u00e5 om man kommer p\u00e5 att man beh\u00f6ver dom.</p> php-apc Alternative PHP Cache. php5-intl Unicode normalization. ImageMagick Image thumbnailing. GD Library Alternative to ImageMagick. Install libgd2-xpm libgd2-xpm-dev php5-gd. phpmyadmin MySQL administration tool. php5-cli Ability to run PHP commands from the command line, which is useful for debugging and running maintenance scripts. <p>Exempel:</p> <p><code>sudo\u00a0apt-get\u00a0install\u00a0php-apc\u00a0php5-intl\u00a0imagemagick\u00a0phpmyadmin\u00a0vsftpd\u00a0php5-cli</code></p>"},{"location":"linux_services/MediaWiki/#installation","title":"Installation","text":"<p>Tanka hem senaste eller LTS versionen fr\u00e5n deras hemsida, packa upp filen och byt namn p\u00e5 foldern.</p> <p><code>wget</code><code>https://releases.wikimedia.org/mediawiki/1.25/mediawiki-1.25.1.tar.gz</code><code>|\u00a0tar\u00a0-xvf\u00a0mediawiki-1.25.1.tar.gz\u00a0-C\u00a0/var/www/\u00a0|\u00a0mv\u00a0/var/www/mediawiki-1.25.1/\u00a0/var/www/mediawiki</code></p> <p>Se till att anv\u00e4ndaren som k\u00f6r din webbserver \u00e4ger mappen <code>mediawiki</code> s\u00e5 att du kan tex ladda upp filer.</p> <p>Skapa sedan en databas som mediawiki kan ansluta till, surfa sedan in p\u00e5 http://\\&lt;ip&gt;/mediawiki och f\u00f6lj wizarden.</p> <p>N\u00e4r wizarden \u00e4r klar ladda upp <code>LocalSettings.php</code> till <code>mediawiki</code> mappen.</p>"},{"location":"linux_services/MediaWiki/#konfiguration","title":"Konfiguration","text":"<p>All konfiguration av mediawiki och plugins g\u00f6rs i <code>LocalSettings.php</code> filen.</p>"},{"location":"linux_services/MediaWiki/#plugins","title":"Plugins","text":"<p>Plugins finns p\u00e5 mediawikis hemsida.</p> <p>N\u00e5gra bra plugins som denna sidan anv\u00e4nder \u00e4r.</p> Visual Editor Bra editor om man \u00e4r nyb\u00f6rjare och inte f\u00f6rst\u00e5r mediawikis syntax. Google Analytics Enkelt att f\u00e5 Google analytics att fungera. LDAP Authentication F\u00f6r att kunna koppla sin wiki mot en LDAP server som OpenLDAP eller Active Directory. Wiki Editor F\u00f6r att f\u00e5 en lite b\u00e4ttre source editor. SyntaxHighlight F\u00f6r att kunna f\u00e5 tex php,html,python kod p\u00e5 en sida mer l\u00e4ttl\u00e4st. MsUpload Enkelt kunna ladda upp filer n\u00e4r man editerar. Dynamic Page List F\u00f6r att kunna skapa dynamiska listor fr\u00e5n tex kategorier eller namespaces. Tools p\u00e5 Linux sidan anv\u00e4nder detta plugin. Contribution Scores F\u00f6r att f\u00e5 fram en tabel om vem som bidragit med mest p\u00e5 wikin."},{"location":"linux_services/MediaWiki/#backup","title":"Backup","text":"<p>Vi anv\u00e4nder ett script som g\u00f6r en dump p\u00e5 databasen och packar ihop dumpen med alla filer i mediawiki mappen. Backup filen sparas i samma mapp som scriptet k\u00f6rs i.</p> <pre><code>#!/bin/bash\n#\n# fullsitebackup.sh V1.2\n#\n# Full backup of website files and database content.\n#\n# A number of variables defining file location and database connection\n# information must be set before this script will run.\n# Files are tar'ed from the root directory of the website. All files are\n# saved. The MySQL database tables are dumped without a database name and\n# and with the option to drop and recreate the tables.\n#\n# ----------------------\n# 05-Jul-2007 - Quick adaptation for MediaWiki (currently testing)\n# ----------------------\n# March 2007 Updates - Version for Drupal\n# - Updated script to resolve minor path bug\n# - Added mysql password variable (caution - this script file is now a security risk - protect it)\n# - Generates temp log file\n# - Updated backup and restore scripts have been tested on Ubunutu Edgy server w/Drupal 5.1\n#\n# - Enjoy! BristolGuy\n#-----------------------\n#\n## Parameters:\n# tar_file_name (optional)\n#\n#\n# Configuration\n#\n\n# Database connection information\ndbname=\"wiki\" # (e.g.: dbname=wikidb)\ndbhost=\"localhost\"\ndbuser=\"wikidb\" # (e.g.: dbuser=wikiuser)\ndbpw=\"secretpassword\" # (e.g.: dbuser password)\n\n# Website Files\nwebrootdir=\"/var/www/wiki\" # (e.g.: webrootdir=/home/user/public_html)\n\n#\n# Variables\n#\n\n# Default TAR Output File Base Name\ntarnamebase=wiki_sitebackup-\ndatestamp=`date +'%m-%d-%Y'`\n\n# Execution directory (script start point)\nstartdir=`pwd`\nlogfile=$startdir\"/fullsite.log\" # file path and name of log file to use\n\n# Temporary Directory\ntempdir=$datestamp\n\n#\n# Input Parameter Check\n#\n\nif test \"$1\" = \"\"\nthen\ntarname=$tarnamebase$datestamp.tgz\nelse\ntarname=$1\nfi\n\n#\n# Begin logging\n#\necho \"Beginning mediawiki site backup using fullsitebackup.sh ...\" &gt; $logfile\n#\n# Create temporary working directory\n#\necho \" Creating temp working dir ...\" &gt;&gt; $logfile\nmkdir $tempdir\n\n#\n# TAR website files\n#\necho \" TARing website files into $webrootdir ...\" &gt;&gt; $logfile\ncd $webrootdir\ntar cf $startdir/$tempdir/filecontent.tar .\n\n#\n# sqldump database information\n#\necho \" Dumping mediawiki database, using ...\" &gt;&gt; $logfile\necho \" user:$dbuser; database:$dbname host:$dbhost \" &gt;&gt; $logfile\ncd $startdir/$tempdir\nmysqldump --user=$dbuser --password=$dbpw --add-drop-table $dbname &gt; dbcontent.sql\n\n#\n# Create final backup file\n#\necho \" Creating final compressed (tgz) TAR file: $tarname ...\" &gt;&gt; $logfile\ntar czf $startdir/$tarname filecontent.tar dbcontent.sql\n\n#\n# Cleanup\n#\necho \" Removing temp dir $tempdir ...\" &gt;&gt; $logfile\ncd $startdir\nrm -r $tempdir\n\n#\n# Exit banner\n#\nendtime=`date`\necho \"Backup completed $endtime, TAR file at $tarname. \" &gt;&gt; $logfile\n</code></pre>   ### Cronjob  Scriptet funkar att k\u00f6ra som ett cronjob. Raden g\u00f6r att det k\u00f6rs en backup kl 05:00 varje dag.  `0\u00a005\u00a0*\u00a0*\u00a0*\u00a0cd\u00a0/path/to/script\u00a0&amp;&amp;\u00a0sh\u00a0Backup_script.sh`  Sitemap -------  Mediawiki har ett inbyggt script f\u00f6r att skapa sitemaps. Sitemaps anv\u00e4nds av s\u00f6kmotorer s\u00e5 att deras botar vet vilka URLs det finns att indexera.  Scriptet finns under `maintenance` och heter `generateSitemap.php`.  Skapa en mapp att spara sitemapen i.  `mkdir\u00a0/var/www/mediawiki/sitemap`  K\u00f6r kommandot,  `php\u00a0generateSitemap.php\u00a0--fspath\u00a0/var/www/mediawiki/sitemap\u00a0--server\u00a0\"`[`http://URLtillStartsidan`](http://URLtillStartsidan)`\"\u00a0--urlpath\u00a0\"`[`http://URLtill/sitemap`](http://URLtill/sitemap)`\"`  Nu ska du s\u00e4ga till s\u00f6kmotorn vart din sitemap finns s\u00e5 \u00e4r det klart.  ### Cronjob  K\u00f6r generateSitemap.php som ett cronjob var 45e minut.  `*/45\u00a0*\u00a0*\u00a0*\u00a0*\u00a0/usr/bin/php\u00a0/var/www/wiki/maintenance/generateSitemap.php\u00a0--fspath\u00a0/var/www/mediawiki/sitemap\u00a0--server\u00a0\"`[`http://URLtillStartsidan`](http://URLtillStartsidan)`\"\u00a0--urlpath\u00a0\"`[`http://URLtill/sitemap`](http://URLtill/sitemap)`\"`  Upgrade -------  Mediawiki anv\u00e4nder semantic versioning d\u00e4r man namnger releases X.Y.Z (Major.Minor.Patch). I skrivande stund s\u00e5 \u00e4r Mediawiki uppe i major 1, minor 26, patch 0.  Alla versioner av Mediawiki finns att ladda hem [h\u00e4r!](https://releases.wikimedia.org/mediawiki/)  ### Minor  Oftast \u00e4r **LocalSettings.php** kompatibel mellan minor versioner, l\u00e4s release notes f\u00f6r att f\u00e5 reda p\u00e5 mer.  Ers\u00e4tt dom gammla filerna med dom nya filerna. Via skalet k\u00f6r sedan maintenance script f\u00f6r att uppdatera databas tabeller och bygg om filstrukturen f\u00f6r bla filer:  `php\u00a0/var/www/mediawiki/maintenance/update.php` `php\u00a0/var/www/mediawiki/maintenance/rebuildall.php`  G\u00e5 in p\u00e5 din wiki sida och kolla *Special:Version* f\u00f6r att verifiera att uppgraderingen.  ### Patch  1.  G\u00e5 till din mediawiki mapp (den med localsettings.php i). 2.  Ladda ner och packa om patch filen. 3.  K\u00f6r **patch -p1 --dry-run -i *mediawiki stable release     number.patch*** 4.  Gick allt igenom utan problem k\u00f6r samma kommando igen fast utan     **--dry-run**. 5.  Surfa sedan in p\u00e5 din wiki sida och kolla *Special:Version* f\u00f6r att     verifiera att patchen g\u00e5tt igenom."},{"location":"linux_services/ModSecurity/","title":"ModSecurity","text":"<p>Open Source Web Application Firewall. Funkar med Apache, Nginx and IIS. Det f\u00f6ljer med ett Core Rule Set (CRS) som har regler f\u00f6r bland annat SQL injection, cross site scripting, trojaner och session hijacking. F\u00f6r apache finns det modul.</p>"},{"location":"linux_services/ModSecurity/#installation","title":"Installation","text":"<p><code>sudo\u00a0apt-get\u00a0-y\u00a0install\u00a0libapache2-mod-security2</code> <code>sudo\u00a0apachectl\u00a0-M\u00a0|\u00a0grep\u00a0--color\u00a0security2</code></p>"},{"location":"linux_services/ModSecurity/#konfiguration","title":"Konfiguration","text":"<p>Det f\u00f6ljer med ett g\u00e4ng rekommenderade inst\u00e4llningar som man kan anv\u00e4nda sig av.</p> <p><code>sudo\u00a0mv\u00a0/etc/modsecurity/modsecurity.conf-recommended\u00a0/etc/modsecurity/modsecurity.conf</code> <code>sudo\u00a0service\u00a0apache2\u00a0reload</code></p> <p>Default s\u00e5 \u00e4r ModSecurity inst\u00e4llt p\u00e5 Detection Only. F\u00f6r att sl\u00e5 p\u00e5 ModSecurity:</p> <p><code>sudo\u00a0sed\u00a0-i\u00a0\"s/SecRuleEngine\u00a0DetectionOnly/SecRuleEngine\u00a0On/\"\u00a0/etc/modsecurity/modsecurity.conf</code></p> <p>Data leakage detection genererar ganska mycket loggar och det kan man sl\u00e5 av med:</p> <p><code>sudo\u00a0sed\u00a0-i\u00a0\"s/SecResponseBodyAccess\u00a0On/SecResponseBodyAccess\u00a0Off/\"\u00a0/etc/modsecurity/modsecurity.conf</code></p>"},{"location":"linux_services/ModSecurity/#crs","title":"CRS","text":"<p>F\u00f6r att anv\u00e4nda sig av Core Rule Set.</p> <p><code>sudo\u00a0nano\u00a0/etc/apache2/mods-enabled/security2.conf</code> <code>...</code> <code>IncludeOptional\u00a0/etc/modsecurity/*.conf</code> <code>IncludeOptional\u00a0\"/usr/share/modsecurity-crs/*.conf\"</code> <code>IncludeOptional\u00a0\"/usr/share/modsecurity-crs/activated_rules/*.conf\"</code> </p>"},{"location":"linux_services/ModSecurity/#exkludering","title":"Exkludering","text":"<p>Vill man exkludera enskilda hemsidor kan man l\u00e4gga in f\u00f6ljande i -blocket i sin konfiguration. <p> <code>SecRuleEngine\u00a0Off</code> </p> <p>Category:Guider</p>"},{"location":"linux_services/Multiarch/","title":"Multiarch","text":"<p>Multipla architekturer kan vara bra att anv\u00e4nda om du finner att ett program eller library du beh\u00f6ver inte finns i t.ex. 32 bitars men du vill k\u00f6ra 64 bitars p\u00e5 servern</p> <p>\"dpkg --print-foreign-architectures\" Listar arktikturer som du kan l\u00e4gga till \"dpkg --add-architecture i386\" l\u00e4gger till i386 som en extra kategori Sen \u00e4r det bara att g\u00f6ra apt-get update som vanligt s\u00e5 ska du kunna installera libs och program f\u00f6r den andra arkitekturen.</p> <p>I vanliga fall kommer d\u00e5 det du vill installera installeras i din standard arktiektur om du ist\u00e4llet vill tvinga det till en speciel arkitektur s\u00e5 k\u00f6r du ist\u00e4llet t.ex. \"apt-get install apache2:i386\"</p> <p>Du kan ta bort multiarchs med \"dpkg --remove-architecture i386\"</p> <p>Ett vanligt fel meddelande som kommer upp n\u00e4r man f\u00f6rs\u00f6ker k\u00f6ra en fil men inte har r\u00e4tt arkitektur \u00e4r \"No such file or directory\"</p> <p>Category:Guider</p>"},{"location":"linux_services/MySQL/","title":"MySQL","text":"<p>MySQL \u00e4r en relational database management system(RDBMS). MySQL var den n\u00e4st st\u00f6rsta RDBMS databasen och den den mest anv\u00e4nda open-source RDBMS databasen f\u00f6rr. MySQL \u00e4r en av programmen du f\u00e5r n\u00e4r du installerar LAMP.</p>"},{"location":"linux_services/MySQL/#installation","title":"Installation","text":"<p><code>apt-get\u00a0install\u00a0mysql-server</code></p>"},{"location":"linux_services/MySQL/#konfiguration","title":"Konfiguration","text":"<p>Konfiguration av MySQL g\u00f6rs i <code>/etc/mysql/my.cnf</code>.</p> <p>By default s\u00e5 lyssnar MySQL enbart p\u00e5 127.0.0.1, f\u00f6r att fixa det kan man \u00e4ndra i my.cnf till,</p> <p><code>bind-address\u00a0=\u00a00.0.0.0</code></p> <p>D\u00e5 kommer MySQL lyssna p\u00e5 alla interface.</p>"},{"location":"linux_services/MySQL/#skapa-en-databas","title":"Skapa en databas","text":"<p>Logga in som root.</p> <p><code>mysql\u00a0-u\u00a0root\u00a0-p</code></p> <p>Skapa en databas.</p> <p><code>create\u00a0database</code><code>;</code> <p>Skapa en anv\u00e4ndare.</p> <p><code>grant\u00a0usage\u00a0on\u00a0*.*\u00a0to</code><code>@localhost\u00a0identified\u00a0by\u00a0'</code><code>';</code> <p>Ge en anv\u00e4ndare alla r\u00e4ttigheter p\u00e5 en databas.</p> <p><code>grant\u00a0all\u00a0privileges\u00a0on</code><code>.*\u00a0to</code><code>@localhost;</code>"},{"location":"linux_services/MySQL/#backupdumpa-databas","title":"Backup/Dumpa databas","text":"<p>Dumpa en databas till en fil f\u00f6r att g\u00f6ra en backup p\u00e5 den.</p> <p><code>mysqldump\u00a0--user=[username]\u00a0--password=[password]\u00a0[databas]\u00a0&gt;\u00a0dbcontent.sql</code></p>"},{"location":"linux_services/MySQL/#importera-en-databas","title":"Importera en databas","text":"<p>F\u00f6r att importera en databas dump.</p> <p><code>mysql\u00a0-u\u00a0[username]\u00a0-p[password]\u00a0[databas]\u00a0&lt;\u00a0dumpfilename.sql</code></p> <p>Category:Guider Category:Sparco</p>"},{"location":"linux_services/NFS/","title":"NFS","text":"<p>Category:Guider Network File System (NFS) \u00e4r ett filsystem som till\u00e5ter datorer att komma \u00e5t filer \u00f6ver ett n\u00e4tverk p\u00e5 ungef\u00e4r samma s\u00e4tt som de kan komma \u00e5t filer p\u00e5 lokal lagring. Detta \u00e4r anv\u00e4ndbart f\u00f6r att dela filer mellan flera servrar. H\u00e4r f\u00f6ljer generella inst\u00e4llningar f\u00f6r server och klient, de fungerar i de flesta fall.</p>"},{"location":"linux_services/NFS/#installation","title":"Installation","text":""},{"location":"linux_services/NFS/#server","title":"Server","text":"<p><code>sudo\u00a0apt-get\u00a0update\u00a0&amp;&amp;\u00a0sudo\u00a0apt-get\u00a0-y\u00a0install\u00a0nfs-kernel-server</code></p>"},{"location":"linux_services/NFS/#klient","title":"Klient","text":"<p><code>sudo\u00a0apt-get\u00a0update\u00a0&amp;&amp;\u00a0sudo\u00a0apt-get\u00a0-y\u00a0install\u00a0nfs-common</code></p>"},{"location":"linux_services/NFS/#konfiguration","title":"Konfiguration","text":""},{"location":"linux_services/NFS/#server_1","title":"Server","text":"<p><code>sudo\u00a0mkdir\u00a0/nfsroot</code> <code>sudo\u00a0sh\u00a0-c\u00a0'echo\u00a0\"/nfsroot\u00a0192.168.1.16/30(rw,root_squash,subtree_check)\"\u00a0&gt;&gt;\u00a0/etc/exports'</code> <code>sudo\u00a0exportfs\u00a0-a</code> <code>sudo\u00a0service\u00a0nfs-kernel-server\u00a0start</code></p>"},{"location":"linux_services/NFS/#klient_1","title":"Klient","text":"<p><code>sudo\u00a0mkdir\u00a0/nfsroot</code> <code>sudo\u00a0sh\u00a0-c\u00a0'echo\u00a0\"192.168.1.50:/nfsroot\u00a0/nfsroot\u00a0nfs\u00a0rw,async,hard,intr\u00a00\u00a00\"\u00a0&gt;&gt;\u00a0/etc/fstab'</code> <code>sudo\u00a0mount\u00a0/nfsroot</code></p>"},{"location":"linux_services/NFS/#options","title":"Options","text":"<p>Ibland kan man beh\u00f6va \u00e4ndra egenskaperna f\u00f6r NFS-share:n. T.ex. om man har problem med att program s\u00e4tter lock p\u00e5 filer. H\u00e4r tas de vanligaste alternativen upp som \u00e4r bra att k\u00e4nna till. Det mesta g\u00f6rs p\u00e5 klientsidan.</p> <p>Klient rw: Read/write filesystem. ro: Read-only filesystem. Remote NFS clients can\u2019t modify the filesystem. hard: Applications using files stored on an NFS will always wait if the server goes down. User cannot terminate the process unless the option intr is set. soft: Applications using files stored on an NFS will wait a specified time (using the timeo option) if the server goes down, and after that, will throw an error. intr: Allows user interruption of processes waiting on a NFS request. timeo=: For use with the soft option. Specify the timeout for an NFS request. nolock: Disable file locks. Useful with older NFS servers. noexec: Disable execution of binaries or scripts on an NFS share. nosuid: Prevents users from gaining ownership of files on the NFS share. rsize=: Sets the read block data size. Defaults to 8192 on NFSv2 and NFSv3, and 32768 on NFSv4. wsize=: Sets the write block data size. Defaults to 8192 on NFSv2 and NFSv3, and 32768 on NFSv4. Server rw: Read/write filesystem. ro: Force clients to connect in the read-only filesystem mode only. no_root_squash: The root account on the client machine will have the same privilege level as the root on the server machine. This option has security implications; do not use unless you are sure you need it. no_subtree_check: Disable file location checks on partial volume exports. This option will speed up transfers on full volume exports. sync: Force all transfers to operate in synchronous mode, so all clients will wait until their operations are really done. This can avoid data corruption in the event of a server crash."},{"location":"linux_services/NIPAP/","title":"NIPAP","text":"<p>NIPAP \u00e4r ett IPAM-system som \u00e4r skrivet i python och \u00e4r open source. Det finns b\u00e5de webgui och cli f\u00f6r att managera datan som sparas i en postgres-DB. Demo: http://nipap-demo.spritelink.net/</p>"},{"location":"linux_services/NIPAP/#installation","title":"Installation","text":"<p>Debian eller Ubuntu</p> <p><code>echo\u00a0\"deb</code><code>http://spritelink.github.io/NIPAP/repos/apt</code><code>stable\u00a0main\u00a0extra\"\u00a0&gt;\u00a0/etc/apt/sources.list.d/nipap.list</code> <code>wget\u00a0-O\u00a0-</code><code>https://spritelink.github.io/NIPAP/nipap.gpg.key</code><code>|\u00a0apt-key\u00a0add\u00a0-</code> <code>apt-get\u00a0update\u00a0&amp;&amp;\u00a0apt-get\u00a0-y\u00a0install\u00a0nipapd</code></p> <p>Svara Yes p\u00e5 fr\u00e5gorna f\u00f6r att autoskapa databas</p> <p><code>apt-get\u00a0-y\u00a0install\u00a0nipap-www</code></p> <p>\u00c5terigen yes f\u00f6r att skapa ett anv\u00e4ndarkonto f\u00f6r frontend till backend</p>"},{"location":"linux_services/NIPAP/#konfiguration","title":"Konfiguration","text":"<p>I denna guide g\u00f6rs allt p\u00e5 samma maskin men frontend accessas fr\u00e5n andra maskiner. Det beh\u00f6vs ett konto f\u00f6r att logga in p\u00e5 webguit.</p> <p><code>nipap-passwd\u00a0add\u00a0--user\u00a0user1\u00a0--password\u00a0mypasswort\u00a0--name\u00a0\"the\u00a0man\"</code></p>"},{"location":"linux_services/NIPAP/#apache","title":"Apache","text":"<p><code>apt-get\u00a0-y\u00a0install\u00a0apache2\u00a0&amp;&amp;\u00a0apt-get\u00a0-y\u00a0install\u00a0libapache2-mod-wsgi</code> <code>nano\u00a0/etc/apache2/sites-available/000-default.conf</code> <code>&lt;VirtualHost\u00a0*:80&gt;</code> <code>DocumentRoot\u00a0/var/www/html</code> <code>ErrorLog\u00a0${APACHE_LOG_DIR}/error.log</code> <code>CustomLog\u00a0${APACHE_LOG_DIR}/access.log\u00a0combined</code></p> <p><code>WSGIScriptAlias\u00a0/\u00a0/etc/nipap/nipap-www.wsgi</code> <code>&lt;Directory\u00a0\"/etc/nipap\"&gt;</code> <code>Order\u00a0allow,deny</code> <code>Allow\u00a0from\u00a0all</code> <code>&lt;Files\u00a0nipap-www.wsgi&gt;</code> <code>Require\u00a0all\u00a0granted</code> <code></code> <code></code> </p> <p><code>chown\u00a0-R\u00a0www-data:www-data\u00a0/var/cache/nipap-www\u00a0&amp;&amp;\u00a0chmod\u00a0-R\u00a0u=rwX\u00a0/var/cache/nipap-www</code> <code>sudo\u00a0service\u00a0apache2\u00a0restart</code></p>"},{"location":"linux_services/NIPAP/#ldap","title":"LDAP","text":"<p>B\u00f6rja med att installera python-ldap modul.</p> <p><code>apt-get\u00a0install\u00a0python-ldap</code></p> <p>\u00c4ndra sedan i <code>/etc/nipap/nipap.conf</code> filen till f\u00f6ljande.</p> <p><code>default_backend\u00a0=\u00a0ldap</code></p> <p><code>basedn\u00a0=\u00a0dc=hackernet,dc=se</code> <code>uri\u00a0=</code><code>ldap://IP</code> <code>binddn_fmt\u00a0=\u00a0uid={},ou=users,dc=hackernet,dc=se</code> <code>search\u00a0=\u00a0uid={}</code> <code>search_binddn\u00a0=\u00a0cn=admin,dc=hackernet,dc=se</code> <code>search_password\u00a0=\u00a0secretpw</code> <code>rw_group\u00a0=\u00a0cn=nipap,dc=hackernet,dc=se</code></p> <p>Skapa sedan en grupp som heter nipap och som har st\u00f6d f\u00f6r memberOf. Anv\u00e4ndare i denna gruppen f\u00e5r read/write r\u00e4ttigheter.</p>"},{"location":"linux_services/NIPAP/#cli","title":"CLI","text":"<p>Med ett cli g\u00e5r det snabbare att fylla databasen om det handlar om stora datam\u00e4ngder.</p> <p><code>apt-get\u00a0-y\u00a0install\u00a0nipap-cli</code> <code>nipap-passwd\u00a0add\u00a0--user\u00a0cli-master-flash\u00a0--password\u00a0olasamigossenior\u00a0--name\u00a0\"the\u00a0CLI\u00a0man\"</code> <code>touch\u00a0~/.nipaprc\u00a0&amp;&amp;\u00a0chmod\u00a00600\u00a0.nipaprc\u00a0&amp;&amp;\u00a0nano\u00a0.nipaprc</code> <code>[global]</code> <code>hostname\u00a0=\u00a0localhost</code> <code>port\u00a0\u00a0\u00a0\u00a0\u00a0=\u00a01337</code> <code>username\u00a0=\u00a0cli-master-flash</code> <code>password\u00a0=\u00a0olasamigossenior</code> <code>default_vrf_rt\u00a0=\u00a0none</code> <code>default_list_vrf_rt\u00a0=\u00a0all</code></p> <p><code>nipap\u00a0address\u00a0add\u00a0prefix\u00a0192.0.2.0/24\u00a0type\u00a0assignment\u00a0description\u00a0\"MGM-network\"</code> <code>nipap\u00a0address\u00a0add\u00a0prefix\u00a0172.20.0.10\u00a0type\u00a0host\u00a0node\u00a0\"SW01\"\u00a0description\u00a0\"L3-switch\"</code></p>"},{"location":"linux_services/NIPAP/#debug","title":"Debug","text":"<p><code>sudo\u00a0nipapd\u00a0-d\u00a0-f\u00a0--no-pid-file</code></p> <p>Category:Guider</p>"},{"location":"linux_services/Netdisco/","title":"Netdisco","text":"<p>Category:Guider Netdisco h\u00e4mtar MAC-tabeller, ARP-tabeller, VLAN-databaser, LLDP/CDP-grannskap, firmwareversioner, m.m fr\u00e5n routrar och switchar med hj\u00e4lp av SNMP. Man schemal\u00e4gger n\u00e4r data ska samlas in, dvs det \u00e4r inte realtids\u00f6vervakning.</p> <p>Denna guide \u00e4r minimalistiskt utformad, f\u00f6r kommandof\u00f6rklaringar se referensguide alternativt google. Referens:</p> <p><code>https://metacpan.org/pod/App</code><code>::Netdisco</code></p>"},{"location":"linux_services/Netdisco/#installation","title":"Installation","text":"<p>Ubuntu 14.04.1 LTS Server x64 Denna guide \u00e4r till stor del h\u00e4mtad fr\u00e5n: http://blog.asiantuntijakaveri.fi/2014/08/netdisco2-on-ubuntu-1404.html</p> <p><code>sudo\u00a0su\u00a0-</code> <code>apt-get\u00a0update\u00a0&amp;&amp;\u00a0apt-get\u00a0-y\u00a0dist-upgrade\u00a0&amp;&amp;\u00a0apt-get\u00a0-y\u00a0install\u00a0open-vm-tools\u00a0build-essential\u00a0wget\u00a0lftp\u00a0mtr-tiny\u00a0zip\u00a0ntp\u00a0fail2ban\u00a0curl</code> <code>echo\u00a0\"net.ipv6.conf.all.disable_ipv6=1\"\u00a0&gt;&gt;/etc/sysctl.conf</code></p>"},{"location":"linux_services/Netdisco/#databas","title":"Databas","text":"<p><code>apt-get\u00a0-y\u00a0install\u00a0libdbd-pg-perl\u00a0libsnmp-perl\u00a0postgresql\u00a0pgtune</code> <code>mv\u00a0/etc/postgresql/9.3/main/postgresql.conf\u00a0/etc/postgresql/9.3/main/postgresql.conf.old</code> <code>pgtune\u00a0-i\u00a0/etc/postgresql/9.3/main/postgresql.conf.old\u00a0-o\u00a0/etc/postgresql/9.3/main/postgresql.conf</code></p> <p>Switch to postgres user and create new SQL user</p> <p><code>su\u00a0-\u00a0postgres</code> <code>createuser\u00a0-DRSP\u00a0netdisco</code> <code>(Enter\u00a0some\u00a0DB\u00a0password\u00a0here)</code> <code>createdb\u00a0--owner\u00a0netdisco\u00a0netdisco</code></p> <p>Switch back to root</p> <p><code>exit</code></p>"},{"location":"linux_services/Netdisco/#netdisco","title":"Netdisco","text":"<p><code>adduser\u00a0netdisco\u00a0--shell\u00a0/bin/bash\u00a0--disabled-password\u00a0--gecos\u00a0netdisco\u00a0&amp;&amp;\u00a0su\u00a0-\u00a0netdisco</code> <code>curl\u00a0-L</code><code>http://cpanmin.us/</code><code>|\u00a0perl\u00a0-\u00a0--notest\u00a0--local-lib\u00a0~/perl5\u00a0App::Netdisco</code></p>"},{"location":"linux_services/Netdisco/#konfiguration","title":"Konfiguration","text":"<p><code>mkdir\u00a0~/bin\u00a0&amp;&amp;\u00a0mkdir\u00a0~/environments\u00a0&amp;&amp;\u00a0ln\u00a0-s\u00a0~/perl5/bin/{localenv,netdisco-*}\u00a0~/bin/</code> <code>~/bin/netdisco-daemon\u00a0status</code></p> <p>H\u00e4r \u00e4r grunden f\u00f6r deploymenten, l\u00e4gg till de SNMP-communitys som ska anv\u00e4ndas. Schemal\u00e4ggningen \u00e4r i cron-format. I exemplet g\u00f6rs discoverall 10 \u00f6ver varje timme. OBS Om detta g\u00f6rs i en virtuell maskin tas f\u00f6rslagsvis en snapshot h\u00e4r.</p> <p><code>cat\u00a0&lt;&lt;'__EOF__'&gt;~/environments/deployment.yml</code> <code>database:</code> <code>name:\u00a0'netdisco'</code> <code>user:\u00a0'netdisco'</code> <code>pass:\u00a0'(PW\u00a0som\u00a0sattes\u00a0tidigare)'</code> <code>safe_password_store:\u00a0true</code> <code>snmp_auth:</code> <code>-\u00a0tag:\u00a0'default_1'</code> <code>community:\u00a0'puplic'</code> <code>read:\u00a0true</code> <code>write:\u00a0false</code> <code>-\u00a0tag:\u00a0'default_2'</code> <code>community:\u00a0'public'</code> <code>read:\u00a0true</code> <code>write:\u00a0false</code> <code>-\u00a0tag:\u00a0'v3example'</code> <code>user:\u00a0netdisco</code> <code>auth:</code> <code>pass:\u00a0netdiscokey</code> <code>proto:\u00a0SHA</code> <code>priv:</code> <code>pass:\u00a0netdiscokey2</code> <code>proto:\u00a0AES</code> <code>schedule:</code> <code>discoverall:</code> <code>when:\u00a0'10\u00a0*\u00a0*\u00a0*\u00a0*'</code> <code>macwalk:</code> <code>when:\u00a0'35\u00a0*\u00a0*\u00a0*\u00a0*'</code> <code>arpwalk:</code> <code>when:\u00a0'45\u00a0*\u00a0*\u00a0*\u00a0*'</code> <code>nbtwalk:</code> <code>when:\u00a0'55\u00a0*\u00a0*\u00a0*\u00a0*'</code> <code>expire:</code> <code>when:\u00a0'15\u00a023\u00a0*\u00a0*\u00a0*'</code> <code>dns:</code> <code>max_outstanding:\u00a050</code> <code>workers:</code> <code>tasks:\u00a0'AUTO\u00a0*\u00a05'</code> <code>__EOF__</code></p> <p><code>~/bin/netdisco-deploy</code></p> <p>Svara ja p\u00e5 allt och s\u00e4tt credentials f\u00f6r web gui:t.</p> <p>Skapa script f\u00f6r att starta Netdisco med listener port 5000</p> <p><code>cat\u00a0&lt;&lt;'__EOF__'&gt;~/run-netdisco.sh</code> <code>#!/bin/bash</code> <code>~/bin/netdisco-web\u00a0start\u00a0--port=5000</code> <code>sleep\u00a05</code> <code>~/bin/netdisco-daemon\u00a0start</code> <code>__EOF__</code> <code>chmod\u00a0a+x\u00a0~/run-netdisco.sh</code></p> <p><code>~/run-netdisco.sh</code></p> <p>Switch back to root</p> <p><code>exit</code> <code>echo\u00a0\"(\u00a0sudo\u00a0su\u00a0-\u00a0netdisco\u00a0-c\u00a0'/home/netdisco/run-netdisco.sh'\u00a0)\u00a0&amp;\"\u00a0&gt;/etc/rc.local</code> <code>reboot</code></p>"},{"location":"linux_services/Netdisco/#webgui","title":"WEBGUI","text":"<p>Logga in p\u00e5 http://%5BIP%5D:5000</p> <p>B\u00f6rja med att mata in IP-adress p\u00e5 en switch eller router som ska \u00f6vervakas p\u00e5 f\u00f6rstasidan. V\u00e4nta och se hur mycket som uppt\u00e4cks. \u00c4r allt r\u00e4tt konfigurerat kommer v\u00e4ldigt mycket att uppt\u00e4ckas.</p>"},{"location":"linux_services/Netdisco/#enheter-som-ska-overvakas","title":"Enheter som ska \u00f6vervakas","text":"<p>Logga in p\u00e5 diverse enhet som ska \u00f6vervakas och l\u00e4gg till community samt IP f\u00f6r Netdiscomaskinen.</p>"},{"location":"linux_services/Netdisco/#underhall","title":"Underh\u00e5ll","text":"<p>upgrade Netdisco</p> <p><code>~/bin/localenv\u00a0cpanm\u00a0--notest\u00a0App::Netdisco</code></p> <p>apply database schema updates</p> <p><code>~/bin/netdisco-deploy</code></p> <p>restart web service</p> <p><code>~/bin/netdisco-web\u00a0restart</code></p> <p>restart job daemon</p> <p><code>~/bin/netdisco-daemon\u00a0restart</code></p>"},{"location":"linux_services/Network/","title":"Network","text":"<p>H\u00e4r finns alla v\u00e5ra n\u00e4tverks specifika artiklar som vi skrivit.</p>"},{"location":"linux_services/Network/#arista","title":"Arista","text":"<p> category = Arista ordermethod = sortkey order = ascending </p>"},{"location":"linux_services/Network/#cisco","title":"Cisco","text":"<p> category = Cisco ordermethod = sortkey order = ascending </p>"},{"location":"linux_services/Network/#cumulus-networks","title":"Cumulus Networks","text":"<p> category = Cumulus ordermethod = sortkey order = ascending </p>"},{"location":"linux_services/Network/#extreme-networks","title":"Extreme Networks","text":"<p> category = Extreme ordermethod = sortkey order = ascending </p>"},{"location":"linux_services/Network/#f5","title":"F5","text":"<p> category = F5 ordermethod = sortkey order = ascending </p>"},{"location":"linux_services/Network/#juniper","title":"Juniper","text":"<p> category = Juniper ordermethod = sortkey order = ascending </p>"},{"location":"linux_services/Network/#linux-others","title":"Linux &amp; Others","text":"<p> category = Network ordermethod = sortkey order = ascending </p>"},{"location":"linux_services/Nginx/","title":"Nginx","text":"<p>Category:Guider Nginx anv\u00e4nds som webbserver av mer \u00e4n 60% av v\u00e4rldens top 100,000 hemsidor. Men Nginx kan vara mycket mer \u00e4n bara en webbserver. Ett litet urval vad Nginx kan anv\u00e4ndas som:</p> <ul> <li>Reverse proxy</li> <li>Load balancer</li> <li>HTTP Cache</li> <li>RTMP Server</li> </ul>"},{"location":"linux_services/Nginx/#installation","title":"Installation","text":"<ul> <li>#tab1|CentOS 7</li> <li>#tab2|Ubuntu 16.04</li> </ul>   B\u00f6rja med att installera epel-repot:  `yum\u00a0install\u00a0epel-release:`  Installera Nginx:  `yum\u00a0install\u00a0nginx`  Starta Nginx:  `systemctl\u00a0start\u00a0nginx`  G\u00f6r s\u00e5 Nginx startar automatiskt vid reboot:  `systemctl\u00a0enable\u00a0nginx.service`  L\u00e4gg till firewalld regler om det beh\u00f6vs.  `firewall-cmd\u00a0--permanent\u00a0--zone=public\u00a0--add-service=http\u00a0` `firewall-cmd\u00a0--permanent\u00a0--zone=public\u00a0--add-service=https` `firewall-cmd\u00a0--reload` `\u00a0\u00a0`     Installera Nginx:  `apt-get\u00a0update` `apt-get\u00a0-y\u00a0install\u00a0nginx`  Kolla s\u00e5 Nginx k\u00f6rs:  `systemctl\u00a0status\u00a0nginx` `\u00a0\u00a0`"},{"location":"linux_services/Nginx/#kommandon","title":"Kommandon","text":"<ul> <li>Testa om det \u00e4r en giltig konfiguration innan man startar om     nginx:<code>nginx -t</code></li> <li>Ladda om confen utan att starta om nginx:<code>nginx -s reload</code></li> </ul>"},{"location":"linux_services/Nginx/#konfiguration","title":"Konfiguration","text":""},{"location":"linux_services/Nginx/#reverse-proxy","title":"Reverse Proxy","text":"<p>Nginx fungerar utm\u00e4rkt som en reverse proxy f\u00f6r webbtrafik.</p> <p>Exempel</p> <p><code>server\u00a0{</code> <code>listen\u00a080;</code> <code>server_name\u00a0sub.dom\u00e4n.se;</code> <code>location\u00a0/\u00a0{</code> <code>proxy_pass</code><code>http://10.0.0.10:3000</code><code>;</code> <code>include\u00a0/etc/nginx/proxy_params;</code> <code>}</code> <code>}</code></p>"},{"location":"linux_services/Nginx/#rewrite-redirect","title":"Rewrite &amp; Redirect","text":""},{"location":"linux_services/Nginx/#tabort-www","title":"Tabort www","text":"<p>Om man inte vill ha www i sin URL s\u00e5 skapar man 2 servrar som man sedan k\u00f6r en redirect till.</p> <pre><code>server {\n    listen 80;\n    server_name dom\u00e4n.se;\n}\n server {\n    listen 80;\n    server_name www.dom\u00e4n.se;\n    return 301 $scheme://dom\u00e4n.se$request_uri;\n }\n</code></pre>"},{"location":"linux_services/Nginx/#redirect-http-till-https","title":"Redirect HTTP till HTTPS","text":"<p>H\u00e4r beh\u00f6ver man ocks\u00e5 skapa 2st server delar.</p> <pre><code>server {\n  listen      80;\n  server_name dom\u00e4n.se;\n  return 301  https://dom\u00e4n.se$request_uri;\n}\nserver {\n  listen      443 ssl;\n\n  # let the browsers know that we only accept HTTPS\n  add_header Strict-Transport-Security max-age=2592000;\n}\n</code></pre>"},{"location":"linux_services/Nginx/#redirect-http-till-https-ej-standardport","title":"Redirect HTTP till HTTPS, ej standardport","text":"<p>Nginx har en egen HTTP-statuskod f\u00f6r detta.</p> <p><code>server\u00a0{</code> <code>listen\u00a0\u00a0\u00a0\u00a0\u00a0\u00a01234\u00a0ssl;</code> <code>server_name\u00a0sub.dom\u00e4n.se;</code> <code>...</code> <code>error_page\u00a0\u00a0497</code><code>https://$host:1234$request_uri</code><code>;</code> <code>...</code> <code>}</code></p>"},{"location":"linux_services/Nginx/#https","title":"HTTPS","text":"<p>Konfigurationsexempel med s\u00e4kerhet i fokus.</p> <p><code>https://syslink.pl/cipherlist/</code></p> <p><code>server\u00a0{</code> <code>listen\u00a0443\u00a0ssl;</code> <code>server_name\u00a0secure.dom\u00e4n.se;</code> <code>add_header\u00a0Strict-Transport-Security\u00a0max-age=15768000;</code> <code>add_header\u00a0X-Frame-Options\u00a0DENY;</code> <code>add_header\u00a0X-Content-Type-Options\u00a0nosniff;</code> <code>ssl_certificate\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0/path/to/cert.crt;</code> <code>ssl_certificate_key\u00a0\u00a0\u00a0\u00a0\u00a0/path/to/key.pem;</code> <code>ssl_protocols\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0TLSv1\u00a0TLSv1.1\u00a0TLSv1.2;</code> <code>ssl_ciphers\u00a0'ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:!aNULL:!eNULL:!EXPORT:!CAMELLIA:!DES:!MD5:!PSK:!DSS:!RC4';</code> <code>ssl_prefer_server_ciphers\u00a0on;</code> <code>ssl_dhparam\u00a0/path/to/dhparam.pem;</code> <code>...</code> <code>}</code></p> <p>Generera DH-parametrar med tidtagning. Det tar l\u00e5ng tid!</p> <p><code>time\u00a0openssl\u00a0dhparam\u00a0-out\u00a0/path/to/dhparam.pem\u00a04096</code></p>"},{"location":"linux_services/Nginx/#nyckelsakerhet","title":"Nyckels\u00e4kerhet","text":"<p>Av s\u00e4kerhetssk\u00e4l b\u00f6r endast root har r\u00e4tt att l\u00e4sa de privata nycklarna. Nginx processer fungerar default enligt:</p> <ul> <li>1 nginx master process k\u00f6rs som root</li> <li>x nginx workers k\u00f6rs som www-data</li> </ul> <p>Nginx master process l\u00e4ser SSL-nycklarna, inte worker-processerna. D\u00e4rf\u00f6r fungerar det utm\u00e4rkt att k\u00f6ra f\u00f6ljande.</p> <p><code>sudo\u00a0chown\u00a0root:root\u00a0certificate.key</code> <code>sudo\u00a0chmod\u00a0400\u00a0certificate.key</code></p>"},{"location":"linux_services/Nginx/#spdy","title":"SPDY","text":"<p>SPDY \u00e4r ett protokoll utvecklat av Google f\u00f6r att g\u00f6ra HTTPS-handskakning lite snabbare. Alla moderna webbl\u00e4sare har st\u00f6d f\u00f6r det. Din nginx m\u00e5ste vara kompilerad med \u2013with-http_spdy_module.</p> <p><code>nginx\u00a0-V</code> <code>sudo\u00a0sed\u00a0-i\u00a0-r\u00a0's/listen\u00a0443\u00a0ssl/listen\u00a0443\u00a0ssl\u00a0spdy/g'\u00a0/etc/nginx/sites-available/dinSSLsite</code> <code>sudo\u00a0service\u00a0nginx\u00a0reload</code></p> <p>http://SPDYCheck.org</p>"},{"location":"linux_services/Nginx/#rtmp","title":"RTMP","text":"<p>Nginx rtmp modul fungerar utm\u00e4rkt om man vill kunna streama n\u00e5got till 2 platser samtidigt tex till Twitch och Hitbox utan att beh\u00f6va ha ig\u00e5ng 2 instanser av tex OBS/Xsplit.</p> <p>F\u00f6r att f\u00e5 in RTMP modulen s\u00e5 m\u00e5ste man compilera nginx fr\u00e5n b\u00f6rjan.</p> <p><code>apt-get\u00a0update\u00a0&amp;&amp;\u00a0apt-get\u00a0install\u00a0build-essential\u00a0libpcre3\u00a0libpcre3-dev\u00a0libssl-dev</code></p> <p>H\u00e4mta hem senaste versionen av nginx och rtmp modulen.</p> <p><code>wget</code><code>http://nginx.org/download/nginx-1.7.9.tar.gz</code> <code>wget</code><code>https://github.com/arut/nginx-rtmp-module/archive/master.zip</code></p> <p>Packa upp filerna</p> <p><code>tar\u00a0-zxvf\u00a0nginx-1.7.9.tar.gz</code> <code>unzip\u00a0master.zip</code> <code>cd\u00a0nginx-1.7.9</code></p> <p>L\u00e4gg sedan till rtmp modulen i nginx.</p> <p><code>./configure\u00a0--add-module=../nginx-rtmp-module-master</code> <code>make</code> <code>make\u00a0install</code></p> <p>Om du inte f\u00e5tt n\u00e5gra error s\u00e5 \u00e4r nginx med rtmp modulen installerade.</p> <p>\u00c4ndra och l\u00e4gg till f\u00f6ljande rader i din conf fil. <code>/usr/local/nginx/conf/nginx.conf</code></p> <p><code>rtmp\u00a0{</code> <code>server\u00a0{</code> <code>listen\u00a01935;</code> <code>chunk_size\u00a08192;</code></p> <p><code>application\u00a0stream\u00a0{</code> <code>live\u00a0on;</code> <code>meta\u00a0copy;</code> <code>push</code><code>rtmp://live-ams.twitch.tv/app/live_XYZ_ZXY</code><code>;</code> <code>push</code><code>rtmp://live.hitbox.tv/push/username?key=XYZ</code><code>;</code> <code>}</code> <code>}</code> <code>}</code></p> <p>F\u00f6r att starta nginx server skriv</p> <p><code>/usr/local/nginx/sbin/nginx</code></p> <p>F\u00f6r att stoppa nginx servern.</p> <p><code>/usr/local/nginx/sbin/nginx\u00a0-s</code></p> <p>St\u00e4ll in din klient att streama mot /stream"},{"location":"linux_services/Nginx/#php","title":"PHP","text":"<p>F\u00f6r att kunna visa PHP sidor beh\u00f6vs PHP-FastCGI.</p> <p><code>apt-get\u00a0install\u00a0php5-cli\u00a0php5-cgi\u00a0spawn-fcgi\u00a0php-pear</code> <code>wget\u00a0-O\u00a0/usr/bin/php-fastcgi</code><code>http://www.linode.com/docs/assets/1548-php-fastcgi-deb.sh</code><code>&amp;&amp;\u00a0chmod\u00a0+x\u00a0/usr/bin/php-fastcgi</code> <code>wget\u00a0-O\u00a0/etc/init.d/php-fastcgi</code><code>http://www.linode.com/docs/assets/1549-init-php-fastcgi-deb.sh</code><code>&amp;&amp;\u00a0chmod\u00a0+x\u00a0/etc/init.d/php-fastcgi\u00a0&amp;&amp;\u00a0update-rc.d\u00a0php-fastcgi\u00a0defaults</code> <code>/etc/init.d/php-fastcgi\u00a0start</code></p> <p>L\u00e4gg till f\u00f6ljande i din conf fil.</p> <pre><code>    location ~* \\.php$ {\n        include fastcgi_params;\n        try_files $uri =404;\n        fastcgi_pass 127.0.0.1:9000;\n        fastcgi_param SCRIPT_FILENAME $request_filename;\n    }\n</code></pre> <p>skapa en php info fil i din rooten p\u00e5 webbservern f\u00f6r att testa din php conf.</p> <pre><code>echo \"&lt;?php phpinfo(); ?&gt;\" &gt; info.php\n</code></pre>"},{"location":"linux_services/Nginx/#naxsi","title":"Naxsi","text":"<p>Third party Nginx-modul, motsvarighet till ModSecurity. G\u00e5r att k\u00f6ra i learning mode.</p> <p><code>sudo\u00a0apt-get\u00a0install\u00a0nginx-naxsi</code></p>"},{"location":"linux_services/Nginx/#tips-n-trix","title":"Tips n Trix","text":""},{"location":"linux_services/Nginx/#fail2ban","title":"Fail2ban","text":"<p><code>sudo\u00a0nano\u00a0/etc/fail2ban/jail.conf</code> <code>[nginx-http-auth]</code> <code>enabled\u00a0=\u00a0true</code></p>"},{"location":"linux_services/Nginx/#enable-directory-listing","title":"Enable directory listing","text":"<p>Om du vill att nginx ska lista filerna i en mapp som inte har n\u00e5gon index fil. L\u00e4gg f\u00f6ljande under <code>location</code> som du vill lista.</p> <p><code>autoindex\u00a0on;</code></p>"},{"location":"linux_services/Nginx/#rate-limit","title":"Rate Limit","text":"<p>Man kan begr\u00e4nsa bandbredden f\u00f6r en viss IP eller subn\u00e4t.</p> <pre><code> location / {\n  if ( $remote_addr ~* 192.100.20.0/24 ) {\n    limit_rate 5k;\n  }\n }\n</code></pre>"},{"location":"linux_services/Ntopng/","title":"Ntopng","text":"<p>High-Speed Web-based Traffic Analysis and Flow Collection.</p>"},{"location":"linux_services/Ntopng/#installation","title":"Installation","text":"<p>14.04</p> <p><code>wget</code><code>http://www.nmon.net/apt-stable/14.04/all/apt-ntop.deb</code><code>&amp;&amp;\u00a0sudo\u00a0dpkg\u00a0-i\u00a0apt-ntop.deb</code> <code>sudo\u00a0apt-get\u00a0clean\u00a0all\u00a0&amp;&amp;\u00a0sudo\u00a0apt-get\u00a0update\u00a0&amp;&amp;\u00a0sudo\u00a0apt-get\u00a0-y\u00a0install\u00a0ntopng\u00a0ntopng-data\u00a0nbox\u00a0libzmq3\u00a0libhiredis0.10</code> <code>sudo\u00a0service\u00a0apache2\u00a0restart</code></p> <p>16.04</p> <p><code>wget</code><code>http://packages.ntop.org/apt-stable/16.04/all/apt-ntop.deb</code><code>&amp;&amp;\u00a0sudo\u00a0dpkg\u00a0-i\u00a0apt-ntop.deb</code> <code>sudo\u00a0apt-get\u00a0clean\u00a0all\u00a0&amp;&amp;\u00a0sudo\u00a0apt-get\u00a0update\u00a0&amp;&amp;\u00a0sudo\u00a0apt-get\u00a0-y\u00a0install\u00a0ntopng\u00a0ntopng-data\u00a0nbox\u00a0nprobe</code> <code>sudo\u00a0service\u00a0apache2\u00a0restart</code></p>"},{"location":"linux_services/Ntopng/#konfiguration","title":"Konfiguration","text":"<p>Konfigurationen ligger i /etc/ntopng.conf men allt kan g\u00f6ras med nbox gui:</p> <p><code>https://</code> <p>credentials: nbox:nbox ntopng konfas och startas fr\u00e5n webgui:t</p>"},{"location":"linux_services/Ntopng/#portspegling","title":"Portspegling","text":"<p>Det finns olika s\u00e4tt att f\u00e5 den speglade trafiken till ntop.</p> <ul> <li>vSwitch: Promiscuous mode</li> <li>dvSwitch: Distributed Port Mirroring</li> <li>Fysisk switch: SPAN/RSPAN/ERSPAN</li> </ul> <p>Listener Port</p> <p><code>echo\u00a0\"auto\u00a0eth1\"\u00a0|\u00a0sudo\u00a0tee\u00a0-a\u00a0/etc/network/interfaces</code> <code>echo\u00a0\"iface\u00a0eth1\u00a0inet\u00a0manual\"\u00a0|\u00a0sudo\u00a0tee\u00a0-a\u00a0/etc/network/interfaces</code></p>"},{"location":"linux_services/Ntopng/#netflow","title":"NetFlow","text":"<p>In ntopng flows are collected through nProbe that act as probe/proxy. The communication between nProbe and ntopng happens though ZeroMQ that decouples ntopng from nProbe.</p> <p>OBS nprobe kr\u00e4ver licens, se \u00e4ven Cisco NetFlow.</p> <p><code>sudo\u00a0nprobe\u00a0--zmq\u00a0\"tcp://*:5556\"\u00a0-i\u00a0none\u00a0[eth0]\u00a0-n\u00a0none\u00a0--collector-port\u00a02055\u00a0&amp;</code> <code>sudo\u00a0ntopng\u00a0-i\u00a0tcp://127.0.0.1:5556</code></p> <p>nProbe modes left|607x607px</p> <p>Category:Guider</p>"},{"location":"linux_services/OSSEC/","title":"OSSEC","text":"<p>Category:Guider OSSEC \u00e4r ett host intrusion detection system. OSSEC monitorerar aktivt dina filer, logar, processer och letar efter rootkit's. OSSEC anv\u00e4nder agenter f\u00f6r att \u00f6vervaka system, det g\u00e5r ocks\u00e5 att k\u00f6ra agentless och via remote syslog.</p>"},{"location":"linux_services/OSSEC/#supportade-os","title":"Supportade OS","text":""},{"location":"linux_services/OSSEC/#agent","title":"Agent","text":"<ul> <li>GNU/Linux (all distributions, including RHEL, Ubuntu, Slackware,     Debian, etc)</li> <li>Windows XP, 2003, Vista, 2008, 2012</li> <li>VMWare ESX 3.0,3.5 (including CIS checks)</li> <li>FreeBSD (all current versions)</li> <li>OpenBSD (all current versions)</li> <li>NetBSD (all current versions)</li> <li>Solaris 2.7, 2.8, 2.9 and 10</li> <li>AIX 5.2 and 5.3</li> <li>Mac OS X 10.x</li> <li>HP-UX 11</li> </ul>"},{"location":"linux_services/OSSEC/#syslog","title":"Syslog","text":"<ul> <li>Cisco PIX, ASA and FWSM (all versions)</li> <li>Cisco IOS routers (all versions)</li> <li>Juniper Netscreen (all versions)</li> <li>SonicWall firewall (all versions)</li> <li>Checkpoint firewall (all versions)</li> <li>Cisco IOS IDS/IPS module (all versions)</li> <li>Sourcefire (Snort) IDS/IPS (all versions)</li> <li>Dragon NIDS (all versions)</li> <li>Checkpoint Smart Defense (all versions)</li> <li>McAfee VirusScan Enterprise (v8 and v8.5)</li> <li>Bluecoat proxy (all versions)</li> <li>Cisco VPN concentrators (all versions)</li> <li>VMWare ESXi 4.x</li> </ul>"},{"location":"linux_services/OSSEC/#agentless","title":"Agentless","text":"<ul> <li>Cisco PIX, ASA and FWSM (all versions)</li> <li>Cisco IOS routers (all versions)</li> <li>Juniper Netscreen (all versions)</li> <li>SonicWall firewall (all versions)</li> <li>Checkpoint firewall (all versions)</li> <li>All operating systems specified in the \u201coperating systems\u201d section</li> </ul>"},{"location":"linux_services/OSSEC/#installation","title":"Installation","text":"<p>OSSEC \u00e4r uppdelat i server/manager som sedan pratar med agenter som installeras p\u00e5 varje host. Webuit f\u00e5r man installera separat om man vill anv\u00e4nda det.</p>"},{"location":"linux_services/OSSEC/#servermanager-agent","title":"Server/Manager &amp; Agent","text":""},{"location":"linux_services/OSSEC/#debianubuntu","title":"Debian/Ubuntu","text":"<p>L\u00e4gg till repo nyklarna.</p> <p><code>apt-key\u00a0adv\u00a0--fetch-keys</code><code>http://ossec.wazuh.com/repos/apt/conf/ossec-key.gpg.key</code></p> <p>F\u00f6ljande Debian distar finns det st\u00f6d f\u00f6r jessie,wheezy,strectch och sid.</p> <p><code>echo\u00a0\"deb</code><code>http://ossec.wazuh.com/repos/apt/debian</code><code>wheezy\u00a0main\"\u00a0&gt;&gt;\u00a0/etc/apt/sources.list</code></p> <p>Om du ist\u00e4llet k\u00f6r Ubuntu s\u00e5 finns det st\u00f6d f\u00f6r xenial, precise, trusty, vivid eller wily.</p> <p><code>echo\u00a0\"deb</code><code>http://ossec.wazuh.com/repos/apt/ubuntu</code><code>precise\u00a0main\"\u00a0&gt;&gt;\u00a0/etc/apt/sources.list</code></p> <p>Uppdatera repot.</p> <p><code>apt-get\u00a0update</code></p> <p>F\u00f6r att installera Server/Manager.</p> <p><code>apt-get\u00a0install\u00a0ossec-hids</code></p> <p>Eller installera agenten.</p> <p><code>apt-get\u00a0install\u00a0ossec-hids-agent</code></p>"},{"location":"linux_services/OSSEC/#rpm-based","title":"RPM based","text":"<p>L\u00e4gg till yum repo.</p> <p><code>wget\u00a0-q\u00a0-O\u00a0-</code><code>https://updates.atomicorp.com/installers/atomic</code><code>|sh</code></p> <p>Installera sedan servern/managern.</p> <p><code>yum\u00a0install\u00a0ossec-hids\u00a0ossec-hids-server</code></p> <p>Eller agenten.</p> <p><code>yum\u00a0install\u00a0ossec-hids\u00a0ossec-hids-client</code></p>"},{"location":"linux_services/OSSEC/#webui","title":"WEBui","text":"<p>F\u00f6r att k\u00f6ra webui kr\u00e4vs:</p> <ul> <li>Apache/Nginx med PHP (&gt;= 4.1 or &gt;= 5.0) installerat.</li> <li>OSSEC (version &gt;= 0.9-3)</li> </ul> <p><code>git\u00a0clone</code><code>https://github.com/ossec/ossec-wui.git</code><code>/var/www/ossec</code> <code>cd\u00a0/var/www/ossec\u00a0&amp;&amp;\u00a0./setup.sh</code></p> <p>Om man har selinux p\u00e5 g\u00f6r det att man inte kan n\u00e5 visa ossec log filer. F\u00f6r att fixa kan man l\u00e4gga till en policy.</p> <p>Skapa en TE fil: <code>/etc/seliinux/targeted/ossec-wui/ossec-wui.te</code> med f\u00f6ljande inneh\u00e5ll.</p> <p><code>module\u00a0ossec-wui\u00a01.0;</code></p> <p><code>require\u00a0{</code> <code>type\u00a0var_log_t;</code> <code>type\u00a0httpd_t;</code> <code>type\u00a0var_t;</code> <code>class\u00a0file\u00a0{\u00a0read\u00a0getattr\u00a0open\u00a0};</code> <code>}</code></p> <p><code>#=============\u00a0httpd_t\u00a0==============</code> <code>allow\u00a0httpd_t\u00a0var_log_t:file\u00a0read;</code> <code>allow\u00a0httpd_t\u00a0var_t:file\u00a0{\u00a0read\u00a0getattr\u00a0open\u00a0};</code></p> <p>K\u00f6r sedan f\u00f6ljande kommandon som root:</p> <p><code>checkmodule\u00a0-M\u00a0-m\u00a0ossec-wui.te\u00a0-o\u00a0ossec-wui.mod</code> <code>semodule_package\u00a0-o\u00a0ossec-wui.pp\u00a0-m\u00a0ossec-wui.mod</code> <code>semodule\u00a0-i\u00a0ossec-wui.pp</code></p> <p>F\u00f6rs\u00f6k n\u00e5 ossec via http:///ossec"},{"location":"linux_services/OSSEC/#konfiguration","title":"Konfiguration","text":""},{"location":"linux_services/OSSEC/#agent_1","title":"Agent","text":"<p>Agent \u00e4r att rekommendera p\u00e5 dom system det finns st\u00f6d f\u00f6r.</p>"},{"location":"linux_services/OSSEC/#lagga-till","title":"L\u00e4gga till","text":"<p>Det finns 2 s\u00e4tt att l\u00e4gga till en agent i ossec.</p> <ul> <li>manage_agents<ul> <li>Manuellt men ett s\u00e4krare och mer kontrollerat s\u00e4tt att l\u00e4gga     till agenter.</li> </ul> </li> <li>ossec-authd<ul> <li>Smidigt f\u00f6r att det g\u00e5r snabbt att l\u00e4gga till nya agenter.     Os\u00e4kert f\u00f6r att alla som kan n\u00e5 porten kommer att f\u00e5 en nykel     och bli inlagd i OSSEC systemet. G\u00e5r att blocka med hj\u00e4lp av     brandv\u00e4ggen.</li> </ul> </li> </ul>"},{"location":"linux_services/OSSEC/#manage_agents","title":"manage_agents","text":"<p>K\u00f6r f\u00f6ljande kommando p\u00e5 servern och v\u00e4lj (A)dd an agent.</p> <p><code>/var/ossec/bin/manage_agents</code></p> <p>N\u00e4r man ska fylla i ett IP kan du ocks\u00e5 skriva en IP range (10.0.0.0/24) eller any ifall hosten byter IP ofta.</p> <p>V\u00e4lj sedan (E)xtract key for an agent och fyll sedan i ID numret du valde i sista steget.</p> <p>Kopiera nykeln och k\u00f6r f\u00f6ljande kommando p\u00e5 agenten.</p> <p><code>/var/ossec/bin/manage_agents</code></p> <p>V\u00e4lj (I)mport key from the server och kopiera in nykeln. Starta sedan OSSEC agenten.</p>"},{"location":"linux_services/OSSEC/#ossec-authd","title":"ossec-authd","text":"<p>K\u00f6r f\u00f6ljande p\u00e5 servern.</p> <p><code>/var/ossec/bin/ossec-authd\u00a0-p\u00a01515</code></p> <p>P\u00e5 agenten k\u00f6r du.</p> <p><code>/var/ossec/bin/agent-auth\u00a0-m</code><code>-p\u00a01515</code>"},{"location":"linux_services/OSSEC/#konfiguration_1","title":"Konfiguration","text":"<p>Det finns redan en default konfiguration som fungerar bra f\u00f6r agenter. Om man vill \u00e4ndra n\u00e5got som ber\u00f6r ossec globalt tex \u00e4ndra vilken alert niv\u00e5 det m\u00e5ste vara f\u00f6r att skicka mail, l\u00e4gga till nya regler s\u00e5 g\u00f6rs det i <code>/var/ossec/etc/ossec.conf</code>.</p> <p>Om man vill \u00e4ndra i en regel tex h\u00f6ja o s\u00e4nka alert niv\u00e5n f\u00f6r en speciell output, eller skriva en egen regel f\u00f6r en tj\u00e4nst kollar man i f\u00f6ljande mapp: <code>/var/ossec/rules</code></p>"},{"location":"linux_services/OSSEC/#agentless_1","title":"Agentless","text":"<p>Agentless k\u00f6rs p\u00e5 system som inte har st\u00f6d f\u00f6r en agent men har st\u00f6d f\u00f6r SSH. Tex brandv\u00e4ggar, switchar, routrar.</p>"},{"location":"linux_services/OSSEC/#lagga-till_1","title":"L\u00e4gga till","text":"<p>B\u00f6rja med att aktivera agentless st\u00f6det p\u00e5 ossec servern.</p> <p><code>/var/ossec/bin/ossec-control\u00a0enable\u00a0agentless</code></p> <p>F\u00f6r att l\u00e4gga till en agentless host s\u00e5 beh\u00f6ver s\u00e4tta SSH l\u00f6senord eller anv\u00e4nda SSH nykel. P\u00e5 Cisco saker (PIX, routers) beh\u00f6ver du ange en extra parameter f\u00f6r enable l\u00f6senordet. Samma g\u00e4ller om du vill l\u00e4gga till su st\u00f6d f\u00f6r linux.</p> <p><code>/var/ossec/agentless/register_host.sh\u00a0add\u00a0root@test.hackernet.se\u00a0sshpass\u00a0supass</code> <code>/var/ossec/agentless/register_host.sh\u00a0add\u00a0pix@pix.fw.hackernet.se\u00a0pixpass\u00a0enablepass</code></p> <p>Om du vill anv\u00e4nda SSH nykel s\u00e5 anger du NOPASS som l\u00f6senord. Skapa sedan nycklar \u00e5t ossec.</p> <p><code>sudo\u00a0-u\u00a0ossec\u00a0ssh-keygen</code></p> <p>Nykeln sparas i <code>/var/ossec/.ssh</code>, kopiera sedan \u00f6ver den publika nykeln till dina enheter.</p>"},{"location":"linux_services/OSSEC/#konfigurera","title":"Konfigurera","text":"<p>N\u00e4r man anv\u00e4nder agentless finns det ingen default test som k\u00f6rs och d\u00e4rf\u00f6r beh\u00f6ver man l\u00e4gga till vad som ska \u00f6vervakas manuellt per host i <code>/var/ossec/etc/ossec.conf</code>.</p> <p>Exempel \u00f6vervakning som kollar ifall n\u00e5n fils checksumma \u00e4ndrats i mapparna /bin, /etc, /sbin var 10h. Och en PIX \u00f6vervakning som kollar ifall configen \u00e4ndrats varje timme.</p> <p> <code>...</code> <code></code><code>ssh_integrity_check_linux</code> <code></code><code>36000</code> <code></code><code>root@test.hackernet.se</code> <code></code><code>periodic</code> <code></code><code>/bin\u00a0/etc/\u00a0/sbin</code> <p> <code></code><code>ssh_pixconfig_diff</code> <code></code><code>3600</code> <code></code><code>pix@pix.fw.hackernet.se</code> <code></code><code>periodic_diff</code> <code>...</code> </p> <p> <p>Default finns det 6st olika types script att v\u00e4lja mellan.</p> <ul> <li>ssh_integrity_check_bsd<ul> <li>Kollar ifall n\u00e5n fil \u00e4ndrat SHA1 eller MDA5 checksum i BSD.</li> </ul> </li> <li>ssh_integrity_check_linux<ul> <li>Kollar ifall n\u00e5n fil \u00e4ndrat SHA1 eller MDA5 checksum i Linux.</li> </ul> </li> <li>ssh_pixconfig_diff<ul> <li>Kollar om configen \u00e4ndrats p\u00e5 en Cisco PIX brandv\u00e4gg. Beh\u00f6ver     inget arguments i configen.</li> </ul> </li> <li>ssh_asa-fwsmconfig_diff<ul> <li>Kollar om configen \u00e4ndrats p\u00e5 en Cisco ASA brandv\u00e4gg. Beh\u00f6ver     inget arguments i configen.</li> </ul> </li> <li>ssh_generic_diff<ul> <li>Anv\u00e4nds f\u00f6r att kolla vad som helst som har SSH st\u00f6d. Man     skriver kommandona man vill j\u00e4mf\u00f6ra i arguments.</li> </ul> </li> </ul> <p> <p>Hur ofta en check ska k\u00f6ras. Skriv i sekunder.</p> <p> <p>Vilken host scriptet ska k\u00f6ras mot. Om man beh\u00f6ver k\u00f6ra su l\u00f6senordet s\u00e5 skriver man use_su, ex:</p> <p><code>use_su\u00a0user@test.hackernet.se</code></p> <p> <p>Det finns 2 olika states.</p> <ul> <li>periodic<ul> <li>Skickar en kontrollerad output mot OSSEC agentless processen och     j\u00e4mf\u00f6r sedan mot tidigare k\u00f6rningar. Om det \u00e4r n\u00e5gon skillnad s\u00e5     kommer OSSEC larma. Anv\u00e4nds f\u00f6r att kolla s\u00e5 inte checksumman     \u00e4ndrats.</li> </ul> </li> <li>periodic_diff<ul> <li>Skickar output mot OSSEC agentless processen och j\u00e4mf\u00f6r sedan     mot tidigare k\u00f6rningar. periodic_diff anv\u00e4nds n\u00e4r det \u00e4r en     type som j\u00e4mf\u00f6r 2 en fil/config mot varandra.</li> </ul> </li> </ul> <p> <p>Fyll i dom kommandona du vill j\u00e4mf\u00f6ra. F\u00f6r flera kommandon kan man separera med ett ;.</p> <p><code>...</code> <code>ls\u00a0-la\u00a0/etc;\u00a0cat\u00a0/etc/passwd</code> <code>...</code></p>"},{"location":"linux_services/OSSEC/#prova-manuellt","title":"Prova manuellt","text":"<p>Man kan k\u00f6ra scripten manuellt f\u00f6r att prova att det fungerar. Kr\u00e4vs att l\u00f6senordet/nykeln blivit inlagd.</p> <p><code>cd\u00a0/var/ossec\u00a0&amp;&amp;\u00a0./agentless/ssh_integrity_check_linux\u00a0root@test.hackernet.se\u00a0/bin</code></p>"},{"location":"linux_services/Ookla_Speedtest_Mini/","title":"Ookla Speedtest Mini","text":""},{"location":"linux_services/Ookla_Speedtest_Mini/#installation","title":"Installation","text":"<p>Debian/Ubuntu</p> <p><code>wget</code><code>http://c.speedtest.net/mini/mini.zip</code><code>(Du\u00a0kan\u00a0beh\u00f6va\u00a0registrera\u00a0dig\u00a0p\u00e5\u00a0deras\u00a0hemsida)</code> <code>unzip\u00a0mini.zip</code></p> <p><code>apt-get\u00a0install\u00a0apache2</code> <code>apt-get\u00a0install\u00a0php5\u00a0php5-mysql\u00a0php5-mcrypt\u00a0php5-gd\u00a0libapache2-mod-php5</code> <code>service\u00a0apache2\u00a0restart</code></p> <p>Kommande rad \u00e4r ej obligatorisk. Den skapar endast en fil som verifierar att php'n fungerar</p> <p><code>echo\u00a0\"</code></p> <p>\" &gt; /var/www/phpinfo.php</p> <p><code>cp\u00a0-R\u00a0/[location\u00a0to\u00a0extracted\u00a0folder]/mini\u00a0/var/www/</code></p> <p>400px</p> <p>Byt namn p\u00e5 index-php.html filen till index.html och l\u00e4mna dem resterande or\u00f6rda.</p> <p><code>cd\u00a0/var/www/mini</code> <code>mv\u00a0index-php.html\u00a0index.html</code></p> <p>Du skall nu kunna komma \u00e5t din speedtestserver via webbl\u00e4saren p\u00e5 \"http://dinserverip/mini\"</p> <p>400px</p> <p>Category:Guider</p>"},{"location":"linux_services/OpenLDAP/","title":"OpenLDAP","text":"<p>Category:Guider Category:Sparco OpenLDAP \u00e4r en central inloggnings server precis som Active directory \u00e4r. Det \u00f6kar anv\u00e4ndarv\u00e4nligheten om man kan anv\u00e4nda samma l\u00f6senord till flera platser. OBS det \u00e4r viktigt att klockorna \u00e4r synkade p\u00e5 maskinerna som ska anv\u00e4nda LDAP och att namnuppslag f\u00f6r LDAP-servern kan g\u00f6ras p\u00e5 alla klienter.</p>"},{"location":"linux_services/OpenLDAP/#installera","title":"Installera","text":"<p><code>apt-get\u00a0update\u00a0&amp;&amp;\u00a0apt-get\u00a0install\u00a0slapd\u00a0ldap-utils</code></p> <p>Sl\u00e5 in ett l\u00f6senord.</p> <p>K\u00f6r sedan,</p> <p><code>dpkg-reconfigure\u00a0slapd</code></p> <p>Svara f\u00f6ljande p\u00e5 fr\u00e5gorna som kommer.</p> Omit OpenLDAP server configuration? No Detta kommer starta wizarden. DNS domain name: example.se Namnet p\u00e5 din LDAP dom\u00e4n. (Detta namnet kommer skapa ditt BaseDN dc=example,dc=se) Organization name: example Ett namn p\u00e5 din organisation Administrator password: secret Nytt l\u00f6senord f\u00f6r din LDAP administrat\u00f6r. (cn=admin,dc=example,dc=se) Database backend to use: HDB Bygger p\u00e5 Oracle Berkeley databas(BDB) men \u00e4r mer effektiv. Remove database when slapd is purged? No Spara databasen \u00e4ven om OpenLDAP avinstalleras. Move old database? Yes Ta bort den gammla databasen s\u00e5 att den inte st\u00f6r den nya. Allow LDAPv2 protocol? No Om du inte m\u00e5ste ha LDAPv2 men det \u00e4r rekommenderat att ha det avst\u00e4ngt. <p>G\u00f6r en test query och kolla att LDAP servern fungerar.</p> <p><code>ldapsearch\u00a0-x\u00a0-W\u00a0-D\u00a0cn=admin,dc=example,dc=se\u00a0-b\u00a0dc=example,dc=se\u00a0-LLL</code></p> <p><code>#\u00a0x\u00a0=\u00a0simple\u00a0bind/authentication</code> <code>#\u00a0W\u00a0=\u00a0ask\u00a0for\u00a0password</code> <code>#\u00a0D\u00a0=\u00a0user\u00a0DN</code> <code>#\u00a0b\u00a0=\u00a0search\u00a0base</code> <code>#\u00a0LLL\u00a0=\u00a0omit\u00a0comments</code></p>"},{"location":"linux_services/OpenLDAP/#konfigurera","title":"Konfigurera","text":"<p>Det finns tre olika s\u00e4tt att konfigurera OpenLDAP.</p> <ul> <li>Man \u00e4ndrar i sj\u00e4lv i mappen <code>/etc/ldap/slapd.d</code>. Detta \u00e4r inte     rekommenderat att g\u00f6ra.</li> <li>Man anv\u00e4nder ldap-utils(ldapadd, ldapdelete, ldapmodify, etc).</li> <li>Eller s\u00e5 anv\u00e4nder man ett GUI f\u00f6r att skapa anv\u00e4ndare, grupper eller     importera LDIF.     phpLDAPadmin,     Apache Directory     Studio,     LDAP Admin.</li> </ul> <p>LDIF \u00e4r text filer som anv\u00e4nds f\u00f6r att skapa anv\u00e4ndare, grupper eller f\u00f6r att g\u00f6ra \u00e4ndringar p\u00e5 din LDAP server. F\u00f6r att importera en LDIF fil k\u00f6r kommandot,</p> <p><code>ldapadd\u00a0-W\u00a0-D\u00a0\"cn=admin,dc=example,dc=se\"\u00a0-f\u00a0filename.ldif</code></p>"},{"location":"linux_services/OpenLDAP/#skapa-en-organizational-unit","title":"Skapa en organizational unit","text":"<p>Skapa en ldif fil med f\u00f6ljande info i och importera till OpenLDAP.</p> <p><code>dn:\u00a0ou=users,dc=example,dc=se</code> <code>changetype:\u00a0add</code> <code>objectClass:\u00a0organizationalUnit</code> <code>objectClass:\u00a0top</code> <code>ou:\u00a0users</code></p>"},{"location":"linux_services/OpenLDAP/#skapa-en-anvandare","title":"Skapa en anv\u00e4ndare","text":"<p><code>dn:\u00a0uid=user1,ou=users,dc=example,dc=se</code> <code>objectClass:\u00a0inetOrgPerson</code> <code>objectClass:\u00a0posixAccount</code> <code>objectClass:\u00a0top</code> <code>cn:\u00a0user1</code> <code>givenName:\u00a0User</code> <code>sn:\u00a0Usersson</code> <code>homeDirectory:\u00a0/home/user1</code> <code>loginshell:\u00a0/bin/bash</code> <code>uidNumber:\u00a051397</code> <code>gidNumber:\u00a00</code> <code>uid:\u00a0user1</code> <code>userPassword:\u00a0secret</code></p> <p>Om du vill kryptera l\u00f6senordet skriv</p> <p><code>slappasswd\u00a0-s\u00a0secret</code></p> <p>Och kopiera in SSHA nykeln i ldif filen efter <code>userPassword:</code></p>"},{"location":"linux_services/OpenLDAP/#skapa-grupper","title":"Skapa grupper","text":"<p>Den finns olika sorters grupper man kan skapa.</p> <ul> <li>posixGroup - Lik en vanlig Unix grupp och har ett gidNumber.</li> <li>groupOfNames - Anv\u00e4nds default av     memberOf overlayen och sparar varje     anv\u00e4ndares FDN.</li> <li>groupOfUniqueNames - Samma som groupOfNames fast man kan skilja p\u00e5     anv\u00e4ndare som har samma uid genom att l\u00e4gga till en extra unique     identifier.</li> </ul>"},{"location":"linux_services/OpenLDAP/#posixgroup","title":"posixGroup","text":"<p>Denna sortens grupp syns om du har LDAP kopplat dina anv\u00e4ndare p\u00e5 en Linux maskin.</p> <p><code>dn:\u00a0cn=sudo,dc=hackernet,dc=se</code> <code>objectclass:\u00a0posixGroup</code> <code>objectclass:\u00a0top</code> <code>cn:\u00a0sudo</code> <code>description:\u00a0Group\u00a0description</code> <code>memberUid:\u00a0user1</code></p>"},{"location":"linux_services/OpenLDAP/#groupofnames","title":"groupOfNames","text":"<p><code>dn:\u00a0cn=groupname,dc=hackernet,dc=se</code> <code>objectclass:\u00a0groupofnames</code> <code>cn:\u00a0groupname</code> <code>description:\u00a0Group\u00a0desc</code> <code>member:\u00a0uid=user1,ou=users,dc=example,dc=se</code></p>"},{"location":"linux_services/OpenLDAP/#groupofuniquenames","title":"groupOfUniqueNames","text":"<p>Om du har LDAP kopplat din vCenter s\u00e5 beh\u00f6ver anv\u00e4ndarna ligga i en s\u00e5n h\u00e4r grupp.</p> <p><code>dn:\u00a0cn=vcenter,dc=example,dc=se</code> <code>objectclass:\u00a0groupOfUniqueNames</code> <code>objectclass:\u00a0top</code> <code>cn:\u00a0vcenter</code> <code>description:\u00a0vcenter\u00a0group</code> <code>uniqueMember:\u00a0cn=user1,ou=users,dc=example,dc=se</code></p>"},{"location":"linux_services/OpenLDAP/#memberof","title":"memberOf","text":"<p>F\u00f6r enkelt g\u00f6ra st\u00e4lla fr\u00e5gor och se vilken grupp en anv\u00e4ndare \u00e4r med i s\u00e5 beh\u00f6ver man aktivera <code>memberOf</code>.</p> <p>Skapa tre filer med f\u00f6ljande kod i. memberof.ldif</p> <p><code>dn:\u00a0cn=module,cn=config</code> <code>cn:\u00a0module</code> <code>objectClass:\u00a0olcModuleList</code> <code>olcModuleLoad:\u00a0memberof</code> <code>olcModulePath:\u00a0/usr/lib/ldap</code></p> <p><code>dn:\u00a0olcOverlay={0}memberof,olcDatabase={1}hdb,cn=config</code> <code>objectClass:\u00a0olcConfig</code> <code>objectClass:\u00a0olcMemberOf</code> <code>objectClass:\u00a0olcOverlayConfig</code> <code>objectClass:\u00a0top</code> <code>olcOverlay:\u00a0memberof</code> <code>olcMemberOfDangling:\u00a0ignore</code> <code>olcMemberOfRefInt:\u00a0TRUE</code> <code>olcMemberOfGroupOC:\u00a0groupOfNames</code> <code>olcMemberOfMemberAD:\u00a0member</code> <code>olcMemberOfMemberOfAD:\u00a0memberOf</code></p> <p>refint1.ldif</p> <p><code>dn:\u00a0cn=module{1},cn=config</code> <code>add:\u00a0olcmoduleload</code> <code>olcmoduleload:\u00a0refint</code></p> <p>refint2</p> <p><code>dn:\u00a0olcOverlay={1}refint,olcDatabase={1}hdb,cn=config</code> <code>objectClass:\u00a0olcConfig</code> <code>objectClass:\u00a0olcOverlayConfig</code> <code>objectClass:\u00a0olcRefintConfig</code> <code>objectClass:\u00a0top</code> <code>olcOverlay:\u00a0{1}refint</code> <code>olcRefintAttribute:\u00a0memberof\u00a0member\u00a0manager\u00a0owner</code></p> <p>Ladda sedan in filerna i OpenLDAP servern med f\u00f6ljande kommandon.</p> <p><code>ldapadd\u00a0-Q\u00a0-Y\u00a0EXTERNAL\u00a0-H\u00a0ldapi:///\u00a0-f\u00a0memberof.ldif</code> <code>ldapmodify\u00a0-Q\u00a0-Y\u00a0EXTERNAL\u00a0-H\u00a0ldapi:///\u00a0-f\u00a0refint1.ldif</code> <code>ldapadd\u00a0-Q\u00a0-Y\u00a0EXTERNAL\u00a0-H\u00a0ldapi:///\u00a0-f\u00a0refint2.ldif</code></p> <p>Skapa sedan en grupp och l\u00e4gg till anv\u00e4ndare.</p> <p>add_group.ldif</p> <p><code>dn:\u00a0cn=testgrupp,dc=example,dc=se</code> <code>objectClass:\u00a0groupofnames</code> <code>cn:\u00a0testgrupp</code> <code>description:\u00a0All\u00a0users</code> <code>member:\u00a0uid=testuser,ou=users,dc=example,dc=se</code></p> <p><code>ldapadd\u00a0-x\u00a0-D\u00a0cn=admin,dc=example,dc=se\u00a0-W\u00a0-f\u00a0add_group.ldif</code></p> <p>F\u00f6r att testa att det funkar kan du st\u00e4lla denna fr\u00e5gan.</p> <p><code>ldapsearch\u00a0-h</code><code>-x\u00a0-b\u00a0\"dc=example,dc=se\"\u00a0'(uid=testuser)'\u00a0memberOf</code>"},{"location":"linux_services/OpenLDAP/#rootdn","title":"RootDN","text":"<p>F\u00f6r att g\u00f6ra \u00e4ndringar i <code>cn=config</code> som inneh\u00e5ller sj\u00e4lva LDAP konfigurationen beh\u00f6ver man skapa ett admin konto med l\u00f6senord.</p> <p>Under cn=config kan man s\u00e4tta bland annat ACLer f\u00f6r vilka anv\u00e4ndare som f\u00e5r l\u00e4sa och skriva s\u00e5 man inte beh\u00f6ver anv\u00e4nda cn=admin kontot varje g\u00e5ng.</p> <p><code>dn:\u00a0olcDatabase={0}config,cn=config</code> <code>changetype:\u00a0modify</code> <code>add:\u00a0olcRootDN</code> <code>olcRootDN:\u00a0cn=admin,cn=config</code></p> <p><code>dn:\u00a0olcDatabase={0}config,cn=config</code> <code>changetype:\u00a0modify</code> <code>add:\u00a0olcRootPW</code> <code>olcRootPW:\u00a0secret</code></p> <p><code>ldapadd\u00a0-Y\u00a0EXTERNAL\u00a0-H\u00a0ldapi:///\u00a0-f\u00a0rootconfig.ldif</code></p> <p>F\u00f6r att n\u00e5 cn=config med Apache Directory Studio.</p> <p>"},{"location":"linux_services/OpenLDAP/#postfix-schema","title":"Postfix Schema","text":"<p>F\u00f6r att styra en mailserver med LDAP beh\u00f6vs postfix schemat f\u00f6r att f\u00e5 fler object klasser.</p> <p><code>cd\u00a0/etc/ldap/schema</code> <code>wget</code><code>http://www.postfix-buch.com/download/postfix-book.schema.gz</code><code>&amp;&amp;\u00a0gunzip\u00a0postfix-book.schema.gz</code> <code>mkdir\u00a0ldif_output</code></p> <pre><code>cat &lt;&lt;'__EOF__'&gt;&gt;schema_convert.conf\ninclude /etc/ldap/schema/core.schema\ninclude /etc/ldap/schema/cosine.schema\ninclude /etc/ldap/schema/nis.schema\ninclude /etc/ldap/schema/inetorgperson.schema\ninclude /etc/ldap/schema/postfix-book.schema\n__EOF__\n</code></pre> <p><code>slapcat\u00a0-f\u00a0schema_convert.conf\u00a0-F\u00a0./ldif_output/\u00a0-n0</code> <code>cp\u00a0/etc/ldap/schema/ldif_output/cn\\=config/cn\\=schema/cn\\=\\{4\\}postfix-book.ldif\u00a0/etc/ldap/schema/postfix-book.ldif</code></p> <p>\u00d6ppna och \u00e4ndra f\u00f6ljande i <code>postfix-book.ldif</code></p> <ul> <li>dn: cn=postfix-book,cn=schema,cn=config</li> <li>cn: postfix-book</li> <li>Ta bort allt fr\u00e5n structuralObjectClass och ner\u00e5t.</li> </ul> <p>Importera ldif filen och starta om slapd.</p> <p><code>ldapadd\u00a0-Y\u00a0EXTERNAL\u00a0-H\u00a0ldapi:///\u00a0-f\u00a0postfix-book.ldif</code></p>   Exempel LDIF p\u00e5 hur en mail anv\u00e4ndare kan se ut.   <pre><code>#!/bin/bash\ndn: uid=user,ou=users,dc=hackernet,dc=se\nobjectClass: inetOrgPerson\nobjectClass: posixAccount\nobjectClass: person\nobjectClass: top\nobjectClass: PostfixBookMailAccount\nobjectClass: extensibleObject\ncn: user\ngivenName: User\nsn: Usersson\nmail: user@hackernet.se\nhomeDirectory: /home/user\nloginShell: /bin/bash\nuidNumber: 51397\ngidNumber: 0\nmailEnabled: TRUE\nmailGidNumber: 5000\nmailUidNumber: 5000\nmailHomeDirectory: /srv/vmail/user@hackernet.se\nmailQuota: 10240\nmailStorageDirectory: maildir:/srv/vmail/user@hackernet.se/Maildir\nuid: user\nuserPassword: secret\n</code></pre>"},{"location":"linux_services/OpenLDAP/#client","title":"Client","text":""},{"location":"linux_services/OpenLDAP/#nslcd","title":"Nslcd","text":"<p>Enklaste s\u00e4ttet att autha mot en LDAP server \u00e4r att anv\u00e4nda nslcd.</p> <p><code>apt-get\u00a0install\u00a0nslcd</code></p> <p>L\u00e4gg sedan till f\u00f6ljande i <code>/etc/nslcd.conf</code></p> <p><code>...</code> <code>uri\u00a0ldapserver.hackernet.se</code> <code>base\u00a0dc=hackernet,dc=se</code> <code>...</code></p> <p>\u00d6ppna <code>/etc/nsswitch.conf</code> och l\u00e4gg till f\u00f6ljande:</p> <p><code>passwd:\u00a0compat\u00a0ldap</code> <code>group:\u00a0compat\u00a0ldap</code> <code>shadow:\u00a0compat\u00a0ldap</code> <code>netgroup:ldap</code></p> <p>Starta sedan om tj\u00e4nsten nslcd och nscd</p> <p><code>service\u00a0nscd\u00a0restart</code> <code>service\u00a0nslcd\u00a0restart</code></p>"},{"location":"linux_services/OpenLDAP/#libnss-ldap","title":"Libnss-ldap","text":"<p>Autentisera login mot LDAP servern. Veriferat p\u00e5 Debian 7 (Wheezy)</p> <p><code>apt-get\u00a0update\u00a0&amp;&amp;\u00a0apt-get\u00a0install\u00a0libnss-ldap\u00a0libpam-ldap\u00a0ldap-utils</code></p> <ol> <li>Specifera URL till din ldap server.</li> <li>Skriv in din base dn. Samma som BASE i <code>/etc/ldap/ldap.conf</code></li> <li>V\u00e4lj V3.</li> <li>Fyll i hela suffixen till adminkontot.</li> <li>L\u00f6senordet f\u00f6r adminkontot.</li> <li>V\u00e4lj ok. Vi ska \u00e4ndra i den filen senare.</li> <li>V\u00e4lj vad du vill.</li> <li>V\u00e4lj vad du vill.</li> <li>Fyll i hela suffixen till ditt LDAP adminkonto. Oftast samma som i     steg 4.</li> <li>L\u00f6senordet f\u00f6r adminkontot.</li> </ol> <p>\u00d6ppna sedan filen,</p> <p><code>vim\u00a0/etc/nsswitch.conf</code></p> <p>P\u00e5 linje #7 l\u00e4gg till,</p> <p><code>passwd:\u00a0compat\u00a0ldap</code> <code>group:\u00a0compat\u00a0ldap</code> <code>shadow:\u00a0compat\u00a0ldap</code></p> <p>P\u00e5 linje #19 \u00e4ndra till,</p> <p><code>netgroup:ldap</code></p> <p>\u00d6ppna sedan filen,</p> <p><code>vim\u00a0/etc/pam.d/common-password</code></p> <p>P\u00e5 linje #26 ta bort <code>use_authtok</code> och l\u00e4gg till,</p> <p><code>password\u00a0\u00a0\u00a0\u00a0\u00a0[success=1\u00a0user_unknown=ignore\u00a0default=die]\u00a0\u00a0\u00a0\u00a0\u00a0pam_ldap.so\u00a0try_first_pass</code></p> <p>I filen /etc/pam_ldap.conf. Leta upp kommandot pam_password och \u00e4ndra till exop. Om du byter l\u00f6senord med passwd s\u00e5 v\u00e4ljer Debian default att skicka \u00f6ver l\u00f6senordet krypterat med Crypt. Crypt klarar max 8 tecken och \u00e4r inte s\u00e4kert. V\u00e4ljer man exop s\u00e5 sk\u00f6ter OpenLDAP krypteringen av l\u00f6senordet.</p> <p><code>pam_password\u00a0exop</code></p> <p>Man kan skippa detta steget om man inte vill att en hemmapp ska skapas automatiskt lokalt p\u00e5 datorn,</p> <p><code>vim\u00a0/etc/pam.d/common-session</code></p> <p>Och l\u00e4gga till denna raden i slutet.</p> <p><code>session\u00a0optional\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0pam_mkhomedir.so\u00a0skel=/etc/skel\u00a0umask=077</code></p> <p>Starta sedan om datorn och prova att logga in med ett dom\u00e4nkonto.</p>"},{"location":"linux_services/OpenLDAP/#styr-sudo-med-ldap-grupp","title":"Styr Sudo med LDAP grupp","text":"<p>Skapa en posixGroup som heter sudo. L\u00e4gg sedan till anv\u00e4ndarna som du vill ska f\u00e5 sudo r\u00e4ttigheter i den. Verifiera att din anv\u00e4ndare finns med i sudo gruppen genom att logga in och skriva groups.</p> <p><code>sparco@jumpoff:~$\u00a0groups</code> <code>root\u00a0wiki\u00a0sudo</code></p> <p>L\u00e4gg sedan till denna raden i <code>/etc/sudoers</code> p\u00e5 din server.</p> <p><code>%sudo\u00a0\u00a0\u00a0ALL=(ALL:ALL)\u00a0ALL</code></p>"},{"location":"linux_services/OpenLDAP/#troubleshoot","title":"Troubleshoot","text":""},{"location":"linux_services/OpenLDAP/#getent","title":"Getent","text":"<p>Getent st\u00e5r f\u00f6r get entries och anv\u00e4nds f\u00f6r att visa rader i databaser som supportas av Name Service Switch libraries(nsswitch.conf).</p> <p>passwd visar alla anv\u00e4ndare som servern hittar.</p> <p><code>getent\u00a0passwd</code></p> <p>group visar alla grupper som hittas.</p> <p><code>getent\u00a0group</code></p>"},{"location":"linux_services/OpenLDAP/#forslag-pa-mojliga-rubriker","title":"F\u00f6rslag p\u00e5 m\u00f6jliga rubriker","text":""},{"location":"linux_services/OpenLDAP/#ldap-med-tls","title":"LDAP med TLS","text":""},{"location":"linux_services/OpenLDAP/#ldap-replikering","title":"LDAP-replikering","text":""},{"location":"linux_services/OpenShift/","title":"OpenShift","text":"<p>OpenShift \u00e4r ett s\u00e5kallat PaaS (Platform as a service eller som p\u00e5 svenska platform som tj\u00e4nst) fr\u00e5n Red Hat.</p> <p>Mjukvaran som k\u00f6r servicen \u00e4r Open-Sourced under namnet OpenShift Origin och finns p\u00e5 GitHub versionen f\u00f6r cloud computing heter OpenShift Enterprise.</p> <p>OpenShift supporterar ocks\u00e5 bin\u00e4ra program som \u00e4r webb baserade s\u00e5 l\u00e4nge de kan k\u00f6ras p\u00e5 Red Hat Enterprise Linux. Detta till\u00e5ter anv\u00e4ndare att anv\u00e4nda egen gjorda spr\u00e5k och ramverk. OpenShift tar hand om alla tj\u00e4nster som applikationen beh\u00f6ver samt skalar systemet efter denns behov</p> <p>Tools</p>"},{"location":"linux_services/OpenShift/#supporterade-sprak","title":"Supporterade Spr\u00e5k","text":"<p><code>*Haskell</code> <code>*Java</code> <code>*JavaScript</code> <code>*.NET</code> <code>*Perl</code> <code>*PHP</code> <code>*Python</code> <code>*Ruby</code></p>"},{"location":"linux_services/OpenShift/#supporterade-databaser","title":"Supporterade Databaser","text":"<p><code>*Microsoft\u00a0SQL\u00a0Server</code> <code>*MongoDB</code> <code>*MySQL</code> <code>*PostgreSQL</code></p>"},{"location":"linux_services/OpenShift/#supporterade-applikationer","title":"Supporterade Applikationer","text":"<p><code>*Node.js\u00a0f\u00f6r\u00a0JavaScript</code> <code>*PSGI\u00a0f\u00f6r\u00a0Perl</code> <code>*Rack\u00a0f\u00f6r\u00a0Ruby</code> <code>*WSGI\u00a0f\u00f6r\u00a0Python</code></p> <p>N\u00e5gra ramverk som fungerar omodifierade p\u00e5 openstack</p> <p><code>*CakePHP</code> <code>*Codelgniter</code> <code>*Django</code> <code>*Flask</code> <code>*Laravel</code> <code>*Perl\u00a0Dancer</code> <code>*Ruby\u00a0on\u00a0Rails</code> <code>*Sinatra</code> <code>*Tornado</code> <code>*Vert.x</code> <code>*web2py</code></p>"},{"location":"linux_services/OpenShift/#konkurenter","title":"Konkurenter","text":"<p><code>*Cloud\u00a0Foundry</code> <code>*Google\u00a0App\u00a0Engine</code> <code>*Heroku</code> <code>*Jelastic</code> <code>*Bluemix</code> <code>*Tsuru\u00a0(PaaS)</code></p>"},{"location":"linux_services/OpenShift/#installation","title":"Installation","text":""},{"location":"linux_services/OpenShift/#konfiguration","title":"Konfiguration","text":"<p>Category:Linux</p>"},{"location":"linux_services/OpenVPN/","title":"OpenVPN","text":"<p>Category:Guider OpenVPN \u00e4r \u00f6ppen k\u00e4llkod. Detta \u00e4r exempelkonf f\u00f6r remote access med s\u00e4kerhet i \u00e5tanke. Tv\u00e5-faktors-autentisering f\u00f6r inlogg samt TLS-autentisering av paketen. Tyv\u00e4rr kan man inte h\u00e5rdst\u00e4lla TLS-version. CA-certifikatet och TLS-nyckeln k\u00f6rs inline i konfigfilen f\u00f6r att det ska bli f\u00e4rre filer att h\u00e5lla reda p\u00e5. Remote access VPN \u00e4r utm\u00e4rkt om du vill k\u00e4nna dig som hemma var du \u00e4n befinner dig.</p>"},{"location":"linux_services/OpenVPN/#installation","title":"Installation","text":"<p>Med pakethanterare:</p> <p><code>apt-get\u00a0install\u00a0openvpn</code> <code>openvpn\u00a0--version</code></p> <p>Road warrior installer.</p> <p><code>wget</code><code>https://git.io/vpn</code><code>|\u00a0sudo\u00a0bash</code></p> <p>OBS kontrollera det du wgetar innan du pipear till sudo bash.</p>"},{"location":"linux_services/OpenVPN/#konfiguration","title":"Konfiguration","text":"<p>Openvpn \u00e4r uppdelat i server och klient.</p>"},{"location":"linux_services/OpenVPN/#server","title":"Server","text":"<p>En OpenVPN-server m\u00e5ste ha Diffie-Hellman-parametrar.</p> <p><code>time\u00a0openssl\u00a0dhparam\u00a0-out\u00a0dhparam.pem\u00a04096</code></p> <p>Servern m\u00e5ste kunna forwarda trafik</p> <p><code>echo\u00a01\u00a0&gt;\u00a0/proc/sys/net/ipv4/ip_forward</code></p> <p>TLS-autentiseringsnyckeln ska vara samma p\u00e5 servern som klienterna</p> <p><code>openvpn\u00a0--genkey\u00a0--secret\u00a0ta.key</code></p> <p><code>dev\u00a0tun</code> <code>proto\u00a0tcp</code> <code>server\u00a010.8.0.0\u00a0255.255.255.0</code> <code>ifconfig-pool-persist\u00a0ipp.txt</code></p> <p><code>ca\u00a0[inline]</code> <code>cert\u00a0Server.crt</code> <code>key\u00a0Server.pem</code> <code>#auth-</code></p> <p><code>dh\u00a0dhparam.pem</code> <code>tls-server</code> <code>tls-auth\u00a0[inline]\u00a00</code></p> <p><code>keepalive\u00a010\u00a030</code> <code>cipher\u00a0AES-256-CBC</code> <code>user\u00a0nobody</code> <code>group\u00a0nogroup</code> <code>persist-key</code> <code>persist-tun</code> <code>comp-lzo</code> <code>tun-mtu\u00a01500</code> <code>mssfix\u00a01200</code> <code>verb\u00a03</code></p> <p><code>client-to-client</code> <code>status\u00a0openvpn-status.log</code></p> <p><code>push\u00a0\"redirect-gateway\u00a0def1\u00a0bypass-dhcp\"</code> <code>push\u00a0\"dhcp-option\u00a0DNS\u00a010.8.0.1\"</code></p> <p> <code>-----BEGIN\u00a0CERTIFICATE-----</code> <code>MIIFjjCCA3agAwIBAgICAQAwDQYJKoZIhvcNAQENBQAwaDELMAkGA1UEBhMCU0Ux</code> <code>...</code> <code>W45x0oueEpRKlORpP00dSaeAEj9yJCd/0pltmmR92cGVYg==</code> <code>-----END\u00a0CERTIFICATE-----</code> </p> <p> <code>-----BEGIN\u00a0OpenVPN\u00a0Static\u00a0key\u00a0V1-----</code> <code>fae4feae672f9e291a40be76ee408106</code> <code>...</code> <code>16c46f97c66441da9bcddd2f717672d0</code> <code>-----END\u00a0OpenVPN\u00a0Static\u00a0key\u00a0V1-----</code> </p>"},{"location":"linux_services/OpenVPN/#klient","title":"Klient","text":"<p>Klientkonf som funkar till serverkonfen ovan. Spara conf filen i <code>/etc/openvpn/client/</code></p> <p><code>client</code> <code>dev\u00a0tun0</code> <code>proto\u00a0udp</code> <code>remote\u00a0vpn.hackernet.se\u00a01194</code> <code>resolv-retry\u00a0infinite</code> <code>nobind</code></p> <p><code>ca\u00a0[inline]</code> <code>cert\u00a0Klient1.crt</code> <code>key\u00a0Klient1.pem</code> <code>auth-user-pass\u00a0auth.txt</code></p> <p><code>tls-client</code> <code>tls-auth\u00a0[inline]\u00a01</code> <code>verify-x509-name\u00a0vpn.hackernet.se\u00a0name</code></p> <p><code>keepalive\u00a010\u00a030</code> <code>cipher\u00a0AES-256-CBC</code> <code>auth\u00a0SHA256</code> <code>persist-key</code> <code>persist-tun</code> <code>comp-lzo</code> <code>tun-mtu\u00a01500</code> <code>mssfix\u00a01200</code> <code>verb\u00a03</code></p> <p> <code>-----BEGIN\u00a0CERTIFICATE-----</code> <code>MIIFjjCCA3agAwIBAgICAQAwDQYJKoZIhvcNAQENBQAwaDELMAkGA1UEBhMCU0Ux</code> <code>...</code> <code>W45x0oueEpRKlORpP00dSaeAEj9yJCd/0pltmmR92cGVYg==</code> <code>-----END\u00a0CERTIFICATE-----</code> </p> <p> <code>-----BEGIN\u00a0OpenVPN\u00a0Static\u00a0key\u00a0V1-----</code> <code>fae4feae672f9e291a40be76ee408106</code> <code>...</code> <code>16c46f97c66441da9bcddd2f717672d0</code> <code>-----END\u00a0OpenVPN\u00a0Static\u00a0key\u00a0V1-----</code> </p>"},{"location":"linux_services/OpenVPN/#https","title":"HTTPS","text":"<p>OpenVPN och HTTPS kan samsas p\u00e5 samma port.</p> <p>"},{"location":"linux_services/OpenVPN/#dolja-trafik","title":"D\u00f6lja trafik","text":"<p>En bra b\u00f6rjan: https://www.bestvpn.com/blog/5919/how-to-hide-openvpn-traffic-an-introduction/</p>"},{"location":"linux_services/OpenVPN/#systemd-service","title":"Systemd service","text":"<p>Vill du veta mer om hur systemd templates fungerar kan du l\u00e4sa h\u00e4r.</p>"},{"location":"linux_services/Owncloud/","title":"Owncloud","text":"<p>Category:Guider Category:Sparco Owncloud \u00e4r precis som namnet antyder ett eget cloud. Funkar precis som Dropbox och liknande tj\u00e4nster bara att du sj\u00e4lv m\u00e5ste hosta filerna p\u00e5 en egen server och p\u00e5 s\u00e5 s\u00e4tt ha full kontroll p\u00e5 dom.</p> <p>F\u00f6r att komma \u00e5t dina filer i owncloud kan du anv\u00e4nda ett webinterface eller deras Owncloud client som finns till Windows, Linux, MacOSX, IOS, Android.</p>"},{"location":"linux_services/Owncloud/#features","title":"Features","text":"<p>N\u00e4mner bara n\u00e5gra features owncloud har som jag tycker \u00e4r bra, fler features listas h\u00e4r.</p> <ul> <li>Revisionshantering av filer.</li> </ul> <ul> <li>Undelete om du r\u00e5kar ta bort fel fil.</li> <li>Skapa en tempor\u00e4r URL till en fil som man kan dela med andra.</li> <li>Kryptering av filer, AES 128 eller 256 bits.</li> <li>LDAP/AD st\u00f6d.</li> <li>L\u00e4gg till external storage(Dropbox, Google Drive, Amazon S3,     SMB/CIFS, FTP, SFTP)</li> <li>Synca kontakter och kalender fr\u00e5n tex mobilen.</li> <li>Plugins.</li> </ul>"},{"location":"linux_services/Owncloud/#installation","title":"Installation","text":"<p>F\u00f6r att installera Owncloud kr\u00e4vs en webbserver med PHP och MySQL f\u00f6rkonfat. Man kan anv\u00e4nda sig av MariaDB, SQLite och PostgreSQL ocks\u00e5.</p> <p>G\u00e5 till https://owncloud.org/install/#instructions-server f\u00f6r att f\u00e5 tag p\u00e5 senaste tar.bz2 filen.</p> <p>Tanka hem filen till roten av din webbfolder och packa upp den.</p> <p><code>wget</code><code>https://download.owncloud.org/community/owncloud-8.0.2.tar.bz2</code><code>&amp;&amp;\u00a0tar\u00a0xvf\u00a0owncloud-8.0.2.tar.bz2</code></p>"},{"location":"linux_services/Owncloud/#konfiguration","title":"Konfiguration","text":"<p>Surfa sedan in p\u00e5 http:///owncloud <p>F\u00f6lj anvisningarna som kommer.</p>"},{"location":"linux_services/Owncloud/#nfs","title":"NFS","text":"<p>F\u00f6r att lagra data p\u00e5 en NFS share. Mounta sharen till en mapp i owncloud foldern eller till en annan mapp p\u00e5 servern. Se till att samma anv\u00e4ndare och grupp med samma GID som k\u00f6r webbservern \u00e4ger mappen p\u00e5 NFS serverns sida. Peka sedan data folder mot den nya mappen under installationen eller genom att \u00e4ndra p\u00e5 parametern datadirectory i <code>/config/config.php</code> filen. Gl\u00f6m inte flytta \u00f6ver index.html och .htaccess filen till NFS sharen s\u00e5 att inte obeh\u00f6riga kan l\u00e4sa dina filer."},{"location":"linux_services/Owncloud/#kryptering","title":"Kryptering","text":"<p>F\u00f6r att s\u00e4tta p\u00e5 kryptering.</p> <p>Logga in som en admin.</p> <p>Uppe till v\u00e4nster v\u00e4lj Apps.</p> <p>Leta upp appen <code>Server-Side encryption</code> och tryck enable.</p> <p>Logga sedan ut och logga in igen. Har du redan sparat filer s\u00e5 kan inloggningen ta en stund eftersom att den b\u00f6rjar kryptera dina filer efter f\u00f6rsta inloggingen efter att du satt kryptering.</p>"},{"location":"linux_services/Oxidized/","title":"Oxidized","text":"<p>Oxidized \u00e4r ett backup tool f\u00f6r n\u00e4tverk devices. Allts\u00e5 en ers\u00e4ttare till Rancid. Oxidized bygger ocks\u00e5 p\u00e5 perl men \u00e4r lite mer modernare \u00e4n Rancid. Oxidized har ett eget webinterface med REST API st\u00f6d f\u00f6r att kunna s\u00f6ka, diffa och visa config. Medans Rancid enbart kan anv\u00e4nda en csv fil som source vad den ska backupa kan Oxidized \u00e4ven anv\u00e4nda samma sorts fil, en SQL databas eller en websida med JSON tex LibreNMS API.</p>"},{"location":"linux_services/Oxidized/#supportade-os","title":"Supportade OS","text":"<ul> <li>A0 Networks<ul> <li>ACOS</li> </ul> </li> <li>Alcatel-Lucent<ul> <li>AOS</li> <li>AOS7</li> <li>ISAM</li> <li>TiMOS</li> <li>Wireless</li> </ul> </li> <li>Arista<ul> <li>EOS</li> </ul> </li> <li>Arris<ul> <li>C4CMTS</li> </ul> </li> <li>Aruba<ul> <li>AOSW</li> </ul> </li> <li>Brocade<ul> <li>FabricOS</li> <li>Ironware</li> <li>NOS (Network Operating System)</li> <li>Vyatta</li> </ul> </li> <li>Ciena<ul> <li>SOAS</li> </ul> </li> <li>Cisco<ul> <li>AireOS</li> <li>ASA</li> <li>IOS</li> <li>IOSXR</li> <li>NXOS</li> <li>SMB (Nikola series)</li> </ul> </li> <li>Citrix<ul> <li>NetScaler (Virtual Applicance)</li> </ul> </li> <li>Cumulus<ul> <li>Linux</li> </ul> </li> <li>DataCom<ul> <li>DmSwitch 3000</li> </ul> </li> <li>DELL<ul> <li>PowerConnect</li> <li>AOSW</li> </ul> </li> <li>Ericsson/Redback<ul> <li>IPOS (former SEOS)</li> </ul> </li> <li>Extreme Networks<ul> <li>XOS</li> <li>WM</li> </ul> </li> <li>F5<ul> <li>TMOS</li> </ul> </li> <li>Force0<ul> <li>DNOS</li> <li>FTOS</li> </ul> </li> <li>FortiGate<ul> <li>FortiOS</li> </ul> </li> <li>HP<ul> <li>Comware (HP A-series, H3C, 3Com)</li> <li>Procurve</li> </ul> </li> <li>Huawei<ul> <li>VRP</li> </ul> </li> <li>Juniper<ul> <li>JunOS</li> <li>ScreenOS (Netscreen)</li> </ul> </li> <li>Mikrotik<ul> <li>RouterOS</li> </ul> </li> <li>Motorola<ul> <li>RFS</li> </ul> </li> <li>MRV<ul> <li>MasterOS</li> </ul> </li> <li>Netonix<ul> <li>WISP Switch (As Netonix)</li> </ul> </li> <li>Opengear<ul> <li>Opengear</li> </ul> </li> <li>Palo Alto<ul> <li>PANOS</li> </ul> </li> <li>Supermicro<ul> <li>Supermicro</li> </ul> </li> <li>Ubiquiti<ul> <li>AirOS</li> <li>Edgeos</li> <li>EdgeSwitch</li> </ul> </li> <li>Zyxel<ul> <li>ZyNOS</li> </ul> </li> </ul>"},{"location":"linux_services/Oxidized/#installation","title":"Installation","text":"<p>requires Ruby version &gt;= 2.0</p> <ul> <li>#tab1|CentOS 7</li> <li>#tab2|Ubuntu 16.04</li> </ul>   Skapa Oxidized anv\u00e4ndaren  `useradd\u00a0-d\u00a0/opt/oxidized\u00a0oxidized`  Installera EPEL och SCL  `yum\u00a0install\u00a0epel-release\u00a0centos-release-scl-rh\u00a0centos-release-scl`  Installera Ruby samt extra paket f\u00f6r att kompilera Oxidized.  `yum\u00a0install\u00a0make\u00a0cmake\u00a0which\u00a0sqlite-devel\u00a0openssl-devel\u00a0libssh2-devel\u00a0gcc\u00a0libicu-devel\u00a0gcc-c++\u00a0rh-ruby26-ruby-devel\u00a0rh-ruby26-ruby\u00a0git`  Installera Oxidized  `scl\u00a0enable\u00a0rh-ruby26\u00a0bash` `gem\u00a0install\u00a0oxidized` `gem\u00a0install\u00a0oxidized-script\u00a0oxidized-web`  Skapa en systemd fil \u00e5t Oxidized.         #For debian 8 put it in /lib/systemd/system/     #To set OXIDIZED_HOME instead of the default:     # ~${oxidized_user}/.config/oxidized in debian 8, then uncomment     #(and modify as required) the \"Environment\" variable below so     #systemd sets the correct environment. Tested only on Debian 8.8.     #YMMV otherwise.     #     #For RHEL / CentOS 7 put it in /etc/systemd/system/     #and call it with systemctl start oxidized.service      [Unit]     Description=Oxidized - Network Device Configuration Backup Tool     After=network-online.target multi-user.target     Wants=network-online.target      [Service]     ExecStart=/bin/scl enable rh-ruby26 /opt/rh/rh-ruby26/root/usr/local/bin/oxidized     User=oxidized     KillSignal=SIGKILL     Restart=always     RestartSec=20     #Environment=\"OXIDIZED_HOME=/etc/oxidized\"      [Install]     WantedBy=multi-user.target     `sudo\u00a0add-apt-repository\u00a0universe` `sudo\u00a0apt-get\u00a0-y\u00a0install\u00a0ruby\u00a0ruby-dev\u00a0libsqlite3-dev\u00a0libssl-dev\u00a0pkg-config\u00a0cmake\u00a0libssh2-1-dev\u00a0libicu-dev\u00a0zlib1g-dev\u00a0g++` `sudo\u00a0gem\u00a0install\u00a0oxidized` `sudo\u00a0gem\u00a0install\u00a0oxidized-script\u00a0oxidized-web`"},{"location":"linux_services/Oxidized/#konfiguration","title":"Konfiguration","text":"<p>Konfigurationen \u00e4r p\u00e5 YAML-format. Default-konf finns i: /etc/oxidized/config och sedan anv\u00e4nds\\~/.config/oxidized/config</p> <p>F\u00f6r att initiera oxidized i ditt home directory k\u00f6r:</p> <p><code>mkdir\u00a0-p\u00a0~/.config/oxidized</code> <code>oxidized</code> <code>nano\u00a0~/.config/oxidized/config</code></p> <p>Man kan \u00e4ndra var man vill att oxidized ska l\u00e4gga sig genom att \u00e4ndra environment variable</p> <p><code>OXIDIZED_HOME=/etc/oxidized</code></p> <p>Logging</p> <p><code>log:\u00a0\"/home/$USER/.config/oxidized/oxidized.log\"</code></p>"},{"location":"linux_services/Oxidized/#input","title":"Input","text":"<p>Input h\u00e4mtar konfiguration fr\u00e5n enheterna.</p> <p><code>input:</code> <code>default:\u00a0ssh,\u00a0telnet</code> <code>debug:\u00a0false</code> <code>ssh:</code> <code>secure:\u00a0false</code></p>"},{"location":"linux_services/Oxidized/#source","title":"Source","text":"<p>Source l\u00e4ser vilka enheter som ska konfigbackas. Oxidized har st\u00f6d f\u00f6r CSV, SQLite, MySQL och HTTP som source backends.</p>"},{"location":"linux_services/Oxidized/#csv","title":"CSV","text":"<p>CSV backend l\u00e4ser vilka enheter som det ska tas backup p\u00e5 fr\u00e5n en rancid-kompatibel fil.</p> <pre><code> source:\n   default: csv\n   csv:\n     file: \"/home/$USER/.config/oxidized/router.db\"\n     delimiter: !ruby/regexp /:/\n     map:\n       name: 0\n       model: 1\n       username: 2\n       password: 3\n     vars_map:\n       enable: 4\n</code></pre> <p>router.db Format: 0:1:2:3:4</p> <p><code>router01.example.com:ios:user:pw:enablepw</code> <code>172.20.0.1:ios:user:pw:enablepw</code></p>"},{"location":"linux_services/Oxidized/#http","title":"HTTP","text":"<p>HTTP backend beh\u00f6ver l\u00e4sa en JSON hemsida.</p> <pre><code>source:\n  default: http\n  debug: false\n  http:\n    url: https://url\n    scheme: https\n    map:\n      name: hostname\n      model: os\n</code></pre> <p>Exempel p\u00e5 JSON formatet om Oxidized beh\u00f6ver.</p> <pre><code>]\n  {\n    \"group\": \"default\",\n    \"hostname\": \"switch1\",\n    \"ip\": \"192.168.1.11\",\n    \"os\": \"junos\"\n  },\n  {\n    \"group\": \"default\",\n    \"hostname\": \"switch2\",\n    \"ip\": \"192.168.1.12\",\n    \"os\": \"xos\"\n  }\n]\n</code></pre>"},{"location":"linux_services/Oxidized/#output","title":"Output","text":"<p>Output lagrar konfigurationen. Man m\u00e5ste k\u00f6ra git f\u00f6r att f\u00e5 versionshantering p\u00e5 konfig-filerna.</p> <p><code>output:</code> <code>default:\u00a0file</code> <code>file:</code> <code>directory:\u00a0\"/home/$USER/.config/oxidized/configs\"</code></p> <p>GIT</p> <p><code>output:</code> <code>default:\u00a0git</code> <code>git:</code> <code>user:\u00a0Oxidized</code> <code>email:\u00a0oxidized@example.com</code> <code>repo:\u00a0\"/home/$USER/.config/oxidized/oxidized.git\"</code></p> <p>Exceptions Man kan l\u00e4gga in egna undantag f\u00f6r rader som ej borde vara med i konfigen, t.ex. rader med tidsst\u00e4mplar som \u00e4ndras ofta.</p> <p>Exempel IOS, edit /var/lib/gems/2.3.0/gems/oxidized-0.21.0/lib/oxidized/model/ios.rb</p> <pre><code>  cmd 'show running-config' do |cfg|\n    cfg = cfg.each_line.to_a[3..-1]\n    cfg = cfg.reject { |line| line.match /^ntp clock-period / }.join\n    cfg.gsub! /^Current configuration : [^\\n]*\\n/, ''\n    cfg.gsub! /^! Last configuration change at [^\\n]*\\n/, ''\n    cfg.gsub! /^! NVRAM config last updated at [^\\n]*\\n/, ''\n    cfg.gsub! /^\\ tunnel\\ mpls\\ traffic-eng\\ bandwidth[^\\n]*\\n*(\n                  (?:\\ [^\\n]*\\n*)*\n                  tunnel\\ mpls\\ traffic-eng\\ auto-bw)/mx, '\\1'\n    cfg\n  end\n</code></pre>"},{"location":"linux_services/Oxidized/#hooks","title":"Hooks","text":"<p>Hooks kan anv\u00e4ndas f\u00f6r att kalla p\u00e5 script, skicka mail eller pusha mot git n\u00e4r n\u00e5got specifikt har h\u00e4nt. Mer info om Hooks samt fler exempel finns p\u00e5 deras hemsida</p>"},{"location":"linux_services/Oxidized/#events","title":"Events","text":"<ul> <li><code>node_success:</code> triggas n\u00e4r en lyckad backup har tagits och precis     f\u00f6re configen sparas i oxidized.</li> <li><code>node_fail:</code> triggas efter en node har failat.</li> <li><code>post_store:</code> triggas efter en node config har sparats. K\u00f6rs endast     om configen har \u00e4ndrats.</li> <li><code>nodes_done:</code> triggas efter oxidized g\u00e5tt igenom alla nodes.</li> </ul>"},{"location":"linux_services/Oxidized/#push-to-git","title":"Push to GIT","text":"<p>F\u00f6r att pusha till git m\u00e5ste man skapa en hook f\u00f6r det. D\u00e4r man anger vilket repo samt en ssh key.</p> <pre><code>hooks:\n  push_to_remote:\n    type: githubrepo\n    events: [post_store]\n    remote_repo: ssh://oxidized@github.com/hackernet-oxidized.git\n    publickey: /opt/oxidized/.ssh/id_rsa.pub\n    privatekey: /opt/oxidized/.ssh/id_rsa\n</code></pre>"},{"location":"linux_services/Oxidized/#maila-om-en-node-failar","title":"Maila om en node failar","text":"<p>Om en node skulle faila med backupen skicka d\u00e5 ett mail.</p> <pre><code>  email_output:\n    type: exec\n    events: [node_fail]\n    cmd: '/opt/oxidized/.config/oxidized/extra/oxidized-report-git-commits | mail -s \"Oxidized updates for ${OX_NODE_NAME}\" hackernet@hackernet.se'\n    async: true\n    timeout: 120\n</code></pre>"},{"location":"linux_services/Oxidized/#execute","title":"Execute","text":"<p>F\u00f6r att starta oxidized och ta en f\u00f6rsta backup</p> <p><code>oxidized</code></p> <p>RESTful web API</p> <p><code>rest:</code><code>:8888</code>"},{"location":"linux_services/Oxidized/#service","title":"Service","text":"<p>Skapa en service med hj\u00e4lp av Systemd. Om du installera Oxidized enligt denna guiden f\u00f6r CentOS anv\u00e4nd is\u00e5fall systemd filen som angetts d\u00e4r.</p> <p><code>sudo\u00a0cat\u00a0&lt;&lt;'__EOF__'&gt;&gt;\u00a0/lib/systemd/system/oxidized.service</code> <code>[Unit]</code> <code>Description=Oxidized\u00a0-\u00a0Network\u00a0Device\u00a0Configuration\u00a0Backup\u00a0Tool</code></p> <p><code>[Service]</code> <code>ExecStart=/usr/local/bin/oxidized</code> <code>User=oxidized</code></p> <p><code>[Install]</code> <code>WantedBy=multi-user.target</code> <code>__EOF__</code></p> <p><code>sudo\u00a0systemctl\u00a0enable\u00a0oxidized</code> <code>sudo\u00a0systemctl\u00a0start\u00a0oxidized</code> <code>sudo\u00a0systemctl\u00a0status\u00a0oxidized</code></p> <p>Category:Guider</p>"},{"location":"linux_services/PXE-Deploy/","title":"PXE-Deploy","text":"<p>Category:Guider Preboot Execution Environment \u00e4r en milj\u00f6 som anv\u00e4nds f\u00f6r att boota datorer med hj\u00e4lp av ett n\u00e4tverkskort helt oberoende av lagringsenheter som h\u00e5rddiskar eller installerade operativsystem. N\u00e4r du s\u00e4ger \u00e5t din maskin att PXE/N\u00e4tverksboota kommer den att skicka en DHCP-beg\u00e4ran som DHCP-servern kommer att svara p\u00e5 och det kommer att inneh\u00e5lla tv\u00e5 speciella saker, en \"next-server\" och ett filnamn. \"Next-server \" \u00e4r din TFTP-server och filen \u00e4r det din server kommer att ladda ner och k\u00f6ra ifr\u00e5n. Denna fil \u00e4r vanligtvis en bootloader s\u00e5som pxelinux eller pxegrub. Se \u00e4ven IPXE</p> <p>Valfri DHCP-server kan anv\u00e4ndas, det som ska pekas ut \u00e4r tftp-servern. T.ex.</p> <p><code>next-server\u00a0192.168.0.100;\u00a0filename\u00a0\"pxelinux.0\";</code></p> <p>Valfri tftp-server kan anv\u00e4ndas, den ska endast h\u00e5lla filer.</p>"},{"location":"linux_services/PXE-Deploy/#installation","title":"Installation","text":"<p>H\u00e4r f\u00f6ljer ett exempel p\u00e5 en pxelinux-setup (ej TFTP eller DHCP). F\u00f6rst g\u00e4ller det att f\u00e5 tag p\u00e5 de n\u00f6dv\u00e4ndiga filerna.</p> <p><code>apt-get\u00a0-y\u00a0install\u00a0syslinux</code></p>"},{"location":"linux_services/PXE-Deploy/#konfiguration","title":"Konfiguration","text":"<p><code>mkdir\u00a0-p\u00a0/tftpboot/pxelinux.cfg</code> <code>cp\u00a0/usr/lib/syslinux/pxelinux.0\u00a0/tftpboot</code> <code>cp\u00a0/usr/lib/syslinux/vesamenu.c32\u00a0/tftpboot/pxelinux.cfg</code> <code>cp\u00a0/usr/lib/syslinux/pxechain.com\u00a0/tftpboot/pxelinux.cfg</code></p> <p>Sedan ska huvudkonf-filen skapas, h\u00e4r best\u00e4mmer man hur pxe:n ska se ut.</p> <p><code>cat&lt;&lt;'__EOF__'&gt;/tftpboot/pxelinux.cfg/default</code> <code>default\u00a0vesamenu.c32</code> <code>background\u00a0pxelinux.cfg/badass.png</code> <code>prompt\u00a00</code> <code>timeout\u00a00</code></p> <p><code>label\u00a0First\u00a0label</code> <code>kernel\u00a0firstkernel</code></p> <p><code>label\u00a0Second\u00a0label</code> <code>kernel\u00a0secondkernel</code> <code>__EOF__</code></p> <p>Det som st\u00e5r efter kernel och initrd \u00e4r s\u00f6kv\u00e4gar som \u00e4r relativa till tftpboot</p>"},{"location":"linux_services/PXE-Deploy/#unattended","title":"Unattended","text":"<p>Vill man automatisera sina installationer kan man g\u00f6ra det med kickstart-filer. T.ex.</p> <p><code>label\u00a0InstallServer1404</code> <code>kernel\u00a0server1404/linux</code> <code>append\u00a0ks=</code><code>http://192.168.0.100/ks.cfg</code><code>vga=normal\u00a0initrd=server1404/initrd.gz\u00a0ramdisk_size=16432\u00a0root=/dev/rd/0\u00a0rw\u00a0\u00a0--</code></p>"},{"location":"linux_services/PXE-Deploy/#skapa-ks-fil","title":"Skapa ks-fil","text":"<p>I m\u00e5nga distar kan man k\u00f6ra f\u00f6ljande: (in graphical environment)</p> <p><code>system-config-kickstart</code></p>"},{"location":"linux_services/PXE-Deploy/#kickstartfiler","title":"Kickstartfiler","text":"<p>Kickstart</p>"},{"location":"linux_services/PXE-Deploy/#liveboot","title":"Liveboot","text":"<p>Det g\u00e5r \u00e4ven att liveboota med PXE, d\u00e5 kan man anv\u00e4nda en NFS-share. T.ex.</p> <p><code>LABEL\u00a0Kali\u00a0Live</code> <code>KERNEL\u00a0kali/live/vmlinuz</code> <code>APPEND\u00a0boot=live\u00a0netboot=nfs\u00a0nfsroot=192.168.0.100:/mnt/tftpboot/kali\u00a0initrd=kali/live/initrd.img\u00a0quiet\u00a0splash\u00a0--</code></p>"},{"location":"linux_services/PXE-Deploy/#flera-pxe-servrar","title":"Flera PXE-servrar","text":"<p>Vill man hoppa till en annan PXE-server, t.ex. en windows.</p> <p><code>LABEL\u00a0Jump\u00a0to\u00a0other\u00a0PXE</code> <code>KERNEL\u00a0pxelinux.cfg/pxechain.com</code> <code>APPEND\u00a0192.168.0.10::pxelinux.0</code></p>"},{"location":"linux_services/PXE-Deploy/#exempel-pa-anvandbara-verktyg-att-ha-pa-en-pxe","title":"Exempel p\u00e5 anv\u00e4ndbara verktyg att ha p\u00e5 en PXE","text":"<p><code>LABEL\u00a0Auto\u00a0^Nuke!\u00a0DBAN\u00a0No\u00a0Questions\u00a0Asked!</code> <code>KERNEL\u00a0DBAN/DBAN.BZI</code> <code>APPEND\u00a0nuke=\"dwipe\u00a0--autonuke\"\u00a0silent</code></p> <p><code>label\u00a0MemTest</code> <code>kernel\u00a0memtest/mt86plus</code></p> <p><code>label\u00a0GParted\u00a0Live</code> <code>kernel\u00a0gparted/vmlinuz</code> <code>append\u00a0initrd=gparted/initrd.img\u00a0boot=live\u00a0config\u00a0noswap\u00a0noprompt\u00a0nosplash\u00a0netboot=nfs\u00a0nfsroot=192.168.0.100:/mnt/tftpboot/gparted</code></p>"},{"location":"linux_services/Pagespeed/","title":"Pagespeed","text":"<p>Category:Guider PageSpeed \u00e4r ett program utvecklat av Google f\u00f6r att g\u00f6ra internet lite snabbare. (https://developers.google.com/speed/pagespeed/) Om man kollar p\u00e5 k\u00e4llkoden p\u00e5 Googles s\u00f6ksida ser man ett ol\u00e4sligt hav av tecken, det \u00e4r resultatet av PageSpeed p\u00e5 deras sida. Det finns moduler f\u00f6r Nginx och Apache. (Pagespeed module is only available as source)</p>"},{"location":"linux_services/Pagespeed/#optimiseringsfilter","title":"Optimiseringsfilter","text":"<p>H\u00e4r f\u00f6ljer en lista p\u00e5 n\u00e5gra anv\u00e4ndbara filter:</p> <ol> <li>Local Storage Cache</li> </ol> <p>This filter saves inlined resources to the browser's local storage (an HTML5 feature) on the first view of a page, and loads them from local storage on subsequent views rather than sending them (inline) again.</p> <ol> <li>Combine CSS</li> </ol> <p>'Combine CSS' seeks to reduce the number of HTTP requests made by a browser during page refresh by replacing multiple distinct CSS files with a single CSS file, containing the contents of all of them. This is particularly important in old browsers, that were limited to two connections per domain. In addition to reduced overhead for HTTP headers and communications warm-up, this approach works better with TCP/IP slow-start, increasing the effective payload bit-rate through the browser's network connection.</p> <ol> <li>Pre-Resolve DNS</li> </ol> <p>This can contribute significantly towards total page load time. This filter reduces DNS lookup time by providing hints to the browser at the beginning of the HTML, which allows the browser to pre-resolve DNS for resources on the page.</p> <ol> <li>Collapse Whitespace</li> </ol> <p>The filter reduces the transfer size of HTML files by replacing contiguous whitespace with a single whitespace character. Because HTML is often formatted with extra whitespace for human readability or as an incidental effect of the templates used to generate it, this technique can reduce the number of bytes needed to transmit HTML resources.</p> <ol> <li>Lazyload Images</li> </ol> <p>The lazyload_images filter defers loading of images until they become visible in the client's viewport or the page's onload event fires. This avoids blocking the download of other critical resources necessary for rendering the above the fold section of the page.</p> <ol> <li>Insert Google Analytics</li> </ol> <p>The 'Insert Google Analytics' filter adds the basic Google Analytics javascript snippet to each HTML page. If the page already has a Google Analytics snippet inside</p> <p> <p>with the specified ID, then no additional snippet will be added. If another Google Analytics snippet is on the page with a different ID, then an additional snippet will be added with the ID specified in with AnalyticsID. In order to avoid any strange Google Analytics reporting, make sure that the ID specified in the configuration file matches the one used on your site.</p> <ol> <li>Remove Comments</li> </ol> <p>The remove_comments filter eliminates HTML comments, which are often used to document the code or to comment out experiments. Note that this directive applies only to HTML files. CSS comments are eliminated with the rewrite_css filter, and Javascript comments are eliminated with the rewrite_javascript filter.</p>"},{"location":"linux_services/Pagespeed/#nginx","title":"Nginx","text":"<p>(Installation)</p> <p><code>server\u00a0{</code> <code>...</code> <code>pagespeed\u00a0on;</code> <code>pagespeed\u00a0RewriteLevel\u00a0CoreFilters;</code> <code>pagespeed\u00a0FileCachePath\u00a0\"/var/cache/ngx_pagespeed/\";</code> <code>pagespeed\u00a0EnableFilters\u00a0combine_css,remove_comments,collapse_whitespace;</code> <code>...</code> <code>}</code></p>"},{"location":"linux_services/PhpIPAM/","title":"PhpIPAM","text":"<p>phpIPAM \u00e4r en IPAM-l\u00f6sning som har st\u00f6d f\u00f6r bl.a. subnet scanning, IPv4/IPv6, AD/LDAP, VLAN, VRF, mail notifications.</p>"},{"location":"linux_services/PhpIPAM/#installation","title":"Installation","text":"<p>Ubuntu 16.04 Apache</p> <p><code>sudo\u00a0apt-get\u00a0-y\u00a0install\u00a0apache2</code></p> <p>MySQL</p> <p><code>sudo\u00a0apt-get\u00a0-y\u00a0install\u00a0mysql-server</code> <code>mysql_secure_installation</code></p> <p>PHP</p> <p><code>sudo\u00a0apt-get\u00a0-y\u00a0install\u00a0php7.0\u00a0libapache2-mod-php7.0\u00a0&amp;&amp;\u00a0sudo\u00a0systemctl\u00a0restart\u00a0apache2</code> <code>sudo\u00a0apt-get\u00a0-y\u00a0install\u00a0php7.0-cli\u00a0php7.0-curl\u00a0php7.0-gmp\u00a0php7.0-json\u00a0php7.0-ldap\u00a0php7.0-mcrypt\u00a0php7.0-mysql\u00a0php7.0-xml\u00a0php-pear\u00a0&amp;&amp;\u00a0sudo\u00a0systemctl\u00a0restart\u00a0apache2</code></p> <p>Ladda ner tarball fr\u00e5n hemsida.</p> <p><code>wget</code><code>https://sourceforge.net/projects/phpipam/files/phpipam-1.2.1.tar</code></p> <p>Packa upp och l\u00e4gg i directory f\u00f6r webbservern.</p> <p><code>sudo\u00a0tar\u00a0-xf\u00a0phpipam-1.2.1.tar\u00a0-C\u00a0/var/www/</code> <code>sudo\u00a0rm\u00a0/var/www/html/index.html\u00a0&amp;&amp;\u00a0sudo\u00a0mv\u00a0/var/www/phpipam/*\u00a0/var/www/html/</code> <code>sudo\u00a0cp\u00a0/var/www/html/config.dist.php\u00a0/var/www/html/config.php</code> <code>sudo\u00a0a2enmod\u00a0rewrite\u00a0&amp;&amp;\u00a0sudo\u00a0service\u00a0apache2\u00a0restart</code></p> <p>Nu kan man g\u00f6ra resten i webgui. http:/// Om n\u00e5got fattas eller \u00e4r fel m\u00f6ts man av ett felmeddelande som ber\u00e4ttar vad som \u00e4r fel. T.ex. om man har lagt siten i en undermapp, http:///phpipam/, m\u00e5ste man konfa om config.php och .htaccess (trailing slash viktigt). <p>V\u00e4lj: Automatic database installation och anv\u00e4nd root-kontot.</p> <p>F\u00f6lj sedan instruktionerna, logga in.</p>"},{"location":"linux_services/PhpIPAM/#konfiguration","title":"Konfiguration","text":""},{"location":"linux_services/PhpIPAM/#cli","title":"CLI","text":"<p>Eftersom allt ligger i en SQL-databas kan man anv\u00e4nda vanlig SQL-syntax f\u00f6r att manipulera datan.</p> <p><code>use\u00a0phpipam;</code></p> <p>VLAN</p> <p><code>insert\u00a0into\u00a0vlans\u00a0(name,number,description)\u00a0values(\"Client\",\u00a0\"1338\",\u00a0\"Klient-vlan\")</code></p> <p>VRF</p> <p><code>insert\u00a0into\u00a0vrf\u00a0(name,rd,description)\u00a0values(\"vrf2\",\u00a0\"11:22\",\u00a0\"bla2\")</code></p>"},{"location":"linux_services/PhpIPAM/#pretty-links","title":"Pretty links","text":"<p>G\u00f6r att din URL ser b\u00e4ttre ut. rewrite m\u00e5ste vara p\u00e5slaget i apache f\u00f6r att det ska fungera.</p> <ul> <li>No: ?page=administration&amp;link2=settings</li> <li>Yes: /administration/settings/</li> </ul> <p>\u00c4ndra base i config.php filen f\u00f6r phpIPAM. (Om phpipam ligger i rooten p\u00e5 webbservern s\u00e5 kan du skippa detta steg.)</p> <p><code>define('BASE',\u00a0\"/phpipam/\");</code></p> <p>Sl\u00e5 p\u00e5 rewrite i apache.</p> <p><code>a2enmod\u00a0rewrite</code></p> <p>L\u00e4gg till f\u00f6ljande rader i apache confen.</p> <p><code>...</code> <code>Options\u00a0FollowSymLinks</code> <code>AllowOverride`` ``all</code> <code>Order\u00a0allow,deny</code> <code>Allow\u00a0from\u00a0all</code> <code>...</code></p> <p>S\u00e4tt p\u00e5 pretty links under Administration &gt; phpIPAM settings eller \u00e4ndra i databasen.</p> <p><code>use\u00a0phpipam;</code> <code>update\u00a0settings\u00a0set\u00a0prettyLinks='Yes/No'\u00a0where\u00a0settings.id=1;</code></p>"},{"location":"linux_services/PhpIPAM/#ad","title":"AD","text":"<p>Inlogg mot AD.</p>"},{"location":"linux_services/PhpIPAM/#https","title":"HTTPS","text":"<p>Aldrig fel med SSL.</p> <p><code>sudo\u00a0a2enmod\u00a0ssl\u00a0&amp;&amp;\u00a0sudo\u00a0a2ensite\u00a0default-ssl\u00a0&amp;&amp;\u00a0sudo\u00a0systemctl\u00a0restart\u00a0apache2</code></p>"},{"location":"linux_services/PhpIPAM/#smtp","title":"SMTP","text":""},{"location":"linux_services/PhpIPAM/#backup","title":"Backup","text":"<p>DB-backup kan schemal\u00e4ggas med cron</p> <p><code>#\u00a0Backup\u00a0IP\u00a0address\u00a0table,\u00a0remove\u00a0backups\u00a0older\u00a0than\u00a030\u00a0days</code> <code>@daily\u00a0/usr/bin/mysqldump\u00a0-u\u00a0root\u00a0-pPASSWORD\u00a0phpipam\u00a0&gt;\u00a0/var/www/html/db/bkp/phpipam_bkp_$(date\u00a0+\"\\%y\\%m\\%d\").db</code> <code>@daily\u00a0/usr/bin/find\u00a0/var/www/html/db/bkp/\u00a0-ctime\u00a0+30\u00a0-exec\u00a0rm\u00a0{}\u00a0\\;</code></p>"},{"location":"linux_services/PhpIPAM/#restore","title":"Restore","text":"<p>Dra upp en ny databas och l\u00e4s in backupen.</p> <p><code>CREATE\u00a0DATABASE\u00a0`phpipam`;</code> <code>exit</code> <code>mysql\u00a0-u\u00a0root\u00a0-p\u00a0&lt;\u00a0./backupfile.sql</code> <code>GRANT\u00a0ALL\u00a0on\u00a0`phpipam`.*\u00a0to\u00a0phpipam@localhost\u00a0identified\u00a0by\u00a0'ipamadmin';</code></p> <p>Logga in med Admin/ipamadmin p\u00e5 webgui.</p> <p>Category:Guider</p>"},{"location":"linux_services/Pi-hole/","title":"Pi-hole","text":"<p>Pi-hole \u00e4r en f\u00e4rdig DNS server med inbyggd adblock och malware block.</p> <p>Eftersom Pi-hole blockar reklam redan p\u00e5 DNS niv\u00e5 s\u00e5 kommer det funka p\u00e5 alla enheter och appar i mobilen. F\u00e5r man problem att anv\u00e4nda n\u00e5gon sida s\u00e5 kan det d\u00e4rf\u00f6r vara bra att inaktivera Pi-hole en stund, det g\u00f6r man visa WebUI.</p> <ul> <li>DNS over TLS (DoT) packages DNS transactions over a persistent     TLS session over TCP</li> <li>DNS over QUIC (DoQ) packages DNS transactions over an encrypted     QUIC session over UDP</li> <li>DNS over HTTPS (DoH) uses DNS over HTTP/3 (over QUIC) where     supported, and DNS over HTTP2 (over TLS) otherwise</li> </ul>"},{"location":"linux_services/Pi-hole/#installation","title":"Installation","text":"<p>Pi-Hole g\u00e5r att installera p\u00e5 bla Ubuntu, Debian, CentOS, Fedora. F\u00f6r att installera Pi-hole k\u00f6r man deras script.</p> <p><code>curl\u00a0-sSL</code><code>https://install.pi-hole.net</code><code>|\u00a0bash</code></p> <p>Uppdatera sedan din DHCP server s\u00e5 att den skickar ut Pi-Hole serverns IP adress som DNS server.</p>"},{"location":"linux_services/Pi-hole/#uppgradera","title":"Uppgradera","text":"<p>K\u00f6r f\u00f6ljande kommando f\u00f6r att uppgradera Pi-hole:</p> <p><code>pihole\u00a0-up</code></p> <p>Dry-run</p> <p><code>pihole\u00a0-up\u00a0--check-only</code></p>"},{"location":"linux_services/Pi-hole/#konfiguration","title":"Konfiguration","text":"<p>Pi-hole har ett webui f\u00f6r att kunna g\u00f6ra enklare inst\u00e4llningar. Det n\u00e5r man via:</p> <p><code>http://</code><code>/admin</code> <p>Category:Guider</p>"},{"location":"linux_services/Piwik/","title":"Piwik","text":"<p>Piwik \u00e4r som Google Analytics fast open-source. Man kan l\u00e5ta dom hosta din Piwik eller hosta den sj\u00e4lv. Du kan tex f\u00e5 reda p\u00e5 vart dina bes\u00f6kare kommer ifr\u00e5n hur dom kom ditt och hur m\u00e5nga bes\u00f6kare du har just nu men det \u00e4r bara n\u00e5gra av sakerna du kan f\u00e5 reda p\u00e5.</p> <p>Hackernet's egna Piwik.</p>"},{"location":"linux_services/Piwik/#forberedelse","title":"F\u00f6rberedelse","text":"<p>Du beh\u00f6ver LAMP och en databas som Piwik kan anv\u00e4nda.</p>"},{"location":"linux_services/Piwik/#installation","title":"Installation","text":"<p>Ladda hem och packa upp piwik i din web-root.</p> <p><code>wget</code><code>http://builds.piwik.org/piwik.zip</code><code>&amp;&amp;\u00a0unzip\u00a0piwik.zip</code></p> <p>Surfa sedan till <code>http://&lt;ip&gt;/piwik</code> och f\u00f6lj instruktionerna.</p> <p>Category:Guider Category:Sparco</p>"},{"location":"linux_services/Pmacct/","title":"Pmacct","text":"<p>Pmacct \u00e4r ett verktyg f\u00f6r att samla ihop och aggregera data om IP-trafik, som t.ex. Ntopng. Det kan (med dess underkomponenter) samla in interface-trafik (libpcap), NetFlow, IPFIX, sFlow och ULOG. Man kan spara datan i minne, flat-files eller diverse databaser, t.ex. MySQL, PgSQL, SQLite, MongoDB. pmacct kan anv\u00e4ndas f\u00f6r att skicka data till bl.a. RRDtool, Net-SNMP, MRTG och Cacti. Det g\u00e5r \u00e4ven att peera med routrar med BGP eller IS-IS f\u00f6r att f\u00e5 ut routinginformation (passiv granne, dvs annonserar aldrig n\u00e5got).</p> <p>pmacct: commandline pmacct client, used to retrieve data from a memory plugin</p> <p>pmacctd: libpcap-based accounting daemon, it captures packets from an interface it is bound to.</p> <p>nfacctd: NetFlow accounting daemon, it listens for NetFlow packets v1/v5/v7/v8/v9 and IPFIX on one or more interfaces (IPv4 and IPv6).</p>"},{"location":"linux_services/Pmacct/#installation","title":"Installation","text":"<p>Ubuntu 15.10</p> <p><code>sudo\u00a0apt-get\u00a0-y\u00a0install\u00a0pmacct</code> <code>pmacct\u00a0-V</code> <code>sudo\u00a0systemctl\u00a0status\u00a0pmacctd</code></p> <p>Verifiering</p> <p><code>whereis\u00a0pmacct</code> <code>whereis\u00a0pmacctd</code> <code>whereis\u00a0nfacctd</code></p>"},{"location":"linux_services/Pmacct/#konfiguration","title":"Konfiguration","text":""},{"location":"linux_services/Pmacct/#inputs","title":"Inputs","text":"<p>V\u00e4lj en input</p>"},{"location":"linux_services/Pmacct/#libpcap","title":"libpcap","text":"<p><code>sudo\u00a0ip\u00a0link\u00a0set\u00a0up\u00a0dev\u00a0eth1</code> <code>sudo\u00a0nano\u00a0/etc/pmacct/pmacctd.conf</code> <code>daemonize:\u00a0true</code> <code>promisc:\u00a0true</code> <code>interface:\u00a0eth1</code></p> <p>Start</p> <p><code>sudo\u00a0systemctl\u00a0start\u00a0pmacctd</code></p>"},{"location":"linux_services/Pmacct/#netflow","title":"Netflow","text":"<p><code>sudo\u00a0nano\u00a0/etc/pmacct/nfacctd.conf</code> <code>nfacctd_port:\u00a09999</code> <code>nfacctd_ip:\u00a0172.20.0.12</code> <code>nfacctd_time_new:\u00a0true</code></p> <p>Start</p> <p><code>sudo\u00a0systemctl\u00a0start\u00a0nfacctd</code></p>"},{"location":"linux_services/Pmacct/#bgp","title":"BGP","text":"<p><code>bgp_daemon:\u00a0true</code> <code>bgp_daemon_ip:\u00a0172.20.0.12</code> <code>bgp_daemon_max_peers:\u00a01</code> <code>bgp_table_dump_file:\u00a0/etc/pmacct/output/bgp-$peer_src_ip-%Y_%m_%dT%H_%M_%S.txt</code> <code>bgp_table_dump_refresh_time:\u00a03600</code></p>"},{"location":"linux_services/Pmacct/#data","title":"Data","text":"<p>Var ska datan lagras</p>"},{"location":"linux_services/Pmacct/#memory","title":"Memory","text":"<p><code>sudo\u00a0mkdir\u00a0/var/spool/pmacct/</code></p> <p>/etc/pmacct/**acctd.conf</p> <p><code>imt_mem_pools_number:\u00a00</code> <code>plugins:\u00a0memory[plugin1]</code> <code>imt_path[plugin1]:\u00a0/var/spool/pmacct/plugin1.pipe</code> <code>aggregate[plugin1]:\u00a0proto,\u00a0src_host,\u00a0src_port,\u00a0dst_host,\u00a0dst_port</code></p> <p>Kolla live</p> <p><code>pmacct\u00a0-p\u00a0/var/spool/pmacct/plugin1.pipe\u00a0-s</code></p>"},{"location":"linux_services/Pmacct/#flat-files","title":"Flat-files","text":"<p><code>plugins:\u00a0print</code></p>"},{"location":"linux_services/Pmacct/#mysql","title":"MySQL","text":"<p>Databas m\u00e5ste skapas f\u00f6rst.</p> <p><code>plugins:\u00a0mysql</code> <code>sql_db:\u00a0pmacct</code> <code>sql_host:\u00a0localhost</code> <code>sql_user:\u00a0root</code> <code>sql_passwd:\u00a0pmacct</code> <code>sql_refresh_time:\u00a03600</code> <code>sql_history:\u00a060m</code> <code>sql_history_roundoff:\u00a0h</code> <code>sql_table_version:\u00a01</code></p>"},{"location":"linux_services/Pmacct/#sqlite","title":"SQLite","text":"<p>Databas m\u00e5ste skapas f\u00f6rst.</p> <p><code>plugins:\u00a0sqlite3</code></p> <p>Category:Guider</p>"},{"location":"linux_services/PowerDNS/","title":"PowerDNS","text":"<p>Category:Guider PowerDNS \u00e4r en open source DNS som skapades i slutet av 1990 talet. PowerDNS \u00e4r v\u00e4ldigt anpassningsbart f\u00f6r man \u00e4r inte bunden att anv\u00e4nda enbart text filer utan man kan ha sina records i databaser ocks\u00e5. Det har gjort att PowerDNS har blivit enkelt att integrera i andra tj\u00e4nster som tex PhpIPAM och det finns \u00e4nnu fler olika web interface p\u00e5 n\u00e4tet. PowerDNS har ocks\u00e5 n\u00e5got dom kallar f\u00f6r en supermaster, som g\u00f6r att nya zoner som skapas automatiskt finns p\u00e5 alla slavar. PowerDNS har ocks\u00e5 ett v\u00e4ldigt bra DNSSEC st\u00f6d och driver 90% av Europas DNSSEC dom\u00e4ner.</p> <p>PowerDNS har delats upp i tv\u00e5 delar, PowerDNS Authoritative Server och PowerDNS Recursor.</p>"},{"location":"linux_services/PowerDNS/#powerdns-authoritative-server","title":"PowerDNS Authoritative Server","text":"<p>Authoritative server \u00e4r den sort DNS server som har hand om en dom\u00e4n. Klienter fr\u00e5gar denna servern f\u00f6r att f\u00e5 svar p\u00e5 sina DNS uppslag.</p>"},{"location":"linux_services/PowerDNS/#termer","title":"Termer","text":"<p>Native replication: PowerDNS kommer inte skicka ut eller agera vid en DNS update notification. Utan tar f\u00f6rgivet att backend systemet tar hand om replikeringen. Att l\u00e5ta databaser ta hand om replication har visat sig v\u00e4ldigt stabilt enligt PowerDNS \u00e4ven vid d\u00e5lig anslutning. Native v\u00e4ljs default p\u00e5 nya zoner.</p> <p>Master operation: PowerDNS skickar ut notifikationer till sina slavar vid en zone \u00e4ndring och sk\u00f6ter sj\u00e4lv replikeringen till en slav server.</p> <p>Slave operation: Vid uppstart skickar PowerDNS en request till alla backends en lista med dom\u00e4ner som nyligen inte kollat om dom \u00e4ndrats. Alla dom\u00e4ner som inte har senaste versionen kommer laddas ner.</p> <p>Supermaster: En supermaster automatiskt konfigurerar slavar med nya zoner n\u00e4r dom skapas. F\u00f6r att det ska fungera kr\u00e4vs bla att slaven vet om vem som \u00e4r supermaster, supermastern har ett SOA record i dom\u00e4nen och att ett NS record m\u00e5ste finnas som st\u00e4mmer \u00f6verens med supermastern IP'n som konfigurerats p\u00e5 slaven.</p> <ul> <li>#tab1|CentOS 7</li> <li>#tab2|Ubuntu 16.04</li> </ul>   L\u00e4gg till PowerDNS repo och installera epel samt yum priority plugin.  `yum\u00a0install\u00a0epel-release\u00a0yum-plugin-priorities` `curl\u00a0-o\u00a0/etc/yum.repos.d/powerdns-auth-master.repo\u00a0`[`https://repo.powerdns.com/repo-files/centos-auth-master.repo`](https://repo.powerdns.com/repo-files/centos-auth-master.repo)  Installera sedan PowerDNS servern.  `yum\u00a0install\u00a0pdns`     B\u00f6rja med att l\u00e4gga till PowerDNS repot:  `echo\u00a0\"deb\u00a0[arch=amd64]\u00a0`[`http://repo.powerdns.com/ubuntu`](http://repo.powerdns.com/ubuntu)`\u00a0xenial-auth-master\u00a0main\"\u00a0&gt;\u00a0/etc/apt/sources.list.d/pdns.list`  Skapa sedan **/etc/apt/preferences.d/pdns** med f\u00f6ljande inneh\u00e5ll:  `Package:\u00a0pdns-*` `Pin:\u00a0origin\u00a0repo.powerdns.com` `Pin-Priority:\u00a0600`  K\u00f6r sedan dessa kommandon:  `curl\u00a0`[`https://repo.powerdns.com/CBC8B383-pub.asc`](https://repo.powerdns.com/CBC8B383-pub.asc)`\u00a0|\u00a0sudo\u00a0apt-key\u00a0add\u00a0-\u00a0&amp;&amp;` `sudo\u00a0apt-get\u00a0update`  Installera sedan PowerDNS servern.  `sudo\u00a0apt-get\u00a0install\u00a0pdns-server` `\u00a0\u00a0`   <p>V\u00e4lj vilken backend du vill anv\u00e4nda, olika backends har olika st\u00f6d se f\u00f6ljande lista.(Bind st\u00f6d \u00e4r inbyggt)</p> <p><code>pdns-backend-geoip\u00a0-\u00a0geoip\u00a0backend\u00a0for\u00a0PowerDNS</code> <code>pdns-backend-ldap\u00a0-\u00a0LDAP\u00a0backend\u00a0for\u00a0PowerDNS</code> <code>pdns-backend-lua\u00a0-\u00a0Lua\u00a0backend\u00a0for\u00a0PowerDNS</code> <code>pdns-backend-mydns\u00a0-\u00a0MyDNS\u00a0compatibility\u00a0backend\u00a0for\u00a0PowerDNS</code> <code>pdns-backend-mysql\u00a0-\u00a0generic\u00a0MySQL\u00a0backend\u00a0for\u00a0PowerDNS</code> <code>pdns-backend-pgsql\u00a0-\u00a0generic\u00a0PostgreSQL\u00a0backend\u00a0for\u00a0PowerDNS</code> <code>pdns-backend-pipe\u00a0-\u00a0pipe/coprocess\u00a0backend\u00a0for\u00a0PowerDNS</code> <code>pdns-backend-remote\u00a0-\u00a0remote\u00a0backend\u00a0for\u00a0PowerDNS</code> <code>pdns-backend-sqlite3\u00a0-\u00a0sqlite\u00a03\u00a0backend\u00a0for\u00a0PowerDNS</code> <code>pdns-backend-tinydns\u00a0-\u00a0tinydns\u00a0compatibility\u00a0backend\u00a0for\u00a0PowerDNS</code></p>"},{"location":"linux_services/PowerDNS/#konfiguration","title":"Konfiguration","text":"<p>10.0.0.1 Supermaster.hackernet.se</p> <p>10.0.0.2 ns1.hackernet.se</p> <p>10.0.0.3 ns2.hackernet.se</p> <p>I guiden har vi valt att anv\u00e4nda MySQL som backend. Och skapa en supermaster server som l\u00e5ter PowerDNS sk\u00f6ta replikeringen.</p>"},{"location":"linux_services/PowerDNS/#master","title":"Master","text":"<p>L\u00e4gg in f\u00f6ljande i <code>/etc/powerdns/pdns.conf</code>:</p> <p><code>allow-recursion=0.0.0.0/0</code> <code>allow-axfr-ips=10.0.0.2/32,10.0.0.3/32</code> <code>also-notify=10.0.0.2,10.0.0.3</code> <code>config-dir=/etc/powerdns</code> <code>daemon=yes</code> <code>disable-axfr=no</code> <code>guardian=yes</code> <code>local-address=0.0.0.0</code> <code>local-port=53</code> <code>log-dns-details=on</code> <code>loglevel=3</code> <code>module-dir=/usr/lib/x86_64-linux-gnu/pdns/</code> <code>master=yes</code> <code>slave=no</code> <code>setgid=pdns</code> <code>setuid=pdns</code> <code>socket-dir=/var/run</code> <code>version-string=powerdns</code> <code>include-dir=/etc/powerdns/pdns.d</code> <code>launch=gmysql</code></p> <p>I /etc/powerdns/pdns.d skapa filen <code>pdns.local.gmysql.conf</code>. Om filen redan fanns g\u00e5 till n\u00e4sta steg.</p> <p><code>gmysql-host=localhost</code> <code>gmysql-port=</code> <code>gmysql-dbname=pdns</code> <code>gmysql-user=pdns</code> <code>gmysql-password=</code> <code>gmysql-dnssec=yes</code> <p>Om filen skulle finnas med ett l\u00f6senord redan i s\u00e5 \u00e4r det troligt att under installationen s\u00e5 skapades det en databas och fylldes med default tables. Ifall du beh\u00f6ver skapa tables sj\u00e4lv s\u00e5 k\u00f6r f\u00f6ljande MySQL kommando f\u00f6r att skapa dom.</p>   MySQL kommandon.   <pre><code>CREATE TABLE domains (\n  id                    INT AUTO_INCREMENT,\n  name                  VARCHAR(255) NOT NULL,\n  master                VARCHAR(128) DEFAULT NULL,\n  last_check            INT DEFAULT NULL,\n  type                  VARCHAR(6) NOT NULL,\n  notified_serial       INT DEFAULT NULL,\n  account               VARCHAR(40) DEFAULT NULL,\n  PRIMARY KEY (id)\n) Engine=InnoDB;\n\nCREATE UNIQUE INDEX name_index ON domains(name);\n\n\nCREATE TABLE records (\n  id                    INT AUTO_INCREMENT,\n  domain_id             INT DEFAULT NULL,\n  name                  VARCHAR(255) DEFAULT NULL,\n  type                  VARCHAR(10) DEFAULT NULL,\n  content               VARCHAR(64000) DEFAULT NULL,\n  ttl                   INT DEFAULT NULL,\n  prio                  INT DEFAULT NULL,\n  change_date           INT DEFAULT NULL,\n  disabled              TINYINT(1) DEFAULT 0,\n  ordername             VARCHAR(255) BINARY DEFAULT NULL,\n  auth                  TINYINT(1) DEFAULT 1,\n  PRIMARY KEY (id)\n) Engine=InnoDB;\n\nCREATE INDEX nametype_index ON records(name,type);\nCREATE INDEX domain_id ON records(domain_id);\nCREATE INDEX recordorder ON records (domain_id, ordername);\n\n\nCREATE TABLE supermasters (\n  ip                    VARCHAR(64) NOT NULL,\n  nameserver            VARCHAR(255) NOT NULL,\n  account               VARCHAR(40) NOT NULL,\n  PRIMARY KEY (ip, nameserver)\n) Engine=InnoDB;\n\n\nCREATE TABLE comments (\n  id                    INT AUTO_INCREMENT,\n  domain_id             INT NOT NULL,\n  name                  VARCHAR(255) NOT NULL,\n  type                  VARCHAR(10) NOT NULL,\n  modified_at           INT NOT NULL,\n  account               VARCHAR(40) NOT NULL,\n  comment               VARCHAR(64000) NOT NULL,\n  PRIMARY KEY (id)\n) Engine=InnoDB;\n\nCREATE INDEX comments_domain_id_idx ON comments (domain_id);\nCREATE INDEX comments_name_type_idx ON comments (name, type);\nCREATE INDEX comments_order_idx ON comments (domain_id, modified_at);\n\n\nCREATE TABLE domainmetadata (\n  id                    INT AUTO_INCREMENT,\n  domain_id             INT NOT NULL,\n  kind                  VARCHAR(32),\n  content               TEXT,\n  PRIMARY KEY (id)\n) Engine=InnoDB;\n\nCREATE INDEX domainmetadata_idx ON domainmetadata (domain_id, kind);\n\n\nCREATE TABLE cryptokeys (\n  id                    INT AUTO_INCREMENT,\n  domain_id             INT NOT NULL,\n  flags                 INT NOT NULL,\n  active                BOOL,\n  content               TEXT,\n  PRIMARY KEY(id)\n) Engine=InnoDB;\n\nCREATE INDEX domainidindex ON cryptokeys(domain_id);\n\n\nCREATE TABLE tsigkeys (\n  id                    INT AUTO_INCREMENT,\n  name                  VARCHAR(255),\n  algorithm             VARCHAR(50),\n  secret                VARCHAR(255),\n  PRIMARY KEY (id)\n) Engine=InnoDB;\n\nCREATE UNIQUE INDEX namealgoindex ON tsigkeys(name, algorithm);\n</code></pre> <p>Ta bort <code>pdns.simplebind.conf</code> om du inte t\u00e4nkt anv\u00e4nda bind som backend.</p> <p>Starta sedan om PowerDNS tj\u00e4nsten.</p> <p><code>service\u00a0pdns\u00a0restart</code></p>"},{"location":"linux_services/PowerDNS/#slave","title":"Slave","text":"<p>G\u00f6r exakt samma p\u00e5 slaven med databasen fast l\u00e4gg in f\u00f6ljande i <code>pdns.conf</code> ist\u00e4llet:</p> <p><code>allow-recursion=0.0.0.0/0</code> <code>config-dir=/etc/powerdns</code> <code>daemon=yes</code> <code>disable-axfr=yes</code> <code>guardian=yes</code> <code>local-address=0.0.0.0</code> <code>local-port=53</code> <code>log-dns-details=on</code> <code>loglevel=3</code> <code>module-dir=/usr/lib/x86_64-linux-gnu/pdns/</code> <code>master=no</code> <code>slave=yes</code> <code>slave-cycle-interval=60</code> <code>setgid=pdns</code> <code>setuid=pdns</code> <code>socket-dir=/var/run</code> <code>version-string=powerdns</code> <code>include-dir=/etc/powerdns/pdns.d</code> <code>launch=gmysql</code></p> <p>Slaven kommer fr\u00e5ga supermastern efter ny zone update var 60 sekund. Vanligast \u00e4r att mastern skickar ut en notifikation till slaven men om det skulle vara problem med anslutningen under den tiden s\u00e5 kommer slaven fr\u00e5ga mastern n\u00e4r dom kan n\u00e5 varandra igen.</p> <p>L\u00e4gg till en supermaster f\u00f6r slaven.</p> <p>Logga in p\u00e5 databasen med:</p> <p><code>mysql\u00a0-u\u00a0pdns\u00a0-p</code></p> <p>Byt till databasen:</p> <p><code>USE\u00a0pdns;</code></p> <p>L\u00e4gg in en rad i supermasters table:</p> <p><code>insert\u00a0into\u00a0supermasters\u00a0values\u00a0('10.0.0.1',\u00a0'supermaster.hackernet.se',\u00a0'admin');</code></p> <p>L\u00e4mna MySQL:</p> <p><code>exit;</code></p> <p>Starta om PowerDNS:</p> <p><code>service\u00a0pdns\u00a0restart</code></p>"},{"location":"linux_services/PowerDNS/#skapa-zone","title":"Skapa zone","text":"<p>Skapa en zone med hj\u00e4lp av pdnsutil:</p> <p><code>pdnsutil\u00a0create-zone\u00a0hackernet.se\u00a0supermaster.hackernet.se</code></p> <p>L\u00e4gg till n\u00e5gra A record:</p> <p><code>pdnsutil\u00a0add-record\u00a0hackernet.se\u00a0supermaster\u00a0A\u00a010.0.0.1</code> <code>pdnsutil\u00a0add-record\u00a0hackernet.se\u00a0ns1\u00a0A\u00a010.0.0.2</code> <code>pdnsutil\u00a0add-record\u00a0hackernet.se\u00a0ns2\u00a0A\u00a010.0.0.3</code></p> <p>L\u00e4gg till fler NS record:</p> <p><code>pdnsutil\u00a0add-record\u00a0hackernet.se\u00a0@\u00a0NS\u00a0ns1.hackernet.se</code> <code>pdnsutil\u00a0add-record\u00a0hackernet.se\u00a0@\u00a0NS\u00a0ns2.hackernet.se</code></p> <p>\u00c4ndra zonen fr\u00e5n native zone till master zone.</p> <p><code>pdnsutil\u00a0set-kind\u00a0hackernet.se\u00a0master</code></p> <p>Verifiera att zonen \u00e4r master:</p> <p><code>pdnsutil\u00a0show-zone\u00a0hackernet.se</code></p> <p>Skicka ut en notifikation med mastern eller v\u00e4nta tills slaven sj\u00e4lv h\u00e4mtar zonen:</p> <p><code>pdns_control\u00a0notify\u00a0hackernet.se</code></p>"},{"location":"linux_services/PowerDNS/#sakra-upp-zonetransfer","title":"S\u00e4kra upp zonetransfer","text":"<p>Man kan s\u00e4kra upp zonetransfer med hj\u00e4lp av en TSIG nykel.</p> <p>B\u00f6rja med att generera en TSIG nyckel p\u00e5 master servern.</p> <p><code>pdnsutil\u00a0generate-tsig-key\u00a0tsig-transfer\u00a0hmac-sha512</code></p> <p>Aktivera sedan nykel p\u00e5 det zoner du vill s\u00e4kra upp.</p> <p><code>pdnsutil\u00a0activate-tsig-key\u00a0hackernet.se\u00a0tsig-transfer\u00a0master</code></p> <p>Lista sedan TSIG nykeln s\u00e5 du kan kopiera den till slaven.</p> <p><code>pdnsutil\u00a0list-tsig-keys</code></p> <p>Importera nyckeln p\u00e5 slaven.</p> <p><code>pdnsutil\u00a0import-tsig-key\u00a0tsig-transfer\u00a0hmac-sha512\u00a0'L\u00e5ngsuperhackerkod'</code></p> <p>Aktivera sedan TSIG nykeln p\u00e5 samma zoner som p\u00e5 mastern.</p> <p><code>pdnsutil\u00a0activate-tsig-key\u00a0hackernet.se\u00a0tsig-transfer\u00a0slave</code></p> <p>Att t\u00e4nka p\u00e5: Det \u00e4r viktigt att nyckeln har samma namn p\u00e5 b\u00e5de mastern och slaven.</p>"},{"location":"linux_services/PowerDNS/#powerdns-recursor","title":"PowerDNS Recursor","text":"<p>Skickar vidare din fr\u00e5ga till olika DNS servrar tills den hittar svaret.</p>"},{"location":"linux_services/PowerDNS/#installation","title":"Installation","text":"<p>Debian/Ubuntu</p> <p><code>apt-get\u00a0install\u00a0pdns-recursor</code></p>"},{"location":"linux_services/PowerDNS/#konfiguration_1","title":"Konfiguration","text":"<p>Recursor \u00e4r v\u00e4ldigt simpelt att konfigurera upp. Om man vill k\u00f6ra recursor och authoritative p\u00e5 samma server s\u00e5 beh\u00f6ver man byta vilken port recursor lyssnar p\u00e5. Och sedan skicka vidare svar fr\u00e5n authoritative servern som den inte kan svara p\u00e5.</p> <p>recursor.conf</p> <p><code>forward-zones=8.8.8.8,8.8.4.4</code> <code>trace=on</code></p>"},{"location":"linux_services/PowerDNS/#recursor-och-authoritative","title":"Recursor och authoritative","text":"<p>L\u00e4gg till f\u00f6ljande rad i pdns.conf:</p> <p><code>recursor=127.0.0.1:5678</code></p> <p>Och \u00e4ndra vilken port recursor lyssnar p\u00e5 i recursor.conf:</p> <p><code>local-port=5678</code></p> <p>Var noga med att peka p\u00e5 r\u00e4tt port s\u00e5 att du inte pekar tillbaka p\u00e5 authoritative servern f\u00f6r d\u00e5 kommer man f\u00e5 en loop.</p>"},{"location":"linux_services/PowerDNS/#dnssec","title":"DNSSEC","text":"<p>DNSSEC \u00e4r en funktion som signerar DNS-uppslagningar med krypto nycklar s\u00e5 att man kan s\u00e4kerst\u00e4lla att det svaret man f\u00e5tt kommit fr\u00e5n r\u00e4tt k\u00e4lla, och inte manipulerats p\u00e5 v\u00e4gen. Med DNSSEC skyddas du fr\u00e5n bland annat cachef\u00f6rgiftning och pharming som \u00e4r dom vanligaste attackerna.</p> <p>F\u00f6r att s\u00e4tta p\u00e5 DNSSEC:</p> <p><code>pdnsutil\u00a0secure-zone\u00a0ZONE</code></p> <p>F\u00f6r att st\u00e4nga av DNSSEC:</p> <p><code>pdnsutil\u00a0disable-dnssec\u00a0ZONE</code></p> <p>K\u00f6r sedan f\u00f6ljande kommando f\u00f6r visa dina DS record:</p> <p><code>pdnsutil\u00a0show-zone\u00a0ZONE</code></p> <p>Outputen du \u00e4r intresserad av \u00e4r i slutet och ser ut som f\u00f6ljande:</p> <p><code>...</code> <code>DS\u00a0=\u00a0hackernet.se.\u00a0IN\u00a0DS\u00a017379\u00a013\u00a01\u00a075a7f4a06792509298bfb0996df3614b129a6570\u00a0;\u00a0(\u00a0SHA1\u00a0digest\u00a0)</code> <code>DS\u00a0=\u00a0hackernet.se.\u00a0IN\u00a0DS\u00a017379\u00a013\u00a02\u00a0c72f7424c86a46866499ae284bec1b55095ca32e0f6955a9a9ba21df5d010d57\u00a0;\u00a0(\u00a0SHA256\u00a0digest\u00a0)</code> <code>...</code></p> <p>Formatet f\u00f6r ett DS record \u00e4r:</p> <p><code>DS\u00a0=</code><code>IN\u00a0DS</code><code></code><code></code><code></code> <p>Det din dom\u00e4n \u00e5terf\u00f6rs\u00e4ljare kommer vara intresserad av f\u00f6r att kunna uppdatera din Top-level domain \u00e4r:</p> <ul> <li>Key tag: 17379</li> <li>DNSKEY Algorithm: 13 (ECDSAP256SHA256)</li> <li>Digest Type: 1 (SHA-1)</li> <li>Key Digest: 75a7f4a06792509298bfb0996df3614b129a6570</li> </ul>"},{"location":"linux_services/PowerDNS/#dynamic-dns","title":"Dynamic DNS","text":"<p>G\u00f6r att en DHCP server automatiskt uppdaterar b\u00e5da din forward och reverse zone n\u00e4r den tilldelar en enhet en IP, d\u00e5 slipper man sj\u00e4lv uppdatera zoner.</p> <p>DDNS st\u00f6ds bara av f\u00f6ljande backends</p> <ul> <li>gmysql</li> <li>gpgsql</li> <li>gsqlite3</li> <li>goracle</li> <li>godbc</li> </ul> <p>B\u00f6rja med att generera en TSIG nykel som kommer anv\u00e4ndas f\u00f6r att g\u00f6ra uppdateringen s\u00e4krare:</p> <p><code>pdnsutil\u00a0generate-tsig-key\u00a0ddns_update\u00a0hmac-sha512</code></p> <p>Aktivera nykeln p\u00e5 dom dom\u00e4ner du vill uppdatera.</p> <p><code>pdnsutil\u00a0set-meta\u00a0hackernet.se\u00a0TSIG-ALLOW-DNSUPDATE\u00a0ddns_update</code></p> <p>Till\u00e5t enbart vissa n\u00e4t att f\u00e5 uppdatera zonen.</p> <p><code>pdnsutil\u00a0set-meta\u00a0hackernet.se\u00a0ALLOW-DNSUPDATE-FROM\u00a0192.168.1.0/24</code> <code>pdnsutil\u00a0set-meta\u00a0hackernet.se\u00a0ALLOW-DNSUPDATE-FROM\u00a010.100.0.0/24</code></p> <p>Se till s\u00e5 att mastern skickar en notification till slavarna vid varje uppdatering. Annars f\u00e5r man v\u00e4nta tills slaven sj\u00e4lv fr\u00e5gar mastern.</p> <p><code>pdnsutil\u00a0set-meta\u00a0hackernet.se\u00a0NOTIFY-DNSUPDATE\u00a01</code></p> <p>L\u00e4gg sedan till f\u00f6ljande rad i pdns.conf</p> <p><code>dnsupdate=yes</code></p> <p>Starta om PowerDNS, f\u00f6r att verifiera att det funkar kan du k\u00f6ra f\u00f6ljande kommando:</p> <p><code>nsupdate\u00a0&lt;&lt;!</code> <code>server</code><code></code> <code>zone\u00a0hackernet.se</code> <code>update\u00a0add\u00a0ddnstest.hackernet.se\u00a03600\u00a0A\u00a010.13.37.1</code> <code>key\u00a0ddns_update</code> <code>send</code> <code>!</code> <p>Om det funkar kommer ett record i hackernet.se zonen att skapas som heter ddnstest. Repitera p\u00e5 fler dom\u00e4ner samt reverse zoner om s\u00e5dana finns. Samma nykel kan anv\u00e4ndas p\u00e5 alla zoner om man vill.</p>"},{"location":"linux_services/PowerDNS/#dhcpd","title":"dhcpd","text":"<p>Konfigurera din DHCP server att anv\u00e4nda nykeln och det namn du valt p\u00e5 nykeln i detta fallet ddns_update.</p> <p>Under h\u00e4r kommer ett exempel f\u00f6r ISC_DHCP.</p> <p>Skapa en fil som heter ddns.key med f\u00f6ljande inneh\u00e5ll under /etc/dhcp/:</p> <p><code>key\u00a0\"ddns_update\"\u00a0{</code> <code>algorithm\u00a0hmac-sha512;</code> <code>secret\u00a0\"</code><code>\";</code> <code>};</code> <p>L\u00e4gg sedan in f\u00f6ljande rader i DHCP conf filen:</p> <p><code>ddns-updates\u00a0on;</code> <code>ddns-update-style\u00a0interim;</code> <code>update-static-leases\u00a0on;</code></p> <p><code>ddns-domainname\u00a0\"hackernet.se\";</code> <code>ddns-rev-domainname\u00a0\"in-addr.arpa.\";</code></p> <p><code>include\u00a0\"/etc/dhcp/ddns.key\";</code> <code>zone\u00a0hackernet.se\u00a0{</code> <code>primary\u00a0127.0.0.1;</code> <code>key\u00a0ddns_update;</code> <code>}</code></p> <p><code>zone\u00a00.168.192.in-addr.arpa.\u00a0{</code> <code>primary\u00a0127.0.0.1;</code> <code>key\u00a0ddns_update;</code> <code>}</code></p> <p>Byt ut 127.0.0.1 mot din prim\u00e4ra dns server.</p> <p>Starta om DHCP servern.</p>"},{"location":"linux_services/PowerDNS/#tools","title":"Tools","text":"<p>Det finns massa olika verktyg f\u00f6r PowerDNS tex kraftiga webinterface och cli verktyg.</p>"},{"location":"linux_services/PowerDNS/#pdns-manager","title":"PDNS Manager","text":"<p>Ett enkelt webinterface d\u00e4r du kan skapa nya zoner, records och som har st\u00f6d f\u00f6r att signa certifikat med Let's Encrypt och ett API.</p> <p>https://pdnsmanager.lmitsystems.de/</p>"},{"location":"linux_services/PowerDNS/#poweradmin","title":"Poweradmin","text":"<p>Ett webinterface som ocks\u00e5 kan skapa zoner och records men har \u00e4ven ett b\u00e4ttre st\u00f6d f\u00f6r anv\u00e4ndare d\u00e4r man kan st\u00e4lla in permissions p\u00e5 vilka dom\u00e4ner som en anv\u00e4ndare f\u00e5r \u00e4ndra i. Och har st\u00f6d f\u00f6r att LDAP koppla anv\u00e4ndare.</p> <p>http://www.poweradmin.org/</p>"},{"location":"linux_services/PowerDNS/#pdnsutil","title":"pdnsutil","text":"<p>\u00c4r ett CLI verktyg f\u00f6r PowerDNS. D\u00e4r man i stort sett kan g\u00f6ra allt p\u00e5 zoner tex generera och l\u00e4gga till tsig nycklar, migrera backend l\u00f6sning, benchmarka backend delen och mycket mer.</p> <p>Skapa en native zone:</p> <p><code>pdnsutil\u00a0create-zone\u00a0hackernet.se</code></p> <p>Skapa en native zone med ett NS record:</p> <p><code>pdnsutil\u00a0create-zone\u00a0hackernet.se\u00a0ns1.hackernet.se</code></p> <p>Skapa en slave zone d\u00e4r IP'n i slutet \u00e4r master server:</p> <p><code>pdnsutil\u00a0create-slave-zone\u00a0hackernet.se\u00a010.0.0.1</code></p> <p>Editera en zone:</p> <p><code>pdnsutil\u00a0edit-zone\u00a0hackernet.se</code></p> <p>Skapa ett NS record:</p> <p><code>pdnsutil\u00a0add-record\u00a0hackernet.se\u00a0@\u00a0NS\u00a0ns1.hackernet.se</code></p> <p>Skapa ett record:</p> <p><code>pdnsutil\u00a0add-record\u00a0hackernet.se\u00a0ns1\u00a0[A/AAAA/MX/CNAME/...]\u00a010.0.0.2</code></p> <p>Lista alla zoner:</p> <p><code>pdnsutil\u00a0list-all-zones</code></p> <p>\u00c4ndra zone operation:</p> <p><code>pdnsutil\u00a0set-kind\u00a0hackernet.se\u00a0master/native/slave</code></p> <p>Till\u00e5t alla IP's som \u00e4r inlagda som en namnserver f\u00f6r dom\u00e4nen att g\u00f6ra zone transfers:</p> <p><code>pdnsutil\u00a0set-meta\u00a0hackernet.se\u00a0ALLOW-AXFR-FROM\u00a0AUTO-NS</code></p> <p>\u00d6ka SOA serial med 1:</p> <p><code>pdnsutil\u00a0increase-serial\u00a0hackernet.se</code></p>"},{"location":"linux_services/PowerDNS/#pdnscat","title":"pdnscat","text":"<p>pdnscat \u00e4r ett bash script som h\u00e4mtar alla records genom PowerDNS API och g\u00f6r s\u00e5 att man kan greppa p\u00e5 records. N\u00e4r man filtrerat ner till ett resultat s\u00e5 kan man v\u00e4lja att SSHa mot det recordet med f\u00f6rinst\u00e4llda username som root, admin och den anv\u00e4ndaren du \u00e4r.</p> <p>Curl och JQ beh\u00f6vs f\u00f6r att scriptet ska fungera.</p> <p><code>git\u00a0clone</code><code>https://github.com/Hackernet-se/pdnscat</code> <code>./pdnscat\u00a0arg1\u00a0arg2\u00a0arg3\u00a0...\u00a0[f]\u00a0[a|r|q]\u00a0...\"</code></p>"},{"location":"linux_services/PowerDNS/#exempel","title":"Exempel","text":"sparco@jumpgate:~$ y ns     10.240.100.12   A       ns3     172.22.0.12     A       ns4     10.240.100.13   A       ns5     172.22.0.13     A       ns6         sparco@jumpgate:~$ y ns 5     10.240.100.13   A       ns5     sparco@jumpgate:~$ y ns 5 r      --- IP and hostname ---     10.240.100.13     ns5     ssh root@10.240.100.13      root@10.240.100.13's password:     Welcome to Ubuntu 16.04.2 LTS (GNU/Linux 4.4.0-79-generic x86_64)         sparco@jumpgate:~$ y rsg f     10.60.0.50      A       rsg-proxy.hackernet.se.     10.60.0.4       A       esxispa1-ilo.rsg.hackernet.se.     10.60.0.5       A       esxispa2-ilo.rsg.hackernet.se.     10.60.0.6       A       esxispa3-ilo.rsg.hackernet.se.     10.60.0.16      A       esxispa3.rsg.hackernet.se.     10.60.0.53      A       foreman.rsg.hackernet.se.     10.60.0.12      A       ilocz3128ldh5.rsg.hackernet.se.     10.60.0.5       A       ilocz3128ldje.rsg.hackernet.se.     10.60.0.6       A       ilocz3128ldjv.rsg.hackernet.se.     10.60.0.10      A       ilocz3128ldjy.rsg.hackernet.se.     10.60.0.11      A       ilocz3128ldkb.rsg.hackernet.se.     10.60.0.4       A       ilocz3128le5v.rsg.hackernet.se.     10.60.0.7       A       ilocz32025rlt.rsg.hackernet.se.     10.60.0.9       A       ilocz32025rma.rsg.hackernet.se.     10.60.0.8       A       iloczj2100hf4.rsg.hackernet.se.    Abbreviation ============  **AXFR**= \u00c4r en full zone transfer som \u00f6verf\u00f6r hela zonen.  **IXFR**= \u00c4r en incremental zone transfer som endast \u00f6verf\u00f6r det som har f\u00f6r\u00e4ndrats."},{"location":"linux_services/Prometheus/","title":"Prometheus","text":"<p>Category:Guider</p> <p>Prometheus is a an open source monitoring and alerting toolkit. Originally built by a couple of Soundcloud engineers to modernize monitoring.The core of Prometheus is a data model with time series data identified by metric name and key/value pairs and stored in a time series database.</p> <p>Prometheus also includes:</p> <ul> <li>a flexible query language to leverage this dimensionality</li> <li>no reliance on distributed storage; single server nodes are     autonomous</li> <li>time series collection happens via a pull model over HTTP</li> <li>pushing time series is supported via an intermediary gateway</li> <li>targets are discovered via service discovery or static configuration</li> <li>multiple modes of graphing and dashboarding</li> </ul>"},{"location":"linux_services/Prometheus/#hackernets-setup","title":"Hackernets Setup","text":"<p>We are using a fairly simple setup with all prometheus components running in docker containers. Since Prometheus relies on pulling metrics via HTTP the data gathering and conversion to the correct metric format has to be done by components outside of Prometheus. We currently use different projects to gather data, but writing your own applications is very easy considering the extensive amount of language support that the Prometheus project has to offer.</p> <p>Our containers:</p> <pre><code>[root@prometheus ~]# docker ps\nCONTAINER ID        IMAGE                COMMAND                  CREATED             STATUS              PORTS                    NAMES\n7e22a6c7bbc4        vmware_exporter      \"/opt/vmware_exporte\u2026\"   8 days ago          Up 8 days           0.0.0.0:9272-&gt;9272/tcp   vmware_exporter\n67c5bfbaa81b        blackbox_exporter    \"/bin/blackbox_expor\u2026\"   9 days ago          Up 8 days           0.0.0.0:9115-&gt;9115/tcp   blackbox_exporter\nc77043cc77fe        grafana/grafana      \"/run.sh\"                9 days ago          Up 8 days           0.0.0.0:80-&gt;3000/tcp     grafana\n463e5b3663c7        prom/prometheus      \"/bin/prometheus --c\u2026\"   2 weeks ago         Up 8 days           0.0.0.0:9090-&gt;9090/tcp   prometheus\n809f4ab916c9        prom/node-exporter   \"/bin/node_exporter\"     2 weeks ago         Up 8 days           0.0.0.0:9100-&gt;9100/tcp   node_exporter\n</code></pre>"},{"location":"linux_services/Prometheus/#node-exporters","title":"Node Exporters","text":""},{"location":"linux_services/Prometheus/#pfsense","title":"pfSense","text":"<p>F\u00f6ljande \u00e4r veriferat p\u00e5 pfsense 2.4.2 som k\u00f6r FreeBSD 11.1. \u00c4ndra till yes i f\u00f6ljande 3 filer:</p> <p><code>vi\u00a0/usr/local/etc/pkg/repos/FreeBSD.conf</code> <code>vi\u00a0/usr/local/etc/pkg/repos/pfSense.conf</code> <code>vi\u00a0/etc/pkg/FreeBSD.conf</code></p> <p>Installera sedan node_exporter</p> <p><code>pkg\u00a0install\u00a0node_exporter</code></p> <p>L\u00e4gg sedan till s\u00e5 node_exporter startar vid omboot.</p> <p><code>echo\u00a0\"node_exporter_enable=\"YES\"\"\u00a0&gt;&gt;\u00a0/etc/rc.conf</code></p> <p>Starta sedan tj\u00e4nsten:</p> <p><code>service\u00a0node_exporter\u00a0start</code></p> <p>Exportern g\u00e5r att n\u00e5 p\u00e5 default porten 9100.</p>"},{"location":"linux_services/Prometheus/#linux","title":"Linux","text":"<pre><code>sudo useradd --no-create-home --shell /bin/false node_exporter &amp;&amp; \\\nwget https://github.com/prometheus/node_exporter/releases/download/v0.18.1/node_exporter-0.18.1.linux-amd64.tar.gz &amp;&amp; \\\ntar -xf node_exporter-0.18.1.linux-amd64.tar.gz &amp;&amp; sudo cp node_exporter-0.18.1.linux-amd64/node_exporter /usr/local/bin/ &amp;&amp; \\\nsudo chown node_exporter:node_exporter /usr/local/bin/node_exporter &amp;&amp; rm -rf node_exporter-0.18.1.linux-amd64* &amp;&amp; \\\nsudo bash -c \"cat &lt;&lt;__EOF__&gt;&gt; /etc/systemd/system/node_exporter.service\n[Unit]\nDescription=Node Exporter\nWants=network-online.target\nAfter=network-online.target\n\n[Service]\nUser=node_exporter\nGroup=node_exporter\nType=simple\nExecStart=/usr/local/bin/node_exporter\n\n[Install]\nWantedBy=multi-user.target\n__EOF__\"\nsudo systemctl daemon-reload &amp;&amp; sudo systemctl start node_exporter &amp;&amp; sudo systemctl enable node_exporter\n</code></pre>"},{"location":"linux_services/Puppet/","title":"Puppet","text":"<p>Category:Guider Category:Sparco Puppet \u00e4r ett automatiseringsverktyg f\u00f6r servrar. Puppet \u00e4r ett v\u00e4ldigt kraftfullt verktyg, du kan f\u00e5 en fil att se likadan ut p\u00e5 1000 olika servrar p\u00e5 bara 2 minuter eller att se till att SSH confen \u00e4r den samma. Puppet kan k\u00f6ras i b\u00e5de Unix och Windows milj\u00f6r. M\u00e5nga stora f\u00f6retag anv\u00e4nder Puppet tex, Google, Twitter, Spotify, Dell. Puppet \u00e4r mycket anv\u00e4ndbart om man har servrar med olika operativsystem. Skillnaderna mellan olika operativsystem spelar ingen roll, man kan s\u00e4tta upp en huvudserver och lagra konfigurationer f\u00f6r alla servrar. Huvudservern kallas master och klienterna k\u00f6r agenter. Klienterna ansluter regelbundet till mastern f\u00f6r att synkronisera sina konfigurationer och rapportera alla lokala \u00e4ndringar tillbaka till mastern. Master m\u00e5ste vara av samma version eller nyare \u00e4n de agenter som ansluter till den. Puppet finns i Enterprise eller som open source.</p>"},{"location":"linux_services/Puppet/#forberedelse","title":"F\u00f6rberedelse","text":"<p>L\u00e4gg in Puppets egna repos f\u00f6r att f\u00e5 tag p\u00e5 fler och senare versioner av Puppet.</p> <p>Tanka hem och k\u00f6r r\u00e4tt deb paket fr\u00e5n <code>https://apt.puppetlabs.com/</code></p>"},{"location":"linux_services/Puppet/#installation","title":"Installation","text":"<p>Det \u00e4r viktigt att man k\u00f6r samma version p\u00e5 puppet master och puppet agent f\u00f6r att inte f\u00e5 n\u00e5gra kompatibilitets problem.</p>"},{"location":"linux_services/Puppet/#server","title":"Server","text":""},{"location":"linux_services/Puppet/#debianubuntu","title":"Debian/Ubuntu","text":"<p><code>sudo\u00a0apt-get\u00a0update\u00a0&amp;&amp;\u00a0sudo\u00a0apt-get\u00a0-y\u00a0upgrade\u00a0&amp;&amp;\u00a0sudo\u00a0apt-get\u00a0-y\u00a0install\u00a0puppetmaster\u00a0rdoc\u00a0ntp</code> <code>sudo\u00a0touch\u00a0/etc/puppet/manifests/site.pp</code></p>"},{"location":"linux_services/Puppet/#centosredhat","title":"CentOS/RedHat","text":"<p><code>sudo\u00a0yum\u00a0update\u00a0&amp;&amp;\u00a0sudo\u00a0yum\u00a0install\u00a0puppet-server\u00a0ntp</code> <code>sudo\u00a0touch\u00a0/etc/puppet/manifests/site.pp</code></p>"},{"location":"linux_services/Puppet/#klient","title":"Klient","text":"<p><code>sudo\u00a0apt-get\u00a0update\u00a0&amp;&amp;\u00a0sudo\u00a0apt-get\u00a0upgrade\u00a0&amp;&amp;\u00a0sudo\u00a0apt-get\u00a0-y\u00a0install\u00a0puppet\u00a0ntp</code> <code>sudo\u00a0yum\u00a0update\u00a0&amp;&amp;\u00a0sudo\u00a0yum\u00a0install\u00a0puppet\u00a0ntp</code></p>"},{"location":"linux_services/Puppet/#namnuppslag","title":"Namnuppslag","text":"<p>Default f\u00f6r att hitta till mastern g\u00f6r klienterna ett namnuppslag p\u00e5 puppet. S\u00e4tt upp i din DNS s\u00e5 att puppet pekar mot mastern. T.ex. puppet.exempel.se. Sedan p\u00e5 klienten:</p> <p><code>echo\u00a0\"search\u00a0exempel.se\"\u00a0|\u00a0sudo\u00a0tee\u00a0-a\u00a0/etc/resolv.conf</code></p> <p>Om klienten anv\u00e4nder DHCP kan det h\u00e4nda att resolv.conf skrivs \u00f6ver. Testa</p> <p><code>ping\u00a0puppet</code></p> <p>Det m\u00e5ste ocks\u00e5 vara \u00f6ppet f\u00f6r klienterna mot mastern p\u00e5 TCP 8140</p>"},{"location":"linux_services/Puppet/#konfiguration","title":"Konfiguration","text":"Pre-2.6 Post-2.6 puppetmasterd puppet master puppetd puppet agent puppet puppet apply puppetca puppet cert ralsh puppet resource puppetrun puppet kick puppetqd puppet queue filebucket puppet filebucket puppetdoc puppet doc pi puppet describe"},{"location":"linux_services/Puppet/#master","title":"Master","text":"<p>Konfigurations av puppet g\u00f6rs under <code>/etc/puppet/</code></p> <p>B\u00f6rja med att skapa ett CA cert f\u00f6r din master server. Under <code>[main]</code> i <code>puppet.conf</code> l\u00e4gg till,</p> <p><code>dns_alt_names\u00a0=\u00a0puppet,puppet.dom\u00e4n.se</code></p> <p>Skapa sedan CA certet med kommandot,</p> <p><code>sudo\u00a0puppet\u00a0master\u00a0--verbose\u00a0--no-daemonize</code></p> <p>N\u00e4r det st\u00e5r <code>Notice: Starting Puppet master version</code> har certet skapats. Tryck ctrl-c f\u00f6r att stoppa."},{"location":"linux_services/Puppet/#hiera","title":"Hiera","text":"<p>\u00c4r ett enklare s\u00e4tt att konfigurera dina klienter p\u00e5. Hiera f\u00f6ljer med puppet och inget som ska beh\u00f6va installeras. N\u00e4r man konfar sina noder med hiera anv\u00e4nder man sig av yaml kod.</p> <p>Skapa filen <code>site.pp</code> i mappen <code>manifests</code> och skriv,</p> <p><code>hiera_include('classes')</code></p> <p>Skapa sedan filen <code>hiera.yaml</code> i rooten av puppet och fyll den med,</p> <pre><code> ---\n  :backends:\n    - yaml\n  :yaml:\n    :datadir: /etc/puppet/hieradata\n  :hierarchy:\n    - \"node/%{::fqdn}\"\n    - \"os/%{::osfamily}\"\n    - common\n  :logger:\n    - puppet\n</code></pre> <p>Skapa sedan en mapp som heter <code>hieradata</code> i rooten av puppet. I den mappen ska du skapa mapparna <code>node</code> och <code>os</code>. I mappen <code>os</code> kan du skapa en fil som heter tex <code>Ubuntu.yaml</code>. D\u00e5 kommer alla ubuntu maskiner f\u00e5 den confen som st\u00e5r d\u00e4r i. I mappen <code>hieradata</code> skapa en fil som heter <code>common.yaml</code>. Confen som st\u00e5r i denna filen kommer alla noder att f\u00e5. Exempel conf p\u00e5 <code>common.yaml</code> som kommer anv\u00e4nda modulen utils och installera paketet vim och autofs.</p> <pre><code> ---\n classes:\n   -utils\n\n utils::packages:\n   - vim\n   - autofs\n</code></pre>"},{"location":"linux_services/Puppet/#klient_1","title":"Klient","text":"<p>Puppet agenten funkar direkt utan inst\u00e4llningar om man inte har ett annat FQDN p\u00e5 puppet master(se under). En sak man ska v\u00e4lja \u00e4r om man vill k\u00f6ra puppet agent som ett cronjob eller som en service som h\u00e4mtar ny conf automatiskt.</p> <p>Har man ett annat FQDN p\u00e5 sin puppet master \u00e4n puppet.dom\u00e4n.se b\u00f6r man l\u00e4gga till under <code>[main]</code> i <code>/etc/puppet/puppet.conf</code></p> <p><code>server\u00a0=\u00a0FQDN</code></p>"},{"location":"linux_services/Puppet/#cron-job","title":"Cron job","text":"<p>F\u00f6r att k\u00f6ra puppet agent som ett cron job skriv f\u00f6ljande.</p> <p><code>sudo\u00a0puppet\u00a0resource\u00a0cron\u00a0puppet-agent\u00a0ensure=present\u00a0user=root\u00a0minute=30\u00a0command='/opt/puppet/bin/puppet\u00a0agent\u00a0--onetime\u00a0--no-daemonize\u00a0--splay\u00a0--splaylimit\u00a060'</code></p>"},{"location":"linux_services/Puppet/#service","title":"Service","text":"<p>I filen <code>/etc/default/puppet</code> \u00e4ndra till <code>START=yes</code>. F\u00f6r att starta puppet agenten och att den autostartar vid omstart.</p> <p><code>sudo\u00a0puppet\u00a0resource\u00a0service\u00a0puppet\u00a0ensure=running\u00a0enable=true</code></p> <p>Vill man \u00e4ndra intervalen p\u00e5 hur ofta agenten fr\u00e5gar mastern efter ny conf. Default \u00e4r 30 minuter, l\u00e4gg till f\u00f6ljande under <code>[agent]</code> i <code>puppet.conf</code>.</p> <p><code>runinterval\u00a0=\u00a02h</code></p>"},{"location":"linux_services/Puppet/#certifikat","title":"Certifikat","text":"<p>All kommunikation g\u00f6rs med SSL och certifikat anv\u00e4nds f\u00f6r autentisering. P\u00e5 klient:</p> <p><code>sudo\u00a0puppet\u00a0agent\u00a0--waitforcert\u00a0120\u00a0--test</code></p> <p>P\u00e5 master:</p> <p><code>sudo\u00a0puppet\u00a0cert\u00a0list</code> <code>sudo\u00a0puppet\u00a0cert\u00a0sign</code> <p>F\u00f6r att autosigna certifikat s\u00e5 l\u00e4gg till detta under <code>[master]</code> i <code>puppet.conf</code> p\u00e5 din puppet master.</p> <p><code>autosign\u00a0=\u00a0true</code></p> <p>Lista alla cert p\u00e5 puppet master:</p> <p><code>puppet\u00a0cert\u00a0list\u00a0-a</code></p> <p>Ta bort klient cert p\u00e5 puppet master:</p> <p><code>puppet\u00a0cert\u00a0clean</code>"},{"location":"linux_services/Puppet/#moduler","title":"Moduler","text":"<p>F\u00f6r att s\u00f6ka efter moduler till puppet anv\u00e4nd forge.</p> <p>Moduler installerar man p\u00e5 sin master och sedan anv\u00e4nder tex hiera f\u00f6r att konfigurera sina klienter.</p> <p>F\u00f6r att installera och ta bort moduler anv\u00e4nd kommandot,</p> <p><code>puppet\u00a0module\u00a0install</code> <code>puppet\u00a0module\u00a0uninstall</code> <p>Det \u00e4r viktigt att l\u00e4sa readme filen om varje modul f\u00f6r att f\u00f6rst\u00e5 hur den fungerar. Den finns under <code>/etc/puppet/modules/\"modulnamn\"/</code></p> <p>Varje g\u00e5ng du ska anv\u00e4nda en modul m\u00e5ste du kalla efter den tex under <code>classes:</code> i hiera.</p>"},{"location":"linux_services/Puppet/#autofs","title":"Autofs","text":"<p>Modul som styr upp autofs mounts p\u00e5 din server.</p> <p><code>puppet\u00a0module\u00a0install\u00a0EagleDelta2-autofs</code></p> <p>Exempel conf f\u00f6r hiera.</p> <pre><code> ---\n classes:\n  - autofs\n\n mapOptions:\n   backup:\n     mount: '/opt'\n     mapfile: '/etc/auto.backup'\n     mapcontents:\n       - 'backup -fstype=nfs,auto,rw,async,hard,intr 192.168.1.200:/mnt/zfs/Backup'\n     options: '--timeout=60'\n     order: 01\n   home:\n     mount: '/home'\n     mapfile: '/etc/auto.home'\n     mapcontents:\n       - '* -fstype=nfs,user,auto,rw,async,hard,intr 192.168.1.200:/mnt/zfs/Home/&amp;'\n     options: '--timeout=120'\n     order: 02\n</code></pre> <p>Finns mer info att l\u00e4sa om modulen p\u00e5 forge.</p>"},{"location":"linux_services/Puppet/#utils","title":"Utils","text":"<p>Utils \u00e4r en modul som installerar paket p\u00e5 en node. Den har st\u00f6d f\u00f6r f\u00f6ljande operativsystem. RedHat, Windows, Ubuntu, Debian, Solaris, SLES, Scientific, CentOS, OracleLinux, AIX, SLED</p> <p><code>puppet\u00a0module\u00a0install\u00a0ghoneycutt-utils</code></p> <p>Exempel conf f\u00f6r hiera.</p> <pre><code> ---\n classes:\n  - utils\n\n utils::packages:\n  - vim\n  - fail2ban\n  - apache2\n</code></pre> <p>Mer om modulen finns p\u00e5 forge.</p>"},{"location":"linux_services/Puppet/#rsyslog","title":"Rsyslog","text":"<p><code>puppet\u00a0module\u00a0install\u00a0saz-rsyslog</code></p> <p>Exempel conf f\u00f6r hiera.</p> <pre><code> ---\n classes:\n  - rsyslog::client\n\n rsyslog::client::server: '192.168.1.205'\n</code></pre> <p>Mer om modulen finns p\u00e5 forge.</p>"},{"location":"linux_services/Python/","title":"Python","text":"<p>Python \u00e4r ett objektorienterat programspr\u00e5k som siktar p\u00e5 att vara funktionellt och l\u00e4ttl\u00e4st.</p>"},{"location":"linux_services/Python/#installation","title":"Installation","text":"<p>Python f\u00f6ljer med de flesta linux-distar.</p> <p><code>python\u00a0-V</code></p> <p>Pydoc L\u00e4sa hj\u00e4lpfiler om moduler, klasser och funktioner.</p> <p><code>pydoc</code> <code>pydoc\u00a0open</code> <code>pydoc\u00a0file</code> <code>pydoc\u00a0os</code> <p>Manuellt ta reda p\u00e5 m\u00f6jliga funktioner/methods i ett library.</p> <p><code>dir()</code> <code>dir(</code><code>library</code><code>)</code></p>"},{"location":"linux_services/Python/#virtualenv","title":"Virtualenv","text":"<p>Virtualenv \u00e4r ett verktyg f\u00f6r att skapa isolerade Python environments. Det skapar ett directory som inneh\u00e5ller alla n\u00f6dv\u00e4ndiga executables f\u00f6r att k\u00f6ra Python-projektet. Man kan sedan installera python-paket oberoende av \u00f6vriga system. Virtualenvwrapper tillhandah\u00e5ller ett g\u00e4ng verktyg f\u00f6r att enklare jobba med virtualenv.</p> <p>Setup</p> <p><code>sudo\u00a0pip\u00a0install\u00a0virtualenvwrapper</code> <code>echo\u00a0'.\u00a0/usr/local/bin/virtualenvwrapper.sh'\u00a0&gt;&gt;\u00a0.bashrc\u00a0&amp;&amp;\u00a0source\u00a0.bashrc</code></p> <p>Jobba med virtualenv</p> <p><code>mkvirtualenv\u00a0test</code> <code>deactivate</code> <code>lsvirtualenv</code> <code>workon\u00a0test</code></p>"},{"location":"linux_services/Python/#pip","title":"PIP","text":"<p>PIP \u00e4r ett package management system som anv\u00e4nds f\u00f6r att installera software packages skrivna i Python.</p> <p><code>sudo\u00a0pip\u00a0install</code> <p>Eller f\u00f6r att installera ett pip paket i din egen home folder kan du skriva</p> <p><code>pip\u00a0install</code><code>--user</code> <p>Exempel HTTP Server Det finns flera olika webbservrar skrivna i python.</p> <p><code>sudo\u00a0pip\u00a0install\u00a0lpthw.web</code> <code>import\u00a0web</code></p>"},{"location":"linux_services/Python/#referenslista","title":"Referenslista","text":"<p>H\u00e4r f\u00f6ljer en lista p\u00e5 hur man g\u00f6r diverse vanliga saker f\u00f6r den ovane. Detta utg\u00e5r fr\u00e5n python 2.7.</p> <p>Variabel</p> <p><code>nummer\u00a0=\u00a0102</code></p> <p>Output, print fr\u00e5n variabel</p> <p><code>print\u00a0\"The\u00a0name\u00a0is\u00a0%s\u00a0and\u00a0%d.\"\u00a0%\u00a0(namn,\u00a0nummer)</code></p> <p>Input</p> <p><code>x\u00a0=\u00a0raw_input(\"&gt;&gt;\u00a0\")</code> <code>x\u00a0=\u00a0int(raw_input(\"&gt;&gt;\u00a0\"))</code></p> <p>L\u00e4sa fil</p> <p><code>filnamn\u00a0=\u00a0raw_input(\"&gt;&gt;\u00a0\")</code> <code>fil\u00a0=\u00a0open(filnamn)</code> <code>print\u00a0fil.read()</code></p> <p>Skriva till fil</p> <p><code>fil\u00a0=\u00a0open(filename,\u00a0'w')</code> <code>line1\u00a0=\u00a0raw_input(\"line\u00a01:\u00a0\")</code> <code>fil.write(line1)</code> <code>fil.close()</code></p> <p>Definiera funktion och kalla p\u00e5 den.</p> <p><code>def\u00a0funk1():</code> <code>print\u00a0\"Detta\u00a0ar\u00a0en\u00a0funktion\"</code></p> <p><code>funk1()</code></p> <p>Return value</p> <p><code>def\u00a0funk1(x):</code> <code>return\u00a0x\u00a0+\u00a04</code></p> <p><code>value\u00a0=\u00a0funk1(20)</code></p> <p>Avsluta, ctrl + d</p> <p><code>exit(0)\u00a0#\u00a0i\u00a0script</code> <code>quit()\u00a0#\u00a0i\u00a0cli</code></p> <p>If_then_else</p> <p><code>print\u00a0\"Valj\u00a01\u00a0eller\u00a02\"</code> <code>valet\u00a0=\u00a0raw_input(\"&gt;&gt;\u00a0\")</code></p> <p><code>if\u00a0valet\u00a0==\u00a0\"1\":</code> <code>print\u00a0\"You\u00a0is\u00a01\"</code> <code>elif\u00a0valet\u00a0==\u00a0\"2\":</code> <code>print\u00a0\"You\u00a0is\u00a02\"</code> <code>else:</code> <code>print\u00a0\"You\u00a0die\"</code></p> <p>For-loop</p> <p><code>the_count\u00a0=\u00a0[1,\u00a02,\u00a03,\u00a04,\u00a05]</code> <code>for\u00a0number\u00a0in\u00a0the_count:</code> <code>print\u00a0\"This\u00a0is\u00a0%d\"\u00a0%\u00a0number</code></p> <p>Lista</p> <p><code>lista\u00a0=\u00a0[1,\u00a02,\u00a03,\u00a04,\u00a05,\u00a06,\u00a0\"hest\"\u00a0];</code> <code>print\u00a0lista[0:2]</code> <code>lista[2]\u00a0=\u00a020;</code></p> <p>Append</p> <p>Dictionary</p> <p><code>dict\u00a0=\u00a0{'Name':\u00a0'Sara',\u00a0'Age':\u00a020,\u00a0'Class':\u00a0'No'};</code> <code>print\u00a0dict['Name']</code> <code>dict['Age']\u00a0=\u00a021;</code></p> <p>Add new entry</p> <p><code>dict['School']\u00a0=\u00a0\"Yes\";</code></p> <p>Password Get password, hidden</p> <p><code>import\u00a0getpass</code> <code>secretx\u00a0=\u00a0getpass.getpass(\"Enter\u00a0password:\")</code></p> <p>Grundl\u00e4ggande sanitetscheckar</p> <p><code>pip\u00a0install\u00a0pep8\u00a0pylint\u00a0pyflakes</code></p> <p><code>pep8\u00a0the_script.py</code> <code>pylint\u00a0the_script.py</code> <code>pyflakes\u00a0the_script.py</code></p>"},{"location":"linux_services/Python/#netaddr","title":"netaddr","text":"<p>netaddr \u00e4r ett network address manipulation library. Man kan jobba med IP-adresser och n\u00e4t.</p> <p><code>sudo\u00a0pip\u00a0install\u00a0netaddr</code></p> <p>Usage</p> <p><code>from\u00a0netaddr\u00a0import\u00a0*</code> <code>cidr\u00a0=\u00a0IPNetwork(raw_input(\"CIDR-notation:\u00a0\"))</code> <code>firstip\u00a0=\u00a0cidr[1]</code> <code>netmask\u00a0=\u00a0cidr.netmask</code></p>"},{"location":"linux_services/Python/#oop","title":"OOP","text":"<p>Python \u00e4r ett Object Oriented Programming Language vilket inneb\u00e4r att man har st\u00f6d f\u00f6r att bygga objekt. Python \u00e4r designat s\u00e5 att allting \u00e4r ett objekt vilket t.ex. inneb\u00e4r att datatypen \"string\" i python ocks\u00e5 \u00e4r ett objekt. Exempel p\u00e5 hur man skapar en class och instansierar ett objekt.</p> <p><code>class\u00a0VLAN:</code> <code>def\u00a0__init__(self,\u00a0id,\u00a0name):</code> <code>self.id\u00a0=\u00a0id</code> <code>self.name\u00a0=\u00a0name</code></p> <p><code>vlan10\u00a0=\u00a0VLAN(10,\u00a0\"Test\")</code></p>"},{"location":"linux_services/Python/#http-server","title":"HTTP server","text":"<p>Om man beh\u00f6ver s\u00e4tta upp en http server snabbt o enkelt kan man g\u00f6ra det med Python.</p> <p>B\u00f6rja med att g\u00e5 till det directory du vill dela ut.</p> <p><code>cd\u00a0/home/sparco/secret-hackernet-stuff</code></p> <p>K\u00f6r sedan f\u00f6ljande kommando f\u00f6r att starta en python webserver som lyssnar p\u00e5 port 8000 p\u00e5 alla interface:</p> <p>Python 2.7</p> <p><code>python\u00a0-m\u00a0SimpleHTTPServer</code></p> <p>Python 3.X</p> <p><code>python\u00a0-m\u00a0http.server</code></p> <p>Category:Guider</p>"},{"location":"linux_services/Quota/","title":"Quota","text":"<p>Quotas kan anv\u00e4ndas s\u00e5 att anv\u00e4ndare eller en viss grupp bara f\u00e5r lagra en viss m\u00e4ngd p\u00e5 ett filsystem.</p>"},{"location":"linux_services/Quota/#installation","title":"Installation","text":"<p><code>apt-get\u00a0install\u00a0quota</code></p>"},{"location":"linux_services/Quota/#konfiguration","title":"Konfiguration","text":"<p>B\u00f6rja med att \u00e4ndra i <code>fstab</code> och l\u00e4gg till usrquota eller/och grpquota p\u00e5 det filsystemet du vill anv\u00e4nda det p\u00e5.</p> <p><code>#\u00a0/home\u00a0was\u00a0on\u00a0/dev/sda6\u00a0during\u00a0installation</code> <code>UUID=9ca5cef9-f734-4396-9f29-ddaeedc21e28\u00a0/home\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ext4\u00a0\u00a0\u00a0\u00a0defaults,</code><code>usrquota</code><code>0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a02</code></p> <p>Mounta om filsystemet.</p> <p><code>mount\u00a0-o\u00a0remount\u00a0/home</code></p> <p>Skapa en quota index fil. I filen sparas anv\u00e4ndarens/gruppens limit och hur mycket utrymme som anv\u00e4nds.</p> <p><code>quotacheck\u00a0-cum\u00a0/home</code></p> <p>Sl\u00e5 av och p\u00e5 quotas med f\u00f6ljande kommandon.</p> <p><code>quotaon\u00a0/home</code> <code>quotaoff\u00a0/home</code></p> <p>F\u00f6r att s\u00e4tta en quota p\u00e5 en anv\u00e4ndare med max limit p\u00e5 1Gb skriv och \u00e4ndra: Byte converter</p> <p><code>edquota\u00a0user1</code></p> <p><code>Disk\u00a0quotas\u00a0for\u00a0user\u00a0user1\u00a0(uid\u00a01001):</code> <code>Filesystem\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0blocks\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0soft\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0hard\u00a0\u00a0\u00a0\u00a0\u00a0inodes\u00a0\u00a0\u00a0\u00a0\u00a0soft\u00a0\u00a0\u00a0\u00a0\u00a0hard</code> <code>/dev/disk/by-label/DOROOT\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a08</code><code>1000000</code><code></code><code>1048576</code><code>2\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a00\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a00</code></p> Filesystem Visar vilket filsystem som har quota aktiverat blocks Visar hur m\u00e5nga block som anv\u00e4nds just nu. soft block Anger hur m\u00e5nga block som f\u00e5r lagras innan grace perioden b\u00f6rjar r\u00e4kna ner. hard block Anger max antal block som en anv\u00e4ndare f\u00e5r lagra. inodes Visar hur m\u00e5nga inodes som finns just nu. soft inode Samma som soft block fast f\u00f6r inode. hard inode Samma som hard block fast f\u00f6r inode. <p>Blocks anger hur mycket utrymme man f\u00e5r medans inodes anger hur m\u00e5nga filer och mappar man kan anv\u00e4nda.</p> <p>Hard block \u00e4r det absoluta max en anv\u00e4ndare eller grupp kan anv\u00e4nda n\u00e5r man detta f\u00e5r man inget mer utrymme.</p> <p>Soft block s\u00e4tter en max gr\u00e4ns f\u00f6r hur mycket utrymme man har. Men man kan lagra mer \u00e4n vad soft anger under en tidsperiod som kallas grace period.</p> <p>Kolla quotan p\u00e5 en anv\u00e4ndare/grupp.</p> <p><code>quota\u00a0user1</code></p> <p>Skapa en rapport som visar varje anv\u00e4ndare/grupp quota inst\u00e4llningar.</p> <p><code>repquota\u00a0-a</code></p>"},{"location":"linux_services/Quota/#grace-period","title":"Grace Period","text":"<p>Grace period s\u00e4tter hur l\u00e4nge en anv\u00e4ndare f\u00e5r \u00f6verstiga sin soft limit. Denna inst\u00e4llningen \u00e4r system wide och g\u00e4ller f\u00f6r alla grupper och anv\u00e4ndare.</p> <p><code>edquota\u00a0-t</code></p>"},{"location":"linux_services/Quota/#tipsntrix","title":"Tips'N'Trix","text":"<p>Prova din quota genom att skapa en 1Gb fil.</p> <p><code>dd\u00a0if=/dev/zero\u00a0of=/home/$USER/DDfile\u00a0bs=1M\u00a0count=1024\u00a0oflag=direct</code></p> <p>Category:Guider</p>"},{"location":"linux_services/Rancid/","title":"Rancid","text":"<p>Really Awesome New Cisco confIg Differ \u00e4r ett verktyg f\u00f6r versionshantering av konfigurationsfiler p\u00e5 n\u00e4tverksutrustning. Programvaran tillhandah\u00e5lls av Shrubbery Networks.</p> <p>Rancid kan anv\u00e4ndas f\u00f6r f\u00f6ljande:</p> <ul> <li>Backup och lagring av konfigurationsfiler</li> <li>J\u00e4mf\u00f6relse av konfiguration</li> <li>Versionsarkivering av konfiguration</li> </ul> <p>Rancid kan hj\u00e4lpa till i arbetet med f\u00f6ljande fr\u00e5gor:</p> <ul> <li>Hur vet du n\u00e4r en f\u00f6r\u00e4ndring sker?</li> <li>Vad g\u00f6r du n\u00e4r en f\u00f6r\u00e4ndring sker?</li> <li>Kan du korrelera n\u00e4tverksh\u00e4ndelser med \u00e4ndringar?</li> <li>Uppr\u00e4tth\u00e5ller du en \"basline\" eller s\u00e4tter en     konfigurationsstandard?</li> </ul>"},{"location":"linux_services/Rancid/#installation","title":"Installation","text":"<p><code>sudo\u00a0apt-get\u00a0-y\u00a0install\u00a0rancid\u00a0subversion\u00a0postfix</code></p> <p>Rancid-anv\u00e4ndare skapas under installationen.</p> <p><code>apt-cache\u00a0show\u00a0rancid\u00a0|\u00a0grep\u00a0Version</code></p>"},{"location":"linux_services/Rancid/#konfiguration","title":"Konfiguration","text":"<p>Filer</p> <ul> <li>/etc/rancid/ #Config file</li> <li>/var/lib/rancid/ #Most other files</li> <li>/var/lib/rancid/[gruppnamn]/router.db #Devices list</li> </ul> <p>Byt fr\u00e5n cvs till subversion samt skapa grupper f\u00f6r dina enheter. Det g\u00e5r \u00e4ven anv\u00e4nda Git.</p> <p><code>sudo\u00a0sed\u00a0-i.bak\u00a0's/RCSSYS=cvs;\u00a0export\u00a0RCSSYS/RCSSYS=svn;\u00a0export\u00a0RCSSYS/g'\u00a0/etc/rancid/rancid.conf</code> <code>sudo\u00a0sed\u00a0-i\u00a0's#CVSROOT=$BASEDIR/CVS;\u00a0export\u00a0CVSROOT#CVSROOT=$BASEDIR/svn;\u00a0export\u00a0CVSROOT#g'\u00a0/etc/rancid/rancid.conf</code> <code>echo\u00a0'LIST_OF_GROUPS=\"routers\u00a0switches\u00a0fws\"'\u00a0|\u00a0sudo\u00a0tee\u00a0-a\u00a0/etc/rancid/rancid.conf</code></p> <p>Slipp att det r\u00e4knas som en \u00e4ndring varje g\u00e5ng en loggfil \u00e4ndrar storlek. Modifiera /var/lib/rancid/bin/rancid (kan beh\u00f6vas kommenteras ut fler beroende p\u00e5 enhet, man f\u00e5r testa sig fram)</p> <p><code>#{\u2018dir\u00a0/all\u00a0bootflash:\u2019\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0=&gt;\u00a0\u2018DirSlotN\u2019},</code> <code>#{'dir\u00a0/all\u00a0disk0:'\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0=&gt;\u00a0'DirSlotN'},</code></p> <p>Don't strip passwords from backed up configurations</p> <p><code>sudo\u00a0sed\u00a0-i\u00a0's/FILTER_PWDS=YES/FILTER_PWDS=NO/g'\u00a0/etc/rancid/rancid.conf</code></p> <p>Fixa r\u00e4ttigheter f\u00f6r rancid user</p> <p><code>sudo\u00a0chown\u00a0-R\u00a0rancid:rancid\u00a0/var/lib/rancid</code> <code>sudo\u00a0su\u00a0-s\u00a0/bin/bash\u00a0rancid</code></p> <p>User rancid</p> <p><code>cd\u00a0&amp;&amp;\u00a0nano\u00a0.cloginrc</code> <code>#add\u00a0autoenable\u00a0*\u00a00\u00a0(tex\u00a0Cisco\u00a0ASA\u00a0kr\u00e4ver\u00a0manuell\u00a0enable)</code> <code>add\u00a0cyphertype\u00a0*\u00a0aes256-ctr,aes256-ctr,aes128-cbc,aes256-cbc</code> <code>add\u00a0method\u00a0*\u00a0ssh</code> <code>add\u00a0user\u00a0*\u00a0cisco</code> <code>add\u00a0password\u00a0*\u00a0{cisco}\u00a0{cisco}</code></p> <p><code>chmod\u00a0600\u00a0.cloginrc</code></p> <p>Testa inlogg</p> <p><code>/var/lib/rancid/bin/clogin\u00a0172.20.0.100</code></p>"},{"location":"linux_services/Rancid/#svn","title":"SVN","text":"<p>Lagra i SVN repo. G\u00e5r \u00e4ven att k\u00f6ra med cvs. K\u00f6r som user rancid.</p> <p><code>/var/lib/rancid/bin/rancid-cvs</code></p> <p>Lista filer i SVN:</p> <p><code>svn\u00a0ls</code><code>file:///var/lib/rancid/svn/</code></p> <p>Add devices nano /var/lib/rancid/switches/router.db</p> <p><code>192.168.0.100:cisco:up</code> <code>sw01.local:cisco:up</code> <code>10.0.0.10:hp:up</code></p> <p>Removal F\u00f6r devices raderas entryt ur router.db. F\u00f6r grupper g\u00f6rs det genom SVN (raderar alla configs under gruppen ocks\u00e5!):</p> <p><code>svn\u00a0rm</code><code>file:///var/lib/rancid/svn/switches</code><code>--message\u00a0\"Not\u00a0in\u00a0use\"</code></p> <p>K\u00f6r ig\u00e5ng</p> <p><code>/usr/lib/rancid/bin/rancid-run</code></p>"},{"location":"linux_services/Rancid/#schemalaggning","title":"Schemal\u00e4ggning","text":"<p><code>su\u00a0-\u00a0rancid</code> <code>crontab\u00a0-e</code> <code>0\u00a0*\u00a0*\u00a0*\u00a0*\u00a0/usr/lib/rancid/bin/rancid-run</code> <code>0\u00a01\u00a0*\u00a0*\u00a0*\u00a0find\u00a0/opt/rancid/var/logs\u00a0-type\u00a0f\u00a0-mtime\u00a0+30\u00a0-exec\u00a0rm\u00a0{}\u00a0\\;\u00a0#\u00a0Slang\u00a0gamla\u00a0loggar</code></p>"},{"location":"linux_services/Rancid/#web-gui","title":"Web GUI","text":"<p>CVSWeb Endast om man valde cvs.</p> <p><code>sudo\u00a0apt-get\u00a0-y\u00a0install\u00a0cvsweb</code></p>"},{"location":"linux_services/Rancid/#websvn","title":"WebSVN","text":"<p><code>sudo\u00a0apt-get\u00a0-y\u00a0install\u00a0websvn</code></p> <p>path: /var/lib/rancid/svn repo: /var/lib/rancid/svn</p> <p><code>sudo\u00a0ln\u00a0-s\u00a0/etc/websvn/apache.conf\u00a0/etc/apache2/conf-available/websvn.conf</code> <code>sudo\u00a0a2enconf\u00a0websvn.conf</code> <code>sudo\u00a0service\u00a0apache2\u00a0reload</code> <code>sudo\u00a0chgrp\u00a0-R\u00a0www-data\u00a0/var/lib/rancid/svn</code> <code>sudo\u00a0chmod\u00a0g+w\u00a0-R\u00a0/var/lib/rancid/svn</code></p> <p>http://172.20.0.10/websvn</p> <p>Auth HTTP authentication f\u00f6r /websvn</p> <p><code>sudo\u00a0apt-get\u00a0-y\u00a0install\u00a0apache2-utils</code> <code>sudo\u00a0htpasswd\u00a0-c\u00a0/opt/websvnpassword\u00a0admin</code></p> <p><code>sudo\u00a0nano\u00a0/etc/websvn/apache.conf</code> <code>AuthType\u00a0Basic</code> <code>AuthName\u00a0\"Restricted\u00a0Access\"</code> <code>AuthBasicProvider\u00a0file</code> <code>AuthUserFile\u00a0/opt/websvnpassword</code> <code>Require\u00a0user\u00a0admin</code></p> <p><code>sudo\u00a0service\u00a0apache2\u00a0reload</code></p> <p>Others \"ln: failed to create symbolic link \u2018/etc/apache2/conf.d/websvn\u2019: No such file or directory\" workaround:</p> <p><code>sudo\u00a0mkdir\u00a0/etc/apache2/conf.d</code></p>"},{"location":"linux_services/Rancid/#mailnotifiering","title":"Mailnotifiering","text":"<p>Postfix</p> <p><code>sudo\u00a0nano\u00a0/etc/aliases</code> <code>rancid-routers:\u00a0\u00a0\u00a0\u00a0\u00a0sysadm</code> <code>rancid-admin-routers:\u00a0\u00a0\u00a0sysadm</code> <code>sudo\u00a0newaliases</code></p>"},{"location":"linux_services/Rancid/#slacknotifiering","title":"Slacknotifiering","text":"<p>Eftersom Slack har incoming webhook integration kan man skicka resultatet fr\u00e5n backupk\u00f6rning till en slackkanal.</p> <pre><code>#!/bin/sh\n\n# This script is used to send a status report for the rancid backups to Slack channel.\n# It is supposed to be executed by the cron service for the rancid user after rancid-run has completed.\n\n# Finding errors in the latest log files.\nfor dir in $(find /var/log/rancid -mmin -60 -type f -print)\ndo\n    if [ ! -z \"$(cat $dir | egrep -w 'clogin|error')\" ]; then\n        FAILEDDEVICES=\"$FAILEDDEVICES$(cat $dir | egrep -w 'clogin|error' | uniq)  -----  \"\n    fi\ndone\n\n# Used for getting the log file error entries into a json format.\nERRORMESSAGE='{\"text\": \"Rancid report: There seems to be some issues :(\", \"attachments\":[{\"text\": \"'$FAILEDDEVICES'\"}]}'\n\n# Send error messages to slack\n[ ! -z \"$FAILEDDEVICES\" ] &amp;&amp; curl -X POST --data-binary \"${ERRORMESSAGE}\" -H \"Content-Type: application/json\" https://hooks.slack.com/services/XXX/XXX/XXXXX\n\n# If no errors was found a static message is posted to the channel\n[ -z \"$FAILEDDEVICES\" ] &amp;&amp; curl -X POST --data '{\"text\":\"Rancid report: No failed backups last rancid run :)\"}' -H \"Content-Type: application/json\" https://hooks.slack.com/services/XXX/XXX/XXXXX\n</code></pre> <p>Category:Guider</p>"},{"location":"linux_services/Rar2fs/","title":"Rar2fs","text":"<p>\u00c4r ett FUSE fil system som l\u00e5ter dig l\u00e4sa rar arkiv som om det vore vanliga filer.</p>"},{"location":"linux_services/Rar2fs/#forberedelser","title":"F\u00f6rberedelser","text":"<p><code>apt-get\u00a0install\u00a0libfuse-dev\u00a0autoconf</code></p> <p>Installera senaste unrarlib. I skrivande stund \u00e4r 5.3.2 senaste.</p> <p><code>wget</code><code>ftp://ftp.rarlab.com/rar/unrarsrc-5.3.2.tar.gz</code><code>&amp;&amp;\u00a0tar\u00a0-xvf\u00a0unrarsrc-5.3.2.tar.gz</code> <code>cd\u00a0unrar\u00a0&amp;&amp;\u00a0make\u00a0lib\u00a0-f\u00a0makefile\u00a0&amp;&amp;\u00a0cp\u00a0libunrar.so\u00a0/usr/lib</code></p>"},{"location":"linux_services/Rar2fs/#installation","title":"Installation","text":"<p><code>git\u00a0clone</code><code>https://github.com/hasse69/rar2fs</code> <code>cd\u00a0rar2fs\u00a0&amp;&amp;\u00a0autoreconf\u00a0-f\u00a0-i</code> <code>./configure\u00a0--with-unrar=../unrar</code> <code>make\u00a0&amp;&amp;\u00a0make\u00a0install</code></p>"},{"location":"linux_services/Rar2fs/#kommandon","title":"Kommandon","text":"<p>F\u00f6r en lista med kommandon.</p> <p><code>rar2fs\u00a0-h</code></p> <p>Mounta</p> <p><code>rar2fs\u00a0-o\u00a0allow_other\u00a0/path/to/rararchives\u00a0/path/to/mount/point</code></p> <p>Unmounta</p> <p><code>fusermount\u00a0-u\u00a0/path/to/mount/point</code></p>"},{"location":"linux_services/Rar2fs/#automount","title":"Automount","text":"<p>F\u00f6r att kunna automounta kr\u00e4vs det att fuse \u00e4r installerat:</p> <p>Debian/Ubuntu</p> <p><code>apt-get\u00a0install\u00a0fuse</code></p> <p>RHEL/CentOS</p> <p><code>yum\u00a0install\u00a0fuse</code></p> <p>L\u00e4gg till f\u00f6ljande i <code>/etc/fstab</code></p> <p><code>rar2fs#/path/till/rar/\u00a0/vart/du/vill/mounta/\u00a0fuse\u00a0allow_other,--seek-length=1\u00a0\u00a0\u00a0\u00a00\u00a00</code></p> <p>Category:Guider</p>"},{"location":"linux_services/RatticDB/","title":"RatticDB","text":"<p>RatticDB \u00e4r en open-source password management databas gjord f\u00f6r att flera ska kunna l\u00e4sa och skriva samtidigt. Man hostar den sj\u00e4lv och n\u00e5r den via en hemsida.</p>"},{"location":"linux_services/RatticDB/#forberedelse","title":"F\u00f6rberedelse","text":"<p>Om man vill och det \u00e4r rekomenderat \u00e4r f\u00f6ljande,</p> <ul> <li>Att man anv\u00e4nder HTTPS f\u00f6r att logga in p\u00e5 Rattic.</li> <li>Filsystemet d\u00e4r din databas lagras b\u00f6r vara krypterat.</li> <li>Access loggarna b\u00f6r vara skyddade.</li> <li>Program som OSSEC \u00e4r bra att anv\u00e4nda.</li> </ul> <p>En fungerande LAMP och en databas skapad \u00e5t rattic samt f\u00f6ljande paket.</p> <ul> <li>python</li> <li>pip</li> <li>GCC</li> <li>mysql-devel</li> <li>openssl-devel</li> <li>openldap-devel</li> <li>python-devel</li> <li>libxml2-devel</li> <li>libxslt-devel</li> <li>gettext</li> </ul>"},{"location":"linux_services/RatticDB/#installation","title":"Installation","text":"<p>Det \u00e4r rekomenderat att installera under <code>/opt/apps</code>.</p> <p><code>mkdir\u00a0/opt/apps\u00a0&amp;&amp;\u00a0cd\u00a0/opt/apps</code> <code>git\u00a0clone</code><code>https://github.com/tildaslash/RatticWeb</code> <code>cd\u00a0RatticWeb</code> <code>pip\u00a0install\u00a0-r\u00a0requirements-mysql.txt</code> <code>mkdir\u00a0static</code> <code>cd\u00a0conf\u00a0&amp;&amp;\u00a0cp\u00a0defaults.cfg\u00a0local.cfg</code></p> <p>\u00c4ndra f\u00f6ljande rader,</p> <p><code>[ratticweb]</code> <code>debug\u00a0=\u00a0False</code> <code>secretkey\u00a0=\u00a0[enter\u00a0a\u00a0string\u00a0of\u00a0random\u00a0secret\u00a0data]</code> <code>hostname\u00a0=\u00a0rattic</code></p> <p><code>[filepaths]</code> <code>static\u00a0=\u00a0/opt/apps/RatticWeb/static</code></p> <p><code>[database]</code> <code>engine\u00a0=\u00a0django.db.backends.mysql</code> <code>name\u00a0=\u00a0rattic</code> <code>user\u00a0=\u00a0root</code> <code>password\u00a0=</code> <code>host\u00a0=</code> <code>port\u00a0=</code></p> <p>Skapa sedan tabeller i databasen och fyll static mappen.</p> <p><code>cd\u00a0/opt/apps/RatticWeb/</code> <code>./manage.py\u00a0syncdb\u00a0--noinput</code> <code>./manage.py\u00a0migrate\u00a0--all</code> <code>./manage.py\u00a0collectstatic\u00a0-c\u00a0--noinput</code> <code>./manage.py\u00a0demosetup</code></p> <p>Logga in med anv\u00e4ndaren <code>admin</code> med password <code>rattic</code>.</p>"},{"location":"linux_services/RatticDB/#nginx-konfiguration","title":"Nginx konfiguration","text":"<p>B\u00f6rja med att installera supervisord och gunicorn.</p> <p><code>pip\u00a0install\u00a0gunicorn</code> <code>easy_install\u00a0supervisor</code> <code>wget</code><code>https://gist.githubusercontent.com/howthebodyworks/176149/raw/88d0d68c4af22a7474ad1d011659ea2d27e35b8d/supervisord.sh</code><code>-O\u00a0/etc/init.d/supervisord</code> <code>update-rc.d\u00a0supervisord\u00a0defaults</code> <code>mkdir\u00a0/opt/apps/log</code></p> <p>L\u00e4gg till f\u00f6ljande rader l\u00e4ngst ner i <code>/etc/superviseord.conf</code>.</p> <p><code>[program:RatticDB]</code> <code>command\u00a0=\u00a0/opt/apps/gunicorn_start.sh</code> <code>user\u00a0=\u00a0rattic</code> <code>stdout_logfile\u00a0=\u00a0/opt/apps/log/gunicorn_supervisor.log</code> <code>redirect_stderr\u00a0=\u00a0true</code></p> <p>Skapa en fil som heter <code>gunicorn_start.sh</code> under /opt/apps och l\u00e4gg in f\u00f6ljande.</p> <p><code>#!/bin/bash</code> <code></code> <code>NAME=\"RatticDB\"\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0#\u00a0Name\u00a0of\u00a0the\u00a0application</code> <code>DJANGODIR=/opt/apps/RatticWeb/\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0#\u00a0ratticdb\u00a0project\u00a0directory</code> <code>USER=rattic\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0#\u00a0the\u00a0user\u00a0to\u00a0run\u00a0as</code> <code>GROUP=rattic\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0#\u00a0the\u00a0group\u00a0to\u00a0run\u00a0as</code> <code>NUM_WORKERS=3\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0#\u00a0how\u00a0many\u00a0worker\u00a0processes\u00a0should\u00a0Gunicorn\u00a0spawn\u00a0(2xcores+1)</code> <code>DJANGO_SETTINGS_MODULE=ratticweb.settings\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0#\u00a0which\u00a0settings\u00a0file\u00a0should\u00a0Django\u00a0use</code> <code>DJANGO_WSGI_MODULE=ratticweb.wsgi\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0#\u00a0WSGI\u00a0module\u00a0name</code> <code></code> <code>echo\u00a0\"Starting\u00a0$NAME\u00a0as\u00a0`whoami`\"</code> <code></code> <code>#\u00a0Activate\u00a0the\u00a0virtual\u00a0environment</code> <code>cd\u00a0$DJANGODIR</code> <code>export\u00a0DJANGO_SETTINGS_MODULE=$DJANGO_SETTINGS_MODULE</code> <code>export\u00a0PYTHONPATH=$DJANGODIR:$PYTHONPATH</code> <code></code> <code>#\u00a0Start\u00a0your\u00a0Django\u00a0Unicorn</code> <code>#\u00a0Programs\u00a0meant\u00a0to\u00a0be\u00a0run\u00a0under\u00a0supervisor\u00a0should\u00a0not\u00a0daemonize\u00a0themselves\u00a0(do\u00a0not\u00a0use\u00a0--daemon)</code> <code>exec\u00a0/usr/bin/gunicorn\u00a0${DJANGO_WSGI_MODULE}:application\u00a0\\</code> <code>--name\u00a0$NAME\u00a0\\</code> <code>--workers\u00a0$NUM_WORKERS\u00a0\\</code> <code>--user=$USER\u00a0--group=$GROUP\u00a0\\</code> <code>--log-level=debug\u00a0\\</code> <code>--bind=127.0.0.1:8000</code></p> <p>Nginx conf fil.</p> <p><code>server\u00a0{</code> <code>listen\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0443\u00a0ssl;</code> <code>server_name\u00a0\u00a0rattic.hackernet.se;</code> <code></code> <code>client_max_body_size\u00a04G;</code></p> <p><code>location\u00a0/static/\u00a0{</code> <code>alias\u00a0/opt/apps/RatticWeb/static/;</code> <code>}</code></p> <p><code>location\u00a0/media/\u00a0{</code> <code>alias\u00a0\u00a0\u00a0/opt/apps/RatticWeb/media/;</code> <code>}</code></p> <p><code>add_header\u00a0Strict-Transport-Security\u00a0max-age=15768000;</code> <code>add_header\u00a0X-Frame-Options\u00a0DENY;</code> <code>add_header\u00a0X-Content-Type-Options\u00a0nosniff;</code> <code>ssl_certificate\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0/etc/nginx/cert.crt;</code> <code>ssl_certificate_key\u00a0\u00a0\u00a0\u00a0\u00a0/etc/nginx/cert/cert.pem;</code> <code>ssl_protocols\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0TLSv1\u00a0TLSv1.1\u00a0TLSv1.2;</code> <code>ssl_ciphers\u00a0'ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:!aNULL:!eNULL:!EXPORT:!CAMELLIA:!DES:!MD5:!PSK:!DSS:!RC4';</code> <code>ssl_prefer_server_ciphers\u00a0on;</code> <code>ssl_dhparam\u00a0/etc/nginx/cert/dhparam.pem;</code> <code>ssl_session_cache\u00a0shared:SSL:1m;</code> <code>ssl_session_timeout\u00a0\u00a05m;</code></p> <p><code>location\u00a0/\u00a0{</code> <code>proxy_pass</code><code>http://127.0.0.1:8000</code><code>;</code> <code>}</code> <code>}</code> <code>server\u00a0{</code> <code>listen\u00a0\u00a0\u00a0\u00a0\u00a0\u00a080;</code> <code>server_name\u00a0rattic.hackernet.se;</code> <code></code> <code>#\u00a0301\u00a0=\u00a0permanent\u00a0redirect,\u00a0302\u00a0=\u00a0temporary\u00a0redirect</code> <code>return\u00a0301</code><code>https://rattic.hackernet.se$request_uri</code><code>;</code> <code>}</code></p> <p>Starta sedan Rattic med hj\u00e4lp av supervisord.</p> <p><code>service\u00a0supervisord\u00a0start</code></p>"},{"location":"linux_services/RatticDB/#ldap","title":"LDAP","text":"<p>L\u00e4gg in f\u00f6ljande i conf filen. Mer dokumentation finns p\u00e5 Rattic Wiki.</p> <p><code>[ldap]</code> <code>#\u00a0LDAP\u00a0server\u00a0details</code> <code>uri\u00a0=</code><code>ldap://localhost</code></p> <p><code>#\u00a0User\u00a0parameters</code> <code>userbase\u00a0=\u00a0ou=users,dc=example,dc=com</code> <code>userfilter\u00a0=\u00a0(uid=%(user)s)</code></p> <p><code>#\u00a0Set\u00a0up\u00a0the\u00a0basic\u00a0group\u00a0parameters.</code> <code>groupbase\u00a0=\u00a0ou=django,ou=groups,dc=example,dc=com</code> <code>groupfilter\u00a0=\u00a0(objectClass=groupOfNames)</code> <code>grouptype\u00a0=\u00a0GroupOfNamesType</code></p> <p><code>#\u00a0How\u00a0do\u00a0I\u00a0find\u00a0staff</code> <code>staff\u00a0=\u00a0cn=staff,ou=groups,dc=example,dc=com</code></p> <p>Category:Guider Category:Sparco</p>"},{"location":"linux_services/Realmd/","title":"Realmd","text":"<p>realmd \u00e4r en tj\u00e4nst som g\u00f6r det m\u00f6jligt att konfigurera n\u00e4tverksautentisering och dom\u00e4nmedlemskap p\u00e5 ett standardiserat s\u00e4tt. realmd uppt\u00e4cker information om dom\u00e4nen automatiskt. F\u00f6r Active Directory Backend anv\u00e4nds SSSD, det g\u00e5r \u00e4ven med winbind men SSSD \u00e4r rekommenderat. N\u00e5gra f\u00f6rdelar med SSSD:</p> <ul> <li>Snabbare inloggning</li> <li>Klienter kan uppdatera sitt eget DNS record</li> <li>Klienter har st\u00f6d f\u00f6r sites-featuren i AD</li> <li>Enterprise Principals (UPN) \u00e4r supporterade default</li> </ul>"},{"location":"linux_services/Realmd/#installation","title":"Installation","text":"<p>Ubuntu</p> <p><code>apt-get\u00a0install\u00a0realmd</code> <code>apt-get\u00a0install\u00a0sssd</code></p>"},{"location":"linux_services/Realmd/#konfiguration","title":"Konfiguration","text":"<p><code>nano\u00a0/etc/sssd/sssd.conf</code> <code>[nss]</code> <code>filter_groups\u00a0=\u00a0root</code> <code>filter_users\u00a0=\u00a0root</code> <code>reconnection_retries\u00a0=\u00a03</code></p> <p><code>[pam]</code> <code>reconnection_retries\u00a0=\u00a03</code></p> <p>Filr\u00e4ttigheter</p> <p><code>chmod\u00a00600\u00a0/etc/sssd/sssd.conf</code></p> <p>Joina dom\u00e4n</p> <p><code>realm\u00a0--verbose\u00a0join\u00a0domain.local\u00a0-U\u00a0Administrator</code></p> <p>Om det inte funkar, l\u00e4gg till f\u00f6ljande i sssd.conf</p> <p><code>use_fully_qualified_names\u00a0=\u00a0True</code></p> <p>Reboota maskinen</p> <p>Testa</p> <p><code>id\u00a0LOCALDOMAIN\\\\username</code> <code>su\u00a0username@localdomain</code></p> <p>Category:Guider</p>"},{"location":"linux_services/Roundcube/","title":"Roundcube","text":"<p>Roundcube \u00e4r en webbaserad IMAP-mailklient som \u00e4r skriven i PHP och kan anv\u00e4ndas tillsammans med en LAMP-stack, eller n\u00e5got annat operativsystem som st\u00f6djer PHP. Webbservern beh\u00f6ver tillg\u00e5ng till IMAP-servern \u00e4r h\u00e4mta mail och till en SMTP-server f\u00f6r att kunna skicka mail. Roundcube \u00e4r gratis och \u00f6ppen k\u00e4llkod enligt GNU General Public License (GPL).</p> <p>https://roundcube.net</p>"},{"location":"linux_services/Roundcube/#installation","title":"Installation","text":"<p>Exempelinstallation</p> <p><code>sudo\u00a0apt-get\u00a0update\u00a0&amp;&amp;\u00a0sudo\u00a0apt-get\u00a0upgrade\u00a0-y\u00a0&amp;&amp;\u00a0sudo\u00a0apt-get\u00a0-y\u00a0install\u00a0apache2\u00a0mysql-server\u00a0roundcube\u00a0roundcube-mysql</code> <code>sudo\u00a0rm\u00a0-R\u00a0/var/www/html\u00a0&amp;&amp;\u00a0sudo\u00a0ln\u00a0-s\u00a0/usr/share/roundcube/\u00a0/var/www/html\u00a0&amp;&amp;\u00a0sudo\u00a0service\u00a0apache2\u00a0restart</code> <code>sudo\u00a0dpkg-reconfigure\u00a0roundcube-core</code> <code>sudo\u00a0php5enmod\u00a0mcrypt\u00a0&amp;&amp;\u00a0sudo\u00a0service\u00a0apache2\u00a0restart</code></p>"},{"location":"linux_services/Roundcube/#konfiguration","title":"Konfiguration","text":"<p>Peka mot din mailserver.</p> <p><code>sudo\u00a0nano\u00a0/etc/roundcube/main.inc.php</code> <code>$rcmail_config['default_host']\u00a0=\u00a0array(\"ssl://10.0.0.11\");</code> <code>$rcmail_config['default_port']\u00a0=\u00a0993;</code> <code>$rcmail_config['imap_auth_type']\u00a0=\u00a0LOGIN;</code> <code>$rcmail_config['smtp_server']\u00a0=\u00a0'tls://10.0.0.11';</code> <code>$rcmail_config['smtp_port']\u00a0=\u00a025;</code> <code>$rcmail_config['smtp_user']\u00a0=\u00a0'%u';</code> <code>$rcmail_config['smtp_pass']\u00a0=\u00a0'%p';</code> <code>$rcmail_config['smtp_auth_type']\u00a0=\u00a0'LOGIN';</code></p> <p>Category:Guider</p>"},{"location":"linux_services/Rsyslog/","title":"Rsyslog","text":"<p>Category:Guider RSYSLOG st\u00e5r f\u00f6r rocket-fast system for log processing. Rsyslog \u00e4r v\u00e4ldigt flexibelt har en m\u00e4ngd olika input plugins och output plugins som g\u00f6r att du kan forwarda dina loggar till andra system som Elasticsearch, Kafka eller bara spara ner dina loggar till en fil som roterar dagligen.</p> <p>Rsyslog l\u00e4mpar sig d\u00e4rf\u00f6r v\u00e4ldigt bra som en central log aggeragator.</p>"},{"location":"linux_services/Rsyslog/#installation","title":"Installation","text":"<ul> <li>#tab1|CentOS 7/8</li> <li>#tab2|Ubuntu 18.04/20.04</li> </ul>   `yum\u00a0-y\u00a0install\u00a0rsyslog`     `apt-get\u00a0install\u00a0rsyslog` `\u00a0\u00a0`"},{"location":"linux_services/Rsyslog/#konfiguration","title":"Konfiguration","text":"<p>Default s\u00e5 letar rsyslog efter .conf filer under /etc/rsyslog.d/</p>"},{"location":"linux_services/Rsyslog/#syslog-server","title":"Syslog server","text":"<p>Starta en syslog server som lysnar p\u00e5 port 514 TCP/UDP och som sparar ner varje enhet i sin egen fil.</p> <pre><code># Load modules for UDP &amp; TCP\nmodule(load=\"imudp\")\nmodule(load=\"imtcp\")\n\n# Start to listen on port 514 TCP/UDP\ninput(type=\"imudp\" port=\"514\")\ninput(type=\"imtcp\" port=\"514\")\n\n# Templates\ntemplate(name=\"RemoteHost\" type=\"string\" string=\"/var/log/remote/%HOSTNAME%_%$YEAR%_%$MONTH%_%$DAY%.log\")\n\n# Actions\naction(type=\"omfile\" DynaFile=\"RemoteHost\")\n</code></pre>"},{"location":"linux_services/Rsyslog/#kafka-output","title":"Kafka Output","text":"<p>Man kan anv\u00e4nda rsyslog som en aggregator som sedan skickar datan vidare till en Kafka instance. D\u00e5 kan man man anv\u00e4nda sig av omkafka pluginet.</p> <ul> <li>#tab3|CentOS 7/8</li> <li>#tab4|Ubuntu 18.04/20.04</li> </ul>   `yum\u00a0-y\u00a0install\u00a0rsyslog-kafka`     `apt-get\u00a0install\u00a0rsyslog-kafka` `\u00a0\u00a0`   <p>Simpel syslog server som tar emot p\u00e5 port 514 TCP/UDP och som exportar till en Kafka instans direkt.</p> <pre><code># Load modules for UDP &amp; TCP\nmodule(load=\"imudp\")\nmodule(load=\"imtcp\")\nmodule(load=\"omkafka\")\n\n# Start to listen on port 514 TCP/UDP\ninput(type=\"imudp\" port=\"514\")\ninput(type=\"imtcp\" port=\"514\")\n\n# Actions\naction(type=\"omkafka\" Broker=\"&lt;BROKER IP&gt;\" Topic=\"&lt;KAFKA-TOPIC&gt;\")\n</code></pre>"},{"location":"linux_services/Rsyslog/#dynamic-topic","title":"Dynamic Topic","text":"<p>Man kan skicka syslog till olika topics baserat p\u00e5 inneh\u00e5llet i syslog meddelandet, tex facility, hostname, datum osv. Egentligen allt som rsyslog sj\u00e4lv kan urskilja, vad det finns f\u00f6r f\u00e4rdig definierade variabler kan man hitta h\u00e4r.</p> <p>F\u00f6r att sl\u00e5 p\u00e5 denna funktion anv\u00e4nder man sig av:</p> <p><code>DynaTopic=\"on\"</code></p> <p>Det g\u00f6r att topic parametern pekar p\u00e5 en template ist\u00e4llet.</p> <p>I detta exempel s\u00e5 skickar jag syslog till en topic baserat p\u00e5 vilken input syslogen kommer in p\u00e5.</p> <pre><code># Module loaders\nmodule(load=\"imudp\")\nmodule(load=\"imtcp\")\nmodule(load=\"omkafka\")\n\n# Juniper input\ninput(type=\"imudp\" port=\"5141\" name=\"juniper\")\ninput(type=\"imtcp\" port=\"5141\" name=\"juniper\")\n\n# VMware input\ninput(type=\"imudp\" port=\"5140\" name=\"vmware\")\ninput(type=\"imtcp\" port=\"5140\" name=\"vmware\")\n\n# Template\ntemplate(name=\"Kafka_Topic\" type=\"string\" string=\"syslog.%INPUTNAME%\")\n\n# Output to Kafka\naction(type=\"omkafka\" Broker=\"&lt;BROKER IP&gt;\" DynaTopic=\"on\" Topic=\"Kafka_Topic\")\n</code></pre>"},{"location":"linux_services/Rsyslog/#dynamic-key","title":"Dynamic Key","text":"<p>By default s\u00e5 skriver man i random order till olika partitioner f\u00f6r att lastbalansera. Detta kommer g\u00f6ra att n\u00e4r man l\u00e4ser tillbaka syslogen ifr\u00e5n Kafka s\u00e5 kommer meddelande ifr\u00e5n samma enhet att inte komma i ordning. F\u00f6r att fixa detta m\u00e5ste man skicka med en key. Det g\u00f6r att alla meddelande ifr\u00e5n enhet1 tex alltid kommer att hamna i partition 1. P\u00e5 s\u00e5 s\u00e4tt kommer man alltid l\u00e4sa meddelanden fr\u00e5n varje enhet i den ordningen dom skapades.</p> <p>F\u00f6r att fixa detta anv\u00e4nder man sig av:</p> <p><code>DynaKey=\"on\"</code></p> <p>Det g\u00f6r att key parametern pekar p\u00e5 en template ist\u00e4llet.</p> <p>I exemplet nedan s\u00e5 s\u00e4tter vi keyn till IP'n det kommer ifr\u00e5n.</p> <pre><code># Module loaders\nmodule(load=\"imudp\")\nmodule(load=\"imtcp\")\nmodule(load=\"omkafka\")\n\n# Input\ninput(type=\"imudp\" port=\"514\")\ninput(type=\"imtcp\" port=\"514\")\n\n# Template\ntemplate(name=\"Kafka_Key\" type=\"string\" string=\"%FROMHOST-IP%\")\n\n# Output to Kafka\naction(type=\"omkafka\" Broker=\"&lt;BROKER IP&gt;\" DynaKey=\"on\" Topic=\"Kafka_Key\")\n</code></pre>"},{"location":"linux_services/Rsyslog/#multiple-brokers","title":"Multiple brokers","text":"<p>Om man har ett Kafka cluster s\u00e5 beh\u00f6ver man s\u00e4tta flera brokers det g\u00f6r man s\u00e5h\u00e4r:</p> <pre><code>action(type=\"omkafka\" Broker=[\"&lt;BROKER IP&gt;\",\"&lt;BROKER IP&gt;\",\"&lt;BROKER IP&gt;\"] Partitions.Auto=\"on\" Topic=\"Kafka_Topic\")\n</code></pre> <p>Det \u00e4r ocks\u00e5 bra om man s\u00e4tter p\u00e5:</p> <p><code>Partitions.Auto=\"on\"</code></p> <p>Det g\u00f6r att man automatiskt kommer att last balansera alla meddelande man skapar till alla partioner f\u00f6r den topicen.</p>"},{"location":"linux_services/Rsyslog/#structured-data-rfc5424","title":"Structured data - RFC5424","text":"<p>Ifall du har en syslog som f\u00f6ljer RFC 5424 kan du anv\u00e4nda dig av den f\u00f6rdefinierade templaten RSYSLOG_SyslogProtocol23Format f\u00f6r att beh\u00e5lla strukturen n\u00e4r du sparar till fil eller forwardar loggen till ett annat system.</p> <pre><code>action(type=\"omkafka\" Broker=\"&lt;BROKER IP&gt;\" Topic=\"&lt;KAFKA-TOPIC&gt;\" template=\"RSYSLOG_SyslogProtocol23Format\")\n</code></pre>"},{"location":"linux_services/SELinux/","title":"SELinux","text":"<p>Security-Enhanced Linux, SELinux \u00e4r en s\u00e4kerhetsmodul i linuxk\u00e4rnan som g\u00f6r det m\u00f6jligt att s\u00e4kra upp b\u00e5de h\u00e5rd- och mjukvara. K\u00e4rnan i SELinux \u00e4r labels. Man s\u00e4tter SELinux labels p\u00e5 allt ifr\u00e5n filer till portar, sedan applyar man policy p\u00e5 labels. Detta \u00e4r en standardmodul sedan kernel 2.6 och g\u00e5r t.ex. att konfigurera med Ansible eller Puppet.</p> <p>Det \u00e4r rekommenderat att alltid ha SELinux p\u00e5slaget f\u00f6r att sedan whitelista de avst\u00e4ngda funktioner du vill \u00e5t. F\u00f6r att modifiera SELinux kan man anv\u00e4nda sig av det enkla verktyget: semanage.</p> <p><code>#\u00a0semanage\u00a0(#\u00a0yum\u00a0install\u00a0policycoreutils-python)</code></p> <p>Sl\u00e5 av och p\u00e5 SELinux manuellt</p> <p><code>setenforce\u00a00/1</code> <code>getenforce</code></p> <p>Byt SELinux-l\u00e4ge till n\u00e4sta reboot (persistent)</p> <p><code>sudo\u00a0sed\u00a0-i\u00a0's/SELINUX=enforcing/SELINUX=disabled/g'\u00a0/etc/selinux/config</code></p> <p>Status</p> <p><code>sestatus\u00a0-v</code></p> <p>Show labels, exempelkommandon</p> <p><code>ls\u00a0-lhZ</code> <code>ps\u00a0-eZ</code> <code>ss\u00a0-Z</code> <code>semanage\u00a0fcontext\u00a0--list</code></p>"},{"location":"linux_services/SELinux/#exempel-pa-funktioner-som-ar-satta-och-avstangda-av-selinux","title":"Exempel p\u00e5 funktioner som \u00e4r satta och avst\u00e4ngda av SELinux","text":"<p>httpd_can_network_connect - Ser till s\u00e5 att din httpd-tj\u00e4nst inte kan f\u00e5 tillg\u00e5ng till n\u00e4t. Denna kan vara bra att ha ig\u00e5ng om du tex har en webbtj\u00e4nst som h\u00e4mtar information via tex http externt. ssh_port_t - Denna \u00e4r satt till 22. Om du vill k\u00f6ra ssh p\u00e5 annan port m\u00e5ste du byta eller l\u00e4gga till din nya port i SELinux.</p>"},{"location":"linux_services/SELinux/#setroubleshoot","title":"Setroubleshoot","text":"<p>Det finns ett paket som heter setroubleshoot-server som \u00e4r till stor hj\u00e4lp om man valt att anv\u00e4nda SElinux. Paketet g\u00f6r att loggar fr\u00e5n SELinux hamnar i /var/log/messages och att dom blir v\u00e4ldigt enkla att l\u00e4sa. Paketet kan ocks\u00e5 hj\u00e4lpa dig att l\u00f6sa problemet med hj\u00e4lp av kommandot sealert</p> <p>F\u00f6r att installera:</p> <p><code>yum\u00a0-y\u00a0install\u00a0setroubleshoot-server</code></p> <p>Starta sedan om audit</p> <p><code>systemctl\u00a0restart\u00a0audit</code></p> <p>Loggar fr\u00e5n SELinux ska nu hamna i /var/log/messages.</p> <p>Om du redan har en fil med loggar du vill analysera kan du anv\u00e4nda dig av sealert.</p> <p><code>sealert\u00a0-a\u00a0/var/log/audit/audit.log\u00a0&gt;\u00a0/var/log/audit/audit_human_readable.log</code></p>"},{"location":"linux_services/SELinux/#skapa-egna-selinux-med-grep-och-audit2allow","title":"Skapa egna selinux med grep och audit2allow.","text":"<p>Kommando</p> <p><code>cat\u00a0/var/log/audit/audit.log\u00a0|grep\u00a0postgres_expo\u00a0|grep\u00a0denied\u00a0|audit2allow</code></p> <p>Resultat som visar vad det \u00e4r du skapar en regel p\u00e5</p> <p><code>#=============\u00a0init_t\u00a0==============</code> <code>allow\u00a0init_t\u00a0postgresql_port_t:tcp_socket\u00a0name_connect;</code></p> <p>Kommando</p> <p><code>cat\u00a0/var/log/audit/audit.log\u00a0|grep\u00a0postgres_expo\u00a0|grep\u00a0denied\u00a0|audit2allow\u00a0-M\u00a0postgres</code></p> <p>Resultat som bara visar vad du skall k\u00f6ra f\u00f6r att implementera selinux regeln ovan</p> <p><code>********************\u00a0IMPORTANT\u00a0***********************</code> <code>To\u00a0make\u00a0this\u00a0policy\u00a0package\u00a0active,\u00a0execute:</code> <code>semodule\u00a0-i\u00a0postgres.pp</code></p> <p>kommando</p> <p><code>semodule\u00a0-i\u00a0postgres.pp</code></p>"},{"location":"linux_services/SSH/","title":"SSH","text":"<p>SSH kan anv\u00e4ndas f\u00f6r mer \u00e4n bara SSHa till en server. Du kan anv\u00e4nda det f\u00f6r att tunnla trafik till saker du inte har direkt \u00e5tkomst mot och k\u00f6ra program med hj\u00e4lp av tex Xming.</p>"},{"location":"linux_services/SSH/#fingerprint","title":"Fingerprint","text":"<p>F\u00f6rsta g\u00e5ngen man SSHar till en maskin kan man inte vara s\u00e4ker p\u00e5 \u00e4ktheten f\u00f6r att man inte har n\u00e5got fingerprint cacheat. Man kan manuellt kolla fingerprint f\u00f6r att s\u00e4kerst\u00e4lla att man inte blir mitmad. Kolla f\u00f6rst p\u00e5 servern, detta b\u00f6r alltid g\u00f6ras med konsolen, f\u00f6r att sedan j\u00e4mf\u00f6ra det med vad din SSH-klient sj\u00e4lv r\u00e4knar ut utifr\u00e5n nyckeln den f\u00e5r.</p> <p><code>cd\u00a0/etc/ssh</code> <code>for\u00a0file\u00a0in\u00a0*sa_key.pub</code> <code>do\u00a0\u00a0\u00a0ssh-keygen\u00a0-lf\u00a0$file</code> <code>done</code></p>"},{"location":"linux_services/SSH/#sshfp","title":"SSHFP","text":"<p>SSHFP \u00e4r ett resource record i DNS som man anv\u00e4nder f\u00f6r att svara klienter som v\u00e4ljer att fr\u00e5ga DNS om nycklarna klienten f\u00e5r \u00e4r \u00e4kta. S\u00e5h\u00e4r kan det se ut i din zon.</p> <p><code>sshserver\u00a0\u00a0\u00a0\u00a0IN\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0A\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a01.2.3.4</code> <code>IN\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0SSHFP\u00a0\u00a0\u00a01\u00a01\u00a0b4b8f2e051a16f57f69590c7c06aeaad019a3882</code> <code>IN\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0SSHFP\u00a0\u00a0\u00a02\u00a01\u00a0ea35c2064a5fb2ec9f51da2e7c790967f9844e59</code></p>"},{"location":"linux_services/SSH/#reverse-ssh-tunnel","title":"Reverse SSH Tunnel","text":"<p>Kan anv\u00e4ndas om en server sitter bakom en brandv\u00e4gg som du inte kan SSHa igenom.</p> <p>Skriv detta p\u00e5 servern bakom brandv\u00e4ggen.</p> <p><code>ssh\u00a0-fN\u00a0-R\u00a07000:localhost:22\u00a0username@ip</code></p> <p>Anslut sedan till servern \u00f6ver tunnel med kommandot.</p> <p><code>ssh\u00a0-p\u00a07000\u00a0username@localhost</code></p>"},{"location":"linux_services/SSH/#tunnla-trafik","title":"Tunnla trafik","text":"<p>F\u00f6r att tunnla trafik och tex kunna RDPa eller VNC en maskin bakom din SSH host.</p>"},{"location":"linux_services/SSH/#rdp-trafik","title":"RDP Trafik","text":"<p><code>ssh\u00a0-N\u00a0-L\u00a013389:RDPhost:3389\u00a0username@ip</code></p> <p>Starta sedan din RDP klient och anslut mot localhost:13389.</p> <p><code>rdesktop\u00a0localhost:13389</code></p>"},{"location":"linux_services/SSH/#http-trafik","title":"HTTP trafik","text":"<p><code>ssh\u00a0-N\u00a0-D\u00a08080\u00a0username@ip</code></p> <p>\u00c4ndra sedan din webbl\u00e4sares socks proxy till localhost port 8080.</p> <p><code>export\u00a0HTTPS_PROXY=socks5://127.0.0.1:8080</code></p>"},{"location":"linux_services/SSH/#tunnel-i-en-reverse-tunnel","title":"Tunnel i en reverse tunnel","text":"<p>Man kan skapa tunnlar i en reverse ssh tunnel.</p> <p><code>ssh\u00a0-p\u00a07000\u00a0-N\u00a0-L\u00a013389:IPtillRDPhost:3389\u00a0username@ip</code></p> <p>Och anslut p\u00e5 samma s\u00e4tt localhost:13389.</p>"},{"location":"linux_services/SSH/#autossh","title":"Autossh","text":"<p>Om man vill att SSH-tunneln ska klara reboots och disconnects kan man autostarta autossh. Detta f\u00f6ruts\u00e4tter att man g\u00f6r autentiseringen med RSA-nycklar.</p> <p><code>sudo\u00a0apt-get\u00a0-y\u00a0install\u00a0autossh</code> <code>sudo\u00a0nano\u00a0/etc/rc.local</code> <code>autossh\u00a0-M\u00a010984\u00a0-N\u00a0-f\u00a0-o\u00a0\"PubkeyAuthentication=yes\"\u00a0-o\u00a0\"PasswordAuthentication=no\"\u00a0-i\u00a0/home/$USER/.ssh/id_rsa\u00a0-R\u00a07000:localhost:22\u00a0username@ip\u00a0-p\u00a022\u00a0&amp;</code></p>"},{"location":"linux_services/SSH/#ssh-key","title":"SSH-Key","text":"<p>L\u00e4s f\u00f6ljande del hur man kan autentisera sig med RSA nykel utan att beh\u00f6va skriva l\u00f6senord, SSH Autentisering. Category:Guider</p>"},{"location":"linux_services/Shalt%C3%BAre/","title":"Shalt\u00fare","text":"<p>Shalt\u00fare \u00e4r ett g\u00e4ng bra services f\u00f6r att komplettera din IRC server. Du kan registrera ditt nick, \u00e4ga kanaler s\u00e5 ingen kan ta \u00f6ver den \u00e4r n\u00e5gra av sakerna du f\u00e5r.</p> <p>Dessa services finns,</p> <ul> <li>NickServ</li> <li>ChanServ</li> <li>Global</li> <li>InfoServ</li> <li>OperServ</li> <li>SaslServ</li> <li>MemoServ</li> <li>GroupServ</li> <li>StatServ</li> <li>ALIS</li> </ul>"},{"location":"linux_services/Shalt%C3%BAre/#forberedelse","title":"F\u00f6rberedelse","text":"<p>Du beh\u00f6ver ett extra A record tex <code>services.hackernet.se</code></p> <p><code>apt-get\u00a0install\u00a0gettext</code></p>"},{"location":"linux_services/Shalt%C3%BAre/#installation","title":"Installation","text":"<p>Shalt\u00fare installerar sig i anv\u00e4ndarens home folder som default. D\u00e4rf\u00f6r beh\u00f6ver man klona fr\u00e5n git till en mapp som inte heter <code>Shalture</code></p> <p><code>git\u00a0clone</code><code>git://github.com/shalture/shalture.git</code><code>shalture-source</code> <code>cd\u00a0shalture-source</code> <code>git\u00a0submodule\u00a0init</code> <code>git\u00a0submodule\u00a0update</code></p> <p>Sedan \u00e4r det bara att kompilera programmet.</p> <p><code>./configure\u00a0--enable-contrib</code> <code>make</code> <code>make\u00a0install</code></p>"},{"location":"linux_services/Shalt%C3%BAre/#konfiguration","title":"Konfiguration","text":"<p>Konfigurationen \u00e4r verifierad och funkar p\u00e5 InspIRCd, men det b\u00f6r vara samma f\u00f6r andra IRC servrar.</p> <p>B\u00f6rja med att kopiera exempel filen.</p> <p><code>cd\u00a0~/shalture/etc\u00a0&amp;&amp;\u00a0cp\u00a0shalture.conf.example\u00a0shalture.conf</code></p> <p>\u00c4ndra rad 66 s\u00e5 r\u00e4tt IRCd modul laddas.</p> <p><code>loadmodule\u00a0\"modules/protocol/inspircd\";</code></p> <p>P\u00e5 rad 793 i <code>serverinfo</code> f\u00e4ltet \u00e4ndra f\u00f6ljande s\u00e5 dom passar dig.</p> <p><code>name\u00a0=\u00a0\"services.hackernet.se\";</code> <code>desc\u00a0=\u00a0\"Hackernet\u00a0IRC\u00a0Services\";</code> <code>numeric\u00a0=\u00a0\"00A\";\u00a0#Denna\u00a0\u00e4r\u00a0viktigt\u00a0att\u00a0den\u00a0inte\u00a0har\u00a0samma\u00a0ID\u00a0som\u00a0i\u00a0konfigurationsfilen\u00a0f\u00f6r\u00a0din\u00a0IRC\u00a0server.</code> <code>netname\u00a0=\u00a0\"Hackernet\";</code> <code>adminname\u00a0=\u00a0\"Sparco\";</code> <code>adminemail\u00a0=\u00a0\"root@hackernet.se\";</code> <code>registeremail\u00a0=\u00a0\"root@hackernet.se\";</code></p> <p>Leta sedan upp <code>uplink</code> f\u00e4ltet p\u00e5 rad 938.</p> <p><code>uplink\u00a0\"services.hackernet.se\"\u00a0{</code> <code>host\u00a0=\u00a0\"irc.hackernet.se\";</code> <code>port\u00a0=\u00a0\"6666\";</code> <code>send_password\u00a0=\u00a0\"password\";</code> <code>receive_password\u00a0=\u00a0\"password\";</code></p> <p>P\u00e5 rad 971 i <code>nickserv</code> \u00e4ndra.</p> <p><code>host\u00a0=\u00a0\"hackernet.se\";</code></p> <p>Det kommer ge nickserv FQDN namnet nickserv@hackernet.se. \u00c4ndra nu <code>host=</code> p\u00e5 resterande services som kommer i filen.</p> <p>Leta upp raden <code>operator</code> p\u00e5 rad 2217. \u00c4ndra till samma som din IRCd oper \u00e4r.</p>"},{"location":"linux_services/Shalt%C3%BAre/#inspircd","title":"InspIRCd","text":"<p>Konfigurationen som beh\u00f6vs p\u00e5 InspIRCd f\u00f6r att Shalt\u00fare ska funka. Shalt\u00fare klarar inte av att ansluta \u00f6ver SSL \u00e4n.</p> <pre><code>&lt;bind address=\"192.168.1.4\" port=\"6666\" type=\"servers\"&gt;\n&lt;uline server=\"services.hackernet.se\"&gt;\n&lt;link name=\"services.hackernet.se\" ipaddr=\"192.168.1.4\" port=\"6666\" allowmask=\"192.168.1.0/24\" sendpass=\"password\" recvpass=\"password\"&gt;\n</code></pre> <p>F\u00f6ljande moduler beh\u00f6ver ocks\u00e5 vara laddade.</p> <pre><code>&lt;module name=\"m_chanprotect.so\"&gt;\n&lt;module name=\"m_halfop.so\"&gt;\n&lt;module name=\"m_services_account.so\"&gt;\n&lt;module name=\"m_deaf.so\"&gt;\n&lt;module name=\"m_spanningtree.so\"&gt;\n&lt;module name=\"m_globops.so\"&gt;\n&lt;module name=\"m_cban.so\"&gt;\n&lt;module name=\"m_svshold.so\"&gt;\n&lt;module name=\"m_hidechans.so\"&gt;\n&lt;module name=\"m_servprotect.so\"&gt;\n&lt;module name=\"m_chghost.so\"&gt;\n&lt;module name=\"m_namesx.so\"&gt;\n&lt;module name=\"m_uhnames.so\"&gt;\n</code></pre> <p>Starta nu Shalt\u00fare</p> <p><code>cd\u00a0$HOME/shalture/bin/\u00a0&amp;&amp;\u00a0./shalture-services</code></p>"},{"location":"linux_services/Shalt%C3%BAre/#exempel","title":"Exempel","text":"<p>P\u00e5 din IRC server skriv nu f\u00f6r att f\u00e5 hj\u00e4lp.</p> <p><code>/msg\u00a0Nickserv\u00a0help</code> <code>/msg\u00a0Chanserv\u00a0help</code></p>"},{"location":"linux_services/Shalt%C3%BAre/#crontab","title":"Crontab","text":"<p>L\u00e4gg in f\u00f6ljande i din crontab f\u00f6r att checka att Shalt\u00fare \u00e4r ig\u00e5ng var 5e minut.</p> <p><code>*/5\u00a0*\u00a0*\u00a0*\u00a0*\u00a0/home/shalture/shalture/etc/shalture.cron\u00a0&gt;/dev/null\u00a02&gt;&amp;1</code></p> <p>Category:Guider Category:Sparco</p>"},{"location":"linux_services/SmokePing/","title":"SmokePing","text":"<p>SmokePing \u00e4r ett verktyg f\u00f6r att m\u00e4ta latens i ett n\u00e4tverk. Den kan m\u00e4ta, lagra och visa latens och paketf\u00f6rlust. SmokePing anv\u00e4nder rrdtool f\u00f6r att f\u00f6r att lagra data och har ett webgui f\u00f6r att visa graferna.</p>"},{"location":"linux_services/SmokePing/#installation","title":"Installation","text":"<p><code>sudo\u00a0apt-get\u00a0update\u00a0&amp;&amp;\u00a0sudo\u00a0apt-get\u00a0upgrade</code> <code>sudo\u00a0apt-get\u00a0-y\u00a0install\u00a0smokeping</code></p> <p>Skapa syml\u00e4nk till smokeping apache config</p> <p><code>cd\u00a0/etc/apache2/conf-available\u00a0&amp;&amp;\u00a0sudo\u00a0ln\u00a0-s\u00a0../../smokeping/apache2.conf\u00a0smokeping.conf</code></p> <p>Enable Apache konfig och CGI</p> <p><code>sudo\u00a0a2enconf\u00a0smokeping\u00a0&amp;&amp;\u00a0sudo\u00a0a2enmod\u00a0cgid</code> <code>sudo\u00a0service\u00a0apache2\u00a0restart</code></p> <p>Om detta failar se sendmail nedan.</p>"},{"location":"linux_services/SmokePing/#konfiguration","title":"Konfiguration","text":"<p>Generella inst\u00e4llningar, byt cgiurl.</p> <p><code>sudo\u00a0nano\u00a0/etc/smokeping/config.d/General</code></p> <p>Om man inte vill anv\u00e4nda sendmail</p> <p><code>sudo\u00a0nano\u00a0/etc/smokeping/config.d/pathnames</code> <code>sendmail\u00a0=\u00a0/bin/false</code></p> <p>Ifall man vill f\u00e5 larm</p> <p><code>sudo\u00a0nano\u00a0/etc/smokeping/config.d/Alerts</code></p> <p>H\u00e4r g\u00f6rs inst\u00e4llningar g\u00e4llande vilka hostar som ska \u00f6vervakas och hur de ska struktureras (G\u00f6rs med antal plustecken).</p> <p><code>sudo\u00a0nano\u00a0/etc/smokeping/config.d/Targets</code> <code>+\u00a0Site1</code> <code>menu\u00a0=\u00a0\u00a0Site1</code> <code>title\u00a0=\u00a0Site1</code></p> <p><code>++\u00a0LocalMachine</code> <code>menu\u00a0=\u00a0Local\u00a0Machine</code> <code>title\u00a0=\u00a0This\u00a0host</code> <code>host\u00a0=\u00a0localhost</code> <code>#alerts\u00a0=\u00a0someloss</code></p> <p><code>++\u00a0GW</code> <code>menu\u00a0=\u00a0GW</code> <code>title\u00a0=\u00a0GW</code> <code>host\u00a0=\u00a0192.168.0.1</code></p> <p>Restart</p> <p><code>sudo\u00a0service\u00a0smokeping\u00a0restart\u00a0&amp;&amp;\u00a0sudo\u00a0service\u00a0apache2\u00a0reload</code></p> <p>Access</p> <p><code>http://dinserver/cgi-bin/smokeping.cgi</code></p> <p>Category:Guider</p>"},{"location":"linux_services/Spacewalk/","title":"Spacewalk","text":"<p>Spacewalk \u00e4r ett management system f\u00f6r Red Hat baserade system som CentOS, Fedora. Allt sk\u00f6ts i ett snyggt web interface.</p>"},{"location":"linux_services/Spacewalk/#features","title":"Features","text":"<ul> <li>Inventera system (H\u00e5rd och mjukvara).</li> <li>Installera och uppdatera program.</li> <li>Kickstarta dina servrar.</li> <li>Skicka ut konfigurations filer till servrar.</li> <li>Starta/stoppa/konfigurera virtuella g\u00e4ster (KVM &amp; XEN).</li> </ul>"},{"location":"linux_services/Spacewalk/#forberedelse","title":"F\u00f6rberedelse","text":"<p>L\u00e4gg till lite nya repositories som beh\u00f6vs.</p> <p>EPEL repository:</p> <p><code>yum\u00a0install\u00a0epel-release</code></p> <p>JPackage repository:</p> <p><code>cat\u00a0&gt;\u00a0/etc/yum.repos.d/jpackage-generic.repo\u00a0&lt;&lt;\u00a0EOF</code> <code>[jpackage-generic]</code> <code>name=JPackage\u00a0generic</code> <code>#baseurl=</code><code>http://mirrors.dotsrc.org/pub/jpackage/5.0/generic/free/</code> <code>mirrorlist=</code><code>http://www.jpackage.org/mirrorlist.php?dist=generic&amp;type=free&amp;release=5.0</code> <code>enabled=1</code> <code>gpgcheck=1</code> <code>gpgkey=</code><code>http://www.jpackage.org/jpackage.asc</code> <code>EOF</code></p> <p>Spacewalk repository:</p> <p>Beror p\u00e5 vilket dist du kommer k\u00f6ra. I skrivande stund \u00e4r version 2.4 den senaste.</p> <p>Red Hat Enterprise Linux 6, Scientific Linux 6, CentOS 6</p> <p><code>rpm\u00a0-Uvh</code><code>http://yum.spacewalkproject.org/2.4/RHEL/6/x86_64/spacewalk-repo-2.4-3.el6.noarch.rpm</code></p> <p>Red Hat Enterprise Linux 7, Scientific Linux 7, CentOS 7</p> <p><code>rpm\u00a0-Uvh</code><code>http://yum.spacewalkproject.org/2.4/RHEL/7/x86_64/spacewalk-repo-2.4-3.el7.noarch.rpm</code></p> <p>Fedora 21</p> <p><code>rpm\u00a0-Uvh</code><code>http://yum.spacewalkproject.org/2.4/Fedora/21/x86_64/spacewalk-repo-2.4-3.fc21.noarch.rpm</code></p> <p>Fedora 22</p> <p><code>rpm\u00a0-Uvh</code><code>http://yum.spacewalkproject.org/2.4/Fedora/22/x86_64/spacewalk-repo-2.4-3.fc22.noarch.rpm</code></p> <p>Uppdatera repona.</p> <p><code>yum\u00a0repolist\u00a0&amp;&amp;\u00a0yum\u00a0update</code></p>"},{"location":"linux_services/Spacewalk/#installera","title":"Installera","text":"<p>Spacewalk anv\u00e4nder en databas f\u00f6r att spara sin data. Default s\u00e5 anv\u00e4nds en inbyggd PostgreSQL databas. Det g\u00e5r ocks\u00e5 att anv\u00e4nda en Oracle RDBMS version 10g eller h\u00f6gre.</p> <p>Denna guiden anv\u00e4nder den inbyggda databasen:</p> <p><code>yum\u00a0install\u00a0spacewalk-setup-postgresql</code></p> <p>Installera sedan Spacewalk:</p> <p><code>yum\u00a0install\u00a0spacewalk-postgresql</code></p> <p>F\u00f6r att kunna n\u00e5 web interfacet och kunna anv\u00e4nda andra tj\u00e4nster beh\u00f6ver man s\u00e4tta p\u00e5 n\u00e5gra portar.</p> <p><code>firewall-cmd\u00a0--add-service=https\u00a0--permanent</code> <code>firewall-cmd\u00a0--add-service=http\u00a0--permanent</code></p> <p>F\u00f6r att kunna pusha saker till dina klienter beh\u00f6ver man enabla port 5222. Om man t\u00e4nkt anv\u00e4nda Spacewalk proxy beh\u00f6ver man porten 5269. Port 69 UDP beh\u00f6vs om man t\u00e4nkt anv\u00e4nda tftp.</p> <p>Ladda sedan om brandv\u00e4ggen.</p> <p><code>firewall-cmd\u00a0--reload</code></p> <p>Spacewalk m\u00e5ste kunna resolva sitt FQDN. G\u00e5r inte det s\u00e5 l\u00e4gg in det i host filen /etc/hosts</p> <p>K\u00f6r f\u00f6ljande kommando och svara p\u00e5 fr\u00e5gorna.</p> <p><code>spacewalk-setup\u00a0--disconnected</code></p> <p>Surfa sedan in p\u00e5 din spacewalk server https://hostname/ och skapa ett inlogg.</p> <p>Category:Guider</p>"},{"location":"linux_services/Squid/","title":"Squid","text":"<p>Squid \u00e4r en high-performance cache proxy som har st\u00f6d f\u00f6r HTTP, HTTPS, FTP mycket annat.</p>"},{"location":"linux_services/Squid/#installation","title":"Installation","text":"<p>Ubuntu</p> <p><code>sudo\u00a0apt-get\u00a0install\u00a0squid</code></p> <p>CentOS</p> <p><code>yum\u00a0-y\u00a0install\u00a0squid</code></p>"},{"location":"linux_services/Squid/#konfiguration","title":"Konfiguration","text":"<p>All konfiguration av squid sker i /etc/squid/squid.conf. Denna guide g\u00e5r igenom hur man installerar v\u00e4ldigt grundl\u00e4ggande proxy server.</p> <p>\u00d6ppna suid.conf och avkommentera f\u00f6ljande rad:</p> <p><code>#http_access\u00a0allow\u00a0localnet</code></p> <p>D\u00e4refter beh\u00f6ver vi definera vilka n\u00e4t som ska f\u00e5 anv\u00e4nda proxy servern. Leta efter denna rad:</p> <p><code>#acl\u00a0localnet\u00a0src</code></p> <p>avkommentera den och \u00e4ndra den till:</p> <p><code>acl\u00a0localnet\u00a0src</code><code>/</code> <p>Starta om squid:</p> <p><code>sudo\u00a0service\u00a0squid\u00a0restart</code></p> <p>Nu har vi konfigurerat en v\u00e4ldig basic proxy server som svarar p\u00e5 port 3128 som standard.</p> <p>Category:Guider</p>"},{"location":"linux_services/Sshttp/","title":"Sshttp","text":"<p>hiding SSH servers behind HTTP https://github.com/stealth/sshttp</p>"},{"location":"linux_services/Syntaxhighlight/","title":"Syntaxhighlight","text":"<p>F\u00f6r att highlighta kod m\u00e5ste man anv\u00e4nda source editorn och syntaxhighlight.</p> <pre><code>def hello_world():\n  print(\"Hello Hackernet\")\n\nhello_world()\n</code></pre> <p>Ser ut s\u00e5 h\u00e4r i editorn:</p> <pre><code>&lt;syntaxhighlight lang=\"Python\" line&gt;\ndef hello_world():\n  print(\"Hello Hackernet\")\n\nhello_world()\n&lt;/syntaxhighlight&gt;\n</code></pre>"},{"location":"linux_services/Syntaxhighlight/#parametrar","title":"Parametrar","text":""},{"location":"linux_services/Syntaxhighlight/#line","title":"line","text":"<p>G\u00f6r s\u00e5 att du f\u00e5r siffror till v\u00e4nster om din kod.</p> <pre><code>def hello_world():\n  print(\"Hello Hackernet\")\n</code></pre> <pre><code>&lt;syntaxhighlight lang=\"Python\" line&gt;\ndef hello_world():\n  print(\"Hello Hackernet\")\n&lt;/syntaxhighlight&gt;\n</code></pre>"},{"location":"linux_services/Syntaxhighlight/#start","title":"start","text":"<p>Anv\u00e4nds tillsammans med <code>line</code> f\u00f6r att starta p\u00e5 en annan line \u00e4n 1.</p> <pre><code>def hello_world():\n  print(\"Hello Hackernet\")\n</code></pre> <pre><code>&lt;syntaxhighlight lang=\"Python\" line start=\"69\"&gt;\ndef hello_world():\n  print(\"Hello Hackernet\")\n&lt;/syntaxhighlight&gt;\n</code></pre>"},{"location":"linux_services/Syntaxhighlight/#highlight","title":"highlight","text":"<p>Anv\u00e4nds f\u00f6r att highlighta en eller flera rader, <code>hightlight=\"1,2\"</code> eller <code>highlight=\"5-7\"</code></p> <pre><code>def hello_world():\n  print(\"Hello Hackernet\")\n</code></pre> <pre><code>&lt;syntaxhighlight lang=\"Python\" line highlight=2&gt;\ndef hello_world():\n  print(\"Hello Hackernet\")\n&lt;/syntaxhighlight&gt;\n</code></pre>"},{"location":"linux_services/Syntaxhighlight/#supportade-sprak","title":"Supportade Spr\u00e5k","text":"Code Language <code>abap</code> ABAP <code>actionscript</code> ActionScript <code>ada</code> Ada <code>apache</code> Apache Configuration <code>applescript</code> AppleScript <code>asm</code> Assembly <code>asp</code> Active Server Pages (ASP) <code>autoit</code> AutoIt <code>bash</code> Bash <code>basic4gl</code> Basic4GL <code>bf</code> Brainfuck <code>blitzbasic</code> Blitz BASIC <code>bnf</code> Backus-Naur Form <code>c</code> C <code>c_mac</code> C (Mac) <code>caddcl</code> AutoCAD DCL <code>cadlisp</code> AutoLISP <code>cfdg</code> CFDG <code>cfm</code> ColdFusion Markup Language <code>cil</code> Common Intermediate Language (CIL) <code>cobol</code> COBOL <code>cpp-qt</code> C++ (Qt toolkit) <code>cpp</code> C++ <code>csharp</code> C# <code>css</code> Cascading Style Sheets (CSS) <code>d</code> D <code>delphi</code> Delphi <code>diff</code> Diff <code>div</code> DIV <code>dos</code> DOS batch file <code>dot</code> DOT <code>eiffel</code> Eiffel <code>fortran</code> Fortran <code>freebasic</code> FreeBASIC <code>gambas</code> Gambas <code>genero</code> Genero <code>gettext</code> GNU internationalization (i18n) library <code>glsl</code> OpenGL Shading Language (GLSL) <code>gml</code> Game Maker Language (GML) <code>gnuplot</code> gnuplot <code>groovy</code> Groovy <code>haskell</code> Haskell <code>Haxe</code> Haxe <code>hq9plus</code> HQ9+ <code>html4strict</code> HTML <code>html5</code> HTML5 <code>idl</code> Uno IDL <code>ini</code> INI <code>inno</code> Inno <code>intercal</code> INTERCAL <code>io</code> Io <code>java</code> Java <code>java5</code> Java(TM) 2 Platform Standard Edition 5.0 <code>javascript</code> JavaScript <code>kixtart</code> KiXtart <code>klonec</code> Klone C <code>klonecpp</code> Klone C++ <code>latex</code> LaTeX <code>lisp</code> Lisp <code>lolcode</code> LOLCODE <code>lotusscript</code> LotusScript <code>lua</code> Lua Code Language <code>m68k</code> Motorola 68000 Assembler <code>make</code> make <code>matlab</code> MATLAB M <code>mirc</code> mIRC scripting language <code>mxml</code> MXML <code>mpasm</code> Microchip Assembler <code>mysql</code> MySQL <code>nsis</code> Nullsoft Scriptable Install System (NSIS) <code>objc</code> Objective-C <code>ocaml-brief</code> OCaml <code>ocaml</code> OCaml <code>oobas</code> OpenOffice.org Basic <code>oracle8</code> Oracle 8 SQL <code>oracle11</code> Oracle 11 SQL <code>pascal</code> Pascal <code>per</code> per <code>perl</code> Perl <code>php-brief</code> PHP <code>php</code> PHP <code>pixelbender</code> Pixel Bender <code>plsql</code> PL/SQL <code>povray</code> Persistence of Vision Raytracer <code>powershell</code> Windows PowerShell <code>progress</code> OpenEdge Advanced Business Language <code>prolog</code> Prolog <code>providex</code> ProvideX <code>python</code> Python <code>qbasic</code> QBasic/QuickBASIC <code>rails</code> Rails <code>reg</code> Windows Registry <code>robots</code> robots.txt <code>rsplus</code> R <code>ruby</code> Ruby <code>sas</code> SAS <code>scala</code> Scala <code>scheme</code> Scheme <code>scilab</code> Scilab <code>sdlbasic</code> SdlBasic <code>smalltalk</code> Smalltalk <code>smarty</code> Smarty <code>sql</code> SQL <code>tcl</code> Tcl <code>teraterm</code> Tera Term <code>text</code> Plain text <code>thinbasic</code> thinBasic <code>tsql</code> Transact-SQL <code>typoscript</code> TypoScript <code>vala</code> Vala <code>vb</code> Visual Basic <code>vbnet</code> Visual Basic .NET <code>verilog</code> Verilog <code>vhdl</code> VHDL <code>vim</code> Vimscript <code>visualfoxpro</code> Visual FoxPro <code>visualprolog</code> Visual Prolog <code>whitespace</code> Whitespace <code>winbatch</code> Winbatch <code>xml</code> XML <code>xorg_conf</code> Xorg.conf <code>xpp</code> X++ <code>yaml</code> YAML <code>z80</code> ZiLOG Z80 Assembler"},{"location":"linux_services/TFTP/","title":"TFTP","text":"<p>TFTP \u00e4r ett v\u00e4ldigt simpelt protokoll som anv\u00e4nds f\u00f6r att \u00f6verf\u00f6ra filer. Det anv\u00e4nds ofta f\u00f6r att PXE-boota maskiner eller \u00f6verf\u00f6ra image-filer till t.ex. switchar. TFTP bygger p\u00e5 server/klient-arkitekturen.</p>"},{"location":"linux_services/TFTP/#server","title":"Server","text":"<p>F\u00f6rbered ett rot-directory.</p> <p><code>sudo\u00a0mkdir\u00a0/tftproot</code> <code>sudo\u00a0chmod\u00a0-R\u00a01770\u00a0/tftproot</code> <code>sudo\u00a0chown\u00a0-R\u00a0root:tftp\u00a0/tftproot</code></p> <p>Det finns olika TFTP-mjukvaror som fungerar som server.</p>"},{"location":"linux_services/TFTP/#tftpd","title":"tftpd","text":"<p>Trivial file transfer protocol server.</p>"},{"location":"linux_services/TFTP/#atftpd","title":"atftpd","text":"<p>Advanced TFTP server.</p>"},{"location":"linux_services/TFTP/#tftpd-hpa","title":"tftpd-hpa","text":"<p>HPA's tftp server.</p> <p><code>sudo\u00a0apt-get\u00a0-y\u00a0install\u00a0tftpd-hpa</code> <code>sudo\u00a0mv\u00a0/etc/default/tftpd-hpa\u00a0/etc/default/tftpd-hpa.old</code></p> <p><code>sudo\u00a0dd\u00a0of=/etc/default/tftpd-hpa\u00a0&lt;&lt;\u00a0EOF</code> <code>TFTP_USERNAME=\"tftp\"</code> <code>TFTP_DIRECTORY=\"/tftproot\"</code> <code>TFTP_ADDRESS=\":69\"</code> <code>TFTP_OPTIONS=\"--secure\u00a0--create\u00a0--listen\u00a0--verbose\"</code> <code>EOF</code></p> <p><code>sudo\u00a0service\u00a0tftpd-hpa\u00a0restart</code></p>"},{"location":"linux_services/TFTP/#felsokning","title":"Fels\u00f6kning","text":"<p><code>ss\u00a0-tulpn\u00a0|\u00a0grep\u00a069</code></p> <p>Category:Guider</p>"},{"location":"linux_services/Tor/","title":"Tor","text":"<p>Category:Guider Tor \u00e4r en anonymiseringsprogram och anv\u00e4nds bla f\u00f6r att komma \u00e5t deep web.</p>"},{"location":"linux_services/Tor/#installation","title":"Installation","text":"<p>K\u00e4lla: https://www.torproject.org/docs/debian.html.en</p> <p>Ubuntu 18.04 LTS</p> <p><code>sudo\u00a0su\u00a0-</code> <code>echo\u00a0\"deb</code><code>https://deb.torproject.org/torproject.org</code><code>bionic\u00a0main\"\u00a0&gt;&gt;\u00a0/etc/apt/sources.list</code> <code>curl</code><code>https://deb.torproject.org/torproject.org/A3C4F0F979CAA22CDBA8F512EE8CBC9E886DDD89.asc</code><code>|\u00a0gpg\u00a0--import</code> <code>gpg\u00a0--export\u00a0A3C4F0F979CAA22CDBA8F512EE8CBC9E886DDD89\u00a0|\u00a0apt-key\u00a0add\u00a0-</code> <code>apt-get\u00a0update\u00a0&amp;&amp;\u00a0apt-get\u00a0-y\u00a0install\u00a0deb.torproject.org-keyring\u00a0ntp\u00a0&amp;&amp;\u00a0apt-get\u00a0-y\u00a0install\u00a0tor</code></p> <p>Verifiera</p> <p><code>tor\u00a0--version</code></p>"},{"location":"linux_services/Tor/#konfiguration","title":"Konfiguration","text":"<p>TCP 9001 och 9030 beh\u00f6ver port forwardas till maskinen.</p> <p><code>nano\u00a0/etc/tor/torrc</code></p>"},{"location":"linux_services/Tor/#exempel","title":"Exempel","text":"<p>SwedishNSA \u00e4r en non-exit tor-nod. Statistik finns p\u00e5 https://metrics.torproject.org/rs.html.</p> <p><code>mv\u00a0/etc/tor/torrc\u00a0/etc/tor/torrc.orig</code> <code>wget</code><code>https://raw.githubusercontent.com/torproject/tor/master/contrib/operator-tools/tor-exit-notice.html</code><code>-O\u00a0/etc/tor/tor-exit-notice.html</code></p> <p><code>cat&lt;&lt;'__EOF__'&gt;/etc/tor/torrc</code> <code>SocksPort\u00a00</code> <code>Log\u00a0notice\u00a0file\u00a0/var/log/tor/notices.log</code> <code>RunAsDaemon\u00a01</code> <code>DataDirectory\u00a0/var/lib/tor</code> <code>ORPort\u00a09001</code> <code>ORPort\u00a0[2001:2002:beef:ffff::11]:9001</code> <code>Address\u00a0swedishnsa.hackernet.se</code> <code>Nickname\u00a0SwedishNSA</code> <code>ContactInfo\u00a0Helikopter</code> <code>DirPort\u00a09030\u00a0#\u00a0what\u00a0port\u00a0to\u00a0advertise\u00a0for\u00a0directory\u00a0connections</code> <code>DirPortFrontPage\u00a0/etc/tor/tor-exit-notice.html</code> <code>ExitPolicy\u00a0reject\u00a0*:*\u00a0#\u00a0no\u00a0exits\u00a0allowed</code> <code>__EOF__</code> <p><code>systemctl\u00a0restart\u00a0tor</code></p> <p>Kolla att det kommer ig\u00e5ng som det ska</p> <p><code>tail\u00a0-f\u00a0/var/log/tor/notices.log</code></p>"},{"location":"linux_services/Tor/#torport","title":"Torport","text":"<p>En torport kan vara en fysisk port eller ett n\u00e4tverk som s\u00e4tter allt som \u00e4r inkopplat bakom torn\u00e4tverket, helt transparant, vare sig man vill eller inte. Detta \u00e4r ingen Transparent Proxy utan en Isolating proxy. Man beh\u00f6ver en maskin med tv\u00e5 interface. Det ena beh\u00f6ver internetaccess och kan vara DHCP-klient. Det andra \u00e4r DHCP-server f\u00f6r det som ska torifieras, ISC_DHCP. St\u00e4ng \u00e4ven av IP-forwardering f\u00f6r att undvika eventuella IP-l\u00e4ckor.</p> <p><code>sudo\u00a0apt-get\u00a0-y\u00a0install\u00a0tor</code></p> <p>Tor kan g\u00f6ra det mesta sj\u00e4lv</p> <p><code>sudo\u00a0dd\u00a0of=/etc/tor/torrc\u00a0&lt;&lt;\u00a0EOF</code> <code>Log\u00a0notice\u00a0file\u00a0/var/log/tor/notices.log</code> <code>VirtualAddrNetwork\u00a010.192.0.0/10</code> <code>AutomapHostsSuffixes\u00a0.onion,.exit</code> <code>AutomapHostsOnResolve\u00a01</code> <code>TransPort\u00a09040</code> <code>TransListenAddress\u00a010.0.0.1\u00a0#Interface-IPn\u00a0p\u00e5\u00a0torporten</code> <code>DNSPort\u00a053</code> <code>DNSListenAddress\u00a010.0.0.1</code> <code>EOF</code></p> <p>Men beh\u00f6ver lite hj\u00e4lp fr\u00e5n iptables</p> <p><code>sudo\u00a0iptables\u00a0-F</code> <code>sudo\u00a0iptables\u00a0-t\u00a0nat\u00a0-F</code> <code>sudo\u00a0iptables\u00a0-t\u00a0nat\u00a0-A\u00a0PREROUTING\u00a0-i\u00a0p2p1\u00a0-p\u00a0tcp\u00a0--dport\u00a022\u00a0-j\u00a0REDIRECT\u00a0--to-ports\u00a022</code> <code>sudo\u00a0iptables\u00a0-t\u00a0nat\u00a0-A\u00a0PREROUTING\u00a0-i\u00a0p2p1\u00a0-p\u00a0udp\u00a0--dport\u00a053\u00a0-j\u00a0REDIRECT\u00a0--to-ports\u00a053</code> <code>sudo\u00a0iptables\u00a0-t\u00a0nat\u00a0-A\u00a0PREROUTING\u00a0-i\u00a0p2p1\u00a0-p\u00a0tcp\u00a0--syn\u00a0-j\u00a0REDIRECT\u00a0--to-ports\u00a09040</code> <code>sudo\u00a0sh\u00a0-c\u00a0\"iptables-save\u00a0&gt;\u00a0/etc/iptables.rules\"</code></p> <p>V\u00e4lj det interface som \u00e4r din torport. Med p22-regeln kan man ssha till hosten fr\u00e5n \"torn\u00e4tet\".</p> <p><code>sudo\u00a0nano\u00a0/etc/network/if-pre-up.d/iptables</code> <code>#!/bin/bash</code> <code>/sbin/iptables-restore\u00a0&lt;\u00a0/etc/iptables.rules</code> <code>sudo\u00a0chmod\u00a0+x\u00a0/etc/network/if-pre-up.d/iptables</code></p>"},{"location":"linux_services/Tor/#valj-land","title":"V\u00e4lj land","text":"<p>Vill man g\u00e5 i specifika l\u00e4nder kan man specca det i torrc</p> <p><code>ExitNodes\u00a0{us},{uk}</code></p>"},{"location":"linux_services/Transmission/","title":"Transmission","text":"<p>Category:Guider Category:Sparco Transmission \u00e4r en liten men v\u00e4ldigt kraftfull torrent client f\u00f6r linux.</p>"},{"location":"linux_services/Transmission/#installation","title":"Installation","text":"<p><code>apt-get update &amp;&amp; apt-get install transmission transmission-daemon</code></p>"},{"location":"linux_services/Transmission/#konfiguration","title":"Konfiguration","text":"<p>K\u00f6rs enklast via webinterface eller remote GUI</p>"},{"location":"linux_services/Transmission/#webinterface","title":"Webinterface","text":"<p>F\u00f6r att aktivera webinterfacet och \u00e4ven RPC.</p> <p>\u00d6ppna <code>/etc/transmission-daemon/settings.json</code>och \u00e4ndra till <code>\"rpc-enabled\":true</code></p> <p>Webinterfacet n\u00e5s sedan p\u00e5 <code>http://IP:9091/transmission/web/</code></p>"},{"location":"linux_services/Transmission/#transmission-remote-gui","title":"Transmission Remote GUI","text":"<p>Cross platform front end GUI till transmission, g\u00f6r det enkelt att l\u00e4gga till torrents fr\u00e5n din vanliga dator. Finns att tanka hem p\u00e5 http://sourceforge.net/projects/transgui/</p> <p>F\u00f6r att det ska fungera s\u00e5 m\u00e5ste du ha <code>\"rpc-enabled\":true</code> i config filen.</p> <p>RPC path \u00e4r samma som ditt webinterface fast du ers\u00e4tter <code>/transmission/web</code> med <code>/transmission/rpc</code> ist\u00e4llet.</p>"},{"location":"linux_services/Transmission/#tips-n-trix","title":"Tips n Trix","text":"<p>3th Party tools</p> <p>Flexget, RSS feed downloader. V\u00e4ldigt anv\u00e4ndbart f\u00f6r serier.</p> <p>Couchpotato, Program som laddar hem filmer \u00e5t dig med hj\u00e4lp av transmission.</p> <p>Script done.</p> <p>K\u00f6r ett script varje g\u00e5ng en torrent blir klar.</p> <p>L\u00e4gg till</p> <p><code>\"script-torrent-done-enabled\":\u00a0true,</code> <code>\"script-torrent-done-filename\":\u00a0\"/vart/finns/scriptet.sh\",</code></p> <p>i din conf fil <code>/etc/transmission-daemon/settings.json</code></p>"},{"location":"linux_services/Ulteo/","title":"Ulteo","text":"<p>Category:Guider Ulteo Open Virtual Desktop \u00e4r en FOSS-plattform f\u00f6r virtuella skrivbord. Ulteo kan anv\u00e4nda b\u00e5de java och html5, webbl\u00e4sare och native client.</p> <p>Rekommenderat operativsystem: Debian 7</p>"},{"location":"linux_services/Ulteo/#installation","title":"Installation","text":"<p>F\u00f6ljande instruktioner g\u00e4ller f\u00f6r en upps\u00e4ttning d\u00e4r Session manager och Application server k\u00f6rs p\u00e5 samma maskin. (Mer l\u00e4sning om Ulteo-arkitekturen: http://archive.ulteo.com/ovd/4.0/docs/Architecture.html)</p> <p>Referensguide: http://archive.ulteo.com/ovd/4.0/docs/Support_Debian_Wheezy.html</p> <p><code>su\u00a0-</code> <code>echo\u00a0\"deb</code><code>http://archive.ulteo.com/ovd/4.0/debian</code><code>wheezy\u00a0main\"\u00a0&gt;\u00a0/etc/apt/sources.list.d/ulteo_ovd.list\u00a0&amp;&amp;\u00a0apt-get\u00a0update\u00a0&amp;&amp;\u00a0apt-get\u00a0-y\u00a0--force-yes\u00a0install\u00a0ulteo-keyring\u00a0&amp;&amp;\u00a0apt-get\u00a0update</code> <code>apt-get\u00a0-y\u00a0install\u00a0mysql-server</code></p> <p>V\u00e4lj rootl\u00f6senord</p> <p><code>mysql\u00a0-u\u00a0root\u00a0-p\u00a0-e\u00a0'create\u00a0database\u00a0ovd'</code> <code>apt-get\u00a0-y\u00a0install\u00a0ulteo-ovd-session-manager\u00a0ulteo-ovd-administration-console</code></p>"},{"location":"linux_services/Ulteo/#konfiguration","title":"Konfiguration","text":"<p>G\u00e5 sedan in p\u00e5:f\u00f6ljande och konfigurera databasen med root och pw som sattes tidigare.</p> <p><code>http://</code><code>/ovd/admin</code> <p>Forts\u00e4tt sedan i cli:t</p> <p><code>apt-get\u00a0-y\u00a0install\u00a0ulteo-ovd-subsystem\u00a0&amp;&amp;\u00a0apt-get\u00a0-y\u00a0install\u00a0ulteo-ovd-web-client</code></p> <p>Man skiljer p\u00e5 dessa f\u00f6r att den med s\u00e4kerhet ska ta en komponent i taget.</p> <p>Resten av upps\u00e4ttningen g\u00f6rs i det grafiska g\u00e4rnssnittet. G\u00e5 in p\u00e5: \"unregistered servers\" och v\u00e4lj att registrera localhost. S\u00e4tt sedan servern i \"production\"</p> <p>Skapa sedan din f\u00f6rsta user f\u00f6r att sedan v\u00e4lja den anv\u00e4ndaren i \"publication wizard\". Skapa en user-grupp och en application-grupp.</p> <p>Ulteo \u00e4r nu klart att anv\u00e4ndas.</p> <p><code>http://</code><code>/ovd</code>"},{"location":"linux_services/Ulteo/#terminator","title":"Terminator","text":"<p>Vad vore en linuxmaskin utan terminalemulator. Det f\u00f6ljer inte med n\u00e5gon default utan man f\u00e5r manuellt l\u00e4gga till det. H\u00e4r f\u00f6ljer instruktioner f\u00f6r hur man l\u00e4gger till terminator.</p> <p><code>chroot\u00a0/opt/ulteo</code> <code>apt-get\u00a0update</code> <code>apt-get\u00a0install\u00a0terminator</code></p> <p>Sedan kan man v\u00e4lja att publicera terminator som en applikation i webguit.</p>"},{"location":"linux_services/Vagrant/","title":"Vagrant","text":"<p>Vagrant \u00e4r program som skapar och konfigurerar virtuella utvecklingsmilj\u00f6er. Det kan ses som en h\u00f6gre niv\u00e5 av virtualisering \u00e4n VirtualBox, VMware, KVM och Linux Containers (LXC). Sedan version 1.6 har Vagrant inbyggt st\u00f6d f\u00f6r Docker containers.</p>"},{"location":"linux_services/Vagrant/#installation","title":"Installation","text":"<p>Fedora</p> <p><code>dnf\u00a0install\u00a0vagrant</code></p>"},{"location":"linux_services/Vagrant/#providers","title":"Providers","text":"<p>Vagrant g\u00f6r ingen virtualisering utan det g\u00f6rs av en underliggande provider, t.ex. virtualbox, vmware, AWS eller docker. Virtualbox \u00e4r default. En provider m\u00e5ste finnas tillg\u00e4nglig p\u00e5 maskinen d\u00e4r vagrant ska anv\u00e4ndas. Installera virtualbox:</p> <p><code>http://www.if-not-true-then-false.com/2010/install-virtualbox-with-yum-on-fedora-centos-red-hat-rhel/</code></p> <p>Providers installeras som plugins och listas med. F\u00f6r virtualbox beh\u00f6vs ingen plugin.</p> <p><code>vagrant\u00a0plugin\u00a0list</code></p>"},{"location":"linux_services/Vagrant/#vmware-workstation","title":"VMware Workstation","text":"<p>vagrant-vmware-workstation \u00e4r en kommersiell produkt och kr\u00e4ver licens.</p>"},{"location":"linux_services/Vagrant/#boxes","title":"Boxes","text":"<p>Ist\u00e4llet f\u00f6r att bygga en virtuell maskin fr\u00e5n grunden varje g\u00e5ng anv\u00e4nder Vagrant en grundimage f\u00f6r att snabbt klona en virtuell maskin. Dessa imagear kallas p\u00e5 Vagrantspr\u00e5k f\u00f6r boxes. Att ange vilken box som ska anv\u00e4ndas f\u00f6r din Vagrantmilj\u00f6 \u00e4r alltid det f\u00f6rsta steget n\u00e4r du ska skapa en ny Vagrantfile. Tillg\u00e4ngliga boxes: https://atlas.hashicorp.com/boxes/search</p> <p><code>vagrant\u00a0box\u00a0add\u00a0ubuntu/trusty64</code></p> <p>Boxes lagras i \\~/.vagrant.d/boxes/</p>"},{"location":"linux_services/Vagrant/#konfiguration","title":"Konfiguration","text":"<p>Generera Vagrantfile</p> <p><code>mkdir\u00a0vagrant\u00a0&amp;&amp;\u00a0cd\u00a0vagrant</code> <code>vagrant\u00a0init\u00a0ubuntu/trusty64</code></p> <p>Starta environment. Detta kommando startar milj\u00f6 utifr\u00e5n den Vagrantfile som finns det directory du k\u00f6r kommandot i.</p> <p><code>vagrant\u00a0up\u00a0--provider\u00a0virtualbox</code></p> <p>Anslut till den virtuella maskinen</p> <p><code>vagrant\u00a0ssh</code></p> <p>St\u00e4da</p> <p><code>vagrant\u00a0destroy</code></p> <p>Lista skapade vagrantmilj\u00f6er</p> <p><code>vagrant\u00a0global-status</code></p>"},{"location":"linux_services/Vagrant/#plugins","title":"Plugins","text":"<p>Det finns m\u00e5nga plugins till vagrant. http://vagrant-lists.github.io/</p>"},{"location":"linux_services/Vagrant/#vsphere","title":"vSphere","text":"<p>Se https://github.com/nsidc/vagrant-vsphere</p> <p>Category:Guider</p>"},{"location":"linux_services/Vsftpd/","title":"Vsftpd","text":"<p>Category:Guider VSFTPD (Very secure FTP daemon) \u00c4r en snabb och smidig FTP server f\u00f6r Unix system.</p>"},{"location":"linux_services/Vsftpd/#installation","title":"Installation","text":"<p>De flesta distar har vsftpd i sina standardrepos s\u00e5 vanligtvis \u00e4r det bara att k\u00f6ra en apt-get install vsftpd eller motsvarande med yum</p>"},{"location":"linux_services/Vsftpd/#konfiguration","title":"Konfiguration","text":"<p>I en Debianbaserad dist kommer du hitta konf filen i /etc/vsftpd.conf Det finns 5 v\u00e4rden att titta p\u00e5 direkt</p> <p><code>anonymous_enable=(YES/NO)\u00a0Om\u00a0du\u00a0vill\u00a0till\u00e5ta\u00a0anonyma\u00a0inloggningar\u00a0mot\u00a0FTPN</code> <code>local_enable=(YES/NO)\u00a0Om\u00a0lokala\u00a0anv\u00e4ndare\u00a0ska\u00a0kunna\u00a0anv\u00e4nda\u00a0FTP\u00a0tj\u00e4nsten</code> <code>write_enable=(YES/NO)\u00a0Om\u00a0anv\u00e4ndarna\u00a0ska\u00a0kunna\u00a0skriva\u00a0data\u00a0till\u00a0FTPn\u00a0eller\u00a0inte</code> <code>force_dot_files=(YES/NO)\u00a0Om\u00a0.\u00a0filer\u00a0ska\u00a0visas\u00a0i\u00a0FTPn\u00a0t.ex.\u00a0.htaccess</code> <code>hide_ids=(YES/NO)\u00a0Om\u00a0r\u00e4ttigheterna\u00a0p\u00e5\u00a0filer\u00a0ska\u00a0synas\u00a0p\u00e5\u00a0filerna.\u00a0Om\u00a0man\u00a0till\u00e5ter\u00a0anonyma\u00a0inloggningar\u00a0kan\u00a0det\u00a0vara\u00a0en\u00a0bra\u00a0id\u00e9\u00a0att\u00a0k\u00f6ra\u00a0p\u00e5\u00a0YES\u00a0s\u00e5\u00a0de\u00a0inte\u00a0kan\u00a0f\u00e5\u00a0ut\u00a0information\u00a0om\u00a0vilka\u00a0konton\u00a0som\u00a0finns\u00a0p\u00e5\u00a0servern.</code></p>"},{"location":"linux_services/Vsftpd/#chroot","title":"Chroot","text":"<p><code>chroot_local_user=(YES/NO)\u00a0Om\u00a0anv\u00e4ndarna\u00a0ska\u00a0vara\u00a0l\u00e5sta\u00a0till\u00a0sin\u00a0hemfolder\u00a0eller\u00a0inte</code> <code>chroot_list_enable=(YES/NO)\u00a0Om\u00a0du\u00a0vill\u00a0ange\u00a0en\u00a0lista\u00a0av\u00a0anv\u00e4ndare\u00a0som\u00a0ska\u00a0vara\u00a0tv\u00e4rtemot\u00a0vad\u00a0du\u00a0angav\u00a0i\u00a0chroot_local_user</code></p> <p>Om Chroot_list_enable=YES s\u00e5 f\u00e5r du skapa en lista i /etc/vsftpd.chroot_list d\u00e4r du skriver in usernamn p\u00e5 anv\u00e4ndarena som INTE ska f\u00f6lja chroot_local_user reglen.</p>"},{"location":"linux_services/Vsftpd/#tillatnadenekade-anvandare","title":"Till\u00e5tnade/nekade Anv\u00e4ndare","text":"<p>Om man har local_enable ig\u00e5ng i konfen kan det vara en bra id\u00e9 att inte l\u00e5ta t.ex. root och servicekonton logga in p\u00e5 FTPn. Det kan vi l\u00f6sa genom att l\u00e4gga till f\u00f6ljande rader i konfen</p> <p><code>userlist_deny=YES</code> <code>userlist_file=/etc/vsftpd.denied_users</code></p> <p>I userlist_file=/etc/vsftpd.denied_users skriver du sedan in anv\u00e4ndarnamn som inte ska f\u00e5 logga in via ftpn t.ex. postfix och root.</p>"},{"location":"linux_services/Vsftpd/#ssl","title":"SSL","text":"<p>Ganska straightforward conf h\u00e4r. Exemplet nedan \u00e4r fr\u00e5n en av Bats servrar</p> <p><code>ssl_enable=YES</code> <code>allow_anon_ssl=NO</code> <code>force_local_data_ssl=YES</code> <code>force_local_logins_ssl=YES</code> <code>ssl_tlsv1=YES</code> <code>ssl_sslv2=NO</code> <code>ssl_sslv3=NO</code></p>"},{"location":"linux_services/Vsftpd/#virtuela-anvandare","title":"Virtuela Anv\u00e4ndare","text":"<p>B\u00f6rja med att skapa en mapp f\u00f6r vsftpd om det inte finns i /etc/vftpd/ Skapa en fil med anv\u00e4ndare &amp; L\u00f6senord (nano users.txt) i stilen</p> <p><code>Anv\u00e4ndare1</code> <code>L\u00f6senord1</code> <code>Anv\u00e4ndare2</code> <code>L\u00f6senord2</code> <code>etc</code></p> <p>Skapa sedan en databas med anv\u00e4ndarna db_load -T -t hash -f users.txt vsftpd-virtual-user.db Gl\u00f6m inte att s\u00e4tta r\u00e4ttigheter och ta bort .txt filen efter\u00e5t.</p> <p>I /etc/vsftpd.conf s\u00e5 ska vi ocks\u00e5 g\u00f6ra n\u00e5gra \u00e4ndringar f\u00f6r att de virtuela anv\u00e4ndarna ska funka</p> <p><code>virtual_use_local_privs=(YES/NO)\u00a0Virtuella\u00a0anv\u00e4ndare\u00a0f\u00e5r\u00a0samma\u00a0r\u00e4ttigheter\u00a0som\u00a0vanliga\u00a0anv\u00e4ndare\u00a0annars\u00a0f\u00e5r\u00a0de\u00a0anon\u00a0r\u00e4ttigheter</code> <code>pam_service_name=vsftpd.virtual\u00a0Namnet\u00a0p\u00e5\u00a0pam\u00a0servicen\u00a0vi\u00a0vill\u00a0anv\u00e4nda</code> <code>guest_enable=YES\u00a0Till\u00e5ter\u00a0virtuella\u00a0anv\u00e4ndare</code> <code>local_root=/home/vftp/$USER\u00a0Vilken\u00a0mapp\u00a0de\u00a0virtuela\u00a0anv\u00e4ndarna\u00a0ska\u00a0ha\u00a0access\u00a0till</code> <code>user_sub_token=$USER\u00a0s\u00e4tter\u00a0deras\u00a0anv\u00e4ndarnamn\u00a0till\u00a0chrooten</code></p> <p>D\u00e5 ska vi bara fixa lite med PAM sen \u00e4r vi good to go nano /etc/pam.d/vsftpd.virtual</p> <p><code>#%PAM-1.0</code> <code>auth\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0required\u00a0\u00a0\u00a0\u00a0\u00a0pam_userdb.so\u00a0db=/etc/vsftpd/vsftpd-virtual-user</code> <code>account\u00a0\u00a0\u00a0\u00a0required\u00a0\u00a0\u00a0\u00a0\u00a0pam_userdb.so\u00a0db=/etc/vsftpd/vsftpd-virtual-user</code> <code>session\u00a0\u00a0\u00a0\u00a0required\u00a0\u00a0\u00a0\u00a0\u00a0pam_loginuid.so</code></p> <p>Sen \u00e4r det bara att skapa foldrarna f\u00f6r anv\u00e4ndarna i /home/vftp/ Foldrarna b\u00f6r \u00e4gas av samma anv\u00e4ndare som tj\u00e4nsten k\u00f6rs ifr\u00e5n d\u00e5 anv\u00e4ndarna anv\u00e4nder tj\u00e4nstens permissions.</p>"},{"location":"linux_services/Vsftpd/#ldap","title":"LDAP","text":"<p>K\u00f6r med pam_ldap f\u00e5r skriva mer senare</p>"},{"location":"linux_services/Weechat/","title":"Weechat","text":"<p>Category:Guider WeeChat \u00e4r en terminalbaserad Internet Relay Chat (IRC) klient. WeeChat \u00e4r skriven i C, och \u00e4r gjord f\u00f6r att vara flexibel och utbyggbar. WeeChat har alla m\u00f6jliga plugins skrivna i olika spr\u00e5k t.ex. Python, Perl, och Ruby.</p>"},{"location":"linux_services/Weechat/#installation","title":"Installation","text":"<p>Exempel: Ubuntu 18.04</p> <p><code>sudo\u00a0apt-key\u00a0adv\u00a0--keyserver\u00a0hkp://p80.pool.sks-keyservers.net:80\u00a0--recv-keys\u00a011E9DE8848F2B65222AA75B8D1820DB22A11534E</code> <code>sudo\u00a0apt-get\u00a0install\u00a0apt-transport-https</code> <code>echo\u00a0\"deb</code><code>https://weechat.org/ubuntu</code><code>bionic\u00a0main\"\u00a0|\u00a0sudo\u00a0tee\u00a0/etc/apt/sources.list.d/weechat.list</code> <code>sudo\u00a0apt-get\u00a0update\u00a0&amp;&amp;\u00a0sudo\u00a0apt-get\u00a0-y\u00a0install\u00a0weechat\u00a0weechat-scripts</code></p> <p>Anv\u00e4nd Tmux och Systemd f\u00f6r att f\u00e5 weechat som en bakgrundstj\u00e4nst med autostart.</p> <pre><code>sudo dd of=/etc/systemd/system/weechat.service &lt;&lt; EOF\n[Unit]\nDescription=Weechat IRC Client (in tmux)\n\n[Service]\nUser=$USER\nType=forking\nExecStart=/usr/bin/tmux -2 new-session -d -s weechat /usr/bin/weechat\nExecStop=/usr/bin/tmux kill-session -t weechat\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\nsudo systemctl enable weechat\n</code></pre>"},{"location":"linux_services/Weechat/#konfiguration","title":"Konfiguration","text":"<p>Starta Weechat och l\u00e4gg in grundl\u00e4ggande konfiguration. Gl\u00f6m inte att spara efter varje inst\u00e4llning du g\u00f6r som du vill ska finnas kvar efter reboot.</p> <p><code>sudo\u00a0systemctl\u00a0start\u00a0weechat\u00a0&amp;&amp;\u00a0tmux\u00a0attach</code></p> <p><code>/set\u00a0irc.server_default.nicks\u00a0\"HorseBoy_92\"</code> <code>/set\u00a0irc.server_default.realname\u00a0\"John\u00a0Smith\"</code> <code>/save</code></p>"},{"location":"linux_services/Weechat/#anslut-till-irc-natverk","title":"Anslut till irc-n\u00e4tverk","text":"<p>Basic exempel:</p> <p><code>/server\u00a0add\u00a0freenode\u00a0irc.freenode.net/6667\u00a0-autoconnect</code> <code>/set\u00a0irc.server.freenode.autojoin\u00a0\"#FreeNAS,#cisco,#pfsense\"</code></p> <p>Exempel med password och self-signed cert server side.</p> <p><code>/server\u00a0add\u00a0hacker\u00a0irc1.hacker.se/6667\u00a0-password=noes\u00a0-ssl\u00a0-autoconnect</code> <code>/set\u00a0irc.server.hacker.ssl_verify\u00a0off</code> <code>/save</code></p> <p>Anslut till n\u00e4sta IRC server.</p> <p><code>/reconnect\u00a0freenode\u00a0-switch</code></p>"},{"location":"linux_services/Weechat/#script","title":"Script","text":"<p><code>/script</code> <code>/script\u00a0install\u00a0keepnick.py</code></p>"},{"location":"linux_services/Weechat/#angra-installning","title":"\u00c5ngra inst\u00e4llning","text":"<p>Alla kommandon som b\u00f6rjar med /set kan man k\u00f6ra /unset p\u00e5.</p> <p><code>/unset</code>"},{"location":"linux_services/Weechat/#relay","title":"Relay","text":"<p>Relay beh\u00f6vs f\u00f6r tex glowing-bear, se nedan.</p> <p><code>/set\u00a0relay.network.password\u00a0secretpw</code> <code>/relay\u00a0add\u00a0weechat\u00a09001</code></p> <p>Vet ej vilken av f\u00f6ljande tv\u00e5 som beh\u00f6vs f\u00f6r att till\u00e5ta klienter fr\u00e5n ett annat n\u00e4t \u00e4n samma som weechatservern.</p> <p><code>/set\u00a0relay.network.allowed_ips\u00a0*</code> <code>/set\u00a0relay.network.websocket_allowed_origins\u00a0*</code></p> <p>Weechat relay lyssnar default efter IPv6. F\u00f6r att st\u00e4nga av.</p> <p><code>/set\u00a0relay.network.ipv6\u00a0off</code></p>"},{"location":"linux_services/Weechat/#skicka-ett-kommando-nar-du-ansluter","title":"Skicka ett kommando n\u00e4r du ansluter.","text":"<p><code>/set\u00a0irc.server.quakenet.command\u00a0\"/MSG\u00a0Q@CServe.quakenet.org\u00a0AUTH\u00a0USERNAME\u00a0PASSWORD\"</code></p>"},{"location":"linux_services/Weechat/#filter","title":"Filter","text":"<p>Filter kan anv\u00e4ndas f\u00f6r att slippa se vissa ord, anv\u00e4ndare eller meddelande.</p> <p>F\u00f6r att filtrera bort join/part/quit-meddelanden.</p> <p><code>/set\u00a0irc.look.smart_filter\u00a0on</code> <code>/filter\u00a0add\u00a0joinquit\u00a0*.freenode.*\u00a0irc_join,irc_part,irc_quit\u00a0*</code></p>"},{"location":"linux_services/Weechat/#fish","title":"Fish","text":"<p><code>aptitude\u00a0install\u00a0python-crypto</code> <code>/script\u00a0install\u00a0fish.py</code> <code>/set\u00a0fish.look.mark_encrypted\u00a0\".\"</code> <code>/set\u00a0fish.look.mark_position\u00a0off|begin|end</code></p> <p><code>DH1080:\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0/blowkey\u00a0exchange\u00a0nick</code> <code>Set\u00a0the\u00a0key\u00a0for\u00a0a\u00a0channel:\u00a0/blowkey\u00a0set\u00a0-server\u00a0freenet\u00a0#blowfish\u00a0key</code> <code>Remove\u00a0the\u00a0key:\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0/blowkey\u00a0remove\u00a0#blowfish</code> <code>Set\u00a0the\u00a0key\u00a0for\u00a0a\u00a0query:\u00a0\u00a0\u00a0/blowkey\u00a0set\u00a0nick\u00a0secret+key</code> <code>List\u00a0all\u00a0keys:\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0/blowkey</code></p>"},{"location":"linux_services/Weechat/#glowing-bear","title":"Glowing Bear","text":"<p>Glowing Bear \u00e4r en webb-frontend f\u00f6r weechat, byggd i html5. Man beh\u00f6ver aldrig sk\u00f6ta n\u00e5got underh\u00e5ll utav Glowing Bear, utan koden h\u00e4mtas av din webbl\u00e4sare fr\u00e5n deras servrar varje g\u00e5ng man anv\u00e4nder det. Kr\u00e4ver att man k\u00f6r Weechat version 0.4.2 eller h\u00f6gre. En relay beh\u00f6vs f\u00f6r att glowing bear ska fungera, se ovan. Anslut sedan p\u00e5 glowing bear sidan mot IP eller DNS-namn. Notera att detta kan vara en intern IP.</p> <p>L\u00e4nk http L\u00e4nk https</p>"},{"location":"linux_services/Weechat/#ssl","title":"SSL","text":"<p>F\u00f6r att kryptera trafiken mellan din webbl\u00e4sare och din weechat relay s\u00e5 anv\u00e4nd SSL.</p>"},{"location":"linux_services/Weechat/#skapa-eget-cert","title":"Skapa eget cert","text":"<p><code>mkdir\u00a0-p\u00a0~/.weechat/ssl\u00a0&amp;&amp;\u00a0cd\u00a0~/.weechat/ssl</code> <code>openssl\u00a0req\u00a0-nodes\u00a0-newkey\u00a0rsa:4096\u00a0-keyout\u00a0relay.pem\u00a0-x509\u00a0-days\u00a03650\u00a0-out\u00a0relay.pem\u00a0-subj\u00a0\"/CN=glowing.fu.se/\"</code></p> <p><code>/set\u00a0relay.network.password\u00a0secretpw</code> <code>/relay\u00a0sslcertkey</code> <code>/relay\u00a0add\u00a0ssl.weechat\u00a09001</code></p>"},{"location":"linux_services/Weechat/#lets-encrypt","title":"Let's Encrypt","text":"<p>Weechat kan anv\u00e4nda cert som \u00e4r signade med Let's Encrypt.</p> <p><code>mkdir\u00a0-p\u00a0~/.weechat/ssl</code> <code>cat\u00a0cert.pem\u00a0&gt;\u00a0~/.weechat/ssl/relay.pem\u00a0&amp;&amp;\u00a0cat\u00a0chain.pem\u00a0&gt;&gt;\u00a0~/.weechat/ssl/relay.pem\u00a0&amp;&amp;\u00a0cat\u00a0privkey.pem\u00a0&gt;&gt;\u00a0~/.weechat/ssl/relay.pem</code> <code>/set\u00a0relay.network.password\u00a0secretpw</code> <code>/relay\u00a0sslcertkey</code> <code>/relay\u00a0add\u00a0ssl.weechat\u00a09001</code></p> <p>F\u00f6r att ladda om SSL certet.</p> <p><code>/relay\u00a0sslcertkey</code></p>"},{"location":"linux_services/Weechat/#bakom-reverse-proxy","title":"Bakom Reverse Proxy","text":"<p>F\u00f6r att k\u00f6ra glowing bear genom en Nginx/Apache HTTP reverse proxy m\u00e5ste man k\u00f6ra det som en websocket, inte en HTTP-anslutning (\"Upgrade\").</p> <p>Nginx.</p> <pre><code>limit_req_zone $binary_remote_addr zone=weechat:10m rate=5r/m;\n\nserver {\n        [... other config...]\n\n        location /weechat {\n            proxy_pass http://localhost:9001/weechat;\n            proxy_http_version 1.1;\n            proxy_set_header Upgrade $http_upgrade;\n            proxy_set_header Connection \"Upgrade\";\n            proxy_read_timeout 604800;\n            proxy_set_header X-Real-IP $remote_addr;\n            limit_req zone=weechat burst=1 nodelay;\n        }\n}\n</code></pre> <p>Apache</p> <pre><code> &lt;IfModule mod_proxy.c&gt;\n     ProxyVia On\n     ProxyRequests Off\n     ProxyPreserveHost off\n\n     #Websocket\n     ProxyPass / ws://10.0.0.10:9001/\n     ProxyPassReverse / ws://10.0.0.10:9001/\n &lt;Proxy *&gt;\n</code></pre>"},{"location":"linux_services/Xming/","title":"Xming","text":"<p>Xming \u00e4r en X server f\u00f6r Windows. Med Xming kan k\u00f6ra program som kr\u00e4ver X \u00f6ver SSH med hj\u00e4lp av tex PuTTy.</p> <p>Xming kan vara sk\u00f6nt att k\u00f6ra n\u00e4r man inte vill s\u00e4tta upp SSH tunnlar.</p>"},{"location":"linux_services/Xming/#installation","title":"Installation","text":"<p>Ladda hem Xming.</p> <p>Default p\u00e5 allt fungerar bra. Jag v\u00e4ljer att installera utan SSH klient. V\u00e4lj sedan att starta Xming.</p>"},{"location":"linux_services/Xming/#konfiguration","title":"Konfiguration","text":"<p>\u00d6ppna PuTTy, under Connection --&gt; SSH --&gt; X11.</p> <p>V\u00e4lj Enable X11 forwarding.</p> <p>I f\u00e4ltet X display location skriv, <code>localhost:0</code></p> <p>Testa nu att ansluta till en server och skriv,</p> <p><code>echo\u00a0$DISPLAY</code></p> <p>D\u00e5 b\u00f6r du f\u00e5 ett svar i stil med <code>localhost:10.0</code> Annars dubbelkolla att X11Forwarding Yes \u00e4r konfat i /etc/ssh/sshd_config</p>"},{"location":"linux_services/Xming/#tips-and-tricks","title":"Tips and tricks","text":""},{"location":"linux_services/Xming/#starta-fler-an-ett-program-fran-samma-skal","title":"Starta fler \u00e4n ett program fr\u00e5n samma skal.","text":"<p>Skriv ett <code>&amp;</code> efter kommandot.</p> <p><code>firefox\u00a0&amp;</code></p>"},{"location":"linux_services/Xming/#for-att-inte-tappa-x11-forwarding-om-man-sshar-till-en-annan-maskin","title":"F\u00f6r att inte tappa X11 forwarding om man SSHar till en annan maskin.","text":"<p>X11 forward inst\u00e4llningen f\u00f6ljer inte med default om man SSHar till en annan maskin fr\u00e5n sin f\u00f6rsta om man inte anger ett stort X i SSH kommandot.</p> <p><code>ssh\u00a0-X</code>"},{"location":"linux_services/Xming/#tips-pa-bra-program-som-funkar-utmark-med-x11-forward","title":"Tips p\u00e5 bra program som funkar utm\u00e4rk med X11 forward.","text":"<p>vncviewer - VNC klient.</p> <p>rdesktop - RDP klient.</p> <p>Wireshark - Lyssna p\u00e5 paket.</p> <p>Firefox - Webbl\u00e4sare</p> <p>Category:Guider</p>"},{"location":"linux_services/ZFS/","title":"ZFS","text":"<p>ZFS \u00e4r filsystem kombinerat med volymhanterare. Det k\u00f6rs fr\u00e4mst p\u00e5 BSD men finns \u00e4ven till Linux.</p>"},{"location":"linux_services/ZFS/#installation","title":"Installation","text":"<p>Ubuntu 16.04 onwards</p> <p><code>sudo\u00a0apt-get\u00a0update\u00a0&amp;&amp;\u00a0sudo\u00a0apt-get\u00a0-y\u00a0install\u00a0zfs</code></p> <p>Fedora</p> <p><code>sudo\u00a0dnf\u00a0install\u00a0--nogpgcheck</code>[<code>http://archive.zfsonlinux.org/fedora/zfs-release$(rpm</code>](http://archive.zfsonlinux.org/fedora/zfs-release$(rpm)<code>-E\u00a0%dist).noarch.rpm</code> <code>sudo\u00a0dnf\u00a0install\u00a0kernel-devel\u00a0zfs</code> <code>sudo\u00a0/sbin/modprobe\u00a0zfs</code></p> <p>Debian</p> <p><code>su\u00a0-</code> <code>apt-get\u00a0install\u00a0lsb-release</code> <code>wget</code><code>http://archive.zfsonlinux.org/debian/pool/main/z/zfsonlinux/zfsonlinux_6_all.deb</code> <code>dpkg\u00a0-i\u00a0zfsonlinux_6_all.deb</code> <code>apt-get\u00a0update\u00a0&amp;&amp;\u00a0apt-get\u00a0install\u00a0debian-zfs</code></p>"},{"location":"linux_services/ZFS/#konfiguration","title":"Konfiguration","text":""},{"location":"linux_services/ZFS/#pool","title":"Pool","text":"<p><code>zpool\u00a0create\u00a0POOL\u00a0raidz1\u00a0\\</code> <code>/dev/disk/by-id/ata-WDC_WD..\u00a0\\</code> <code>/dev/disk/by-id/ata-WDC_WD..\u00a0\\</code> <code>/dev/disk/by-id/ata-WDC_WD..\u00a0\\</code> <code>-o\u00a0ashift=12\u00a0-o\u00a0failmode=continue</code></p> <p>L\u00e4gg till -f om det inte finns n\u00e5gon EFI label.</p> <p><code>zfs\u00a0set\u00a0atime=off\u00a0POOL</code></p> <p>Show-kommandon.</p> <p><code>zpool\u00a0list</code> <code>zpool\u00a0status</code> <code>zfs\u00a0get\u00a0all</code> <code>zpool\u00a0iostat\u00a0-v\u00a0POOL</code></p> <p>Radera en pool.</p> <p><code>zpool\u00a0destroy\u00a0POOL</code></p> <p>\u00c5terst\u00e4ll raderad pool.</p> <p><code>zpool\u00a0import\u00a0-D\u00a0POOL</code></p>"},{"location":"linux_services/ZFS/#mount-point","title":"Mount point","text":"<p><code>zfs\u00a0set\u00a0mountpoint=/path/pool\u00a0POOL</code> <code>chown\u00a0-R\u00a0user:user\u00a0/path/pool</code></p>"},{"location":"linux_services/ZFS/#dataset","title":"Dataset","text":"<p><code>zfs\u00a0create\u00a0POOL/test</code></p> <p>Kompression.</p> <p><code>zfs\u00a0set\u00a0compression=on\u00a0POOL/test</code></p> <p>Deduplicering.</p> <p><code>zfs\u00a0set\u00a0dedup=on\u00a0POOL/test</code></p> <p>Radera dataset.</p> <p><code>zfs\u00a0destroy\u00a0POOL/test</code></p>"},{"location":"linux_services/ZFS/#l2arc","title":"L2ARC","text":"<p>Level 2 Adjustable Replacement Cache (L2ARC), \u00e4r en ut\u00f6kning av den read cache (ARC) som finns i RAM.</p> <p><code>zpool\u00a0add\u00a0-f\u00a0POOL\u00a0cache\u00a0sdf</code></p>"},{"location":"linux_services/ZFS/#zil-slog","title":"ZIL &amp; SLOG","text":"<p>ZFS Intent Log (ZIL) g\u00e5r att likna vid journalen i ett journalf\u00f6rande filsystem. Synkrona skrivningar skrivs alltid till ZIL f\u00f6rst och flushas senare till poolen vid fasta intervall. En Separate Intent Log (SLOG) i form av SSD rekommenderas f\u00f6r \u00f6kad prestanda vid synkrona skrivningar. ZIL \u00e4r ingen write cache utan anv\u00e4nds enbart som ett skydd mot dataf\u00f6rlust, den enda prestanda\u00f6kningen r\u00f6r synkrona skrivningar som utan en SLOG hade skrivits tv\u00e5 g\u00e5nger till samma disk d\u00e5 ZIL befunnit sig inuti den pool dit data skrivs.</p> <p><code>zpool\u00a0add\u00a0-f\u00a0POOL\u00a0log\u00a0sdg</code></p> <p>Om man \u00e4r extra r\u00e4dd om sin data kan man tvinga alla skrivningar att g\u00e5 genom ZIL med kommandot nedan. Det g\u00e5r att st\u00e4lla p\u00e5 enskilda dataset eller hela pooler om s\u00e5 \u00f6nskas.</p> <p><code>zfs\u00a0set\u00a0sync=always\u00a0POOL/test</code></p> <p>Det g\u00e5r \u00e4ven att st\u00e4nga av ZIL helt om man inte bryr sig om dataintegritet (samma syntax som ovan fast disable ist\u00e4llet f\u00f6r always, standard \u00e4r default).</p>"},{"location":"linux_services/ZFS/#underhall","title":"Underh\u00e5ll","text":""},{"location":"linux_services/ZFS/#scrub","title":"Scrub","text":"<p>Scrubbing anv\u00e4nds i ZFS f\u00f6r att bibeh\u00e5lla dataintegritet och fixa eventuella fel p\u00e5 diskarna i din pool. Detta sker inte per automatik utan m\u00e5ste triggas, cronjob rekommenderas starkt. Rekommendationen som finns f\u00f6r frekvens av scrubbing p\u00e5 Solaris f\u00f6r enterprise- och konsumentdiskar \u00e4r en g\u00e5ng i m\u00e5naden resp. en g\u00e5ng i veckan.</p> <p><code>zpool\u00a0scrub</code></p> <p>IO intensive</p>"},{"location":"linux_services/ZFS/#snapshots","title":"Snapshots","text":"<p>Snapshot kan tas b\u00e5de p\u00e5 pools och datasets, varje snapshot kr\u00e4ver ett unikt namn.</p> <p>Dataset snapshot.</p> <p><code>zfs\u00a0snapshot\u00a0POOL/test@NAME</code></p> <p>Pool snapshot.</p> <p><code>zfs\u00a0snapshot\u00a0POOL@NAME</code></p> <p>Lista snapshots.</p> <p><code>zfs\u00a0list\u00a0-t\u00a0snapshot</code></p> <p>Rollback till snapshot.</p> <p><code>zfs\u00a0rollback\u00a0POOL/test@NAME</code></p> <p>Ta bort snapshot.</p> <p><code>zfs\u00a0destroy\u00a0POOL/test@NAME</code></p> <p>Automatiska snapshots Det finns ett antal olika paket/skript f\u00f6r att sk\u00f6ta automatisering av snapshots f\u00f6r ZFS. H\u00e4r beskrivs anv\u00e4ndning av det cron-baserade zfs-auto-snapshot som skapats av ZFS on Linux-utvecklarna. Nedan f\u00f6ljer ett antal kommandon f\u00f6r justering av frekvens och historik:</p> <p><code>zfs set com.sun:auto-snapshot=true POOL/test</code> Enable/disable av automatiska snapshots p\u00e5 ett dataset.</p> <p><code>zfs set com.sun:auto-snapshot:monthly=false POOL/test</code> Enable/disable av m\u00e5natliga snapshots, som mest bevaras tolv snapshots.</p> <p><code>zfs set com.sun:auto-snapshot:weekly=false POOL/test</code> Enable/disable av veckovisa snapshots, som mest bevaras \u00e5tta snapshots.</p> <p><code>zfs set com.sun:auto-snapshot:daily=true POOL/test</code> Enable/disable av dagliga snapshots, som mest bevaras 31 snapshots.</p> <p><code>zfs set com.sun:auto-snapshot:hourly=false POOL/test</code> Enable/disable av snapshots varje timme, som mest bevaras 24 snapshots.</p> <p><code>zfs set com.sun:auto-snapshot:frequent=false POOL/test</code> Enable/disable av snapshots varje kvart, som mest bevaras fyra snapshots.</p> <p>F\u00f6r att \u00e4ndra t ex antal sparade snapshots f\u00e5r man editera de medf\u00f6ljande cron-jobb som installeras tillsammans med zfs-auto-snapshot, v\u00e4xeln som anv\u00e4nds f\u00f6r att st\u00e4lla just detta \u00e4r <code>--keep=X</code>.</p>"},{"location":"linux_services/ZFS/#byta-disk","title":"Byta disk","text":"<p>Det g\u00e5r att starta en replace av disk oavsett om disken i fr\u00e5ga fortfarande \u00e4r online eller om den tagits bort fr\u00e5n systemet. Men innan du b\u00f6rjar, k\u00f6r en scrub f\u00f6r att garantera att poolen \u00e4r intakt!</p> <p>\u00c4r disk1 online kommer kommandot nedan att attach:a disk2 till poolen och starta en resilver (rebuild, f\u00f6r den som inte talar ZFS) av data p\u00e5 den nya; disk2. N\u00e4r disk1 \u00e4r redo att tas bort detach:as den automatiskt fr\u00e5n poolen. Om disk1 inte \u00e4r tillg\u00e4nglig \u00e4r det samma f\u00f6rfarande f\u00f6r att g\u00f6ra en replace. Det \u00e4r dock m\u00f6jligt att strunta i att ange den nya diskens namn eftersom ZFS antar att den nya disken sitter p\u00e5 samma plats som den f\u00f6rra (/dev/sdX) och konfigurerar den d\u00e5 automatiskt. Om disk-ID anv\u00e4nds f\u00f6r att referera till diskarna i poolen m\u00e5ste dock den nya disken specificeras med sin path. Poolens namn p\u00e5 disken \u00e4ndras d\u00e5 disken \u00e4r fr\u00e5nvarande, f\u00f6r att ta reda p\u00e5 vad disk1 heter ist\u00e4llet anv\u00e4nds i vanlig ordning <code>zpool status</code>.</p> <p><code>zpool\u00a0replace\u00a0POOL\u00a0disk1\u00a0disk2</code></p> <p>F\u00e5r du ett felmeddelande som s\u00e4ger \"disk2 does not contain an EFI label but it may contain partition information in the MBR\" b\u00f6r det r\u00e4cka att skapa en GPT-tabell p\u00e5 disken med t ex. parted. V\u00e4nta p\u00e5 att resilvering k\u00f6rs f\u00e4rdigt, kolla status med <code>zpool status</code>.</p>"},{"location":"linux_services/ZFS/#tipsntrix","title":"Tips'N'Trix","text":""},{"location":"linux_services/ZFS/#byte-fran-devsdx-till-disk-id","title":"Byte fr\u00e5n \"/dev/sdX\" till disk-ID","text":"<p>Om du gjort misstaget att tilldela din pool diskar med hj\u00e4lp av disknamn (/dev/sdX) och i efterhand vill byta till det mer konsekventa disk-ID finns en enkel l\u00f6sning, helt utan dataf\u00f6rlust. G\u00f6r s\u00e5h\u00e4r:</p> <p>Exportera din pool, poolen tas nu bort fr\u00e5n systemet i f\u00f6rberedelse f\u00f6r \"flytten\".</p> <p><code>zpool\u00a0export\u00a0POOL</code></p> <p>Importera poolen fr\u00e5n /dev/disk/by-id.</p> <p><code>zpool\u00a0import\u00a0-d\u00a0/dev/disk/by-id\u00a0POOL</code></p> <p>Verifiera att poolen \u00e4r tillbaks och att diskarna i poolen refereras med sitt ID ist\u00e4llet f\u00f6r \"sdX\" med <code>zpool status</code>.</p> <p>Category:Guider</p>"},{"location":"linux_tools/Apt/","title":"Apt","text":"<p>Apt st\u00e5r f\u00f6r Advanced Package Tool och \u00e4r ett user interface f\u00f6r installera och ta bort program p\u00e5 Linux. Apt var fr\u00e5n b\u00f6rjan ett user-interface mot dpkg (Debian package) men har sedan dess modifierats att fungera p\u00e5 RPM baserade system som Red hat tex. Apt f\u00f6ljer med fr\u00e5n start p\u00e5 alla Debian-baserade distar.</p>"},{"location":"linux_tools/Apt/#file-locations","title":"File locations","text":"<ul> <li>/etc/apt/sources.list: Locations to fetch packages from.</li> <li>/etc/apt/apt.conf: APT configuration file.</li> <li>/etc/apt/preferences: \"pinning\", i.e. a preference to get certain     packages from a separate source or from a different version of a     distribution.</li> <li>/var/cache/apt/archives/: storage area for retrieved package files.</li> </ul>"},{"location":"linux_tools/Apt/#kommandon","title":"Kommandon","text":"<p>Apt \u00e4r en programsvit med flera olika program f\u00f6r att managera dina program.</p> <p>Lista installerade paket och deras versioner:</p> <p><code>apt\u00a0list\u00a0--installed</code></p>"},{"location":"linux_tools/Apt/#apt-get","title":"apt-get","text":"<p>Apt-get \u00e4r programmet som tar hand om nerladdning och installation av ett program.</p>"},{"location":"linux_tools/Apt/#update","title":"update","text":"<p>Uppdatera din lista med paket.</p> <p><code>apt-get\u00a0update</code></p>"},{"location":"linux_tools/Apt/#install","title":"install","text":"<p>Installera ett paket. H\u00e4mtar alltid senaste versionen som finns i din lista.</p> <p><code>apt-get\u00a0install</code> <p>Installera en specifik version av ett program. Mer info p\u00e5 apt-cache show om hur du ser vilka versioner som finns.</p> <p><code>apt-get\u00a0install</code><code>=</code>"},{"location":"linux_tools/Apt/#upgrade","title":"upgrade","text":"<p>Kolla om det finns en ny version av ett program du har installerat och uppgradera det.</p> <p><code>apt-get\u00a0upgrade</code> <code>apt-get\u00a0-s\u00a0upgrade\u00a0#Dry\u00a0run</code></p> <p>F\u00f6r att uppgradera hela din dist fr\u00e5n tex Debian 7 till Debian 8 k\u00f6r.</p> <p><code>apt-get\u00a0dist-upgrade</code></p>"},{"location":"linux_tools/Apt/#remove","title":"remove","text":"<p>Ta bort ett program. Config filer finns fortfarande kvar.</p> <p><code>apt-get\u00a0remove</code> <p>Ta bort ett program och config filer.</p> <p><code>apt-get\u00a0purge</code> <p>Oftast s\u00e5 \u00e4r ett paket beroende av ett annat paket f\u00f6r att fungera och d\u00e5 installeras det paketet ocks\u00e5. Men sen om du v\u00e4ljer att ta bort paketet du ville installera s\u00e5 finns fortfarande dom andra paketen kvar. Om du vill ta bort paket som inte beh\u00f6vs s\u00e5 k\u00f6r.</p> <p><code>apt-get\u00a0autoremove</code></p>"},{"location":"linux_tools/Apt/#apt-cache","title":"apt-cache","text":"<p>apt-cache \u00e4r ett program f\u00f6r att s\u00f6ka och f\u00e5 fram information om ett paket i din lista.</p>"},{"location":"linux_tools/Apt/#search","title":"search","text":"<p>F\u00f6r att s\u00f6ka efter program.</p> <p><code>apt-cache\u00a0search</code>"},{"location":"linux_tools/Apt/#show","title":"show","text":"<p>F\u00e5 en kort beskrivning av ett program. Samt vilka olika versioner som finns att h\u00e4mta.</p> <p><code>apt-cache\u00a0show</code> <p>F\u00f6r att endast se vilka versioner det finns av ett program.</p> <p><code>apt-cache\u00a0show</code><code>|\u00a0grep\u00a0Versions:</code>"},{"location":"linux_tools/Apt/#showpkg","title":"showpkg","text":"<p>Ta p\u00e5 mer information om ett program. Tex vilka versioner finns att h\u00e4mta, vilka program den \u00e4r beroende av och vilka program som \u00e4r beroende av den.</p> <p><code>apt-cache\u00a0showpkg</code>"},{"location":"linux_tools/Apt/#apt-mark","title":"apt-mark","text":"<p>Best\u00e4mmer ett program/pakets framtid.</p>"},{"location":"linux_tools/Apt/#hold","title":"hold","text":"<p>Markerar ett paket s\u00e5 det inte kan bli automatiskt installerat, uppgraderat eller tas bort.</p> <p><code>apt-mark\u00a0hold</code>"},{"location":"linux_tools/Apt/#unhold","title":"unhold","text":"<p>Tv\u00e4rtemot hold.</p> <p><code>apt-mark\u00a0unhold</code>"},{"location":"linux_tools/Apt/#auto","title":"auto","text":"<p>Markerar att ett paket blivit installerat automatiskt. Paketet kommer d\u00e5 att tas bort automatiskt n\u00e4r inget paket som installerats manuellt finns kvar.</p> <p><code>apt-mark\u00a0auto</code>"},{"location":"linux_tools/Apt/#manual","title":"manual","text":"<p>Markerar ett paket som att det blivit installerat manuellt. Paketet kommer inte tas bort automatiskt.</p> <p><code>apt-mark\u00a0manual</code>"},{"location":"linux_tools/Apt/#show_1","title":"show","text":"<p>Tre kommandon d\u00e4r man ser p\u00e5 namnet vad som h\u00e4nder.</p> <p><code>apt-mark\u00a0showauto</code> <code>apt-mark\u00a0showmanual</code> <code>apt-mark\u00a0showhold</code></p>"},{"location":"linux_tools/Apt/#apt-proxy","title":"Apt Proxy","text":"<p>F\u00f6r att spara bandbredd kan man s\u00e4tta upp en egen cache av Ubuntus repo och peka sina servrar mot den. P\u00e5 cachen:</p> <p><code>sudo\u00a0apt-get\u00a0install\u00a0apt-cacher-ng</code></p> <p>P\u00e5 \u00f6vriga maskiner</p> <p><code>sudo\u00a0nano\u00a0/etc/apt/apt.conf</code> <code>Acquire::http\u00a0{\u00a0Proxy\u00a0\"</code><code>http://10.0.0.500:3142</code><code>\";\u00a0};</code></p>"},{"location":"linux_tools/Apt/#ansible","title":"Ansible","text":"<p>Ansible update-playbook</p> <pre><code>---\n- hosts: servers\n  sudo: true\n  tasks:\n   - name: apt-get update\n     apt: update_cache=yes\n   - name: apt-get upgrade\n     apt: upgrade=full\n   - name: apt-get --dry-run autoremove\n     command: apt-get --dry-run autoremove\n     register: check_autoremove\n     changed_when: False\n   - name: apt-get autoremove\n     command: apt-get -y autoremove\n     when: \"'packages will be REMOVED' in check_autoremove.stdout\"\n</code></pre> <p>Category:Tools</p>"},{"location":"linux_tools/Bash/","title":"Bash","text":"<p>Bash \u00e4r den allra vanligaste kommandotolken man m\u00f6ts av i Linux.</p>"},{"location":"linux_tools/Bash/#bash-sensible","title":"Bash sensible","text":"<p>[https://github.com/mrzool/bash-sensible| Bash sensible] \u00e4r ett script som f\u00f6rs\u00f6ker s\u00e4tta b\u00e4ttre bash default inst\u00e4llningar. Precis som Vim sensible f\u00f6rs\u00f6ker g\u00f6ra \u00e5t vim.</p> <p>Sensible fixar bla hur bash hanterar history</p> <ul> <li>Adderar till historiken ist\u00e4llet f\u00f6r att skriva \u00f6ver.</li> <li>Sparar multi-line kommandon som ett kommando.</li> <li>St\u00f6rre historik.</li> <li>Tar bort dubbletter.</li> <li>Sparar inte on\u00f6diga kommandon som exit, ls, bg, fg och history.</li> </ul> <p><code>git\u00a0clone</code><code>https://github.com/mrzool/bash-sensible/blob/master/sensible.bash</code></p> <p>F\u00f6r att installera kan man kopiera hela sensible.bash eller delar av filen in i sin bashrc fil eller source in filen i sin bashrc fil:</p> <pre><code>if [ -f ~/bash-sensible/sensible.bash ]; then\n   source ~/bash-sensible/sensible.bash\nfi\n</code></pre>"},{"location":"linux_tools/Bash/#awesome-bash","title":"Awesome bash","text":"<p>Awesome bash \u00e4r en lista med massa l\u00e4nkar till olika bash saker. Allt fr\u00e5n b\u00f6cker, custom environment, frameworks, spel.</p> <p><code>https://github.com/awesome-lists/awesome-bash</code></p>"},{"location":"linux_tools/Bash/#bash-scripting","title":"Bash scripting","text":"<p>Att skriva bash script kan vara v\u00e4ldigt enkelt och kan spara mycket tid, h\u00e4r under kommer en del tips som kan vara bra att k\u00e4nna till.</p>"},{"location":"linux_tools/Bash/#shebang","title":"Shebang","text":"<p>Man \u00f6ppnar alltid alla script med en s\u00e5 kallad shebang. Detta f\u00f6r att systemet ska veta av hur den ska k\u00f6ra filen.</p> <pre><code> #!/usr/bin/env bash\n</code></pre>"},{"location":"linux_tools/Bash/#variabler","title":"Variabler","text":"<p>Variabler i bash skrivs p\u00e5 f\u00f6ljande s\u00e4tt <code>variable-name=</code> <pre><code>#!/usr/bin/env bash\nHW=\"Hello World\"\necho $HW\n</code></pre> <pre><code>sparco@jumpgate:~$ ./script\nHello World\n</code></pre>"},{"location":"linux_tools/Bash/#argument","title":"Argument","text":"<p>Att kunna skicka in argument i sitt bash script f\u00f6r att g\u00f6ra det mer dynamiskt kan vara bra ibland. F\u00f6rsta argumentet mappas mot <code>$1</code> medans resten bara forts\u00e4tter enligt <code>$2,$3,$4...</code>.</p> <pre><code>#!/usr/bin/env bash\necho $1 $2\n</code></pre> <pre><code>sparco@jumpgate:~$ ./script Hello World\nHello World\n</code></pre>"},{"location":"linux_tools/Bash/#debuga-scripts","title":"Debuga scripts","text":"<p>Att kunna debuga scripts kan g\u00f6ras p\u00e5 olika s\u00e4tt genom att k\u00f6ra <code>echo</code> p\u00e5 variabler eller s\u00e4tta p\u00e5 en v\u00e4xel i bash som g\u00f6r att den printar allt i sdout. Att k\u00f6ra scriptet med <code>bash -x</code></p> <pre><code>sparco@jumpgate:~$ bash -x ./script Hello world\n+ echo Hello world\nHello world\n</code></pre> <p>Ett annat s\u00e4tt om man vill debuga delar av ett script ist\u00e4llet f\u00f6r allt kan man anv\u00e4nda sig av f\u00f6ljande s\u00e4tt:</p> <pre><code>set -x\n......\nset +x\n</code></pre> <p>Category:Tools</p>"},{"location":"linux_tools/Cron/","title":"Cron","text":"<p>Cron \u00e4r det generella namnet p\u00e5 den service som k\u00f6r schemalagda jobb och \u00e4r ett klassiskt verktyg inom UNIX oxh Linuxv\u00e4rlden. Med cron kan man automatisera \u00e5terkommande uppgifter. Crond \u00e4r namnet p\u00e5 daemonen som k\u00f6rs i bakgrunden.</p>"},{"location":"linux_tools/Cron/#crontab","title":"Crontab","text":"<p>Cron tables \u00e4r filer som l\u00e4ses av crond och inneh\u00e5ller de schemalagda jobben. Detta kan \u00e4ven kallas cronjobs. Den generella formen f\u00f6r crontab:</p> <p><code>minute\u00a0hour\u00a0day-of-month\u00a0month\u00a0day-of-week\u00a0\u00a0command</code></p> <p>Visa aktuella cronjobs f\u00f6r nuvarande anv\u00e4ndare</p> <p><code>crontab\u00a0-l</code></p> <p>Editera cronjobs</p> <p><code>crontab\u00a0-e</code></p>"},{"location":"linux_tools/Cron/#output","title":"Output","text":"<p>Cron skickar per default output fr\u00e5n jobben till anv\u00e4ndarens mailbox, t.ex. output som annars skickas till stdout. Vill man slippa detta kan man skicka outputen till /dev/null.</p> <p><code>&gt;/dev/null</code></p> <p>Vill man \u00e4ven slippa error-output till sin mailbox kan man ignorera allt.</p> <p><code>&gt;/dev/null\u00a02&gt;&amp;1</code></p>"},{"location":"linux_tools/Cron/#access-control","title":"Access Control","text":"<p>F\u00f6r att styra vilka som f\u00e5r schemal\u00e4gga jobb kan man skriva anv\u00e4ndarnamn i f\u00f6ljande filer:</p> <ul> <li>/etc/cron.d/cron.allow</li> <li>/etc/cron.d/cron.deny</li> </ul> <p>Category:Tools</p>"},{"location":"linux_tools/DNF/","title":"DNF","text":"<p>DNF \u00e4r en ers\u00e4ttare f\u00f6r yum. De flesta kommandon \u00e4r likadana men det finns \u00e4ven lite nya funktioner. Dokumentation: http://dnf.readthedocs.org/en/latest/index.html Grunder</p> <p><code>dnf\u00a0search\u00a0open-vm-tools</code> <code>dnf\u00a0install\u00a0screen</code> <code>dnf\u00a0remove\u00a0htop</code> <code>dnf\u00a0info\u00a0firefox</code></p> <p>Repository</p> <p><code>dnf\u00a0repolist</code> <code>dnf\u00a0repoquery\u00a0--whatprovides</code> <p>History</p> <p><code>dnf\u00a0history\u00a0list</code></p> <p>Rollback</p> <p><code>dnf\u00a0history\u00a0undo\u00a07</code></p>"},{"location":"linux_tools/DNF/#system-upgrade","title":"System Upgrade","text":"<p>Uppgradera operativsystemet med hj\u00e4lp av dnf.</p> <p><code>sudo\u00a0dnf\u00a0update\u00a0--refresh</code> <code>sudo\u00a0dnf\u00a0install\u00a0dnf-plugin-system-upgrade</code> <code>sudo\u00a0dnf\u00a0system-upgrade\u00a0download\u00a0--releasever=23\u00a0\u00a0#</code><code>Fedora</code> <code>sudo\u00a0dnf\u00a0system-upgrade\u00a0reboot</code></p> <p>Category:Tools</p>"},{"location":"linux_tools/Dd/","title":"Dd","text":"<p>dd \u00e4r verktyp som g\u00e5r att anv\u00e4nda f\u00f6r diverse \u00e4ndam\u00e5l.</p> <p>Skriva \u00f6ver en disk med nollor</p> <p><code>dd\u00a0if=/dev/zero\u00a0of=/dev/sda\u00a0bs=1M\u00a0status=progress</code></p> <p>Vissa dd-operationer kan ta l\u00e5ng tid och det finns olika s\u00e4tt att kolla progress. T.ex. kan man f\u00f6lja det med hj\u00e4lp av watch-kommandot (i en ny session om man inte la till &amp;-tecken efter dd-kommandot).</p> <p><code>watch\u00a0'killall\u00a0-USR1\u00a0dd'</code></p> <p>Default intervallet f\u00f6r watch \u00e4r 2 sekunder, detta g\u00e5r att st\u00e4lla sj\u00e4lv.</p>"},{"location":"linux_tools/Dd/#prestandatester","title":"Prestandatester","text":"<p>F\u00f6ljande exempel \u00e4r simpla prestandatester som inte s\u00e4ger allt men fungerar som en fingervisning.</p>"},{"location":"linux_tools/Dd/#diskshare","title":"Disk/share","text":"<p>Write</p> <p><code>dd\u00a0if=/dev/urandom\u00a0of=/home/$USER/DDfile\u00a0bs=1M\u00a0count=4096\u00a0oflag=direct\u00a0#urandom\u00a0flaskar</code> <code>dd\u00a0if=/dev/</code><code>frandom</code><code>of=/home/$USER/DDfile\u00a0bs=1M\u00a0count=4096\u00a0oflag=direct</code></p> <p><code>dd\u00a0if=/dev/zero\u00a0of=/home/$USER/DDfile\u00a0bs=1M\u00a0count=4096\u00a0oflag=direct</code></p> <p>Ist\u00e4llet f\u00f6r oflag=direct kan conv=fdatasyn anv\u00e4ndas.</p> <p>Read Cachning kan beh\u00f6vas st\u00e4ngas av vid readtesterna.</p> <p><code>dd\u00a0if=/home/$USER/DDfile\u00a0of=/dev/null\u00a0bs=1M\u00a0count=4096\u00a0iflag=direct</code></p> <p>Med detta exemplet skapas det en 4GB stor fil, gl\u00f6m inte ta bort den efter\u00e5t.</p>"},{"location":"linux_tools/Dd/#cpu","title":"CPU","text":"<p><code>dd\u00a0if=/dev/zero\u00a0bs=1M\u00a0count=1024\u00a0|\u00a0sha512sum</code></p> <p>Category:Tools</p>"},{"location":"linux_tools/Dialog/","title":"Dialog","text":"<p>Dialog \u00e4r ett program som skapar snygga dialogrutor inifr\u00e5n shell scripts. Det finns t.ex. rutor f\u00f6r yes/no, menu, input, message.</p> <p><code>dnf\u00a0-y\u00a0install\u00a0dialog</code></p> <p>N\u00e5gra exempel p\u00e5 dialogrutor.</p> <p><code>dialog\u00a0--textbox\u00a0/etc/hosts\u00a022\u00a070</code> <code>dialog\u00a0--title\u00a0\"Message\"\u00a0--yesno\u00a0\"Big\u00a0box?\"\u00a019\u00a075</code> <code>dialog\u00a0--infobox\u00a0\"Stuff\u00a0is\u00a0happening\"\u00a010\u00a030\u00a0;\u00a0sleep\u00a08</code> <code>dialog\u00a0--inputbox\u00a0\"Enter\u00a0something:\"\u00a08\u00a040\u00a02&gt;answer</code> <code>dialog\u00a0--menu\u00a0\"Choose\u00a0one:\"\u00a010\u00a030\u00a03\u00a01\u00a0red\u00a02\u00a0green\u00a03\u00a0blue</code></p> <p>Category:Tools</p>"},{"location":"linux_tools/Dnstracer/","title":"Dnstracer","text":"<p>Dnstracer \u00e4r som traceroute fast f\u00f6r dnsuppslag.</p>"},{"location":"linux_tools/Dnstracer/#installation","title":"Installation","text":"<p>Debian/Ubuntu</p> <p><code>apt-get\u00a0install\u00a0dnstracer</code></p>"},{"location":"linux_tools/Dnstracer/#vaxlar","title":"V\u00e4xlar","text":"<ul> <li>-c<ul> <li>St\u00e4ng av lokal cache.</li> </ul> </li> <li>-C<ul> <li>S\u00e4tt p\u00e5 negative cache.</li> </ul> </li> <li>-o<ul> <li>Visa ett mer l\u00e4tt l\u00e4st resultat.</li> </ul> </li> <li>-q<ul> <li>\u00c4ndra query-class, default \u00e4r A. Eller n\u00e5n av f\u00f6ljande a, aaaa,     a6, soa, cname, hinfo, mx, ns, txt och ptr.</li> </ul> </li> <li>-r<ul> <li>Antal dns f\u00f6rs\u00f6k, default 3.</li> </ul> </li> <li>-s<ul> <li>Vilken DNS server som ska anv\u00e4ndas, ifall ingen anges s\u00e5 anv\u00e4nds     systemets DNS server. Om en punkt skrivs s\u00e5 kommer den anv\u00e4nda     A.ROOT-SERVERS.NET.</li> </ul> </li> <li>-v<ul> <li>Verbose output p\u00e5 vad som skickats och tagits emot.</li> </ul> </li> <li>-4<ul> <li>Anv\u00e4nd bara IPv4 servrar.</li> </ul> </li> <li>-S<ul> <li>\u00c4ndra vilken source adress som anv\u00e4nds.</li> </ul> </li> </ul>"},{"location":"linux_tools/Dnstracer/#exempel","title":"Exempel","text":"<p><code>dnstracer\u00a0-o4s\u00a0.\u00a0hackernet.se</code></p> <p>Category:Tools</p>"},{"location":"linux_tools/Dumpcap/","title":"Dumpcap","text":"<p>Dumpcap \u00e4r ett network traffic dump tool. Det ing\u00e5r i wireshark-sviten och \u00e4r det som anv\u00e4nds av wireshark och tshark. F\u00f6r att f\u00e5 trafik till dumpcap kan t.ex. en n\u00e4tverkstapp eller span-port anv\u00e4ndas. Default filformat \u00e4r pcap-ng.</p>"},{"location":"linux_tools/Dumpcap/#installation","title":"Installation","text":"<p><code>sudo\u00a0apt-get\u00a0install\u00a0wireshark-common</code></p> <p>Lista m\u00f6jliga interface</p> <p><code>sudo\u00a0dumpcap\u00a0-D</code></p> <p>Exempel, spara data i samma fil under 1h, p\u00e5b\u00f6rja sedan n\u00e4sta fil, upprepa 24 g\u00e5nger. Dvs ett dygn.</p> <p><code>sudo\u00a0dumpcap\u00a0-i\u00a0eth0\u00a0-b\u00a0duration:3600\u00a0-b\u00a0files:24\u00a0-w\u00a0packets.pcap</code></p> <p>Exempel, filesize i kB, sedan ny fil. 5GB totalt.</p> <p><code>sudo\u00a0dumpcap\u00a0-i\u00a0eth1\u00a0-b\u00a0filsize:1000000\u00a0-b\u00a0files:5\u00a0-w\u00a0/pcap/packets.pcap</code></p> <p>Se \u00e4ven till att paketdumparna, som kan bli v\u00e4ldigt stora, ligger p\u00e5 ett eget filsystem f\u00f6r att f\u00f6rhindra att diskutrymme tas upp f\u00f6r operativsystemet.</p> <p>Category:Tools</p>"},{"location":"linux_tools/EFI/","title":"EFI","text":"<p>EFI g\u00f6r det m\u00f6jligt att l\u00e4gga till och utveckla en rad funktioner som inte \u00e4r m\u00f6jligt med ett vanligt BIOS.</p> <p>efibootmgr: a Linux user-space application to modify the Intel Extensible Firmware Interface (EFI) Boot Manager.</p> <p><code>apt-get\u00a0install\u00a0efibootmgr</code></p>"},{"location":"linux_tools/EFI/#tips-n-tricks","title":"Tips n Tricks","text":"<p>\u00c4ndra boot order utan att st\u00e4nga av maskinen:</p> <p>Kolla nuvarande boot entries</p> <p><code>efibootmgr\u00a0-v</code></p> <p>Rensa bort nuvarande boot order i EFI NVRAM</p> <p><code>efibootmgr\u00a0--delete-bootorder</code></p> <p>Ta bort o\u00f6nskade entries</p> <p><code>efibootmgr\u00a0--delete-bootnum\u00a0--bootnum\u00a00003</code></p> <p>Konfigurera boot menu timeout</p> <p><code>efibootmgr\u00a0--timeout\u00a010</code></p> <p>Konfigurera den ordning du vill ha, t.ex.</p> <p><code>efibootmgr\u00a0-o\u00a00000,0002,0003,0001</code></p> <p>L\u00e4gg boot entry h\u00f6gst endast f\u00f6r n\u00e4sta omstart</p> <p><code>efibootmgr\u00a0-n\u00a00003</code></p> <p>Category:Tools</p>"},{"location":"linux_tools/FirewallD/","title":"FirewallD","text":"<p>FirewallD ers\u00e4tter iptables i RHEL 7, centOS 7 och Fedora 18. Den fr\u00e4msta f\u00f6rdelen \u00e4r att man kan g\u00f6ra alla \u00e4ndringar utan att beh\u00f6va starta om tj\u00e4nsten. Denna artikel inneh\u00e5ller grunderna f\u00f6r FirewallD.</p>"},{"location":"linux_tools/FirewallD/#grunder","title":"Grunder","text":"<p>Kolla status</p> <p><code>firewall-cmd\u00a0--state</code></p> <p>Detaljerad status</p> <p><code>systemctl\u00a0status\u00a0firewalld.service</code></p> <p>On/Off</p> <p><code>systemctl\u00a0enable\u00a0firewalld.service</code> <code>systemctl\u00a0disable\u00a0firewalld.service</code></p> <p>Panic mode (Blockar all traffik)</p> <p>On</p> <p><code>firewall-cmd\u00a0--panic-on</code></p> <p>Off</p> <p><code>firewall-cmd\u00a0--panic-off</code></p> <p>OBS Om man har flera interface m\u00e5ste man sl\u00e5 p\u00e5 IPv4-forwarding</p> <p><code>sudo\u00a0sed\u00a0-i\u00a0-r\u00a0's/net.ipv4.ip_forward=0/net.ipv4.ip_forward=1/g'\u00a0/etc/sysctl.conf</code> <code>sysctl\u00a0-p</code></p>"},{"location":"linux_tools/FirewallD/#zoner","title":"Zoner","text":"<p>FirewallD jobbar med s\u00e4kerhetszoner och f\u00f6ljande zoner finns default:</p> <ul> <li>Public \u2013 For use in public areas. Only selected incoming connections     are accepted.</li> <li>Drop \u2013 Any incoming network packets are dropped, there is no reply.     Only outgoing network connections are possible.</li> <li>Block \u2013 Any incoming network connections are rejected with an     icmp-host-prohibited message for IPv4 and icmp6-adm-prohibited for     IPv6. Only network connections initiated within this system are     possible.</li> <li>External \u2013 For use on external networks with masquerading enabled     especially for routers. Only selected incoming connections are     accepted.</li> <li>DMZ \u2013 For computers DMZ network, with limited access to the internal     network. Only selected incoming connections are accepted.</li> <li>Work \u2013 For use in work areas. Only selected incoming connections are     accepted.</li> <li>Home \u2013 For use in home areas. Only selected incoming connections are     accepted.</li> <li>Trusted \u2013 All network connections are accepted.</li> <li>Internal \u2013 For use on internal networks. Only selected incoming     connections are accepted.</li> </ul> <p>Alla interface ligger default i zonen public. Varje zon \u00e4r definierad i en XML-fil som ligger i /usr/lib/firewalld/zones</p> <p>Kolla vilka zoner som finns</p> <p><code>firewall-cmd\u00a0--get-zones</code></p> <p>Kolla aktiva zoner</p> <p><code>firewall-cmd\u00a0--get-active-zones</code></p> <p>Kolla en zones permanenta konfiguration</p> <p><code>firewall-cmd\u00a0--permanent\u00a0--list-all\u00a0--zone=public</code></p> <p>Kolla alla zoner detaljerat</p> <p><code>firewall-cmd\u00a0--list-all-zones</code></p> <p>\u00c4ndra default zone</p> <p><code>firewall-cmd\u00a0--set-default-zone=home</code></p> <p>Skapa en ny zone</p> <p><code>firewall-cmd\u00a0--permanent\u00a0--new-zone=test</code> <code>firewall-cmd\u00a0--reload</code></p>"},{"location":"linux_tools/FirewallD/#aktivera-zonen","title":"Aktivera zonen","text":"<p>F\u00f6r att en zone ska g\u00e4lla beh\u00f6ver man aktivera den p\u00e5 interfacet eller p\u00e5 CIDR-notation. Kolla vilka zoner som k\u00f6rs p\u00e5 ett interface</p> <p><code>firewall-cmd\u00a0--get-zone-of-interface=eth0</code></p> <p>Aktivera en zone tillf\u00e4lligt</p> <p><code>firewall-cmd\u00a0--zone=home\u00a0--change-interface=eth0</code></p> <p>Aktivera en zone permanent</p> <p><code>firewall-cmd\u00a0--permanent\u00a0--zone=home\u00a0--change-interface=eth0</code></p> <p>Aktivera p\u00e5 en CIDR-notion</p> <p><code>firewall-cmd\u00a0--permanent\u00a0--zone=work\u00a0--add-source=192.168.0.0/24</code> <code>firewall-cmd\u00a0--permanent\u00a0--zone=work\u00a0--list-sources</code></p>"},{"location":"linux_tools/FirewallD/#services","title":"Services","text":"<p>Det finns ett g\u00e4ng f\u00f6rdefinerade tj\u00e4nster men man kan enkelt l\u00e4gga till en egna f\u00f6r att slippa g\u00f6ra port\u00f6ppningar.</p> <p>Lista alla tj\u00e4nster</p> <p><code>firewall-cmd\u00a0--get-services</code></p> <p>Vill du kolla in varje tj\u00e4nst mer detaljerat s\u00e5 kan du l\u00e4sa XML filerna under /usr/lib/firewalld/services/ssh.xml.</p>"},{"location":"linux_tools/FirewallD/#skapa-egen-tjanst","title":"Skapa egen tj\u00e4nst","text":"<p>F\u00f6r att l\u00e4gga till en egen tj\u00e4nst, skapa en XML under /etc/firewalld/services/ med f\u00f6ljande inneh\u00e5ll.</p>   **HAProxy.xml**   <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;service&gt;\n &lt;short&gt;HAProxy&lt;/short&gt;\n &lt;description&gt;HAProxy load-balancer&lt;/description&gt;\n &lt;port protocol=\"tcp\" port=\"80\"/&gt;\n&lt;/service&gt;\n</code></pre> <p>Bra att k\u00e4nna till \u00e4r att en tj\u00e4nst under /etc/firewalld/services/ har h\u00f6gre prioritet \u00e4n en tj\u00e4nst under /usr/lib/firewalld/services/.</p>"},{"location":"linux_tools/FirewallD/#lagga-till-en-tjanst-i-en-zone","title":"L\u00e4gga till en tj\u00e4nst i en zone.","text":"<p>F\u00f6r att sedan l\u00e4gga till tj\u00e4nsten p\u00e5 en zone permanent.</p> <p><code>firewall-cmd\u00a0--permanent\u00a0--zone=public\u00a0--add-service=HAProxy</code> <code>firewall-cmd\u00a0--reload</code></p>"},{"location":"linux_tools/FirewallD/#portforwarding","title":"Portforwarding","text":"<p><code>firewall-cmd\u00a0--zone=external\u00a0--add-forward-port=port=80:proto=tcp:toport=8080:toaddr=192.168.0.50</code></p> <p>Iptables Man kan byta tillbaka om man k\u00e4nner sig gammalmodig. http://www.certdepot.net/rhel7-disable-firewalld-use-iptables/</p> <p>Category:Tools</p>"},{"location":"linux_tools/Frandom/","title":"Frandom","text":"<p>Tr\u00f6tt p\u00e5 att urandom \u00e4r flaskar.</p> <p><code>wget</code><code>http://billauer.co.il/download/frandom-1.1.tar.gz</code> <code>tar\u00a0xzf\u00a0frandom-1.1.tar.gz</code> <code>cd\u00a0frandom-1.1</code> <code>make</code> <code>install\u00a0-m\u00a0644\u00a0frandom.ko\u00a0/lib/modules/`uname\u00a0-r`/kernel/drivers/char/</code> <code>depmod\u00a0-a</code> <code>modprobe\u00a0frandom</code></p> <p>Category:Tools</p>"},{"location":"linux_tools/Hdparm/","title":"Hdparm","text":"<p>hdparm \u00e4r ett verktyg f\u00f6r att managera h\u00e5rdvaruparametrar p\u00e5 h\u00e5rddiskar. T.ex. GParted inkluderar hdparm.</p> <p>Info om h\u00e5rddisk</p> <p><code>hdparm\u00a0-i\u00a0/dev/sda</code></p> <p>L\u00e4sprestandatest</p> <p><code>hdparm\u00a0-tT\u00a0/dev/sda</code></p> <p>S\u00e4nk ljudniv\u00e5n p\u00e5 bekostnad av prestanda.</p> <p><code>hdparm\u00a0-M\u00a0128\u00a0/dev/sda</code></p> <p>Fabriks\u00e5terst\u00e4llning</p> <p><code>hdparm\u00a0--yes-i-know-what-i-am-doing\u00a0--dco-restore\u00a0/dev/sda</code></p> <p>Category:Tools</p>"},{"location":"linux_tools/IPMI/","title":"IPMI","text":"<p>Category:Tools Intelligent Platform Management Interface \u00e4r ett system som tillhandah\u00e5ller management och \u00f6vervakningsfunktioner av en server oberoende av CPU, BIOS eller operativsystem. IPMI anv\u00e4nds av systemadministrat\u00f6rer f\u00f6r out-of-band, t.ex. f\u00f6r att consolea till en server. Det finns olika implementationer av IPMI, t.ex. HPs kallas iLO och Dells kallas iDRAC.</p> <p>Installation</p> <p><code>yum\u00a0install\u00a0OpenIPMI\u00a0OpenIPMI-tools</code></p>"},{"location":"linux_tools/IPMI/#ipmitool","title":"Ipmitool","text":"<p>Ipmitool \u00e4r ett verktyg som kan anv\u00e4ndas f\u00f6r att konfigurera IPMI p\u00e5 de flesta linuxsystem inklusive ESXi. Antingen kan man kompilera det sj\u00e4lv eller ladda ner f\u00e4rdig bin\u00e4r. Logga in p\u00e5 server med SSH:</p> <p><code>wget</code><code>http://harsbo.se/filer/ipmitool</code> <code>chmod\u00a0+x\u00a0ipmitool</code></p> <p>F\u00f6r att lista kommandoalternativ k\u00f6r kommandot utan parametrar.</p> <p>Skapa anv\u00e4ndare</p> <p><code>./ipmitool\u00a0user\u00a0set\u00a0name\u00a02\u00a0admin</code> <code>./ipmitool\u00a0user\u00a0set\u00a0password\u00a02</code> <code>./ipmitool\u00a0user\u00a0priv\u00a02\u00a04\u00a01</code> <code>./ipmitool\u00a0channel\u00a0setaccess\u00a01\u00a02\u00a0callin=on\u00a0ipmi=on\u00a0link=on\u00a0privilege=4</code> <code>./ipmitool\u00a0user\u00a0list</code> <code>./ipmitool\u00a0user\u00a0enable\u00a02</code> <p>IPconfig</p> <p><code>./ipmitool\u00a0lan\u00a0set\u00a01\u00a0ipsrc\u00a0static</code> <code>./ipmitool\u00a0lan\u00a0set\u00a01\u00a0ipaddr\u00a010.0.0.45</code> <code>./ipmitool\u00a0lan\u00a0set\u00a01\u00a0defgw\u00a0ipaddr\u00a010.0.0.1</code> <code>./ipmitool\u00a0lan\u00a0set\u00a01\u00a0netmask\u00a0255.255.255.0</code> <code>./ipmitool\u00a0lan\u00a0set\u00a01\u00a0vlan\u00a0id\u00a05</code> <code>./ipmitool\u00a0lan\u00a0print</code></p>"},{"location":"linux_tools/Iperf/","title":"Iperf","text":"<p>Iperf \u00e4r ett verktyg som anv\u00e4nds f\u00f6r att testa bandbredd mellan 2 noder i ett n\u00e4tverk. Det s\u00e4tter upp TCP- och UDP-datastr\u00f6mmar f\u00f6r att m\u00e4ta throughput.</p>"},{"location":"linux_tools/Iperf/#iperf3","title":"Iperf3","text":"<p>Iperf3 \u00e4r en omskrivning av Iperf fr\u00e5n b\u00f6rjan, med m\u00e5let om en mindre och enklare kodbas. Programmet funkar med b\u00e5de IPv4 och IPv6. Iperf3 \u00e4r inte bak\u00e5tkompatibel med Iperf2.</p> <p><code>apt-get\u00a0install\u00a0iperf3</code> <code>yum\u00a0install\u00a0iperf3</code></p>"},{"location":"linux_tools/Iperf/#server","title":"Server","text":"<p>Den ena noden \u00e4r server och lyssnar p\u00e5 inkommande instruktioner. Default \u00e4r TCP/UDP 5201. F\u00f6r att starta iperf i server l\u00e4ge.</p> <p><code>iperf3\u00a0-s</code></p> <p>Daemon mode och port 5203</p> <p><code>iperf3\u00a0-s\u00a0-D\u00a0-p\u00a05203</code></p> <p>Systemd sudo nano /etc/systemd/system/speedtest.service</p> <p><code>[Unit]</code> <code>Description=iPerf3\u00a0speed\u00a0test\u00a0server</code> <code>After=network.target</code></p> <p><code>[Service]</code> <code>ExecStart=/usr/bin/iperf3\u00a0-s\u00a0-p\u00a05500</code></p> <p><code>[Install]</code> <code>WantedBy=multi-user.target</code></p> <p><code>sudo\u00a0systemctl\u00a0daemon-reload</code> <code>sudo\u00a0systemctl\u00a0start\u00a0speedtest.service</code> <code>sudo\u00a0systemctl\u00a0enable\u00a0speedtest.service</code></p>"},{"location":"linux_tools/Iperf/#klient","title":"Klient","text":"<p>F\u00f6r att starta ett test mot servern skriv.</p> <p><code>iperf3\u00a0-c</code> <p>St\u00e4ll hur l\u00e4nge testat ska k\u00f6ra. Default \u00e4r 10 sekunder.</p> <p><code>iperf3\u00a0-c\u00a0192.168.0.20\u00a0-t\u00a060</code></p> <p>Reverse mode, servern skickar till klienten.</p> <p><code>iperf3\u00a0-c\u00a0192.168.0.20\u00a0-R</code></p> <p>F\u00f6r att k\u00f6ra 5 streams samtidigt skriv.</p> <p><code>iperf3\u00a0-c\u00a0192.168.0.20\u00a0-P\u00a05</code></p> <p>UDP kan anv\u00e4ndas f\u00f6r att m\u00e4ta jitter och paketf\u00f6rlust. Klientspecifik v\u00e4xel.</p> <p><code>iperf3\u00a0-c\u00a0192.168.0.20\u00a0-u</code></p> <p>Category:Tools</p>"},{"location":"linux_tools/Iproute2/","title":"Iproute2","text":"<p>Ifconfig, arp och route-kommandona \u00e4r p\u00e5v\u00e4g bort, v\u00e4nj dig vid iproute2. De tv\u00e5 viktigaste verktygen \u00e4r ip och tc (traffic control) Med dessa kommandon beh\u00f6ver man inte skriva ut alla bokst\u00e4ver, likt switchar och routrar. T.ex. ip a s \u00e4r samma som ip address show</p> Gamla kommandot Nya kommandot Kommentar <code>ifconfig</code> <code>ip addr</code>, <code>ip link</code>, <code>ip -s</code> Adresser och l\u00e4nk config <code>route</code> <code>ip route</code> Routing tables <code>arp</code> <code>ip neigh</code> Neighbors <code>iptunnel</code> <code>ip tunnel</code> Tunnels <code>nameif</code> <code>ifrename</code>, <code>ip link set name</code> Byt namn p\u00e5 ett interface <code>ipmaddr</code> <code>ip maddr</code> Multicast <code>netstat</code> <code>ip -s</code>, <code>ss</code>, <code>ip route</code> Visar n\u00e4t statistik, tex vilka portar man lyssnar p\u00e5"},{"location":"linux_tools/Iproute2/#ip","title":"ip","text":"<p>Version</p> <p><code>ip\u00a0-V</code></p> <p>ip address show</p> <p><code>ip\u00a0a</code> <code>ip\u00a0-br\u00a0a</code> <code>ip\u00a0a\u00a0s\u00a0eth0</code></p> <p>ip routes show</p> <p><code>ip\u00a0r</code></p> <p>ip link ifconfig</p> <p><code>ip\u00a0l</code> <code>ip\u00a0-br\u00a0l</code> <code>ip\u00a0-s\u00a0l\u00a0\u00a0#med\u00a0statistik</code></p> <p>ifup/ifdown</p> <p><code>ip\u00a0link\u00a0set\u00a0eth0\u00a0up/down</code></p> <p>Description</p> <p><code>ip\u00a0link\u00a0set\u00a0eth0\u00a0alias\u00a0\"LAN\u00a0interface\"</code></p> <p>Promiscuous mode p\u00e5 interface</p> <p><code>ip\u00a0link\u00a0set\u00a0eth0\u00a0promisc\u00a0on</code> <code>ip\u00a0a\u00a0|\u00a0grep\u00a0PROMISC</code></p> <p>Macchanger</p> <p><code>ip\u00a0link\u00a0set\u00a0dev\u00a0eth0\u00a0address\u00a000:11:22:33:44:55</code></p> <p>ip neigh ARP/NDP</p> <p><code>ip\u00a0n</code></p> <p>Flush cache</p> <p><code>ip\u00a0n\u00a0f</code></p> <p>Monitor Monitor changes in network configuration, routing tables, and ARP/NDP tables from terminal.</p> <p><code>ip\u00a0monitor</code></p>"},{"location":"linux_tools/Iproute2/#vxlan","title":"VXLAN","text":"<p>VXLAN \u00e4r ett tunnlingsprotokoll designat f\u00f6r att l\u00f6sa skalbarhetsbegr\u00e4nsningar med VLAN. Det \u00f6kar fr\u00e5n 4096 till 24 bitar (16 miljoner) id:n. Protokollet k\u00f6rs \u00f6ver en enskild konfigurerbar UDP-port. EN VXLAN-enhet kan l\u00e4ra sig MAC/IP-adresser tillh\u00f6rande andra sidan tunneln antingen dynamiskt likt en switch eller med statiska forwarding entries.</p> <p>Unicast</p> <p><code>ip\u00a0link\u00a0add\u00a0vxlan0\u00a0type\u00a0vxlan\u00a0id\u00a010\u00a0remote\u00a02.2.2.2\u00a0local\u00a01.1.1.1\u00a0dev\u00a0eth0</code></p> <p>VTEP-kommunikation g\u00f6rs alternativt med multicast.</p> <p><code>ip\u00a0link\u00a0add\u00a0vxlan0\u00a0type\u00a0vxlan\u00a0id\u00a010\u00a0group\u00a0239.1.1.1\u00a0dev\u00a0eth0\u00a0dstport\u00a04789</code></p> <p>Vxlan-interfacet kopplas sedan till en Open vSwitch eller Linux Bridge.</p> <p><code>brctl\u00a0addif\u00a0br0\u00a0vxlan0</code></p> <p>Enablea interface</p> <p><code>ip\u00a0link\u00a0set\u00a0up\u00a0dev\u00a0vxlan0</code></p> <p>Kolla interface och forwarding table</p> <p><code>ip\u00a0-d\u00a0link\u00a0show\u00a0vxlan0</code> <code>bridge\u00a0fdb\u00a0show\u00a0dev\u00a0vxlan0</code></p> <p>Delete interface</p> <p><code>ip\u00a0link\u00a0delete\u00a0vxlan0</code></p> <p>Disable source-address learning, detta kan t.ex. g\u00f6ras om man har BGP EVPN som synkroniserar FDBs.</p> <p><code>ip\u00a0link\u00a0add\u00a0vxlan0\u00a0type\u00a0vxlan\u00a0id\u00a010\u00a0remote\u00a02.2.2.2\u00a0local\u00a01.1.1.1\u00a0dev\u00a0eth0</code><code>nolearning</code></p> <p>Skapa entry manuellt</p> <p><code>bridge\u00a0fdb\u00a0add\u00a0to\u00a000:00:0c:80:bb:07\u00a0dst\u00a02.2.2.2\u00a0dev\u00a0vxlan0</code></p>"},{"location":"linux_tools/Iproute2/#gretap","title":"GRETAP","text":"<p>Generic Routing Encapsulation on linux.</p> <p><code>ip\u00a0link\u00a0add\u00a0GRETAP1\u00a0type\u00a0gretap\u00a0local\u00a0172.16.0.10\u00a0remote\u00a0192.168.0.10\u00a0dev\u00a0eth0</code> <code>ip\u00a0link\u00a0add\u00a0br0\u00a0type\u00a0bridge</code> <code>ip\u00a0link\u00a0set\u00a0eth1\u00a0master\u00a0br0</code> <code>ip\u00a0link\u00a0set\u00a0eth1\u00a0up</code> <code>ip\u00a0link\u00a0set\u00a0br0\u00a0up</code> <code>ip\u00a0link\u00a0set\u00a0GRETAP1\u00a0up</code> <code>ip\u00a0link\u00a0set\u00a0GRETAP1\u00a0master\u00a0br0</code> <code>ifconfig\u00a0br0\u00a0promisc</code></p>"},{"location":"linux_tools/Iproute2/#l2tpv3","title":"L2TPv3","text":"<p>Layer Two Tunneling Protocol - Version 3.</p> <p><code>modprobe\u00a0l2tp_eth</code> <code>ip\u00a0l2tp\u00a0add\u00a0tunnel\u00a0local\u00a01.1.1.1\u00a0remote\u00a02.2.2.2\u00a0tunnel_id\u00a0100\u00a0peer_tunnel_id\u00a0200\u00a0encap\u00a0udp\u00a0udp_sport\u00a05000\u00a0udp_dport\u00a05000</code> <code>ip\u00a0l2tp\u00a0add\u00a0session\u00a0tunnel_id\u00a0100\u00a0session_id\u00a0300\u00a0peer_session_id\u00a0300</code></p> <p>Show</p> <p><code>ip\u00a0l2tp\u00a0show\u00a0tunnel</code></p>"},{"location":"linux_tools/Iproute2/#network-namespace","title":"Network Namespace","text":"<p>Skapa VRF, assigna interface och s\u00e4tt adress</p> <p><code>ip\u00a0netns\u00a0add\u00a0MGMT</code> <code>ip\u00a0link\u00a0set\u00a0eth1\u00a0netns\u00a0MGMT</code> <code>ip\u00a0netns\u00a0exec\u00a0MGMT\u00a0ip\u00a0addr\u00a0add\u00a010.0.0.101/24\u00a0dev\u00a0eth1</code> <code>ip\u00a0netns\u00a0exec\u00a0MGMT\u00a0ip\u00a0route\u00a0add\u00a0default\u00a0via\u00a010.0.0.1</code> <code>ip\u00a0netns\u00a0list</code></p>"},{"location":"linux_tools/Iproute2/#subinterface","title":"Subinterface","text":"<p><code>ip\u00a0link\u00a0add\u00a0link\u00a0eth1\u00a0name\u00a0eth1.20\u00a0type\u00a0vlan\u00a0id\u00a020</code> <code>ip\u00a0address\u00a0add\u00a0192.168.20.1/24\u00a0dev\u00a0eth1.20</code> <code>ip\u00a0link\u00a0set\u00a0eth1.20\u00a0up</code></p>"},{"location":"linux_tools/Iproute2/#mac-vlan","title":"MAC VLAN","text":"<p>Med MAC VLAN kan man assigna flera MAC-adresser till samma interface. Man kan uppn\u00e5 samma resultat som med Bridge men det \u00e4r mer light-weight. Det kan skapas i 4 modes: private, vepa, bridge eller passthru beroende p\u00e5 s\u00e4kerhetskraven. Det g\u00e5r att k\u00f6ra MAC VLAN tillsammans med KVM.</p> <p><code>ip\u00a0link\u00a0add\u00a0link\u00a0eth0\u00a0mac0\u00a0type\u00a0macvlan</code></p>"},{"location":"linux_tools/Iproute2/#blackhole","title":"Blackhole","text":"<p>Discard traffic sent to unwanted destinations</p> <p><code>ip\u00a0route\u00a0add\u00a0blackhole\u00a0192.168.2.0/30</code></p>"},{"location":"linux_tools/Iproute2/#configuration-caching","title":"Configuration Caching","text":"<p>Ska man flytta en IP-adress fr\u00e5n ett interface till ett annat \u00e4r det bra att flusha cachen emellan f\u00f6r att s\u00e4kerst\u00e4lla att det inte h\u00e4nger kvar n\u00e5got.</p> <p><code>ip\u00a0a\u00a0flush\u00a0dev</code>"},{"location":"linux_tools/Iproute2/#ss","title":"ss","text":"<p>Socket statistics. Anv\u00e4ndbart och l\u00e4ttmemorerat kommando som ers\u00e4tter netstat:</p> <p><code>ss\u00a0-tulpan</code></p>"},{"location":"linux_tools/Iproute2/#tc","title":"tc","text":"<p>Traffic control. Command wrapper: tcconfig.</p> <p>Network Emulator Delay</p> <p><code>tc\u00a0qdisc\u00a0change\u00a0dev\u00a0eth0\u00a0root\u00a0netem\u00a0delay\u00a0100ms\u00a020ms\u00a0distribution\u00a0normal</code></p> <p>Packet loss</p> <p><code>tc\u00a0qdisc\u00a0change\u00a0dev\u00a0eth0\u00a0root\u00a0netem\u00a0loss\u00a00.3%\u00a025%</code></p> <p>Reorder</p> <p><code>tc\u00a0qdisc\u00a0change\u00a0dev\u00a0eth0\u00a0root\u00a0netem\u00a0delay\u00a010ms\u00a0reorder\u00a025%\u00a050%</code></p> <p>Policing</p> <p><code>tc\u00a0qdisc\u00a0add\u00a0dev\u00a0eth0\u00a0root\u00a0tbf\u00a0rate\u00a02mbit\u00a0burst\u00a032kbit\u00a0latency\u00a0600ms</code></p> <p>Show config</p> <p><code>tc\u00a0qdisc\u00a0show\u00a0dev\u00a0eth0</code></p> <p>Clear config</p> <p><code>tc\u00a0qdisc\u00a0del\u00a0dev\u00a0eth0\u00a0root</code></p> <p>Category:Tools</p>"},{"location":"linux_tools/Iptables/","title":"Iptables","text":"<p>K\u00e4lla och v\u00e4ldigt bra l\u00e4sning: http://www.lysator.liu.se/~kjell-e/tekla/linux/security/iptables/</p> <p>S\u00e4tt upp en brandv\u00e4gg f\u00f6r att begr\u00e4nsa och blockera o\u00f6nskad inkommande trafik till din server, detta \u00e4r valfritt men rekommenderat. Kommandot iptables anv\u00e4nds f\u00f6r att kontrollera netfilter, den underliggande tekniken som funnits med i linuxk\u00e4rnan sedan 2.4.</p>"},{"location":"linux_tools/Iptables/#komponenter","title":"Komponenter","text":""},{"location":"linux_tools/Iptables/#tables","title":"Tables","text":"<p>Tables \u00e4r de stora delarna av netfilter, och best\u00e5r av FILTER, NAT, och MANGLE. FILTER anv\u00e4nds f\u00f6r vanlig hantering av paket, och \u00e4r standardtabellen om ingen annan anges. NAT anv\u00e4nds f\u00f6r att skriva om source och/eller destination f\u00f6r paket. MANGLE anv\u00e4nds f\u00f6r att p\u00e5 annat s\u00e4tt modifiera paket, t.ex. modifiera olika delar av en TCP header.</p>"},{"location":"linux_tools/Iptables/#chains","title":"Chains","text":"<p>Chains \u00e4r sedan associerade med varje table. Chains \u00e4r listor av regler inom en table, och de \u00e4r associerade med platser d\u00e4r man kan avlyssna trafiken och vidta \u00e5tg\u00e4rder.</p> <p>Dessa chains finns:</p> <p>PREROUTING: Immediately after being received by an interface.</p> <p>POSTROUTING: Right before leaving an interface.</p> <p>INPUT: Right before being handed to a local process.</p> <p>OUTPUT: Right after being created by a local process.</p> <p>FORWARD: For any packets coming in one interface and leaving out another.</p>"},{"location":"linux_tools/Iptables/#kombinationer","title":"Kombinationer","text":"<p>FILTER: Input, Output, Forward</p> <p>NAT: PREROUTING, POSTROUING, Output</p> <p>MANGLE: PREROUTING, POSTROUING, Input, Output, Forward</p>"},{"location":"linux_tools/Iptables/#targets","title":"Targets","text":"<p>Targets best\u00e4mmer vad som kommer att h\u00e4nda med ett paket i en kedja om en matchning hittas med en av dess regler. De tv\u00e5 vanligaste \u00e4r DROP och ACCEPT.</p>"},{"location":"linux_tools/Iptables/#regelverk","title":"Regelverk","text":"<p>Kolla regelverk</p> <p><code>sudo\u00a0iptables\u00a0-S</code></p> <p>Skapa regelverk</p> <pre><code>sudo dd of=/etc/iptables.firewall.rules &lt;&lt; EOF\n*filter\n\n# Standard\n-A INPUT -i lo -j ACCEPT\n-A INPUT -d 127.0.0.0/8 -j REJECT\n-A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT\n\n# Portar och protokoll\n-A INPUT -p tcp --dport 80 -j ACCEPT\n-A INPUT -p tcp --dport 443 -j ACCEPT\n-A INPUT -p tcp -m state --state NEW --dport 22 -j ACCEPT\n-A INPUT -p icmp --icmp-type echo-request -j ACCEPT\n\n# Catch all\n-A INPUT -j DROP\n-A FORWARD -j DROP\n-A OUTPUT -j ACCEPT\n\nCOMMIT\nEOF\n</code></pre> <p>Rules activate!</p> <p><code>sudo\u00a0iptables-restore\u00a0&lt;\u00a0/etc/iptables.firewall.rules</code> <code>sudo\u00a0iptables\u00a0-L\u00a0-n\u00a0-v\u00a0--line-numbers</code></p>"},{"location":"linux_tools/Iptables/#persistent","title":"Persistent","text":"<p>Beh\u00e5ll regler efter omstart, Debian/Ubuntu</p> <pre><code>sudo dd of=/etc/network/if-pre-up.d/firewall &lt;&lt; EOF\n#!/bin/sh\n/sbin/iptables-restore &lt; /etc/iptables.firewall.rules\nEOF\nsudo chmod +x /etc/network/if-pre-up.d/firewall\n</code></pre> <p>Alternativt anv\u00e4nd iptables-persistent</p> <p><code>apt-get\u00a0install\u00a0iptables-persistent</code> <code>iptables-save\u00a0&gt;\u00a0/etc/iptables/rules.v4</code></p>"},{"location":"linux_tools/Iptables/#dynamisk-ip","title":"Dynamisk IP","text":"<p>Att ha dynamisk IP suger men s\u00e5 \u00e4r det ibland. Som tur \u00e4r kan iptables uppdatera sina regler automatiskt \u00e4ven om en IP-adress \u00e4ndras. Det som beh\u00f6vs \u00e4r ett DNS-namn mot IPn.</p> <p><code>iptables\u00a0-N\u00a0DYNDNS</code> <code>iptables\u00a0-A\u00a0INPUT\u00a0-p\u00a0tcp\u00a0-m\u00a0tcp\u00a0--dport\u00a022\u00a0-j\u00a0DYNDNS</code></p> <p>Sedan ett script som k\u00f6rs enligt schemal\u00e4ggning</p> <pre><code>sudo dd of=/etc/dyndns.sh &lt;&lt; EOF\n#!/bin/bash\niptables -F DYNDNS\niptables -A DYNDNS -s dyndns.exempel.se -j ACCEPT\nEOF\nsudo chmod +x /etc/dyndns.sh\necho \"0 * * * * /etc/dyndns.sh\" | sudo crontab -\n</code></pre> <p>Uppdatering en g\u00e5ng i timmen</p>"},{"location":"linux_tools/Iptables/#ipset","title":"IPset","text":"<p>IPset \u00e4r ett verktyg f\u00f6r att hantera regler. Det \u00e4r en extension till iptables som till\u00e5ter skapandet av regler som matchar mot grupper med t.ex. IP-adresser, n\u00e4tverk och portar. Med grupper kan man f\u00e5 ner antalet regelrader vilket f\u00f6renklar upps\u00e4ttning och fels\u00f6kning samt \u00f6kar skalbarhet och prestanda.</p> <p><code>sudo\u00a0apt-get\u00a0install\u00a0ipset</code> <code>sudo\u00a0dnf\u00a0install\u00a0ipset</code></p> <p>Exempelanv\u00e4ndning, skapa ett set.</p> <p><code>ipset\u00a0-N\u00a0myset\u00a0nethash</code> <code>ipset\u00a0-A\u00a0myset\u00a01.1.1.1</code> <code>ipset\u00a0-A\u00a0myset\u00a02.2.2.2</code> <code>iptables\u00a0-A\u00a0INPUT\u00a0-p\u00a0tcp\u00a0-m\u00a0set\u00a0--set\u00a0myset\u00a0src\u00a0--dport\u00a022\u00a0-j\u00a0ACCEPT</code></p> <p>Kolla grupper</p> <p><code>sudo\u00a0ipset\u00a0list</code></p>"},{"location":"linux_tools/Iptables/#exempelscript","title":"Exempelscript","text":"<pre><code>## Firewall script by Helikopter\n\n# Flush old settings\niptables -F &amp;&amp; iptables -t mangle -F &amp;&amp; iptables -X &amp;&amp; iptables -t mangle -X &amp;&amp; iptables -Z &amp;&amp; ipset destroy\n\n#####################################################################################\n### Standardregler och policy\n\niptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT\niptables -A INPUT -p icmp -j ACCEPT\niptables -A INPUT -i lo -j ACCEPT\n\n# Default policy\niptables -P INPUT DROP\niptables -P OUTPUT ACCEPT\niptables -P FORWARD DROP\n\n\n#####################################################################################\n### Allt gors med grupper som definieras langre ner.\n\n# Skapa grupper\nipset -N SSH nethash\nipset -N TSM nethash\nipset -N HTTPS nethash\n\n\n# Regler, detta ar alla regler.\niptables -A INPUT -p tcp -m set --match-set SSH src --dport 22 -j ACCEPT\niptables -A INPUT -p tcp -m set --match-set TSM src --dport 1501 -j ACCEPT\niptables -A INPUT -p tcp -m set --match-set HTTPS src --dport 443 -j ACCEPT\n\n\n#####################################################################################\n### Har definieras grupperna, lagg IP-adresser har under.\n\n## SSH\nipset -A SSH 172.16.20.0/24\n\n\n## TSM\nipset -A TSM 172.16.10.100\n\n\n## HTTPS\nipset -A HTTPS 10.0.2.0/24\nipset -A HTTPS 10.0.0.0/23\nipset -A HTTPS 172.24.190.110\nipset -A HTTPS 192.168.0.10\n</code></pre> <p>Category:Tools</p>"},{"location":"linux_tools/JQ/","title":"JQ","text":"<p>jq \u00e4r en command-line JSON parser. Som kan anv\u00e4ndas precis lika enkelt som sed,awk och grep anv\u00e4nds f\u00f6r text.</p>"},{"location":"linux_tools/JQ/#installation","title":"Installation","text":"<ul> <li>#tab1|CentOS 7</li> <li>#tab2|Ubuntu 16.04</li> </ul>  K\u00f6r sedan:  `sudo\u00a0yum\u00a0install\u00a0jq` `\u00a0\u00a0`     `sudo\u00a0apt-get\u00a0install\u00a0jq` `\u00a0\u00a0`"},{"location":"linux_tools/JQ/#anvandning","title":"Anv\u00e4ndning","text":"<p>Skaffa lite exempel JSON via Hackernets API d\u00e4r vi s\u00f6ker p\u00e5 alla sidor som inneh\u00e5ller ordet Cisco:</p> <p><code>curl\u00a0'</code><code>https://hackernet.se/api.php?action=query&amp;list=search&amp;srsearch=cisco&amp;format=json</code><code>'</code></p> <p>Pretty-printa JSON koden s\u00e5 den blir l\u00e4sbar:</p> <p><code>curl\u00a0'</code><code>https://hackernet.se/api.php?action=query&amp;list=search&amp;srsearch=cisco&amp;format=json</code><code>'\u00a0|\u00a0jq\u00a0'.'</code></p> <p>Filtrera ut vilka sidor du hitta:</p> <p><code>curl\u00a0'</code><code>https://hackernet.se/api.php?action=query&amp;list=search&amp;srsearch=cisco&amp;format=json</code><code>'\u00a0|\u00a0jq\u00a0'.query.search[].title'</code></p> <p>Filtrera ut titeln och exempel texten fr\u00e5n sidan:</p> <p><code>curl\u00a0'</code><code>https://hackernet.se/api.php?action=query&amp;list=search&amp;srsearch=cisco&amp;format=json</code><code>'\u00a0|\u00a0jq\u00a0'.query.search[]\u00a0|\u00a0{titel:\u00a0.title,\u00a0text:\u00a0.snippet}'</code></p> <p>Sortera sidorna efter l\u00e4gst antal ord:</p> <p><code>curl\u00a0'</code><code>https://hackernet.se/api.php?action=query&amp;list=search&amp;srsearch=cisco&amp;format=json</code><code>'\u00a0|\u00a0jq\u00a0'.query.search\u00a0|\u00a0sort_by(.wordcount)\u00a0|\u00a0.[].title'</code></p> <p>Skapa en URL till varje sida:</p> <p><code>curl\u00a0'</code><code>https://hackernet.se/api.php?action=query&amp;list=search&amp;srsearch=cisco&amp;format=json</code><code>'\u00a0|\u00a0jq\u00a0'.query.search[]\u00a0|\u00a0(\"</code><code>https://hackernet.se/w/\"+</code><code>\"\"+.title)'</code></p>"},{"location":"linux_tools/JQ/#tipsntricks","title":"Tips'N'Tricks","text":"<p>Anv\u00e4nd jqplay f\u00f6r att enkelt skriva jq filter.</p> <p>Category:Guider</p>"},{"location":"linux_tools/Keepalived/","title":"Keepalived","text":"<p>BFD vrrp lvs</p>"},{"location":"linux_tools/Keepalived/#misc_dynamic","title":"misc_dynamic","text":"<p>Misc_dynamic p\u00e5 en misc_check l\u00e5ter dig s\u00e4tta vikten mot din realserver dynamiskt baserat p\u00e5 exitkoden fr\u00e5n ditt script.</p> <p>Exitkod 0 \u00e4r success (of\u00f6r\u00e4ndrad vikt)</p> <p>Exitkod 1 \u00e4r failure (realserver tas ur poolen)</p> <p>Exitkod 2 och h\u00f6gre s\u00e4tts som vikt-2, exitkod 252 t.ex. kommer ge dig en vikt p\u00e5 250.</p> <p>https://www.keepalived.org/</p> <p>Category:Tools</p>"},{"location":"linux_tools/Mdadm/","title":"Mdadm","text":"<p>mdadm \u00e4r ett \u00f6ppet verktyg f\u00f6r att skapa, hantera och monitorera md-raids i Linux. De flesta Debian och Redhat-baserade system har paketet installerat per default men b\u00f6r annars finnas i officiella repos om det skulle fattas.</p> <p>De flesta kommersiella NASar som tex Synology anv\u00e4nder sig av Mdadm f\u00f6r att hantera deras raids, detta g\u00f6r det m\u00f6jligt att flytta \u00f6ver raids och synca till och fr\u00e5n olika enheter som har st\u00f6d f\u00f6r verktyget.</p>"},{"location":"linux_tools/Mdadm/#installation","title":"Installation","text":"<p>sudo apt-get install mdadm sudo yum install mdadm</p>"},{"location":"linux_tools/Mdadm/#raidtyper","title":"Raidtyper","text":"<p>Mdadm har st\u00f6d f\u00f6r standard raidtyper s\u00e5som:</p> <ul> <li>Raid 0</li> <li>Raid 1</li> <li>Raid 4</li> <li>Raid 5</li> <li>Raid 6</li> <li>Raid 10</li> </ul> <p>Mdadm har \u00e4ven st\u00f6d f\u00f6r \"non-raid configurations\" (T\u00e4nk JBOD?): * Linear \u2013 sammanfogar ett antal enheter till en enda stor MD-enhet.</p> <ul> <li>Multipath \u2013 ger flera v\u00e4gar med failover till en enda enhet.</li> <li>Faulty \u2013 skapar ett antal felscenarior (tex l\u00e4s/skrivfel) f\u00f6r test.</li> <li>Container \u2013 en grupp av enheter som hanteras som en enda enhet, d\u00e4r     man kan bygga RAID-system.</li> </ul> <p>WIP!</p> <ul> <li>Tweaks</li> <li>create, assemble, monitor, build, grow, manage</li> <li>exempel</li> </ul>"},{"location":"linux_tools/Mdadm/#create","title":"Create","text":"<p>Att skapa en ny mdadm \u00e4r \u00e4r v\u00e4ldigt strait-forward. Du skapar en array, v\u00e4ljer vilka diskar du ska sl\u00e5 ihop och sedan till vilken raidtyp.</p> <p>N\u00e4r du bygger ihop din raid s\u00e5 kan du k\u00f6ra <code>cat /cat/mdstat</code> f\u00f6r att f\u00e5 fram status fr\u00e5n bygget.</p>"},{"location":"linux_tools/Mdadm/#skapa-array","title":"Skapa array:","text":"<p><code>mdadm --create /dev/md</code><code>X</code></p> <p><code>mdadm --monitor /dev/md</code><code>X</code></p>"},{"location":"linux_tools/Mdadm/#skapa-raid-0","title":"Skapa Raid-0","text":"<p><code>mdadm --create --verbose /dev/md</code><code>X</code><code>--level=stripe --name</code><code>'XXX``</code><code>--raid-devices=</code><code>X</code><code>' /dev/sd</code><code>X</code><code>1 /dev/sd</code><code>X</code><code>1</code></p>"},{"location":"linux_tools/Mdadm/#skapa-raid-1","title":"Skapa raid-1","text":"<p><code>mdadm --create --verbose /dev/md'''X '''--level=mirror --name</code><code>'XXX``</code><code>--raid-devices=</code><code>X</code><code>' /dev/sd</code><code>X</code><code>1 /dev/sd</code><code>X</code><code>1</code></p> <p>...Med spare:</p> <p><code>mdadm --create --verbose /dev/md</code><code>X</code><code>--level=mirror --name</code><code>'XXX``</code><code>--raid-devices=</code><code>X</code><code>/dev/sd</code><code>X</code><code>1</code><code></code><code>/dev/sd</code><code>X</code><code>1`` ``--spare-device=1`` ``/dev/sd</code><code>X</code><code>'</code></p>"},{"location":"linux_tools/Mdadm/#skapa-raid-456","title":"Skapa Raid-4/5/6","text":"<p><code>mdadm --create --verbose /dev/md</code><code>X</code><code>--level=</code><code>4/5/6</code><code>--name</code><code>'XXX``</code><code>--raid-devices=</code><code>X</code><code>' /dev/sd</code><code>X</code><code>1 /dev/sd</code><code>X</code><code>1 /dev/sd</code><code>X</code><code>1 --spare-devices=</code><code>X</code><code>/dev/sd</code><code>X</code><code>1</code></p>"},{"location":"linux_tools/Mdadm/#skapa-raid-10","title":"Skapa Raid-10","text":"<p><code>mdadm --create --verbose /dev/md</code><code>X</code><code>--level raid10 --name</code><code>XXX</code><code>--raid-devices=</code><code>X</code><code>/dev/sd</code><code>X</code><code>1 /dev/sd</code><code>X</code><code>1 /dev/sd</code><code>X</code><code>1 /dev/sd</code><code>X</code><code>1</code></p>"},{"location":"linux_tools/Mdadm/#spara-din-raid-och-skapa-filsystem","title":"Spara din raid och skapa filsystem","text":"<p>Kolla i mdastat<code>cat /cat/mdstat</code>f \u00f6r att se om din raid \u00e4r f\u00e4rdigbyggd och f\u00f6r att se status.</p> <p>OM din raid \u00e4r f\u00e4rdigbyggd s\u00e5 k\u00f6r vi f\u00f6ljande kommando f\u00f6r att spara ner v\u00e5r conf. Om du k\u00f6r n\u00e5gon annan dist, kolla vart din mdadm.conf \u00e4r placerad och skriv till den. '''Detta f\u00e5r inte g\u00f6ras f\u00f6rens din raid \u00e4r f\u00e4rdigbyggd!! '''</p> <p>RHEL/CentOS/Fedora:</p> <p><code>mdadm --detail --scan &gt;&gt; /etc/mdadm.conf</code></p> <p>Nu kan vi skapa ett filsystem p\u00e5 v\u00e5r raid</p> <p>ext4:</p> <p><code>mkfs -t ext4ext4 /dev/</code>md'''X '''</p> <p>XFS:</p> <p>F\u00f6r XFS beh\u00f6ver du speca SU som \u00e4r samma som mdadm-raidens chunk size. F\u00f6ra att f\u00e5 fram chunk size kan du k\u00f6ra <code>mdadm --detail /dev/md</code><code>X</code></p> <p>Du beh\u00f6ver ocks\u00e5 speca sw, vilket \u00e4r hur m\u00e5nga data-diskar du har (ej spares etc).</p> <ul> <li>RAID 0 med 2 diskar: 2 data diskar (n)</li> <li>RAID 1 med 2 diskar: 1 data disk (n/2)</li> <li>RAID 10 med 10 diskar: 5 data diskar (n/2)</li> <li>RAID 5 med 6 diskar (inga spares): 5 data diskar (n-1)</li> <li>RAID 6 med 6 diskar (inga spares): 4 data diskar (n-2)</li> </ul> <p><code>mkfs -t xfs -d su=</code><code>X</code><code>k -d sw=</code><code>X</code><code>/dev/md</code><code>X</code></p> <p>Tex: raid 5 med 4 diskar med en chunksize p\u00e5 64k:</p> <p><code>mkfs -t xfs -d su=64k -d sw=3 /dev/md</code><code>X</code></p>"},{"location":"linux_tools/Mdadm/#flytta-en-mdadm-raid","title":"Flytta en mdadm raid","text":"<p>L\u00e4ttast om du sparar din /etc/mdadm.conf eller ARRAY-rader fr\u00e5n konfen och flyttar med den/dessa till din nya maskin. Skulle inte det fungera s\u00e5 \u00e4r det inte hela v\u00e4rlden.</p> <p>Vi b\u00f6rjar med worst-case, du har inte sparat conf eller ARRAY-info som UUID, namn etc:</p> <p>1: Installera mdadm p\u00e5 server B och st\u00e4ng av servern</p> <p>2: koppla in dina diskar och starta upp servern igen.</p> <p>3: Kolla s\u00e5 alla diskar \u00e4r hittade under /dev/. \u00c4r alla d\u00e4r s\u00e5 kan du k\u00f6ra antingen <code>cat /proc/mdstat</code> eller <code>ls -l /dev/md/</code><code>(tabba fram)</code> f\u00f6r att f\u00e5 fram vilken md-device din raid ligger som just nu. <p>4. S\u00e4g att din raid ligger hittad som /dev/md127, k\u00f6r d\u00e5 <code># mdadm --detail /dev/md127</code>. N\u00e4r detta k\u00f6rs b\u00f6r du f\u00e5r fram all info du beh\u00f6ver. Dvs 'Version, Namn och UUID'.</p> <p>5. K\u00f6r kommandot: <code>echo &gt;&gt; ARRAY /dev/md</code><code>X</code><code>metadata=</code><code>\"Version\"</code><code>name=</code><code>\"namn\"</code><code>UUID='''\"uuid\" '''/etc/mdadm.conf</code> '''NOTICE: '''Du f\u00e5r l\u00e4gga din array vart du vill, \u00e4ven om md127 var d\u00e4r den hittades s\u00e5 kan du l\u00e4gga den p\u00e5 tex /dev/md0. Se bara till s\u00e5 att md0 inte \u00e4r upptagen. Detta kommando l\u00e4gger till din \"nya\" array i mdadm-confen som l\u00e4ses in varje uppstart.</p> <p>6. Reboot och <code>cat /proc/mdstat</code> f\u00f6r att se hur din raid bygger ihop sig.</p> <p>7. N\u00e4r raiden har byggt ihop sig s\u00e5 kan du mounta, jag f\u00f6redrar att mounta via fstab och UUID. Exempel p\u00e5 fstab conf:</p> <p><code>UUID='''\"RaidUUID\" ''' /mount/point xfs defaults 0 0</code></p> <p>OBS Vet inte om det st\u00e5r n\u00e5got v\u00e4rdefullt h\u00e4r men det kan nog dut avg\u00f6ra b\u00e4ttre //Alex</p> <p><code>http://h3x.no/2011/07/09/tuning-ubuntu-mdadm-raid56</code></p> <p>Category:Tools</p>"},{"location":"linux_tools/NTP/","title":"NTP","text":"<p>St\u00e4ll klockan r\u00e4tt, slipp problem.</p> <p>Ntpdate: eng\u00e5ngssynkroniseringar (deprecated sedan 2012) Ntpd: automatisk tidssynkronisering SNTP: Simple NTP \u00e4r inte lika p\u00e5litligt eller noggrannt som NTP Ntpd &gt;= ntpdate + crontab</p> <p><code>yum/apt-get\u00a0install\u00a0ntp</code></p> <p>Konfiguration</p> <p><code>nano\u00a0/etc/ntp.conf</code> <code>server\u00a010.0.0.10</code></p> <p>Verifiera</p> <p><code>ntptrace</code> <code>ntpq\u00a0-pn</code></p>"},{"location":"linux_tools/NTP/#time-zone","title":"Time Zone","text":"<p><code>timedatectl</code> <code>sudo\u00a0timedatectl\u00a0set-timezone\u00a0Europe/Stockholm</code></p> <p>Category:Tools</p>"},{"location":"linux_tools/Nameif/","title":"Nameif","text":"<p>N\u00e4r Linuxk\u00e4rnan bootar tilldelas namn till n\u00e4tverksinterfacen i den ordning som den finner dem. Detta inneb\u00e4r att tv\u00e5 olika versioner av k\u00e4rnan kan hitta interfacen i olika ordning. N\u00e4r detta h\u00e4nder kan du beh\u00f6va byta all konf f\u00f6r att f\u00e5 ig\u00e5ng det igen. Ett s\u00e4tt att undvika detta \u00e4r med udev-regler, ett annat \u00e4r att namnge interfacen med nameif.</p> <p><code>sudo\u00a0yum\u00a0install\u00a0net-tools</code></p> <p><code>sudo\u00a0nano\u00a0/etc/mactab</code> <code>#\u00a0This\u00a0file\u00a0relates\u00a0MAC\u00a0addresses\u00a0to\u00a0interface\u00a0names.</code> <code>eth0\u00a000:60:97:52:2A:94</code> <code>eth1\u00a000:A0:C9:43:1F:77</code></p> <p>Ta ner interfacen och k\u00f6r kommandot nameif alternativt reboota maskinen.</p> <p>Category:Tools</p>"},{"location":"linux_tools/Psql/","title":"Psql","text":"<p>psql \u00e4r terminalgr\u00e4nssnittet f\u00f6r att jobba mot PostgreSQL.</p> <p>Dokumentation: https://www.postgresql.org/docs/current/app-psql.html Anslutning</p> <p><code>psql\u00a0-h\u00a0v\u00e4rdnamn\u00a0-d\u00a0databas\u00a0-U\u00a0anv\u00e4ndare\u00a0-W</code></p> <p>Lista Databaser</p> <p><code>\\l</code></p> <p>Anslut till en specifik databas</p> <p><code>\\c\u00a0databas</code></p> <p>Lista tabeller</p> <p><code>\\dt</code></p> <p>Beskriv en tabell</p> <p><code>\\d\u00a0tabellnamn</code></p> <p>Visa kommandhistoriken</p> <p><code>\\s</code></p> <p>Category:Tools</p>"},{"location":"linux_tools/Rsync/","title":"Rsync","text":"<p>Rsync \u00e4r ett verktyg som skapats f\u00f6r att tillhandah\u00e5lla smidig och inkrementell fil\u00f6verf\u00f6ring. Det \u00e4r en ers\u00e4ttning f\u00f6r scp och rcp och \u00e4r ett bra s\u00e4tt att ladda upp filer till en fj\u00e4rrserver. Rsync kan k\u00f6ras \u00f6ver 2 olika protokoll.</p> <p>SSH mode Detta \u00e4r default och \u00e4r vad som anv\u00e4nds om man inte anger n\u00e5gon v\u00e4xel. All data skickas krypterat med SSH.</p> <p>Daemon mode Med detta skickas datan med ett eget rsync-protokoll som g\u00e5r mot TCP 873. Ingen kryptering av kommunikationen men funkar bra inom LAN alternativt \u00f6ver VPN-tunnlar. Vissa NAS-servrar st\u00f6djer endast denna variant.</p>"},{"location":"linux_tools/Rsync/#installation","title":"Installation","text":"<p><code>sudo\u00a0apt-get\u00a0install\u00a0rsync</code> <code>sudo\u00a0yum\u00a0install\u00a0rsync</code></p>"},{"location":"linux_tools/Rsync/#kommando","title":"Kommando","text":"<p><code>rsync\u00a0[options]\u00a0[source\u00a0directory]\u00a0[target\u00a0directory]</code></p> <p>Exempel</p> <p><code>rsync\u00a0-Pavz\u00a0/local/directory/\u00a0root@10.0.0.11:/remote/directory/</code></p> <p>J\u00e4mf\u00f6r source och destination och kopiera \u00f6ver det som inte finns i remote directory. OBS a trailing slash on the source directory means that the source directory's contents are copied, not the directory itself.</p> <ul> <li>-h, human-readable: Number outputs are human readable</li> <li>-v, verbose: Displays more output</li> <li>-z, compress: Compress file data during transfer</li> <li>-P, show progress</li> <li>-a, archive mode: En sammanslagning av options och best\u00e5r av     f\u00f6ljande:</li> <li>-r, operate recursively</li> <li>-l, preserve links</li> <li>-p, preserve permissions</li> <li>-t, preserve times</li> <li>-g, preserve groups</li> <li>-o, preserve owner</li> <li>-D, preserve device files and special files</li> </ul>"},{"location":"linux_tools/Rsync/#cron","title":"Cron","text":"<p>Vill man ha automatisk synkning kan man schemal\u00e4gga rsync-jobb enkelt med cron. Anv\u00e4nd SSH-nycklar f\u00f6r smidig autentisering.</p>"},{"location":"linux_tools/Rsync/#link-destination","title":"Link Destination","text":"<p>Category:Tools</p>"},{"location":"linux_tools/Scapy/","title":"Scapy","text":"<p>Scapy \u00e4r ett kraftfullt och interaktivt paketmanipulationsprogram. Det kan f\u00f6rfalska och avkoda paket av flera protokoll samt skicka ut dem p\u00e5 tr\u00e5d. Det kan hantera de flesta klassiska uppgifter som skanning, tracerouting, enhetstester, attacker eller n\u00e4tverksidentifiering. Scapy \u00e4r skrivet i Python. Enligt utvecklaren kan Scapy ers\u00e4tta hping, 85% av Nmap, arpspoof, arp -sk, arping, tcpdump, tethereal samt p0f.</p> <p>Grunder:</p> <p><code>Lista\u00a0protokoll\u00a0och\u00a0alternativ</code> <code>ls()</code> <code>Lista\u00a0inbyggda\u00a0kommandofunktioner</code> <code>lsc()</code> <code>Visa/s\u00e4tt\u00a0konfiguration</code> <code>conf</code> <code>Skicka\u00a0paket\u00a0p\u00e5\u00a0lager\u00a03</code> <code>send()</code> <code>Skicka\u00a0paket\u00a0p\u00e5\u00a0lager\u00a02</code> <code>sendp()</code></p> <p>Anv\u00e4ndbara exempel:</p> <p><code>sendp(Ether(src='00:50:56:22:33:e7',\u00a0dst='00:50:56:cc:aa:af')/IPv6(src='2001::5',\u00a0dst='2001::10',\u00a0hlim=64)/ICMPv6EchoRequest(data=''))</code></p> <p>Category:Tools</p>"},{"location":"linux_tools/System_storage_manager/","title":"System storage manager","text":"<p>System storage manager aka ssm, \u00e4r ett CLI program som ska vara enkelt att anv\u00e4nda. Det har st\u00f6d f\u00f6r bla BTRFS, RAID och krypterade volymer. SSM anv\u00e4nder flera verktyg, bl.a. Mdadm, Cryptsetup, device-mapper och LVM2.</p>"},{"location":"linux_tools/System_storage_manager/#installera","title":"Installera","text":"<p><code>yum\u00a0install\u00a0system-storage-manager.noarch</code> <code>apt-get\u00a0install\u00a0system-storage-manager</code></p> <p>Verify</p> <p><code>sudo\u00a0ssm\u00a0list</code></p>"},{"location":"linux_tools/System_storage_manager/#utoka-en-lvm-volume","title":"Ut\u00f6ka en LVM volume","text":"<p>Ta reda p\u00e5 vilken volume du vill ut\u00f6ka:</p> <p><code>ssm\u00a0list\u00a0volumes</code></p> <p>F\u00f6r att ut\u00f6ka med 10Gb:</p> <p><code>ssm\u00a0resize\u00a0-s+10G\u00a0/dev/centos/root</code></p> <p>Category:Tools</p>"},{"location":"linux_tools/Systemd/","title":"Systemd","text":"<p>Systemd \u00e4r ett init-system och en service-hanterare som \u00e4r standard f\u00f6r de flesta linux-distar. Det grundl\u00e4ggande syftet med ett init-system \u00e4r att initiera de komponenter som m\u00e5ste startas efter att Linuxk\u00e4rnan har startat. Systemd \u00e4r det f\u00f6rsta som startar efter att kernel har startat och f\u00e5r alltid Process ID 1. Init-systemet anv\u00e4nds ocks\u00e5 f\u00f6r att hantera tj\u00e4nster och demoner f\u00f6r servern medan systemet \u00e4r ig\u00e5ng.</p> <p>Default sedan: Debian 8 Ubuntu 15.04 Fedora 15 RHEL 7 CentOS 7</p>"},{"location":"linux_tools/Systemd/#systemctl","title":"Systemctl","text":"<p>Systemctl \u00e4r det centrala verktyget f\u00f6r att kontrollera init-systemet. Systemctl ers\u00e4tter service och chkconfig. Grundfunktioner</p> <p><code>systemctl\u00a0start\u00a0sshd</code> <code>systemctl\u00a0stop\u00a0sshd</code> <code>systemctl\u00a0reload\u00a0sshd</code> <code>systemctl\u00a0restart\u00a0sshd</code></p> <p>Status</p> <p><code>systemctl\u00a0status\u00a0sshd</code></p> <p>Autostarta en service</p> <p><code>systemctl\u00a0enable\u00a0sshd</code> <code>systemctl\u00a0disable\u00a0sshd</code></p> <p>Lista alla aktiva enheter</p> <p><code>systemctl</code></p> <p>Lista alla enheter</p> <p><code>systemctl\u00a0list-units\u00a0--all</code></p> <p>OBS .service beh\u00f6ver inte skrivas ut, det l\u00e4ggs till efter tj\u00e4nsten automatiskt Fler kommandon</p> <p><code>systemctl\u00a0show\u00a0sshd.service</code> <code>systemctl\u00a0list-dependencies\u00a0sshd.service</code></p> <p>Titta p\u00e5 senaste uppstart grafiskt. Testa detta, seri\u00f6st det \u00e4r coolt!</p> <p><code>systemd-analyze\u00a0plot\u00a0&gt;\u00a0plot.svg</code></p>"},{"location":"linux_tools/Systemd/#lagga-till-egna-services","title":"L\u00e4gga till egna services","text":"<p>Under <code>/etc/systemd/system</code> kan man l\u00e4gga till egna services som man vill hantera med systemd.</p> <p>En basic service fil ser ut s\u00e5 h\u00e4r.</p> <p><code>[Unit]</code> <code>Description=Hello\u00a0world</code> <code>After=network-online.target</code> <code>Wants=network-online.target</code></p> <p><code>[Service]</code> <code>ExecStart=/usr/bin/echo\u00a0\"Hello\u00a0world!\"</code></p> <p><code>[Install]</code> <code>WantedBy=multi-user.target</code></p> <p>Om servicen kr\u00e4ver att det finns n\u00e4tverk f\u00f6re den startar kan man skriva After/Wants=network-online.target d\u00e5 kommer servicen att f\u00f6rs\u00f6ka starta efter serverns n\u00e4tverk har g\u00e5tt upp och den har f\u00e5tt en routebar IP.</p> <p>F\u00f6r att systemd ska k\u00f6ra servicen vid boot m\u00e5ste man k\u00f6ra enable.</p> <p><code>systemctl\u00a0enable\u00a0/etc/systemd/system/hello.service</code></p> <p>F\u00f6r att starta tj\u00e4nsten skriv.</p> <p><code>systemctl\u00a0start\u00a0hello.service</code></p>"},{"location":"linux_tools/Systemd/#overvaka-en-service","title":"\u00d6vervaka en service","text":"<p>Med systemd kan man \u00f6vervaka en tj\u00e4nst s\u00e5 att den startas automatiskt om den skulle krasha.</p> <p><code>systemctl\u00a0edit\u00a0sshd</code></p> <p>Skriv sedan in:</p> <p><code>[Service]</code> <code>Restart=always</code></p> <p>Spara sedan filen. Den kommer att sparas under /etc/systemd/system/sshd.service.d/overrides.conf</p> <p>Vill du ha en delay innan systemd startas tj\u00e4nsten igen s\u00e5 g\u00e5r det ocks\u00e5 med:</p> <p><code>RestartSec=30</code></p> <p>K\u00f6r sedan en reload:</p> <p><code>systemctl\u00a0daemon-reload</code></p>"},{"location":"linux_tools/Systemd/#journald","title":"Journald","text":"<p>Journald \u00e4r en systemd-komponent som har hand om loggar fr\u00e5n applikationer och k\u00e4rna. Kommandot man anv\u00e4nder \u00e4r journalctl. K\u00f6r igenom dessa f\u00f6r att bilda dig en uppfattning av vad de g\u00f6r och hur de fungerar.</p> <p><code>journalctl</code> <code>journalctl\u00a0-k</code> <code>journalctl\u00a0-u\u00a0nginx.service</code> <code>journalctl\u00a0-u\u00a0nginx.service\u00a0--since\u00a0today</code> <code>journalctl\u00a0_PID=8088</code> <code>journalctl\u00a0--disk-usage</code></p>"},{"location":"linux_tools/Systemd/#networkd","title":"Networkd","text":"<p><code>systemctl\u00a0start\u00a0systemd-networkd</code> <code>networkctl</code> <code>networkctl\u00a0status</code></p>"},{"location":"linux_tools/Systemd/#nspawn","title":"Nspawn","text":"<p>Systemd-nspawn \u00e4r en container manager som \u00e4r inbyggd i systemd. Debian</p> <p><code>apt-get\u00a0install\u00a0-y\u00a0dbus\u00a0debootstrap\u00a0bridge-utils</code> <code>debootstrap\u00a0--arch=amd64\u00a0jessie\u00a0/var/lib/machines/container1/</code> <code>systemd-nspawn\u00a0-D\u00a0/var/lib/machines/container1/\u00a0--machine\u00a0first_container\u00a0-b</code></p> <p>OBS med denna setup delas network namespace med v\u00e4rdhosten. Annars m\u00e5ste man skapa en brygga och koppla containern till den.</p> <p><code>systemd-nspawn\u00a0-D\u00a0/var/lib/machines/container1/\u00a0--machine\u00a0second_container\u00a0--network-bridge=my-bridge\u00a0-b</code></p> <p>Kolla containers</p> <p><code>machinectl</code> <code>machinectl\u00a0status\u00a0first_container</code> <code>machinectl\u00a0login\u00a0first_container</code></p>"},{"location":"linux_tools/Systemd/#template-unit","title":"Template unit","text":"<p>En template unit g\u00e5r att identifera med hj\u00e4lp av @ som \u00e4r efter base unit namnet och f\u00f6re unit type suffixen.</p> <p><code>openvpn-client@.service</code></p> <p>F\u00f6r att anv\u00e4nda sig av en template unit s\u00e5 l\u00e4gger man in en instance identifier mellan @ och punkten n\u00e4r man kallar p\u00e5 den med <code>systemctl start</code> eller annat kommando.</p> <p><code>openvpn-client@</code><code>hackernet-vpn</code><code>.service</code></p> <p>Med detta s\u00e4ttet s\u00e5 beh\u00f6ver man bara en unit fil ist\u00e4llet f\u00f6r en fil per instans man f\u00f6rs\u00f6ker starta.</p>"},{"location":"linux_tools/Systemd/#variabler","title":"Variabler","text":"<ul> <li><code>%n</code>: Ger hela unit namnet. Ex:     openvpn-client@hackernet-vpn.service</li> <li><code>%N</code>: Samma som ovan fast all escape tecken kommer vara omv\u00e4nd.     Ex: openvpn-client@hackernet-vpn</li> <li><code>%p</code>: Ger unit namnet som \u00e4r f\u00f6re @. Ex: openvpn-client</li> <li><code>%P</code>: Samma som ovan fast escape \u00e4r omv\u00e4nt. Ex: openvpn/client</li> <li><code>%i</code>: Ger det som \u00e4r efter @ och punkten. Ex: hackernet-vpn</li> <li><code>%I</code>: Samma som ovan fast escape \u00e4r omv\u00e4nt. Ex: hackernet/vpn</li> <li><code>%f</code>: Samma som ovan och den l\u00e4gger p\u00e5 ett / f\u00f6re. Ex:     /hackernet/vpn</li> <li><code>%u</code>: Vilken anv\u00e4ndare som \u00e4r confad att k\u00f6ra uniten. Ex: root</li> <li><code>%U</code>: Samma som ovan fast visar <code>UID</code> ist\u00e4llet. Ex: 0</li> <li><code>%h</code>: Visar vart anv\u00e4ndarens home folder finns. Ex: /root</li> <li><code>%H</code>: Visar hostnamnet p\u00e5 servern. Ex vpnserver</li> <li><code>%s</code>: Visar anv\u00e4ndarens shell. Ex: /bin/sh</li> <li><code>%v</code>: Visar vilken kernel release som k\u00f6rs. Samma svar som     <code>uname -r</code>. Ex: 3.10.0-514.6.1.el7.x86_64</li> <li><code>%%</code>: Anv\u00e4nds f\u00f6r att skapa ett procent tecken.</li> </ul>"},{"location":"linux_tools/Systemd/#exempel-template-unit","title":"Exempel template unit","text":"<p>Category:Tools</p>"},{"location":"linux_tools/Tcpdump/","title":"Tcpdump","text":"<p>Tcpdump \u00e4r ett verktyg f\u00f6r att se vilka paket som g\u00e5r via ett interface och g\u00f6ra lite grundl\u00e4ggande fels\u00f6kning.</p>"},{"location":"linux_tools/Tcpdump/#installation","title":"Installation","text":"<p>Debian/Ubuntu</p> <p><code>apt-get\u00a0install\u00a0tcpdump</code></p>"},{"location":"linux_tools/Tcpdump/#vanliga-vaxlar","title":"Vanliga V\u00e4xlar","text":"<ul> <li>-i<ul> <li>Val av interface att lyssna p\u00e5</li> </ul> </li> <li>-T<ul> <li>Paket typ t.ex. carp, snmp eller radios</li> </ul> </li> <li>-n<ul> <li>G\u00f6r ingen reverse lookup p\u00e5 IP</li> </ul> </li> <li>-c<ul> <li>Antal paket innan klar (standard \u00e4r undef)</li> </ul> </li> </ul>"},{"location":"linux_tools/Tcpdump/#uttryck","title":"Uttryck","text":"<p>tcpdump visar alla paket som matchar det angivna uttrycket och anv\u00e4nder samma syntax som pcap-filter</p>"},{"location":"linux_tools/Tcpdump/#exempel","title":"Exempel","text":"<ul> <li>tcpdump -i eth0 port 67 or port 68<ul> <li>Lyssnar efter DHCP paket p\u00e5 eth0</li> </ul> </li> <li>tcpdump -i eth0 src 10.20.30.40<ul> <li>Lyssnar efter paket med 10.20.30.40 som source address</li> </ul> </li> <li>tcpdump -i eth0 host 10.20.30.40<ul> <li>Lyssnar efter paket som inneh\u00e5ller 10.20.30.40</li> </ul> </li> </ul> <p>Category:Tools</p>"},{"location":"linux_tools/Tmux/","title":"Tmux","text":"<p>Tmux \u00e4r en terminal multiplexer precis som screen. En f\u00f6rdel med att anv\u00e4nda terminal multiplexers \u00e4r att du inte tappar dina shell f\u00f6nster om du skulle tappa anslutningen eller vill forts\u00e4tta jobbet p\u00e5 en annan dator.</p>"},{"location":"linux_tools/Tmux/#installation","title":"Installation","text":"<p>Tmux \u00e4r enkelt att installera och finns redan f\u00e4rdig packat i dom flesta distars repos.</p> <p>Debian baserade</p> <p><code>apt-get\u00a0install\u00a0tmux</code></p> <p>RHEL baserade</p> <p><code>yum\u00a0install\u00a0epel-release</code> <code>yum\u00a0install\u00a0tmux</code></p>"},{"location":"linux_tools/Tmux/#kommandon","title":"Kommandon","text":"<p>Starta tmux,</p> <p><code>tmux</code></p> <p>Lista tmux sessioner,</p> <p><code>tmux\u00a0ls</code></p> <p>Attach till en session</p> <p><code>tmux\u00a0attach</code></p> <p>Attach till en session och detach andra som \u00e4r anslutna till samma session.</p> <p><code>tmux\u00a0attach\u00a0-d</code></p> <p>Attach till en session om man har flera ig\u00e5ng.(Byt # mot siffra)</p> <p><code>tmux\u00a0a\u00a0-t\u00a0#</code></p> <p>St\u00e4ng en session(Byt # mot en siffra)</p> <p><code>tmux\u00a0kill-session\u00a0-t\u00a0#</code></p>"},{"location":"linux_tools/Tmux/#keybinds","title":"Keybinds","text":"<p>Default prefix f\u00f6r tmux \u00e4r .</p> <p>- Skapa ett nytt f\u00f6nster.</p> <p>- G\u00e5 till n\u00e4sta eller f\u00f6reg\u00e5ende f\u00f6nster.</p> <p>- Byt f\u00f6nster.</p> <p>- Meny med alla f\u00f6nster.</p> <p>- St\u00e4ng ett f\u00f6nster.</p> <p>- Byt namn p\u00e5 ett f\u00f6nster.</p> <p>- Splitta f\u00f6nster horisontellt.</p> <p>- Splitta f\u00f6nster vertikalt.</p> <p>- F\u00f6r att hoppa imellan paneler.</p> <p>- St\u00e4ng den aktiva panelen.</p> <p>- Skapa ett nytt f\u00f6nster med den aktiva panelen.</p> <p>- Zooma in ett f\u00f6nster.</p> <p>- Copy l\u00e4ge.</p> <ul> <li> <p>- F\u00f6r att b\u00f6rja markera text i copy l\u00e4get.</p> </li> <li> <p>F\u00f6r att kopiera den markerade texten.</p> </li> </ul> <p>- Klistra in den kopierade texten.</p> <p>- F\u00f6r att deattacha en session.</p> <p>- F\u00f6r att scrolla upp och ner.</p>"},{"location":"linux_tools/Tmux/#tmux-plugin-manager","title":"Tmux Plugin Manager","text":"<p>Kr\u00e4ver version 1.9 eller h\u00f6gre. Plugins som g\u00f6r ditt Tmux f\u00f6nster lite trevligare.</p>"},{"location":"linux_tools/Tmux/#installera","title":"Installera","text":"<p><code>git\u00a0clone</code><code>https://github.com/tmux-plugins/tpm</code><code>~/.tmux/plugins/tpm</code></p> <p>Skapa filen <code>.tmux.conf</code> i din home folder.</p> <p><code>#\u00a0List\u00a0of\u00a0plugins</code> <code>set\u00a0-g\u00a0@plugin\u00a0'tmux-plugins/tpm'</code> <code>set\u00a0-g\u00a0@plugin\u00a0'tmux-plugins/tmux-sensible'</code></p> <p><code>#\u00a0Other\u00a0examples:</code> <code>#\u00a0set\u00a0-g\u00a0@plugin\u00a0'github_username/plugin_name'</code> <code>#\u00a0set\u00a0-g\u00a0@plugin\u00a0'git@github.com/user/plugin'</code> <code>#\u00a0set\u00a0-g\u00a0@plugin\u00a0'git@bitbucket.com/user/plugin'</code></p> <p><code>#\u00a0Initialize\u00a0TMUX\u00a0plugin\u00a0manager\u00a0(keep\u00a0this\u00a0line\u00a0at\u00a0the\u00a0very\u00a0bottom\u00a0of\u00a0tmux.conf)</code> <code>run\u00a0'~/.tmux/plugins/tpm/tpm'</code></p> <p>Ladda sedan TPM genom att starta om din tmux session eller ladda om confen med.</p> <p><code>tmux\u00a0source\u00a0~/.tmux.conf</code></p>"},{"location":"linux_tools/Tmux/#lagga-till-plugins","title":"L\u00e4gga till plugins","text":"<p>Plugins finns p\u00e5 TPM's Github</p> <p>L\u00e4gg sedan till pluginet i <code>.tmux.conf</code> med kommandot <code>set -g @plugin '...'</code></p> <p>\u00d6ppna sedan Tmux och tryck f\u00f6r att installera.</p> <p><code>prefix\u00a0+\u00a0I</code></p> <p>Ta bort plugin genom att ta bort raden kommentera ut den i <code>.tmux.conf</code> och tryck.</p> <p><code>prefix\u00a0+\u00a0alt\u00a0+\u00a0u</code></p>"},{"location":"linux_tools/Tmux/#bra-plugins","title":"Bra plugins","text":"<p>Sensible - Ett g\u00e4ng inst\u00e4llningar som man b\u00f6r ha.</p> <p>Resurrect - Spara din nuvarande Tmux session.</p> <p>Continuum - Autosparar din nuvarande Tmux session.(Kr\u00e4ver resurrect)</p> <p>Sidebar - \u00d6ppnar en tree liknande sidebar.</p> <p>Vim-tmux - Fixar visa saker i vim som inte funkar s\u00e5 bra annars.</p> <p>tmux-logging - Toggla av/p\u00e5 f\u00f6r att logga en pane till textfil, \"screencapture\" p\u00e5 en pane, eller spara all historik i en pane till textfil.</p>"},{"location":"linux_tools/Tmux/#auto-attach","title":"Auto attach","text":"<p>L\u00e4gg detta i din <code>.bashrc</code> f\u00f6r att automatiskt starta tmux och attacha till en session vid inloggning.</p> <pre><code>if  -z \"$TMUX\" ; then\n   tmux has-session &amp;&gt; /dev/null\n   if [ $? -eq 1 ]; then\n     exec tmux new\n     exit\n   else\n     exec tmux attach\n     exit\n   fi\nfi\n</code></pre>"},{"location":"linux_tools/Tmux/#tipsntrix","title":"Tips'n'trix","text":""},{"location":"linux_tools/Tmux/#for-att-skriva-till-alla-panes-samtidigt","title":"F\u00f6r att skriva till alla panes samtidigt.","text":"<p><code>:setw\u00a0synchronize-panes</code></p>"},{"location":"linux_tools/Tmux/#clear-history","title":"Clear-history","text":"<p><code>:clear-history</code></p> <p>Eller binda det till</p> <p><code>bind\u00a0-n\u00a0C-k\u00a0clear-history</code></p>"},{"location":"linux_tools/Tmux/#problem-att-piltangenterna-inte-fungerar","title":"Problem att piltangenterna inte fungerar?","text":"<p>Uppt\u00e4ckte problemet n\u00e4r jag var ansluten till senare versioner av JunOS. Att jag var tvungen att skriva om alla kommandon igen f\u00f6r att jag inte kunde trycka fram det senast k\u00f6rda kommandona. Efter att ha lagt till f\u00f6ljande i min .tmux.conf fil s\u00e5 fungera det igen.</p> <p><code>set\u00a0-g\u00a0default-terminal\u00a0\"xterm-256color\"</code></p>"},{"location":"linux_tools/Tmux/#byt-pane-snabbt-utan-prefix","title":"Byt pane snabbt utan prefix","text":"<p>L\u00e4gg till f\u00f6ljande i din tmux.conf f\u00f6r att kunna byta pane med .</p> <p><code>bind\u00a0-n\u00a0M-Left\u00a0select-pane\u00a0-L</code> <code>bind\u00a0-n\u00a0M-Right\u00a0select-pane\u00a0-R</code> <code>bind\u00a0-n\u00a0M-Up\u00a0select-pane\u00a0-U</code> <code>bind\u00a0-n\u00a0M-Down\u00a0select-pane\u00a0-D</code></p>"},{"location":"linux_tools/Tmux/#byt-window-utan-prefix","title":"Byt window utan prefix","text":"<p>L\u00e4gg till f\u00f6ljande f\u00f6r att byta window med</p> <p><code>bind\u00a0-n\u00a0S-Left\u00a0\u00a0previous-window</code> <code>bind\u00a0-n\u00a0S-Right\u00a0next-window</code></p> <p>Category:Tools</p>"},{"location":"linux_tools/Tree/","title":"Tree","text":"<p>Tree \u00e4r ett program som listar directories rekursivt.</p> <p>Installation</p> <p><code>sudo\u00a0apt-get\u00a0install\u00a0tree</code></p> <p>Lista directories rekursivt</p> <p><code>tree</code></p> <p>Skapa sig en \u00f6verblick \u00f6ver ett programs filstruktur</p> <p><code>tree\u00a0-h\u00a0/etc/apache2/</code></p> <p>Hitta stora filer</p> <p><code>tree\u00a0-h\u00a0/var/\u00a0|\u00a0grep\u00a0G]</code></p> <p>Category:Tools</p>"},{"location":"unifi/UniFi/","title":"UniFi","text":"<p>Ubiquiti UniFi Controller kan managera accesspunkter, switchar och gateways av m\u00e4rket Ubiquiti. Det st\u00f6ds p\u00e5 Ubuntu, Debian och Windows.</p>"},{"location":"unifi/UniFi/#installation","title":"Installation","text":"<p>Ubuntu</p> <p><code>echo\u00a0\"deb</code><code>http://www.ubnt.com/downloads/unifi/debian</code><code>unifi4\u00a0ubiquiti\"\u00a0&gt;\u00a0/etc/apt/sources.list.d/20ubiquiti.list</code> <code>echo\u00a0\"deb</code><code>http://downloads-distro.mongodb.org/repo/debian-sysvinit</code><code>dist\u00a010gen\"\u00a0&gt;\u00a0/etc/apt/sources.list.d/21mongodb.list</code></p> <p><code>apt-key\u00a0adv\u00a0--keyserver\u00a0keyserver.ubuntu.com\u00a0--recv\u00a0C0A52C50</code> <code>apt-key\u00a0adv\u00a0--keyserver\u00a0keyserver.ubuntu.com\u00a0--recv\u00a07F0CEB10</code> <code>apt-get\u00a0-q\u00a0update\u00a0&amp;&amp;\u00a0apt-get\u00a0install\u00a0-qy\u00a0--force-yes\u00a0unifi</code></p> <p>Access web interface</p> <p><code>https://unifi-ip:8443</code></p>"},{"location":"unifi/UniFi/#lagga-till-device-manuellt","title":"L\u00e4gga till device manuellt","text":"<p>SSH'a till din Ubiquiti device.</p> <p>Default username och password \u00e4r: ubnt</p> <p>F\u00f6r att l\u00e4gga till devicen k\u00f6r:</p> <p><code>set-inform</code><code>http://</code><code>:8080/inform</code> <p>Kolla i webuit efter din device och klicka adopt.</p> <p>K\u00f6r sedan samma set-inform kommando igen.</p>"},{"location":"unifi/UniFi/#factory-default","title":"Factory default","text":""},{"location":"unifi/UniFi/#access-point","title":"Access point","text":"<p>SSHa och k\u00f6r f\u00f6ljande kommando:</p> <p><code>syswrapper.sh\u00a0restore-default</code></p>"},{"location":"unifi/UniFi/#switch","title":"Switch","text":"<p>SSHa eller console och k\u00f6r f\u00f6ljande:</p> <p><code>set-default</code></p>"},{"location":"unifi/UniFi/#cli-kommandon","title":"CLI kommandon","text":"<p>Visa arp och mac tabellen:</p> <p><code>ubntbox\u00a0swctrl\u00a0-d\u00a0mac\u00a0show</code></p> <p>Visa port status:</p> <p><code>ubntbox\u00a0swctrl\u00a0-d\u00a0port\u00a0show</code></p> <p>Visa startup-config:</p> <p><code>cat\u00a0/var/run/fastpath/startup-config</code></p> <p>Category:Guider</p>"},{"location":"vmware/Distributed_Switch/","title":"Distributed Switch","text":"<p>vSphere Distributed Switch (vDS) \u00e4r en mer skalbar variant av virtuell switch som \u00e4r tillg\u00e4nglig via Enterprise Plus-licensen.</p>"},{"location":"vmware/Distributed_Switch/#grundlaggande-om-vds","title":"Grundl\u00e4ggande om vDS","text":"<p>Till skillnad fr\u00e5n vSphere Standard Switchar \u00e4r Distributed Switcharna just distribuerade mellan de hostar i ett Datacenter som kopplats till dem. Uplinks och Port Groups \u00e4r d\u00e4rf\u00f6r ocks\u00e5 automatiskt distribuerade till alla hostar. F\u00f6r att skapa en vDS, H\u00f6gerklicka p\u00e5 Datacenter-objektet -&gt; Distributed Switch -&gt; New Distributed Switch..., konfigurera d\u00e4refter grundinst\u00e4llningarna:</p> <ol> <li>Namn och lokation.</li> <li>Version, v\u00e4lj alltid senaste s\u00e5 l\u00e4nge dina hostar har st\u00f6d f\u00f6r det.</li> <li>Modifiera antalet Uplinks, sl\u00e5 p\u00e5/av Network IO Control (NIOC) och     skapa en default Port Group om s\u00e5 \u00f6nskas.</li> </ol> <p>Ang\u00e5ende de olika vDS-versionerna, se nedan.</p> Version Kompatibilitet Nya features/f\u00f6rb\u00e4ttringar vDS 6.5.0 6.5\\&lt; Port Mirroring Enhancements vDS 6.0.0 6.0\\&lt; NIOC v3 och IGMP/MLD Snooping vDS 5.5.0 5.5\\&lt; Traffic Filtering &amp; Marking och f\u00f6rb\u00e4ttrat LACP-st\u00f6d. vDS 5.1.0 5.1\\&lt; Management Network Rollback &amp; Recovery, Health Check, Enhanced Port Mirroring och LACP-st\u00f6d. vDS 5.0.0 5.0\\&lt; Anv\u00e4ndardefinierade resurspooler i NIOC, Netflow och Port Mirroring. <p>F\u00f6r fortsatt konfiguration, klicka p\u00e5 din vDS -&gt; Actions -&gt; Settings. Under \"Edit Settings\" kan allt som n\u00e4mnts ovan \u00e4ndras. Under samma meny (Settings) finns \u00e4ven nedan inst\u00e4llningar.</p> <ul> <li>Private VLAN</li> <li>Netflow</li> <li>Health Check</li> <li>Export/Restore configuration</li> </ul> <p>Under Advanced kan MTU, Multicast filtering (Basic eller IGMP/MLD snooping), Discovery protocol (Type: CDP/LLDP/Disabled, Operation: Listen/Advertise/Both) samt Administrator Contact \u00e4ndras.</p> <p>F\u00f6r att radera en vDS, ta f\u00f6rst bort alla hostar och associerade Uplinks, h\u00f6gerklicka sedan p\u00e5 din vDS och v\u00e4lj Delete.</p>"},{"location":"vmware/Distributed_Switch/#dvport-groups","title":"dvPort Groups","text":"<p>vNetwork Distributed Port Groups kallas portgrupperna som anv\u00e4nds av en vDS. L\u00e4gg till en ny dvPort Group genom att h\u00f6gerklicka p\u00e5 din vDS -&gt; Distributed port group -&gt; New distributed port group. F\u00f6lj wizarden och konfigurera de olika settings som finns: Port Binding - Styr hur en virtuell port tilldelas till en VM. Det finns tre olika m\u00f6jligheter. * Static Binding: En port tilldelas d\u00e5 VM:en ansluts till dvPort Group:en. * Dynamic Binding: Tilldelar en port f\u00f6rsta g\u00e5ngen en VM startar efter den kopplats till dvPort Group. Deprecated sedan 5.5. * Ephemeral - no binding: Ingen port binding alls, det g\u00e5r att tilldela en VM till en dvPort Group med Ephemeral port binding \u00e4ven d\u00e5 man \u00e4r direktansluten till hosten. Port allocation - Hur portar allokeras till en vDS. * Elastic - Default 8 portar, n\u00e4r alla portar tilldelats allokeras 8 nya portar till switchen. Denna allokering \u00e4r default. * Static - Default 8 portar, inga nya portar allokeras n\u00e4r de befintliga blivit tilldelade. Number of ports - Antalet portar i dvPort Group:en. Network resource pool - Anv\u00e4nds f\u00f6r att tilldela dvPort Group till en network resource pool. VLAN - Vilken sorts VLAN-teknik som skall anv\u00e4ndas: * None - Anv\u00e4nd inte VLAN (otaggad trafik). * VLAN - Anv\u00e4nd VLAN, 1-4094 (taggad trafik). * VLAN Trunking - Anv\u00e4nd VLAN, range:ar till\u00e5ts, Virtual Guest Tagging (taggad trafik). * Private VLAN - Anv\u00e4nd ett Private VLAN som finns p\u00e5 switchen.</p> <p>F\u00f6r att radera en dvPort Group, se f\u00f6rst till att alla virtuella n\u00e4tverkskort och VMKernel-adaptrar migrerats till en annan portgrupp. vDS -&gt; Networks -&gt; Distributed Port Groups -&gt; V\u00e4lj dvPort Group -&gt; i Actions-menyn, v\u00e4lj Delete.</p>"},{"location":"vmware/Distributed_Switch/#uplinks","title":"Uplinks","text":"<p>De fysiska NIC (pNIC) som kopplas till vDS:en mappas mot en Uplink, som konfigureras identiskt p\u00e5 samtliga hostar. F\u00f6r att l\u00e4gga till en Uplink, g\u00e5 till vDS -&gt; i Actions-menyn, v\u00e4lj Add and Manage Hosts -&gt; Manage host networking -&gt; Next. V\u00e4lj vilket/vilka pNIC som ska mappas mot Uplink:en och tryck Assign Uplink. D\u00e4refter v\u00e4ljer man manuellt vilken Uplink som ska anv\u00e4ndas, eller Auto-assign. Efter du tryckt Next utv\u00e4rderas om iSCSI kommer att p\u00e5verkas eller inte.</p>"},{"location":"vmware/Distributed_Switch/#vmkernel-adapters","title":"VMkernel Adapters","text":"<p>VMkernel Adapters anv\u00e4nds f\u00f6r olika sorters tj\u00e4nster/trafik i vSphere, vilka f\u00f6ljer nedan:</p> <ul> <li>vMotion traffic</li> <li>Provisioning traffic</li> <li>Fault Tolerance (FT) traffic</li> <li>Management traffic (HA Heartbeat, namnet \u00e4r missvisande)</li> <li>vSphere Replication Traffic (outgoing)</li> <li>vSphere Replication NFC traffic (incoming)</li> <li>vSAN traffic</li> </ul> <p>En default VMkernel Port kan endast anv\u00e4ndas f\u00f6r IP Storage (iSCSI/NFS) och management.</p> <p>F\u00f6r att l\u00e4gga till en VMkernel-adapter i en vDS, navigera till din vDS -&gt; i Actions-menyn, v\u00e4lj Add and Manage Hosts -&gt; Manage host networking -&gt; Next. V\u00e4lj Manage VMkernel adapters, och tryck Next -&gt; New Adapter. En wizard \u00f6ppnas:</p> <ol> <li>V\u00e4lj dvPort Group under Select target device.</li> <li>Port properties, h\u00e4r konfigureras IP Settings     (IPv4/IPv6/B\u00e5da) samt vilka typer av trafik som till\u00e5ts p\u00e5 adaptern     (vMotion etc). Det g\u00e5r \u00e4ven att byta TCP/IP-stack (Default, vMotion     &amp; Provisioning finns f\u00f6rdefinierade, dock kan fler l\u00e4ggas till via     esxcli.</li> <li>P\u00e5 n\u00e4sta sida konfigureras IP-adress &amp; subn\u00e4tmask.</li> <li>En review-sida visas innan du trycker Finish.</li> </ol>"},{"location":"vmware/Distributed_Switch/#konfiguration-av-vds","title":"Konfiguration av vDS","text":""},{"location":"vmware/Distributed_Switch/#koppla-host-till-vds","title":"Koppla host till vDS","text":"<p>F\u00f6r att koppla p\u00e5 en host, g\u00e5 till vDS -&gt; Actions -&gt; Add and Manage Hosts -&gt; Add Hosts -&gt; Next -&gt; New hosts -&gt; OK. Konfigurera sedan antalet fysiska NIC (pNIC) f\u00f6r Uplinks, migrera VMKernel Adapters och VM Networking.</p> <p>En host kan \u00e4ven anv\u00e4ndas som ett slags template f\u00f6r n\u00e4tverkskonfiguration av andra hostar p\u00e5 vDS:en. I Add and Manage Hosts-menyn kan Configure identical networking settings on multiple hosts v\u00e4ljas f\u00f6r att kopiera inst\u00e4llningarna fr\u00e5n en host till \u00f6vriga hostar. V\u00e4rden som m\u00e5ste vara unika, t ex IP-adresser fylls i som en range, t ex 1.1.1.1#3, s\u00e5 tilldelas de i tur och ordning till hostarna.</p>"},{"location":"vmware/Distributed_Switch/#ta-bort-host-fran-vds","title":"Ta bort host fr\u00e5n vDS","text":"<p>Innan en host kan tas bort fr\u00e5n en vDS m\u00e5ste alla fysiska adaptrar, VMKernel-adaptrar och VM:ars n\u00e4tverksadaptrar migreras till en annan switch. Hosten tas sedan bort via vDS -&gt; Actions -&gt; Add and Manage Hosts -&gt; Remove Hosts -&gt; Next -&gt; V\u00e4lj host(ar) -&gt; Finish.</p>"},{"location":"vmware/Distributed_Switch/#migrera-vms-tillfran-vds","title":"Migrera VMs till/fr\u00e5n vDS","text":"<p>Navigera till din vDS -&gt; i Actions-menyn, v\u00e4lj Add and Manage Hosts -&gt; Manage host networking -&gt; Next. V\u00e4lj Migrate virtual machine networking, tryck Next -&gt; V\u00e4lj Source (specific/no network) och Destination network, dvs dvPort Group, Next -&gt; V\u00e4lj vilka VMs som ska migreras.</p>"},{"location":"vmware/Distributed_Switch/#vds-policies-security","title":"vDS Policies &amp; Security","text":""},{"location":"vmware/Distributed_Switch/#vds-port-blocking","title":"vDS Port Blocking","text":"<p>Under Edit Settings p\u00e5 en dvPort Group, i Miscellaneous-menyn finns en inst\u00e4llning f\u00f6r \"Block all ports\". Om den st\u00e4lls in p\u00e5 Yes, kommer samtliga virtuella portar i portgruppen att st\u00e4ngas ned. Det g\u00e5r \u00e4ven att blockera enskilda portar och Uplinks under Networks -&gt; Dubbelklicka p\u00e5 en dvPort Group/Uplink under Distributed Port Groups/Uplink Port Groups -&gt; Ports-fliken.</p> <ol> <li>V\u00e4lj en port i listan.</li> <li>Klicka p\u00e5 Edit distributed port settings.</li> <li>Under Miscellaneous, bocka f\u00f6r Override-rutan och v\u00e4lj om     porten ska blockas eller inte.</li> <li>OK.</li> </ol>"},{"location":"vmware/Distributed_Switch/#load-balancing-failover-policies","title":"Load Balancing &amp; Failover Policies","text":"<p>F\u00f6rutom lastbalansering f\u00f6r LACP finns \u00e4ven fem olika val f\u00f6r Uplinks och vanliga vSwitchar, de \u00e4r:</p> <ul> <li>Route based on IP hash</li> <li>Route based on source MAC hash</li> <li>Route based on originating virtual port</li> <li>Use explicit failover order (ingen LB alls)</li> <li>Route based on physical NIC load (endast tillg\u00e4nglig f\u00f6r vDS)</li> </ul> <p>Failover order anv\u00e4nder sig av Active, Standby och Unused-status. Om Active-NIC:arna \u00e4r aktiva kommer de att anv\u00e4ndas, i kombination med Load balancing-policyn. N\u00e4r inga portar fr\u00e5n Active-listan \u00e4r aktiva l\u00e4ngre, kommer portarna i Standby att anv\u00e4ndas.</p> <p>De \u00f6vriga inst\u00e4llningar som finns \u00e4r: Network Failure Detection - Hur ESXi k\u00e4nner av st\u00f6rningar i n\u00e4tverket. Link status only - Endast det fysiska NIC:ets l\u00e4nkstatus anv\u00e4nds f\u00f6r att avg\u00f6ra om n\u00e4tet anses fungera. Beacon probing - Beacons skickas ut via broadcast varje sekund och registreras av \u00f6vriga adaptrar. Denna info anv\u00e4nds tillsammans med l\u00e4nkstatus f\u00f6r att avg\u00f6ra om n\u00e4tet fungerar optimalt. Anv\u00e4nd inte detta med f\u00e4rre \u00e4n tre adaptrar i ditt failover team, annars kan inte ESXi avg\u00f6ra vilken enskild adapter som upplever problem. Failback - Avg\u00f6r huruvida en n\u00e4tverksadapter som varit offline ska s\u00e4ttas tillbaka som aktiv igen efter den kommit online. Notify switches - Om detta \u00e4r p\u00e5slaget skickas RARP-meddelande ut f\u00f6r att informera de fysiska switcharna om en failover f\u00f6r att de s\u00e5 snabbt som m\u00f6jligt ska uppdatera sina lookup tables. Detta anv\u00e4nds \u00e4ven vid vMotion f\u00f6r att minska antalet tappade paket.</p>"},{"location":"vmware/Distributed_Switch/#private-vlan","title":"Private VLAN","text":"<p>Private VLAN fungerar \"som vanligt\", Primary/Promiscuous-VLAN:et inneh\u00e5ller Secondary-VLAN:en som m\u00e5ste skicka sin trafik tillbaks till Primary. Portarna i Secondary VLAN:en \u00e4r antingen Isolated (kommunicerar bara med Promiscuous-portar, dvs inte med \"grann-VM:ar\") eller Community (kommunicerar med grann-VMs i samma secondary-VLAN och med promiscuous-portar).</p> <p>F\u00f6r att anv\u00e4nda Private VLAN m\u00e5ste \u00e4ven den fysiska n\u00e4tverksutrustingen implementera detta korrekt.</p>"},{"location":"vmware/Distributed_Switch/#traffic-shaping","title":"Traffic Shaping","text":"<p>En traffic shaping policy appliceras per port i en portgrupp. Policyn definieras med average bandwidth, peak bandwidth och burst size. P\u00e5 en vDS sker shaping b\u00e5de inkommande och utg\u00e5ende, en standard vSwitch shape:as endast ug\u00e5ende trafik. Average Bandwidth - Hur m\u00e5nga kbit/s som till\u00e5ts p\u00e5 en port, i genomsnitt \u00f6ver tid. Peak Bandwidth - Maximalt antal kbit/s som till\u00e5ts vid en trafik-burst. Burst Size - Maximalt antal Kilobyte som till\u00e5ts i en burst. N\u00e4r en port vill f\u00f6rbruka mer bandbredd \u00e4n vad som angetts som Average kommer den att anv\u00e4nda denna s k Burst bonus, om den \u00e4r tillg\u00e4nglig.</p>"},{"location":"vmware/Distributed_Switch/#vds-och-lacp","title":"vDS och LACP","text":"<p>Med vDS kommer st\u00f6d f\u00f6r LACP och ett antal nya algoritmer f\u00f6r lastbalansering. H\u00f6gst 64 LAG-grupper kan konfigureras per vDS och en host har st\u00f6d f\u00f6r 32 som mest. Som vanligt med LACP konfigureras Active eller Passive Mode. De load balancing modes som finns \u00e4r:</p> <ul> <li>Source and destination IP address, TCP/UDP port and VLAN</li> <li>Source and destination IP address and VLAN</li> <li>Source and destination MAC address</li> <li>Source and destination TCP/UDP port</li> <li>Source port ID</li> <li>VLAN</li> </ul> <p>Endast en aktiv LAG kan anv\u00e4ndas per dvPort Group, till skillnad fr\u00e5n enskilda Uplinks, det g\u00e5r inte heller att blanda LAG:ar med vanliga Uplinks. Att ha andra LAG:ar eller Uplinks som Standby \u00e4r inte supporterat, utan m\u00e5ste s\u00e4ttas som Unused i Failover Order. Under migrering fr\u00e5n Uplinks till LAG \u00e4r det supporterat att en LAG s\u00e4tts som Standby f\u00f6re skiftet.</p> <p>Skapa en LAG via vDS -&gt; Configure -&gt; Settings -&gt; LACP -&gt; klicka p\u00e5 Plustecknet.</p> <ol> <li>S\u00e4tt ett namn p\u00e5 LACP-gruppen.</li> <li>Ange antal portar.</li> <li>Ange Active/Passive Mode f\u00f6r LACP.</li> <li>S\u00e4tt Load Balancing mode.</li> <li>VLAN och NetFlow policies kan \u00f6verskridas h\u00e4r, om overrides     till\u00e5tits p\u00e5 vDS-niv\u00e5.</li> <li>Klicka OK f\u00f6r att skapa LAG:en.</li> </ol> <p>F\u00f6r att flytta dvPort Groups till din LAG, g\u00e5 till vDS -&gt; i Actions-menyn, v\u00e4lj Distributed Port Group -&gt; Manage Distributed Port Groups -&gt; V\u00e4lj Teaming and failover, tryck Next.</p> <ol> <li>V\u00e4lj vilka dvPort Groups som ska anv\u00e4nda LAG:en, Next.</li> <li>Under Failover Order, s\u00e4tt LAG:en som Standby, Next.</li> <li>En review-sida visas, tryck Finish.</li> </ol> <p>Efter detta ska fysiska NIC tilldelas LAG:en; g\u00e5 till vDS -&gt; i Actions-menyn, v\u00e4lj Add and Manage Hosts -&gt; Manage host networking -&gt; Next -&gt; Manage physical adapters -&gt; Next -&gt; Tilldela h\u00e4rifr\u00e5n pNIC:ar till LAG:en fr\u00e5n respektive host -&gt; OK.</p> <p>Nu \u00e5terst\u00e5r bara att g\u00e5 tillbaks till Failover Order (se ovan) och flytta LAG:en till Active och alla \u00f6vriga Uplinks till Unused. Standby-listan ska vara tom efter detta. Efter du tryckt p\u00e5 Finish kommer trafiken flyttas till LAG:en, detta \u00e4r non-disruptive.</p>"},{"location":"vmware/Distributed_Switch/#begransningar-med-lacp","title":"Begr\u00e4nsningar med LACP","text":"<ul> <li>Inkompatibelt med iSCSI multipathing.</li> <li>Finns inte settings f\u00f6r LACP i Host Profiles.</li> <li>Ingen support f\u00f6r Nested ESXi.</li> <li>Fungerar inte med ESXi dump collector.</li> <li>Port mirroring fungerar inte.</li> </ul>"},{"location":"vmware/Distributed_Switch/#vds-auto-rollback","title":"vDS Auto-Rollback","text":"<p>Som ett skydd mot att permanent tappa kontakt med vCenter pga felkonfiguration utf\u00f6rs en rollback av konfigurationen p\u00e5 en vDS om kontakten skulle f\u00f6rsvinna efter en \u00e4ndring. Denna funktion \u00e4r p\u00e5slagen per default sedan version 5.1.</p> <p>Det finns tv\u00e5 typer av rollbacks, Host Networking Rollback och vDS Rollback. En Host Networking Rollback sker d\u00e5 konfiguration \u00e4ndrats p\u00e5 en host som g\u00f6r att kommunikationen med vCenter fallerar, exempel p\u00e5 detta:</p> <ul> <li>\u00c4ndring av speed/duplex p\u00e5 pNIC</li> <li>DNS-/routing-\u00e4ndringar.</li> <li>\u00c4ndring av teaming &amp; failover eller traffic shaping p\u00e5 en port group     som inneh\u00e5ller management Vmkernel-adaptern.</li> <li>\u00c4ndring av VLAN p\u00e5 portgruppen som inneh\u00e5ller management     Vmkernel-adaptern.</li> <li>\u00c4ndringar av MTU p\u00e5 managment Vmkernel-adaptern och dess switch till     v\u00e4rden som inte st\u00f6ds av den fysiska infrastrukturen.</li> <li>\u00c4ndringar av IP-adressering p\u00e5 management Vmkernel-adaptern.</li> <li>Borttagning av management Vmkernel-adaptern fr\u00e5n en standard vSwitch     eller vDS.</li> <li>Borttagning av ett pNIC fr\u00e5n en vDS/vSwitch som inneh\u00e5ller     management Vmkernel-adaptern.</li> <li>Migrering av management Vmkernel-adaptern fr\u00e5n vSwitch till vDS.</li> </ul> <p>En Distributed Switch Rollback sker n\u00e4r felaktiga \u00e4ndringar g\u00f6rs p\u00e5 en vDS, dvPort Group eller dvPort. Exempel p\u00e5 \u00e4ndringar som kan trigga en rollback:</p> <ul> <li>\u00c4ndring av MTU p\u00e5 vDS-niv\u00e5.</li> <li>\u00c4ndring av Teaming &amp; Failover, VLAN eller Traffic Shaping p\u00e5 dvPort     Group:en som inneh\u00e5ller management VMkernel-adaptern.</li> <li>Blockering av alla portar i dvPort Group:en som inneh\u00e5ller     management VMKernel-adaptern.</li> </ul> <p>Det g\u00e5r ocks\u00e5 att \u00e5terf\u00e5 anslutningen f\u00f6r management via DCUI. G\u00e5 till Network Restore Options -&gt; V\u00e4lj Restore vDS -&gt; Konfigurera uplinks och ev VLAN f\u00f6r management-n\u00e4tet -&gt; Apply:a konfigurationen. Vad som sker d\u00e5 \u00e4r att DCUI skapar en lokal ephemeral-port som konfigureras enligt de angivna v\u00e4rdena. VMkernel-adaptern f\u00f6r management-n\u00e4tet flyttas till den nya porten f\u00f6r att \u00e5terf\u00e5 anslutning mot vCenter.</p> <p>Under vissa omst\u00e4ndigheter kan det vara \u00f6nskv\u00e4rt att inte ha rollback p\u00e5slaget, f\u00f6r att sl\u00e5 av rollback g\u00f6r man f\u00f6ljande: navigera till en vCenter-instans -&gt; Configure -&gt; Settings -&gt; Advanced Settings -&gt; Edit -&gt; \u00c4ndra v\u00e4rdet p\u00e5 config.vpxd.network.rollback-nyckeln till false -&gt; OK -&gt; Starta om vCenter f\u00f6r att applicera \u00e4ndringen. Det g\u00e5r ocks\u00e5 att g\u00f6ra detta via config-filen vpxd.cfg som ligger under C:\\ProgramData\\VMware\\CIS\\cfg\\ i Windows-varianten och under /etc/ i appliance-varianten. Under -elementet, \u00e4ndra elementet  till false. <code> <p> <code></code> <code></code> <code></code><code>false</code> <code></code> <code></code> <code></code></p> <p> Spara och st\u00e4ng filen, och starta om vCenter.</p> <p>Category:VMware</p>"},{"location":"vmware/ESXi_Secure_Boot/","title":"ESXi Secure Boot","text":""},{"location":"vmware/ESXi_Secure_Boot/#secure-boot","title":"Secure Boot","text":"<p>ESXi 6.5 har inbyggt st\u00f6d f\u00f6r Secure Boot, f\u00f6r att kunna s\u00e4kerst\u00e4lla att ESXi endast startar med en signerad bootloader. Osignerad kod kan inte heller k\u00f6ras i hypervisorn. VMware:s implementation best\u00e5r av f\u00f6ljande komponenter:</p>"},{"location":"vmware/ESXi_Secure_Boot/#boot-loader","title":"Boot Loader","text":"<p>Som vid klassisk Secure Boot verifierar UEFI bootloaderns digitala signatur. ESXi:s bootloader \u00e4r signerad med Microsoft UEFI Public CA och inneh\u00e5ller \u00e4ven en publik VMware-nyckel. Denna nyckel anv\u00e4nds f\u00f6r validering av VMKernel och ett f\u00e5tal systemfunktioner, d\u00e4ribland Secure Boot Verifier, som anv\u00e4nds f\u00f6r att validera VIB:ar.</p>"},{"location":"vmware/ESXi_Secure_Boot/#vmkernel","title":"VMKernel","text":"<p>VMKernel \u00e4r signerad med VMware:s privata nyckel och valideras av bootloadern mha ovan n\u00e4mnda publika nyckel. Det f\u00f6rsta VMKernel sj\u00e4lv g\u00f6r \u00e4r att k\u00f6ra Secure Boot Verifier.</p>"},{"location":"vmware/ESXi_Secure_Boot/#secure-boot-verifier","title":"Secure Boot Verifier","text":"<p>Secure Boot Verifier validerar varje signerad VIB mot VMware:s publika nyckel.</p> <p>Man kan k\u00f6ra f\u00f6ljande skript f\u00f6r att verifiera om Secure Boot kan sl\u00e5s p\u00e5 eller inte:</p> <p><code>/usr/lib/vmware/secureboot/bin/secureboot.py\u00a0-c</code></p>"},{"location":"vmware/ESXi_Secure_Boot/#vibar-secure-boot","title":"VIB:ar &amp; Secure Boot","text":"<p>Vid uppgradering av vSphere uppdateras VIB:arnas signaturer, s\u00e5 l\u00e4nge de finns med i nyare version bland uppgraderingspaketen. En uppgradering via ESXCLI kommer dock inte att uppgradera bootloadern vilket kommer resultera i fel ifall Secure Boot sl\u00e5s p\u00e5, den enda workarounden \u00e4r ominstallation. Community-VIB:ar kan inte installeras p\u00e5 en host som anv\u00e4nder Secure Boot, d\u00e5 de inte signeras. Alla VIB-paket m\u00e5ste vara minst PartnerSupported. En host som uppt\u00e4ckt en osignerad VIB efter p\u00e5slagning av Secure Boot kommer att f\u00e5 PSOD med ett meddelande om vilken VIB som orsakat detta. F\u00f6r att l\u00f6sa problemet m\u00e5ste VIB:en tas bort eller uppdateras till en supporterad version. Secure Boot m\u00e5ste f\u00f6rst st\u00e4ngas av i UEFI, ESXi startas sedan f\u00f6r att administrat\u00f6ren ska kunna ta bort/uppdatera VIB-paketet. Efter detta sl\u00e5r man p\u00e5 Secure Boot i UEFI igen och startar ESXi.</p>"},{"location":"vmware/ESXi_Secure_Boot/#virtuella-maskiner-och-secure-boot","title":"Virtuella Maskiner och Secure Boot","text":"<p>Det finns vissa krav f\u00f6r att en virtuell maskin ska st\u00f6dja Secure Boot:</p> <ul> <li>VMware Tools 10.1 eller senare.</li> <li>Linux-maskiner m\u00e5ste st\u00e4nga av \"VMware Host-Guest Filesystem\" i     VMware Tools.</li> <li>Virtual Hardware 13 eller senare.</li> <li>OS:et m\u00e5ste ha st\u00f6d f\u00f6r UEFI Secure Boot.</li> </ul> <p>F\u00f6r att sl\u00e5 p\u00e5 VM Secure Boot: Edit Settings -&gt; VM Options -&gt; \u00e4ndra Firmware fr\u00e5n \"BIOS\" till \"EFI\" och tryck OK.</p> <p>Category:VMware</p>"},{"location":"vmware/ESXi_Security/","title":"ESXi Security","text":""},{"location":"vmware/ESXi_Security/#esxi-security-hardening","title":"ESXi Security Hardening","text":"<p>Trots att vSphere 6.5 kommit med m\u00e5nga f\u00f6rb\u00e4ttringar p\u00e5 s\u00e4kerhetssidan finns det en hel del att g\u00f6ra f\u00f6r att \u00f6ka s\u00e4kerheten p\u00e5 dina ESXi:er.</p>"},{"location":"vmware/ESXi_Security/#host-profiles","title":"Host Profiles","text":"<p>\u00c4ven om de inte \u00f6kar s\u00e4kerheten i sig, \u00e4r de ett v\u00e4ldigt bra verktyg att anv\u00e4nda f\u00f6r att n\u00e5 eventuella s\u00e4kerhetskrav. En Host Profile kan ses som en mall som appliceras p\u00e5 en ESXi-host och \u00e4ndrar de definierade inst\u00e4llningarna i profilen, d\u00e4ribland s\u00e4kerhetsinst\u00e4llningar.</p> <p>F\u00f6r att sl\u00e5 p\u00e5 en Host Profile: Cluster -&gt; Manage -&gt; Settings -&gt; Configuration -&gt; Profiles, tryck p\u00e5 \"Attach...\"</p>"},{"location":"vmware/ESXi_Security/#security-profile-firewall-services","title":"Security Profile (Firewall &amp; Services)","text":"<p>Till\u00e5t endast n\u00f6dv\u00e4ndiga tj\u00e4nster n\u00e4r de anv\u00e4nds, t ex SSH. F\u00f6r att \u00e4ndra en brandv\u00e4ggsregel/tj\u00e4nst: Host -&gt; Configure -&gt; System -&gt; Security Profile.</p> <p>En brandv\u00e4ggsregel i ESXi avg\u00f6r vilka inkommande/utg\u00e5ende portar och protokoll som anv\u00e4nds f\u00f6r en tj\u00e4nst, samt status p\u00e5 Daemon:en i ESXi. Vissa tj\u00e4nster g\u00e5r \u00e4ven att starta/stoppa/starta om via Security Profile. Startup Policy g\u00e5r ocks\u00e5 att \u00e4ndra, detta avg\u00f6r ifall tj\u00e4nsten startar samtidigt som ESXi, n\u00e4r porten \u00e4r \u00f6ppen, eller manuellt.</p>"},{"location":"vmware/ESXi_Security/#managed-object-browser","title":"Managed Object Browser","text":"<p>MOB anv\u00e4nds f\u00f6r att utforska objektmodellen i ESXi, vilket kan anv\u00e4ndas f\u00f6r att utf\u00f6ra skadliga konfigurations\u00e4ndringar. Sedan 6.0 \u00e4r MOB avst\u00e4ngt som standard, men beh\u00f6vs f\u00f6r bla att extrahera gamla certifikat. MOB sl\u00e5s av/p\u00e5 via Advanced System Settings p\u00e5 en Host, v\u00e4rdet som \u00e4ndras \u00e4r <code>Config.HostAgent.plugins.solo.enableMob</code></p>"},{"location":"vmware/ESXi_Security/#lockdown-mode","title":"Lockdown Mode","text":"<p>Lockdown mode \u00e4r en s\u00e4kerhetsfunktion som st\u00e4nger av lokal management p\u00e5 ESXi-hostar; management kan enbart ske via vCenter (utantag finns). Det finns tv\u00e5 olika l\u00e4gen, normal och strict lockdown.</p>"},{"location":"vmware/ESXi_Security/#normal-lockdown","title":"Normal Lockdown","text":"<p>DCUI k\u00f6rs fortfarande p\u00e5 hosten. Priviligerade konton kan fortfarande logga in och st\u00e4nga av Lockdown. Bara de konton med administrativ beh\u00f6righet som specificerats i Exception User-listan f\u00f6r Lockdown kan g\u00f6ra detta. Exception Users \u00e4r ocks\u00e5 till f\u00f6r service-konton som beh\u00f6ver utf\u00f6ra specifika tasks direkt p\u00e5 hosten. Det finns \u00e4ven en advanced option (DCUI.Access), som ger en anv\u00e4ndare (\u00e4ven icke-admins) m\u00f6jligheten att logga p\u00e5 DCUI och st\u00e4nga av Lockdown Mode.</p>"},{"location":"vmware/ESXi_Security/#strict-lockdown","title":"Strict Lockdown","text":"<p>DCUI-tj\u00e4nsten stoppas; om kommunikationen till vCenter f\u00f6rsvinner och inte kan \u00e5teruppr\u00e4ttas finns ingen annan utv\u00e4g \u00e4n ominstallation. Dock finns det ett s\u00e4tt att f\u00f6rebygga detta, om SSH och/eller ESXi Shell aktiverats p\u00e5 hosten. D\u00e5 kan en admin-anv\u00e4ndare p\u00e5 Exception User-listan logga p\u00e5 hosten via CLI:t.</p>"},{"location":"vmware/ESXi_Security/#aktivera-lockdown","title":"Aktivera Lockdown","text":"<p>F\u00f6r att sl\u00e5 p\u00e5 Lockdown Mode: Host -&gt; Configure -&gt; System -&gt; Security Profile -&gt; \"Edit\"-knappen under Lockdown Mode, v\u00e4lj sedan Enable.</p> <p>N\u00e4r Lockdown Mode sl\u00e5s p\u00e5 termineras alla sessioner f\u00f6r de anv\u00e4ndare som inte \u00e4r med p\u00e5 Exception User-listan.</p>"},{"location":"vmware/ESXi_Security/#sshdcuishell-access","title":"SSH/DCUI/Shell Access","text":"<p>Dessa tre tj\u00e4nster g\u00e5r att sl\u00e5 av manuellt via Host -&gt; Configure -&gt; System -&gt; Services. SSH och ESXi Shell kan \u00e4ven sl\u00e5s av via DCUI -&gt; F2 -&gt; Troubleshooting options, h\u00e4r kan \u00e4ven timeout-v\u00e4rden f\u00f6r dessa tv\u00e5 tj\u00e4nster, samt DCUI, \u00e4ndras.</p> <p>Category:VMware</p>"},{"location":"vmware/ESXi_pktcap/","title":"ESXi pktcap","text":"<p>pktcap-uw \u00e4r efterf\u00f6ljare till tcpdump-uw och inneh\u00e5ller n\u00e5gra nya funktioner. Det anv\u00e4nds f\u00f6r paketanalys och ing\u00e5r default sedan 5.5. Man kan f\u00e5nga trafik fr\u00e5n vmk-interface, vmnicar och fysiska nicar.</p>"},{"location":"vmware/ESXi_pktcap/#anvandning","title":"Anv\u00e4ndning","text":"<p>Lista interface</p> <p><code>esxcli\u00a0network\u00a0nic\u00a0list</code> <code>esxcli\u00a0network\u00a0ip\u00a0interface\u00a0list</code></p> <p>Fysisk NIC</p> <p><code>pktcap-uw\u00a0--uplink\u00a0vmnic0</code></p> <p>Spara capture till fil med -o</p> <p><code>pktcap-uw\u00a0--vmk\u00a0vmk0\u00a0-o\u00a0vmk0.pcap</code></p> <p>Specifik IP</p> <p><code>pktcap-uw\u00a0--vmk\u00a0vmk0\u00a0--ip\u00a0x.x.x.x</code></p> <p>Specifik port</p> <p><code>pktcap-uw\u00a0--vmk\u00a0vmk0\u00a0--tcpport\u00a0443</code></p> <p>Anv\u00e4nd esxtop f\u00f6r att ta reda p\u00e5 en virtuell maskins vswitch Port ID</p> <p><code>esxtop\u00a0\u00a0#press\u00a0n</code> <code>pktcap-uw\u00a0--switchport\u00a033554439</code></p> <p>Category:VMware</p>"},{"location":"vmware/Kickstart_ESXi/","title":"Kickstart ESXi","text":"<p>ESXi 6.0</p> <p><code>accepteula</code> <code>install\u00a0--firstdisk\u00a0--overwritevmfs</code> <code>#For\u00a0USB\u00a0install\u00a0use\u00a0below\u00a0instead</code> <code>#install\u00a0--firstdisk\u00a0--novmfsondisk</code> <code>rootpw\u00a0bueno</code> <code>keyboard\u00a0Swedish</code> <code>reboot</code></p> <p><code>network\u00a0--bootproto=static\u00a0--device=vmnic0\u00a0--hostname=esxi2.hackernet.se\u00a0--ip=172.20.0.2\u00a0--netmask=255.255.255.0\u00a0--gateway=172.20.0.1\u00a0--nameserver=172.20.0.10\u00a0--addvmportgroup=false</code></p> <p><code>%firstboot\u00a0--interpreter=busybox</code></p> <p><code>#SSH</code> <code>vim-cmd\u00a0hostsvc/enable_ssh</code> <code>vim-cmd\u00a0hostsvc/start_ssh</code> <code>esxcli\u00a0system\u00a0settings\u00a0advanced\u00a0set\u00a0-o\u00a0/UserVars/SuppressShellWarning\u00a0-i\u00a01</code></p> <p><code>vim-cmd\u00a0hostsvc/datastore/rename\u00a0datastore1\u00a0\"LocalHDD\"</code> <code>vim-cmd\u00a0vimsvc/license\u00a0--set\u00a011111-BBBBB-CCCCC-BH951-CAW3U</code> <code>esxcli\u00a0system\u00a0module\u00a0parameters\u00a0set\u00a0-m\u00a0tcpip3\u00a0-p\u00a0ipv6=0</code></p> <p><code>cat\u00a0&gt;\u00a0/etc/ntp.conf\u00a0&lt;&lt;\u00a0__NTP_CONFIG__</code> <code>restrict\u00a0default\u00a0kod\u00a0nomodify\u00a0notrap\u00a0noquerynopeer</code> <code>restrict\u00a0127.0.0.1</code> <code>server\u00a00.vmware.pool.ntp.org</code> <code>server\u00a01.vmware.pool.ntp.org</code> <code>__NTP_CONFIG__</code> <code>/sbin/chkconfig\u00a0ntpd\u00a0on</code></p> <p><code>#\u00a0EHC</code> <code>esxcli\u00a0software\u00a0vib\u00a0install\u00a0-v</code><code>http://download3.vmware.com/software/vmw-tools/esxui/esxui_signed.vib</code></p> <p><code>#If\u00a0planning\u00a0on\u00a0running\u00a0nested\u00a0ESXi,\u00a0uncomment</code> <code>#grep\u00a0-i\u00a0\"vhv.enable\"\u00a0/etc/vmware/config\u00a0||\u00a0echo\u00a0\"vhv.enable\u00a0=\u00a0\\\"TRUE\\\"\"\u00a0&gt;&gt;\u00a0/etc/vmware/config</code></p> <p><code>#\u00a0Mgmt</code> <code>esxcli\u00a0network\u00a0vswitch\u00a0standard\u00a0portgroup\u00a0set\u00a0--portgroup-name\u00a0\"Management\u00a0Network\"\u00a0--vlan-id\u00a02</code></p> <p><code>#\u00a0vSwitch0</code> <code>esxcli\u00a0network\u00a0vswitch\u00a0standard\u00a0set\u00a0--mtu\u00a09000\u00a0--cdp-status\u00a0both\u00a0--vswitch-name\u00a0vSwitch0</code> <code>esxcli\u00a0network\u00a0vswitch\u00a0standard\u00a0portgroup\u00a0add\u00a0--portgroup-name\u00a0LAN\u00a0--vswitch-name\u00a0vSwitch0</code></p> <p><code>#\u00a0vSwitch1</code> <code>esxcli\u00a0network\u00a0vswitch\u00a0standard\u00a0add\u00a0--ports\u00a0256\u00a0--vswitch-name\u00a0vSwitch1</code> <code>esxcli\u00a0network\u00a0vswitch\u00a0standard\u00a0uplink\u00a0add\u00a0--uplink-name\u00a0vmnic1\u00a0--vswitch-name\u00a0vSwitch1</code> <code>esxcli\u00a0network\u00a0vswitch\u00a0standard\u00a0set\u00a0--cdp-status\u00a0listen\u00a0--vswitch-name\u00a0vSwitch1</code> <code>esxcli\u00a0network\u00a0vswitch\u00a0standard\u00a0portgroup\u00a0add\u00a0--portgroup-name\u00a0WAN\u00a0--vswitch-name\u00a0vSwitch1</code></p> <p><code>#\u00a0vSwitch2</code> <code>esxcli\u00a0network\u00a0vswitch\u00a0standard\u00a0add\u00a0--ports\u00a0256\u00a0--vswitch-name\u00a0vSwitch2</code> <code>esxcli\u00a0network\u00a0vswitch\u00a0standard\u00a0uplink\u00a0add\u00a0--uplink-name\u00a0vmnic2\u00a0--vswitch-name\u00a0vSwitch2</code> <code>esxcli\u00a0network\u00a0vswitch\u00a0standard\u00a0set\u00a0--mtu\u00a09000\u00a0--cdp-status\u00a0both\u00a0--vswitch-name\u00a0vSwitch2</code> <code>esxcli\u00a0network\u00a0vswitch\u00a0standard\u00a0portgroup\u00a0add\u00a0--portgroup-name\u00a0DMZ1\u00a0--vswitch-name\u00a0vSwitch2</code> <code>esxcli\u00a0network\u00a0vswitch\u00a0standard\u00a0portgroup\u00a0set\u00a0--portgroup-name\u00a0DMZ1\u00a0--vlan-id\u00a01</code> <code>esxcli\u00a0network\u00a0vswitch\u00a0standard\u00a0portgroup\u00a0add\u00a0--portgroup-name\u00a0DMZ2\u00a0--vswitch-name\u00a0vSwitch2</code> <code>esxcli\u00a0network\u00a0vswitch\u00a0standard\u00a0portgroup\u00a0set\u00a0--portgroup-name\u00a0DMZ2\u00a0--vlan-id\u00a02</code></p> <p>Category:Kickstart Category:VMware</p>"},{"location":"vmware/PSC/","title":"PSC","text":"<p>Platform Services Controller tillhandah\u00e5ller gemensamma tj\u00e4nster f\u00f6r vSphere-milj\u00f6n, d\u00e4ribland licensiering, certifikatshantering och autentisering via SSO.</p>"},{"location":"vmware/PSC/#arkitektur-komponenter","title":"Arkitektur &amp; Komponenter","text":"<p>Vid installation av vCenter finns tre olika typer av deployment:</p> <ul> <li>vCenter with External PSC \u2013 vCenter installeras standalone och     ansluts mot en standalone PSC.</li> <li>vCenter with Embedded PSC \u2013 vCenter och PSC deployas i samma maskin.</li> <li>PSC Only \u2013 Standalone-installation av PSC.</li> </ul> <p>PSC-gr\u00e4nssnittet n\u00e5s via https://IP_or_FQDN/psc</p>"},{"location":"vmware/PSC/#psc-features","title":"PSC Features","text":"<ul> <li>Hanterar och genererar SSL-certifikat till vSphere-milj\u00f6n.</li> <li>Lagrar och replikerar licensnycklar.</li> <li>Lagrar och replikerar permissions via Global Permissions-lagret.</li> <li>Hanterar lagring och replikering av Tags och Categories.</li> <li>Inbyggd automatisk replikering mellan SSO-siter (om de finns).</li> </ul>"},{"location":"vmware/PSC/#vcenter-single-sign-on","title":"vCenter Single Sign-On","text":"<p>vCenter SSO best\u00e5r av Secure Token Service (STS), Administration server, VMware Directory Service (vmdir) och Identity Management Service.</p> <ul> <li>STS \u2013 Delar ut Security Assertion Markup Language (SAML) tokens.     Dessa tokens representerar en anv\u00e4ndares identitet efter denne     autentiserat genom en identitetsk\u00e4lla (t ex LDAP). SAML tokens     m\u00f6jligg\u00f6r att anv\u00e4ndaren slipper autentisera om sig f\u00f6r de olika     vCenter-tj\u00e4nster som st\u00f6ds av SSO.</li> <li>Administration Server - Anv\u00e4nds f\u00f6r att konfigurera SSO-servern,     initialt kan endast administrator@your_domain_name anv\u00e4ndas f\u00f6r     detta. Fr o m vSphere 6.0 kan detta dom\u00e4nnamn s\u00e4ttas till n\u00e5gon     annat \u00e4n vsphere.local, anv\u00e4nd dock inte samma namn som din AD-     eller OpenLDAP-dom\u00e4n.</li> <li>VMware Directory Service (vmdir) - vmdir \u00e4r den katalogtj\u00e4nst som     associeras med SSO-dom\u00e4nen som skapas vid deployment. I milj\u00f6er med     flera PSC:er propageras f\u00f6r\u00e4ndringar i en vmdir-instans till \u00f6vriga     instanser. Vmdir lagrar f\u00f6rutom vCenter SSO-information \u00e4ven     certifikatsinformation. PSC Sites kan \u00e4ven skapas i vmdir, en logisk     container f\u00f6r gruppering av PSC-instanser i en SSO-dom\u00e4n.</li> <li>Identity Management Service \u2013 Hanterar identitetsk\u00e4llor och STS     authentication requests.</li> </ul> <p>Med hj\u00e4lp av SSO kan de olika komponenterna i vSphere kommunicera med varandra genom samma secure token-mekanism. I vCenter SSO autentiseras m\u00e4nskliga anv\u00e4ndare via AD eller OpenLDAP, medan solution users autentiseras med hj\u00e4lp av certifikat.</p>"},{"location":"vmware/PSC/#anvandare-sso","title":"Anv\u00e4ndare (SSO)","text":"<p>F\u00f6r att l\u00e4gga till/ta bort/aktivera/inaktivera SSO-anv\u00e4ndare g\u00e5 till Administration -&gt; SSO -&gt; Users and groups -&gt; H\u00f6gerklicka p\u00e5 anv\u00e4ndaren -&gt; Edit/Disable/Enable/Unlock.</p>"},{"location":"vmware/PSC/#grupper-sso","title":"Grupper (SSO)","text":"<p>Administrators \u2013 Globala r\u00e4ttigheter till SSO och hela inventoryt. CAAdmins \u2013 Kan managera VMCA. LicenseService.Administrator - Kan managera licenser.</p>"},{"location":"vmware/PSC/#sso-policies","title":"SSO Policies","text":"<p>Policies f\u00f6r Passwords, Lockout och Tokens hanteras via Home -&gt; Administration -&gt; SSO -&gt; Configuration -&gt; Policies-fliken. F\u00f6r att t ex \u00e4ndra till att l\u00f6senord aldrig upph\u00f6r, editera Password Policy:n och s\u00e4tt Maximum lifetime till 0.</p>"},{"location":"vmware/PSC/#vmware-certificate-authority-vmca","title":"VMware Certificate Authority (VMCA)","text":"<p>VMCA tillhandah\u00e5ller och provisionerar alla n\u00f6dv\u00e4ndiga certifikat f\u00f6r vCenter och ESXi, och \u00e4r en del av PSC. VMware rekommenderar att antingen anv\u00e4nda default-inst\u00e4llningarna, dvs att VMCA hanterar alla certifikat, eller VMCA default certificates med externa SSL-cert; Hybrid Mode. Hybrid mode inneb\u00e4r att PSC och vCenter-certifikaten byts ut och att VMCA f\u00e5r hantera certifikat f\u00f6r solution users och ESXi-hostar. VMware Endpoint Certificate Store (VECS) kallas det repository d\u00e4r alla custom-certifikat lagras. Om custom-certifikat p\u00e5 ESXi-hostar ska anv\u00e4ndas, lagras de lokalt p\u00e5 hosten, inte i VECS.</p> <p>F\u00f6r att se vilka certifikat som anv\u00e4nds av vCenter, g\u00e5 till Home -&gt; System Configuration -&gt; Nodes -&gt; vCenter-noden -&gt; Manage -&gt; Certificate Authority. Om du inte har tillg\u00e5ng till denna vy, l\u00e4gg till din anv\u00e4ndare i CAAdmins-gruppen.</p>"},{"location":"vmware/PSC/#licenshantering","title":"Licenshantering","text":"<p>Licenshantering i vSphere-milj\u00f6n hanteras av VMware License Service, en del av PSC.</p>"},{"location":"vmware/PSC/#deployment","title":"Deployment","text":"<p>Det finns flera olika s\u00e4tt att koppla samman vCenter och PSC.</p>"},{"location":"vmware/PSC/#embedded-linked-mode","title":"Embedded Linked Mode","text":"<p>En topologi med flera vCenter Appliance:r, tillkom i 6.5U2, Windows Embedded PSC \u00e4r inte supporterad f\u00f6r detta. Embedded Linked Mode m\u00f6jligg\u00f6r Enhanced Linked Mode mellan tv\u00e5 eller flera (upp till 15) VCSA med Embedded PSC. Om vCenter HA anv\u00e4nds anses de tre noderna som en logisk vCenter-nod. Denna deployment f\u00f6renklar backup &amp; restore, d\u00e5 f\u00e4rre steg beh\u00f6ver genomf\u00f6ras. PSC HA f\u00f6renklas ocks\u00e5 avsev\u00e4rt, d\u00e5 behovet av lastbalanserare f\u00f6r PSC f\u00f6rsvinner. Embedded Linked Mode kan endast aktiveras under installation av VCSA, inte efter\u00e5t.</p>"},{"location":"vmware/PSC/#enhanced-linked-mode","title":"Enhanced Linked Mode","text":"<p>Enhanced Linked Mode l\u00e4nkar samman flera vCenter samt en eller flera PSC:er (ej embedded). Upp till 10 VCSA eller 8 Windows vCenter kan anslutas i en grupp. Anslutningen sker under installation, inte efter.</p> <p>Utan lastbalanserare \u2013 I en deployment utan LB m\u00e5ste manuell failover till n\u00e4sta PSC utf\u00f6ras i vCenter. F\u00f6rst avregistreras nuvarande PSC med <code>cmsso-util unregister</code>, sedan pekas vCenter om med <code>cmsso-util repoint-psc</code>. Om din topoplogi inneh\u00e5ller tre eller flera PSC:er kan en ringtopologi konfigureras f\u00f6r att garantera tillg\u00e4nglighet d\u00e5 en instans fallerar. Detta g\u00f6rs genom att k\u00f6ra <code>/usr/lib/vmware-vmdir/bin/vdcrepadmin -f createagreement</code> p\u00e5 den f\u00f6rsta och sista PSC-instansen som deployats.</p> <p>Med lastbalanserare \u2013 Om LB anv\u00e4nds mellan vCenter(s) och PSC:erna sker failover automatiskt om en PSC blir oresponsiv. Detta kr\u00e4ver att alla PSC:er \u00e4r antingen Appliance- eller Windows-baserade.</p>"},{"location":"vmware/PSC/#multi-site-psc-installation","title":"Multi-Site PSC-installation","text":"<p>I grova drag \u00e4r det man beh\u00f6ver utf\u00f6ra: Installera PSC f\u00f6rst, sedan vCenter som kopplas mot PSC. F\u00f6r flera PSC:er och vCenter; \u00e5terupprepa tidigare steg. Alla efterf\u00f6ljande appliance:r efter den f\u00f6rsta PSC:en m\u00e5ste deployas med \"Join an existing vCenter SSO Domain\". D\u00e5 blir PSC:erna replication partners och vCenter:na ansluts mot SSO-dom\u00e4nen.</p> <p>Topologin kan \u00e4ndras efter installation, fr\u00e5n embedded till external (eller vice versa), s\u00e5 l\u00e4nge SSO-dom\u00e4nen inte \u00e4ndras. En extern PSC b\u00f6r anv\u00e4ndas d\u00e5 fler \u00e4n en l\u00f6sning med SSO-integration anv\u00e4nds, t ex vCenter + vRealize Automation.</p> <p>Nedan KB listar supporterade (\u00e4ven deprecated) topologier f\u00f6r PSC deployment: https://kb.vmware.com/kb/2147672</p>"},{"location":"vmware/PSC/#uppgradera-psc","title":"Uppgradera PSC","text":"<p>Om extern PSC anv\u00e4nds m\u00e5ste alla PSC-instanser uppgraderas i sekvens. Efter detta \u00e4r gjort kan VCSA uppgraderas.</p> <p>Category:VMware</p>"},{"location":"vmware/PowerCLI/","title":"PowerCLI","text":"<p>Category:VMware PowerCLI \u00e4r ett Windows Powershell-gr\u00e4nssnitt f\u00f6r hantering av VMware vSphere. PowerCLI distribueras som en Powershell snapin, och inneh\u00e5ller \u00f6ver 370 Powershell-cmdlets f\u00f6r att hantera och automatisera vSphere och vCloud.</p> <p>\"a powerful command-line tool that lets you automate all aspects of vSphere management, including network, storage, VM, guest OS and more\" - VMware</p>"},{"location":"vmware/PowerCLI/#installation","title":"Installation","text":"<p>Ladda ner installationsfilen fr\u00e5n VMwares hemsida alternativt importera det fr\u00e5n online repo.</p> <pre><code>Install-Module -Name VMware.PowerCLI\nGet-PowerCLIVersion\n</code></pre> <p>Anslut till din ESXi/vCenter med:</p> <p><code>Connect-VIServer</code></p> <p>Untrusted certificate</p> <p><code>Set-PowerCLIConfiguration\u00a0-InvalidCertificateAction\u00a0ignore\u00a0-confirm:$false</code></p>"},{"location":"vmware/PowerCLI/#exempel","title":"Exempel","text":"<p>Flytta alla vms fr\u00e5n en datastore till en annan.</p> <p><code>Get-Datastore</code> <code>Get-VM\u00a0-Datastore\u00a0Datastore1\u00a0|\u00a0Move-VM\u00a0-Datastore\u00a0Datastore2\u00a0-DiskStorageFormat\u00a0thin</code></p> <p>Flytta alla vms fr\u00e5n en host till en annan.</p> <p><code>Get-VMHost\u00a0172.20.0.2\u00a0|\u00a0Get-VM\u00a0|\u00a0Move-VM\u00a0-destination\u00a0172.20.0.8</code></p> <p>Visa alla notes</p> <p><code>Get-VM\u00a0|\u00a0Select-Object\u00a0-ExpandProperty\u00a0Notes</code></p> <p>Lista hardware version f\u00f6r alla vms</p> <p><code>Get-VM\u00a0|\u00a0Select\u00a0Name,\u00a0Version</code></p> <p>Ladda upp fil till datastore</p> <p><code>Copy-DatastoreItem\u00a0-Item\u00a0linux.iso\u00a0-Destination\u00a0vmstore:\\DC\\DATASTORE\\linux.iso</code></p> <p>Hitta vilken vm som har en viss MAC-adress</p> <pre><code>Get-vm | Select Name, @{N=\u201cNetwork\u201c;E={$_ | Get-networkAdapter | ? {$_.macaddress -eq \u201c00:50:56:00:50:43\u201c}}} |Where {$_.Network-ne \u201c\u201d}\n</code></pre> <p>Kolla NTP f\u00f6r hostarna</p> <pre><code>Get-VMHost | Sort-Object Name | Select-Object Name, @{N=\u201dCluster\u201d;E={$_ | Get-Cluster}}, @{N=\u201dDatacenter\u201d;E={$_ | Get-Datacenter}}, @{N=\u201cNTPServiceRunning\u201c;E={($_ | Get-VmHostService | Where-Object {$_.key-eq \u201cntpd\u201c}).Running}}, @{N=\u201cStartupPolicy\u201c;E={($_ | Get-VmHostService | Where-Object {$_.key-eq \u201cntpd\u201c}).Policy}}, @{N=\u201cNTPServers\u201c;E={$_ | Get-VMHostNtpServer}}, @{N=\"Date&amp;Time\";E={(get-view $_.ExtensionData.configManager.DateTimeSystem).QueryDateTime()}} | format-table -autosize\nGet-VMHost | Get-VmHostService | Where-Object {$_.key -eq \"ntpd\"} | Set-VMHostService -policy \"on\"; Get-VMHost | Add-VMHostNtpServer -NtpServer 0.se.pool.ntp.org; Get-VMHost | Get-VMHostFirewallException | Where-Object {$_.Name -eq \"NTP client\"} | Set-VMHostFirewallException -Enabled:$true; Get-VMHost | Get-VmHostService | Where-Object {$_.key -eq \"ntpd\"} | Start-VMHostService\n</code></pre> <p>Lista CPUer</p> <pre><code>Get-VMHost | Sort Name | Get-View | Select Name, @{N=\u201cCPU\u201c;E={$_.Hardware.CpuPkg[0].Description}}\n</code></pre> <p>Byt fr\u00e5n e1000 till vmxnet3</p> <pre><code>Get-VM -name \"&lt;VM&gt;\" | Get-NetworkAdapter | Where { $_.Type -eq \"E1000\"} | Set-NetworkAdapter -Type \"vmxnet3\"\n</code></pre> <p>Byt till multipathing p\u00e5 lun st\u00f6rre \u00e4n 1TB</p> <pre><code>Get-VMHost | Get-ScsiLun -LunType disk | Where {$_.MultipathPolicy -notlike \"RoundRobin\"} | Where {$_.CapacityGB -ge 1000} | Set-Scsilun -MultiPathPolicy RoundRobin\n</code></pre> <p>VLAN-hantering om man inte k\u00f6r vDS. Create and delete.</p> <pre><code>Get-Datacenter -Name DC01 | Get-VMHost | Get-VirtualSwitch -name vSwitch1 | new-VirtualPortGroup -name \"DMZ01\" -vlanid 101\n\nGet-Datacenter -Name DC01 | Get-VMHost | Get-VirtualSwitch -Name vSwitch1 | Get-VirtualPortGroup -Name \"DMZ01\" | Remove-VirtualPortGroup\n</code></pre> <p>S\u00e4tta Syslogserver</p> <pre><code>Get-VMHost | Get-VMHostSysLogServer\nGet-Cluster cluster | Get-VMHost | Get-AdvancedSetting -Name Syslog.global.logHost | Set-AdvancedSetting -value \"syslog.hackernet.se\" -Confirm:$False\n</code></pre> <p>Lagra logg p\u00e5 persistant storage</p> <p><code>Get-Cluster\u00a0cluster\u00a0|\u00a0Get-VMhost\u00a0|\u00a0Get-AdvancedSetting\u00a0-Name\u00a0Syslog.global.logDirUnique\u00a0|\u00a0Set-AdvancedSetting\u00a0-Value\u00a0$True\u00a0-Confirm:$False</code> <code>Get-Cluster\u00a0cluster\u00a0|\u00a0Get-VMHost\u00a0|\u00a0Get-AdvancedSetting\u00a0-Name\u00a0Syslog.global.logDir\u00a0|\u00a0Set-AdvancedSetting\u00a0-value\u00a0\"[datastore]\u00a0esxi_logs\"\u00a0-Confirm:$False</code></p> <p>DNS</p> <pre><code>Get-VMHost | Select Name, @{N='DNS Server(s)';E={$_.Extensiondata.Config.Network.DnsConfig.Address -join ', '}} | FT -autosize\nGet-VMHost | Get-VMHostNetwork -ErrorAction SilentlyContinue | Set-VMHostNetwork -DnsAddress @(\"10.240.100.81\", \"10.60.0.81\")\n</code></pre> <p>Find Thick VM disks</p> <pre><code> Get-Datastore | Get-VM | Get-HardDisk | Where {$_.storageformat -eq \"Thick\" } | Select Parent, Name, CapacityGB, storageformat | FT -AutoSize\n</code></pre>"},{"location":"vmware/PowerCLI/#script","title":"Script","text":"<p>Ett script f\u00f6r att skapa vm. New-VM.ps1</p> <pre><code>#List functions first\n\nfunction Gather-Info {\n[string]$script:VMName = Read-host \"Enter the name of the VM you wish to create\"\nGet-VMHost | Format-Wide\n[string]$script:HOSTName = Read-host \"Enter host\"\nGet-Datastore -VMHost $HOSTName | Format-Wide\n[string]$script:DSName = Read-Host \"Enter datastore\"\n[string]$script:VERSION = Read-Host \"Enter VM-Version, exempel v9\"\n[int]$script:NUMCPU =  Read-Host \"Antal CPU-cores\"\n[int]$script:MEMORYMB =  Read-Host \"RAM, Antal MB\"\n[int]$script:DiskGB =  Read-Host \"Disk, Antal GB\"\nGet-VirtualPortGroup -VMHost $HOSTName\n[string]$script:NETWORK = Read-Host \"Select Network\"\n[string]$script:NOTES = Read-Host \"Notes\"\n[System.Enum]::GetNames([VMware.Vim.VirtualMachineGuestOsIdentifier]) | Format-Wide\n[string]$script:GUESTID =  Read-Host \"Select that guestid\"\n}\n\n\nfunction CreateVM {\nWrite-Host -ForegroundColor Green \"Now the magic happens\"\nWrite-Host \"Creating VM\"\nNew-VM -Name $VMName -VMHost $HOSTName -Datastore $DSName -DiskStorageFormat Thin -version $VERSION -GuestId $GUESTID -NumCpu $NUMCPU -MemoryMB $MEMORYMB -Notes $NOTES -DiskGB $DiskGB -NetworkName $NETWORK | out-null\nWrite-Host -ForegroundColor Green \"Convert to vmxnet3?\"\nGet-VM $VMName | Get-NetworkAdapter | Set-NetworkAdapter -Type vmxnet3 | out-null\nStart-Sleep -Seconds 1;\nWrite-Host \"Starting the VM\"\nStart-vm -VM $VMName -runAsync\nStart-Sleep -Seconds 1;\nWrite-Host -ForegroundColor Green \"Power On Complete\"\n}\n\n\n#Connect to vSphere\n$VSPHERE = Read-host \"Skriv IP till vCenter eller ESXi-host, tryck enter\"\nConnect-VIServer $VSPHERE\n\n\n#Use functions and verify input\nDo {\nGather-Info\nWrite-Host $VMName, $HOSTName, $DSName, HW $VERSION, $NUMCPU,vCPU $MEMORYMB,MB RAM $DiskGB,GB $NETWORK, $GUESTID, $NOTES\n$confirmation = Read-Host \"Proceed y/n\"\n}\nuntil ($confirmation -eq 'y')\n\nCreateVM\nbreak\n</code></pre> <p>Script f\u00f6r att kolla disktyp. Disktype.ps1</p> <pre><code>Connect-viserver \"VCENTER_NAME\"  #ange namn p\u00e5 Vcenter\n\n$report = @()\n\nforeach ($vm in Get-VM ){\n$vmhdd = $vm | Get-HardDisk\nforeach ($vmdisk in $vmhdd){\n  $diskStyle = $null\n  $format = $vmdisk.StorageFormat\n\n$list = '' | select Name,Cluster,VMDK,DiskMode,DiskFormat,Filename\n$list.Name = $vm.Name\n$list.Cluster = $vm.VMHost.Parent\n$list.VMDK = $vmdisk.name\n$list.DiskMode = $vmdisk.Persistence\n$list.DiskFormat = $vmdisk.StorageFormat\n$list.Filename = $vmdisk.filename\n\n$report += $list\n}}\n$report | Sort Name | Export-Csv -NoTypeInformation -Path C:\\temp\\vm_disk_type.csv   #H\u00e4r s\u00e4tter du vart du vill spara filen, nu sparas den under C:\\temp\n</code></pre>"},{"location":"vmware/Standard_vSwitch/","title":"Standard vSwitch","text":"<p>En vSwitch \u00e4r som namnet antyder en virtuell switch, till vilken virtuella maskiner ansluter sina virtuella n\u00e4tverkskort (vNIC). Till en vSwitch kopplas ett eller flera fysiska NIC:ar (pNIC) fr\u00e5n ESXI-hosten som anv\u00e4nds som uppl\u00e4nk(ar).</p>"},{"location":"vmware/Standard_vSwitch/#port-groups","title":"Port Groups","text":"<p>Port Groups anv\u00e4nds f\u00f6r att gruppera och/eller separera virtuella maskiner n\u00e4tverksm\u00e4ssigt, t ex Test och Produktion. Portgrupperna kan tilldelas olika, eller samma VLAN, dock m\u00e5ste de ha ett unikt namn. En portgrupp kan konfigureras med tre olika VLAN Tagging Modes: External Switch Tagging (EST), endast otaggad trafik forwarderas, VLAN ID 0 anv\u00e4nds. Virtual Switch Tagging (VST), vSwitchen taggar trafik, VLAN ID 1-4094 anv\u00e4nds. Virtual Guest Tagging (VGT), det \u00e4r upp till VM:en att sk\u00f6ta VLAN-taggningen, VLAN ID 4096 anv\u00e4nds.</p>"},{"location":"vmware/Standard_vSwitch/#network-security-policies","title":"Network Security Policies","text":"<p>I en vSwitch kan en Security Policy konfigureras, de tre inst\u00e4llningar som kan \u00e4ndras \u00e4r: Promiscuous Mode - Promiscuous mode till\u00e5ter (vid Accept) att medlemmar i portgruppen tar emot samtliga frames som traverserar den virtuella switchen, eller f\u00f6r det VLAN som specificerats i portgruppen. MAC Address Changes - Till\u00e5ter/f\u00f6rbjuder VM:en att byta MAC-adress inifr\u00e5n g\u00e4st-OS:et. Om policyn \u00e4r inst\u00e4lld p\u00e5 Reject, st\u00e4ngs den virtuella switchporten om ett MAC-adressbyte registreras. Porten avblockeras d\u00e5 MAC-adressen \u00e4ndras tillbaka till \"Initial address\". Forged Transmits - Om Forged Transmits \u00e4r satt till Reject kommer ESXi-hosten att inspektera L2-headern p\u00e5 varje paket som skickas fr\u00e5n VM:arna i portgruppen/vSwitch:en. MAC-adressen i headern kommer att j\u00e4mf\u00f6ras med \"Effective address\" (adressen som g\u00e4st-OS:et tilldelat sin adapter, oftast samma som Initial address), matchar inte source-adressen i L2-headern kommer paketet att droppas.</p> <p>Per default \u00e4r endast Promiscuous Mode inst\u00e4llt p\u00e5 Reject i en Standard vSwitch. I en DvSwitch d\u00e4remot \u00e4r samtliga inst\u00e4llda p\u00e5 Reject fr\u00e5n b\u00f6rjan.</p> <p>Category:VMware</p>"},{"location":"vmware/VM_Encryption/","title":"VM Encryption","text":"<p>VM Encryption sker i hypervisorn, \"under\" den virtuella maskinen. VM Encryption \u00e4r helt agnostiskt, Guest OS eller datastore-typ spelar ingen roll. Krypteringen aktiveras via Storage-policy. De filer som krypteras \u00e4r:</p> <ul> <li>VM-filer (VSWP, VMSN mfl)</li> <li>VM-diskfiler</li> <li>Host core dumps</li> </ul> <p>Filer som inte krypteras:</p> <ul> <li>Loggfiler</li> <li>VM-konfigurationsfiler (VMX, VMSD)</li> <li>Descriptor-filer f\u00f6r virtuella diskar (inneh\u00e5ller dock en krypterad     bundling av nycklar)</li> </ul>"},{"location":"vmware/VM_Encryption/#requirements","title":"Requirements","text":"<p>F\u00f6r att aktivera VM Encryption m\u00e5ste Host Encryption mode vara p\u00e5slaget, detta ska oftast ske automatiskt, men kan explicit aktiveras. Detta g\u00f6rs via Host -&gt; Configure -&gt; System -&gt; Security Profile -&gt; v\u00e4lj Host Encryption Mode -&gt; Edit -&gt; s\u00e4tt till Enabled. Under tiden en VM krypteras m\u00e5ste \u00e4ven minst lika mycket ledig diskyta p\u00e5 datastore:t finnas som VM:en f\u00f6rbrukar.</p>"},{"location":"vmware/VM_Encryption/#kms-server-for-vm-encryption","title":"KMS-server f\u00f6r VM Encryption","text":"<p>F\u00f6rutsatt att en (tredjeparts) KMS-server finns tillg\u00e4nglig:</p> <ol> <li>L\u00e4gg till den via vCenter-noden -&gt; Configure -&gt; More     -&gt; Key Management Server -&gt; Tryck p\u00e5 plustecknet med texten     Add KMS bredvid.</li> <li>Skapa ett nytt kluster, fyll i infon som efterfr\u00e5gas.</li> <li>S\u00e4tt klustret som default KMS Cluster.</li> <li>Klicka p\u00e5 Trust i Trust Certificate-rutan f\u00f6r att acceptera Trust:en     mot KMS.</li> </ol> <p>Om KMS-servern \u00e4r korrekt konfigurerad kan du verifiera detta genom att titta p\u00e5 Connection Status, en gr\u00f6n bock visar detta (=Normal).</p> <p>KMS-servern \u00e4r den som hanterar kryptering av VMs, vCenter \u00e4r endast klient till KMS-servern. Om man inte vill att alla administrat\u00f6rer ska ha tillg\u00e5ng till management av VM Encryption kan man anv\u00e4nda den nya default-rollen No Cryptography Administrator.</p>"},{"location":"vmware/VM_Encryption/#encryption-storage-policy","title":"Encryption Storage Policy","text":"<p>Efter anslutningen mot KMS uppr\u00e4ttats kan man skapa sin Encryption Storage Policy. Beh\u00f6righetsm\u00e4ssigt kr\u00e4vs \u00e4ven Cryptographic operations.Manage encryption policies-beh\u00f6righeten. Policyn skapas via Home -&gt; Policies and Profiles -&gt; VM Storage Policies -&gt; Create VM Storage Policy.</p> <ol> <li>F\u00f6lj wizarden, s\u00e4tt namn m.m.</li> <li>Bocka f\u00f6r Use common rules in the VM storage policy.</li> <li>Tryck p\u00e5 Add component, v\u00e4lj Encryption -&gt; Default     Encryption Properties och sedan Next (Defaults r\u00e4cker oftast     om policyn inte skall innefatta andra funktioner, t ex caching eller     replikering).</li> <li>Bocka ur Use rule-sets in the storage policy, v\u00e4lj Next.</li> <li>P\u00e5 Storage compatibility-sidan, l\u00e5t Compatible vara f\u00f6rvalt,     v\u00e4lj ett datastore och sedan Next.</li> <li>Verifiera alla settings och tryck Finish.</li> </ol> <p>Den virtuella maskinen kan krypteras f\u00f6r sig medan diskarna kan l\u00e4mnas okrypterade, d\u00e5 man endast applicerar Encryption Storage Policy:n p\u00e5 VM Home och inte p\u00e5 diskarna. Krypterade diskar kan d\u00e4remot inte anv\u00e4ndas av en okrypterad VM. Category:VMware</p>"},{"location":"vmware/VMware_ESXi/","title":"VMware ESXi","text":"<p>ESXi \u00e4r en type 1 hypervisor utvecklad och s\u00e5ld av VMware.</p>"},{"location":"vmware/VMware_ESXi/#forberedelser","title":"F\u00f6rberedelser","text":"<p>VMware uppdaterar ESXi med j\u00e4mna mellanrum, var 1-3 m\u00e5nad, och din iso blir snabbt utdaterad. Det smidigaste s\u00e4ttet att tanka hem den senaste iso:n \u00e4r med ett powershell-script. Inget VMware-konto beh\u00f6vs heller!</p> <p>http://vibsdepot.v-front.de/tools/ESXi-Customizer-PS-v2.5.ps1</p> <p>OBS Requirements: VMware PowerCLI version 5.1 or newer</p> <p><code>.\\ESXi-Customizer-PS-v2.5.ps1\u00a0-v65</code></p> <p>Planerar du att k\u00f6ra ESXi p\u00e5 ett konsumentmoderkort \u00e4r det inte s\u00e4kert att n\u00e4tverkskortet fungerar med standard-iso:n. Vill du ha en iso med mer drivrutiner k\u00f6r ist\u00e4llet f\u00f6ljande kommando:</p> <p><code>.\\ESXi-Customizer-PS-v2.5.ps1\u00a0-v60\u00a0-vft\u00a0-load\u00a0net-e1000e,net55-r8168,net-r8169,sata-xahci</code></p>"},{"location":"vmware/VMware_ESXi/#patchhantering","title":"Patchhantering","text":"<p>Detta \u00e4r generell patchhantering.</p> <p>Online</p> <p>B\u00f6rja med att kolla vad senaste imagen heter p\u00e5 patch tracker</p> <p><code>esxcli\u00a0network\u00a0firewall\u00a0ruleset\u00a0set\u00a0-e\u00a0true\u00a0-r\u00a0httpClient</code> <code>esxcli\u00a0software\u00a0profile\u00a0update\u00a0-d</code><code>https://hostupdate.vmware.com/software/VUM/PRODUCTION/main/vmw-depot-index.xml</code><code>-p\u00a0ESXi-5.X.X-2015XXXXXXX-standard\u00a0[--allow-downgrades]</code> <code>reboot</code></p> <p>Offline</p> <p>Ladda ner zip fr\u00e5n VMwares hemsida och l\u00e4gg in p\u00e5 datastore</p> <p><code>esxcli\u00a0software\u00a0profile\u00a0update\u00a0-d\u00a0/vmfs/volume/your_datastore/ESXi550-2015XXX.zip\u00a0-p\u00a0ESXi-5.5.0-2015XXX-standard</code> <code>reboot</code></p> <p>Detta fungerar \u00e4ven mellan versioner, 5.1 -&gt; 5.5 -&gt; 6.0</p> <p>vCenter</p> <p>Har man vCenter b\u00f6r man anv\u00e4nda VMware Update Manager.</p> <p><code>.\\ESXi-Customizer-PS-v2.5.ps1\u00a0-v55\u00a0-ozip</code></p> <p>Output an ESXi Offline Bundle that you can use for importing into Update Manager</p>"},{"location":"vmware/VMware_ESXi/#logghantering","title":"Logghantering","text":"<p>Loggar ber\u00e4ttar mycket om din milj\u00f6, samla dem. Det finns olika varianter f\u00f6r central ESXi-logghantering.</p> <ul> <li>vCenter builtin syslog service</li> <li>VMware vRealize Log Insight</li> <li>http://www.sexilog.fr/</li> </ul> <p>Peka loggarna i ESXi: Advanced Settings -&gt; Syslog.global.logHost -&gt;  <p>Verify</p> <p><code>esxcli\u00a0system\u00a0syslog\u00a0config\u00a0get</code></p>"},{"location":"vmware/VMware_ESXi/#embedded-host-client","title":"Embedded Host Client","text":"<p>Webgui till enskilda ESXi-hostar, likt vCenters. Detta \u00e4r standard sedan ESXi 6.0u2.</p> <p><code>https://[ESXI-HOST]/ui</code></p>"},{"location":"vmware/VMware_ESXi/#ssh","title":"SSH","text":"<p>Varningsmeddelande kan st\u00e4ngas av med:</p> <p><code>esxcli\u00a0system\u00a0settings\u00a0advanced\u00a0set\u00a0-o\u00a0/UserVars/SuppressShellWarning\u00a0-i\u00a01</code></p> <p>Nyckelautentisering OBS med -O skriver man \u00f6ver existerande nycklar</p> <p><code>wget</code><code>http://website/id_dsa.pub</code><code>-O\u00a0/etc/ssh/keys-root/authorized_keys</code></p> <p>DCUI Skriv f\u00f6ljande f\u00f6r att starta Direct Console direkt fr\u00e5n din SSH-session:</p> <p><code>dcui</code></p>"},{"location":"vmware/VMware_ESXi/#snmp","title":"SNMP","text":"<p>F\u00f6r att sl\u00e5 p\u00e5 SNMP och s\u00e4tta communitys kan man g\u00f6ra det via CLI.</p> <p><code>esxcli\u00a0system\u00a0snmp\u00a0set\u00a0--communities</code><code>community</code></p> <p>Enable SNMP Service:</p> <p><code>esxcli\u00a0system\u00a0snmp\u00a0set\u00a0--enable\u00a0true</code></p> <p>\u00d6ppna upp i den interna brandv\u00e4ggen:</p> <p><code>esxcli\u00a0network\u00a0firewall\u00a0ruleset\u00a0set\u00a0--ruleset-id\u00a0snmp\u00a0--allowed-all\u00a0true</code> <code>esxcli\u00a0network\u00a0firewall\u00a0ruleset\u00a0set\u00a0--ruleset-id\u00a0snmp\u00a0--enabled\u00a0true</code></p> <p>Om du vill \u00f6ppna upp i brandv\u00e4ggen p\u00e5 ett s\u00e4kert s\u00e4tt och endast till\u00e5ta IP's ifr\u00e5n 10.0.0.0/24:</p> <p><code>esxcli\u00a0network\u00a0firewall\u00a0ruleset\u00a0set\u00a0--ruleset-id\u00a0snmp\u00a0--allowed-all\u00a0false</code> <code>esxcli\u00a0network\u00a0firewall\u00a0ruleset\u00a0allowedip\u00a0add\u00a0--ruleset-id\u00a0snmp\u00a0--ip-address\u00a010.0.0.0/24</code> <code>esxcli\u00a0network\u00a0firewall\u00a0ruleset\u00a0set\u00a0--ruleset-id\u00a0snmp\u00a0--enabled\u00a0true</code></p> <p>Starta sedan om SNMP tj\u00e4nsten:</p> <p><code>/etc/init.d/snmpd\u00a0restart</code></p>"},{"location":"vmware/VMware_ESXi/#vib","title":"VIB","text":"<p>VIB paket kan vara drivrutiner, third party software eller uppdateringar.</p> <p>Installera</p> <p><code>esxcli\u00a0software\u00a0vib\u00a0install\u00a0-d\u00a0\u201c/vmfs/volumes/Datastore/DirectoryName/PatchName.zip\u201c</code></p> <p>Updatera</p> <p><code>esxcli\u00a0software\u00a0vib\u00a0update\u00a0-d\u00a0\u201c/vmfs/volumes/Datastore/DirectoryName/PatchName.zip\u201d</code></p> <p>Lista installerade VIB's</p> <p><code>esxcli\u00a0software\u00a0vib\u00a0list</code></p>"},{"location":"vmware/VMware_ESXi/#network","title":"Network","text":"<p>Undrar du vilket n\u00e4tverkskort t.ex. vmnic2 \u00e4r fysiskt kan du k\u00f6ra f\u00f6ljande kommando om du loggar in med SSH p\u00e5 hosten. Porten b\u00f6rjar blinka i 60 sekunder f\u00f6rutsatt att det inte sitter n\u00e5gon kabel i.</p> <p><code>ethtool\u00a0-p\u00a0vmnic2\u00a060</code></p> <p>Lista NetStack-instanser (VRF)</p> <p><code>esxcfg-vmknic\u00a0-l</code> <code>esxcli\u00a0network\u00a0ip\u00a0interface\u00a0list</code> <code>ping\u00a0-S</code><code>10.0.0.10</code> <p>CDP Sl\u00e5 p\u00e5 CDP p\u00e5 en vSwitch</p> <p><code>esxcli\u00a0network\u00a0vswitch\u00a0standard\u00a0set\u00a0--cdp-status\u00a0both|listen\u00a0--vswitch-name\u00a0vSwitch1</code></p> <p>Iperf Fr.o.m. ESXi 6.0 finns iperf inbyggt. Se \u00e4ven Iperf.</p> <p>Server</p> <p><code>cp\u00a0/usr/lib/vmware/vsan/bin/iperf\u00a0/usr/lib/vmware/vsan/bin/iperf.copy</code> <code>/usr/lib/vmware/vsan/bin/iperf.copy\u00a0-s</code></p> <p>Klient</p> <p><code>/usr/lib/vmware/vsan/bin/iperf\u00a0-c</code> <p>PXE Anv\u00e4nd Ventoy.</p>"},{"location":"vmware/VMware_ESXi/#tips-n-tricks","title":"Tips n Tricks","text":""},{"location":"vmware/VMware_ESXi/#ntp","title":"NTP","text":"<p>NTP via SSH</p> <p><code>cat\u00a0&gt;\u00a0/etc/ntp.conf\u00a0&lt;&lt;\u00a0__EOF__</code> <code>restrict\u00a0default\u00a0kod\u00a0nomodify\u00a0notrap\u00a0noquery\u00a0nopeer</code> <code>restrict\u00a0127.0.0.1</code> <code>driftfile\u00a0/etc/ntp.drift</code> <code>server\u00a00.se.pool.ntp.org</code> <code>__EOF__</code> <code>/sbin/chkconfig\u00a0ntpd\u00a0on</code></p>"},{"location":"vmware/VMware_ESXi/#nested-hypervisor","title":"Nested Hypervisor","text":"<p>F\u00f6r att kunna k\u00f6ra en nested hypervisor (t.ex. Hyper-V, ESXi) p\u00e5 din ESXi-host m\u00e5ste det finns EPT/RVI-st\u00f6d i CPUn. Ett enkelt s\u00e4tt att kolla det p\u00e5 din ESXi-host:</p> <p><code>vim-cmd\u00a0hostsvc/advopt/update\u00a0Config.HostAgent.plugins.solo.enableMob\u00a0bool\u00a0true</code> <code>https://[esxi-ip-address]/mob/?moid=ha-host&amp;doPath=capability</code></p> <p>logga in och kolla raden: nestedHVSupported</p> <p>Sedan m\u00e5ste hosten VHV enableas.</p> <p><code>grep\u00a0-i\u00a0\"vhv.enable\"\u00a0/etc/vmware/config\u00a0||\u00a0echo\u00a0\"vhv.enable\u00a0=\u00a0\\\"TRUE\\\"\"\u00a0&gt;&gt;\u00a0/etc/vmware/config</code> <code>reboot</code></p>"},{"location":"vmware/VMware_ESXi/#initializing-acpi","title":"Initializing ACPI","text":"<p>Om uppstarten fastnar p\u00e5 detta steg, dubbelkolla att det inte bootar med UEFI och i s\u00e5 fall ta bort UEFI fr\u00e5n boot-menyn.</p>"},{"location":"vmware/VMware_ESXi/#rollback","title":"Rollback","text":"<p>F\u00f6r att backa en ESXi-uppgradering kan man g\u00f6ra en rollback. Starta om hosten, under boot n\u00e4r progressbaren kommer tryck: Shift+R OBS bootbanken skrivs \u00f6ver var 60:e minut s\u00e5 man har en timme p\u00e5 sig</p> <p><code>Current\u00a0hypervisor\u00a0will\u00a0permanently\u00a0be\u00a0replaced</code> <code>with\u00a0build:\u00a0X.X.X-XXXXXX.\u00a0Are\u00a0you\u00a0sure?\u00a0[Y/n]</code> <code>Shift+Y</code> <code>Enter\u00a0to\u00a0boot</code></p>"},{"location":"vmware/VMware_ESXi/#lista-maskiner","title":"Lista maskiner","text":"<p>Lista virtuella maskiner som \u00e4r p\u00e5</p> <p><code>/usr/sbin/localcli\u00a0vm\u00a0process\u00a0list</code></p>"},{"location":"vmware/VMware_ESXi/#lamna-tillbaka-oanvanda-blocks","title":"L\u00e4mna tillbaka oanv\u00e4nda blocks","text":"<p>Om du har ett san, d\u00e4r du k\u00f6r med tjocka diskar mot s\u00e5 kommer du beh\u00f6va l\u00e4mna tillbaka blocks ibland. f\u00f6r att enkelt g\u00f6ra detta kan du k\u00f6ra kommandot:</p> <p><code>for\u00a0i\u00a0in\u00a0$(ls\u00a0/vmfs/volumes/\u00a0|\u00a0grep\u00a0datastorename)\u00a0;\u00a0do\u00a0echo\u00a0\"Reclaiming\u00a0on:\u00a0\"\u00a0$i\u00a0;\u00a0time\u00a0esxcli\u00a0storage\u00a0vmfs\u00a0unmap\u00a0-l\u00a0$i\u00a0;\u00a0done</code></p> <p>Byt ut datastorename mot namnstandarden p\u00e5 dina datastores. tex ssd_ds om dina datastores heter ssd_ds001-8</p> <p>Detta beh\u00f6vs g\u00f6ra om du k\u00f6r vmfs 5 och tjocka diskar. Har du 512kb blocksize och vmfs 6 s\u00e5 sk\u00f6ts det automagiskt p\u00e5 DELL compellant</p>"},{"location":"vmware/VMware_ESXi/#g5-g7-hp-proliant","title":"G5-G7 HP ProLiant","text":"<p>Ladda ner fr\u00e5n: http://www8.hp.com/us/en/products/servers/solutions.html?compURI=1499005#tab=TAB4</p> <p><code>.\\ESXi-Customizer-PS-v2.4.ps1\u00a0-v55\u00a0-izip\u00a0.\\VMware-ESXi-5.5.0-Update2-2403361-HP-550.9.2.27-Mar2015-depot.zip\u00a0-update\u00a0-remove\u00a0hp-ams</code></p>"},{"location":"vmware/VMware_ESXi/#lsi-raid","title":"LSI RAID","text":"<p>Vill du monitorera ditt raidkort i vsphereklienten g\u00f6r f\u00f6ljande: Ladda upp f\u00f6ljande fil till datastore</p> <p><code>http://ds.karen.hj.se/~cameljoe/resources/VMW-ESX-5.5.0-lsiprovider-500.04.V0.55-0006-offline_bundle-2626932.zip</code></p> <p><code>esxcli\u00a0software\u00a0vib\u00a0install\u00a0-d\u00a0/vmfs/volumes/[DATASTORE]/VMW-ESX-5.5.0-lsiprovider-500.04.V0.55-0006-offline_bundle-2626932.zip</code> <code>reboot</code></p> <p>Category:VMware Category:Guider</p>"},{"location":"vmware/VMware_Vsphere_Client/","title":"VMware Vsphere Client","text":"<p>VSphere Client kan anv\u00e4ndas f\u00f6r att managera ESXi Hosts samt Vcenter men har inte alla funktioner till Vcenter som finns i WebGuit.</p>"},{"location":"vmware/VMware_Vsphere_Client/#installation","title":"Installation","text":"<p>Vsphere client finns att ladda ner via din ESXi Host eller Vcenter och \u00e4r bara att klicka next p\u00e5 genom hela.</p>"},{"location":"vmware/VMware_Vsphere_Client/#kanda-fel","title":"K\u00e4nda Fel","text":"<p>Fel som kan uppst\u00e5 med vsphere client.</p> <p><code>Om`` ``man`` ``f\u00e5r`` ``felet`` ``VPXclient.exe`` ``har`` ``slutat`` ``svara`` ``vid`` ``start`` ``av`` ``programmet.</code> <code>L\u00e4nkplats\u00a0C:\\Program\u00a0Files\u00a0(x86)\\VMware\\Infrastructure\\Virtual\u00a0Infrastructure\u00a0Client\\Launcher\u00a0(windows\u00a010\u00a0Pro\u00a0x64)</code> <code>-\u00a0Redigera\u00a0fil\u00a0VpxClient.exe.config\u00a0och\u00a0l\u00e4gg\u00a0till\u00a0:</code> <code></code> <code></code> <code></code></p> <p>Category:VMware Category:Guider</p>"},{"location":"vmware/VMware_vCenter/","title":"VMware vCenter","text":"<p>vCenter \u00e4r en central manage server f\u00f6r alla dina ESXi hostar. Det \u00e4r med vCenter du f\u00e5r funktioner som HA. Det kr\u00e4vs ett VMware konto f\u00f6r att kunna ladda hem vCenter och sedan en licens f\u00f6r att kunna anv\u00e4nda l\u00e4ngre \u00e4n 60 dagar.</p>"},{"location":"vmware/VMware_vCenter/#installation","title":"Installation","text":"<p>Enklaste s\u00e4ttet att f\u00e5 ig\u00e5ng vCenter \u00e4r att ladda hem vmwares appliance fr\u00e5n vmware och deploya den p\u00e5 en esxi host. VCSA 6.0, vCenter Server Appliance, finns inte l\u00e4ngre som .ovf utan man laddar hem iso.</p>"},{"location":"vmware/VMware_vCenter/#konfiguration","title":"Konfiguration","text":"<p>Den mesta konfiguration sker med hj\u00e4lp av vmwares klient eller vmware webui.</p>"},{"location":"vmware/VMware_vCenter/#forsta-gangen","title":"F\u00f6rsta g\u00e5ngen","text":"<ul> <li>Default anv\u00e4ndarnamn och l\u00f6senord p\u00e5 vmwares appliance \u00e4r,</li> </ul> <p><code>root/vmware</code></p> <ul> <li>B\u00f6rja med att \u00f6ppna en console och logga in. K\u00f6r scriptet under f\u00f6r     att s\u00e4tta ip, hostnamn, gw, dns.</li> </ul> <p><code>/opt/vmware/share/vami/vami_config_net</code></p> <ul> <li>Surfa sedan in p\u00e5 https://:5480, h\u00e4r g\u00f6rs den initiala     setupen. <li>All datacenter och klustermanagering g\u00f6rs sedan fr\u00e5n:     https://:9443"},{"location":"vmware/VMware_vCenter/#ldap-koppla-vcenter","title":"LDAP koppla vCenter","text":"<ul> <li>Logga in som administrator@vsphere.local (Default l\u00f6senord \u00e4r     vmware)</li> <li>G\u00e5 till     <code>Administration &gt; Single Sign-On &gt; Configuration &gt; Identity Sources</code>.     Tryck p\u00e5 det gr\u00f6na plustecknet.</li> </ul> <p><code>Om\u00a0inte\u00a0Single\u00a0Sign-On\u00a0finns\u00a0under\u00a0Administration\u00a0s\u00e5\u00a0\u00e4r\u00a0du\u00a0antagligen\u00a0inloggad\u00a0som\u00a0anv\u00e4ndaren\u00a0root.</code></p> <ul> <li>Fyll sedan i dina uppgifter och tryck p\u00e5 \"Test connection\".</li> </ul> <p>F\u00f6r att kunna se Single sign-on under Administration och g\u00f6ra \u00e4ndringar beh\u00f6ver man l\u00e4gga till sin anv\u00e4ndare eller en grupp i Administrators.</p> <ul> <li>G\u00e5 till <code>Users and Groups &gt; Groups</code>. L\u00e4gg till en anv\u00e4ndare eller en     grupp i Administrators gruppen. Dettaa har inget med     r\u00e4ttigheterna mot VM's.</li> </ul> <p>* F\u00f6r att styra r\u00e4ttigheter f\u00f6r vad en anv\u00e4ndare f\u00e5r g\u00f6ra g\u00e5 till <code>Administration &gt; Access Control &gt; Roles</code> Tryck p\u00e5 gruppen Administrator och sedan klicka p\u00e5 vCenterns hostnamn.</p> <ul> <li>Under vCenterns <code>Manage &gt; Permissions</code> S\u00e4tter man permissions f\u00f6r     vilka anv\u00e4ndare och grupper som f\u00e5r g\u00f6ra vad p\u00e5 servern.</li> </ul>"},{"location":"vmware/VMware_vCenter/#enable-scp","title":"Enable SCP","text":"<p>F\u00f6r att kunna SCP'a filer till vCenter skriv f\u00f6ljande:</p> <p><code>chsh\u00a0\u2013s\u00a0/bin/bash</code></p> <p>D\u00e5 \u00e4ndrar man login skalet fr\u00e5n appliancesh till bash och kan d\u00e5 SCP filer.</p> <p>F\u00f6r att \u00e4ndra tillbaka till vanliga skriv:</p> <p><code>chsh\u00a0-s\u00a0/bin/appliancesh</code></p>"},{"location":"vmware/VMware_vCenter/#vmware-client-integration-plugin","title":"VMware Client Integration Plugin","text":"<p>Beh\u00f6vs f\u00f6r att kunna \u00f6ppna console eller logga in med sitt windows login. L\u00e4nk till pluginet finns l\u00e4ngst ner p\u00e5 https://:9443."},{"location":"vmware/VMware_vCenter/#chrome-npapi","title":"Chrome NPAPI","text":"<p>Pluginet anv\u00e4nder sig av NPAPI(Netscape Plugin Application Programming Interface). Chrome valde i version 42 att st\u00e4nga av st\u00f6det f\u00f6r NPAPI och kommer i version 45 att ta bort NPAPI helt fr\u00e5n webbl\u00e4saren.</p> <p>Tills dom tagit bort NPAPI kan man aktivera pluginet igen med denna l\u00e4nken,</p> <p><code>chrome://flags/#enable-npapi</code></p>"},{"location":"vmware/VMware_vCenter/#chrome-45","title":"Chrome 45","text":"<p>Nu f\u00e5r man installera ett CIP-paket f\u00f6r att f\u00e5 samma funktionalitet, detta anv\u00e4nder inte NPAPI.</p> <p><code>http://vsphereclient.vmware.com/vsphereclient/2/9/9/4/0/4/1/VMware-ClientIntegrationPlugin-6.0.0.exe</code></p>"},{"location":"vmware/VMware_vCenter/#vmware-remote-console","title":"VMware Remote Console","text":"<p>VMware Remote Console(VMRC) togs fram efter att Chrome valde att ta bort st\u00f6det f\u00f6r NPAPI. VMRC \u00e4r ett standalone program f\u00f6r Windows och Mac OS och anv\u00e4nds tillsamans med VMware vSphere Web Client det f\u00f6ljer med vCenter Server 5.5U2b och senare.</p> <p>F\u00f6r att ladda hem och starta VMCR i vSphere 5.5 och 6.0 s\u00e5 har tv\u00e5 nya l\u00e4nkar lagts till p\u00e5 varje VM's status sida.</p> <p>vSphere 5.5 heter l\u00e4nkarna Open with VMRC och Download VMCR</p> <p>Vsphere 6.0 heter l\u00e4nkarna Launch Remote Console och Download Remote Console</p>"},{"location":"vmware/VMware_vCenter/#andra-login-ui","title":"\u00c4ndra Login UI","text":"<p>I vCenter 6.0 g\u00e5r det att g\u00f6ra om sitt LoginUI tex l\u00e4gga till en egen bild. Det finns 2 filer som man kan \u00e4ndra i, det \u00e4r unpentry.jsp och login.css. I mappen img kan du l\u00e4gga bilder och referera till dom i koden.</p> <p>Hackernet's egna Login UI</p> <p>VCSA 6.0</p> <p><code>/usr/lib/vmware-sso/vmware-sts/webapps/websso/WEB-INF/views/unpentry.jsp</code> <code>/usr/lib/vmware-sso/vmware-sts/webapps/websso/resources/css/login.css</code> <code>/usr/lib/vmware-sso/vmware-sts/webapps/websso/resources/img</code></p> <p>Windows vCenter Server 6.0</p> <p><code>C:\\ProgramData\\VMware\\vCenterServer\\runtime\\VMwareSTSService\\webapps\\websso\\WEB-INF\\views</code> <code>C:\\ProgramData\\VMware\\vCenterServer\\runtime\\VMwareSTSService\\webapps\\websso\\resources\\css</code> <code>C:\\ProgramData\\VMware\\vCenterServer\\runtime\\VMwareSTSService\\webapps\\websso\\resources\\img</code></p>"},{"location":"vmware/VMware_vCenter/#regenerate-certificates","title":"Regenerate certificates","text":"<p>F\u00f6r att skapa nya cert eller l\u00e4gga in ett eget cert fr\u00e5n tex Let's Encrypt s\u00e5 anv\u00e4nder man certificate manager.</p> <p><code>/usr/lib/vmware-vmca/bin/certificate-manager</code></p>"},{"location":"vmware/VMware_vCenter/#reset-the-vmware-vcenter-single-sign-on-administrator-password","title":"Reset the VMware vCenter Single Sign-On administrator password","text":"<p>Om man gl\u00f6mt sitt l\u00f6senord till en anv\u00e4ndare tex Administrator@vSphere.local kan man skapa ett nytt.</p> <p><code>/usr/lib/vmware-vmdir/bin/vdcadmintool</code></p> <ul> <li>V\u00e4lj nr 3: Reset account password</li> <li>Ange f\u00f6ljande som UPN: '''Administrator@vSphere.</li> </ul> <p>Category:VMware Category:Guider</p>"},{"location":"vmware/VSphere_Permissions/","title":"VSphere Permissions","text":""},{"location":"vmware/VSphere_Permissions/#access-control","title":"Access Control","text":"<p>vSphere erbjuder detaljerad beh\u00f6righetskontroll med hj\u00e4lp av permissions. Beh\u00f6righeterna specificeras med hj\u00e4lp av roles, som kan best\u00e5 av flera privileges. En permission har tre best\u00e5ndsdelar; en role (inneh\u00e5llandes privileges), som tillsammans med en anv\u00e4ndare/grupp mappas mot ett objekt.</p> <p>N\u00e4r en permission tilldelas f\u00e5r man v\u00e4lja om den ska propagera ned\u00e5t i hierarkin. Propageringen st\u00e4lls inte in universellt, utan f\u00f6r varje tilldelad permission. Permissions som appliceras p\u00e5 child-objekt \u00f6verskrider alltid en permission som propagerats fr\u00e5n parent-objekt, dock kan enbart en permission explicit appliceras p\u00e5 ett objekt per anv\u00e4ndare/grupp. D\u00e5 tv\u00e5 permissions \u00e4rvs till samma objekt, t ex vid en kombination av arv fr\u00e5n VM Folder och Resource Pool, kombineras de. Om en anv\u00e4ndare \u00e4r medlem i flera grupper som har olika Permissions p\u00e5 ett objekt kan tv\u00e5 saker h\u00e4nda:</p> <ul> <li>Om inga permissions definierats f\u00f6r anv\u00e4ndaren direkt p\u00e5 objektet     appliceras de beh\u00f6righeter som grupperna medf\u00f6r.</li> <li>Om en permission definierats f\u00f6r anv\u00e4ndaren p\u00e5 objektet, tar den     f\u00f6retr\u00e4de \u00f6ver alla gruppbeh\u00f6righeter (\u00e4ven de som \u00e4rvts).</li> </ul> <p>F\u00f6r att se vilka permissions som applicerats p\u00e5 ett objekt g\u00e5r man till vSphere-objektet -&gt; Permissions-fliken, sedan tittar man i \"Defined In\"-kolumnen. Ifr\u00e5n denna vy kan \u00e4ven en lista \u00f6ver permissions exporteras.</p> <p>F\u00f6r att l\u00e4gga till/modifiera/ta bort permissions g\u00e5r man till: Home -&gt; Administration -&gt; Access Control -&gt; Roles</p>"},{"location":"vmware/VSphere_Permissions/#esxi-local-host-permissions","title":"ESXi Local Host Permissions","text":"<p>Standalone-hostar har tre f\u00f6rdefinierade roles som kan anv\u00e4ndas f\u00f6r att tilldela permissions. Dessa \u00e4r Administrator, Read Only och No Access.</p>"},{"location":"vmware/VSphere_Permissions/#vcenter-server-permissions","title":"vCenter Server Permissions","text":"<p>vCenter Permissions appliceras p\u00e5 objekt i objekthierarkin.</p>"},{"location":"vmware/VSphere_Permissions/#global-permissions","title":"Global Permissions","text":"<p>Global permissions appliceras p\u00e5 ett globalt rotobjekt som str\u00e4cker sig \u00f6ver olika l\u00f6sningar, t ex kan permission tilldelas en anv\u00e4ndare/grupp som ger l\u00e4sr\u00e4ttigheter b\u00e5de i vCenter och vRealize Orchestrator. Om inte propagering f\u00f6r en Global Permission sl\u00e5s p\u00e5 kommer anv\u00e4ndaren/gruppen inte f\u00e5 tillg\u00e5ng till objekten i hierarkin, utan enbart ett f\u00e5tal globala funktioner, t ex att skapa Roles.</p>"},{"location":"vmware/VSphere_Permissions/#vspherelocal-group-membership","title":"vSphere.local group membership","text":"<p>Medlemmar i vSphere.local-grupper kan utf\u00f6ra vissa saker, t ex licenshantering. Dessa grupper g\u00e4ller ocks\u00e5 f\u00f6r administration av PSC.</p>"},{"location":"vmware/VSphere_Permissions/#identity-sources","title":"Identity Sources","text":"<p>Det finns fyra supporterade identitetsk\u00e4llor som kan l\u00e4ggas till i vCenter (PSC):</p> <ul> <li>Active Directory</li> <li>Active Directory over LDAP</li> <li>OpenLDAP (flera implementationer st\u00f6ds)</li> <li>LocalOS (lokala anv\u00e4ndare p\u00e5 PSC:n)</li> </ul> <p>vCenter Single Sign-On system users finns ocks\u00e5, denna k\u00e4lla skapas och l\u00e4ggs till automatiskt n\u00e4r vCenter SSO installeras. Om Active Directory ska anv\u00e4ndas som identitetsk\u00e4lla m\u00e5ste vCenter-servern f\u00f6rst bli medlem i dom\u00e4nen. Detta g\u00f6rs under Administration -&gt; Deployment -&gt; System Configuration -&gt; Nodes, v\u00e4lj vCenter-servern i listan. Sedan under Manage-fliken -&gt; Settings -&gt; Advanced -&gt; Active Directory, klicka p\u00e5 \"Join...\"-knappen.</p>"},{"location":"vmware/VSphere_Permissions/#permission-validation","title":"Permission Validation","text":"<p>Som standard valideras alla anv\u00e4ndare och grupper var 1440:e minut (24h), om en anv\u00e4ndare tagits bort eller bytt namn tas alla permissions relaterade till denne bort vid n\u00e4sta validering.</p>"},{"location":"vmware/VSphere_Permissions/#system-roles-kontra-sample-roles","title":"System Roles kontra Sample Roles","text":"<p>System &amp; Sample Roles finns per default, det som skiljer dem \u00e5t \u00e4r att System Roles inte g\u00e5r att editera eller ta bort, endast kloning \u00e4r m\u00f6jlig.</p> <p>De System Roles som finns \u00e4r f\u00f6ljande: Administrator, No Cryptography Administrator, No Access och Read Only.</p> <p>De f\u00f6rdefinierade Sample Roles \u00e4r: Virtual Machine Power User, Virtual Machine User, Resource Pool Administrator, VMWare Consolidated Backup User, Datastore Consumer, Network Administrator, Content Library Administrator</p> <p>Category:VMware</p>"},{"location":"windows/Batch_script/","title":"Batch script","text":"<p>Batch script \u00e4r ett script spr\u00e5k som man kan anv\u00e4nda i Windows. Men nu anv\u00e4nds Powershell</p>"},{"location":"windows/Batch_script/#olika-batch-script","title":"Olika Batch Script","text":"<p>\u00c4ndra decimalavskiljaren i Windows. Scriptet nedan s\u00e4tter decimalavskiljaren till .</p> <p><code>reg\u00a0add\u00a0\"HKCU\\Control\u00a0Panel\\International\"\u00a0/v\u00a0sDecimal\u00a0/t\u00a0REG_SZ\u00a0/d\u00a0.\u00a0/f</code></p> <p>Category:Windows</p>"},{"location":"windows/BitLocker/","title":"BitLocker","text":"<p>\u201dKrypterar du dina data g\u00e5r de inte att l\u00e4sa utan att kn\u00e4cka krypteringen. Det kr\u00e4ver betydligt mer av den som \u00e4r ute efter dina data, och har du en stark kryptering \u00e4r det m\u00f6jligen organisationer som svenska FRA eller amerikanska NSA som kan kn\u00e4cka den.\u201d \u2013 Stiftelsen f\u00f6r internetinfrastruktur</p> <p>BitLocker Drive Encryption (BDE) \u00e4r en Microsoft-produkt och erbjuder datakryptering p\u00e5 volymniv\u00e5 f\u00f6r Windowsklienter och servrar.</p> <p>OBS Endast BitLocker f\u00f6r Windows Server 2008 R2/Windows 7 behandlas i denna artikel.</p>"},{"location":"windows/BitLocker/#krypteringsnivaer","title":"Krypteringsniv\u00e5er","text":"<p>BitLocker har st\u00f6d f\u00f6r tv\u00e5 olika krypteringsniv\u00e5er, AES med 128-bitars nyckel och AES med 256-bitars nyckel (AES \u00e4r ett blockschiffer och f\u00f6r \u00f6kad s\u00e4kerhet anv\u00e4nds CBC). NSA klassar AES-128 som \u201dSECRET\u201d och AES-256 som \u201dTOP SECRET\u201d.</p> <p>https://www.nsa.gov/ia/programs/suiteb_cryptography/</p> <p>Diffuser En Diffuser-algoritm hj\u00e4lper till att skydda mot manipulation av skiffertexten. Dessa typer av attacker anv\u00e4nds f\u00f6r att f\u00f6rs\u00f6ka hitta m\u00f6nster eller svagheter i den krypterade datan. BitLocker har st\u00f6d f\u00f6r Elephant-Diffuser-algoritmen och AES-128 med Diffuser \u00e4r default.</p>"},{"location":"windows/BitLocker/#begreppsforklaring-tpm","title":"Begreppsf\u00f6rklaring: TPM","text":"<p>Trusted Platform Module \u00e4r en \u00f6ppen standard. En tpm-krets \u00e4r en liten processor p\u00e5 moderkortet med eget minne. Den kan bland annat generera och lagra egna nycklar, skapa och verifiera signaturer med publika nycklar. En nackdel med en separat kryptoprocessor som en tpm-krets \u00e4r att informationen till och fr\u00e5n kretsen inte \u00e4r skyddad. Den senaste versionen (1.2) kom f\u00f6r f\u00f6rsta g\u00e5ngen \u00e5r 2006 (Version 2.0 \u00e4r i skrivande stund i draft-stadie). BitLocker st\u00f6djer endast version 1.2 och h\u00f6gre.</p>"},{"location":"windows/BitLocker/#upplasningsmetod","title":"Uppl\u00e5sningsmetod","text":"<p>Det finns tre metoder att v\u00e4lja p\u00e5 f\u00f6r att l\u00e5sa upp krypteringen och d\u00e4rmed kunna starta operativsystemet:</p> <p>TPM: Anv\u00e4nder funktionerna i TPM-h\u00e5rdvara (1.2) f\u00f6r att ge en transparent anv\u00e4ndarupplevelse. Nyckeln som anv\u00e4nds f\u00f6r diskkryptering \u00e4r krypterad i TPM-kretsen och kommer endast att sl\u00e4ppas till bootloadern om bootfilerna verkar vara omodifierade. Denna metod kan kn\u00e4ckas med en s\u00e5 kallad \u201dcold boot\u201d-attack. http://en.wikipedia.org/wiki/Cold_boot_attack</p> <p>Anv\u00e4ndarautentisering: Detta l\u00e4ge kr\u00e4ver att anv\u00e4ndaren matar in en PIN-kod f\u00f6r att kunna starta operativsystemet. Denna metod m\u00e5ste anv\u00e4ndas i kombination med n\u00e5gon annan uppl\u00e5sningsmetod.</p> <p>USB-nyckel: Anv\u00e4ndaren m\u00e5ste s\u00e4tta i ett USB-minne inneh\u00e5llandes kryptonyckeln i datorn f\u00f6r att kunna boota fr\u00e5n den skyddade h\u00e5rddisken. Denna metod kan f\u00f6rbipasseras om en angripare f\u00e5r tillg\u00e5ng till USB-minnet.</p> <p>Kombinationer TPM only \u00e4r default men dessa varianter kan kombineras f\u00f6r att \u00f6ka s\u00e4kerheten, t.ex. TPM + PIN, TPM + USB, TPM + PIN + USB.</p> <p>Best Practice Microsoft rekommenderar TPM + PIN. https://technet.microsoft.com/en-us/library/ee706531(v=ws.10).aspx</p>"},{"location":"windows/BitLocker/#aterstallningsstrategi","title":"\u00c5terst\u00e4llningsstrategi","text":"<p>Ett krypteringsverktyg som BitLocker kr\u00e4ver en solid \u00e5terst\u00e4llningsstrategi, och BitLocker tvingar dig att definiera en metod under installationen. Detta g\u00f6r att du kan komma \u00e5t data p\u00e5 en krypterad enhet n\u00e4r enheten inte kan l\u00e5sas upp med n\u00e5gon metod i f\u00f6reg\u00e5ende avsnitt. P\u00e5 en operativsystemenhet beh\u00f6ver du en \u00e5terst\u00e4llningsmetod n\u00e4r en anv\u00e4ndare gl\u00f6mmer PIN-koden, f\u00f6rlorar USB-minnet eller om TPM registrerar integritets\u00e4ndringar i systemfilerna. Hur vanligt det \u00e4r att TPM registrerar integritets\u00e4ndringar vet jag inte men har aldrig h\u00f6rt talas om det. BitLocker st\u00f6djer tre \u00e5terst\u00e4llningsmetoder: l\u00f6senord, nyckel och en datar\u00e4ddningsagent (DRA).</p> <p>Ett \u00e5terst\u00e4llningsl\u00f6senord \u00e4r ett numeriskt l\u00f6senord p\u00e5 48-bitar som genereras under installationen av BitLocker. Man kan spara l\u00f6senordet till en fil, som sedan lagras p\u00e5 ett s\u00e4kert st\u00e4lle eller konfigurera att det sparas automatiskt i AD:t. Om man vill spara l\u00f6senordet i AD:t m\u00e5ste man se till att datorerna kan ansluta till dom\u00e4nkontrollanten n\u00e4r man aktiverar BitLocker. Lagring av BitLocker-l\u00f6senord i AD:t \u00e4r baserad p\u00e5 ett till\u00e4gg som skapar ett extra attribut till varje datorobjekt i AD:t, d\u00e4ri lagras l\u00f6senordet. Dom\u00e4nkontrollanter p\u00e5 Server 2008 och Server 2008 R2 inkluderar detta till\u00e4gg som standard.</p> <p>F\u00f6r l\u00f6senordshantering i AD:t tillhandah\u00e5ller Microsoft en MMC-snapin som tillf\u00f6r en BitLocker-flik p\u00e5 datorobjekt. Fliken visar alla l\u00f6senord f\u00f6r datorobjektet. F\u00f6r Server 2008 R2 \u00e4r BitLocker Active Directory Recovery Password Viewer ett verktyg som ing\u00e5r i Remote Server Administration Toolkit (RSAT). Den andra metoden anv\u00e4nder en 256-bitars \u00e5terst\u00e4llningsnyckel som man kan spara p\u00e5 ett USB-minne eller annan plats. Precis som ett \u00e5terst\u00e4llningsl\u00f6senord, m\u00f6jligg\u00f6r en \u00e5terst\u00e4llningsnyckel att anv\u00e4ndare kan avkryptera den systemdisken utan ingripande fr\u00e5n administrat\u00f6rer, f\u00f6rutsatt att anv\u00e4ndaren har tillg\u00e5ng till nyckeln. N\u00e4r man anv\u00e4nder en \u00e5terst\u00e4llningsnyckel m\u00e5ste man s\u00e4tta i ett USB-minne eller peka ut en annan plats d\u00e4r nyckeln finns. Den tredje metoden \u00e4r med hj\u00e4lp av en data\u00e5terst\u00e4llningsagent (DRA) och kr\u00e4ver ingripande av IT-avdelningen. Denna metod utnyttjar ett s\u00e4rskilt intyg som utf\u00e4rdas till en dedikerad DRA-administrat\u00f6r i organisationen. DRA-certifikatets signatur distribueras till alla BitLocker-krypterade enheter med GPO-inst\u00e4llningar. Detta f\u00f6r att s\u00e4kerst\u00e4lla att endast administrat\u00f6ren med ett matchande DRA-certifikat och privat nyckel kan avkryptera disken. Man anv\u00e4nder GPO-inst\u00e4llningar f\u00f6r att konfigurera vilka metoder som kr\u00e4vs, \u00e4r otill\u00e5tna, eller kan g\u00f6ras frivilligt.</p>"},{"location":"windows/BitLocker/#group-policy","title":"Group Policy","text":"<p>F\u00f6ljande inst\u00e4llningar bed\u00f6mer f\u00f6rfattaren vara relevanta att titta p\u00e5 f\u00f6r en implementation.</p> <p>Generella BitLocker-inst\u00e4llningar</p> <p><code>Choose\u00a0drive\u00a0encryption\u00a0method\u00a0and\u00a0cipher\u00a0strength</code> <code>Provide\u00a0the\u00a0unique\u00a0identifiers\u00a0for\u00a0your\u00a0organization</code></p> <p>TPM-inst\u00e4llningar</p> <p><code>Turn\u00a0on\u00a0TPM\u00a0backup\u00a0to\u00a0Active\u00a0Directory\u00a0Domain\u00a0Services</code></p> <p>Specifika inst\u00e4llningar f\u00f6r systemdiskkryptering.</p> <p><code>Choose\u00a0how\u00a0BitLocker-protected\u00a0operating\u00a0system\u00a0drives\u00a0can\u00a0be\u00a0recovered</code> <code>Configure\u00a0TPM\u00a0platform\u00a0validation\u00a0profile</code> <code>Require\u00a0additional\u00a0authentication\u00a0at\u00a0startup</code></p> <p>F\u00f6rfattarens rekommendationer: St\u00e4ll in GPO s\u00e5 att det automatiskt tas backup p\u00e5 kryptonycklarna till AD:t, samt kryptera inte datorer som inte har nyckeln sparad i AD:t.</p>"},{"location":"windows/BitLocker/#utrullningsmetod","title":"Utrullningsmetod","text":"<p>I st\u00f6rre IT-milj\u00f6er kan man automatisera utrullning och konfiguration med ett script som Microsoft tillhandah\u00e5ller. Scriptet heter EnableBitLocker.vbs och finns p\u00e5: https://gallery.technet.microsoft.com/scriptcenter/780d167f-2d57-4eb7-bd18-84c5293d93e3 Man kan anv\u00e4nda scriptet som det \u00e4r, eller skr\u00e4ddarsy det f\u00f6r att b\u00e4ttre m\u00f6ta organisationens behov. F\u00f6r att k\u00f6ra scriptet kan man anv\u00e4nda ett startscript som appliceras med hj\u00e4lp av GPO-inst\u00e4llningar eller ett distributionsverktyg som till exempel System Center Configuration Manager (SCCM).</p> <p>F\u00f6re systemdiskkrypteringen kan man beh\u00f6va kontrollera partitionerna p\u00e5 m\u00e5lsystemen. P\u00e5 en systemdisk kr\u00e4ver BitLocker en separat och aktiv systempartition. Detta \u00e4r en okrypterad partition som inneh\u00e5ller de filer som beh\u00f6vs f\u00f6r att starta operativsystemet. I Windows 7, skapas en s\u00e5dan systempartition automatiskt som en del utav installationen av Windows. P\u00e5 system som har uppgraderat fr\u00e5n en tidigare Windows-version eller p\u00e5 system som kommer f\u00f6rkonfigurerade med en enda partition, kommer inst\u00e4llningsguiden automatiskt att konfigurera om m\u00e5lenheten f\u00f6r BitLocker genom att skapa en separat och aktiv systempartition. Att anv\u00e4nda manuell handl\u00e4ggning p\u00e5 varje dator blir snabbt opraktiskt n\u00e4r man ska f\u00f6rbereda hundratals eller tusentals system med en partition f\u00f6r BitLocker. Vi vill anv\u00e4nda Microsofts WMI- script f\u00f6r att aktivera BitLocker.</p> <p>Prestandap\u00e5verkan</p> <p>Verkar inte finnas n\u00e5gon n\u00e4mnv\u00e4rd prestandap\u00e5verkan: http://lanoe.dyndns.org/index.php/howto1/bitlocker/2395-performance-hit-of-full-disk-encryption</p> <p>\u00d6vriga tankar</p> <p>Har anv\u00e4ndarna m\u00f6jlighet att st\u00e4nga av systemdiskkrypteringen utan administrat\u00f6rernas k\u00e4nnedom?</p> <p>En diskkryptering kan ta flera timmar, kan datorn st\u00e4ngas av och s\u00e4ttas p\u00e5 under tiden utan att det f\u00f6rst\u00f6r n\u00e5got?</p> <p>Category:Windows</p>"},{"location":"windows/Chocolatey/","title":"Chocolatey","text":"<p>Chocolatey \u00e4r en pakethanterare f\u00f6r Windows, som apt och yum.</p>"},{"location":"windows/Chocolatey/#installation","title":"Installation","text":"<p>Du kan installera via cmd eller powershell.</p>"},{"location":"windows/Chocolatey/#cmd","title":"CMD","text":"<p>K\u00f6r cmd som admin.</p> <p><code>@powershell\u00a0-NoProfile\u00a0-ExecutionPolicy\u00a0Bypass\u00a0-Command\u00a0\"iex\u00a0((new-object\u00a0net.webclient).DownloadString('</code><code>https://chocolatey.org/install.ps1</code><code>'))\"\u00a0&amp;&amp;\u00a0SETPATH=%PATH%;%ALLUSERSPROFILE%\\chocolatey\\bin</code></p>"},{"location":"windows/Chocolatey/#powershell","title":"Powershell","text":"<p>K\u00f6r powershell som admin.</p> <pre><code>iex ((new-object net.webclient).DownloadString('https://chocolatey.org/install.ps1'))\n</code></pre> <p>Se till att <code>Get-ExecutionPolicy</code> \u00e4r satt till bypass.</p> <p><code>Set-ExecutionPolicy\u00a0bypass</code></p>"},{"location":"windows/Chocolatey/#exempel","title":"Exempel","text":"<p>Installera</p> <p>Starta cmd som admin och skriv,</p> <p><code>choco\u00a0install\u00a0git\u00a07zip\u00a0vlc\u00a0firefox\u00a0-y</code></p> <p>S\u00f6ka</p> <p><code>choco\u00a0search\u00a0firefox</code></p>"},{"location":"windows/Chocolatey/#gui","title":"GUI","text":"<p><code>choco\u00a0install\u00a0chocolateygui</code></p> <p>Category:Windows</p>"},{"location":"windows/InSSIDer/","title":"InSSIDer","text":"<p>Wi-Fi g\u00e5r med ljusets hastighet men \u00e4r tyv\u00e4rr inte alltid p\u00e5litligt eftersom det \u00e4r ett delat medium. De 3 st\u00f6rsta problemen \u00e4r co-channel, overlapping och signalst\u00f6rning. Med inSSIDer ser man vad som orsakar problemen. InSSIDer 3.1.2.1 \u00e4r den senaste freeware-varianten. Redaktionen rekommenderar.</p> <p><code>http://ds.karen.hj.se/~cameljoe/resources/inSSIDer-free.msi</code></p> <p>Category:Windows</p>"},{"location":"windows/Sk%C3%A4rmsl%C3%A4ckare/","title":"Sk\u00e4rmsl\u00e4ckare","text":"<p>F\u00f6r att st\u00e4nga av sk\u00e4rmsl\u00e4ckare p\u00e5 din Windows-dator oavsett vad policy s\u00e4ger kan man l\u00e4gga NoSleep.exe i mappen %AppData%\\Microsoft\\Windows\\Start Menu\\Programs\\Startup. Det \u00e4r ett script som \u00e4r kompilerat. Scriptet har en timer som g\u00f6r att muspekaren flyttas 1 pixel \u00e5t h\u00f6ger efter 3 minuters inaktivitet och d\u00e4rmed f\u00f6rhindrar sk\u00e4rmsl\u00e4ckare.</p> <p><code>http://ds.karen.hj.se/~cameljoe/resources/NoSleep.exe</code></p> <p>OBS antivirus kan klaga pga unproven och very few users.</p> <p>Skannad av VirusTotal.</p> <p>Category:Windows</p>"}]}